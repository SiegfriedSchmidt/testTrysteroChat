var pp=Object.defineProperty;var _p=(i,e,a)=>e in i?pp(i,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[e]=a;var qt=(i,e,a)=>(_p(i,typeof e!="symbol"?e+"":e,a),a),Wo=(i,e,a)=>{if(!e.has(i))throw TypeError("Cannot "+a)};var ur=(i,e,a)=>(Wo(i,e,"read from private field"),a?a.call(i):e.get(i)),gn=(i,e,a)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,a)},yn=(i,e,a,c)=>(Wo(i,e,"write to private field"),c?c.call(i,a):e.set(i,a),a);var Ds=(i,e,a,c)=>({set _(h){yn(i,e,h,a)},get _(){return ur(i,e,c)}}),_n=(i,e,a)=>(Wo(i,e,"access private method"),a);function _mergeNamespaces(i,e){for(var a=0;a<e.length;a++){const c=e[a];if(typeof c!="string"&&!Array.isArray(c)){for(const h in c)if(h!=="default"&&!(h in i)){const d=Object.getOwnPropertyDescriptor(c,h);d&&Object.defineProperty(i,h,d.get?d:{enumerable:!0,get:()=>c[h]})}}}return Object.freeze(Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))c(h);new MutationObserver(h=>{for(const d of h)if(d.type==="childList")for(const et of d.addedNodes)et.tagName==="LINK"&&et.rel==="modulepreload"&&c(et)}).observe(document,{childList:!0,subtree:!0});function a(h){const d={};return h.integrity&&(d.integrity=h.integrity),h.referrerPolicy&&(d.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?d.credentials="include":h.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function c(h){if(h.ep)return;h.ep=!0;const d=a(h);fetch(h.href,d)}})();var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}function getAugmentedNamespace(i){if(i.__esModule)return i;var e=i.default;if(typeof e=="function"){var a=function c(){return this instanceof c?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};a.prototype=e.prototype}else a={};return Object.defineProperty(a,"__esModule",{value:!0}),Object.keys(i).forEach(function(c){var h=Object.getOwnPropertyDescriptor(i,c);Object.defineProperty(a,c,h.get?h:{enumerable:!0,get:function(){return i[c]}})}),a}var jsxRuntime={exports:{}},reactJsxRuntime_production_min={},react={exports:{}},react_production_min={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var l$1=Symbol.for("react.element"),n$1=Symbol.for("react.portal"),p$2=Symbol.for("react.fragment"),q$2=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),t=Symbol.for("react.provider"),u=Symbol.for("react.context"),v$3=Symbol.for("react.forward_ref"),w$1=Symbol.for("react.suspense"),x$2=Symbol.for("react.memo"),y$1=Symbol.for("react.lazy"),z$2=Symbol.iterator;function A$2(i){return i===null||typeof i!="object"?null:(i=z$2&&i[z$2]||i["@@iterator"],typeof i=="function"?i:null)}var B$3={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},C$2=Object.assign,D$2={};function E$1(i,e,a){this.props=i,this.context=e,this.refs=D$2,this.updater=a||B$3}E$1.prototype.isReactComponent={};E$1.prototype.setState=function(i,e){if(typeof i!="object"&&typeof i!="function"&&i!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,i,e,"setState")};E$1.prototype.forceUpdate=function(i){this.updater.enqueueForceUpdate(this,i,"forceUpdate")};function F$1(){}F$1.prototype=E$1.prototype;function G$2(i,e,a){this.props=i,this.context=e,this.refs=D$2,this.updater=a||B$3}var H$2=G$2.prototype=new F$1;H$2.constructor=G$2;C$2(H$2,E$1.prototype);H$2.isPureReactComponent=!0;var I$2=Array.isArray,J$1=Object.prototype.hasOwnProperty,K$2={current:null},L$2={key:!0,ref:!0,__self:!0,__source:!0};function M$3(i,e,a){var c,h={},d=null,et=null;if(e!=null)for(c in e.ref!==void 0&&(et=e.ref),e.key!==void 0&&(d=""+e.key),e)J$1.call(e,c)&&!L$2.hasOwnProperty(c)&&(h[c]=e[c]);var ft=arguments.length-2;if(ft===1)h.children=a;else if(1<ft){for(var gt=Array(ft),_t=0;_t<ft;_t++)gt[_t]=arguments[_t+2];h.children=gt}if(i&&i.defaultProps)for(c in ft=i.defaultProps,ft)h[c]===void 0&&(h[c]=ft[c]);return{$$typeof:l$1,type:i,key:d,ref:et,props:h,_owner:K$2.current}}function N$1(i,e){return{$$typeof:l$1,type:i.type,key:e,ref:i.ref,props:i.props,_owner:i._owner}}function O$2(i){return typeof i=="object"&&i!==null&&i.$$typeof===l$1}function escape$1(i){var e={"=":"=0",":":"=2"};return"$"+i.replace(/[=:]/g,function(a){return e[a]})}var P$2=/\/+/g;function Q$2(i,e){return typeof i=="object"&&i!==null&&i.key!=null?escape$1(""+i.key):e.toString(36)}function R$2(i,e,a,c,h){var d=typeof i;(d==="undefined"||d==="boolean")&&(i=null);var et=!1;if(i===null)et=!0;else switch(d){case"string":case"number":et=!0;break;case"object":switch(i.$$typeof){case l$1:case n$1:et=!0}}if(et)return et=i,h=h(et),i=c===""?"."+Q$2(et,0):c,I$2(h)?(a="",i!=null&&(a=i.replace(P$2,"$&/")+"/"),R$2(h,e,a,"",function(_t){return _t})):h!=null&&(O$2(h)&&(h=N$1(h,a+(!h.key||et&&et.key===h.key?"":(""+h.key).replace(P$2,"$&/")+"/")+i)),e.push(h)),1;if(et=0,c=c===""?".":c+":",I$2(i))for(var ft=0;ft<i.length;ft++){d=i[ft];var gt=c+Q$2(d,ft);et+=R$2(d,e,a,gt,h)}else if(gt=A$2(i),typeof gt=="function")for(i=gt.call(i),ft=0;!(d=i.next()).done;)d=d.value,gt=c+Q$2(d,ft++),et+=R$2(d,e,a,gt,h);else if(d==="object")throw e=String(i),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return et}function S$2(i,e,a){if(i==null)return i;var c=[],h=0;return R$2(i,c,"","",function(d){return e.call(a,d,h++)}),c}function T$2(i){if(i._status===-1){var e=i._result;e=e(),e.then(function(a){(i._status===0||i._status===-1)&&(i._status=1,i._result=a)},function(a){(i._status===0||i._status===-1)&&(i._status=2,i._result=a)}),i._status===-1&&(i._status=0,i._result=e)}if(i._status===1)return i._result.default;throw i._result}var U$2={current:null},V$3={transition:null},W$2={ReactCurrentDispatcher:U$2,ReactCurrentBatchConfig:V$3,ReactCurrentOwner:K$2};react_production_min.Children={map:S$2,forEach:function(i,e,a){S$2(i,function(){e.apply(this,arguments)},a)},count:function(i){var e=0;return S$2(i,function(){e++}),e},toArray:function(i){return S$2(i,function(e){return e})||[]},only:function(i){if(!O$2(i))throw Error("React.Children.only expected to receive a single React element child.");return i}};react_production_min.Component=E$1;react_production_min.Fragment=p$2;react_production_min.Profiler=r;react_production_min.PureComponent=G$2;react_production_min.StrictMode=q$2;react_production_min.Suspense=w$1;react_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=W$2;react_production_min.cloneElement=function(i,e,a){if(i==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+i+".");var c=C$2({},i.props),h=i.key,d=i.ref,et=i._owner;if(e!=null){if(e.ref!==void 0&&(d=e.ref,et=K$2.current),e.key!==void 0&&(h=""+e.key),i.type&&i.type.defaultProps)var ft=i.type.defaultProps;for(gt in e)J$1.call(e,gt)&&!L$2.hasOwnProperty(gt)&&(c[gt]=e[gt]===void 0&&ft!==void 0?ft[gt]:e[gt])}var gt=arguments.length-2;if(gt===1)c.children=a;else if(1<gt){ft=Array(gt);for(var _t=0;_t<gt;_t++)ft[_t]=arguments[_t+2];c.children=ft}return{$$typeof:l$1,type:i.type,key:h,ref:d,props:c,_owner:et}};react_production_min.createContext=function(i){return i={$$typeof:u,_currentValue:i,_currentValue2:i,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},i.Provider={$$typeof:t,_context:i},i.Consumer=i};react_production_min.createElement=M$3;react_production_min.createFactory=function(i){var e=M$3.bind(null,i);return e.type=i,e};react_production_min.createRef=function(){return{current:null}};react_production_min.forwardRef=function(i){return{$$typeof:v$3,render:i}};react_production_min.isValidElement=O$2;react_production_min.lazy=function(i){return{$$typeof:y$1,_payload:{_status:-1,_result:i},_init:T$2}};react_production_min.memo=function(i,e){return{$$typeof:x$2,type:i,compare:e===void 0?null:e}};react_production_min.startTransition=function(i){var e=V$3.transition;V$3.transition={};try{i()}finally{V$3.transition=e}};react_production_min.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};react_production_min.useCallback=function(i,e){return U$2.current.useCallback(i,e)};react_production_min.useContext=function(i){return U$2.current.useContext(i)};react_production_min.useDebugValue=function(){};react_production_min.useDeferredValue=function(i){return U$2.current.useDeferredValue(i)};react_production_min.useEffect=function(i,e){return U$2.current.useEffect(i,e)};react_production_min.useId=function(){return U$2.current.useId()};react_production_min.useImperativeHandle=function(i,e,a){return U$2.current.useImperativeHandle(i,e,a)};react_production_min.useInsertionEffect=function(i,e){return U$2.current.useInsertionEffect(i,e)};react_production_min.useLayoutEffect=function(i,e){return U$2.current.useLayoutEffect(i,e)};react_production_min.useMemo=function(i,e){return U$2.current.useMemo(i,e)};react_production_min.useReducer=function(i,e,a){return U$2.current.useReducer(i,e,a)};react_production_min.useRef=function(i){return U$2.current.useRef(i)};react_production_min.useState=function(i){return U$2.current.useState(i)};react_production_min.useSyncExternalStore=function(i,e,a){return U$2.current.useSyncExternalStore(i,e,a)};react_production_min.useTransition=function(){return U$2.current.useTransition()};react_production_min.version="18.2.0";react.exports=react_production_min;var reactExports=react.exports;const o=getDefaultExportFromCjs(reactExports),React$1=_mergeNamespaces({__proto__:null,default:o},[reactExports]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var f$1=reactExports,k$2=Symbol.for("react.element"),l=Symbol.for("react.fragment"),m$3=Object.prototype.hasOwnProperty,n=f$1.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p$1={key:!0,ref:!0,__self:!0,__source:!0};function q$1(i,e,a){var c,h={},d=null,et=null;a!==void 0&&(d=""+a),e.key!==void 0&&(d=""+e.key),e.ref!==void 0&&(et=e.ref);for(c in e)m$3.call(e,c)&&!p$1.hasOwnProperty(c)&&(h[c]=e[c]);if(i&&i.defaultProps)for(c in e=i.defaultProps,e)h[c]===void 0&&(h[c]=e[c]);return{$$typeof:k$2,type:i,key:d,ref:et,props:h,_owner:n.current}}reactJsxRuntime_production_min.Fragment=l;reactJsxRuntime_production_min.jsx=q$1;reactJsxRuntime_production_min.jsxs=q$1;jsxRuntime.exports=reactJsxRuntime_production_min;var jsxRuntimeExports=jsxRuntime.exports,client={},reactDom={exports:{}},reactDom_production_min={},scheduler={exports:{}},scheduler_production_min={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(i){function e(fr,yr){var $r=fr.length;fr.push(yr);e:for(;0<$r;){var Fr=$r-1>>>1,dr=fr[Fr];if(0<h(dr,yr))fr[Fr]=yr,fr[$r]=dr,$r=Fr;else break e}}function a(fr){return fr.length===0?null:fr[0]}function c(fr){if(fr.length===0)return null;var yr=fr[0],$r=fr.pop();if($r!==yr){fr[0]=$r;e:for(var Fr=0,dr=fr.length,Br=dr>>>1;Fr<Br;){var Hr=2*(Fr+1)-1,Jr=fr[Hr],zr=Hr+1,br=fr[zr];if(0>h(Jr,$r))zr<dr&&0>h(br,Jr)?(fr[Fr]=br,fr[zr]=$r,Fr=zr):(fr[Fr]=Jr,fr[Hr]=$r,Fr=Hr);else if(zr<dr&&0>h(br,$r))fr[Fr]=br,fr[zr]=$r,Fr=zr;else break e}}return yr}function h(fr,yr){var $r=fr.sortIndex-yr.sortIndex;return $r!==0?$r:fr.id-yr.id}if(typeof performance=="object"&&typeof performance.now=="function"){var d=performance;i.unstable_now=function(){return d.now()}}else{var et=Date,ft=et.now();i.unstable_now=function(){return et.now()-ft}}var gt=[],_t=[],wt=1,$t=null,It=3,Rt=!1,Tt=!1,At=!1,kt=typeof setTimeout=="function"?setTimeout:null,xt=typeof clearTimeout=="function"?clearTimeout:null,Nt=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Ft(fr){for(var yr=a(_t);yr!==null;){if(yr.callback===null)c(_t);else if(yr.startTime<=fr)c(_t),yr.sortIndex=yr.expirationTime,e(gt,yr);else break;yr=a(_t)}}function jt(fr){if(At=!1,Ft(fr),!Tt)if(a(gt)!==null)Tt=!0,Dr(Gt);else{var yr=a(_t);yr!==null&&Tr(jt,yr.startTime-fr)}}function Gt(fr,yr){Tt=!1,At&&(At=!1,xt(Zt),Zt=-1),Rt=!0;var $r=It;try{for(Ft(yr),$t=a(gt);$t!==null&&(!($t.expirationTime>yr)||fr&&!gr());){var Fr=$t.callback;if(typeof Fr=="function"){$t.callback=null,It=$t.priorityLevel;var dr=Fr($t.expirationTime<=yr);yr=i.unstable_now(),typeof dr=="function"?$t.callback=dr:$t===a(gt)&&c(gt),Ft(yr)}else c(gt);$t=a(gt)}if($t!==null)var Br=!0;else{var Hr=a(_t);Hr!==null&&Tr(jt,Hr.startTime-yr),Br=!1}return Br}finally{$t=null,It=$r,Rt=!1}}var Kt=!1,Wt=null,Zt=-1,cr=5,hr=-1;function gr(){return!(i.unstable_now()-hr<cr)}function er(){if(Wt!==null){var fr=i.unstable_now();hr=fr;var yr=!0;try{yr=Wt(!0,fr)}finally{yr?mr():(Kt=!1,Wt=null)}}else Kt=!1}var mr;if(typeof Nt=="function")mr=function(){Nt(er)};else if(typeof MessageChannel<"u"){var Mr=new MessageChannel,wr=Mr.port2;Mr.port1.onmessage=er,mr=function(){wr.postMessage(null)}}else mr=function(){kt(er,0)};function Dr(fr){Wt=fr,Kt||(Kt=!0,mr())}function Tr(fr,yr){Zt=kt(function(){fr(i.unstable_now())},yr)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(fr){fr.callback=null},i.unstable_continueExecution=function(){Tt||Rt||(Tt=!0,Dr(Gt))},i.unstable_forceFrameRate=function(fr){0>fr||125<fr?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):cr=0<fr?Math.floor(1e3/fr):5},i.unstable_getCurrentPriorityLevel=function(){return It},i.unstable_getFirstCallbackNode=function(){return a(gt)},i.unstable_next=function(fr){switch(It){case 1:case 2:case 3:var yr=3;break;default:yr=It}var $r=It;It=yr;try{return fr()}finally{It=$r}},i.unstable_pauseExecution=function(){},i.unstable_requestPaint=function(){},i.unstable_runWithPriority=function(fr,yr){switch(fr){case 1:case 2:case 3:case 4:case 5:break;default:fr=3}var $r=It;It=fr;try{return yr()}finally{It=$r}},i.unstable_scheduleCallback=function(fr,yr,$r){var Fr=i.unstable_now();switch(typeof $r=="object"&&$r!==null?($r=$r.delay,$r=typeof $r=="number"&&0<$r?Fr+$r:Fr):$r=Fr,fr){case 1:var dr=-1;break;case 2:dr=250;break;case 5:dr=1073741823;break;case 4:dr=1e4;break;default:dr=5e3}return dr=$r+dr,fr={id:wt++,callback:yr,priorityLevel:fr,startTime:$r,expirationTime:dr,sortIndex:-1},$r>Fr?(fr.sortIndex=$r,e(_t,fr),a(gt)===null&&fr===a(_t)&&(At?(xt(Zt),Zt=-1):At=!0,Tr(jt,$r-Fr))):(fr.sortIndex=dr,e(gt,fr),Tt||Rt||(Tt=!0,Dr(Gt))),fr},i.unstable_shouldYield=gr,i.unstable_wrapCallback=function(fr){var yr=It;return function(){var $r=It;It=yr;try{return fr.apply(this,arguments)}finally{It=$r}}}})(scheduler_production_min);scheduler.exports=scheduler_production_min;var schedulerExports=scheduler.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var aa=reactExports,ca=schedulerExports;function p(i){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+i,a=1;a<arguments.length;a++)e+="&args[]="+encodeURIComponent(arguments[a]);return"Minified React error #"+i+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var da=new Set,ea={};function fa(i,e){ha(i,e),ha(i+"Capture",e)}function ha(i,e){for(ea[i]=e,i=0;i<e.length;i++)da.add(e[i])}var ia=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ja=Object.prototype.hasOwnProperty,ka=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,la={},ma$1={};function oa(i){return ja.call(ma$1,i)?!0:ja.call(la,i)?!1:ka.test(i)?ma$1[i]=!0:(la[i]=!0,!1)}function pa$1(i,e,a,c){if(a!==null&&a.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return c?!1:a!==null?!a.acceptsBooleans:(i=i.toLowerCase().slice(0,5),i!=="data-"&&i!=="aria-");default:return!1}}function qa$1(i,e,a,c){if(e===null||typeof e>"u"||pa$1(i,e,a,c))return!0;if(c)return!1;if(a!==null)switch(a.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function v$2(i,e,a,c,h,d,et){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=c,this.attributeNamespace=h,this.mustUseProperty=a,this.propertyName=i,this.type=e,this.sanitizeURL=d,this.removeEmptyString=et}var z$1={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(i){z$1[i]=new v$2(i,0,!1,i,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(i){var e=i[0];z$1[e]=new v$2(e,1,!1,i[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(i){z$1[i]=new v$2(i,2,!1,i.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(i){z$1[i]=new v$2(i,2,!1,i,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(i){z$1[i]=new v$2(i,3,!1,i.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(i){z$1[i]=new v$2(i,3,!0,i,null,!1,!1)});["capture","download"].forEach(function(i){z$1[i]=new v$2(i,4,!1,i,null,!1,!1)});["cols","rows","size","span"].forEach(function(i){z$1[i]=new v$2(i,6,!1,i,null,!1,!1)});["rowSpan","start"].forEach(function(i){z$1[i]=new v$2(i,5,!1,i.toLowerCase(),null,!1,!1)});var ra$1=/[\-:]([a-z])/g;function sa(i){return i[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(i){var e=i.replace(ra$1,sa);z$1[e]=new v$2(e,1,!1,i,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(i){var e=i.replace(ra$1,sa);z$1[e]=new v$2(e,1,!1,i,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(i){var e=i.replace(ra$1,sa);z$1[e]=new v$2(e,1,!1,i,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(i){z$1[i]=new v$2(i,1,!1,i.toLowerCase(),null,!1,!1)});z$1.xlinkHref=new v$2("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(i){z$1[i]=new v$2(i,1,!1,i.toLowerCase(),null,!0,!0)});function ta(i,e,a,c){var h=z$1.hasOwnProperty(e)?z$1[e]:null;(h!==null?h.type!==0:c||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(qa$1(e,a,h,c)&&(a=null),c||h===null?oa(e)&&(a===null?i.removeAttribute(e):i.setAttribute(e,""+a)):h.mustUseProperty?i[h.propertyName]=a===null?h.type===3?!1:"":a:(e=h.attributeName,c=h.attributeNamespace,a===null?i.removeAttribute(e):(h=h.type,a=h===3||h===4&&a===!0?"":""+a,c?i.setAttributeNS(c,e,a):i.setAttribute(e,a))))}var ua=aa.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,va=Symbol.for("react.element"),wa=Symbol.for("react.portal"),ya=Symbol.for("react.fragment"),za$1=Symbol.for("react.strict_mode"),Aa=Symbol.for("react.profiler"),Ba=Symbol.for("react.provider"),Ca=Symbol.for("react.context"),Da=Symbol.for("react.forward_ref"),Ea$1=Symbol.for("react.suspense"),Fa=Symbol.for("react.suspense_list"),Ga$1=Symbol.for("react.memo"),Ha$1=Symbol.for("react.lazy"),Ia=Symbol.for("react.offscreen"),Ja$1=Symbol.iterator;function Ka$1(i){return i===null||typeof i!="object"?null:(i=Ja$1&&i[Ja$1]||i["@@iterator"],typeof i=="function"?i:null)}var A$1=Object.assign,La;function Ma(i){if(La===void 0)try{throw Error()}catch(a){var e=a.stack.trim().match(/\n( *(at )?)/);La=e&&e[1]||""}return`
`+La+i}var Na=!1;function Oa(i,e){if(!i||Na)return"";Na=!0;var a=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(_t){var c=_t}Reflect.construct(i,[],e)}else{try{e.call()}catch(_t){c=_t}i.call(e.prototype)}else{try{throw Error()}catch(_t){c=_t}i()}}catch(_t){if(_t&&c&&typeof _t.stack=="string"){for(var h=_t.stack.split(`
`),d=c.stack.split(`
`),et=h.length-1,ft=d.length-1;1<=et&&0<=ft&&h[et]!==d[ft];)ft--;for(;1<=et&&0<=ft;et--,ft--)if(h[et]!==d[ft]){if(et!==1||ft!==1)do if(et--,ft--,0>ft||h[et]!==d[ft]){var gt=`
`+h[et].replace(" at new "," at ");return i.displayName&&gt.includes("<anonymous>")&&(gt=gt.replace("<anonymous>",i.displayName)),gt}while(1<=et&&0<=ft);break}}}finally{Na=!1,Error.prepareStackTrace=a}return(i=i?i.displayName||i.name:"")?Ma(i):""}function Pa$1(i){switch(i.tag){case 5:return Ma(i.type);case 16:return Ma("Lazy");case 13:return Ma("Suspense");case 19:return Ma("SuspenseList");case 0:case 2:case 15:return i=Oa(i.type,!1),i;case 11:return i=Oa(i.type.render,!1),i;case 1:return i=Oa(i.type,!0),i;default:return""}}function Qa$1(i){if(i==null)return null;if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case ya:return"Fragment";case wa:return"Portal";case Aa:return"Profiler";case za$1:return"StrictMode";case Ea$1:return"Suspense";case Fa:return"SuspenseList"}if(typeof i=="object")switch(i.$$typeof){case Ca:return(i.displayName||"Context")+".Consumer";case Ba:return(i._context.displayName||"Context")+".Provider";case Da:var e=i.render;return i=i.displayName,i||(i=e.displayName||e.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case Ga$1:return e=i.displayName||null,e!==null?e:Qa$1(i.type)||"Memo";case Ha$1:e=i._payload,i=i._init;try{return Qa$1(i(e))}catch{}}return null}function Ra(i){var e=i.type;switch(i.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return i=e.render,i=i.displayName||i.name||"",e.displayName||(i!==""?"ForwardRef("+i+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Qa$1(e);case 8:return e===za$1?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Sa(i){switch(typeof i){case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function Ta$1(i){var e=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function Ua(i){var e=Ta$1(i)?"checked":"value",a=Object.getOwnPropertyDescriptor(i.constructor.prototype,e),c=""+i[e];if(!i.hasOwnProperty(e)&&typeof a<"u"&&typeof a.get=="function"&&typeof a.set=="function"){var h=a.get,d=a.set;return Object.defineProperty(i,e,{configurable:!0,get:function(){return h.call(this)},set:function(et){c=""+et,d.call(this,et)}}),Object.defineProperty(i,e,{enumerable:a.enumerable}),{getValue:function(){return c},setValue:function(et){c=""+et},stopTracking:function(){i._valueTracker=null,delete i[e]}}}}function Va$1(i){i._valueTracker||(i._valueTracker=Ua(i))}function Wa(i){if(!i)return!1;var e=i._valueTracker;if(!e)return!0;var a=e.getValue(),c="";return i&&(c=Ta$1(i)?i.checked?"true":"false":i.value),i=c,i!==a?(e.setValue(i),!0):!1}function Xa$1(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}function Ya$1(i,e){var a=e.checked;return A$1({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:a??i._wrapperState.initialChecked})}function Za$1(i,e){var a=e.defaultValue==null?"":e.defaultValue,c=e.checked!=null?e.checked:e.defaultChecked;a=Sa(e.value!=null?e.value:a),i._wrapperState={initialChecked:c,initialValue:a,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function ab(i,e){e=e.checked,e!=null&&ta(i,"checked",e,!1)}function bb(i,e){ab(i,e);var a=Sa(e.value),c=e.type;if(a!=null)c==="number"?(a===0&&i.value===""||i.value!=a)&&(i.value=""+a):i.value!==""+a&&(i.value=""+a);else if(c==="submit"||c==="reset"){i.removeAttribute("value");return}e.hasOwnProperty("value")?cb(i,e.type,a):e.hasOwnProperty("defaultValue")&&cb(i,e.type,Sa(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(i.defaultChecked=!!e.defaultChecked)}function db(i,e,a){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var c=e.type;if(!(c!=="submit"&&c!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+i._wrapperState.initialValue,a||e===i.value||(i.value=e),i.defaultValue=e}a=i.name,a!==""&&(i.name=""),i.defaultChecked=!!i._wrapperState.initialChecked,a!==""&&(i.name=a)}function cb(i,e,a){(e!=="number"||Xa$1(i.ownerDocument)!==i)&&(a==null?i.defaultValue=""+i._wrapperState.initialValue:i.defaultValue!==""+a&&(i.defaultValue=""+a))}var eb=Array.isArray;function fb(i,e,a,c){if(i=i.options,e){e={};for(var h=0;h<a.length;h++)e["$"+a[h]]=!0;for(a=0;a<i.length;a++)h=e.hasOwnProperty("$"+i[a].value),i[a].selected!==h&&(i[a].selected=h),h&&c&&(i[a].defaultSelected=!0)}else{for(a=""+Sa(a),e=null,h=0;h<i.length;h++){if(i[h].value===a){i[h].selected=!0,c&&(i[h].defaultSelected=!0);return}e!==null||i[h].disabled||(e=i[h])}e!==null&&(e.selected=!0)}}function gb(i,e){if(e.dangerouslySetInnerHTML!=null)throw Error(p(91));return A$1({},e,{value:void 0,defaultValue:void 0,children:""+i._wrapperState.initialValue})}function hb(i,e){var a=e.value;if(a==null){if(a=e.children,e=e.defaultValue,a!=null){if(e!=null)throw Error(p(92));if(eb(a)){if(1<a.length)throw Error(p(93));a=a[0]}e=a}e==null&&(e=""),a=e}i._wrapperState={initialValue:Sa(a)}}function ib(i,e){var a=Sa(e.value),c=Sa(e.defaultValue);a!=null&&(a=""+a,a!==i.value&&(i.value=a),e.defaultValue==null&&i.defaultValue!==a&&(i.defaultValue=a)),c!=null&&(i.defaultValue=""+c)}function jb(i){var e=i.textContent;e===i._wrapperState.initialValue&&e!==""&&e!==null&&(i.value=e)}function kb(i){switch(i){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function lb(i,e){return i==null||i==="http://www.w3.org/1999/xhtml"?kb(e):i==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":i}var mb,nb=function(i){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,a,c,h){MSApp.execUnsafeLocalFunction(function(){return i(e,a,c,h)})}:i}(function(i,e){if(i.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in i)i.innerHTML=e;else{for(mb=mb||document.createElement("div"),mb.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=mb.firstChild;i.firstChild;)i.removeChild(i.firstChild);for(;e.firstChild;)i.appendChild(e.firstChild)}});function ob(i,e){if(e){var a=i.firstChild;if(a&&a===i.lastChild&&a.nodeType===3){a.nodeValue=e;return}}i.textContent=e}var pb={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},qb=["Webkit","ms","Moz","O"];Object.keys(pb).forEach(function(i){qb.forEach(function(e){e=e+i.charAt(0).toUpperCase()+i.substring(1),pb[e]=pb[i]})});function rb(i,e,a){return e==null||typeof e=="boolean"||e===""?"":a||typeof e!="number"||e===0||pb.hasOwnProperty(i)&&pb[i]?(""+e).trim():e+"px"}function sb(i,e){i=i.style;for(var a in e)if(e.hasOwnProperty(a)){var c=a.indexOf("--")===0,h=rb(a,e[a],c);a==="float"&&(a="cssFloat"),c?i.setProperty(a,h):i[a]=h}}var tb=A$1({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ub(i,e){if(e){if(tb[i]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(p(137,i));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(p(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(p(61))}if(e.style!=null&&typeof e.style!="object")throw Error(p(62))}}function vb(i,e){if(i.indexOf("-")===-1)return typeof e.is=="string";switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var wb=null;function xb(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var yb=null,zb$1=null,Ab=null;function Bb(i){if(i=Cb(i)){if(typeof yb!="function")throw Error(p(280));var e=i.stateNode;e&&(e=Db(e),yb(i.stateNode,i.type,e))}}function Eb(i){zb$1?Ab?Ab.push(i):Ab=[i]:zb$1=i}function Fb(){if(zb$1){var i=zb$1,e=Ab;if(Ab=zb$1=null,Bb(i),e)for(i=0;i<e.length;i++)Bb(e[i])}}function Gb$1(i,e){return i(e)}function Hb(){}var Ib=!1;function Jb$1(i,e,a){if(Ib)return i(e,a);Ib=!0;try{return Gb$1(i,e,a)}finally{Ib=!1,(zb$1!==null||Ab!==null)&&(Hb(),Fb())}}function Kb$1(i,e){var a=i.stateNode;if(a===null)return null;var c=Db(a);if(c===null)return null;a=c[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(c=!c.disabled)||(i=i.type,c=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!c;break e;default:i=!1}if(i)return null;if(a&&typeof a!="function")throw Error(p(231,e,typeof a));return a}var Lb=!1;if(ia)try{var Mb={};Object.defineProperty(Mb,"passive",{get:function(){Lb=!0}}),window.addEventListener("test",Mb,Mb),window.removeEventListener("test",Mb,Mb)}catch{Lb=!1}function Nb$1(i,e,a,c,h,d,et,ft,gt){var _t=Array.prototype.slice.call(arguments,3);try{e.apply(a,_t)}catch(wt){this.onError(wt)}}var Ob=!1,Pb=null,Qb$1=!1,Rb=null,Sb={onError:function(i){Ob=!0,Pb=i}};function Tb(i,e,a,c,h,d,et,ft,gt){Ob=!1,Pb=null,Nb$1.apply(Sb,arguments)}function Ub(i,e,a,c,h,d,et,ft,gt){if(Tb.apply(this,arguments),Ob){if(Ob){var _t=Pb;Ob=!1,Pb=null}else throw Error(p(198));Qb$1||(Qb$1=!0,Rb=_t)}}function Vb$1(i){var e=i,a=i;if(i.alternate)for(;e.return;)e=e.return;else{i=e;do e=i,e.flags&4098&&(a=e.return),i=e.return;while(i)}return e.tag===3?a:null}function Wb(i){if(i.tag===13){var e=i.memoizedState;if(e===null&&(i=i.alternate,i!==null&&(e=i.memoizedState)),e!==null)return e.dehydrated}return null}function Xb(i){if(Vb$1(i)!==i)throw Error(p(188))}function Yb$1(i){var e=i.alternate;if(!e){if(e=Vb$1(i),e===null)throw Error(p(188));return e!==i?null:i}for(var a=i,c=e;;){var h=a.return;if(h===null)break;var d=h.alternate;if(d===null){if(c=h.return,c!==null){a=c;continue}break}if(h.child===d.child){for(d=h.child;d;){if(d===a)return Xb(h),i;if(d===c)return Xb(h),e;d=d.sibling}throw Error(p(188))}if(a.return!==c.return)a=h,c=d;else{for(var et=!1,ft=h.child;ft;){if(ft===a){et=!0,a=h,c=d;break}if(ft===c){et=!0,c=h,a=d;break}ft=ft.sibling}if(!et){for(ft=d.child;ft;){if(ft===a){et=!0,a=d,c=h;break}if(ft===c){et=!0,c=d,a=h;break}ft=ft.sibling}if(!et)throw Error(p(189))}}if(a.alternate!==c)throw Error(p(190))}if(a.tag!==3)throw Error(p(188));return a.stateNode.current===a?i:e}function Zb(i){return i=Yb$1(i),i!==null?$b(i):null}function $b(i){if(i.tag===5||i.tag===6)return i;for(i=i.child;i!==null;){var e=$b(i);if(e!==null)return e;i=i.sibling}return null}var ac=ca.unstable_scheduleCallback,bc$1=ca.unstable_cancelCallback,cc=ca.unstable_shouldYield,dc=ca.unstable_requestPaint,B$2=ca.unstable_now,ec$1=ca.unstable_getCurrentPriorityLevel,fc=ca.unstable_ImmediatePriority,gc$1=ca.unstable_UserBlockingPriority,hc$1=ca.unstable_NormalPriority,ic$1=ca.unstable_LowPriority,jc=ca.unstable_IdlePriority,kc$1=null,lc=null;function mc$1(i){if(lc&&typeof lc.onCommitFiberRoot=="function")try{lc.onCommitFiberRoot(kc$1,i,void 0,(i.current.flags&128)===128)}catch{}}var oc=Math.clz32?Math.clz32:nc$1,pc=Math.log,qc=Math.LN2;function nc$1(i){return i>>>=0,i===0?32:31-(pc(i)/qc|0)|0}var rc$1=64,sc=4194304;function tc$1(i){switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return i&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return i}}function uc(i,e){var a=i.pendingLanes;if(a===0)return 0;var c=0,h=i.suspendedLanes,d=i.pingedLanes,et=a&268435455;if(et!==0){var ft=et&~h;ft!==0?c=tc$1(ft):(d&=et,d!==0&&(c=tc$1(d)))}else et=a&~h,et!==0?c=tc$1(et):d!==0&&(c=tc$1(d));if(c===0)return 0;if(e!==0&&e!==c&&!(e&h)&&(h=c&-c,d=e&-e,h>=d||h===16&&(d&4194240)!==0))return e;if(c&4&&(c|=a&16),e=i.entangledLanes,e!==0)for(i=i.entanglements,e&=c;0<e;)a=31-oc(e),h=1<<a,c|=i[a],e&=~h;return c}function vc$1(i,e){switch(i){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function wc$1(i,e){for(var a=i.suspendedLanes,c=i.pingedLanes,h=i.expirationTimes,d=i.pendingLanes;0<d;){var et=31-oc(d),ft=1<<et,gt=h[et];gt===-1?(!(ft&a)||ft&c)&&(h[et]=vc$1(ft,e)):gt<=e&&(i.expiredLanes|=ft),d&=~ft}}function xc$1(i){return i=i.pendingLanes&-1073741825,i!==0?i:i&1073741824?1073741824:0}function yc$1(){var i=rc$1;return rc$1<<=1,!(rc$1&4194240)&&(rc$1=64),i}function zc(i){for(var e=[],a=0;31>a;a++)e.push(i);return e}function Ac$1(i,e,a){i.pendingLanes|=e,e!==536870912&&(i.suspendedLanes=0,i.pingedLanes=0),i=i.eventTimes,e=31-oc(e),i[e]=a}function Bc$1(i,e){var a=i.pendingLanes&~e;i.pendingLanes=e,i.suspendedLanes=0,i.pingedLanes=0,i.expiredLanes&=e,i.mutableReadLanes&=e,i.entangledLanes&=e,e=i.entanglements;var c=i.eventTimes;for(i=i.expirationTimes;0<a;){var h=31-oc(a),d=1<<h;e[h]=0,c[h]=-1,i[h]=-1,a&=~d}}function Cc$1(i,e){var a=i.entangledLanes|=e;for(i=i.entanglements;a;){var c=31-oc(a),h=1<<c;h&e|i[c]&e&&(i[c]|=e),a&=~h}}var C$1=0;function Dc(i){return i&=-i,1<i?4<i?i&268435455?16:536870912:4:1}var Ec$1,Fc,Gc,Hc,Ic$1,Jc=!1,Kc=[],Lc$1=null,Mc$1=null,Nc=null,Oc$1=new Map,Pc$1=new Map,Qc=[],Rc$1="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Sc$1(i,e){switch(i){case"focusin":case"focusout":Lc$1=null;break;case"dragenter":case"dragleave":Mc$1=null;break;case"mouseover":case"mouseout":Nc=null;break;case"pointerover":case"pointerout":Oc$1.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pc$1.delete(e.pointerId)}}function Tc$1(i,e,a,c,h,d){return i===null||i.nativeEvent!==d?(i={blockedOn:e,domEventName:a,eventSystemFlags:c,nativeEvent:d,targetContainers:[h]},e!==null&&(e=Cb(e),e!==null&&Fc(e)),i):(i.eventSystemFlags|=c,e=i.targetContainers,h!==null&&e.indexOf(h)===-1&&e.push(h),i)}function Uc(i,e,a,c,h){switch(e){case"focusin":return Lc$1=Tc$1(Lc$1,i,e,a,c,h),!0;case"dragenter":return Mc$1=Tc$1(Mc$1,i,e,a,c,h),!0;case"mouseover":return Nc=Tc$1(Nc,i,e,a,c,h),!0;case"pointerover":var d=h.pointerId;return Oc$1.set(d,Tc$1(Oc$1.get(d)||null,i,e,a,c,h)),!0;case"gotpointercapture":return d=h.pointerId,Pc$1.set(d,Tc$1(Pc$1.get(d)||null,i,e,a,c,h)),!0}return!1}function Vc(i){var e=Wc(i.target);if(e!==null){var a=Vb$1(e);if(a!==null){if(e=a.tag,e===13){if(e=Wb(a),e!==null){i.blockedOn=e,Ic$1(i.priority,function(){Gc(a)});return}}else if(e===3&&a.stateNode.current.memoizedState.isDehydrated){i.blockedOn=a.tag===3?a.stateNode.containerInfo:null;return}}}i.blockedOn=null}function Xc(i){if(i.blockedOn!==null)return!1;for(var e=i.targetContainers;0<e.length;){var a=Yc(i.domEventName,i.eventSystemFlags,e[0],i.nativeEvent);if(a===null){a=i.nativeEvent;var c=new a.constructor(a.type,a);wb=c,a.target.dispatchEvent(c),wb=null}else return e=Cb(a),e!==null&&Fc(e),i.blockedOn=a,!1;e.shift()}return!0}function Zc(i,e,a){Xc(i)&&a.delete(e)}function $c(){Jc=!1,Lc$1!==null&&Xc(Lc$1)&&(Lc$1=null),Mc$1!==null&&Xc(Mc$1)&&(Mc$1=null),Nc!==null&&Xc(Nc)&&(Nc=null),Oc$1.forEach(Zc),Pc$1.forEach(Zc)}function ad(i,e){i.blockedOn===e&&(i.blockedOn=null,Jc||(Jc=!0,ca.unstable_scheduleCallback(ca.unstable_NormalPriority,$c)))}function bd(i){function e(h){return ad(h,i)}if(0<Kc.length){ad(Kc[0],i);for(var a=1;a<Kc.length;a++){var c=Kc[a];c.blockedOn===i&&(c.blockedOn=null)}}for(Lc$1!==null&&ad(Lc$1,i),Mc$1!==null&&ad(Mc$1,i),Nc!==null&&ad(Nc,i),Oc$1.forEach(e),Pc$1.forEach(e),a=0;a<Qc.length;a++)c=Qc[a],c.blockedOn===i&&(c.blockedOn=null);for(;0<Qc.length&&(a=Qc[0],a.blockedOn===null);)Vc(a),a.blockedOn===null&&Qc.shift()}var cd$1=ua.ReactCurrentBatchConfig,dd=!0;function ed(i,e,a,c){var h=C$1,d=cd$1.transition;cd$1.transition=null;try{C$1=1,fd(i,e,a,c)}finally{C$1=h,cd$1.transition=d}}function gd(i,e,a,c){var h=C$1,d=cd$1.transition;cd$1.transition=null;try{C$1=4,fd(i,e,a,c)}finally{C$1=h,cd$1.transition=d}}function fd(i,e,a,c){if(dd){var h=Yc(i,e,a,c);if(h===null)hd(i,e,c,id,a),Sc$1(i,c);else if(Uc(h,i,e,a,c))c.stopPropagation();else if(Sc$1(i,c),e&4&&-1<Rc$1.indexOf(i)){for(;h!==null;){var d=Cb(h);if(d!==null&&Ec$1(d),d=Yc(i,e,a,c),d===null&&hd(i,e,c,id,a),d===h)break;h=d}h!==null&&c.stopPropagation()}else hd(i,e,c,null,a)}}var id=null;function Yc(i,e,a,c){if(id=null,i=xb(c),i=Wc(i),i!==null)if(e=Vb$1(i),e===null)i=null;else if(a=e.tag,a===13){if(i=Wb(e),i!==null)return i;i=null}else if(a===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;i=null}else e!==i&&(i=null);return id=i,null}function jd$1(i){switch(i){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ec$1()){case fc:return 1;case gc$1:return 4;case hc$1:case ic$1:return 16;case jc:return 536870912;default:return 16}default:return 16}}var kd=null,ld$1=null,md=null;function nd(){if(md)return md;var i,e=ld$1,a=e.length,c,h="value"in kd?kd.value:kd.textContent,d=h.length;for(i=0;i<a&&e[i]===h[i];i++);var et=a-i;for(c=1;c<=et&&e[a-c]===h[d-c];c++);return md=h.slice(i,1<c?1-c:void 0)}function od(i){var e=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&e===13&&(i=13)):i=e,i===10&&(i=13),32<=i||i===13?i:0}function pd$1(){return!0}function qd$1(){return!1}function rd(i){function e(a,c,h,d,et){this._reactName=a,this._targetInst=h,this.type=c,this.nativeEvent=d,this.target=et,this.currentTarget=null;for(var ft in i)i.hasOwnProperty(ft)&&(a=i[ft],this[ft]=a?a(d):d[ft]);return this.isDefaultPrevented=(d.defaultPrevented!=null?d.defaultPrevented:d.returnValue===!1)?pd$1:qd$1,this.isPropagationStopped=qd$1,this}return A$1(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():typeof a.returnValue!="unknown"&&(a.returnValue=!1),this.isDefaultPrevented=pd$1)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():typeof a.cancelBubble!="unknown"&&(a.cancelBubble=!0),this.isPropagationStopped=pd$1)},persist:function(){},isPersistent:pd$1}),e}var sd$1={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},td=rd(sd$1),ud$1=A$1({},sd$1,{view:0,detail:0}),vd=rd(ud$1),wd,xd,yd$1,Ad$1=A$1({},ud$1,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:zd$1,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==yd$1&&(yd$1&&i.type==="mousemove"?(wd=i.screenX-yd$1.screenX,xd=i.screenY-yd$1.screenY):xd=wd=0,yd$1=i),wd)},movementY:function(i){return"movementY"in i?i.movementY:xd}}),Bd=rd(Ad$1),Cd=A$1({},Ad$1,{dataTransfer:0}),Dd=rd(Cd),Ed=A$1({},ud$1,{relatedTarget:0}),Fd=rd(Ed),Gd=A$1({},sd$1,{animationName:0,elapsedTime:0,pseudoElement:0}),Hd$1=rd(Gd),Id=A$1({},sd$1,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),Jd$1=rd(Id),Kd=A$1({},sd$1,{data:0}),Ld$1=rd(Kd),Md={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Nd={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Od={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Pd(i){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(i):(i=Od[i])?!!e[i]:!1}function zd$1(){return Pd}var Qd=A$1({},ud$1,{key:function(i){if(i.key){var e=Md[i.key]||i.key;if(e!=="Unidentified")return e}return i.type==="keypress"?(i=od(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?Nd[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:zd$1,charCode:function(i){return i.type==="keypress"?od(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?od(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),Rd=rd(Qd),Sd$1=A$1({},Ad$1,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Td=rd(Sd$1),Ud$1=A$1({},ud$1,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:zd$1}),Vd=rd(Ud$1),Wd$1=A$1({},sd$1,{propertyName:0,elapsedTime:0,pseudoElement:0}),Xd$1=rd(Wd$1),Yd=A$1({},Ad$1,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),Zd$1=rd(Yd),$d=[9,13,27,32],ae$1=ia&&"CompositionEvent"in window,be$2=null;ia&&"documentMode"in document&&(be$2=document.documentMode);var ce$2=ia&&"TextEvent"in window&&!be$2,de=ia&&(!ae$1||be$2&&8<be$2&&11>=be$2),ee$1=" ",fe$3=!1;function ge$2(i,e){switch(i){case"keyup":return $d.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function he$1(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var ie$1=!1;function je$1(i,e){switch(i){case"compositionend":return he$1(e);case"keypress":return e.which!==32?null:(fe$3=!0,ee$1);case"textInput":return i=e.data,i===ee$1&&fe$3?null:i;default:return null}}function ke$2(i,e){if(ie$1)return i==="compositionend"||!ae$1&&ge$2(i,e)?(i=nd(),md=ld$1=kd=null,ie$1=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return de&&e.locale!=="ko"?null:e.data;default:return null}}var le$1={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function me$2(i){var e=i&&i.nodeName&&i.nodeName.toLowerCase();return e==="input"?!!le$1[i.type]:e==="textarea"}function ne$2(i,e,a,c){Eb(c),e=oe$1(e,"onChange"),0<e.length&&(a=new td("onChange","change",null,a,c),i.push({event:a,listeners:e}))}var pe=null,qe$1=null;function re$2(i){se$1(i,0)}function te$1(i){var e=ue$1(i);if(Wa(e))return i}function ve$2(i,e){if(i==="change")return e}var we$2=!1;if(ia){var xe$1;if(ia){var ye$2="oninput"in document;if(!ye$2){var ze=document.createElement("div");ze.setAttribute("oninput","return;"),ye$2=typeof ze.oninput=="function"}xe$1=ye$2}else xe$1=!1;we$2=xe$1&&(!document.documentMode||9<document.documentMode)}function Ae$1(){pe&&(pe.detachEvent("onpropertychange",Be$2),qe$1=pe=null)}function Be$2(i){if(i.propertyName==="value"&&te$1(qe$1)){var e=[];ne$2(e,qe$1,i,xb(i)),Jb$1(re$2,e)}}function Ce$1(i,e,a){i==="focusin"?(Ae$1(),pe=e,qe$1=a,pe.attachEvent("onpropertychange",Be$2)):i==="focusout"&&Ae$1()}function De$1(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return te$1(qe$1)}function Ee$1(i,e){if(i==="click")return te$1(e)}function Fe$2(i,e){if(i==="input"||i==="change")return te$1(e)}function Ge$1(i,e){return i===e&&(i!==0||1/i===1/e)||i!==i&&e!==e}var He$1=typeof Object.is=="function"?Object.is:Ge$1;function Ie$1(i,e){if(He$1(i,e))return!0;if(typeof i!="object"||i===null||typeof e!="object"||e===null)return!1;var a=Object.keys(i),c=Object.keys(e);if(a.length!==c.length)return!1;for(c=0;c<a.length;c++){var h=a[c];if(!ja.call(e,h)||!He$1(i[h],e[h]))return!1}return!0}function Je$2(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function Ke$1(i,e){var a=Je$2(i);i=0;for(var c;a;){if(a.nodeType===3){if(c=i+a.textContent.length,i<=e&&c>=e)return{node:a,offset:e-i};i=c}e:{for(;a;){if(a.nextSibling){a=a.nextSibling;break e}a=a.parentNode}a=void 0}a=Je$2(a)}}function Le(i,e){return i&&e?i===e?!0:i&&i.nodeType===3?!1:e&&e.nodeType===3?Le(i,e.parentNode):"contains"in i?i.contains(e):i.compareDocumentPosition?!!(i.compareDocumentPosition(e)&16):!1:!1}function Me$2(){for(var i=window,e=Xa$1();e instanceof i.HTMLIFrameElement;){try{var a=typeof e.contentWindow.location.href=="string"}catch{a=!1}if(a)i=e.contentWindow;else break;e=Xa$1(i.document)}return e}function Ne$1(i){var e=i&&i.nodeName&&i.nodeName.toLowerCase();return e&&(e==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||e==="textarea"||i.contentEditable==="true")}function Oe$1(i){var e=Me$2(),a=i.focusedElem,c=i.selectionRange;if(e!==a&&a&&a.ownerDocument&&Le(a.ownerDocument.documentElement,a)){if(c!==null&&Ne$1(a)){if(e=c.start,i=c.end,i===void 0&&(i=e),"selectionStart"in a)a.selectionStart=e,a.selectionEnd=Math.min(i,a.value.length);else if(i=(e=a.ownerDocument||document)&&e.defaultView||window,i.getSelection){i=i.getSelection();var h=a.textContent.length,d=Math.min(c.start,h);c=c.end===void 0?d:Math.min(c.end,h),!i.extend&&d>c&&(h=c,c=d,d=h),h=Ke$1(a,d);var et=Ke$1(a,c);h&&et&&(i.rangeCount!==1||i.anchorNode!==h.node||i.anchorOffset!==h.offset||i.focusNode!==et.node||i.focusOffset!==et.offset)&&(e=e.createRange(),e.setStart(h.node,h.offset),i.removeAllRanges(),d>c?(i.addRange(e),i.extend(et.node,et.offset)):(e.setEnd(et.node,et.offset),i.addRange(e)))}}for(e=[],i=a;i=i.parentNode;)i.nodeType===1&&e.push({element:i,left:i.scrollLeft,top:i.scrollTop});for(typeof a.focus=="function"&&a.focus(),a=0;a<e.length;a++)i=e[a],i.element.scrollLeft=i.left,i.element.scrollTop=i.top}}var Pe$2=ia&&"documentMode"in document&&11>=document.documentMode,Qe=null,Re$1=null,Se$2=null,Te$1=!1;function Ue$1(i,e,a){var c=a.window===a?a.document:a.nodeType===9?a:a.ownerDocument;Te$1||Qe==null||Qe!==Xa$1(c)||(c=Qe,"selectionStart"in c&&Ne$1(c)?c={start:c.selectionStart,end:c.selectionEnd}:(c=(c.ownerDocument&&c.ownerDocument.defaultView||window).getSelection(),c={anchorNode:c.anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset}),Se$2&&Ie$1(Se$2,c)||(Se$2=c,c=oe$1(Re$1,"onSelect"),0<c.length&&(e=new td("onSelect","select",null,e,a),i.push({event:e,listeners:c}),e.target=Qe)))}function Ve$1(i,e){var a={};return a[i.toLowerCase()]=e.toLowerCase(),a["Webkit"+i]="webkit"+e,a["Moz"+i]="moz"+e,a}var We$1={animationend:Ve$1("Animation","AnimationEnd"),animationiteration:Ve$1("Animation","AnimationIteration"),animationstart:Ve$1("Animation","AnimationStart"),transitionend:Ve$1("Transition","TransitionEnd")},Xe$1={},Ye$1={};ia&&(Ye$1=document.createElement("div").style,"AnimationEvent"in window||(delete We$1.animationend.animation,delete We$1.animationiteration.animation,delete We$1.animationstart.animation),"TransitionEvent"in window||delete We$1.transitionend.transition);function Ze$1(i){if(Xe$1[i])return Xe$1[i];if(!We$1[i])return i;var e=We$1[i],a;for(a in e)if(e.hasOwnProperty(a)&&a in Ye$1)return Xe$1[i]=e[a];return i}var $e$1=Ze$1("animationend"),af=Ze$1("animationiteration"),bf=Ze$1("animationstart"),cf=Ze$1("transitionend"),df=new Map,ef="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ff(i,e){df.set(i,e),fa(e,[i])}for(var gf=0;gf<ef.length;gf++){var hf=ef[gf],jf=hf.toLowerCase(),kf=hf[0].toUpperCase()+hf.slice(1);ff(jf,"on"+kf)}ff($e$1,"onAnimationEnd");ff(af,"onAnimationIteration");ff(bf,"onAnimationStart");ff("dblclick","onDoubleClick");ff("focusin","onFocus");ff("focusout","onBlur");ff(cf,"onTransitionEnd");ha("onMouseEnter",["mouseout","mouseover"]);ha("onMouseLeave",["mouseout","mouseover"]);ha("onPointerEnter",["pointerout","pointerover"]);ha("onPointerLeave",["pointerout","pointerover"]);fa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));fa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));fa("onBeforeInput",["compositionend","keypress","textInput","paste"]);fa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));fa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));fa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var lf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),mf=new Set("cancel close invalid load scroll toggle".split(" ").concat(lf));function nf(i,e,a){var c=i.type||"unknown-event";i.currentTarget=a,Ub(c,e,void 0,i),i.currentTarget=null}function se$1(i,e){e=(e&4)!==0;for(var a=0;a<i.length;a++){var c=i[a],h=c.event;c=c.listeners;e:{var d=void 0;if(e)for(var et=c.length-1;0<=et;et--){var ft=c[et],gt=ft.instance,_t=ft.currentTarget;if(ft=ft.listener,gt!==d&&h.isPropagationStopped())break e;nf(h,ft,_t),d=gt}else for(et=0;et<c.length;et++){if(ft=c[et],gt=ft.instance,_t=ft.currentTarget,ft=ft.listener,gt!==d&&h.isPropagationStopped())break e;nf(h,ft,_t),d=gt}}}if(Qb$1)throw i=Rb,Qb$1=!1,Rb=null,i}function D$1(i,e){var a=e[of];a===void 0&&(a=e[of]=new Set);var c=i+"__bubble";a.has(c)||(pf(e,i,2,!1),a.add(c))}function qf(i,e,a){var c=0;e&&(c|=4),pf(a,i,c,e)}var rf="_reactListening"+Math.random().toString(36).slice(2);function sf(i){if(!i[rf]){i[rf]=!0,da.forEach(function(a){a!=="selectionchange"&&(mf.has(a)||qf(a,!1,i),qf(a,!0,i))});var e=i.nodeType===9?i:i.ownerDocument;e===null||e[rf]||(e[rf]=!0,qf("selectionchange",!1,e))}}function pf(i,e,a,c){switch(jd$1(e)){case 1:var h=ed;break;case 4:h=gd;break;default:h=fd}a=h.bind(null,e,a,i),h=void 0,!Lb||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(h=!0),c?h!==void 0?i.addEventListener(e,a,{capture:!0,passive:h}):i.addEventListener(e,a,!0):h!==void 0?i.addEventListener(e,a,{passive:h}):i.addEventListener(e,a,!1)}function hd(i,e,a,c,h){var d=c;if(!(e&1)&&!(e&2)&&c!==null)e:for(;;){if(c===null)return;var et=c.tag;if(et===3||et===4){var ft=c.stateNode.containerInfo;if(ft===h||ft.nodeType===8&&ft.parentNode===h)break;if(et===4)for(et=c.return;et!==null;){var gt=et.tag;if((gt===3||gt===4)&&(gt=et.stateNode.containerInfo,gt===h||gt.nodeType===8&&gt.parentNode===h))return;et=et.return}for(;ft!==null;){if(et=Wc(ft),et===null)return;if(gt=et.tag,gt===5||gt===6){c=d=et;continue e}ft=ft.parentNode}}c=c.return}Jb$1(function(){var _t=d,wt=xb(a),$t=[];e:{var It=df.get(i);if(It!==void 0){var Rt=td,Tt=i;switch(i){case"keypress":if(od(a)===0)break e;case"keydown":case"keyup":Rt=Rd;break;case"focusin":Tt="focus",Rt=Fd;break;case"focusout":Tt="blur",Rt=Fd;break;case"beforeblur":case"afterblur":Rt=Fd;break;case"click":if(a.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Rt=Bd;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Rt=Dd;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Rt=Vd;break;case $e$1:case af:case bf:Rt=Hd$1;break;case cf:Rt=Xd$1;break;case"scroll":Rt=vd;break;case"wheel":Rt=Zd$1;break;case"copy":case"cut":case"paste":Rt=Jd$1;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Rt=Td}var At=(e&4)!==0,kt=!At&&i==="scroll",xt=At?It!==null?It+"Capture":null:It;At=[];for(var Nt=_t,Ft;Nt!==null;){Ft=Nt;var jt=Ft.stateNode;if(Ft.tag===5&&jt!==null&&(Ft=jt,xt!==null&&(jt=Kb$1(Nt,xt),jt!=null&&At.push(tf(Nt,jt,Ft)))),kt)break;Nt=Nt.return}0<At.length&&(It=new Rt(It,Tt,null,a,wt),$t.push({event:It,listeners:At}))}}if(!(e&7)){e:{if(It=i==="mouseover"||i==="pointerover",Rt=i==="mouseout"||i==="pointerout",It&&a!==wb&&(Tt=a.relatedTarget||a.fromElement)&&(Wc(Tt)||Tt[uf]))break e;if((Rt||It)&&(It=wt.window===wt?wt:(It=wt.ownerDocument)?It.defaultView||It.parentWindow:window,Rt?(Tt=a.relatedTarget||a.toElement,Rt=_t,Tt=Tt?Wc(Tt):null,Tt!==null&&(kt=Vb$1(Tt),Tt!==kt||Tt.tag!==5&&Tt.tag!==6)&&(Tt=null)):(Rt=null,Tt=_t),Rt!==Tt)){if(At=Bd,jt="onMouseLeave",xt="onMouseEnter",Nt="mouse",(i==="pointerout"||i==="pointerover")&&(At=Td,jt="onPointerLeave",xt="onPointerEnter",Nt="pointer"),kt=Rt==null?It:ue$1(Rt),Ft=Tt==null?It:ue$1(Tt),It=new At(jt,Nt+"leave",Rt,a,wt),It.target=kt,It.relatedTarget=Ft,jt=null,Wc(wt)===_t&&(At=new At(xt,Nt+"enter",Tt,a,wt),At.target=Ft,At.relatedTarget=kt,jt=At),kt=jt,Rt&&Tt)t:{for(At=Rt,xt=Tt,Nt=0,Ft=At;Ft;Ft=vf(Ft))Nt++;for(Ft=0,jt=xt;jt;jt=vf(jt))Ft++;for(;0<Nt-Ft;)At=vf(At),Nt--;for(;0<Ft-Nt;)xt=vf(xt),Ft--;for(;Nt--;){if(At===xt||xt!==null&&At===xt.alternate)break t;At=vf(At),xt=vf(xt)}At=null}else At=null;Rt!==null&&wf($t,It,Rt,At,!1),Tt!==null&&kt!==null&&wf($t,kt,Tt,At,!0)}}e:{if(It=_t?ue$1(_t):window,Rt=It.nodeName&&It.nodeName.toLowerCase(),Rt==="select"||Rt==="input"&&It.type==="file")var Gt=ve$2;else if(me$2(It))if(we$2)Gt=Fe$2;else{Gt=De$1;var Kt=Ce$1}else(Rt=It.nodeName)&&Rt.toLowerCase()==="input"&&(It.type==="checkbox"||It.type==="radio")&&(Gt=Ee$1);if(Gt&&(Gt=Gt(i,_t))){ne$2($t,Gt,a,wt);break e}Kt&&Kt(i,It,_t),i==="focusout"&&(Kt=It._wrapperState)&&Kt.controlled&&It.type==="number"&&cb(It,"number",It.value)}switch(Kt=_t?ue$1(_t):window,i){case"focusin":(me$2(Kt)||Kt.contentEditable==="true")&&(Qe=Kt,Re$1=_t,Se$2=null);break;case"focusout":Se$2=Re$1=Qe=null;break;case"mousedown":Te$1=!0;break;case"contextmenu":case"mouseup":case"dragend":Te$1=!1,Ue$1($t,a,wt);break;case"selectionchange":if(Pe$2)break;case"keydown":case"keyup":Ue$1($t,a,wt)}var Wt;if(ae$1)e:{switch(i){case"compositionstart":var Zt="onCompositionStart";break e;case"compositionend":Zt="onCompositionEnd";break e;case"compositionupdate":Zt="onCompositionUpdate";break e}Zt=void 0}else ie$1?ge$2(i,a)&&(Zt="onCompositionEnd"):i==="keydown"&&a.keyCode===229&&(Zt="onCompositionStart");Zt&&(de&&a.locale!=="ko"&&(ie$1||Zt!=="onCompositionStart"?Zt==="onCompositionEnd"&&ie$1&&(Wt=nd()):(kd=wt,ld$1="value"in kd?kd.value:kd.textContent,ie$1=!0)),Kt=oe$1(_t,Zt),0<Kt.length&&(Zt=new Ld$1(Zt,i,null,a,wt),$t.push({event:Zt,listeners:Kt}),Wt?Zt.data=Wt:(Wt=he$1(a),Wt!==null&&(Zt.data=Wt)))),(Wt=ce$2?je$1(i,a):ke$2(i,a))&&(_t=oe$1(_t,"onBeforeInput"),0<_t.length&&(wt=new Ld$1("onBeforeInput","beforeinput",null,a,wt),$t.push({event:wt,listeners:_t}),wt.data=Wt))}se$1($t,e)})}function tf(i,e,a){return{instance:i,listener:e,currentTarget:a}}function oe$1(i,e){for(var a=e+"Capture",c=[];i!==null;){var h=i,d=h.stateNode;h.tag===5&&d!==null&&(h=d,d=Kb$1(i,a),d!=null&&c.unshift(tf(i,d,h)),d=Kb$1(i,e),d!=null&&c.push(tf(i,d,h))),i=i.return}return c}function vf(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5);return i||null}function wf(i,e,a,c,h){for(var d=e._reactName,et=[];a!==null&&a!==c;){var ft=a,gt=ft.alternate,_t=ft.stateNode;if(gt!==null&&gt===c)break;ft.tag===5&&_t!==null&&(ft=_t,h?(gt=Kb$1(a,d),gt!=null&&et.unshift(tf(a,gt,ft))):h||(gt=Kb$1(a,d),gt!=null&&et.push(tf(a,gt,ft)))),a=a.return}et.length!==0&&i.push({event:e,listeners:et})}var xf=/\r\n?/g,yf=/\u0000|\uFFFD/g;function zf(i){return(typeof i=="string"?i:""+i).replace(xf,`
`).replace(yf,"")}function Af(i,e,a){if(e=zf(e),zf(i)!==e&&a)throw Error(p(425))}function Bf(){}var Cf=null,Df=null;function Ef(i,e){return i==="textarea"||i==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Ff=typeof setTimeout=="function"?setTimeout:void 0,Gf$1=typeof clearTimeout=="function"?clearTimeout:void 0,Hf=typeof Promise=="function"?Promise:void 0,Jf$1=typeof queueMicrotask=="function"?queueMicrotask:typeof Hf<"u"?function(i){return Hf.resolve(null).then(i).catch(If)}:Ff;function If(i){setTimeout(function(){throw i})}function Kf(i,e){var a=e,c=0;do{var h=a.nextSibling;if(i.removeChild(a),h&&h.nodeType===8)if(a=h.data,a==="/$"){if(c===0){i.removeChild(h),bd(e);return}c--}else a!=="$"&&a!=="$?"&&a!=="$!"||c++;a=h}while(a);bd(e)}function Lf(i){for(;i!=null;i=i.nextSibling){var e=i.nodeType;if(e===1||e===3)break;if(e===8){if(e=i.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return i}function Mf(i){i=i.previousSibling;for(var e=0;i;){if(i.nodeType===8){var a=i.data;if(a==="$"||a==="$!"||a==="$?"){if(e===0)return i;e--}else a==="/$"&&e++}i=i.previousSibling}return null}var Nf=Math.random().toString(36).slice(2),Of="__reactFiber$"+Nf,Pf="__reactProps$"+Nf,uf="__reactContainer$"+Nf,of="__reactEvents$"+Nf,Qf$1="__reactListeners$"+Nf,Rf="__reactHandles$"+Nf;function Wc(i){var e=i[Of];if(e)return e;for(var a=i.parentNode;a;){if(e=a[uf]||a[Of]){if(a=e.alternate,e.child!==null||a!==null&&a.child!==null)for(i=Mf(i);i!==null;){if(a=i[Of])return a;i=Mf(i)}return e}i=a,a=i.parentNode}return null}function Cb(i){return i=i[Of]||i[uf],!i||i.tag!==5&&i.tag!==6&&i.tag!==13&&i.tag!==3?null:i}function ue$1(i){if(i.tag===5||i.tag===6)return i.stateNode;throw Error(p(33))}function Db(i){return i[Pf]||null}var Sf=[],Tf=-1;function Uf(i){return{current:i}}function E(i){0>Tf||(i.current=Sf[Tf],Sf[Tf]=null,Tf--)}function G$1(i,e){Tf++,Sf[Tf]=i.current,i.current=e}var Vf={},H$1=Uf(Vf),Wf=Uf(!1),Xf$1=Vf;function Yf$1(i,e){var a=i.type.contextTypes;if(!a)return Vf;var c=i.stateNode;if(c&&c.__reactInternalMemoizedUnmaskedChildContext===e)return c.__reactInternalMemoizedMaskedChildContext;var h={},d;for(d in a)h[d]=e[d];return c&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=e,i.__reactInternalMemoizedMaskedChildContext=h),h}function Zf$1(i){return i=i.childContextTypes,i!=null}function $f(){E(Wf),E(H$1)}function ag$1(i,e,a){if(H$1.current!==Vf)throw Error(p(168));G$1(H$1,e),G$1(Wf,a)}function bg(i,e,a){var c=i.stateNode;if(e=e.childContextTypes,typeof c.getChildContext!="function")return a;c=c.getChildContext();for(var h in c)if(!(h in e))throw Error(p(108,Ra(i)||"Unknown",h));return A$1({},a,c)}function cg$1(i){return i=(i=i.stateNode)&&i.__reactInternalMemoizedMergedChildContext||Vf,Xf$1=H$1.current,G$1(H$1,i),G$1(Wf,Wf.current),!0}function dg$1(i,e,a){var c=i.stateNode;if(!c)throw Error(p(169));a?(i=bg(i,e,Xf$1),c.__reactInternalMemoizedMergedChildContext=i,E(Wf),E(H$1),G$1(H$1,i)):E(Wf),G$1(Wf,a)}var eg$1=null,fg$1=!1,gg$1=!1;function hg$1(i){eg$1===null?eg$1=[i]:eg$1.push(i)}function ig$1(i){fg$1=!0,hg$1(i)}function jg(){if(!gg$1&&eg$1!==null){gg$1=!0;var i=0,e=C$1;try{var a=eg$1;for(C$1=1;i<a.length;i++){var c=a[i];do c=c(!0);while(c!==null)}eg$1=null,fg$1=!1}catch(h){throw eg$1!==null&&(eg$1=eg$1.slice(i+1)),ac(fc,jg),h}finally{C$1=e,gg$1=!1}}return null}var kg=[],lg$1=0,mg=null,ng$1=0,og$1=[],pg=0,qg=null,rg$1=1,sg$1="";function tg$1(i,e){kg[lg$1++]=ng$1,kg[lg$1++]=mg,mg=i,ng$1=e}function ug$1(i,e,a){og$1[pg++]=rg$1,og$1[pg++]=sg$1,og$1[pg++]=qg,qg=i;var c=rg$1;i=sg$1;var h=32-oc(c)-1;c&=~(1<<h),a+=1;var d=32-oc(e)+h;if(30<d){var et=h-h%5;d=(c&(1<<et)-1).toString(32),c>>=et,h-=et,rg$1=1<<32-oc(e)+h|a<<h|c,sg$1=d+i}else rg$1=1<<d|a<<h|c,sg$1=i}function vg$1(i){i.return!==null&&(tg$1(i,1),ug$1(i,1,0))}function wg(i){for(;i===mg;)mg=kg[--lg$1],kg[lg$1]=null,ng$1=kg[--lg$1],kg[lg$1]=null;for(;i===qg;)qg=og$1[--pg],og$1[pg]=null,sg$1=og$1[--pg],og$1[pg]=null,rg$1=og$1[--pg],og$1[pg]=null}var xg=null,yg$1=null,I$1=!1,zg$1=null;function Ag(i,e){var a=Bg(5,null,null,0);a.elementType="DELETED",a.stateNode=e,a.return=i,e=i.deletions,e===null?(i.deletions=[a],i.flags|=16):e.push(a)}function Cg$1(i,e){switch(i.tag){case 5:var a=i.type;return e=e.nodeType!==1||a.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(i.stateNode=e,xg=i,yg$1=Lf(e.firstChild),!0):!1;case 6:return e=i.pendingProps===""||e.nodeType!==3?null:e,e!==null?(i.stateNode=e,xg=i,yg$1=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(a=qg!==null?{id:rg$1,overflow:sg$1}:null,i.memoizedState={dehydrated:e,treeContext:a,retryLane:1073741824},a=Bg(18,null,null,0),a.stateNode=e,a.return=i,i.child=a,xg=i,yg$1=null,!0):!1;default:return!1}}function Dg(i){return(i.mode&1)!==0&&(i.flags&128)===0}function Eg(i){if(I$1){var e=yg$1;if(e){var a=e;if(!Cg$1(i,e)){if(Dg(i))throw Error(p(418));e=Lf(a.nextSibling);var c=xg;e&&Cg$1(i,e)?Ag(c,a):(i.flags=i.flags&-4097|2,I$1=!1,xg=i)}}else{if(Dg(i))throw Error(p(418));i.flags=i.flags&-4097|2,I$1=!1,xg=i}}}function Fg(i){for(i=i.return;i!==null&&i.tag!==5&&i.tag!==3&&i.tag!==13;)i=i.return;xg=i}function Gg$1(i){if(i!==xg)return!1;if(!I$1)return Fg(i),I$1=!0,!1;var e;if((e=i.tag!==3)&&!(e=i.tag!==5)&&(e=i.type,e=e!=="head"&&e!=="body"&&!Ef(i.type,i.memoizedProps)),e&&(e=yg$1)){if(Dg(i))throw Hg$1(),Error(p(418));for(;e;)Ag(i,e),e=Lf(e.nextSibling)}if(Fg(i),i.tag===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(p(317));e:{for(i=i.nextSibling,e=0;i;){if(i.nodeType===8){var a=i.data;if(a==="/$"){if(e===0){yg$1=Lf(i.nextSibling);break e}e--}else a!=="$"&&a!=="$!"&&a!=="$?"||e++}i=i.nextSibling}yg$1=null}}else yg$1=xg?Lf(i.stateNode.nextSibling):null;return!0}function Hg$1(){for(var i=yg$1;i;)i=Lf(i.nextSibling)}function Ig(){yg$1=xg=null,I$1=!1}function Jg$1(i){zg$1===null?zg$1=[i]:zg$1.push(i)}var Kg$1=ua.ReactCurrentBatchConfig;function Lg(i,e){if(i&&i.defaultProps){e=A$1({},e),i=i.defaultProps;for(var a in i)e[a]===void 0&&(e[a]=i[a]);return e}return e}var Mg=Uf(null),Ng=null,Og=null,Pg=null;function Qg$1(){Pg=Og=Ng=null}function Rg(i){var e=Mg.current;E(Mg),i._currentValue=e}function Sg(i,e,a){for(;i!==null;){var c=i.alternate;if((i.childLanes&e)!==e?(i.childLanes|=e,c!==null&&(c.childLanes|=e)):c!==null&&(c.childLanes&e)!==e&&(c.childLanes|=e),i===a)break;i=i.return}}function Tg(i,e){Ng=i,Pg=Og=null,i=i.dependencies,i!==null&&i.firstContext!==null&&(i.lanes&e&&(Ug=!0),i.firstContext=null)}function Vg$1(i){var e=i._currentValue;if(Pg!==i)if(i={context:i,memoizedValue:e,next:null},Og===null){if(Ng===null)throw Error(p(308));Og=i,Ng.dependencies={lanes:0,firstContext:i}}else Og=Og.next=i;return e}var Wg=null;function Xg$1(i){Wg===null?Wg=[i]:Wg.push(i)}function Yg$1(i,e,a,c){var h=e.interleaved;return h===null?(a.next=a,Xg$1(e)):(a.next=h.next,h.next=a),e.interleaved=a,Zg$1(i,c)}function Zg$1(i,e){i.lanes|=e;var a=i.alternate;for(a!==null&&(a.lanes|=e),a=i,i=i.return;i!==null;)i.childLanes|=e,a=i.alternate,a!==null&&(a.childLanes|=e),a=i,i=i.return;return a.tag===3?a.stateNode:null}var $g=!1;function ah(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function bh(i,e){i=i.updateQueue,e.updateQueue===i&&(e.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,effects:i.effects})}function ch(i,e){return{eventTime:i,lane:e,tag:0,payload:null,callback:null,next:null}}function dh(i,e,a){var c=i.updateQueue;if(c===null)return null;if(c=c.shared,K$1&2){var h=c.pending;return h===null?e.next=e:(e.next=h.next,h.next=e),c.pending=e,Zg$1(i,a)}return h=c.interleaved,h===null?(e.next=e,Xg$1(c)):(e.next=h.next,h.next=e),c.interleaved=e,Zg$1(i,a)}function eh(i,e,a){if(e=e.updateQueue,e!==null&&(e=e.shared,(a&4194240)!==0)){var c=e.lanes;c&=i.pendingLanes,a|=c,e.lanes=a,Cc$1(i,a)}}function fh(i,e){var a=i.updateQueue,c=i.alternate;if(c!==null&&(c=c.updateQueue,a===c)){var h=null,d=null;if(a=a.firstBaseUpdate,a!==null){do{var et={eventTime:a.eventTime,lane:a.lane,tag:a.tag,payload:a.payload,callback:a.callback,next:null};d===null?h=d=et:d=d.next=et,a=a.next}while(a!==null);d===null?h=d=e:d=d.next=e}else h=d=e;a={baseState:c.baseState,firstBaseUpdate:h,lastBaseUpdate:d,shared:c.shared,effects:c.effects},i.updateQueue=a;return}i=a.lastBaseUpdate,i===null?a.firstBaseUpdate=e:i.next=e,a.lastBaseUpdate=e}function gh(i,e,a,c){var h=i.updateQueue;$g=!1;var d=h.firstBaseUpdate,et=h.lastBaseUpdate,ft=h.shared.pending;if(ft!==null){h.shared.pending=null;var gt=ft,_t=gt.next;gt.next=null,et===null?d=_t:et.next=_t,et=gt;var wt=i.alternate;wt!==null&&(wt=wt.updateQueue,ft=wt.lastBaseUpdate,ft!==et&&(ft===null?wt.firstBaseUpdate=_t:ft.next=_t,wt.lastBaseUpdate=gt))}if(d!==null){var $t=h.baseState;et=0,wt=_t=gt=null,ft=d;do{var It=ft.lane,Rt=ft.eventTime;if((c&It)===It){wt!==null&&(wt=wt.next={eventTime:Rt,lane:0,tag:ft.tag,payload:ft.payload,callback:ft.callback,next:null});e:{var Tt=i,At=ft;switch(It=e,Rt=a,At.tag){case 1:if(Tt=At.payload,typeof Tt=="function"){$t=Tt.call(Rt,$t,It);break e}$t=Tt;break e;case 3:Tt.flags=Tt.flags&-65537|128;case 0:if(Tt=At.payload,It=typeof Tt=="function"?Tt.call(Rt,$t,It):Tt,It==null)break e;$t=A$1({},$t,It);break e;case 2:$g=!0}}ft.callback!==null&&ft.lane!==0&&(i.flags|=64,It=h.effects,It===null?h.effects=[ft]:It.push(ft))}else Rt={eventTime:Rt,lane:It,tag:ft.tag,payload:ft.payload,callback:ft.callback,next:null},wt===null?(_t=wt=Rt,gt=$t):wt=wt.next=Rt,et|=It;if(ft=ft.next,ft===null){if(ft=h.shared.pending,ft===null)break;It=ft,ft=It.next,It.next=null,h.lastBaseUpdate=It,h.shared.pending=null}}while(!0);if(wt===null&&(gt=$t),h.baseState=gt,h.firstBaseUpdate=_t,h.lastBaseUpdate=wt,e=h.shared.interleaved,e!==null){h=e;do et|=h.lane,h=h.next;while(h!==e)}else d===null&&(h.shared.lanes=0);hh|=et,i.lanes=et,i.memoizedState=$t}}function ih(i,e,a){if(i=e.effects,e.effects=null,i!==null)for(e=0;e<i.length;e++){var c=i[e],h=c.callback;if(h!==null){if(c.callback=null,c=a,typeof h!="function")throw Error(p(191,h));h.call(c)}}}var jh=new aa.Component().refs;function kh(i,e,a,c){e=i.memoizedState,a=a(c,e),a=a==null?e:A$1({},e,a),i.memoizedState=a,i.lanes===0&&(i.updateQueue.baseState=a)}var nh={isMounted:function(i){return(i=i._reactInternals)?Vb$1(i)===i:!1},enqueueSetState:function(i,e,a){i=i._reactInternals;var c=L$1(),h=lh(i),d=ch(c,h);d.payload=e,a!=null&&(d.callback=a),e=dh(i,d,h),e!==null&&(mh(e,i,h,c),eh(e,i,h))},enqueueReplaceState:function(i,e,a){i=i._reactInternals;var c=L$1(),h=lh(i),d=ch(c,h);d.tag=1,d.payload=e,a!=null&&(d.callback=a),e=dh(i,d,h),e!==null&&(mh(e,i,h,c),eh(e,i,h))},enqueueForceUpdate:function(i,e){i=i._reactInternals;var a=L$1(),c=lh(i),h=ch(a,c);h.tag=2,e!=null&&(h.callback=e),e=dh(i,h,c),e!==null&&(mh(e,i,c,a),eh(e,i,c))}};function oh(i,e,a,c,h,d,et){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(c,d,et):e.prototype&&e.prototype.isPureReactComponent?!Ie$1(a,c)||!Ie$1(h,d):!0}function ph(i,e,a){var c=!1,h=Vf,d=e.contextType;return typeof d=="object"&&d!==null?d=Vg$1(d):(h=Zf$1(e)?Xf$1:H$1.current,c=e.contextTypes,d=(c=c!=null)?Yf$1(i,h):Vf),e=new e(a,d),i.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=nh,i.stateNode=e,e._reactInternals=i,c&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=h,i.__reactInternalMemoizedMaskedChildContext=d),e}function qh(i,e,a,c){i=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(a,c),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(a,c),e.state!==i&&nh.enqueueReplaceState(e,e.state,null)}function rh(i,e,a,c){var h=i.stateNode;h.props=a,h.state=i.memoizedState,h.refs=jh,ah(i);var d=e.contextType;typeof d=="object"&&d!==null?h.context=Vg$1(d):(d=Zf$1(e)?Xf$1:H$1.current,h.context=Yf$1(i,d)),h.state=i.memoizedState,d=e.getDerivedStateFromProps,typeof d=="function"&&(kh(i,e,d,a),h.state=i.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof h.getSnapshotBeforeUpdate=="function"||typeof h.UNSAFE_componentWillMount!="function"&&typeof h.componentWillMount!="function"||(e=h.state,typeof h.componentWillMount=="function"&&h.componentWillMount(),typeof h.UNSAFE_componentWillMount=="function"&&h.UNSAFE_componentWillMount(),e!==h.state&&nh.enqueueReplaceState(h,h.state,null),gh(i,a,h,c),h.state=i.memoizedState),typeof h.componentDidMount=="function"&&(i.flags|=4194308)}function sh(i,e,a){if(i=a.ref,i!==null&&typeof i!="function"&&typeof i!="object"){if(a._owner){if(a=a._owner,a){if(a.tag!==1)throw Error(p(309));var c=a.stateNode}if(!c)throw Error(p(147,i));var h=c,d=""+i;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===d?e.ref:(e=function(et){var ft=h.refs;ft===jh&&(ft=h.refs={}),et===null?delete ft[d]:ft[d]=et},e._stringRef=d,e)}if(typeof i!="string")throw Error(p(284));if(!a._owner)throw Error(p(290,i))}return i}function th(i,e){throw i=Object.prototype.toString.call(e),Error(p(31,i==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":i))}function uh(i){var e=i._init;return e(i._payload)}function vh(i){function e(xt,Nt){if(i){var Ft=xt.deletions;Ft===null?(xt.deletions=[Nt],xt.flags|=16):Ft.push(Nt)}}function a(xt,Nt){if(!i)return null;for(;Nt!==null;)e(xt,Nt),Nt=Nt.sibling;return null}function c(xt,Nt){for(xt=new Map;Nt!==null;)Nt.key!==null?xt.set(Nt.key,Nt):xt.set(Nt.index,Nt),Nt=Nt.sibling;return xt}function h(xt,Nt){return xt=wh(xt,Nt),xt.index=0,xt.sibling=null,xt}function d(xt,Nt,Ft){return xt.index=Ft,i?(Ft=xt.alternate,Ft!==null?(Ft=Ft.index,Ft<Nt?(xt.flags|=2,Nt):Ft):(xt.flags|=2,Nt)):(xt.flags|=1048576,Nt)}function et(xt){return i&&xt.alternate===null&&(xt.flags|=2),xt}function ft(xt,Nt,Ft,jt){return Nt===null||Nt.tag!==6?(Nt=xh(Ft,xt.mode,jt),Nt.return=xt,Nt):(Nt=h(Nt,Ft),Nt.return=xt,Nt)}function gt(xt,Nt,Ft,jt){var Gt=Ft.type;return Gt===ya?wt(xt,Nt,Ft.props.children,jt,Ft.key):Nt!==null&&(Nt.elementType===Gt||typeof Gt=="object"&&Gt!==null&&Gt.$$typeof===Ha$1&&uh(Gt)===Nt.type)?(jt=h(Nt,Ft.props),jt.ref=sh(xt,Nt,Ft),jt.return=xt,jt):(jt=yh(Ft.type,Ft.key,Ft.props,null,xt.mode,jt),jt.ref=sh(xt,Nt,Ft),jt.return=xt,jt)}function _t(xt,Nt,Ft,jt){return Nt===null||Nt.tag!==4||Nt.stateNode.containerInfo!==Ft.containerInfo||Nt.stateNode.implementation!==Ft.implementation?(Nt=zh(Ft,xt.mode,jt),Nt.return=xt,Nt):(Nt=h(Nt,Ft.children||[]),Nt.return=xt,Nt)}function wt(xt,Nt,Ft,jt,Gt){return Nt===null||Nt.tag!==7?(Nt=Ah(Ft,xt.mode,jt,Gt),Nt.return=xt,Nt):(Nt=h(Nt,Ft),Nt.return=xt,Nt)}function $t(xt,Nt,Ft){if(typeof Nt=="string"&&Nt!==""||typeof Nt=="number")return Nt=xh(""+Nt,xt.mode,Ft),Nt.return=xt,Nt;if(typeof Nt=="object"&&Nt!==null){switch(Nt.$$typeof){case va:return Ft=yh(Nt.type,Nt.key,Nt.props,null,xt.mode,Ft),Ft.ref=sh(xt,null,Nt),Ft.return=xt,Ft;case wa:return Nt=zh(Nt,xt.mode,Ft),Nt.return=xt,Nt;case Ha$1:var jt=Nt._init;return $t(xt,jt(Nt._payload),Ft)}if(eb(Nt)||Ka$1(Nt))return Nt=Ah(Nt,xt.mode,Ft,null),Nt.return=xt,Nt;th(xt,Nt)}return null}function It(xt,Nt,Ft,jt){var Gt=Nt!==null?Nt.key:null;if(typeof Ft=="string"&&Ft!==""||typeof Ft=="number")return Gt!==null?null:ft(xt,Nt,""+Ft,jt);if(typeof Ft=="object"&&Ft!==null){switch(Ft.$$typeof){case va:return Ft.key===Gt?gt(xt,Nt,Ft,jt):null;case wa:return Ft.key===Gt?_t(xt,Nt,Ft,jt):null;case Ha$1:return Gt=Ft._init,It(xt,Nt,Gt(Ft._payload),jt)}if(eb(Ft)||Ka$1(Ft))return Gt!==null?null:wt(xt,Nt,Ft,jt,null);th(xt,Ft)}return null}function Rt(xt,Nt,Ft,jt,Gt){if(typeof jt=="string"&&jt!==""||typeof jt=="number")return xt=xt.get(Ft)||null,ft(Nt,xt,""+jt,Gt);if(typeof jt=="object"&&jt!==null){switch(jt.$$typeof){case va:return xt=xt.get(jt.key===null?Ft:jt.key)||null,gt(Nt,xt,jt,Gt);case wa:return xt=xt.get(jt.key===null?Ft:jt.key)||null,_t(Nt,xt,jt,Gt);case Ha$1:var Kt=jt._init;return Rt(xt,Nt,Ft,Kt(jt._payload),Gt)}if(eb(jt)||Ka$1(jt))return xt=xt.get(Ft)||null,wt(Nt,xt,jt,Gt,null);th(Nt,jt)}return null}function Tt(xt,Nt,Ft,jt){for(var Gt=null,Kt=null,Wt=Nt,Zt=Nt=0,cr=null;Wt!==null&&Zt<Ft.length;Zt++){Wt.index>Zt?(cr=Wt,Wt=null):cr=Wt.sibling;var hr=It(xt,Wt,Ft[Zt],jt);if(hr===null){Wt===null&&(Wt=cr);break}i&&Wt&&hr.alternate===null&&e(xt,Wt),Nt=d(hr,Nt,Zt),Kt===null?Gt=hr:Kt.sibling=hr,Kt=hr,Wt=cr}if(Zt===Ft.length)return a(xt,Wt),I$1&&tg$1(xt,Zt),Gt;if(Wt===null){for(;Zt<Ft.length;Zt++)Wt=$t(xt,Ft[Zt],jt),Wt!==null&&(Nt=d(Wt,Nt,Zt),Kt===null?Gt=Wt:Kt.sibling=Wt,Kt=Wt);return I$1&&tg$1(xt,Zt),Gt}for(Wt=c(xt,Wt);Zt<Ft.length;Zt++)cr=Rt(Wt,xt,Zt,Ft[Zt],jt),cr!==null&&(i&&cr.alternate!==null&&Wt.delete(cr.key===null?Zt:cr.key),Nt=d(cr,Nt,Zt),Kt===null?Gt=cr:Kt.sibling=cr,Kt=cr);return i&&Wt.forEach(function(gr){return e(xt,gr)}),I$1&&tg$1(xt,Zt),Gt}function At(xt,Nt,Ft,jt){var Gt=Ka$1(Ft);if(typeof Gt!="function")throw Error(p(150));if(Ft=Gt.call(Ft),Ft==null)throw Error(p(151));for(var Kt=Gt=null,Wt=Nt,Zt=Nt=0,cr=null,hr=Ft.next();Wt!==null&&!hr.done;Zt++,hr=Ft.next()){Wt.index>Zt?(cr=Wt,Wt=null):cr=Wt.sibling;var gr=It(xt,Wt,hr.value,jt);if(gr===null){Wt===null&&(Wt=cr);break}i&&Wt&&gr.alternate===null&&e(xt,Wt),Nt=d(gr,Nt,Zt),Kt===null?Gt=gr:Kt.sibling=gr,Kt=gr,Wt=cr}if(hr.done)return a(xt,Wt),I$1&&tg$1(xt,Zt),Gt;if(Wt===null){for(;!hr.done;Zt++,hr=Ft.next())hr=$t(xt,hr.value,jt),hr!==null&&(Nt=d(hr,Nt,Zt),Kt===null?Gt=hr:Kt.sibling=hr,Kt=hr);return I$1&&tg$1(xt,Zt),Gt}for(Wt=c(xt,Wt);!hr.done;Zt++,hr=Ft.next())hr=Rt(Wt,xt,Zt,hr.value,jt),hr!==null&&(i&&hr.alternate!==null&&Wt.delete(hr.key===null?Zt:hr.key),Nt=d(hr,Nt,Zt),Kt===null?Gt=hr:Kt.sibling=hr,Kt=hr);return i&&Wt.forEach(function(er){return e(xt,er)}),I$1&&tg$1(xt,Zt),Gt}function kt(xt,Nt,Ft,jt){if(typeof Ft=="object"&&Ft!==null&&Ft.type===ya&&Ft.key===null&&(Ft=Ft.props.children),typeof Ft=="object"&&Ft!==null){switch(Ft.$$typeof){case va:e:{for(var Gt=Ft.key,Kt=Nt;Kt!==null;){if(Kt.key===Gt){if(Gt=Ft.type,Gt===ya){if(Kt.tag===7){a(xt,Kt.sibling),Nt=h(Kt,Ft.props.children),Nt.return=xt,xt=Nt;break e}}else if(Kt.elementType===Gt||typeof Gt=="object"&&Gt!==null&&Gt.$$typeof===Ha$1&&uh(Gt)===Kt.type){a(xt,Kt.sibling),Nt=h(Kt,Ft.props),Nt.ref=sh(xt,Kt,Ft),Nt.return=xt,xt=Nt;break e}a(xt,Kt);break}else e(xt,Kt);Kt=Kt.sibling}Ft.type===ya?(Nt=Ah(Ft.props.children,xt.mode,jt,Ft.key),Nt.return=xt,xt=Nt):(jt=yh(Ft.type,Ft.key,Ft.props,null,xt.mode,jt),jt.ref=sh(xt,Nt,Ft),jt.return=xt,xt=jt)}return et(xt);case wa:e:{for(Kt=Ft.key;Nt!==null;){if(Nt.key===Kt)if(Nt.tag===4&&Nt.stateNode.containerInfo===Ft.containerInfo&&Nt.stateNode.implementation===Ft.implementation){a(xt,Nt.sibling),Nt=h(Nt,Ft.children||[]),Nt.return=xt,xt=Nt;break e}else{a(xt,Nt);break}else e(xt,Nt);Nt=Nt.sibling}Nt=zh(Ft,xt.mode,jt),Nt.return=xt,xt=Nt}return et(xt);case Ha$1:return Kt=Ft._init,kt(xt,Nt,Kt(Ft._payload),jt)}if(eb(Ft))return Tt(xt,Nt,Ft,jt);if(Ka$1(Ft))return At(xt,Nt,Ft,jt);th(xt,Ft)}return typeof Ft=="string"&&Ft!==""||typeof Ft=="number"?(Ft=""+Ft,Nt!==null&&Nt.tag===6?(a(xt,Nt.sibling),Nt=h(Nt,Ft),Nt.return=xt,xt=Nt):(a(xt,Nt),Nt=xh(Ft,xt.mode,jt),Nt.return=xt,xt=Nt),et(xt)):a(xt,Nt)}return kt}var Bh=vh(!0),Ch=vh(!1),Dh={},Eh$1=Uf(Dh),Fh=Uf(Dh),Gh$1=Uf(Dh);function Hh(i){if(i===Dh)throw Error(p(174));return i}function Ih(i,e){switch(G$1(Gh$1,e),G$1(Fh,i),G$1(Eh$1,Dh),i=e.nodeType,i){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:lb(null,"");break;default:i=i===8?e.parentNode:e,e=i.namespaceURI||null,i=i.tagName,e=lb(e,i)}E(Eh$1),G$1(Eh$1,e)}function Jh(){E(Eh$1),E(Fh),E(Gh$1)}function Kh(i){Hh(Gh$1.current);var e=Hh(Eh$1.current),a=lb(e,i.type);e!==a&&(G$1(Fh,i),G$1(Eh$1,a))}function Lh(i){Fh.current===i&&(E(Eh$1),E(Fh))}var M$2=Uf(0);function Mh(i){for(var e=i;e!==null;){if(e.tag===13){var a=e.memoizedState;if(a!==null&&(a=a.dehydrated,a===null||a.data==="$?"||a.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===i)break;for(;e.sibling===null;){if(e.return===null||e.return===i)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Nh=[];function Oh(){for(var i=0;i<Nh.length;i++)Nh[i]._workInProgressVersionPrimary=null;Nh.length=0}var Ph=ua.ReactCurrentDispatcher,Qh=ua.ReactCurrentBatchConfig,Rh=0,N=null,O$1=null,P$1=null,Sh=!1,Th=!1,Uh=0,Vh=0;function Q$1(){throw Error(p(321))}function Wh(i,e){if(e===null)return!1;for(var a=0;a<e.length&&a<i.length;a++)if(!He$1(i[a],e[a]))return!1;return!0}function Xh(i,e,a,c,h,d){if(Rh=d,N=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Ph.current=i===null||i.memoizedState===null?Yh:Zh,i=a(c,h),Th){d=0;do{if(Th=!1,Uh=0,25<=d)throw Error(p(301));d+=1,P$1=O$1=null,e.updateQueue=null,Ph.current=$h,i=a(c,h)}while(Th)}if(Ph.current=ai,e=O$1!==null&&O$1.next!==null,Rh=0,P$1=O$1=N=null,Sh=!1,e)throw Error(p(300));return i}function bi(){var i=Uh!==0;return Uh=0,i}function ci$1(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return P$1===null?N.memoizedState=P$1=i:P$1=P$1.next=i,P$1}function di(){if(O$1===null){var i=N.alternate;i=i!==null?i.memoizedState:null}else i=O$1.next;var e=P$1===null?N.memoizedState:P$1.next;if(e!==null)P$1=e,O$1=i;else{if(i===null)throw Error(p(310));O$1=i,i={memoizedState:O$1.memoizedState,baseState:O$1.baseState,baseQueue:O$1.baseQueue,queue:O$1.queue,next:null},P$1===null?N.memoizedState=P$1=i:P$1=P$1.next=i}return P$1}function ei(i,e){return typeof e=="function"?e(i):e}function fi$1(i){var e=di(),a=e.queue;if(a===null)throw Error(p(311));a.lastRenderedReducer=i;var c=O$1,h=c.baseQueue,d=a.pending;if(d!==null){if(h!==null){var et=h.next;h.next=d.next,d.next=et}c.baseQueue=h=d,a.pending=null}if(h!==null){d=h.next,c=c.baseState;var ft=et=null,gt=null,_t=d;do{var wt=_t.lane;if((Rh&wt)===wt)gt!==null&&(gt=gt.next={lane:0,action:_t.action,hasEagerState:_t.hasEagerState,eagerState:_t.eagerState,next:null}),c=_t.hasEagerState?_t.eagerState:i(c,_t.action);else{var $t={lane:wt,action:_t.action,hasEagerState:_t.hasEagerState,eagerState:_t.eagerState,next:null};gt===null?(ft=gt=$t,et=c):gt=gt.next=$t,N.lanes|=wt,hh|=wt}_t=_t.next}while(_t!==null&&_t!==d);gt===null?et=c:gt.next=ft,He$1(c,e.memoizedState)||(Ug=!0),e.memoizedState=c,e.baseState=et,e.baseQueue=gt,a.lastRenderedState=c}if(i=a.interleaved,i!==null){h=i;do d=h.lane,N.lanes|=d,hh|=d,h=h.next;while(h!==i)}else h===null&&(a.lanes=0);return[e.memoizedState,a.dispatch]}function gi(i){var e=di(),a=e.queue;if(a===null)throw Error(p(311));a.lastRenderedReducer=i;var c=a.dispatch,h=a.pending,d=e.memoizedState;if(h!==null){a.pending=null;var et=h=h.next;do d=i(d,et.action),et=et.next;while(et!==h);He$1(d,e.memoizedState)||(Ug=!0),e.memoizedState=d,e.baseQueue===null&&(e.baseState=d),a.lastRenderedState=d}return[d,c]}function hi$1(){}function ii$1(i,e){var a=N,c=di(),h=e(),d=!He$1(c.memoizedState,h);if(d&&(c.memoizedState=h,Ug=!0),c=c.queue,ji$1(ki$1.bind(null,a,c,i),[i]),c.getSnapshot!==e||d||P$1!==null&&P$1.memoizedState.tag&1){if(a.flags|=2048,li$1(9,mi.bind(null,a,c,h,e),void 0,null),R$1===null)throw Error(p(349));Rh&30||ni$1(a,e,h)}return h}function ni$1(i,e,a){i.flags|=16384,i={getSnapshot:e,value:a},e=N.updateQueue,e===null?(e={lastEffect:null,stores:null},N.updateQueue=e,e.stores=[i]):(a=e.stores,a===null?e.stores=[i]:a.push(i))}function mi(i,e,a,c){e.value=a,e.getSnapshot=c,oi(e)&&pi(i)}function ki$1(i,e,a){return a(function(){oi(e)&&pi(i)})}function oi(i){var e=i.getSnapshot;i=i.value;try{var a=e();return!He$1(i,a)}catch{return!0}}function pi(i){var e=Zg$1(i,1);e!==null&&mh(e,i,1,-1)}function qi(i){var e=ci$1();return typeof i=="function"&&(i=i()),e.memoizedState=e.baseState=i,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ei,lastRenderedState:i},e.queue=i,i=i.dispatch=ri$1.bind(null,N,i),[e.memoizedState,i]}function li$1(i,e,a,c){return i={tag:i,create:e,destroy:a,deps:c,next:null},e=N.updateQueue,e===null?(e={lastEffect:null,stores:null},N.updateQueue=e,e.lastEffect=i.next=i):(a=e.lastEffect,a===null?e.lastEffect=i.next=i:(c=a.next,a.next=i,i.next=c,e.lastEffect=i)),i}function si(){return di().memoizedState}function ti$1(i,e,a,c){var h=ci$1();N.flags|=i,h.memoizedState=li$1(1|e,a,void 0,c===void 0?null:c)}function ui$1(i,e,a,c){var h=di();c=c===void 0?null:c;var d=void 0;if(O$1!==null){var et=O$1.memoizedState;if(d=et.destroy,c!==null&&Wh(c,et.deps)){h.memoizedState=li$1(e,a,d,c);return}}N.flags|=i,h.memoizedState=li$1(1|e,a,d,c)}function vi(i,e){return ti$1(8390656,8,i,e)}function ji$1(i,e){return ui$1(2048,8,i,e)}function wi(i,e){return ui$1(4,2,i,e)}function xi$1(i,e){return ui$1(4,4,i,e)}function yi(i,e){if(typeof e=="function")return i=i(),e(i),function(){e(null)};if(e!=null)return i=i(),e.current=i,function(){e.current=null}}function zi(i,e,a){return a=a!=null?a.concat([i]):null,ui$1(4,4,yi.bind(null,e,i),a)}function Ai(){}function Bi(i,e){var a=di();e=e===void 0?null:e;var c=a.memoizedState;return c!==null&&e!==null&&Wh(e,c[1])?c[0]:(a.memoizedState=[i,e],i)}function Ci(i,e){var a=di();e=e===void 0?null:e;var c=a.memoizedState;return c!==null&&e!==null&&Wh(e,c[1])?c[0]:(i=i(),a.memoizedState=[i,e],i)}function Di$1(i,e,a){return Rh&21?(He$1(a,e)||(a=yc$1(),N.lanes|=a,hh|=a,i.baseState=!0),e):(i.baseState&&(i.baseState=!1,Ug=!0),i.memoizedState=a)}function Ei(i,e){var a=C$1;C$1=a!==0&&4>a?a:4,i(!0);var c=Qh.transition;Qh.transition={};try{i(!1),e()}finally{C$1=a,Qh.transition=c}}function Fi$1(){return di().memoizedState}function Gi(i,e,a){var c=lh(i);if(a={lane:c,action:a,hasEagerState:!1,eagerState:null,next:null},Hi$1(i))Ii(e,a);else if(a=Yg$1(i,e,a,c),a!==null){var h=L$1();mh(a,i,c,h),Ji(a,e,c)}}function ri$1(i,e,a){var c=lh(i),h={lane:c,action:a,hasEagerState:!1,eagerState:null,next:null};if(Hi$1(i))Ii(e,h);else{var d=i.alternate;if(i.lanes===0&&(d===null||d.lanes===0)&&(d=e.lastRenderedReducer,d!==null))try{var et=e.lastRenderedState,ft=d(et,a);if(h.hasEagerState=!0,h.eagerState=ft,He$1(ft,et)){var gt=e.interleaved;gt===null?(h.next=h,Xg$1(e)):(h.next=gt.next,gt.next=h),e.interleaved=h;return}}catch{}finally{}a=Yg$1(i,e,h,c),a!==null&&(h=L$1(),mh(a,i,c,h),Ji(a,e,c))}}function Hi$1(i){var e=i.alternate;return i===N||e!==null&&e===N}function Ii(i,e){Th=Sh=!0;var a=i.pending;a===null?e.next=e:(e.next=a.next,a.next=e),i.pending=e}function Ji(i,e,a){if(a&4194240){var c=e.lanes;c&=i.pendingLanes,a|=c,e.lanes=a,Cc$1(i,a)}}var ai={readContext:Vg$1,useCallback:Q$1,useContext:Q$1,useEffect:Q$1,useImperativeHandle:Q$1,useInsertionEffect:Q$1,useLayoutEffect:Q$1,useMemo:Q$1,useReducer:Q$1,useRef:Q$1,useState:Q$1,useDebugValue:Q$1,useDeferredValue:Q$1,useTransition:Q$1,useMutableSource:Q$1,useSyncExternalStore:Q$1,useId:Q$1,unstable_isNewReconciler:!1},Yh={readContext:Vg$1,useCallback:function(i,e){return ci$1().memoizedState=[i,e===void 0?null:e],i},useContext:Vg$1,useEffect:vi,useImperativeHandle:function(i,e,a){return a=a!=null?a.concat([i]):null,ti$1(4194308,4,yi.bind(null,e,i),a)},useLayoutEffect:function(i,e){return ti$1(4194308,4,i,e)},useInsertionEffect:function(i,e){return ti$1(4,2,i,e)},useMemo:function(i,e){var a=ci$1();return e=e===void 0?null:e,i=i(),a.memoizedState=[i,e],i},useReducer:function(i,e,a){var c=ci$1();return e=a!==void 0?a(e):e,c.memoizedState=c.baseState=e,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:e},c.queue=i,i=i.dispatch=Gi.bind(null,N,i),[c.memoizedState,i]},useRef:function(i){var e=ci$1();return i={current:i},e.memoizedState=i},useState:qi,useDebugValue:Ai,useDeferredValue:function(i){return ci$1().memoizedState=i},useTransition:function(){var i=qi(!1),e=i[0];return i=Ei.bind(null,i[1]),ci$1().memoizedState=i,[e,i]},useMutableSource:function(){},useSyncExternalStore:function(i,e,a){var c=N,h=ci$1();if(I$1){if(a===void 0)throw Error(p(407));a=a()}else{if(a=e(),R$1===null)throw Error(p(349));Rh&30||ni$1(c,e,a)}h.memoizedState=a;var d={value:a,getSnapshot:e};return h.queue=d,vi(ki$1.bind(null,c,d,i),[i]),c.flags|=2048,li$1(9,mi.bind(null,c,d,a,e),void 0,null),a},useId:function(){var i=ci$1(),e=R$1.identifierPrefix;if(I$1){var a=sg$1,c=rg$1;a=(c&~(1<<32-oc(c)-1)).toString(32)+a,e=":"+e+"R"+a,a=Uh++,0<a&&(e+="H"+a.toString(32)),e+=":"}else a=Vh++,e=":"+e+"r"+a.toString(32)+":";return i.memoizedState=e},unstable_isNewReconciler:!1},Zh={readContext:Vg$1,useCallback:Bi,useContext:Vg$1,useEffect:ji$1,useImperativeHandle:zi,useInsertionEffect:wi,useLayoutEffect:xi$1,useMemo:Ci,useReducer:fi$1,useRef:si,useState:function(){return fi$1(ei)},useDebugValue:Ai,useDeferredValue:function(i){var e=di();return Di$1(e,O$1.memoizedState,i)},useTransition:function(){var i=fi$1(ei)[0],e=di().memoizedState;return[i,e]},useMutableSource:hi$1,useSyncExternalStore:ii$1,useId:Fi$1,unstable_isNewReconciler:!1},$h={readContext:Vg$1,useCallback:Bi,useContext:Vg$1,useEffect:ji$1,useImperativeHandle:zi,useInsertionEffect:wi,useLayoutEffect:xi$1,useMemo:Ci,useReducer:gi,useRef:si,useState:function(){return gi(ei)},useDebugValue:Ai,useDeferredValue:function(i){var e=di();return O$1===null?e.memoizedState=i:Di$1(e,O$1.memoizedState,i)},useTransition:function(){var i=gi(ei)[0],e=di().memoizedState;return[i,e]},useMutableSource:hi$1,useSyncExternalStore:ii$1,useId:Fi$1,unstable_isNewReconciler:!1};function Ki(i,e){try{var a="",c=e;do a+=Pa$1(c),c=c.return;while(c);var h=a}catch(d){h=`
Error generating stack: `+d.message+`
`+d.stack}return{value:i,source:e,stack:h,digest:null}}function Li(i,e,a){return{value:i,source:null,stack:a??null,digest:e??null}}function Mi(i,e){try{console.error(e.value)}catch(a){setTimeout(function(){throw a})}}var Ni=typeof WeakMap=="function"?WeakMap:Map;function Oi(i,e,a){a=ch(-1,a),a.tag=3,a.payload={element:null};var c=e.value;return a.callback=function(){Pi$1||(Pi$1=!0,Qi=c),Mi(i,e)},a}function Ri(i,e,a){a=ch(-1,a),a.tag=3;var c=i.type.getDerivedStateFromError;if(typeof c=="function"){var h=e.value;a.payload=function(){return c(h)},a.callback=function(){Mi(i,e)}}var d=i.stateNode;return d!==null&&typeof d.componentDidCatch=="function"&&(a.callback=function(){Mi(i,e),typeof c!="function"&&(Si$1===null?Si$1=new Set([this]):Si$1.add(this));var et=e.stack;this.componentDidCatch(e.value,{componentStack:et!==null?et:""})}),a}function Ti(i,e,a){var c=i.pingCache;if(c===null){c=i.pingCache=new Ni;var h=new Set;c.set(e,h)}else h=c.get(e),h===void 0&&(h=new Set,c.set(e,h));h.has(a)||(h.add(a),i=Ui.bind(null,i,e,a),e.then(i,i))}function Vi(i){do{var e;if((e=i.tag===13)&&(e=i.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return i;i=i.return}while(i!==null);return null}function Wi$1(i,e,a,c,h){return i.mode&1?(i.flags|=65536,i.lanes=h,i):(i===e?i.flags|=65536:(i.flags|=128,a.flags|=131072,a.flags&=-52805,a.tag===1&&(a.alternate===null?a.tag=17:(e=ch(-1,1),e.tag=2,dh(a,e,1))),a.lanes|=1),i)}var Xi$1=ua.ReactCurrentOwner,Ug=!1;function Yi(i,e,a,c){e.child=i===null?Ch(e,null,a,c):Bh(e,i.child,a,c)}function Zi(i,e,a,c,h){a=a.render;var d=e.ref;return Tg(e,h),c=Xh(i,e,a,c,d,h),a=bi(),i!==null&&!Ug?(e.updateQueue=i.updateQueue,e.flags&=-2053,i.lanes&=~h,$i(i,e,h)):(I$1&&a&&vg$1(e),e.flags|=1,Yi(i,e,c,h),e.child)}function aj(i,e,a,c,h){if(i===null){var d=a.type;return typeof d=="function"&&!bj(d)&&d.defaultProps===void 0&&a.compare===null&&a.defaultProps===void 0?(e.tag=15,e.type=d,cj(i,e,d,c,h)):(i=yh(a.type,null,c,e,e.mode,h),i.ref=e.ref,i.return=e,e.child=i)}if(d=i.child,!(i.lanes&h)){var et=d.memoizedProps;if(a=a.compare,a=a!==null?a:Ie$1,a(et,c)&&i.ref===e.ref)return $i(i,e,h)}return e.flags|=1,i=wh(d,c),i.ref=e.ref,i.return=e,e.child=i}function cj(i,e,a,c,h){if(i!==null){var d=i.memoizedProps;if(Ie$1(d,c)&&i.ref===e.ref)if(Ug=!1,e.pendingProps=c=d,(i.lanes&h)!==0)i.flags&131072&&(Ug=!0);else return e.lanes=i.lanes,$i(i,e,h)}return dj(i,e,a,c,h)}function ej(i,e,a){var c=e.pendingProps,h=c.children,d=i!==null?i.memoizedState:null;if(c.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},G$1(fj,gj),gj|=a;else{if(!(a&1073741824))return i=d!==null?d.baseLanes|a:a,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:i,cachePool:null,transitions:null},e.updateQueue=null,G$1(fj,gj),gj|=i,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},c=d!==null?d.baseLanes:a,G$1(fj,gj),gj|=c}else d!==null?(c=d.baseLanes|a,e.memoizedState=null):c=a,G$1(fj,gj),gj|=c;return Yi(i,e,h,a),e.child}function hj(i,e){var a=e.ref;(i===null&&a!==null||i!==null&&i.ref!==a)&&(e.flags|=512,e.flags|=2097152)}function dj(i,e,a,c,h){var d=Zf$1(a)?Xf$1:H$1.current;return d=Yf$1(e,d),Tg(e,h),a=Xh(i,e,a,c,d,h),c=bi(),i!==null&&!Ug?(e.updateQueue=i.updateQueue,e.flags&=-2053,i.lanes&=~h,$i(i,e,h)):(I$1&&c&&vg$1(e),e.flags|=1,Yi(i,e,a,h),e.child)}function ij(i,e,a,c,h){if(Zf$1(a)){var d=!0;cg$1(e)}else d=!1;if(Tg(e,h),e.stateNode===null)jj(i,e),ph(e,a,c),rh(e,a,c,h),c=!0;else if(i===null){var et=e.stateNode,ft=e.memoizedProps;et.props=ft;var gt=et.context,_t=a.contextType;typeof _t=="object"&&_t!==null?_t=Vg$1(_t):(_t=Zf$1(a)?Xf$1:H$1.current,_t=Yf$1(e,_t));var wt=a.getDerivedStateFromProps,$t=typeof wt=="function"||typeof et.getSnapshotBeforeUpdate=="function";$t||typeof et.UNSAFE_componentWillReceiveProps!="function"&&typeof et.componentWillReceiveProps!="function"||(ft!==c||gt!==_t)&&qh(e,et,c,_t),$g=!1;var It=e.memoizedState;et.state=It,gh(e,c,et,h),gt=e.memoizedState,ft!==c||It!==gt||Wf.current||$g?(typeof wt=="function"&&(kh(e,a,wt,c),gt=e.memoizedState),(ft=$g||oh(e,a,ft,c,It,gt,_t))?($t||typeof et.UNSAFE_componentWillMount!="function"&&typeof et.componentWillMount!="function"||(typeof et.componentWillMount=="function"&&et.componentWillMount(),typeof et.UNSAFE_componentWillMount=="function"&&et.UNSAFE_componentWillMount()),typeof et.componentDidMount=="function"&&(e.flags|=4194308)):(typeof et.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=c,e.memoizedState=gt),et.props=c,et.state=gt,et.context=_t,c=ft):(typeof et.componentDidMount=="function"&&(e.flags|=4194308),c=!1)}else{et=e.stateNode,bh(i,e),ft=e.memoizedProps,_t=e.type===e.elementType?ft:Lg(e.type,ft),et.props=_t,$t=e.pendingProps,It=et.context,gt=a.contextType,typeof gt=="object"&&gt!==null?gt=Vg$1(gt):(gt=Zf$1(a)?Xf$1:H$1.current,gt=Yf$1(e,gt));var Rt=a.getDerivedStateFromProps;(wt=typeof Rt=="function"||typeof et.getSnapshotBeforeUpdate=="function")||typeof et.UNSAFE_componentWillReceiveProps!="function"&&typeof et.componentWillReceiveProps!="function"||(ft!==$t||It!==gt)&&qh(e,et,c,gt),$g=!1,It=e.memoizedState,et.state=It,gh(e,c,et,h);var Tt=e.memoizedState;ft!==$t||It!==Tt||Wf.current||$g?(typeof Rt=="function"&&(kh(e,a,Rt,c),Tt=e.memoizedState),(_t=$g||oh(e,a,_t,c,It,Tt,gt)||!1)?(wt||typeof et.UNSAFE_componentWillUpdate!="function"&&typeof et.componentWillUpdate!="function"||(typeof et.componentWillUpdate=="function"&&et.componentWillUpdate(c,Tt,gt),typeof et.UNSAFE_componentWillUpdate=="function"&&et.UNSAFE_componentWillUpdate(c,Tt,gt)),typeof et.componentDidUpdate=="function"&&(e.flags|=4),typeof et.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof et.componentDidUpdate!="function"||ft===i.memoizedProps&&It===i.memoizedState||(e.flags|=4),typeof et.getSnapshotBeforeUpdate!="function"||ft===i.memoizedProps&&It===i.memoizedState||(e.flags|=1024),e.memoizedProps=c,e.memoizedState=Tt),et.props=c,et.state=Tt,et.context=gt,c=_t):(typeof et.componentDidUpdate!="function"||ft===i.memoizedProps&&It===i.memoizedState||(e.flags|=4),typeof et.getSnapshotBeforeUpdate!="function"||ft===i.memoizedProps&&It===i.memoizedState||(e.flags|=1024),c=!1)}return kj(i,e,a,c,d,h)}function kj(i,e,a,c,h,d){hj(i,e);var et=(e.flags&128)!==0;if(!c&&!et)return h&&dg$1(e,a,!1),$i(i,e,d);c=e.stateNode,Xi$1.current=e;var ft=et&&typeof a.getDerivedStateFromError!="function"?null:c.render();return e.flags|=1,i!==null&&et?(e.child=Bh(e,i.child,null,d),e.child=Bh(e,null,ft,d)):Yi(i,e,ft,d),e.memoizedState=c.state,h&&dg$1(e,a,!0),e.child}function lj(i){var e=i.stateNode;e.pendingContext?ag$1(i,e.pendingContext,e.pendingContext!==e.context):e.context&&ag$1(i,e.context,!1),Ih(i,e.containerInfo)}function mj(i,e,a,c,h){return Ig(),Jg$1(h),e.flags|=256,Yi(i,e,a,c),e.child}var nj={dehydrated:null,treeContext:null,retryLane:0};function oj(i){return{baseLanes:i,cachePool:null,transitions:null}}function pj(i,e,a){var c=e.pendingProps,h=M$2.current,d=!1,et=(e.flags&128)!==0,ft;if((ft=et)||(ft=i!==null&&i.memoizedState===null?!1:(h&2)!==0),ft?(d=!0,e.flags&=-129):(i===null||i.memoizedState!==null)&&(h|=1),G$1(M$2,h&1),i===null)return Eg(e),i=e.memoizedState,i!==null&&(i=i.dehydrated,i!==null)?(e.mode&1?i.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(et=c.children,i=c.fallback,d?(c=e.mode,d=e.child,et={mode:"hidden",children:et},!(c&1)&&d!==null?(d.childLanes=0,d.pendingProps=et):d=qj(et,c,0,null),i=Ah(i,c,a,null),d.return=e,i.return=e,d.sibling=i,e.child=d,e.child.memoizedState=oj(a),e.memoizedState=nj,i):rj(e,et));if(h=i.memoizedState,h!==null&&(ft=h.dehydrated,ft!==null))return sj(i,e,et,c,ft,h,a);if(d){d=c.fallback,et=e.mode,h=i.child,ft=h.sibling;var gt={mode:"hidden",children:c.children};return!(et&1)&&e.child!==h?(c=e.child,c.childLanes=0,c.pendingProps=gt,e.deletions=null):(c=wh(h,gt),c.subtreeFlags=h.subtreeFlags&14680064),ft!==null?d=wh(ft,d):(d=Ah(d,et,a,null),d.flags|=2),d.return=e,c.return=e,c.sibling=d,e.child=c,c=d,d=e.child,et=i.child.memoizedState,et=et===null?oj(a):{baseLanes:et.baseLanes|a,cachePool:null,transitions:et.transitions},d.memoizedState=et,d.childLanes=i.childLanes&~a,e.memoizedState=nj,c}return d=i.child,i=d.sibling,c=wh(d,{mode:"visible",children:c.children}),!(e.mode&1)&&(c.lanes=a),c.return=e,c.sibling=null,i!==null&&(a=e.deletions,a===null?(e.deletions=[i],e.flags|=16):a.push(i)),e.child=c,e.memoizedState=null,c}function rj(i,e){return e=qj({mode:"visible",children:e},i.mode,0,null),e.return=i,i.child=e}function tj(i,e,a,c){return c!==null&&Jg$1(c),Bh(e,i.child,null,a),i=rj(e,e.pendingProps.children),i.flags|=2,e.memoizedState=null,i}function sj(i,e,a,c,h,d,et){if(a)return e.flags&256?(e.flags&=-257,c=Li(Error(p(422))),tj(i,e,et,c)):e.memoizedState!==null?(e.child=i.child,e.flags|=128,null):(d=c.fallback,h=e.mode,c=qj({mode:"visible",children:c.children},h,0,null),d=Ah(d,h,et,null),d.flags|=2,c.return=e,d.return=e,c.sibling=d,e.child=c,e.mode&1&&Bh(e,i.child,null,et),e.child.memoizedState=oj(et),e.memoizedState=nj,d);if(!(e.mode&1))return tj(i,e,et,null);if(h.data==="$!"){if(c=h.nextSibling&&h.nextSibling.dataset,c)var ft=c.dgst;return c=ft,d=Error(p(419)),c=Li(d,c,void 0),tj(i,e,et,c)}if(ft=(et&i.childLanes)!==0,Ug||ft){if(c=R$1,c!==null){switch(et&-et){case 4:h=2;break;case 16:h=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:h=32;break;case 536870912:h=268435456;break;default:h=0}h=h&(c.suspendedLanes|et)?0:h,h!==0&&h!==d.retryLane&&(d.retryLane=h,Zg$1(i,h),mh(c,i,h,-1))}return uj(),c=Li(Error(p(421))),tj(i,e,et,c)}return h.data==="$?"?(e.flags|=128,e.child=i.child,e=vj.bind(null,i),h._reactRetry=e,null):(i=d.treeContext,yg$1=Lf(h.nextSibling),xg=e,I$1=!0,zg$1=null,i!==null&&(og$1[pg++]=rg$1,og$1[pg++]=sg$1,og$1[pg++]=qg,rg$1=i.id,sg$1=i.overflow,qg=e),e=rj(e,c.children),e.flags|=4096,e)}function wj(i,e,a){i.lanes|=e;var c=i.alternate;c!==null&&(c.lanes|=e),Sg(i.return,e,a)}function xj(i,e,a,c,h){var d=i.memoizedState;d===null?i.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:c,tail:a,tailMode:h}:(d.isBackwards=e,d.rendering=null,d.renderingStartTime=0,d.last=c,d.tail=a,d.tailMode=h)}function yj(i,e,a){var c=e.pendingProps,h=c.revealOrder,d=c.tail;if(Yi(i,e,c.children,a),c=M$2.current,c&2)c=c&1|2,e.flags|=128;else{if(i!==null&&i.flags&128)e:for(i=e.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&wj(i,a,e);else if(i.tag===19)wj(i,a,e);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===e)break e;for(;i.sibling===null;){if(i.return===null||i.return===e)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}c&=1}if(G$1(M$2,c),!(e.mode&1))e.memoizedState=null;else switch(h){case"forwards":for(a=e.child,h=null;a!==null;)i=a.alternate,i!==null&&Mh(i)===null&&(h=a),a=a.sibling;a=h,a===null?(h=e.child,e.child=null):(h=a.sibling,a.sibling=null),xj(e,!1,h,a,d);break;case"backwards":for(a=null,h=e.child,e.child=null;h!==null;){if(i=h.alternate,i!==null&&Mh(i)===null){e.child=h;break}i=h.sibling,h.sibling=a,a=h,h=i}xj(e,!0,a,null,d);break;case"together":xj(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function jj(i,e){!(e.mode&1)&&i!==null&&(i.alternate=null,e.alternate=null,e.flags|=2)}function $i(i,e,a){if(i!==null&&(e.dependencies=i.dependencies),hh|=e.lanes,!(a&e.childLanes))return null;if(i!==null&&e.child!==i.child)throw Error(p(153));if(e.child!==null){for(i=e.child,a=wh(i,i.pendingProps),e.child=a,a.return=e;i.sibling!==null;)i=i.sibling,a=a.sibling=wh(i,i.pendingProps),a.return=e;a.sibling=null}return e.child}function zj(i,e,a){switch(e.tag){case 3:lj(e),Ig();break;case 5:Kh(e);break;case 1:Zf$1(e.type)&&cg$1(e);break;case 4:Ih(e,e.stateNode.containerInfo);break;case 10:var c=e.type._context,h=e.memoizedProps.value;G$1(Mg,c._currentValue),c._currentValue=h;break;case 13:if(c=e.memoizedState,c!==null)return c.dehydrated!==null?(G$1(M$2,M$2.current&1),e.flags|=128,null):a&e.child.childLanes?pj(i,e,a):(G$1(M$2,M$2.current&1),i=$i(i,e,a),i!==null?i.sibling:null);G$1(M$2,M$2.current&1);break;case 19:if(c=(a&e.childLanes)!==0,i.flags&128){if(c)return yj(i,e,a);e.flags|=128}if(h=e.memoizedState,h!==null&&(h.rendering=null,h.tail=null,h.lastEffect=null),G$1(M$2,M$2.current),c)break;return null;case 22:case 23:return e.lanes=0,ej(i,e,a)}return $i(i,e,a)}var Aj,Bj,Cj,Dj;Aj=function(i,e){for(var a=e.child;a!==null;){if(a.tag===5||a.tag===6)i.appendChild(a.stateNode);else if(a.tag!==4&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===e)break;for(;a.sibling===null;){if(a.return===null||a.return===e)return;a=a.return}a.sibling.return=a.return,a=a.sibling}};Bj=function(){};Cj=function(i,e,a,c){var h=i.memoizedProps;if(h!==c){i=e.stateNode,Hh(Eh$1.current);var d=null;switch(a){case"input":h=Ya$1(i,h),c=Ya$1(i,c),d=[];break;case"select":h=A$1({},h,{value:void 0}),c=A$1({},c,{value:void 0}),d=[];break;case"textarea":h=gb(i,h),c=gb(i,c),d=[];break;default:typeof h.onClick!="function"&&typeof c.onClick=="function"&&(i.onclick=Bf)}ub(a,c);var et;a=null;for(_t in h)if(!c.hasOwnProperty(_t)&&h.hasOwnProperty(_t)&&h[_t]!=null)if(_t==="style"){var ft=h[_t];for(et in ft)ft.hasOwnProperty(et)&&(a||(a={}),a[et]="")}else _t!=="dangerouslySetInnerHTML"&&_t!=="children"&&_t!=="suppressContentEditableWarning"&&_t!=="suppressHydrationWarning"&&_t!=="autoFocus"&&(ea.hasOwnProperty(_t)?d||(d=[]):(d=d||[]).push(_t,null));for(_t in c){var gt=c[_t];if(ft=h!=null?h[_t]:void 0,c.hasOwnProperty(_t)&&gt!==ft&&(gt!=null||ft!=null))if(_t==="style")if(ft){for(et in ft)!ft.hasOwnProperty(et)||gt&&gt.hasOwnProperty(et)||(a||(a={}),a[et]="");for(et in gt)gt.hasOwnProperty(et)&&ft[et]!==gt[et]&&(a||(a={}),a[et]=gt[et])}else a||(d||(d=[]),d.push(_t,a)),a=gt;else _t==="dangerouslySetInnerHTML"?(gt=gt?gt.__html:void 0,ft=ft?ft.__html:void 0,gt!=null&&ft!==gt&&(d=d||[]).push(_t,gt)):_t==="children"?typeof gt!="string"&&typeof gt!="number"||(d=d||[]).push(_t,""+gt):_t!=="suppressContentEditableWarning"&&_t!=="suppressHydrationWarning"&&(ea.hasOwnProperty(_t)?(gt!=null&&_t==="onScroll"&&D$1("scroll",i),d||ft===gt||(d=[])):(d=d||[]).push(_t,gt))}a&&(d=d||[]).push("style",a);var _t=d;(e.updateQueue=_t)&&(e.flags|=4)}};Dj=function(i,e,a,c){a!==c&&(e.flags|=4)};function Ej(i,e){if(!I$1)switch(i.tailMode){case"hidden":e=i.tail;for(var a=null;e!==null;)e.alternate!==null&&(a=e),e=e.sibling;a===null?i.tail=null:a.sibling=null;break;case"collapsed":a=i.tail;for(var c=null;a!==null;)a.alternate!==null&&(c=a),a=a.sibling;c===null?e||i.tail===null?i.tail=null:i.tail.sibling=null:c.sibling=null}}function S$1(i){var e=i.alternate!==null&&i.alternate.child===i.child,a=0,c=0;if(e)for(var h=i.child;h!==null;)a|=h.lanes|h.childLanes,c|=h.subtreeFlags&14680064,c|=h.flags&14680064,h.return=i,h=h.sibling;else for(h=i.child;h!==null;)a|=h.lanes|h.childLanes,c|=h.subtreeFlags,c|=h.flags,h.return=i,h=h.sibling;return i.subtreeFlags|=c,i.childLanes=a,e}function Fj(i,e,a){var c=e.pendingProps;switch(wg(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return S$1(e),null;case 1:return Zf$1(e.type)&&$f(),S$1(e),null;case 3:return c=e.stateNode,Jh(),E(Wf),E(H$1),Oh(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(i===null||i.child===null)&&(Gg$1(e)?e.flags|=4:i===null||i.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,zg$1!==null&&(Gj(zg$1),zg$1=null))),Bj(i,e),S$1(e),null;case 5:Lh(e);var h=Hh(Gh$1.current);if(a=e.type,i!==null&&e.stateNode!=null)Cj(i,e,a,c,h),i.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!c){if(e.stateNode===null)throw Error(p(166));return S$1(e),null}if(i=Hh(Eh$1.current),Gg$1(e)){c=e.stateNode,a=e.type;var d=e.memoizedProps;switch(c[Of]=e,c[Pf]=d,i=(e.mode&1)!==0,a){case"dialog":D$1("cancel",c),D$1("close",c);break;case"iframe":case"object":case"embed":D$1("load",c);break;case"video":case"audio":for(h=0;h<lf.length;h++)D$1(lf[h],c);break;case"source":D$1("error",c);break;case"img":case"image":case"link":D$1("error",c),D$1("load",c);break;case"details":D$1("toggle",c);break;case"input":Za$1(c,d),D$1("invalid",c);break;case"select":c._wrapperState={wasMultiple:!!d.multiple},D$1("invalid",c);break;case"textarea":hb(c,d),D$1("invalid",c)}ub(a,d),h=null;for(var et in d)if(d.hasOwnProperty(et)){var ft=d[et];et==="children"?typeof ft=="string"?c.textContent!==ft&&(d.suppressHydrationWarning!==!0&&Af(c.textContent,ft,i),h=["children",ft]):typeof ft=="number"&&c.textContent!==""+ft&&(d.suppressHydrationWarning!==!0&&Af(c.textContent,ft,i),h=["children",""+ft]):ea.hasOwnProperty(et)&&ft!=null&&et==="onScroll"&&D$1("scroll",c)}switch(a){case"input":Va$1(c),db(c,d,!0);break;case"textarea":Va$1(c),jb(c);break;case"select":case"option":break;default:typeof d.onClick=="function"&&(c.onclick=Bf)}c=h,e.updateQueue=c,c!==null&&(e.flags|=4)}else{et=h.nodeType===9?h:h.ownerDocument,i==="http://www.w3.org/1999/xhtml"&&(i=kb(a)),i==="http://www.w3.org/1999/xhtml"?a==="script"?(i=et.createElement("div"),i.innerHTML="<script><\/script>",i=i.removeChild(i.firstChild)):typeof c.is=="string"?i=et.createElement(a,{is:c.is}):(i=et.createElement(a),a==="select"&&(et=i,c.multiple?et.multiple=!0:c.size&&(et.size=c.size))):i=et.createElementNS(i,a),i[Of]=e,i[Pf]=c,Aj(i,e,!1,!1),e.stateNode=i;e:{switch(et=vb(a,c),a){case"dialog":D$1("cancel",i),D$1("close",i),h=c;break;case"iframe":case"object":case"embed":D$1("load",i),h=c;break;case"video":case"audio":for(h=0;h<lf.length;h++)D$1(lf[h],i);h=c;break;case"source":D$1("error",i),h=c;break;case"img":case"image":case"link":D$1("error",i),D$1("load",i),h=c;break;case"details":D$1("toggle",i),h=c;break;case"input":Za$1(i,c),h=Ya$1(i,c),D$1("invalid",i);break;case"option":h=c;break;case"select":i._wrapperState={wasMultiple:!!c.multiple},h=A$1({},c,{value:void 0}),D$1("invalid",i);break;case"textarea":hb(i,c),h=gb(i,c),D$1("invalid",i);break;default:h=c}ub(a,h),ft=h;for(d in ft)if(ft.hasOwnProperty(d)){var gt=ft[d];d==="style"?sb(i,gt):d==="dangerouslySetInnerHTML"?(gt=gt?gt.__html:void 0,gt!=null&&nb(i,gt)):d==="children"?typeof gt=="string"?(a!=="textarea"||gt!=="")&&ob(i,gt):typeof gt=="number"&&ob(i,""+gt):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(ea.hasOwnProperty(d)?gt!=null&&d==="onScroll"&&D$1("scroll",i):gt!=null&&ta(i,d,gt,et))}switch(a){case"input":Va$1(i),db(i,c,!1);break;case"textarea":Va$1(i),jb(i);break;case"option":c.value!=null&&i.setAttribute("value",""+Sa(c.value));break;case"select":i.multiple=!!c.multiple,d=c.value,d!=null?fb(i,!!c.multiple,d,!1):c.defaultValue!=null&&fb(i,!!c.multiple,c.defaultValue,!0);break;default:typeof h.onClick=="function"&&(i.onclick=Bf)}switch(a){case"button":case"input":case"select":case"textarea":c=!!c.autoFocus;break e;case"img":c=!0;break e;default:c=!1}}c&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return S$1(e),null;case 6:if(i&&e.stateNode!=null)Dj(i,e,i.memoizedProps,c);else{if(typeof c!="string"&&e.stateNode===null)throw Error(p(166));if(a=Hh(Gh$1.current),Hh(Eh$1.current),Gg$1(e)){if(c=e.stateNode,a=e.memoizedProps,c[Of]=e,(d=c.nodeValue!==a)&&(i=xg,i!==null))switch(i.tag){case 3:Af(c.nodeValue,a,(i.mode&1)!==0);break;case 5:i.memoizedProps.suppressHydrationWarning!==!0&&Af(c.nodeValue,a,(i.mode&1)!==0)}d&&(e.flags|=4)}else c=(a.nodeType===9?a:a.ownerDocument).createTextNode(c),c[Of]=e,e.stateNode=c}return S$1(e),null;case 13:if(E(M$2),c=e.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(I$1&&yg$1!==null&&e.mode&1&&!(e.flags&128))Hg$1(),Ig(),e.flags|=98560,d=!1;else if(d=Gg$1(e),c!==null&&c.dehydrated!==null){if(i===null){if(!d)throw Error(p(318));if(d=e.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(p(317));d[Of]=e}else Ig(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;S$1(e),d=!1}else zg$1!==null&&(Gj(zg$1),zg$1=null),d=!0;if(!d)return e.flags&65536?e:null}return e.flags&128?(e.lanes=a,e):(c=c!==null,c!==(i!==null&&i.memoizedState!==null)&&c&&(e.child.flags|=8192,e.mode&1&&(i===null||M$2.current&1?T$1===0&&(T$1=3):uj())),e.updateQueue!==null&&(e.flags|=4),S$1(e),null);case 4:return Jh(),Bj(i,e),i===null&&sf(e.stateNode.containerInfo),S$1(e),null;case 10:return Rg(e.type._context),S$1(e),null;case 17:return Zf$1(e.type)&&$f(),S$1(e),null;case 19:if(E(M$2),d=e.memoizedState,d===null)return S$1(e),null;if(c=(e.flags&128)!==0,et=d.rendering,et===null)if(c)Ej(d,!1);else{if(T$1!==0||i!==null&&i.flags&128)for(i=e.child;i!==null;){if(et=Mh(i),et!==null){for(e.flags|=128,Ej(d,!1),c=et.updateQueue,c!==null&&(e.updateQueue=c,e.flags|=4),e.subtreeFlags=0,c=a,a=e.child;a!==null;)d=a,i=c,d.flags&=14680066,et=d.alternate,et===null?(d.childLanes=0,d.lanes=i,d.child=null,d.subtreeFlags=0,d.memoizedProps=null,d.memoizedState=null,d.updateQueue=null,d.dependencies=null,d.stateNode=null):(d.childLanes=et.childLanes,d.lanes=et.lanes,d.child=et.child,d.subtreeFlags=0,d.deletions=null,d.memoizedProps=et.memoizedProps,d.memoizedState=et.memoizedState,d.updateQueue=et.updateQueue,d.type=et.type,i=et.dependencies,d.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext}),a=a.sibling;return G$1(M$2,M$2.current&1|2),e.child}i=i.sibling}d.tail!==null&&B$2()>Hj&&(e.flags|=128,c=!0,Ej(d,!1),e.lanes=4194304)}else{if(!c)if(i=Mh(et),i!==null){if(e.flags|=128,c=!0,a=i.updateQueue,a!==null&&(e.updateQueue=a,e.flags|=4),Ej(d,!0),d.tail===null&&d.tailMode==="hidden"&&!et.alternate&&!I$1)return S$1(e),null}else 2*B$2()-d.renderingStartTime>Hj&&a!==1073741824&&(e.flags|=128,c=!0,Ej(d,!1),e.lanes=4194304);d.isBackwards?(et.sibling=e.child,e.child=et):(a=d.last,a!==null?a.sibling=et:e.child=et,d.last=et)}return d.tail!==null?(e=d.tail,d.rendering=e,d.tail=e.sibling,d.renderingStartTime=B$2(),e.sibling=null,a=M$2.current,G$1(M$2,c?a&1|2:a&1),e):(S$1(e),null);case 22:case 23:return Ij(),c=e.memoizedState!==null,i!==null&&i.memoizedState!==null!==c&&(e.flags|=8192),c&&e.mode&1?gj&1073741824&&(S$1(e),e.subtreeFlags&6&&(e.flags|=8192)):S$1(e),null;case 24:return null;case 25:return null}throw Error(p(156,e.tag))}function Jj(i,e){switch(wg(e),e.tag){case 1:return Zf$1(e.type)&&$f(),i=e.flags,i&65536?(e.flags=i&-65537|128,e):null;case 3:return Jh(),E(Wf),E(H$1),Oh(),i=e.flags,i&65536&&!(i&128)?(e.flags=i&-65537|128,e):null;case 5:return Lh(e),null;case 13:if(E(M$2),i=e.memoizedState,i!==null&&i.dehydrated!==null){if(e.alternate===null)throw Error(p(340));Ig()}return i=e.flags,i&65536?(e.flags=i&-65537|128,e):null;case 19:return E(M$2),null;case 4:return Jh(),null;case 10:return Rg(e.type._context),null;case 22:case 23:return Ij(),null;case 24:return null;default:return null}}var Kj=!1,U$1=!1,Lj=typeof WeakSet=="function"?WeakSet:Set,V$2=null;function Mj(i,e){var a=i.ref;if(a!==null)if(typeof a=="function")try{a(null)}catch(c){W$1(i,e,c)}else a.current=null}function Nj(i,e,a){try{a()}catch(c){W$1(i,e,c)}}var Oj=!1;function Pj(i,e){if(Cf=dd,i=Me$2(),Ne$1(i)){if("selectionStart"in i)var a={start:i.selectionStart,end:i.selectionEnd};else e:{a=(a=i.ownerDocument)&&a.defaultView||window;var c=a.getSelection&&a.getSelection();if(c&&c.rangeCount!==0){a=c.anchorNode;var h=c.anchorOffset,d=c.focusNode;c=c.focusOffset;try{a.nodeType,d.nodeType}catch{a=null;break e}var et=0,ft=-1,gt=-1,_t=0,wt=0,$t=i,It=null;t:for(;;){for(var Rt;$t!==a||h!==0&&$t.nodeType!==3||(ft=et+h),$t!==d||c!==0&&$t.nodeType!==3||(gt=et+c),$t.nodeType===3&&(et+=$t.nodeValue.length),(Rt=$t.firstChild)!==null;)It=$t,$t=Rt;for(;;){if($t===i)break t;if(It===a&&++_t===h&&(ft=et),It===d&&++wt===c&&(gt=et),(Rt=$t.nextSibling)!==null)break;$t=It,It=$t.parentNode}$t=Rt}a=ft===-1||gt===-1?null:{start:ft,end:gt}}else a=null}a=a||{start:0,end:0}}else a=null;for(Df={focusedElem:i,selectionRange:a},dd=!1,V$2=e;V$2!==null;)if(e=V$2,i=e.child,(e.subtreeFlags&1028)!==0&&i!==null)i.return=e,V$2=i;else for(;V$2!==null;){e=V$2;try{var Tt=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(Tt!==null){var At=Tt.memoizedProps,kt=Tt.memoizedState,xt=e.stateNode,Nt=xt.getSnapshotBeforeUpdate(e.elementType===e.type?At:Lg(e.type,At),kt);xt.__reactInternalSnapshotBeforeUpdate=Nt}break;case 3:var Ft=e.stateNode.containerInfo;Ft.nodeType===1?Ft.textContent="":Ft.nodeType===9&&Ft.documentElement&&Ft.removeChild(Ft.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(p(163))}}catch(jt){W$1(e,e.return,jt)}if(i=e.sibling,i!==null){i.return=e.return,V$2=i;break}V$2=e.return}return Tt=Oj,Oj=!1,Tt}function Qj(i,e,a){var c=e.updateQueue;if(c=c!==null?c.lastEffect:null,c!==null){var h=c=c.next;do{if((h.tag&i)===i){var d=h.destroy;h.destroy=void 0,d!==void 0&&Nj(e,a,d)}h=h.next}while(h!==c)}}function Rj(i,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var a=e=e.next;do{if((a.tag&i)===i){var c=a.create;a.destroy=c()}a=a.next}while(a!==e)}}function Sj(i){var e=i.ref;if(e!==null){var a=i.stateNode;switch(i.tag){case 5:i=a;break;default:i=a}typeof e=="function"?e(i):e.current=i}}function Tj(i){var e=i.alternate;e!==null&&(i.alternate=null,Tj(e)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(e=i.stateNode,e!==null&&(delete e[Of],delete e[Pf],delete e[of],delete e[Qf$1],delete e[Rf])),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}function Uj(i){return i.tag===5||i.tag===3||i.tag===4}function Vj(i){e:for(;;){for(;i.sibling===null;){if(i.return===null||Uj(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.flags&2||i.child===null||i.tag===4)continue e;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function Wj(i,e,a){var c=i.tag;if(c===5||c===6)i=i.stateNode,e?a.nodeType===8?a.parentNode.insertBefore(i,e):a.insertBefore(i,e):(a.nodeType===8?(e=a.parentNode,e.insertBefore(i,a)):(e=a,e.appendChild(i)),a=a._reactRootContainer,a!=null||e.onclick!==null||(e.onclick=Bf));else if(c!==4&&(i=i.child,i!==null))for(Wj(i,e,a),i=i.sibling;i!==null;)Wj(i,e,a),i=i.sibling}function Xj(i,e,a){var c=i.tag;if(c===5||c===6)i=i.stateNode,e?a.insertBefore(i,e):a.appendChild(i);else if(c!==4&&(i=i.child,i!==null))for(Xj(i,e,a),i=i.sibling;i!==null;)Xj(i,e,a),i=i.sibling}var X$2=null,Yj=!1;function Zj(i,e,a){for(a=a.child;a!==null;)ak(i,e,a),a=a.sibling}function ak(i,e,a){if(lc&&typeof lc.onCommitFiberUnmount=="function")try{lc.onCommitFiberUnmount(kc$1,a)}catch{}switch(a.tag){case 5:U$1||Mj(a,e);case 6:var c=X$2,h=Yj;X$2=null,Zj(i,e,a),X$2=c,Yj=h,X$2!==null&&(Yj?(i=X$2,a=a.stateNode,i.nodeType===8?i.parentNode.removeChild(a):i.removeChild(a)):X$2.removeChild(a.stateNode));break;case 18:X$2!==null&&(Yj?(i=X$2,a=a.stateNode,i.nodeType===8?Kf(i.parentNode,a):i.nodeType===1&&Kf(i,a),bd(i)):Kf(X$2,a.stateNode));break;case 4:c=X$2,h=Yj,X$2=a.stateNode.containerInfo,Yj=!0,Zj(i,e,a),X$2=c,Yj=h;break;case 0:case 11:case 14:case 15:if(!U$1&&(c=a.updateQueue,c!==null&&(c=c.lastEffect,c!==null))){h=c=c.next;do{var d=h,et=d.destroy;d=d.tag,et!==void 0&&(d&2||d&4)&&Nj(a,e,et),h=h.next}while(h!==c)}Zj(i,e,a);break;case 1:if(!U$1&&(Mj(a,e),c=a.stateNode,typeof c.componentWillUnmount=="function"))try{c.props=a.memoizedProps,c.state=a.memoizedState,c.componentWillUnmount()}catch(ft){W$1(a,e,ft)}Zj(i,e,a);break;case 21:Zj(i,e,a);break;case 22:a.mode&1?(U$1=(c=U$1)||a.memoizedState!==null,Zj(i,e,a),U$1=c):Zj(i,e,a);break;default:Zj(i,e,a)}}function bk(i){var e=i.updateQueue;if(e!==null){i.updateQueue=null;var a=i.stateNode;a===null&&(a=i.stateNode=new Lj),e.forEach(function(c){var h=ck.bind(null,i,c);a.has(c)||(a.add(c),c.then(h,h))})}}function dk(i,e){var a=e.deletions;if(a!==null)for(var c=0;c<a.length;c++){var h=a[c];try{var d=i,et=e,ft=et;e:for(;ft!==null;){switch(ft.tag){case 5:X$2=ft.stateNode,Yj=!1;break e;case 3:X$2=ft.stateNode.containerInfo,Yj=!0;break e;case 4:X$2=ft.stateNode.containerInfo,Yj=!0;break e}ft=ft.return}if(X$2===null)throw Error(p(160));ak(d,et,h),X$2=null,Yj=!1;var gt=h.alternate;gt!==null&&(gt.return=null),h.return=null}catch(_t){W$1(h,e,_t)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)ek(e,i),e=e.sibling}function ek(i,e){var a=i.alternate,c=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:if(dk(e,i),fk(i),c&4){try{Qj(3,i,i.return),Rj(3,i)}catch(At){W$1(i,i.return,At)}try{Qj(5,i,i.return)}catch(At){W$1(i,i.return,At)}}break;case 1:dk(e,i),fk(i),c&512&&a!==null&&Mj(a,a.return);break;case 5:if(dk(e,i),fk(i),c&512&&a!==null&&Mj(a,a.return),i.flags&32){var h=i.stateNode;try{ob(h,"")}catch(At){W$1(i,i.return,At)}}if(c&4&&(h=i.stateNode,h!=null)){var d=i.memoizedProps,et=a!==null?a.memoizedProps:d,ft=i.type,gt=i.updateQueue;if(i.updateQueue=null,gt!==null)try{ft==="input"&&d.type==="radio"&&d.name!=null&&ab(h,d),vb(ft,et);var _t=vb(ft,d);for(et=0;et<gt.length;et+=2){var wt=gt[et],$t=gt[et+1];wt==="style"?sb(h,$t):wt==="dangerouslySetInnerHTML"?nb(h,$t):wt==="children"?ob(h,$t):ta(h,wt,$t,_t)}switch(ft){case"input":bb(h,d);break;case"textarea":ib(h,d);break;case"select":var It=h._wrapperState.wasMultiple;h._wrapperState.wasMultiple=!!d.multiple;var Rt=d.value;Rt!=null?fb(h,!!d.multiple,Rt,!1):It!==!!d.multiple&&(d.defaultValue!=null?fb(h,!!d.multiple,d.defaultValue,!0):fb(h,!!d.multiple,d.multiple?[]:"",!1))}h[Pf]=d}catch(At){W$1(i,i.return,At)}}break;case 6:if(dk(e,i),fk(i),c&4){if(i.stateNode===null)throw Error(p(162));h=i.stateNode,d=i.memoizedProps;try{h.nodeValue=d}catch(At){W$1(i,i.return,At)}}break;case 3:if(dk(e,i),fk(i),c&4&&a!==null&&a.memoizedState.isDehydrated)try{bd(e.containerInfo)}catch(At){W$1(i,i.return,At)}break;case 4:dk(e,i),fk(i);break;case 13:dk(e,i),fk(i),h=i.child,h.flags&8192&&(d=h.memoizedState!==null,h.stateNode.isHidden=d,!d||h.alternate!==null&&h.alternate.memoizedState!==null||(gk=B$2())),c&4&&bk(i);break;case 22:if(wt=a!==null&&a.memoizedState!==null,i.mode&1?(U$1=(_t=U$1)||wt,dk(e,i),U$1=_t):dk(e,i),fk(i),c&8192){if(_t=i.memoizedState!==null,(i.stateNode.isHidden=_t)&&!wt&&i.mode&1)for(V$2=i,wt=i.child;wt!==null;){for($t=V$2=wt;V$2!==null;){switch(It=V$2,Rt=It.child,It.tag){case 0:case 11:case 14:case 15:Qj(4,It,It.return);break;case 1:Mj(It,It.return);var Tt=It.stateNode;if(typeof Tt.componentWillUnmount=="function"){c=It,a=It.return;try{e=c,Tt.props=e.memoizedProps,Tt.state=e.memoizedState,Tt.componentWillUnmount()}catch(At){W$1(c,a,At)}}break;case 5:Mj(It,It.return);break;case 22:if(It.memoizedState!==null){hk($t);continue}}Rt!==null?(Rt.return=It,V$2=Rt):hk($t)}wt=wt.sibling}e:for(wt=null,$t=i;;){if($t.tag===5){if(wt===null){wt=$t;try{h=$t.stateNode,_t?(d=h.style,typeof d.setProperty=="function"?d.setProperty("display","none","important"):d.display="none"):(ft=$t.stateNode,gt=$t.memoizedProps.style,et=gt!=null&&gt.hasOwnProperty("display")?gt.display:null,ft.style.display=rb("display",et))}catch(At){W$1(i,i.return,At)}}}else if($t.tag===6){if(wt===null)try{$t.stateNode.nodeValue=_t?"":$t.memoizedProps}catch(At){W$1(i,i.return,At)}}else if(($t.tag!==22&&$t.tag!==23||$t.memoizedState===null||$t===i)&&$t.child!==null){$t.child.return=$t,$t=$t.child;continue}if($t===i)break e;for(;$t.sibling===null;){if($t.return===null||$t.return===i)break e;wt===$t&&(wt=null),$t=$t.return}wt===$t&&(wt=null),$t.sibling.return=$t.return,$t=$t.sibling}}break;case 19:dk(e,i),fk(i),c&4&&bk(i);break;case 21:break;default:dk(e,i),fk(i)}}function fk(i){var e=i.flags;if(e&2){try{e:{for(var a=i.return;a!==null;){if(Uj(a)){var c=a;break e}a=a.return}throw Error(p(160))}switch(c.tag){case 5:var h=c.stateNode;c.flags&32&&(ob(h,""),c.flags&=-33);var d=Vj(i);Xj(i,d,h);break;case 3:case 4:var et=c.stateNode.containerInfo,ft=Vj(i);Wj(i,ft,et);break;default:throw Error(p(161))}}catch(gt){W$1(i,i.return,gt)}i.flags&=-3}e&4096&&(i.flags&=-4097)}function ik(i,e,a){V$2=i,jk(i)}function jk(i,e,a){for(var c=(i.mode&1)!==0;V$2!==null;){var h=V$2,d=h.child;if(h.tag===22&&c){var et=h.memoizedState!==null||Kj;if(!et){var ft=h.alternate,gt=ft!==null&&ft.memoizedState!==null||U$1;ft=Kj;var _t=U$1;if(Kj=et,(U$1=gt)&&!_t)for(V$2=h;V$2!==null;)et=V$2,gt=et.child,et.tag===22&&et.memoizedState!==null?kk(h):gt!==null?(gt.return=et,V$2=gt):kk(h);for(;d!==null;)V$2=d,jk(d),d=d.sibling;V$2=h,Kj=ft,U$1=_t}lk(i)}else h.subtreeFlags&8772&&d!==null?(d.return=h,V$2=d):lk(i)}}function lk(i){for(;V$2!==null;){var e=V$2;if(e.flags&8772){var a=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:U$1||Rj(5,e);break;case 1:var c=e.stateNode;if(e.flags&4&&!U$1)if(a===null)c.componentDidMount();else{var h=e.elementType===e.type?a.memoizedProps:Lg(e.type,a.memoizedProps);c.componentDidUpdate(h,a.memoizedState,c.__reactInternalSnapshotBeforeUpdate)}var d=e.updateQueue;d!==null&&ih(e,d,c);break;case 3:var et=e.updateQueue;if(et!==null){if(a=null,e.child!==null)switch(e.child.tag){case 5:a=e.child.stateNode;break;case 1:a=e.child.stateNode}ih(e,et,a)}break;case 5:var ft=e.stateNode;if(a===null&&e.flags&4){a=ft;var gt=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":gt.autoFocus&&a.focus();break;case"img":gt.src&&(a.src=gt.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var _t=e.alternate;if(_t!==null){var wt=_t.memoizedState;if(wt!==null){var $t=wt.dehydrated;$t!==null&&bd($t)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(p(163))}U$1||e.flags&512&&Sj(e)}catch(It){W$1(e,e.return,It)}}if(e===i){V$2=null;break}if(a=e.sibling,a!==null){a.return=e.return,V$2=a;break}V$2=e.return}}function hk(i){for(;V$2!==null;){var e=V$2;if(e===i){V$2=null;break}var a=e.sibling;if(a!==null){a.return=e.return,V$2=a;break}V$2=e.return}}function kk(i){for(;V$2!==null;){var e=V$2;try{switch(e.tag){case 0:case 11:case 15:var a=e.return;try{Rj(4,e)}catch(gt){W$1(e,a,gt)}break;case 1:var c=e.stateNode;if(typeof c.componentDidMount=="function"){var h=e.return;try{c.componentDidMount()}catch(gt){W$1(e,h,gt)}}var d=e.return;try{Sj(e)}catch(gt){W$1(e,d,gt)}break;case 5:var et=e.return;try{Sj(e)}catch(gt){W$1(e,et,gt)}}}catch(gt){W$1(e,e.return,gt)}if(e===i){V$2=null;break}var ft=e.sibling;if(ft!==null){ft.return=e.return,V$2=ft;break}V$2=e.return}}var mk=Math.ceil,nk=ua.ReactCurrentDispatcher,ok=ua.ReactCurrentOwner,pk=ua.ReactCurrentBatchConfig,K$1=0,R$1=null,Y$2=null,Z$2=0,gj=0,fj=Uf(0),T$1=0,qk=null,hh=0,rk=0,sk=0,tk=null,uk=null,gk=0,Hj=1/0,vk=null,Pi$1=!1,Qi=null,Si$1=null,wk=!1,xk=null,yk=0,zk=0,Ak=null,Bk=-1,Ck=0;function L$1(){return K$1&6?B$2():Bk!==-1?Bk:Bk=B$2()}function lh(i){return i.mode&1?K$1&2&&Z$2!==0?Z$2&-Z$2:Kg$1.transition!==null?(Ck===0&&(Ck=yc$1()),Ck):(i=C$1,i!==0||(i=window.event,i=i===void 0?16:jd$1(i.type)),i):1}function mh(i,e,a,c){if(50<zk)throw zk=0,Ak=null,Error(p(185));Ac$1(i,a,c),(!(K$1&2)||i!==R$1)&&(i===R$1&&(!(K$1&2)&&(rk|=a),T$1===4&&Dk(i,Z$2)),Ek(i,c),a===1&&K$1===0&&!(e.mode&1)&&(Hj=B$2()+500,fg$1&&jg()))}function Ek(i,e){var a=i.callbackNode;wc$1(i,e);var c=uc(i,i===R$1?Z$2:0);if(c===0)a!==null&&bc$1(a),i.callbackNode=null,i.callbackPriority=0;else if(e=c&-c,i.callbackPriority!==e){if(a!=null&&bc$1(a),e===1)i.tag===0?ig$1(Fk.bind(null,i)):hg$1(Fk.bind(null,i)),Jf$1(function(){!(K$1&6)&&jg()}),a=null;else{switch(Dc(c)){case 1:a=fc;break;case 4:a=gc$1;break;case 16:a=hc$1;break;case 536870912:a=jc;break;default:a=hc$1}a=Gk(a,Hk.bind(null,i))}i.callbackPriority=e,i.callbackNode=a}}function Hk(i,e){if(Bk=-1,Ck=0,K$1&6)throw Error(p(327));var a=i.callbackNode;if(Ik()&&i.callbackNode!==a)return null;var c=uc(i,i===R$1?Z$2:0);if(c===0)return null;if(c&30||c&i.expiredLanes||e)e=Jk(i,c);else{e=c;var h=K$1;K$1|=2;var d=Kk();(R$1!==i||Z$2!==e)&&(vk=null,Hj=B$2()+500,Lk(i,e));do try{Mk();break}catch(ft){Nk(i,ft)}while(!0);Qg$1(),nk.current=d,K$1=h,Y$2!==null?e=0:(R$1=null,Z$2=0,e=T$1)}if(e!==0){if(e===2&&(h=xc$1(i),h!==0&&(c=h,e=Ok(i,h))),e===1)throw a=qk,Lk(i,0),Dk(i,c),Ek(i,B$2()),a;if(e===6)Dk(i,c);else{if(h=i.current.alternate,!(c&30)&&!Pk(h)&&(e=Jk(i,c),e===2&&(d=xc$1(i),d!==0&&(c=d,e=Ok(i,d))),e===1))throw a=qk,Lk(i,0),Dk(i,c),Ek(i,B$2()),a;switch(i.finishedWork=h,i.finishedLanes=c,e){case 0:case 1:throw Error(p(345));case 2:Qk(i,uk,vk);break;case 3:if(Dk(i,c),(c&130023424)===c&&(e=gk+500-B$2(),10<e)){if(uc(i,0)!==0)break;if(h=i.suspendedLanes,(h&c)!==c){L$1(),i.pingedLanes|=i.suspendedLanes&h;break}i.timeoutHandle=Ff(Qk.bind(null,i,uk,vk),e);break}Qk(i,uk,vk);break;case 4:if(Dk(i,c),(c&4194240)===c)break;for(e=i.eventTimes,h=-1;0<c;){var et=31-oc(c);d=1<<et,et=e[et],et>h&&(h=et),c&=~d}if(c=h,c=B$2()-c,c=(120>c?120:480>c?480:1080>c?1080:1920>c?1920:3e3>c?3e3:4320>c?4320:1960*mk(c/1960))-c,10<c){i.timeoutHandle=Ff(Qk.bind(null,i,uk,vk),c);break}Qk(i,uk,vk);break;case 5:Qk(i,uk,vk);break;default:throw Error(p(329))}}}return Ek(i,B$2()),i.callbackNode===a?Hk.bind(null,i):null}function Ok(i,e){var a=tk;return i.current.memoizedState.isDehydrated&&(Lk(i,e).flags|=256),i=Jk(i,e),i!==2&&(e=uk,uk=a,e!==null&&Gj(e)),i}function Gj(i){uk===null?uk=i:uk.push.apply(uk,i)}function Pk(i){for(var e=i;;){if(e.flags&16384){var a=e.updateQueue;if(a!==null&&(a=a.stores,a!==null))for(var c=0;c<a.length;c++){var h=a[c],d=h.getSnapshot;h=h.value;try{if(!He$1(d(),h))return!1}catch{return!1}}}if(a=e.child,e.subtreeFlags&16384&&a!==null)a.return=e,e=a;else{if(e===i)break;for(;e.sibling===null;){if(e.return===null||e.return===i)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Dk(i,e){for(e&=~sk,e&=~rk,i.suspendedLanes|=e,i.pingedLanes&=~e,i=i.expirationTimes;0<e;){var a=31-oc(e),c=1<<a;i[a]=-1,e&=~c}}function Fk(i){if(K$1&6)throw Error(p(327));Ik();var e=uc(i,0);if(!(e&1))return Ek(i,B$2()),null;var a=Jk(i,e);if(i.tag!==0&&a===2){var c=xc$1(i);c!==0&&(e=c,a=Ok(i,c))}if(a===1)throw a=qk,Lk(i,0),Dk(i,e),Ek(i,B$2()),a;if(a===6)throw Error(p(345));return i.finishedWork=i.current.alternate,i.finishedLanes=e,Qk(i,uk,vk),Ek(i,B$2()),null}function Rk(i,e){var a=K$1;K$1|=1;try{return i(e)}finally{K$1=a,K$1===0&&(Hj=B$2()+500,fg$1&&jg())}}function Sk(i){xk!==null&&xk.tag===0&&!(K$1&6)&&Ik();var e=K$1;K$1|=1;var a=pk.transition,c=C$1;try{if(pk.transition=null,C$1=1,i)return i()}finally{C$1=c,pk.transition=a,K$1=e,!(K$1&6)&&jg()}}function Ij(){gj=fj.current,E(fj)}function Lk(i,e){i.finishedWork=null,i.finishedLanes=0;var a=i.timeoutHandle;if(a!==-1&&(i.timeoutHandle=-1,Gf$1(a)),Y$2!==null)for(a=Y$2.return;a!==null;){var c=a;switch(wg(c),c.tag){case 1:c=c.type.childContextTypes,c!=null&&$f();break;case 3:Jh(),E(Wf),E(H$1),Oh();break;case 5:Lh(c);break;case 4:Jh();break;case 13:E(M$2);break;case 19:E(M$2);break;case 10:Rg(c.type._context);break;case 22:case 23:Ij()}a=a.return}if(R$1=i,Y$2=i=wh(i.current,null),Z$2=gj=e,T$1=0,qk=null,sk=rk=hh=0,uk=tk=null,Wg!==null){for(e=0;e<Wg.length;e++)if(a=Wg[e],c=a.interleaved,c!==null){a.interleaved=null;var h=c.next,d=a.pending;if(d!==null){var et=d.next;d.next=h,c.next=et}a.pending=c}Wg=null}return i}function Nk(i,e){do{var a=Y$2;try{if(Qg$1(),Ph.current=ai,Sh){for(var c=N.memoizedState;c!==null;){var h=c.queue;h!==null&&(h.pending=null),c=c.next}Sh=!1}if(Rh=0,P$1=O$1=N=null,Th=!1,Uh=0,ok.current=null,a===null||a.return===null){T$1=1,qk=e,Y$2=null;break}e:{var d=i,et=a.return,ft=a,gt=e;if(e=Z$2,ft.flags|=32768,gt!==null&&typeof gt=="object"&&typeof gt.then=="function"){var _t=gt,wt=ft,$t=wt.tag;if(!(wt.mode&1)&&($t===0||$t===11||$t===15)){var It=wt.alternate;It?(wt.updateQueue=It.updateQueue,wt.memoizedState=It.memoizedState,wt.lanes=It.lanes):(wt.updateQueue=null,wt.memoizedState=null)}var Rt=Vi(et);if(Rt!==null){Rt.flags&=-257,Wi$1(Rt,et,ft,d,e),Rt.mode&1&&Ti(d,_t,e),e=Rt,gt=_t;var Tt=e.updateQueue;if(Tt===null){var At=new Set;At.add(gt),e.updateQueue=At}else Tt.add(gt);break e}else{if(!(e&1)){Ti(d,_t,e),uj();break e}gt=Error(p(426))}}else if(I$1&&ft.mode&1){var kt=Vi(et);if(kt!==null){!(kt.flags&65536)&&(kt.flags|=256),Wi$1(kt,et,ft,d,e),Jg$1(Ki(gt,ft));break e}}d=gt=Ki(gt,ft),T$1!==4&&(T$1=2),tk===null?tk=[d]:tk.push(d),d=et;do{switch(d.tag){case 3:d.flags|=65536,e&=-e,d.lanes|=e;var xt=Oi(d,gt,e);fh(d,xt);break e;case 1:ft=gt;var Nt=d.type,Ft=d.stateNode;if(!(d.flags&128)&&(typeof Nt.getDerivedStateFromError=="function"||Ft!==null&&typeof Ft.componentDidCatch=="function"&&(Si$1===null||!Si$1.has(Ft)))){d.flags|=65536,e&=-e,d.lanes|=e;var jt=Ri(d,ft,e);fh(d,jt);break e}}d=d.return}while(d!==null)}Tk(a)}catch(Gt){e=Gt,Y$2===a&&a!==null&&(Y$2=a=a.return);continue}break}while(!0)}function Kk(){var i=nk.current;return nk.current=ai,i===null?ai:i}function uj(){(T$1===0||T$1===3||T$1===2)&&(T$1=4),R$1===null||!(hh&268435455)&&!(rk&268435455)||Dk(R$1,Z$2)}function Jk(i,e){var a=K$1;K$1|=2;var c=Kk();(R$1!==i||Z$2!==e)&&(vk=null,Lk(i,e));do try{Uk();break}catch(h){Nk(i,h)}while(!0);if(Qg$1(),K$1=a,nk.current=c,Y$2!==null)throw Error(p(261));return R$1=null,Z$2=0,T$1}function Uk(){for(;Y$2!==null;)Vk(Y$2)}function Mk(){for(;Y$2!==null&&!cc();)Vk(Y$2)}function Vk(i){var e=Wk(i.alternate,i,gj);i.memoizedProps=i.pendingProps,e===null?Tk(i):Y$2=e,ok.current=null}function Tk(i){var e=i;do{var a=e.alternate;if(i=e.return,e.flags&32768){if(a=Jj(a,e),a!==null){a.flags&=32767,Y$2=a;return}if(i!==null)i.flags|=32768,i.subtreeFlags=0,i.deletions=null;else{T$1=6,Y$2=null;return}}else if(a=Fj(a,e,gj),a!==null){Y$2=a;return}if(e=e.sibling,e!==null){Y$2=e;return}Y$2=e=i}while(e!==null);T$1===0&&(T$1=5)}function Qk(i,e,a){var c=C$1,h=pk.transition;try{pk.transition=null,C$1=1,Xk(i,e,a,c)}finally{pk.transition=h,C$1=c}return null}function Xk(i,e,a,c){do Ik();while(xk!==null);if(K$1&6)throw Error(p(327));a=i.finishedWork;var h=i.finishedLanes;if(a===null)return null;if(i.finishedWork=null,i.finishedLanes=0,a===i.current)throw Error(p(177));i.callbackNode=null,i.callbackPriority=0;var d=a.lanes|a.childLanes;if(Bc$1(i,d),i===R$1&&(Y$2=R$1=null,Z$2=0),!(a.subtreeFlags&2064)&&!(a.flags&2064)||wk||(wk=!0,Gk(hc$1,function(){return Ik(),null})),d=(a.flags&15990)!==0,a.subtreeFlags&15990||d){d=pk.transition,pk.transition=null;var et=C$1;C$1=1;var ft=K$1;K$1|=4,ok.current=null,Pj(i,a),ek(a,i),Oe$1(Df),dd=!!Cf,Df=Cf=null,i.current=a,ik(a),dc(),K$1=ft,C$1=et,pk.transition=d}else i.current=a;if(wk&&(wk=!1,xk=i,yk=h),d=i.pendingLanes,d===0&&(Si$1=null),mc$1(a.stateNode),Ek(i,B$2()),e!==null)for(c=i.onRecoverableError,a=0;a<e.length;a++)h=e[a],c(h.value,{componentStack:h.stack,digest:h.digest});if(Pi$1)throw Pi$1=!1,i=Qi,Qi=null,i;return yk&1&&i.tag!==0&&Ik(),d=i.pendingLanes,d&1?i===Ak?zk++:(zk=0,Ak=i):zk=0,jg(),null}function Ik(){if(xk!==null){var i=Dc(yk),e=pk.transition,a=C$1;try{if(pk.transition=null,C$1=16>i?16:i,xk===null)var c=!1;else{if(i=xk,xk=null,yk=0,K$1&6)throw Error(p(331));var h=K$1;for(K$1|=4,V$2=i.current;V$2!==null;){var d=V$2,et=d.child;if(V$2.flags&16){var ft=d.deletions;if(ft!==null){for(var gt=0;gt<ft.length;gt++){var _t=ft[gt];for(V$2=_t;V$2!==null;){var wt=V$2;switch(wt.tag){case 0:case 11:case 15:Qj(8,wt,d)}var $t=wt.child;if($t!==null)$t.return=wt,V$2=$t;else for(;V$2!==null;){wt=V$2;var It=wt.sibling,Rt=wt.return;if(Tj(wt),wt===_t){V$2=null;break}if(It!==null){It.return=Rt,V$2=It;break}V$2=Rt}}}var Tt=d.alternate;if(Tt!==null){var At=Tt.child;if(At!==null){Tt.child=null;do{var kt=At.sibling;At.sibling=null,At=kt}while(At!==null)}}V$2=d}}if(d.subtreeFlags&2064&&et!==null)et.return=d,V$2=et;else e:for(;V$2!==null;){if(d=V$2,d.flags&2048)switch(d.tag){case 0:case 11:case 15:Qj(9,d,d.return)}var xt=d.sibling;if(xt!==null){xt.return=d.return,V$2=xt;break e}V$2=d.return}}var Nt=i.current;for(V$2=Nt;V$2!==null;){et=V$2;var Ft=et.child;if(et.subtreeFlags&2064&&Ft!==null)Ft.return=et,V$2=Ft;else e:for(et=Nt;V$2!==null;){if(ft=V$2,ft.flags&2048)try{switch(ft.tag){case 0:case 11:case 15:Rj(9,ft)}}catch(Gt){W$1(ft,ft.return,Gt)}if(ft===et){V$2=null;break e}var jt=ft.sibling;if(jt!==null){jt.return=ft.return,V$2=jt;break e}V$2=ft.return}}if(K$1=h,jg(),lc&&typeof lc.onPostCommitFiberRoot=="function")try{lc.onPostCommitFiberRoot(kc$1,i)}catch{}c=!0}return c}finally{C$1=a,pk.transition=e}}return!1}function Yk(i,e,a){e=Ki(a,e),e=Oi(i,e,1),i=dh(i,e,1),e=L$1(),i!==null&&(Ac$1(i,1,e),Ek(i,e))}function W$1(i,e,a){if(i.tag===3)Yk(i,i,a);else for(;e!==null;){if(e.tag===3){Yk(e,i,a);break}else if(e.tag===1){var c=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof c.componentDidCatch=="function"&&(Si$1===null||!Si$1.has(c))){i=Ki(a,i),i=Ri(e,i,1),e=dh(e,i,1),i=L$1(),e!==null&&(Ac$1(e,1,i),Ek(e,i));break}}e=e.return}}function Ui(i,e,a){var c=i.pingCache;c!==null&&c.delete(e),e=L$1(),i.pingedLanes|=i.suspendedLanes&a,R$1===i&&(Z$2&a)===a&&(T$1===4||T$1===3&&(Z$2&130023424)===Z$2&&500>B$2()-gk?Lk(i,0):sk|=a),Ek(i,e)}function Zk(i,e){e===0&&(i.mode&1?(e=sc,sc<<=1,!(sc&130023424)&&(sc=4194304)):e=1);var a=L$1();i=Zg$1(i,e),i!==null&&(Ac$1(i,e,a),Ek(i,a))}function vj(i){var e=i.memoizedState,a=0;e!==null&&(a=e.retryLane),Zk(i,a)}function ck(i,e){var a=0;switch(i.tag){case 13:var c=i.stateNode,h=i.memoizedState;h!==null&&(a=h.retryLane);break;case 19:c=i.stateNode;break;default:throw Error(p(314))}c!==null&&c.delete(e),Zk(i,a)}var Wk;Wk=function(i,e,a){if(i!==null)if(i.memoizedProps!==e.pendingProps||Wf.current)Ug=!0;else{if(!(i.lanes&a)&&!(e.flags&128))return Ug=!1,zj(i,e,a);Ug=!!(i.flags&131072)}else Ug=!1,I$1&&e.flags&1048576&&ug$1(e,ng$1,e.index);switch(e.lanes=0,e.tag){case 2:var c=e.type;jj(i,e),i=e.pendingProps;var h=Yf$1(e,H$1.current);Tg(e,a),h=Xh(null,e,c,i,h,a);var d=bi();return e.flags|=1,typeof h=="object"&&h!==null&&typeof h.render=="function"&&h.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Zf$1(c)?(d=!0,cg$1(e)):d=!1,e.memoizedState=h.state!==null&&h.state!==void 0?h.state:null,ah(e),h.updater=nh,e.stateNode=h,h._reactInternals=e,rh(e,c,i,a),e=kj(null,e,c,!0,d,a)):(e.tag=0,I$1&&d&&vg$1(e),Yi(null,e,h,a),e=e.child),e;case 16:c=e.elementType;e:{switch(jj(i,e),i=e.pendingProps,h=c._init,c=h(c._payload),e.type=c,h=e.tag=$k(c),i=Lg(c,i),h){case 0:e=dj(null,e,c,i,a);break e;case 1:e=ij(null,e,c,i,a);break e;case 11:e=Zi(null,e,c,i,a);break e;case 14:e=aj(null,e,c,Lg(c.type,i),a);break e}throw Error(p(306,c,""))}return e;case 0:return c=e.type,h=e.pendingProps,h=e.elementType===c?h:Lg(c,h),dj(i,e,c,h,a);case 1:return c=e.type,h=e.pendingProps,h=e.elementType===c?h:Lg(c,h),ij(i,e,c,h,a);case 3:e:{if(lj(e),i===null)throw Error(p(387));c=e.pendingProps,d=e.memoizedState,h=d.element,bh(i,e),gh(e,c,null,a);var et=e.memoizedState;if(c=et.element,d.isDehydrated)if(d={element:c,isDehydrated:!1,cache:et.cache,pendingSuspenseBoundaries:et.pendingSuspenseBoundaries,transitions:et.transitions},e.updateQueue.baseState=d,e.memoizedState=d,e.flags&256){h=Ki(Error(p(423)),e),e=mj(i,e,c,a,h);break e}else if(c!==h){h=Ki(Error(p(424)),e),e=mj(i,e,c,a,h);break e}else for(yg$1=Lf(e.stateNode.containerInfo.firstChild),xg=e,I$1=!0,zg$1=null,a=Ch(e,null,c,a),e.child=a;a;)a.flags=a.flags&-3|4096,a=a.sibling;else{if(Ig(),c===h){e=$i(i,e,a);break e}Yi(i,e,c,a)}e=e.child}return e;case 5:return Kh(e),i===null&&Eg(e),c=e.type,h=e.pendingProps,d=i!==null?i.memoizedProps:null,et=h.children,Ef(c,h)?et=null:d!==null&&Ef(c,d)&&(e.flags|=32),hj(i,e),Yi(i,e,et,a),e.child;case 6:return i===null&&Eg(e),null;case 13:return pj(i,e,a);case 4:return Ih(e,e.stateNode.containerInfo),c=e.pendingProps,i===null?e.child=Bh(e,null,c,a):Yi(i,e,c,a),e.child;case 11:return c=e.type,h=e.pendingProps,h=e.elementType===c?h:Lg(c,h),Zi(i,e,c,h,a);case 7:return Yi(i,e,e.pendingProps,a),e.child;case 8:return Yi(i,e,e.pendingProps.children,a),e.child;case 12:return Yi(i,e,e.pendingProps.children,a),e.child;case 10:e:{if(c=e.type._context,h=e.pendingProps,d=e.memoizedProps,et=h.value,G$1(Mg,c._currentValue),c._currentValue=et,d!==null)if(He$1(d.value,et)){if(d.children===h.children&&!Wf.current){e=$i(i,e,a);break e}}else for(d=e.child,d!==null&&(d.return=e);d!==null;){var ft=d.dependencies;if(ft!==null){et=d.child;for(var gt=ft.firstContext;gt!==null;){if(gt.context===c){if(d.tag===1){gt=ch(-1,a&-a),gt.tag=2;var _t=d.updateQueue;if(_t!==null){_t=_t.shared;var wt=_t.pending;wt===null?gt.next=gt:(gt.next=wt.next,wt.next=gt),_t.pending=gt}}d.lanes|=a,gt=d.alternate,gt!==null&&(gt.lanes|=a),Sg(d.return,a,e),ft.lanes|=a;break}gt=gt.next}}else if(d.tag===10)et=d.type===e.type?null:d.child;else if(d.tag===18){if(et=d.return,et===null)throw Error(p(341));et.lanes|=a,ft=et.alternate,ft!==null&&(ft.lanes|=a),Sg(et,a,e),et=d.sibling}else et=d.child;if(et!==null)et.return=d;else for(et=d;et!==null;){if(et===e){et=null;break}if(d=et.sibling,d!==null){d.return=et.return,et=d;break}et=et.return}d=et}Yi(i,e,h.children,a),e=e.child}return e;case 9:return h=e.type,c=e.pendingProps.children,Tg(e,a),h=Vg$1(h),c=c(h),e.flags|=1,Yi(i,e,c,a),e.child;case 14:return c=e.type,h=Lg(c,e.pendingProps),h=Lg(c.type,h),aj(i,e,c,h,a);case 15:return cj(i,e,e.type,e.pendingProps,a);case 17:return c=e.type,h=e.pendingProps,h=e.elementType===c?h:Lg(c,h),jj(i,e),e.tag=1,Zf$1(c)?(i=!0,cg$1(e)):i=!1,Tg(e,a),ph(e,c,h),rh(e,c,h,a),kj(null,e,c,!0,i,a);case 19:return yj(i,e,a);case 22:return ej(i,e,a)}throw Error(p(156,e.tag))};function Gk(i,e){return ac(i,e)}function al$1(i,e,a,c){this.tag=i,this.key=a,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=c,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Bg(i,e,a,c){return new al$1(i,e,a,c)}function bj(i){return i=i.prototype,!(!i||!i.isReactComponent)}function $k(i){if(typeof i=="function")return bj(i)?1:0;if(i!=null){if(i=i.$$typeof,i===Da)return 11;if(i===Ga$1)return 14}return 2}function wh(i,e){var a=i.alternate;return a===null?(a=Bg(i.tag,e,i.key,i.mode),a.elementType=i.elementType,a.type=i.type,a.stateNode=i.stateNode,a.alternate=i,i.alternate=a):(a.pendingProps=e,a.type=i.type,a.flags=0,a.subtreeFlags=0,a.deletions=null),a.flags=i.flags&14680064,a.childLanes=i.childLanes,a.lanes=i.lanes,a.child=i.child,a.memoizedProps=i.memoizedProps,a.memoizedState=i.memoizedState,a.updateQueue=i.updateQueue,e=i.dependencies,a.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},a.sibling=i.sibling,a.index=i.index,a.ref=i.ref,a}function yh(i,e,a,c,h,d){var et=2;if(c=i,typeof i=="function")bj(i)&&(et=1);else if(typeof i=="string")et=5;else e:switch(i){case ya:return Ah(a.children,h,d,e);case za$1:et=8,h|=8;break;case Aa:return i=Bg(12,a,e,h|2),i.elementType=Aa,i.lanes=d,i;case Ea$1:return i=Bg(13,a,e,h),i.elementType=Ea$1,i.lanes=d,i;case Fa:return i=Bg(19,a,e,h),i.elementType=Fa,i.lanes=d,i;case Ia:return qj(a,h,d,e);default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case Ba:et=10;break e;case Ca:et=9;break e;case Da:et=11;break e;case Ga$1:et=14;break e;case Ha$1:et=16,c=null;break e}throw Error(p(130,i==null?i:typeof i,""))}return e=Bg(et,a,e,h),e.elementType=i,e.type=c,e.lanes=d,e}function Ah(i,e,a,c){return i=Bg(7,i,c,e),i.lanes=a,i}function qj(i,e,a,c){return i=Bg(22,i,c,e),i.elementType=Ia,i.lanes=a,i.stateNode={isHidden:!1},i}function xh(i,e,a){return i=Bg(6,i,null,e),i.lanes=a,i}function zh(i,e,a){return e=Bg(4,i.children!==null?i.children:[],i.key,e),e.lanes=a,e.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},e}function bl(i,e,a,c,h){this.tag=e,this.containerInfo=i,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=zc(0),this.expirationTimes=zc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=zc(0),this.identifierPrefix=c,this.onRecoverableError=h,this.mutableSourceEagerHydrationData=null}function cl$1(i,e,a,c,h,d,et,ft,gt){return i=new bl(i,e,a,ft,gt),e===1?(e=1,d===!0&&(e|=8)):e=0,d=Bg(3,null,null,e),i.current=d,d.stateNode=i,d.memoizedState={element:c,isDehydrated:a,cache:null,transitions:null,pendingSuspenseBoundaries:null},ah(d),i}function dl(i,e,a){var c=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:wa,key:c==null?null:""+c,children:i,containerInfo:e,implementation:a}}function el$1(i){if(!i)return Vf;i=i._reactInternals;e:{if(Vb$1(i)!==i||i.tag!==1)throw Error(p(170));var e=i;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Zf$1(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(p(171))}if(i.tag===1){var a=i.type;if(Zf$1(a))return bg(i,a,e)}return e}function fl(i,e,a,c,h,d,et,ft,gt){return i=cl$1(a,c,!0,i,h,d,et,ft,gt),i.context=el$1(null),a=i.current,c=L$1(),h=lh(a),d=ch(c,h),d.callback=e??null,dh(a,d,h),i.current.lanes=h,Ac$1(i,h,c),Ek(i,c),i}function gl(i,e,a,c){var h=e.current,d=L$1(),et=lh(h);return a=el$1(a),e.context===null?e.context=a:e.pendingContext=a,e=ch(d,et),e.payload={element:i},c=c===void 0?null:c,c!==null&&(e.callback=c),i=dh(h,e,et),i!==null&&(mh(i,h,et,d),eh(i,h,et)),et}function hl(i){if(i=i.current,!i.child)return null;switch(i.child.tag){case 5:return i.child.stateNode;default:return i.child.stateNode}}function il$1(i,e){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var a=i.retryLane;i.retryLane=a!==0&&a<e?a:e}}function jl$1(i,e){il$1(i,e),(i=i.alternate)&&il$1(i,e)}function kl$1(){return null}var ll=typeof reportError=="function"?reportError:function(i){console.error(i)};function ml(i){this._internalRoot=i}nl$1.prototype.render=ml.prototype.render=function(i){var e=this._internalRoot;if(e===null)throw Error(p(409));gl(i,e,null,null)};nl$1.prototype.unmount=ml.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var e=i.containerInfo;Sk(function(){gl(null,i,null,null)}),e[uf]=null}};function nl$1(i){this._internalRoot=i}nl$1.prototype.unstable_scheduleHydration=function(i){if(i){var e=Hc();i={blockedOn:null,target:i,priority:e};for(var a=0;a<Qc.length&&e!==0&&e<Qc[a].priority;a++);Qc.splice(a,0,i),a===0&&Vc(i)}};function ol(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function pl$1(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11&&(i.nodeType!==8||i.nodeValue!==" react-mount-point-unstable "))}function ql$1(){}function rl$1(i,e,a,c,h){if(h){if(typeof c=="function"){var d=c;c=function(){var _t=hl(et);d.call(_t)}}var et=fl(e,c,i,0,null,!1,!1,"",ql$1);return i._reactRootContainer=et,i[uf]=et.current,sf(i.nodeType===8?i.parentNode:i),Sk(),et}for(;h=i.lastChild;)i.removeChild(h);if(typeof c=="function"){var ft=c;c=function(){var _t=hl(gt);ft.call(_t)}}var gt=cl$1(i,0,!1,null,null,!1,!1,"",ql$1);return i._reactRootContainer=gt,i[uf]=gt.current,sf(i.nodeType===8?i.parentNode:i),Sk(function(){gl(e,gt,a,c)}),gt}function sl$1(i,e,a,c,h){var d=a._reactRootContainer;if(d){var et=d;if(typeof h=="function"){var ft=h;h=function(){var gt=hl(et);ft.call(gt)}}gl(e,et,i,h)}else et=rl$1(a,e,i,h,c);return hl(et)}Ec$1=function(i){switch(i.tag){case 3:var e=i.stateNode;if(e.current.memoizedState.isDehydrated){var a=tc$1(e.pendingLanes);a!==0&&(Cc$1(e,a|1),Ek(e,B$2()),!(K$1&6)&&(Hj=B$2()+500,jg()))}break;case 13:Sk(function(){var c=Zg$1(i,1);if(c!==null){var h=L$1();mh(c,i,1,h)}}),jl$1(i,1)}};Fc=function(i){if(i.tag===13){var e=Zg$1(i,134217728);if(e!==null){var a=L$1();mh(e,i,134217728,a)}jl$1(i,134217728)}};Gc=function(i){if(i.tag===13){var e=lh(i),a=Zg$1(i,e);if(a!==null){var c=L$1();mh(a,i,e,c)}jl$1(i,e)}};Hc=function(){return C$1};Ic$1=function(i,e){var a=C$1;try{return C$1=i,e()}finally{C$1=a}};yb=function(i,e,a){switch(e){case"input":if(bb(i,a),e=a.name,a.type==="radio"&&e!=null){for(a=i;a.parentNode;)a=a.parentNode;for(a=a.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<a.length;e++){var c=a[e];if(c!==i&&c.form===i.form){var h=Db(c);if(!h)throw Error(p(90));Wa(c),bb(c,h)}}}break;case"textarea":ib(i,a);break;case"select":e=a.value,e!=null&&fb(i,!!a.multiple,e,!1)}};Gb$1=Rk;Hb=Sk;var tl$1={usingClientEntryPoint:!1,Events:[Cb,ue$1,Db,Eb,Fb,Rk]},ul={findFiberByHostInstance:Wc,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},vl={bundleType:ul.bundleType,version:ul.version,rendererPackageName:ul.rendererPackageName,rendererConfig:ul.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ua.ReactCurrentDispatcher,findHostInstanceByFiber:function(i){return i=Zb(i),i===null?null:i.stateNode},findFiberByHostInstance:ul.findFiberByHostInstance||kl$1,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var wl$1=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!wl$1.isDisabled&&wl$1.supportsFiber)try{kc$1=wl$1.inject(vl),lc=wl$1}catch{}}reactDom_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tl$1;reactDom_production_min.createPortal=function(i,e){var a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!ol(e))throw Error(p(200));return dl(i,e,null,a)};reactDom_production_min.createRoot=function(i,e){if(!ol(i))throw Error(p(299));var a=!1,c="",h=ll;return e!=null&&(e.unstable_strictMode===!0&&(a=!0),e.identifierPrefix!==void 0&&(c=e.identifierPrefix),e.onRecoverableError!==void 0&&(h=e.onRecoverableError)),e=cl$1(i,1,!1,null,null,a,!1,c,h),i[uf]=e.current,sf(i.nodeType===8?i.parentNode:i),new ml(e)};reactDom_production_min.findDOMNode=function(i){if(i==null)return null;if(i.nodeType===1)return i;var e=i._reactInternals;if(e===void 0)throw typeof i.render=="function"?Error(p(188)):(i=Object.keys(i).join(","),Error(p(268,i)));return i=Zb(e),i=i===null?null:i.stateNode,i};reactDom_production_min.flushSync=function(i){return Sk(i)};reactDom_production_min.hydrate=function(i,e,a){if(!pl$1(e))throw Error(p(200));return sl$1(null,i,e,!0,a)};reactDom_production_min.hydrateRoot=function(i,e,a){if(!ol(i))throw Error(p(405));var c=a!=null&&a.hydratedSources||null,h=!1,d="",et=ll;if(a!=null&&(a.unstable_strictMode===!0&&(h=!0),a.identifierPrefix!==void 0&&(d=a.identifierPrefix),a.onRecoverableError!==void 0&&(et=a.onRecoverableError)),e=fl(e,null,i,1,a??null,h,!1,d,et),i[uf]=e.current,sf(i),c)for(i=0;i<c.length;i++)a=c[i],h=a._getVersion,h=h(a._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[a,h]:e.mutableSourceEagerHydrationData.push(a,h);return new nl$1(e)};reactDom_production_min.render=function(i,e,a){if(!pl$1(e))throw Error(p(200));return sl$1(null,i,e,!1,a)};reactDom_production_min.unmountComponentAtNode=function(i){if(!pl$1(i))throw Error(p(40));return i._reactRootContainer?(Sk(function(){sl$1(null,null,i,!1,function(){i._reactRootContainer=null,i[uf]=null})}),!0):!1};reactDom_production_min.unstable_batchedUpdates=Rk;reactDom_production_min.unstable_renderSubtreeIntoContainer=function(i,e,a,c){if(!pl$1(a))throw Error(p(200));if(i==null||i._reactInternals===void 0)throw Error(p(38));return sl$1(i,e,a,!1,c)};reactDom_production_min.version="18.2.0-next-9e3b772b8-20220608";function checkDCE(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(checkDCE)}catch(i){console.error(i)}}checkDCE(),reactDom.exports=reactDom_production_min;var reactDomExports=reactDom.exports;const index=getDefaultExportFromCjs(reactDomExports),ReactDOM=_mergeNamespaces({__proto__:null,default:index},[reactDomExports]);var m$2=reactDomExports;client.createRoot=m$2.createRoot,client.hydrateRoot=m$2.hydrateRoot;/**
 * @remix-run/router v1.15.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function _extends$2(){return _extends$2=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(i[c]=a[c])}return i},_extends$2.apply(this,arguments)}var Action;(function(i){i.Pop="POP",i.Push="PUSH",i.Replace="REPLACE"})(Action||(Action={}));const PopStateEventType="popstate";function createHashHistory(i){i===void 0&&(i={});function e(h,d){let{pathname:et="/",search:ft="",hash:gt=""}=parsePath(h.location.hash.substr(1));return!et.startsWith("/")&&!et.startsWith(".")&&(et="/"+et),createLocation("",{pathname:et,search:ft,hash:gt},d.state&&d.state.usr||null,d.state&&d.state.key||"default")}function a(h,d){let et=h.document.querySelector("base"),ft="";if(et&&et.getAttribute("href")){let gt=h.location.href,_t=gt.indexOf("#");ft=_t===-1?gt:gt.slice(0,_t)}return ft+"#"+(typeof d=="string"?d:createPath(d))}function c(h,d){warning(h.pathname.charAt(0)==="/","relative pathnames are not supported in hash history.push("+JSON.stringify(d)+")")}return getUrlBasedHistory(e,a,c,i)}function invariant(i,e){if(i===!1||i===null||typeof i>"u")throw new Error(e)}function warning(i,e){if(!i){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function createKey(){return Math.random().toString(36).substr(2,8)}function getHistoryState(i,e){return{usr:i.state,key:i.key,idx:e}}function createLocation(i,e,a,c){return a===void 0&&(a=null),_extends$2({pathname:typeof i=="string"?i:i.pathname,search:"",hash:""},typeof e=="string"?parsePath(e):e,{state:a,key:e&&e.key||c||createKey()})}function createPath(i){let{pathname:e="/",search:a="",hash:c=""}=i;return a&&a!=="?"&&(e+=a.charAt(0)==="?"?a:"?"+a),c&&c!=="#"&&(e+=c.charAt(0)==="#"?c:"#"+c),e}function parsePath(i){let e={};if(i){let a=i.indexOf("#");a>=0&&(e.hash=i.substr(a),i=i.substr(0,a));let c=i.indexOf("?");c>=0&&(e.search=i.substr(c),i=i.substr(0,c)),i&&(e.pathname=i)}return e}function getUrlBasedHistory(i,e,a,c){c===void 0&&(c={});let{window:h=document.defaultView,v5Compat:d=!1}=c,et=h.history,ft=Action.Pop,gt=null,_t=wt();_t==null&&(_t=0,et.replaceState(_extends$2({},et.state,{idx:_t}),""));function wt(){return(et.state||{idx:null}).idx}function $t(){ft=Action.Pop;let kt=wt(),xt=kt==null?null:kt-_t;_t=kt,gt&&gt({action:ft,location:At.location,delta:xt})}function It(kt,xt){ft=Action.Push;let Nt=createLocation(At.location,kt,xt);a&&a(Nt,kt),_t=wt()+1;let Ft=getHistoryState(Nt,_t),jt=At.createHref(Nt);try{et.pushState(Ft,"",jt)}catch(Gt){if(Gt instanceof DOMException&&Gt.name==="DataCloneError")throw Gt;h.location.assign(jt)}d&&gt&&gt({action:ft,location:At.location,delta:1})}function Rt(kt,xt){ft=Action.Replace;let Nt=createLocation(At.location,kt,xt);a&&a(Nt,kt),_t=wt();let Ft=getHistoryState(Nt,_t),jt=At.createHref(Nt);et.replaceState(Ft,"",jt),d&&gt&&gt({action:ft,location:At.location,delta:0})}function Tt(kt){let xt=h.location.origin!=="null"?h.location.origin:h.location.href,Nt=typeof kt=="string"?kt:createPath(kt);return Nt=Nt.replace(/ $/,"%20"),invariant(xt,"No window.location.(origin|href) available to create URL for href: "+Nt),new URL(Nt,xt)}let At={get action(){return ft},get location(){return i(h,et)},listen(kt){if(gt)throw new Error("A history only accepts one active listener");return h.addEventListener(PopStateEventType,$t),gt=kt,()=>{h.removeEventListener(PopStateEventType,$t),gt=null}},createHref(kt){return e(h,kt)},createURL:Tt,encodeLocation(kt){let xt=Tt(kt);return{pathname:xt.pathname,search:xt.search,hash:xt.hash}},push:It,replace:Rt,go(kt){return et.go(kt)}};return At}var ResultType;(function(i){i.data="data",i.deferred="deferred",i.redirect="redirect",i.error="error"})(ResultType||(ResultType={}));const immutableRouteKeys=new Set(["lazy","caseSensitive","path","id","index","children"]);function isIndexRoute(i){return i.index===!0}function convertRoutesToDataRoutes(i,e,a,c){return a===void 0&&(a=[]),c===void 0&&(c={}),i.map((h,d)=>{let et=[...a,d],ft=typeof h.id=="string"?h.id:et.join("-");if(invariant(h.index!==!0||!h.children,"Cannot specify children on an index route"),invariant(!c[ft],'Found a route id collision on id "'+ft+`".  Route id's must be globally unique within Data Router usages`),isIndexRoute(h)){let gt=_extends$2({},h,e(h),{id:ft});return c[ft]=gt,gt}else{let gt=_extends$2({},h,e(h),{id:ft,children:void 0});return c[ft]=gt,h.children&&(gt.children=convertRoutesToDataRoutes(h.children,e,et,c)),gt}})}function matchRoutes(i,e,a){a===void 0&&(a="/");let c=typeof e=="string"?parsePath(e):e,h=stripBasename(c.pathname||"/",a);if(h==null)return null;let d=flattenRoutes(i);rankRouteBranches(d);let et=null;for(let ft=0;et==null&&ft<d.length;++ft){let gt=decodePath$1(h);et=matchRouteBranch(d[ft],gt)}return et}function convertRouteMatchToUiMatch(i,e){let{route:a,pathname:c,params:h}=i;return{id:a.id,pathname:c,params:h,data:e[a.id],handle:a.handle}}function flattenRoutes(i,e,a,c){e===void 0&&(e=[]),a===void 0&&(a=[]),c===void 0&&(c="");let h=(d,et,ft)=>{let gt={relativePath:ft===void 0?d.path||"":ft,caseSensitive:d.caseSensitive===!0,childrenIndex:et,route:d};gt.relativePath.startsWith("/")&&(invariant(gt.relativePath.startsWith(c),'Absolute route path "'+gt.relativePath+'" nested under path '+('"'+c+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),gt.relativePath=gt.relativePath.slice(c.length));let _t=joinPaths([c,gt.relativePath]),wt=a.concat(gt);d.children&&d.children.length>0&&(invariant(d.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+_t+'".')),flattenRoutes(d.children,e,wt,_t)),!(d.path==null&&!d.index)&&e.push({path:_t,score:computeScore$1(_t,d.index),routesMeta:wt})};return i.forEach((d,et)=>{var ft;if(d.path===""||!((ft=d.path)!=null&&ft.includes("?")))h(d,et);else for(let gt of explodeOptionalSegments(d.path))h(d,et,gt)}),e}function explodeOptionalSegments(i){let e=i.split("/");if(e.length===0)return[];let[a,...c]=e,h=a.endsWith("?"),d=a.replace(/\?$/,"");if(c.length===0)return h?[d,""]:[d];let et=explodeOptionalSegments(c.join("/")),ft=[];return ft.push(...et.map(gt=>gt===""?d:[d,gt].join("/"))),h&&ft.push(...et),ft.map(gt=>i.startsWith("/")&&gt===""?"/":gt)}function rankRouteBranches(i){i.sort((e,a)=>e.score!==a.score?a.score-e.score:compareIndexes(e.routesMeta.map(c=>c.childrenIndex),a.routesMeta.map(c=>c.childrenIndex)))}const paramRe=/^:[\w-]+$/,dynamicSegmentValue=3,indexRouteValue=2,emptySegmentValue=1,staticSegmentValue=10,splatPenalty=-2,isSplat=i=>i==="*";function computeScore$1(i,e){let a=i.split("/"),c=a.length;return a.some(isSplat)&&(c+=splatPenalty),e&&(c+=indexRouteValue),a.filter(h=>!isSplat(h)).reduce((h,d)=>h+(paramRe.test(d)?dynamicSegmentValue:d===""?emptySegmentValue:staticSegmentValue),c)}function compareIndexes(i,e){return i.length===e.length&&i.slice(0,-1).every((c,h)=>c===e[h])?i[i.length-1]-e[e.length-1]:0}function matchRouteBranch(i,e){let{routesMeta:a}=i,c={},h="/",d=[];for(let et=0;et<a.length;++et){let ft=a[et],gt=et===a.length-1,_t=h==="/"?e:e.slice(h.length)||"/",wt=matchPath({path:ft.relativePath,caseSensitive:ft.caseSensitive,end:gt},_t);if(!wt)return null;Object.assign(c,wt.params);let $t=ft.route;d.push({params:c,pathname:joinPaths([h,wt.pathname]),pathnameBase:normalizePathname(joinPaths([h,wt.pathnameBase])),route:$t}),wt.pathnameBase!=="/"&&(h=joinPaths([h,wt.pathnameBase]))}return d}function matchPath(i,e){typeof i=="string"&&(i={path:i,caseSensitive:!1,end:!0});let[a,c]=compilePath(i.path,i.caseSensitive,i.end),h=e.match(a);if(!h)return null;let d=h[0],et=d.replace(/(.)\/+$/,"$1"),ft=h.slice(1);return{params:c.reduce((_t,wt,$t)=>{let{paramName:It,isOptional:Rt}=wt;if(It==="*"){let At=ft[$t]||"";et=d.slice(0,d.length-At.length).replace(/(.)\/+$/,"$1")}const Tt=ft[$t];return Rt&&!Tt?_t[It]=void 0:_t[It]=(Tt||"").replace(/%2F/g,"/"),_t},{}),pathname:d,pathnameBase:et,pattern:i}}function compilePath(i,e,a){e===void 0&&(e=!1),a===void 0&&(a=!0),warning(i==="*"||!i.endsWith("*")||i.endsWith("/*"),'Route path "'+i+'" will be treated as if it were '+('"'+i.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+i.replace(/\*$/,"/*")+'".'));let c=[],h="^"+i.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(et,ft,gt)=>(c.push({paramName:ft,isOptional:gt!=null}),gt?"/?([^\\/]+)?":"/([^\\/]+)"));return i.endsWith("*")?(c.push({paramName:"*"}),h+=i==="*"||i==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):a?h+="\\/*$":i!==""&&i!=="/"&&(h+="(?:(?=\\/|$))"),[new RegExp(h,e?void 0:"i"),c]}function decodePath$1(i){try{return i.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return warning(!1,'The URL path "'+i+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),i}}function stripBasename(i,e){if(e==="/")return i;if(!i.toLowerCase().startsWith(e.toLowerCase()))return null;let a=e.endsWith("/")?e.length-1:e.length,c=i.charAt(a);return c&&c!=="/"?null:i.slice(a)||"/"}function resolvePath(i,e){e===void 0&&(e="/");let{pathname:a,search:c="",hash:h=""}=typeof i=="string"?parsePath(i):i;return{pathname:a?a.startsWith("/")?a:resolvePathname(a,e):e,search:normalizeSearch(c),hash:normalizeHash(h)}}function resolvePathname(i,e){let a=e.replace(/\/+$/,"").split("/");return i.split("/").forEach(h=>{h===".."?a.length>1&&a.pop():h!=="."&&a.push(h)}),a.length>1?a.join("/"):"/"}function getInvalidPathError(i,e,a,c){return"Cannot include a '"+i+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(c)+"].  Please separate it out to the ")+("`to."+a+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function getPathContributingMatches(i){return i.filter((e,a)=>a===0||e.route.path&&e.route.path.length>0)}function getResolveToMatches(i,e){let a=getPathContributingMatches(i);return e?a.map((c,h)=>h===i.length-1?c.pathname:c.pathnameBase):a.map(c=>c.pathnameBase)}function resolveTo(i,e,a,c){c===void 0&&(c=!1);let h;typeof i=="string"?h=parsePath(i):(h=_extends$2({},i),invariant(!h.pathname||!h.pathname.includes("?"),getInvalidPathError("?","pathname","search",h)),invariant(!h.pathname||!h.pathname.includes("#"),getInvalidPathError("#","pathname","hash",h)),invariant(!h.search||!h.search.includes("#"),getInvalidPathError("#","search","hash",h)));let d=i===""||h.pathname==="",et=d?"/":h.pathname,ft;if(et==null)ft=a;else{let $t=e.length-1;if(!c&&et.startsWith("..")){let It=et.split("/");for(;It[0]==="..";)It.shift(),$t-=1;h.pathname=It.join("/")}ft=$t>=0?e[$t]:"/"}let gt=resolvePath(h,ft),_t=et&&et!=="/"&&et.endsWith("/"),wt=(d||et===".")&&a.endsWith("/");return!gt.pathname.endsWith("/")&&(_t||wt)&&(gt.pathname+="/"),gt}const joinPaths=i=>i.join("/").replace(/\/\/+/g,"/"),normalizePathname=i=>i.replace(/\/+$/,"").replace(/^\/*/,"/"),normalizeSearch=i=>!i||i==="?"?"":i.startsWith("?")?i:"?"+i,normalizeHash=i=>!i||i==="#"?"":i.startsWith("#")?i:"#"+i;class ErrorResponseImpl{constructor(e,a,c,h){h===void 0&&(h=!1),this.status=e,this.statusText=a||"",this.internal=h,c instanceof Error?(this.data=c.toString(),this.error=c):this.data=c}}function isRouteErrorResponse(i){return i!=null&&typeof i.status=="number"&&typeof i.statusText=="string"&&typeof i.internal=="boolean"&&"data"in i}const validMutationMethodsArr=["post","put","patch","delete"],validMutationMethods=new Set(validMutationMethodsArr),validRequestMethodsArr=["get",...validMutationMethodsArr],validRequestMethods=new Set(validRequestMethodsArr),redirectStatusCodes=new Set([301,302,303,307,308]),redirectPreserveMethodStatusCodes=new Set([307,308]),IDLE_NAVIGATION={state:"idle",location:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},IDLE_FETCHER={state:"idle",data:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},IDLE_BLOCKER={state:"unblocked",proceed:void 0,reset:void 0,location:void 0},ABSOLUTE_URL_REGEX$1=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,defaultMapRouteProperties=i=>({hasErrorBoundary:!!i.hasErrorBoundary}),TRANSITIONS_STORAGE_KEY="remix-router-transitions";function createRouter(i){const e=i.window?i.window:typeof window<"u"?window:void 0,a=typeof e<"u"&&typeof e.document<"u"&&typeof e.document.createElement<"u",c=!a;invariant(i.routes.length>0,"You must provide a non-empty routes array to createRouter");let h;if(i.mapRouteProperties)h=i.mapRouteProperties;else if(i.detectErrorBoundary){let jr=i.detectErrorBoundary;h=qr=>({hasErrorBoundary:jr(qr)})}else h=defaultMapRouteProperties;let d={},et=convertRoutesToDataRoutes(i.routes,h,void 0,d),ft,gt=i.basename||"/",_t=_extends$2({v7_fetcherPersist:!1,v7_normalizeFormMethod:!1,v7_partialHydration:!1,v7_prependBasename:!1,v7_relativeSplatPath:!1},i.future),wt=null,$t=new Set,It=null,Rt=null,Tt=null,At=i.hydrationData!=null,kt=matchRoutes(et,i.history.location,gt),xt=null;if(kt==null){let jr=getInternalRouterError(404,{pathname:i.history.location.pathname}),{matches:qr,route:Zr}=getShortCircuitMatches(et);kt=qr,xt={[Zr.id]:jr}}let Nt,Ft=kt.some(jr=>jr.route.lazy),jt=kt.some(jr=>jr.route.loader);if(Ft)Nt=!1;else if(!jt)Nt=!0;else if(_t.v7_partialHydration){let jr=i.hydrationData?i.hydrationData.loaderData:null,qr=i.hydrationData?i.hydrationData.errors:null,Zr=dn=>dn.route.loader?dn.route.loader.hydrate===!0?!1:jr&&jr[dn.route.id]!==void 0||qr&&qr[dn.route.id]!==void 0:!0;if(qr){let dn=kt.findIndex(cn=>qr[cn.route.id]!==void 0);Nt=kt.slice(0,dn+1).every(Zr)}else Nt=kt.every(Zr)}else Nt=i.hydrationData!=null;let Gt,Kt={historyAction:i.history.action,location:i.history.location,matches:kt,initialized:Nt,navigation:IDLE_NAVIGATION,restoreScrollPosition:i.hydrationData!=null?!1:null,preventScrollReset:!1,revalidation:"idle",loaderData:i.hydrationData&&i.hydrationData.loaderData||{},actionData:i.hydrationData&&i.hydrationData.actionData||null,errors:i.hydrationData&&i.hydrationData.errors||xt,fetchers:new Map,blockers:new Map},Wt=Action.Pop,Zt=!1,cr,hr=!1,gr=new Map,er=null,mr=!1,Mr=!1,wr=[],Dr=[],Tr=new Map,fr=0,yr=-1,$r=new Map,Fr=new Set,dr=new Map,Br=new Map,Hr=new Set,Jr=new Map,zr=new Map,br=!1;function _r(){if(wt=i.history.listen(jr=>{let{action:qr,location:Zr,delta:dn}=jr;if(br){br=!1;return}warning(zr.size===0||dn!=null,"You are trying to use a blocker on a POP navigation to a location that was not created by @remix-run/router. This will fail silently in production. This can happen if you are navigating outside the router via `window.history.pushState`/`window.location.hash` instead of using router navigation APIs.  This can also happen if you are using createHashRouter and the user manually changes the URL.");let cn=fn({currentLocation:Kt.location,nextLocation:Zr,historyAction:qr});if(cn&&dn!=null){br=!0,i.history.go(dn*-1),rn(cn,{state:"blocked",location:Zr,proceed(){rn(cn,{state:"proceeding",proceed:void 0,reset:void 0,location:Zr}),i.history.go(dn)},reset(){let Sn=new Map(Kt.blockers);Sn.set(cn,IDLE_BLOCKER),Cr({blockers:Sn})}});return}return vr(qr,Zr)}),a){restoreAppliedTransitions(e,gr);let jr=()=>persistAppliedTransitions(e,gr);e.addEventListener("pagehide",jr),er=()=>e.removeEventListener("pagehide",jr)}return Kt.initialized||vr(Action.Pop,Kt.location,{initialHydration:!0}),Gt}function Vr(){wt&&wt(),er&&er(),$t.clear(),cr&&cr.abort(),Kt.fetchers.forEach((jr,qr)=>Vt(qr)),Kt.blockers.forEach((jr,qr)=>nn(qr))}function lr(jr){return $t.add(jr),()=>$t.delete(jr)}function Cr(jr,qr){qr===void 0&&(qr={}),Kt=_extends$2({},Kt,jr);let Zr=[],dn=[];_t.v7_fetcherPersist&&Kt.fetchers.forEach((cn,Sn)=>{cn.state==="idle"&&(Hr.has(Sn)?dn.push(Sn):Zr.push(Sn))}),[...$t].forEach(cn=>cn(Kt,{deletedFetchers:dn,unstable_viewTransitionOpts:qr.viewTransitionOpts,unstable_flushSync:qr.flushSync===!0})),_t.v7_fetcherPersist&&(Zr.forEach(cn=>Kt.fetchers.delete(cn)),dn.forEach(cn=>Vt(cn)))}function xr(jr,qr,Zr){var dn,cn;let{flushSync:Sn}=Zr===void 0?{}:Zr,$n=Kt.actionData!=null&&Kt.navigation.formMethod!=null&&isMutationMethod(Kt.navigation.formMethod)&&Kt.navigation.state==="loading"&&((dn=jr.state)==null?void 0:dn._isRedirect)!==!0,En;qr.actionData?Object.keys(qr.actionData).length>0?En=qr.actionData:En=null:$n?En=Kt.actionData:En=null;let wn=qr.loaderData?mergeLoaderData(Kt.loaderData,qr.loaderData,qr.matches||[],qr.errors):Kt.loaderData,Cn=Kt.blockers;Cn.size>0&&(Cn=new Map(Cn),Cn.forEach((Pn,Un)=>Cn.set(Un,IDLE_BLOCKER)));let Nn=Zt===!0||Kt.navigation.formMethod!=null&&isMutationMethod(Kt.navigation.formMethod)&&((cn=jr.state)==null?void 0:cn._isRedirect)!==!0;ft&&(et=ft,ft=void 0),mr||Wt===Action.Pop||(Wt===Action.Push?i.history.push(jr,jr.state):Wt===Action.Replace&&i.history.replace(jr,jr.state));let Rn;if(Wt===Action.Pop){let Pn=gr.get(Kt.location.pathname);Pn&&Pn.has(jr.pathname)?Rn={currentLocation:Kt.location,nextLocation:jr}:gr.has(jr.pathname)&&(Rn={currentLocation:jr,nextLocation:Kt.location})}else if(hr){let Pn=gr.get(Kt.location.pathname);Pn?Pn.add(jr.pathname):(Pn=new Set([jr.pathname]),gr.set(Kt.location.pathname,Pn)),Rn={currentLocation:Kt.location,nextLocation:jr}}Cr(_extends$2({},qr,{actionData:En,loaderData:wn,historyAction:Wt,location:jr,initialized:!0,navigation:IDLE_NAVIGATION,revalidation:"idle",restoreScrollPosition:xn(jr,qr.matches||Kt.matches),preventScrollReset:Nn,blockers:Cn}),{viewTransitionOpts:Rn,flushSync:Sn===!0}),Wt=Action.Pop,Zt=!1,hr=!1,mr=!1,Mr=!1,wr=[],Dr=[]}async function Kr(jr,qr){if(typeof jr=="number"){i.history.go(jr);return}let Zr=normalizeTo(Kt.location,Kt.matches,gt,_t.v7_prependBasename,jr,_t.v7_relativeSplatPath,qr==null?void 0:qr.fromRouteId,qr==null?void 0:qr.relative),{path:dn,submission:cn,error:Sn}=normalizeNavigateOptions(_t.v7_normalizeFormMethod,!1,Zr,qr),$n=Kt.location,En=createLocation(Kt.location,dn,qr&&qr.state);En=_extends$2({},En,i.history.encodeLocation(En));let wn=qr&&qr.replace!=null?qr.replace:void 0,Cn=Action.Push;wn===!0?Cn=Action.Replace:wn===!1||cn!=null&&isMutationMethod(cn.formMethod)&&cn.formAction===Kt.location.pathname+Kt.location.search&&(Cn=Action.Replace);let Nn=qr&&"preventScrollReset"in qr?qr.preventScrollReset===!0:void 0,Rn=(qr&&qr.unstable_flushSync)===!0,Pn=fn({currentLocation:$n,nextLocation:En,historyAction:Cn});if(Pn){rn(Pn,{state:"blocked",location:En,proceed(){rn(Pn,{state:"proceeding",proceed:void 0,reset:void 0,location:En}),Kr(jr,qr)},reset(){let Un=new Map(Kt.blockers);Un.set(Pn,IDLE_BLOCKER),Cr({blockers:Un})}});return}return await vr(Cn,En,{submission:cn,pendingError:Sn,preventScrollReset:Nn,replace:qr&&qr.replace,enableViewTransition:qr&&qr.unstable_viewTransition,flushSync:Rn})}function Gr(){if(pn(),Cr({revalidation:"loading"}),Kt.navigation.state!=="submitting"){if(Kt.navigation.state==="idle"){vr(Kt.historyAction,Kt.location,{startUninterruptedRevalidation:!0});return}vr(Wt||Kt.historyAction,Kt.navigation.location,{overrideNavigation:Kt.navigation})}}async function vr(jr,qr,Zr){cr&&cr.abort(),cr=null,Wt=jr,mr=(Zr&&Zr.startUninterruptedRevalidation)===!0,Vn(Kt.location,Kt.matches),Zt=(Zr&&Zr.preventScrollReset)===!0,hr=(Zr&&Zr.enableViewTransition)===!0;let dn=ft||et,cn=Zr&&Zr.overrideNavigation,Sn=matchRoutes(dn,qr,gt),$n=(Zr&&Zr.flushSync)===!0;if(!Sn){let Un=getInternalRouterError(404,{pathname:qr.pathname}),{matches:Wn,route:Bn}=getShortCircuitMatches(dn);bn(),xr(qr,{matches:Wn,loaderData:{},errors:{[Bn.id]:Un}},{flushSync:$n});return}if(Kt.initialized&&!Mr&&isHashChangeOnly(Kt.location,qr)&&!(Zr&&Zr.submission&&isMutationMethod(Zr.submission.formMethod))){xr(qr,{matches:Sn},{flushSync:$n});return}cr=new AbortController;let En=createClientSideRequest(i.history,qr,cr.signal,Zr&&Zr.submission),wn,Cn;if(Zr&&Zr.pendingError)Cn={[findNearestBoundary(Sn).route.id]:Zr.pendingError};else if(Zr&&Zr.submission&&isMutationMethod(Zr.submission.formMethod)){let Un=await Nr(En,qr,Zr.submission,Sn,{replace:Zr.replace,flushSync:$n});if(Un.shortCircuited)return;wn=Un.pendingActionData,Cn=Un.pendingActionError,cn=getLoadingNavigation(qr,Zr.submission),$n=!1,En=new Request(En.url,{signal:En.signal})}let{shortCircuited:Nn,loaderData:Rn,errors:Pn}=await Pr(En,qr,Sn,cn,Zr&&Zr.submission,Zr&&Zr.fetcherSubmission,Zr&&Zr.replace,Zr&&Zr.initialHydration===!0,$n,wn,Cn);Nn||(cr=null,xr(qr,_extends$2({matches:Sn},wn?{actionData:wn}:{},{loaderData:Rn,errors:Pn})))}async function Nr(jr,qr,Zr,dn,cn){cn===void 0&&(cn={}),pn();let Sn=getSubmittingNavigation(qr,Zr);Cr({navigation:Sn},{flushSync:cn.flushSync===!0});let $n,En=getTargetMatch(dn,qr);if(!En.route.action&&!En.route.lazy)$n={type:ResultType.error,error:getInternalRouterError(405,{method:jr.method,pathname:qr.pathname,routeId:En.route.id})};else if($n=await callLoaderOrAction("action",jr,En,dn,d,h,gt,_t.v7_relativeSplatPath),jr.signal.aborted)return{shortCircuited:!0};if(isRedirectResult($n)){let wn;return cn&&cn.replace!=null?wn=cn.replace:wn=$n.location===Kt.location.pathname+Kt.location.search,await Xr(Kt,$n,{submission:Zr,replace:wn}),{shortCircuited:!0}}if(isErrorResult($n)){let wn=findNearestBoundary(dn,En.route.id);return(cn&&cn.replace)!==!0&&(Wt=Action.Push),{pendingActionData:{},pendingActionError:{[wn.route.id]:$n.error}}}if(isDeferredResult($n))throw getInternalRouterError(400,{type:"defer-action"});return{pendingActionData:{[En.route.id]:$n.data}}}async function Pr(jr,qr,Zr,dn,cn,Sn,$n,En,wn,Cn,Nn){let Rn=dn||getLoadingNavigation(qr,cn),Pn=cn||Sn||getSubmissionFromNavigation(Rn),Un=ft||et,[Wn,Bn]=getMatchesToLoad(i.history,Kt,Zr,Pn,qr,_t.v7_partialHydration&&En===!0,Mr,wr,Dr,Hr,dr,Fr,Un,gt,Cn,Nn);if(bn(An=>!(Zr&&Zr.some(kn=>kn.route.id===An))||Wn&&Wn.some(kn=>kn.route.id===An)),yr=++fr,Wn.length===0&&Bn.length===0){let An=pr();return xr(qr,_extends$2({matches:Zr,loaderData:{},errors:Nn||null},Cn?{actionData:Cn}:{},An?{fetchers:new Map(Kt.fetchers)}:{}),{flushSync:wn}),{shortCircuited:!0}}if(!mr&&(!_t.v7_partialHydration||!En)){Bn.forEach(kn=>{let Hn=Kt.fetchers.get(kn.key),vs=getLoadingFetcher(void 0,Hn?Hn.data:void 0);Kt.fetchers.set(kn.key,vs)});let An=Cn||Kt.actionData;Cr(_extends$2({navigation:Rn},An?Object.keys(An).length===0?{actionData:null}:{actionData:An}:{},Bn.length>0?{fetchers:new Map(Kt.fetchers)}:{}),{flushSync:wn})}Bn.forEach(An=>{Tr.has(An.key)&&Er(An.key),An.controller&&Tr.set(An.key,An.controller)});let ts=()=>Bn.forEach(An=>Er(An.key));cr&&cr.signal.addEventListener("abort",ts);let{results:Is,loaderResults:rs,fetcherResults:Jn}=await hn(Kt.matches,Zr,Wn,Bn,jr);if(jr.signal.aborted)return{shortCircuited:!0};cr&&cr.signal.removeEventListener("abort",ts),Bn.forEach(An=>Tr.delete(An.key));let Zn=findRedirect(Is);if(Zn){if(Zn.idx>=Wn.length){let An=Bn[Zn.idx-Wn.length].key;Fr.add(An)}return await Xr(Kt,Zn.result,{replace:$n}),{shortCircuited:!0}}let{loaderData:Ts,errors:cs}=processLoaderData(Kt,Zr,Wn,rs,Nn,Bn,Jn,Jr);Jr.forEach((An,kn)=>{An.subscribe(Hn=>{(Hn||An.done)&&Jr.delete(kn)})}),_t.v7_partialHydration&&En&&Kt.errors&&Object.entries(Kt.errors).filter(An=>{let[kn]=An;return!Wn.some(Hn=>Hn.route.id===kn)}).forEach(An=>{let[kn,Hn]=An;cs=Object.assign(cs||{},{[kn]:Hn})});let Cs=pr(),is=Rr(yr),bs=Cs||is||Bn.length>0;return _extends$2({loaderData:Ts,errors:cs},bs?{fetchers:new Map(Kt.fetchers)}:{})}function en(jr,qr,Zr,dn){if(c)throw new Error("router.fetch() was called during the server render, but it shouldn't be. You are likely calling a useFetcher() method in the body of your component. Try moving it to a useEffect or a callback.");Tr.has(jr)&&Er(jr);let cn=(dn&&dn.unstable_flushSync)===!0,Sn=ft||et,$n=normalizeTo(Kt.location,Kt.matches,gt,_t.v7_prependBasename,Zr,_t.v7_relativeSplatPath,qr,dn==null?void 0:dn.relative),En=matchRoutes(Sn,$n,gt);if(!En){Tn(jr,qr,getInternalRouterError(404,{pathname:$n}),{flushSync:cn});return}let{path:wn,submission:Cn,error:Nn}=normalizeNavigateOptions(_t.v7_normalizeFormMethod,!0,$n,dn);if(Nn){Tn(jr,qr,Nn,{flushSync:cn});return}let Rn=getTargetMatch(En,wn);if(Zt=(dn&&dn.preventScrollReset)===!0,Cn&&isMutationMethod(Cn.formMethod)){Wr(jr,qr,wn,Rn,En,cn,Cn);return}dr.set(jr,{routeId:qr,path:wn}),Or(jr,qr,wn,Rn,En,cn,Cn)}async function Wr(jr,qr,Zr,dn,cn,Sn,$n){if(pn(),dr.delete(jr),!dn.route.action&&!dn.route.lazy){let kn=getInternalRouterError(405,{method:$n.formMethod,pathname:Zr,routeId:qr});Tn(jr,qr,kn,{flushSync:Sn});return}let En=Kt.fetchers.get(jr);vn(jr,getSubmittingFetcher($n,En),{flushSync:Sn});let wn=new AbortController,Cn=createClientSideRequest(i.history,Zr,wn.signal,$n);Tr.set(jr,wn);let Nn=fr,Rn=await callLoaderOrAction("action",Cn,dn,cn,d,h,gt,_t.v7_relativeSplatPath);if(Cn.signal.aborted){Tr.get(jr)===wn&&Tr.delete(jr);return}if(_t.v7_fetcherPersist&&Hr.has(jr)){if(isRedirectResult(Rn)||isErrorResult(Rn)){vn(jr,getDoneFetcher(void 0));return}}else{if(isRedirectResult(Rn))if(Tr.delete(jr),yr>Nn){vn(jr,getDoneFetcher(void 0));return}else return Fr.add(jr),vn(jr,getLoadingFetcher($n)),Xr(Kt,Rn,{fetcherSubmission:$n});if(isErrorResult(Rn)){Tn(jr,qr,Rn.error);return}}if(isDeferredResult(Rn))throw getInternalRouterError(400,{type:"defer-action"});let Pn=Kt.navigation.location||Kt.location,Un=createClientSideRequest(i.history,Pn,wn.signal),Wn=ft||et,Bn=Kt.navigation.state!=="idle"?matchRoutes(Wn,Kt.navigation.location,gt):Kt.matches;invariant(Bn,"Didn't find any matches after fetcher action");let ts=++fr;$r.set(jr,ts);let Is=getLoadingFetcher($n,Rn.data);Kt.fetchers.set(jr,Is);let[rs,Jn]=getMatchesToLoad(i.history,Kt,Bn,$n,Pn,!1,Mr,wr,Dr,Hr,dr,Fr,Wn,gt,{[dn.route.id]:Rn.data},void 0);Jn.filter(kn=>kn.key!==jr).forEach(kn=>{let Hn=kn.key,vs=Kt.fetchers.get(Hn),Ls=getLoadingFetcher(void 0,vs?vs.data:void 0);Kt.fetchers.set(Hn,Ls),Tr.has(Hn)&&Er(Hn),kn.controller&&Tr.set(Hn,kn.controller)}),Cr({fetchers:new Map(Kt.fetchers)});let Zn=()=>Jn.forEach(kn=>Er(kn.key));wn.signal.addEventListener("abort",Zn);let{results:Ts,loaderResults:cs,fetcherResults:Cs}=await hn(Kt.matches,Bn,rs,Jn,Un);if(wn.signal.aborted)return;wn.signal.removeEventListener("abort",Zn),$r.delete(jr),Tr.delete(jr),Jn.forEach(kn=>Tr.delete(kn.key));let is=findRedirect(Ts);if(is){if(is.idx>=rs.length){let kn=Jn[is.idx-rs.length].key;Fr.add(kn)}return Xr(Kt,is.result)}let{loaderData:bs,errors:An}=processLoaderData(Kt,Kt.matches,rs,cs,void 0,Jn,Cs,Jr);if(Kt.fetchers.has(jr)){let kn=getDoneFetcher(Rn.data);Kt.fetchers.set(jr,kn)}Rr(ts),Kt.navigation.state==="loading"&&ts>yr?(invariant(Wt,"Expected pending action"),cr&&cr.abort(),xr(Kt.navigation.location,{matches:Bn,loaderData:bs,errors:An,fetchers:new Map(Kt.fetchers)})):(Cr({errors:An,loaderData:mergeLoaderData(Kt.loaderData,bs,Bn,An),fetchers:new Map(Kt.fetchers)}),Mr=!1)}async function Or(jr,qr,Zr,dn,cn,Sn,$n){let En=Kt.fetchers.get(jr);vn(jr,getLoadingFetcher($n,En?En.data:void 0),{flushSync:Sn});let wn=new AbortController,Cn=createClientSideRequest(i.history,Zr,wn.signal);Tr.set(jr,wn);let Nn=fr,Rn=await callLoaderOrAction("loader",Cn,dn,cn,d,h,gt,_t.v7_relativeSplatPath);if(isDeferredResult(Rn)&&(Rn=await resolveDeferredData(Rn,Cn.signal,!0)||Rn),Tr.get(jr)===wn&&Tr.delete(jr),!Cn.signal.aborted){if(Hr.has(jr)){vn(jr,getDoneFetcher(void 0));return}if(isRedirectResult(Rn))if(yr>Nn){vn(jr,getDoneFetcher(void 0));return}else{Fr.add(jr),await Xr(Kt,Rn);return}if(isErrorResult(Rn)){Tn(jr,qr,Rn.error);return}invariant(!isDeferredResult(Rn),"Unhandled fetcher deferred data"),vn(jr,getDoneFetcher(Rn.data))}}async function Xr(jr,qr,Zr){let{submission:dn,fetcherSubmission:cn,replace:Sn}=Zr===void 0?{}:Zr;qr.revalidate&&(Mr=!0);let $n=createLocation(jr.location,qr.location,{_isRedirect:!0});if(invariant($n,"Expected a location on the redirect navigation"),a){let Pn=!1;if(qr.reloadDocument)Pn=!0;else if(ABSOLUTE_URL_REGEX$1.test(qr.location)){const Un=i.history.createURL(qr.location);Pn=Un.origin!==e.location.origin||stripBasename(Un.pathname,gt)==null}if(Pn){Sn?e.location.replace(qr.location):e.location.assign(qr.location);return}}cr=null;let En=Sn===!0?Action.Replace:Action.Push,{formMethod:wn,formAction:Cn,formEncType:Nn}=jr.navigation;!dn&&!cn&&wn&&Cn&&Nn&&(dn=getSubmissionFromNavigation(jr.navigation));let Rn=dn||cn;if(redirectPreserveMethodStatusCodes.has(qr.status)&&Rn&&isMutationMethod(Rn.formMethod))await vr(En,$n,{submission:_extends$2({},Rn,{formAction:qr.location}),preventScrollReset:Zt});else{let Pn=getLoadingNavigation($n,dn);await vr(En,$n,{overrideNavigation:Pn,fetcherSubmission:cn,preventScrollReset:Zt})}}async function hn(jr,qr,Zr,dn,cn){let Sn=await Promise.all([...Zr.map(wn=>callLoaderOrAction("loader",cn,wn,qr,d,h,gt,_t.v7_relativeSplatPath)),...dn.map(wn=>wn.matches&&wn.match&&wn.controller?callLoaderOrAction("loader",createClientSideRequest(i.history,wn.path,wn.controller.signal),wn.match,wn.matches,d,h,gt,_t.v7_relativeSplatPath):{type:ResultType.error,error:getInternalRouterError(404,{pathname:wn.path})})]),$n=Sn.slice(0,Zr.length),En=Sn.slice(Zr.length);return await Promise.all([resolveDeferredResults(jr,Zr,$n,$n.map(()=>cn.signal),!1,Kt.loaderData),resolveDeferredResults(jr,dn.map(wn=>wn.match),En,dn.map(wn=>wn.controller?wn.controller.signal:null),!0)]),{results:Sn,loaderResults:$n,fetcherResults:En}}function pn(){Mr=!0,wr.push(...bn()),dr.forEach((jr,qr)=>{Tr.has(qr)&&(Dr.push(qr),Er(qr))})}function vn(jr,qr,Zr){Zr===void 0&&(Zr={}),Kt.fetchers.set(jr,qr),Cr({fetchers:new Map(Kt.fetchers)},{flushSync:(Zr&&Zr.flushSync)===!0})}function Tn(jr,qr,Zr,dn){dn===void 0&&(dn={});let cn=findNearestBoundary(Kt.matches,qr);Vt(jr),Cr({errors:{[cn.route.id]:Zr},fetchers:new Map(Kt.fetchers)},{flushSync:(dn&&dn.flushSync)===!0})}function Ht(jr){return _t.v7_fetcherPersist&&(Br.set(jr,(Br.get(jr)||0)+1),Hr.has(jr)&&Hr.delete(jr)),Kt.fetchers.get(jr)||IDLE_FETCHER}function Vt(jr){let qr=Kt.fetchers.get(jr);Tr.has(jr)&&!(qr&&qr.state==="loading"&&$r.has(jr))&&Er(jr),dr.delete(jr),$r.delete(jr),Fr.delete(jr),Hr.delete(jr),Kt.fetchers.delete(jr)}function Xt(jr){if(_t.v7_fetcherPersist){let qr=(Br.get(jr)||0)-1;qr<=0?(Br.delete(jr),Hr.add(jr)):Br.set(jr,qr)}else Vt(jr);Cr({fetchers:new Map(Kt.fetchers)})}function Er(jr){let qr=Tr.get(jr);invariant(qr,"Expected fetch controller: "+jr),qr.abort(),Tr.delete(jr)}function Sr(jr){for(let qr of jr){let Zr=Ht(qr),dn=getDoneFetcher(Zr.data);Kt.fetchers.set(qr,dn)}}function pr(){let jr=[],qr=!1;for(let Zr of Fr){let dn=Kt.fetchers.get(Zr);invariant(dn,"Expected fetcher: "+Zr),dn.state==="loading"&&(Fr.delete(Zr),jr.push(Zr),qr=!0)}return Sr(jr),qr}function Rr(jr){let qr=[];for(let[Zr,dn]of $r)if(dn<jr){let cn=Kt.fetchers.get(Zr);invariant(cn,"Expected fetcher: "+Zr),cn.state==="loading"&&(Er(Zr),$r.delete(Zr),qr.push(Zr))}return Sr(qr),qr.length>0}function Qr(jr,qr){let Zr=Kt.blockers.get(jr)||IDLE_BLOCKER;return zr.get(jr)!==qr&&zr.set(jr,qr),Zr}function nn(jr){Kt.blockers.delete(jr),zr.delete(jr)}function rn(jr,qr){let Zr=Kt.blockers.get(jr)||IDLE_BLOCKER;invariant(Zr.state==="unblocked"&&qr.state==="blocked"||Zr.state==="blocked"&&qr.state==="blocked"||Zr.state==="blocked"&&qr.state==="proceeding"||Zr.state==="blocked"&&qr.state==="unblocked"||Zr.state==="proceeding"&&qr.state==="unblocked","Invalid blocker state transition: "+Zr.state+" -> "+qr.state);let dn=new Map(Kt.blockers);dn.set(jr,qr),Cr({blockers:dn})}function fn(jr){let{currentLocation:qr,nextLocation:Zr,historyAction:dn}=jr;if(zr.size===0)return;zr.size>1&&warning(!1,"A router only supports one blocker at a time");let cn=Array.from(zr.entries()),[Sn,$n]=cn[cn.length-1],En=Kt.blockers.get(Sn);if(!(En&&En.state==="proceeding")&&$n({currentLocation:qr,nextLocation:Zr,historyAction:dn}))return Sn}function bn(jr){let qr=[];return Jr.forEach((Zr,dn)=>{(!jr||jr(dn))&&(Zr.cancel(),qr.push(dn),Jr.delete(dn))}),qr}function In(jr,qr,Zr){if(It=jr,Tt=qr,Rt=Zr||null,!At&&Kt.navigation===IDLE_NAVIGATION){At=!0;let dn=xn(Kt.location,Kt.matches);dn!=null&&Cr({restoreScrollPosition:dn})}return()=>{It=null,Tt=null,Rt=null}}function On(jr,qr){return Rt&&Rt(jr,qr.map(dn=>convertRouteMatchToUiMatch(dn,Kt.loaderData)))||jr.key}function Vn(jr,qr){if(It&&Tt){let Zr=On(jr,qr);It[Zr]=Tt()}}function xn(jr,qr){if(It){let Zr=On(jr,qr),dn=It[Zr];if(typeof dn=="number")return dn}return null}function jn(jr){d={},ft=convertRoutesToDataRoutes(jr,h,void 0,d)}return Gt={get basename(){return gt},get future(){return _t},get state(){return Kt},get routes(){return et},get window(){return e},initialize:_r,subscribe:lr,enableScrollRestoration:In,navigate:Kr,fetch:en,revalidate:Gr,createHref:jr=>i.history.createHref(jr),encodeLocation:jr=>i.history.encodeLocation(jr),getFetcher:Ht,deleteFetcher:Xt,dispose:Vr,getBlocker:Qr,deleteBlocker:nn,_internalFetchControllers:Tr,_internalActiveDeferreds:Jr,_internalSetRoutes:jn},Gt}function isSubmissionNavigation(i){return i!=null&&("formData"in i&&i.formData!=null||"body"in i&&i.body!==void 0)}function normalizeTo(i,e,a,c,h,d,et,ft){let gt,_t;if(et){gt=[];for(let $t of e)if(gt.push($t),$t.route.id===et){_t=$t;break}}else gt=e,_t=e[e.length-1];let wt=resolveTo(h||".",getResolveToMatches(gt,d),stripBasename(i.pathname,a)||i.pathname,ft==="path");return h==null&&(wt.search=i.search,wt.hash=i.hash),(h==null||h===""||h===".")&&_t&&_t.route.index&&!hasNakedIndexQuery(wt.search)&&(wt.search=wt.search?wt.search.replace(/^\?/,"?index&"):"?index"),c&&a!=="/"&&(wt.pathname=wt.pathname==="/"?a:joinPaths([a,wt.pathname])),createPath(wt)}function normalizeNavigateOptions(i,e,a,c){if(!c||!isSubmissionNavigation(c))return{path:a};if(c.formMethod&&!isValidMethod(c.formMethod))return{path:a,error:getInternalRouterError(405,{method:c.formMethod})};let h=()=>({path:a,error:getInternalRouterError(400,{type:"invalid-body"})}),d=c.formMethod||"get",et=i?d.toUpperCase():d.toLowerCase(),ft=stripHashFromPath(a);if(c.body!==void 0){if(c.formEncType==="text/plain"){if(!isMutationMethod(et))return h();let It=typeof c.body=="string"?c.body:c.body instanceof FormData||c.body instanceof URLSearchParams?Array.from(c.body.entries()).reduce((Rt,Tt)=>{let[At,kt]=Tt;return""+Rt+At+"="+kt+`
`},""):String(c.body);return{path:a,submission:{formMethod:et,formAction:ft,formEncType:c.formEncType,formData:void 0,json:void 0,text:It}}}else if(c.formEncType==="application/json"){if(!isMutationMethod(et))return h();try{let It=typeof c.body=="string"?JSON.parse(c.body):c.body;return{path:a,submission:{formMethod:et,formAction:ft,formEncType:c.formEncType,formData:void 0,json:It,text:void 0}}}catch{return h()}}}invariant(typeof FormData=="function","FormData is not available in this environment");let gt,_t;if(c.formData)gt=convertFormDataToSearchParams(c.formData),_t=c.formData;else if(c.body instanceof FormData)gt=convertFormDataToSearchParams(c.body),_t=c.body;else if(c.body instanceof URLSearchParams)gt=c.body,_t=convertSearchParamsToFormData(gt);else if(c.body==null)gt=new URLSearchParams,_t=new FormData;else try{gt=new URLSearchParams(c.body),_t=convertSearchParamsToFormData(gt)}catch{return h()}let wt={formMethod:et,formAction:ft,formEncType:c&&c.formEncType||"application/x-www-form-urlencoded",formData:_t,json:void 0,text:void 0};if(isMutationMethod(wt.formMethod))return{path:a,submission:wt};let $t=parsePath(a);return e&&$t.search&&hasNakedIndexQuery($t.search)&&gt.append("index",""),$t.search="?"+gt,{path:createPath($t),submission:wt}}function getLoaderMatchesUntilBoundary(i,e){let a=i;if(e){let c=i.findIndex(h=>h.route.id===e);c>=0&&(a=i.slice(0,c))}return a}function getMatchesToLoad(i,e,a,c,h,d,et,ft,gt,_t,wt,$t,It,Rt,Tt,At){let kt=At?Object.values(At)[0]:Tt?Object.values(Tt)[0]:void 0,xt=i.createURL(e.location),Nt=i.createURL(h),Ft=At?Object.keys(At)[0]:void 0,Gt=getLoaderMatchesUntilBoundary(a,Ft).filter((Wt,Zt)=>{let{route:cr}=Wt;if(cr.lazy)return!0;if(cr.loader==null)return!1;if(d)return cr.loader.hydrate?!0:e.loaderData[cr.id]===void 0&&(!e.errors||e.errors[cr.id]===void 0);if(isNewLoader(e.loaderData,e.matches[Zt],Wt)||ft.some(er=>er===Wt.route.id))return!0;let hr=e.matches[Zt],gr=Wt;return shouldRevalidateLoader(Wt,_extends$2({currentUrl:xt,currentParams:hr.params,nextUrl:Nt,nextParams:gr.params},c,{actionResult:kt,defaultShouldRevalidate:et||xt.pathname+xt.search===Nt.pathname+Nt.search||xt.search!==Nt.search||isNewRouteInstance(hr,gr)}))}),Kt=[];return wt.forEach((Wt,Zt)=>{if(d||!a.some(mr=>mr.route.id===Wt.routeId)||_t.has(Zt))return;let cr=matchRoutes(It,Wt.path,Rt);if(!cr){Kt.push({key:Zt,routeId:Wt.routeId,path:Wt.path,matches:null,match:null,controller:null});return}let hr=e.fetchers.get(Zt),gr=getTargetMatch(cr,Wt.path),er=!1;$t.has(Zt)?er=!1:gt.includes(Zt)?er=!0:hr&&hr.state!=="idle"&&hr.data===void 0?er=et:er=shouldRevalidateLoader(gr,_extends$2({currentUrl:xt,currentParams:e.matches[e.matches.length-1].params,nextUrl:Nt,nextParams:a[a.length-1].params},c,{actionResult:kt,defaultShouldRevalidate:et})),er&&Kt.push({key:Zt,routeId:Wt.routeId,path:Wt.path,matches:cr,match:gr,controller:new AbortController})}),[Gt,Kt]}function isNewLoader(i,e,a){let c=!e||a.route.id!==e.route.id,h=i[a.route.id]===void 0;return c||h}function isNewRouteInstance(i,e){let a=i.route.path;return i.pathname!==e.pathname||a!=null&&a.endsWith("*")&&i.params["*"]!==e.params["*"]}function shouldRevalidateLoader(i,e){if(i.route.shouldRevalidate){let a=i.route.shouldRevalidate(e);if(typeof a=="boolean")return a}return e.defaultShouldRevalidate}async function loadLazyRouteModule(i,e,a){if(!i.lazy)return;let c=await i.lazy();if(!i.lazy)return;let h=a[i.id];invariant(h,"No route found in manifest");let d={};for(let et in c){let gt=h[et]!==void 0&&et!=="hasErrorBoundary";warning(!gt,'Route "'+h.id+'" has a static property "'+et+'" defined but its lazy function is also returning a value for this property. '+('The lazy route property "'+et+'" will be ignored.')),!gt&&!immutableRouteKeys.has(et)&&(d[et]=c[et])}Object.assign(h,d),Object.assign(h,_extends$2({},e(h),{lazy:void 0}))}async function callLoaderOrAction(i,e,a,c,h,d,et,ft,gt){gt===void 0&&(gt={});let _t,wt,$t,It=At=>{let kt,xt=new Promise((Nt,Ft)=>kt=Ft);return $t=()=>kt(),e.signal.addEventListener("abort",$t),Promise.race([At({request:e,params:a.params,context:gt.requestContext}),xt])};try{let At=a.route[i];if(a.route.lazy)if(At){let kt,xt=await Promise.all([It(At).catch(Nt=>{kt=Nt}),loadLazyRouteModule(a.route,d,h)]);if(kt)throw kt;wt=xt[0]}else if(await loadLazyRouteModule(a.route,d,h),At=a.route[i],At)wt=await It(At);else if(i==="action"){let kt=new URL(e.url),xt=kt.pathname+kt.search;throw getInternalRouterError(405,{method:e.method,pathname:xt,routeId:a.route.id})}else return{type:ResultType.data,data:void 0};else if(At)wt=await It(At);else{let kt=new URL(e.url),xt=kt.pathname+kt.search;throw getInternalRouterError(404,{pathname:xt})}invariant(wt!==void 0,"You defined "+(i==="action"?"an action":"a loader")+" for route "+('"'+a.route.id+"\" but didn't return anything from your `"+i+"` ")+"function. Please return a value or `null`.")}catch(At){_t=ResultType.error,wt=At}finally{$t&&e.signal.removeEventListener("abort",$t)}if(isResponse(wt)){let At=wt.status;if(redirectStatusCodes.has(At)){let xt=wt.headers.get("Location");if(invariant(xt,"Redirects returned/thrown from loaders/actions must have a Location header"),!ABSOLUTE_URL_REGEX$1.test(xt))xt=normalizeTo(new URL(e.url),c.slice(0,c.indexOf(a)+1),et,!0,xt,ft);else if(!gt.isStaticRequest){let Nt=new URL(e.url),Ft=xt.startsWith("//")?new URL(Nt.protocol+xt):new URL(xt),jt=stripBasename(Ft.pathname,et)!=null;Ft.origin===Nt.origin&&jt&&(xt=Ft.pathname+Ft.search+Ft.hash)}if(gt.isStaticRequest)throw wt.headers.set("Location",xt),wt;return{type:ResultType.redirect,status:At,location:xt,revalidate:wt.headers.get("X-Remix-Revalidate")!==null,reloadDocument:wt.headers.get("X-Remix-Reload-Document")!==null}}if(gt.isRouteRequest)throw{type:_t===ResultType.error?ResultType.error:ResultType.data,response:wt};let kt;try{let xt=wt.headers.get("Content-Type");xt&&/\bapplication\/json\b/.test(xt)?wt.body==null?kt=null:kt=await wt.json():kt=await wt.text()}catch(xt){return{type:ResultType.error,error:xt}}return _t===ResultType.error?{type:_t,error:new ErrorResponseImpl(At,wt.statusText,kt),headers:wt.headers}:{type:ResultType.data,data:kt,statusCode:wt.status,headers:wt.headers}}if(_t===ResultType.error)return{type:_t,error:wt};if(isDeferredData(wt)){var Rt,Tt;return{type:ResultType.deferred,deferredData:wt,statusCode:(Rt=wt.init)==null?void 0:Rt.status,headers:((Tt=wt.init)==null?void 0:Tt.headers)&&new Headers(wt.init.headers)}}return{type:ResultType.data,data:wt}}function createClientSideRequest(i,e,a,c){let h=i.createURL(stripHashFromPath(e)).toString(),d={signal:a};if(c&&isMutationMethod(c.formMethod)){let{formMethod:et,formEncType:ft}=c;d.method=et.toUpperCase(),ft==="application/json"?(d.headers=new Headers({"Content-Type":ft}),d.body=JSON.stringify(c.json)):ft==="text/plain"?d.body=c.text:ft==="application/x-www-form-urlencoded"&&c.formData?d.body=convertFormDataToSearchParams(c.formData):d.body=c.formData}return new Request(h,d)}function convertFormDataToSearchParams(i){let e=new URLSearchParams;for(let[a,c]of i.entries())e.append(a,typeof c=="string"?c:c.name);return e}function convertSearchParamsToFormData(i){let e=new FormData;for(let[a,c]of i.entries())e.append(a,c);return e}function processRouteLoaderData(i,e,a,c,h){let d={},et=null,ft,gt=!1,_t={};return a.forEach((wt,$t)=>{let It=e[$t].route.id;if(invariant(!isRedirectResult(wt),"Cannot handle redirect results in processLoaderData"),isErrorResult(wt)){let Rt=findNearestBoundary(i,It),Tt=wt.error;c&&(Tt=Object.values(c)[0],c=void 0),et=et||{},et[Rt.route.id]==null&&(et[Rt.route.id]=Tt),d[It]=void 0,gt||(gt=!0,ft=isRouteErrorResponse(wt.error)?wt.error.status:500),wt.headers&&(_t[It]=wt.headers)}else isDeferredResult(wt)?(h.set(It,wt.deferredData),d[It]=wt.deferredData.data):d[It]=wt.data,wt.statusCode!=null&&wt.statusCode!==200&&!gt&&(ft=wt.statusCode),wt.headers&&(_t[It]=wt.headers)}),c&&(et=c,d[Object.keys(c)[0]]=void 0),{loaderData:d,errors:et,statusCode:ft||200,loaderHeaders:_t}}function processLoaderData(i,e,a,c,h,d,et,ft){let{loaderData:gt,errors:_t}=processRouteLoaderData(e,a,c,h,ft);for(let wt=0;wt<d.length;wt++){let{key:$t,match:It,controller:Rt}=d[wt];invariant(et!==void 0&&et[wt]!==void 0,"Did not find corresponding fetcher result");let Tt=et[wt];if(!(Rt&&Rt.signal.aborted))if(isErrorResult(Tt)){let At=findNearestBoundary(i.matches,It==null?void 0:It.route.id);_t&&_t[At.route.id]||(_t=_extends$2({},_t,{[At.route.id]:Tt.error})),i.fetchers.delete($t)}else if(isRedirectResult(Tt))invariant(!1,"Unhandled fetcher revalidation redirect");else if(isDeferredResult(Tt))invariant(!1,"Unhandled fetcher deferred data");else{let At=getDoneFetcher(Tt.data);i.fetchers.set($t,At)}}return{loaderData:gt,errors:_t}}function mergeLoaderData(i,e,a,c){let h=_extends$2({},e);for(let d of a){let et=d.route.id;if(e.hasOwnProperty(et)?e[et]!==void 0&&(h[et]=e[et]):i[et]!==void 0&&d.route.loader&&(h[et]=i[et]),c&&c.hasOwnProperty(et))break}return h}function findNearestBoundary(i,e){return(e?i.slice(0,i.findIndex(c=>c.route.id===e)+1):[...i]).reverse().find(c=>c.route.hasErrorBoundary===!0)||i[0]}function getShortCircuitMatches(i){let e=i.length===1?i[0]:i.find(a=>a.index||!a.path||a.path==="/")||{id:"__shim-error-route__"};return{matches:[{params:{},pathname:"",pathnameBase:"",route:e}],route:e}}function getInternalRouterError(i,e){let{pathname:a,routeId:c,method:h,type:d}=e===void 0?{}:e,et="Unknown Server Error",ft="Unknown @remix-run/router error";return i===400?(et="Bad Request",h&&a&&c?ft="You made a "+h+' request to "'+a+'" but '+('did not provide a `loader` for route "'+c+'", ')+"so there is no way to handle the request.":d==="defer-action"?ft="defer() is not supported in actions":d==="invalid-body"&&(ft="Unable to encode submission body")):i===403?(et="Forbidden",ft='Route "'+c+'" does not match URL "'+a+'"'):i===404?(et="Not Found",ft='No route matches URL "'+a+'"'):i===405&&(et="Method Not Allowed",h&&a&&c?ft="You made a "+h.toUpperCase()+' request to "'+a+'" but '+('did not provide an `action` for route "'+c+'", ')+"so there is no way to handle the request.":h&&(ft='Invalid request method "'+h.toUpperCase()+'"')),new ErrorResponseImpl(i||500,et,new Error(ft),!0)}function findRedirect(i){for(let e=i.length-1;e>=0;e--){let a=i[e];if(isRedirectResult(a))return{result:a,idx:e}}}function stripHashFromPath(i){let e=typeof i=="string"?parsePath(i):i;return createPath(_extends$2({},e,{hash:""}))}function isHashChangeOnly(i,e){return i.pathname!==e.pathname||i.search!==e.search?!1:i.hash===""?e.hash!=="":i.hash===e.hash?!0:e.hash!==""}function isDeferredResult(i){return i.type===ResultType.deferred}function isErrorResult(i){return i.type===ResultType.error}function isRedirectResult(i){return(i&&i.type)===ResultType.redirect}function isDeferredData(i){let e=i;return e&&typeof e=="object"&&typeof e.data=="object"&&typeof e.subscribe=="function"&&typeof e.cancel=="function"&&typeof e.resolveData=="function"}function isResponse(i){return i!=null&&typeof i.status=="number"&&typeof i.statusText=="string"&&typeof i.headers=="object"&&typeof i.body<"u"}function isValidMethod(i){return validRequestMethods.has(i.toLowerCase())}function isMutationMethod(i){return validMutationMethods.has(i.toLowerCase())}async function resolveDeferredResults(i,e,a,c,h,d){for(let et=0;et<a.length;et++){let ft=a[et],gt=e[et];if(!gt)continue;let _t=i.find($t=>$t.route.id===gt.route.id),wt=_t!=null&&!isNewRouteInstance(_t,gt)&&(d&&d[gt.route.id])!==void 0;if(isDeferredResult(ft)&&(h||wt)){let $t=c[et];invariant($t,"Expected an AbortSignal for revalidating fetcher deferred result"),await resolveDeferredData(ft,$t,h).then(It=>{It&&(a[et]=It||a[et])})}}}async function resolveDeferredData(i,e,a){if(a===void 0&&(a=!1),!await i.deferredData.resolveData(e)){if(a)try{return{type:ResultType.data,data:i.deferredData.unwrappedData}}catch(h){return{type:ResultType.error,error:h}}return{type:ResultType.data,data:i.deferredData.data}}}function hasNakedIndexQuery(i){return new URLSearchParams(i).getAll("index").some(e=>e==="")}function getTargetMatch(i,e){let a=typeof e=="string"?parsePath(e).search:e.search;if(i[i.length-1].route.index&&hasNakedIndexQuery(a||""))return i[i.length-1];let c=getPathContributingMatches(i);return c[c.length-1]}function getSubmissionFromNavigation(i){let{formMethod:e,formAction:a,formEncType:c,text:h,formData:d,json:et}=i;if(!(!e||!a||!c)){if(h!=null)return{formMethod:e,formAction:a,formEncType:c,formData:void 0,json:void 0,text:h};if(d!=null)return{formMethod:e,formAction:a,formEncType:c,formData:d,json:void 0,text:void 0};if(et!==void 0)return{formMethod:e,formAction:a,formEncType:c,formData:void 0,json:et,text:void 0}}}function getLoadingNavigation(i,e){return e?{state:"loading",location:i,formMethod:e.formMethod,formAction:e.formAction,formEncType:e.formEncType,formData:e.formData,json:e.json,text:e.text}:{state:"loading",location:i,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0}}function getSubmittingNavigation(i,e){return{state:"submitting",location:i,formMethod:e.formMethod,formAction:e.formAction,formEncType:e.formEncType,formData:e.formData,json:e.json,text:e.text}}function getLoadingFetcher(i,e){return i?{state:"loading",formMethod:i.formMethod,formAction:i.formAction,formEncType:i.formEncType,formData:i.formData,json:i.json,text:i.text,data:e}:{state:"loading",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:e}}function getSubmittingFetcher(i,e){return{state:"submitting",formMethod:i.formMethod,formAction:i.formAction,formEncType:i.formEncType,formData:i.formData,json:i.json,text:i.text,data:e?e.data:void 0}}function getDoneFetcher(i){return{state:"idle",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:i}}function restoreAppliedTransitions(i,e){try{let a=i.sessionStorage.getItem(TRANSITIONS_STORAGE_KEY);if(a){let c=JSON.parse(a);for(let[h,d]of Object.entries(c||{}))d&&Array.isArray(d)&&e.set(h,new Set(d||[]))}}catch{}}function persistAppliedTransitions(i,e){if(e.size>0){let a={};for(let[c,h]of e)a[c]=[...h];try{i.sessionStorage.setItem(TRANSITIONS_STORAGE_KEY,JSON.stringify(a))}catch(c){warning(!1,"Failed to save applied view transitions in sessionStorage ("+c+").")}}}/**
 * React Router v6.22.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function _extends$1(){return _extends$1=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(i[c]=a[c])}return i},_extends$1.apply(this,arguments)}const DataRouterContext=reactExports.createContext(null),DataRouterStateContext=reactExports.createContext(null),NavigationContext=reactExports.createContext(null),LocationContext=reactExports.createContext(null),RouteContext=reactExports.createContext({outlet:null,matches:[],isDataRoute:!1}),RouteErrorContext=reactExports.createContext(null);function useHref(i,e){let{relative:a}=e===void 0?{}:e;useInRouterContext()||invariant(!1);let{basename:c,navigator:h}=reactExports.useContext(NavigationContext),{hash:d,pathname:et,search:ft}=useResolvedPath(i,{relative:a}),gt=et;return c!=="/"&&(gt=et==="/"?c:joinPaths([c,et])),h.createHref({pathname:gt,search:ft,hash:d})}function useInRouterContext(){return reactExports.useContext(LocationContext)!=null}function useLocation(){return useInRouterContext()||invariant(!1),reactExports.useContext(LocationContext).location}function useIsomorphicLayoutEffect(i){reactExports.useContext(NavigationContext).static||reactExports.useLayoutEffect(i)}function useNavigate(){let{isDataRoute:i}=reactExports.useContext(RouteContext);return i?useNavigateStable():useNavigateUnstable()}function useNavigateUnstable(){useInRouterContext()||invariant(!1);let i=reactExports.useContext(DataRouterContext),{basename:e,future:a,navigator:c}=reactExports.useContext(NavigationContext),{matches:h}=reactExports.useContext(RouteContext),{pathname:d}=useLocation(),et=JSON.stringify(getResolveToMatches(h,a.v7_relativeSplatPath)),ft=reactExports.useRef(!1);return useIsomorphicLayoutEffect(()=>{ft.current=!0}),reactExports.useCallback(function(_t,wt){if(wt===void 0&&(wt={}),!ft.current)return;if(typeof _t=="number"){c.go(_t);return}let $t=resolveTo(_t,JSON.parse(et),d,wt.relative==="path");i==null&&e!=="/"&&($t.pathname=$t.pathname==="/"?e:joinPaths([e,$t.pathname])),(wt.replace?c.replace:c.push)($t,wt.state,wt)},[e,c,et,d,i])}const OutletContext=reactExports.createContext(null);function useOutlet(i){let e=reactExports.useContext(RouteContext).outlet;return e&&reactExports.createElement(OutletContext.Provider,{value:i},e)}function useResolvedPath(i,e){let{relative:a}=e===void 0?{}:e,{future:c}=reactExports.useContext(NavigationContext),{matches:h}=reactExports.useContext(RouteContext),{pathname:d}=useLocation(),et=JSON.stringify(getResolveToMatches(h,c.v7_relativeSplatPath));return reactExports.useMemo(()=>resolveTo(i,JSON.parse(et),d,a==="path"),[i,et,d,a])}function useRoutesImpl(i,e,a,c){useInRouterContext()||invariant(!1);let{navigator:h}=reactExports.useContext(NavigationContext),{matches:d}=reactExports.useContext(RouteContext),et=d[d.length-1],ft=et?et.params:{};et&&et.pathname;let gt=et?et.pathnameBase:"/";et&&et.route;let _t=useLocation(),wt;if(e){var $t;let kt=typeof e=="string"?parsePath(e):e;gt==="/"||($t=kt.pathname)!=null&&$t.startsWith(gt)||invariant(!1),wt=kt}else wt=_t;let It=wt.pathname||"/",Rt=It;if(gt!=="/"){let kt=gt.replace(/^\//,"").split("/");Rt="/"+It.replace(/^\//,"").split("/").slice(kt.length).join("/")}let Tt=matchRoutes(i,{pathname:Rt}),At=_renderMatches(Tt&&Tt.map(kt=>Object.assign({},kt,{params:Object.assign({},ft,kt.params),pathname:joinPaths([gt,h.encodeLocation?h.encodeLocation(kt.pathname).pathname:kt.pathname]),pathnameBase:kt.pathnameBase==="/"?gt:joinPaths([gt,h.encodeLocation?h.encodeLocation(kt.pathnameBase).pathname:kt.pathnameBase])})),d,a,c);return e&&At?reactExports.createElement(LocationContext.Provider,{value:{location:_extends$1({pathname:"/",search:"",hash:"",state:null,key:"default"},wt),navigationType:Action.Pop}},At):At}function DefaultErrorComponent(){let i=useRouteError(),e=isRouteErrorResponse(i)?i.status+" "+i.statusText:i instanceof Error?i.message:JSON.stringify(i),a=i instanceof Error?i.stack:null,h={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return reactExports.createElement(reactExports.Fragment,null,reactExports.createElement("h2",null,"Unexpected Application Error!"),reactExports.createElement("h3",{style:{fontStyle:"italic"}},e),a?reactExports.createElement("pre",{style:h},a):null,null)}const defaultErrorElement=reactExports.createElement(DefaultErrorComponent,null);class RenderErrorBoundary extends reactExports.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,a){return a.location!==e.location||a.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:a.error,location:a.location,revalidation:e.revalidation||a.revalidation}}componentDidCatch(e,a){console.error("React Router caught the following error during render",e,a)}render(){return this.state.error!==void 0?reactExports.createElement(RouteContext.Provider,{value:this.props.routeContext},reactExports.createElement(RouteErrorContext.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function RenderedRoute(i){let{routeContext:e,match:a,children:c}=i,h=reactExports.useContext(DataRouterContext);return h&&h.static&&h.staticContext&&(a.route.errorElement||a.route.ErrorBoundary)&&(h.staticContext._deepestRenderedBoundaryId=a.route.id),reactExports.createElement(RouteContext.Provider,{value:e},c)}function _renderMatches(i,e,a,c){var h;if(e===void 0&&(e=[]),a===void 0&&(a=null),c===void 0&&(c=null),i==null){var d;if((d=a)!=null&&d.errors)i=a.matches;else return null}let et=i,ft=(h=a)==null?void 0:h.errors;if(ft!=null){let wt=et.findIndex($t=>$t.route.id&&(ft==null?void 0:ft[$t.route.id]));wt>=0||invariant(!1),et=et.slice(0,Math.min(et.length,wt+1))}let gt=!1,_t=-1;if(a&&c&&c.v7_partialHydration)for(let wt=0;wt<et.length;wt++){let $t=et[wt];if(($t.route.HydrateFallback||$t.route.hydrateFallbackElement)&&(_t=wt),$t.route.id){let{loaderData:It,errors:Rt}=a,Tt=$t.route.loader&&It[$t.route.id]===void 0&&(!Rt||Rt[$t.route.id]===void 0);if($t.route.lazy||Tt){gt=!0,_t>=0?et=et.slice(0,_t+1):et=[et[0]];break}}}return et.reduceRight((wt,$t,It)=>{let Rt,Tt=!1,At=null,kt=null;a&&(Rt=ft&&$t.route.id?ft[$t.route.id]:void 0,At=$t.route.errorElement||defaultErrorElement,gt&&(_t<0&&It===0?(warningOnce("route-fallback",!1),Tt=!0,kt=null):_t===It&&(Tt=!0,kt=$t.route.hydrateFallbackElement||null)));let xt=e.concat(et.slice(0,It+1)),Nt=()=>{let Ft;return Rt?Ft=At:Tt?Ft=kt:$t.route.Component?Ft=reactExports.createElement($t.route.Component,null):$t.route.element?Ft=$t.route.element:Ft=wt,reactExports.createElement(RenderedRoute,{match:$t,routeContext:{outlet:wt,matches:xt,isDataRoute:a!=null},children:Ft})};return a&&($t.route.ErrorBoundary||$t.route.errorElement||It===0)?reactExports.createElement(RenderErrorBoundary,{location:a.location,revalidation:a.revalidation,component:At,error:Rt,children:Nt(),routeContext:{outlet:null,matches:xt,isDataRoute:!0}}):Nt()},null)}var DataRouterHook$1=function(i){return i.UseBlocker="useBlocker",i.UseRevalidator="useRevalidator",i.UseNavigateStable="useNavigate",i}(DataRouterHook$1||{}),DataRouterStateHook$1=function(i){return i.UseBlocker="useBlocker",i.UseLoaderData="useLoaderData",i.UseActionData="useActionData",i.UseRouteError="useRouteError",i.UseNavigation="useNavigation",i.UseRouteLoaderData="useRouteLoaderData",i.UseMatches="useMatches",i.UseRevalidator="useRevalidator",i.UseNavigateStable="useNavigate",i.UseRouteId="useRouteId",i}(DataRouterStateHook$1||{});function useDataRouterContext(i){let e=reactExports.useContext(DataRouterContext);return e||invariant(!1),e}function useDataRouterState(i){let e=reactExports.useContext(DataRouterStateContext);return e||invariant(!1),e}function useRouteContext(i){let e=reactExports.useContext(RouteContext);return e||invariant(!1),e}function useCurrentRouteId(i){let e=useRouteContext(),a=e.matches[e.matches.length-1];return a.route.id||invariant(!1),a.route.id}function useRouteError(){var i;let e=reactExports.useContext(RouteErrorContext),a=useDataRouterState(DataRouterStateHook$1.UseRouteError),c=useCurrentRouteId(DataRouterStateHook$1.UseRouteError);return e!==void 0?e:(i=a.errors)==null?void 0:i[c]}function useNavigateStable(){let{router:i}=useDataRouterContext(DataRouterHook$1.UseNavigateStable),e=useCurrentRouteId(DataRouterStateHook$1.UseNavigateStable),a=reactExports.useRef(!1);return useIsomorphicLayoutEffect(()=>{a.current=!0}),reactExports.useCallback(function(h,d){d===void 0&&(d={}),a.current&&(typeof h=="number"?i.navigate(h):i.navigate(h,_extends$1({fromRouteId:e},d)))},[i,e])}const alreadyWarned={};function warningOnce(i,e,a){!e&&!alreadyWarned[i]&&(alreadyWarned[i]=!0)}function Outlet(i){return useOutlet(i.context)}function Route(i){invariant(!1)}function Router(i){let{basename:e="/",children:a=null,location:c,navigationType:h=Action.Pop,navigator:d,static:et=!1,future:ft}=i;useInRouterContext()&&invariant(!1);let gt=e.replace(/^\/*/,"/"),_t=reactExports.useMemo(()=>({basename:gt,navigator:d,static:et,future:_extends$1({v7_relativeSplatPath:!1},ft)}),[gt,ft,d,et]);typeof c=="string"&&(c=parsePath(c));let{pathname:wt="/",search:$t="",hash:It="",state:Rt=null,key:Tt="default"}=c,At=reactExports.useMemo(()=>{let kt=stripBasename(wt,gt);return kt==null?null:{location:{pathname:kt,search:$t,hash:It,state:Rt,key:Tt},navigationType:h}},[gt,wt,$t,It,Rt,Tt,h]);return At==null?null:reactExports.createElement(NavigationContext.Provider,{value:_t},reactExports.createElement(LocationContext.Provider,{children:a,value:At}))}new Promise(()=>{});function createRoutesFromChildren(i,e){e===void 0&&(e=[]);let a=[];return reactExports.Children.forEach(i,(c,h)=>{if(!reactExports.isValidElement(c))return;let d=[...e,h];if(c.type===reactExports.Fragment){a.push.apply(a,createRoutesFromChildren(c.props.children,d));return}c.type!==Route&&invariant(!1),!c.props.index||!c.props.children||invariant(!1);let et={id:c.props.id||d.join("-"),caseSensitive:c.props.caseSensitive,element:c.props.element,Component:c.props.Component,index:c.props.index,path:c.props.path,loader:c.props.loader,action:c.props.action,errorElement:c.props.errorElement,ErrorBoundary:c.props.ErrorBoundary,hasErrorBoundary:c.props.ErrorBoundary!=null||c.props.errorElement!=null,shouldRevalidate:c.props.shouldRevalidate,handle:c.props.handle,lazy:c.props.lazy};c.props.children&&(et.children=createRoutesFromChildren(c.props.children,d)),a.push(et)}),a}function mapRouteProperties(i){let e={hasErrorBoundary:i.ErrorBoundary!=null||i.errorElement!=null};return i.Component&&Object.assign(e,{element:reactExports.createElement(i.Component),Component:void 0}),i.HydrateFallback&&Object.assign(e,{hydrateFallbackElement:reactExports.createElement(i.HydrateFallback),HydrateFallback:void 0}),i.ErrorBoundary&&Object.assign(e,{errorElement:reactExports.createElement(i.ErrorBoundary),ErrorBoundary:void 0}),e}/**
 * React Router DOM v6.22.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function _extends(){return _extends=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(i[c]=a[c])}return i},_extends.apply(this,arguments)}function _objectWithoutPropertiesLoose(i,e){if(i==null)return{};var a={},c=Object.keys(i),h,d;for(d=0;d<c.length;d++)h=c[d],!(e.indexOf(h)>=0)&&(a[h]=i[h]);return a}function isModifiedEvent(i){return!!(i.metaKey||i.altKey||i.ctrlKey||i.shiftKey)}function shouldProcessLinkClick(i,e){return i.button===0&&(!e||e==="_self")&&!isModifiedEvent(i)}const _excluded=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","unstable_viewTransition"],REACT_ROUTER_VERSION="6";try{window.__reactRouterVersion=REACT_ROUTER_VERSION}catch{}function createHashRouter(i,e){return createRouter({basename:e==null?void 0:e.basename,future:_extends({},e==null?void 0:e.future,{v7_prependBasename:!0}),history:createHashHistory({window:e==null?void 0:e.window}),hydrationData:(e==null?void 0:e.hydrationData)||parseHydrationData(),routes:i,mapRouteProperties,window:e==null?void 0:e.window}).initialize()}function parseHydrationData(){var i;let e=(i=window)==null?void 0:i.__staticRouterHydrationData;return e&&e.errors&&(e=_extends({},e,{errors:deserializeErrors(e.errors)})),e}function deserializeErrors(i){if(!i)return null;let e=Object.entries(i),a={};for(let[c,h]of e)if(h&&h.__type==="RouteErrorResponse")a[c]=new ErrorResponseImpl(h.status,h.statusText,h.data,h.internal===!0);else if(h&&h.__type==="Error"){if(h.__subType){let d=window[h.__subType];if(typeof d=="function")try{let et=new d(h.message);et.stack="",a[c]=et}catch{}}if(a[c]==null){let d=new Error(h.message);d.stack="",a[c]=d}}else a[c]=h;return a}const ViewTransitionContext=reactExports.createContext({isTransitioning:!1}),FetchersContext=reactExports.createContext(new Map),START_TRANSITION="startTransition",startTransitionImpl=React$1[START_TRANSITION],FLUSH_SYNC="flushSync",flushSyncImpl=ReactDOM[FLUSH_SYNC];function startTransitionSafe(i){startTransitionImpl?startTransitionImpl(i):i()}function flushSyncSafe(i){flushSyncImpl?flushSyncImpl(i):i()}let Deferred$1=class{constructor(){this.status="pending",this.promise=new Promise((e,a)=>{this.resolve=c=>{this.status==="pending"&&(this.status="resolved",e(c))},this.reject=c=>{this.status==="pending"&&(this.status="rejected",a(c))}})}};function RouterProvider(i){let{fallbackElement:e,router:a,future:c}=i,[h,d]=reactExports.useState(a.state),[et,ft]=reactExports.useState(),[gt,_t]=reactExports.useState({isTransitioning:!1}),[wt,$t]=reactExports.useState(),[It,Rt]=reactExports.useState(),[Tt,At]=reactExports.useState(),kt=reactExports.useRef(new Map),{v7_startTransition:xt}=c||{},Nt=reactExports.useCallback(Wt=>{xt?startTransitionSafe(Wt):Wt()},[xt]),Ft=reactExports.useCallback((Wt,Zt)=>{let{deletedFetchers:cr,unstable_flushSync:hr,unstable_viewTransitionOpts:gr}=Zt;cr.forEach(mr=>kt.current.delete(mr)),Wt.fetchers.forEach((mr,Mr)=>{mr.data!==void 0&&kt.current.set(Mr,mr.data)});let er=a.window==null||typeof a.window.document.startViewTransition!="function";if(!gr||er){hr?flushSyncSafe(()=>d(Wt)):Nt(()=>d(Wt));return}if(hr){flushSyncSafe(()=>{It&&(wt&&wt.resolve(),It.skipTransition()),_t({isTransitioning:!0,flushSync:!0,currentLocation:gr.currentLocation,nextLocation:gr.nextLocation})});let mr=a.window.document.startViewTransition(()=>{flushSyncSafe(()=>d(Wt))});mr.finished.finally(()=>{flushSyncSafe(()=>{$t(void 0),Rt(void 0),ft(void 0),_t({isTransitioning:!1})})}),flushSyncSafe(()=>Rt(mr));return}It?(wt&&wt.resolve(),It.skipTransition(),At({state:Wt,currentLocation:gr.currentLocation,nextLocation:gr.nextLocation})):(ft(Wt),_t({isTransitioning:!0,flushSync:!1,currentLocation:gr.currentLocation,nextLocation:gr.nextLocation}))},[a.window,It,wt,kt,Nt]);reactExports.useLayoutEffect(()=>a.subscribe(Ft),[a,Ft]),reactExports.useEffect(()=>{gt.isTransitioning&&!gt.flushSync&&$t(new Deferred$1)},[gt]),reactExports.useEffect(()=>{if(wt&&et&&a.window){let Wt=et,Zt=wt.promise,cr=a.window.document.startViewTransition(async()=>{Nt(()=>d(Wt)),await Zt});cr.finished.finally(()=>{$t(void 0),Rt(void 0),ft(void 0),_t({isTransitioning:!1})}),Rt(cr)}},[Nt,et,wt,a.window]),reactExports.useEffect(()=>{wt&&et&&h.location.key===et.location.key&&wt.resolve()},[wt,It,h.location,et]),reactExports.useEffect(()=>{!gt.isTransitioning&&Tt&&(ft(Tt.state),_t({isTransitioning:!0,flushSync:!1,currentLocation:Tt.currentLocation,nextLocation:Tt.nextLocation}),At(void 0))},[gt.isTransitioning,Tt]),reactExports.useEffect(()=>{},[]);let jt=reactExports.useMemo(()=>({createHref:a.createHref,encodeLocation:a.encodeLocation,go:Wt=>a.navigate(Wt),push:(Wt,Zt,cr)=>a.navigate(Wt,{state:Zt,preventScrollReset:cr==null?void 0:cr.preventScrollReset}),replace:(Wt,Zt,cr)=>a.navigate(Wt,{replace:!0,state:Zt,preventScrollReset:cr==null?void 0:cr.preventScrollReset})}),[a]),Gt=a.basename||"/",Kt=reactExports.useMemo(()=>({router:a,navigator:jt,static:!1,basename:Gt}),[a,jt,Gt]);return reactExports.createElement(reactExports.Fragment,null,reactExports.createElement(DataRouterContext.Provider,{value:Kt},reactExports.createElement(DataRouterStateContext.Provider,{value:h},reactExports.createElement(FetchersContext.Provider,{value:kt.current},reactExports.createElement(ViewTransitionContext.Provider,{value:gt},reactExports.createElement(Router,{basename:Gt,location:h.location,navigationType:h.historyAction,navigator:jt,future:{v7_relativeSplatPath:a.future.v7_relativeSplatPath}},h.initialized||a.future.v7_partialHydration?reactExports.createElement(DataRoutes,{routes:a.routes,future:a.future,state:h}):e))))),null)}function DataRoutes(i){let{routes:e,future:a,state:c}=i;return useRoutesImpl(e,void 0,c,a)}const isBrowser$1=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",ABSOLUTE_URL_REGEX=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Link=reactExports.forwardRef(function(e,a){let{onClick:c,relative:h,reloadDocument:d,replace:et,state:ft,target:gt,to:_t,preventScrollReset:wt,unstable_viewTransition:$t}=e,It=_objectWithoutPropertiesLoose(e,_excluded),{basename:Rt}=reactExports.useContext(NavigationContext),Tt,At=!1;if(typeof _t=="string"&&ABSOLUTE_URL_REGEX.test(_t)&&(Tt=_t,isBrowser$1))try{let Ft=new URL(window.location.href),jt=_t.startsWith("//")?new URL(Ft.protocol+_t):new URL(_t),Gt=stripBasename(jt.pathname,Rt);jt.origin===Ft.origin&&Gt!=null?_t=Gt+jt.search+jt.hash:At=!0}catch{}let kt=useHref(_t,{relative:h}),xt=useLinkClickHandler(_t,{replace:et,state:ft,target:gt,preventScrollReset:wt,relative:h,unstable_viewTransition:$t});function Nt(Ft){c&&c(Ft),Ft.defaultPrevented||xt(Ft)}return reactExports.createElement("a",_extends({},It,{href:Tt||kt,onClick:At||d?c:Nt,ref:a,target:gt}))});var DataRouterHook;(function(i){i.UseScrollRestoration="useScrollRestoration",i.UseSubmit="useSubmit",i.UseSubmitFetcher="useSubmitFetcher",i.UseFetcher="useFetcher",i.useViewTransitionState="useViewTransitionState"})(DataRouterHook||(DataRouterHook={}));var DataRouterStateHook;(function(i){i.UseFetcher="useFetcher",i.UseFetchers="useFetchers",i.UseScrollRestoration="useScrollRestoration"})(DataRouterStateHook||(DataRouterStateHook={}));function useLinkClickHandler(i,e){let{target:a,replace:c,state:h,preventScrollReset:d,relative:et,unstable_viewTransition:ft}=e===void 0?{}:e,gt=useNavigate(),_t=useLocation(),wt=useResolvedPath(i,{relative:et});return reactExports.useCallback($t=>{if(shouldProcessLinkClick($t,a)){$t.preventDefault();let It=c!==void 0?c:createPath(_t)===createPath(wt);gt(i,{replace:It,state:h,preventScrollReset:d,relative:et,unstable_viewTransition:ft})}},[_t,gt,wt,c,h,a,i,d,et,ft])}var __assign$1=function(){return __assign$1=Object.assign||function(e){for(var a,c=1,h=arguments.length;c<h;c++){a=arguments[c];for(var d in a)Object.prototype.hasOwnProperty.call(a,d)&&(e[d]=a[d])}return e},__assign$1.apply(this,arguments)};function __spreadArray(i,e,a){if(a||arguments.length===2)for(var c=0,h=e.length,d;c<h;c++)(d||!(c in e))&&(d||(d=Array.prototype.slice.call(e,0,c)),d[c]=e[c]);return i.concat(d||Array.prototype.slice.call(e))}var MS="-ms-",MOZ="-moz-",WEBKIT="-webkit-",COMMENT="comm",RULESET="rule",DECLARATION="decl",IMPORT="@import",KEYFRAMES="@keyframes",LAYER="@layer",abs=Math.abs,from$b=String.fromCharCode,assign$1=Object.assign;function hash$2(i,e){return charat(i,0)^45?(((e<<2^charat(i,0))<<2^charat(i,1))<<2^charat(i,2))<<2^charat(i,3):0}function trim$1(i){return i.trim()}function match(i,e){return(i=e.exec(i))?i[0]:i}function replace(i,e,a){return i.replace(e,a)}function indexof(i,e,a){return i.indexOf(e,a)}function charat(i,e){return i.charCodeAt(e)|0}function substr(i,e,a){return i.slice(e,a)}function strlen(i){return i.length}function sizeof(i){return i.length}function append(i,e){return e.push(i),i}function combine(i,e){return i.map(e).join("")}function filter$1(i,e){return i.filter(function(a){return!match(a,e)})}var line=1,column=1,length$4=0,position=0,character=0,characters="";function node$1(i,e,a,c,h,d,et,ft){return{value:i,root:e,parent:a,type:c,props:h,children:d,line,column,length:et,return:"",siblings:ft}}function copy$1(i,e){return assign$1(node$1("",null,null,"",null,null,0,i.siblings),i,{length:-i.length},e)}function lift(i){for(;i.root;)i=copy$1(i.root,{children:[i]});append(i,i.siblings)}function char(){return character}function prev(){return character=position>0?charat(characters,--position):0,column--,character===10&&(column=1,line--),character}function next(){return character=position<length$4?charat(characters,position++):0,column++,character===10&&(column=1,line++),character}function peek(){return charat(characters,position)}function caret(){return position}function slice(i,e){return substr(characters,i,e)}function token(i){switch(i){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function alloc$4(i){return line=column=1,length$4=strlen(characters=i),position=0,[]}function dealloc(i){return characters="",i}function delimit(i){return trim$1(slice(position-1,delimiter(i===91?i+2:i===40?i+1:i)))}function whitespace(i){for(;(character=peek())&&character<33;)next();return token(i)>2||token(character)>3?"":" "}function escaping(i,e){for(;--e&&next()&&!(character<48||character>102||character>57&&character<65||character>70&&character<97););return slice(i,caret()+(e<6&&peek()==32&&next()==32))}function delimiter(i){for(;next();)switch(character){case i:return position;case 34:case 39:i!==34&&i!==39&&delimiter(character);break;case 40:i===41&&delimiter(i);break;case 92:next();break}return position}function commenter(i,e){for(;next()&&i+character!==57;)if(i+character===84&&peek()===47)break;return"/*"+slice(e,position-1)+"*"+from$b(i===47?i:next())}function identifier(i){for(;!token(peek());)next();return slice(i,position)}function compile(i){return dealloc(parse$2("",null,null,null,[""],i=alloc$4(i),0,[0],i))}function parse$2(i,e,a,c,h,d,et,ft,gt){for(var _t=0,wt=0,$t=et,It=0,Rt=0,Tt=0,At=1,kt=1,xt=1,Nt=0,Ft="",jt=h,Gt=d,Kt=c,Wt=Ft;kt;)switch(Tt=Nt,Nt=next()){case 40:if(Tt!=108&&charat(Wt,$t-1)==58){indexof(Wt+=replace(delimit(Nt),"&","&\f"),"&\f",abs(_t?ft[_t-1]:0))!=-1&&(xt=-1);break}case 34:case 39:case 91:Wt+=delimit(Nt);break;case 9:case 10:case 13:case 32:Wt+=whitespace(Tt);break;case 92:Wt+=escaping(caret()-1,7);continue;case 47:switch(peek()){case 42:case 47:append(comment(commenter(next(),caret()),e,a,gt),gt);break;default:Wt+="/"}break;case 123*At:ft[_t++]=strlen(Wt)*xt;case 125*At:case 59:case 0:switch(Nt){case 0:case 125:kt=0;case 59+wt:xt==-1&&(Wt=replace(Wt,/\f/g,"")),Rt>0&&strlen(Wt)-$t&&append(Rt>32?declaration(Wt+";",c,a,$t-1,gt):declaration(replace(Wt," ","")+";",c,a,$t-2,gt),gt);break;case 59:Wt+=";";default:if(append(Kt=ruleset(Wt,e,a,_t,wt,h,ft,Ft,jt=[],Gt=[],$t,d),d),Nt===123)if(wt===0)parse$2(Wt,e,Kt,Kt,jt,d,$t,ft,Gt);else switch(It===99&&charat(Wt,3)===110?100:It){case 100:case 108:case 109:case 115:parse$2(i,Kt,Kt,c&&append(ruleset(i,Kt,Kt,0,0,h,ft,Ft,h,jt=[],$t,Gt),Gt),h,Gt,$t,ft,c?jt:Gt);break;default:parse$2(Wt,Kt,Kt,Kt,[""],Gt,0,ft,Gt)}}_t=wt=Rt=0,At=xt=1,Ft=Wt="",$t=et;break;case 58:$t=1+strlen(Wt),Rt=Tt;default:if(At<1){if(Nt==123)--At;else if(Nt==125&&At++==0&&prev()==125)continue}switch(Wt+=from$b(Nt),Nt*At){case 38:xt=wt>0?1:(Wt+="\f",-1);break;case 44:ft[_t++]=(strlen(Wt)-1)*xt,xt=1;break;case 64:peek()===45&&(Wt+=delimit(next())),It=peek(),wt=$t=strlen(Ft=Wt+=identifier(caret())),Nt++;break;case 45:Tt===45&&strlen(Wt)==2&&(At=0)}}return d}function ruleset(i,e,a,c,h,d,et,ft,gt,_t,wt,$t){for(var It=h-1,Rt=h===0?d:[""],Tt=sizeof(Rt),At=0,kt=0,xt=0;At<c;++At)for(var Nt=0,Ft=substr(i,It+1,It=abs(kt=et[At])),jt=i;Nt<Tt;++Nt)(jt=trim$1(kt>0?Rt[Nt]+" "+Ft:replace(Ft,/&\f/g,Rt[Nt])))&&(gt[xt++]=jt);return node$1(i,e,a,h===0?RULESET:ft,gt,_t,wt,$t)}function comment(i,e,a,c){return node$1(i,e,a,COMMENT,from$b(char()),substr(i,2,-2),0,c)}function declaration(i,e,a,c,h){return node$1(i,e,a,DECLARATION,substr(i,0,c),substr(i,c+1,-1),c,h)}function prefix(i,e,a){switch(hash$2(i,e)){case 5103:return WEBKIT+"print-"+i+i;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return WEBKIT+i+i;case 4789:return MOZ+i+i;case 5349:case 4246:case 4810:case 6968:case 2756:return WEBKIT+i+MOZ+i+MS+i+i;case 5936:switch(charat(i,e+11)){case 114:return WEBKIT+i+MS+replace(i,/[svh]\w+-[tblr]{2}/,"tb")+i;case 108:return WEBKIT+i+MS+replace(i,/[svh]\w+-[tblr]{2}/,"tb-rl")+i;case 45:return WEBKIT+i+MS+replace(i,/[svh]\w+-[tblr]{2}/,"lr")+i}case 6828:case 4268:case 2903:return WEBKIT+i+MS+i+i;case 6165:return WEBKIT+i+MS+"flex-"+i+i;case 5187:return WEBKIT+i+replace(i,/(\w+).+(:[^]+)/,WEBKIT+"box-$1$2"+MS+"flex-$1$2")+i;case 5443:return WEBKIT+i+MS+"flex-item-"+replace(i,/flex-|-self/g,"")+(match(i,/flex-|baseline/)?"":MS+"grid-row-"+replace(i,/flex-|-self/g,""))+i;case 4675:return WEBKIT+i+MS+"flex-line-pack"+replace(i,/align-content|flex-|-self/g,"")+i;case 5548:return WEBKIT+i+MS+replace(i,"shrink","negative")+i;case 5292:return WEBKIT+i+MS+replace(i,"basis","preferred-size")+i;case 6060:return WEBKIT+"box-"+replace(i,"-grow","")+WEBKIT+i+MS+replace(i,"grow","positive")+i;case 4554:return WEBKIT+replace(i,/([^-])(transform)/g,"$1"+WEBKIT+"$2")+i;case 6187:return replace(replace(replace(i,/(zoom-|grab)/,WEBKIT+"$1"),/(image-set)/,WEBKIT+"$1"),i,"")+i;case 5495:case 3959:return replace(i,/(image-set\([^]*)/,WEBKIT+"$1$`$1");case 4968:return replace(replace(i,/(.+:)(flex-)?(.*)/,WEBKIT+"box-pack:$3"+MS+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+WEBKIT+i+i;case 4200:if(!match(i,/flex-|baseline/))return MS+"grid-column-align"+substr(i,e)+i;break;case 2592:case 3360:return MS+replace(i,"template-","")+i;case 4384:case 3616:return a&&a.some(function(c,h){return e=h,match(c.props,/grid-\w+-end/)})?~indexof(i+(a=a[e].value),"span",0)?i:MS+replace(i,"-start","")+i+MS+"grid-row-span:"+(~indexof(a,"span",0)?match(a,/\d+/):+match(a,/\d+/)-+match(i,/\d+/))+";":MS+replace(i,"-start","")+i;case 4896:case 4128:return a&&a.some(function(c){return match(c.props,/grid-\w+-start/)})?i:MS+replace(replace(i,"-end","-span"),"span ","")+i;case 4095:case 3583:case 4068:case 2532:return replace(i,/(.+)-inline(.+)/,WEBKIT+"$1$2")+i;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(strlen(i)-1-e>6)switch(charat(i,e+1)){case 109:if(charat(i,e+4)!==45)break;case 102:return replace(i,/(.+:)(.+)-([^]+)/,"$1"+WEBKIT+"$2-$3$1"+MOZ+(charat(i,e+3)==108?"$3":"$2-$3"))+i;case 115:return~indexof(i,"stretch",0)?prefix(replace(i,"stretch","fill-available"),e,a)+i:i}break;case 5152:case 5920:return replace(i,/(.+?):(\d+)(\s*\/\s*(span)?\s*(\d+))?(.*)/,function(c,h,d,et,ft,gt,_t){return MS+h+":"+d+_t+(et?MS+h+"-span:"+(ft?gt:+gt-+d)+_t:"")+i});case 4949:if(charat(i,e+6)===121)return replace(i,":",":"+WEBKIT)+i;break;case 6444:switch(charat(i,charat(i,14)===45?18:11)){case 120:return replace(i,/(.+:)([^;\s!]+)(;|(\s+)?!.+)?/,"$1"+WEBKIT+(charat(i,14)===45?"inline-":"")+"box$3$1"+WEBKIT+"$2$3$1"+MS+"$2box$3")+i;case 100:return replace(i,":",":"+MS)+i}break;case 5719:case 2647:case 2135:case 3927:case 2391:return replace(i,"scroll-","scroll-snap-")+i}return i}function serialize(i,e){for(var a="",c=0;c<i.length;c++)a+=e(i[c],c,i,e)||"";return a}function stringify$1(i,e,a,c){switch(i.type){case LAYER:if(i.children.length)break;case IMPORT:case DECLARATION:return i.return=i.return||i.value;case COMMENT:return"";case KEYFRAMES:return i.return=i.value+"{"+serialize(i.children,c)+"}";case RULESET:if(!strlen(i.value=i.props.join(",")))return""}return strlen(a=serialize(i.children,c))?i.return=i.value+"{"+a+"}":""}function middleware(i){var e=sizeof(i);return function(a,c,h,d){for(var et="",ft=0;ft<e;ft++)et+=i[ft](a,c,h,d)||"";return et}}function rulesheet(i){return function(e){e.root||(e=e.return)&&i(e)}}function prefixer(i,e,a,c){if(i.length>-1&&!i.return)switch(i.type){case DECLARATION:i.return=prefix(i.value,i.length,a);return;case KEYFRAMES:return serialize([copy$1(i,{value:replace(i.value,"@","@"+WEBKIT)})],c);case RULESET:if(i.length)return combine(a=i.props,function(h){switch(match(h,c=/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":lift(copy$1(i,{props:[replace(h,/:(read-\w+)/,":"+MOZ+"$1")]})),lift(copy$1(i,{props:[h]})),assign$1(i,{props:filter$1(a,c)});break;case"::placeholder":lift(copy$1(i,{props:[replace(h,/:(plac\w+)/,":"+WEBKIT+"input-$1")]})),lift(copy$1(i,{props:[replace(h,/:(plac\w+)/,":"+MOZ+"$1")]})),lift(copy$1(i,{props:[replace(h,/:(plac\w+)/,MS+"input-$1")]})),lift(copy$1(i,{props:[h]})),assign$1(i,{props:filter$1(a,c)});break}return""})}}var unitlessKeys={animationIterationCount:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},define_process_env_default$2={},f=typeof process<"u"&&define_process_env_default$2!==void 0&&(define_process_env_default$2.REACT_APP_SC_ATTR||define_process_env_default$2.SC_ATTR)||"data-styled",m$1="active",y="data-styled-version",v$1="6.1.8",g=`/*!sc*/
`,S=typeof window<"u"&&"HTMLElement"in window,w=!!(typeof SC_DISABLE_SPEEDY=="boolean"?SC_DISABLE_SPEEDY:typeof process<"u"&&define_process_env_default$2!==void 0&&define_process_env_default$2.REACT_APP_SC_DISABLE_SPEEDY!==void 0&&define_process_env_default$2.REACT_APP_SC_DISABLE_SPEEDY!==""?define_process_env_default$2.REACT_APP_SC_DISABLE_SPEEDY!=="false"&&define_process_env_default$2.REACT_APP_SC_DISABLE_SPEEDY:typeof process<"u"&&define_process_env_default$2!==void 0&&define_process_env_default$2.SC_DISABLE_SPEEDY!==void 0&&define_process_env_default$2.SC_DISABLE_SPEEDY!==""&&define_process_env_default$2.SC_DISABLE_SPEEDY!=="false"&&define_process_env_default$2.SC_DISABLE_SPEEDY),b={},_$1=Object.freeze([]),C=Object.freeze({});function I(i,e,a){return a===void 0&&(a=C),i.theme!==a.theme&&i.theme||e||a.theme}var A=new Set(["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","tr","track","u","ul","use","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","marker","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"]),O=/[!"#$%&'()*+,./:;<=>?@[\\\]^`{|}~-]+/g,D=/(^-|-$)/g;function R(i){return i.replace(O,"-").replace(D,"")}var T=/(a)(d)/gi,k$1=52,j=function(i){return String.fromCharCode(i+(i>25?39:97))};function x$1(i){var e,a="";for(e=Math.abs(i);e>k$1;e=e/k$1|0)a=j(e%k$1)+a;return(j(e%k$1)+a).replace(T,"$1-$2")}var V$1,F=5381,M$1=function(i,e){for(var a=e.length;a;)i=33*i^e.charCodeAt(--a);return i},$=function(i){return M$1(F,i)};function z(i){return x$1($(i)>>>0)}function B$1(i){return i.displayName||i.name||"Component"}function L(i){return typeof i=="string"&&!0}var G=typeof Symbol=="function"&&Symbol.for,Y$1=G?Symbol.for("react.memo"):60115,W=G?Symbol.for("react.forward_ref"):60112,q={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},H={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},U={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},J=((V$1={})[W]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},V$1[Y$1]=U,V$1);function X$1(i){return("type"in(e=i)&&e.type.$$typeof)===Y$1?U:"$$typeof"in i?J[i.$$typeof]:q;var e}var Z$1=Object.defineProperty,K=Object.getOwnPropertyNames,Q=Object.getOwnPropertySymbols,ee=Object.getOwnPropertyDescriptor,te=Object.getPrototypeOf,ne$1=Object.prototype;function oe(i,e,a){if(typeof e!="string"){if(ne$1){var c=te(e);c&&c!==ne$1&&oe(i,c,a)}var h=K(e);Q&&(h=h.concat(Q(e)));for(var d=X$1(i),et=X$1(e),ft=0;ft<h.length;++ft){var gt=h[ft];if(!(gt in H||a&&a[gt]||et&&gt in et||d&&gt in d)){var _t=ee(e,gt);try{Z$1(i,gt,_t)}catch{}}}}return i}function re$1(i){return typeof i=="function"}function se(i){return typeof i=="object"&&"styledComponentId"in i}function ie(i,e){return i&&e?"".concat(i," ").concat(e):i||e||""}function ae(i,e){if(i.length===0)return"";for(var a=i[0],c=1;c<i.length;c++)a+=e?e+i[c]:i[c];return a}function ce$1(i){return i!==null&&typeof i=="object"&&i.constructor.name===Object.name&&!("props"in i&&i.$$typeof)}function le(i,e,a){if(a===void 0&&(a=!1),!a&&!ce$1(i)&&!Array.isArray(i))return e;if(Array.isArray(e))for(var c=0;c<e.length;c++)i[c]=le(i[c],e[c]);else if(ce$1(e))for(var c in e)i[c]=le(i[c],e[c]);return i}function ue(i,e){Object.defineProperty(i,"toString",{value:e})}function he(i){for(var e=[],a=1;a<arguments.length;a++)e[a-1]=arguments[a];return new Error("An error occurred. See https://github.com/styled-components/styled-components/blob/main/packages/styled-components/src/utils/errors.md#".concat(i," for more information.").concat(e.length>0?" Args: ".concat(e.join(", ")):""))}var fe$2=function(){function i(e){this.groupSizes=new Uint32Array(512),this.length=512,this.tag=e}return i.prototype.indexOfGroup=function(e){for(var a=0,c=0;c<e;c++)a+=this.groupSizes[c];return a},i.prototype.insertRules=function(e,a){if(e>=this.groupSizes.length){for(var c=this.groupSizes,h=c.length,d=h;e>=d;)if((d<<=1)<0)throw he(16,"".concat(e));this.groupSizes=new Uint32Array(d),this.groupSizes.set(c),this.length=d;for(var et=h;et<d;et++)this.groupSizes[et]=0}for(var ft=this.indexOfGroup(e+1),gt=(et=0,a.length);et<gt;et++)this.tag.insertRule(ft,a[et])&&(this.groupSizes[e]++,ft++)},i.prototype.clearGroup=function(e){if(e<this.length){var a=this.groupSizes[e],c=this.indexOfGroup(e),h=c+a;this.groupSizes[e]=0;for(var d=c;d<h;d++)this.tag.deleteRule(c)}},i.prototype.getGroup=function(e){var a="";if(e>=this.length||this.groupSizes[e]===0)return a;for(var c=this.groupSizes[e],h=this.indexOfGroup(e),d=h+c,et=h;et<d;et++)a+="".concat(this.tag.getRule(et)).concat(g);return a},i}(),me$1=new Map,ye$1=new Map,ve$1=1,ge$1=function(i){if(me$1.has(i))return me$1.get(i);for(;ye$1.has(ve$1);)ve$1++;var e=ve$1++;return me$1.set(i,e),ye$1.set(e,i),e},Se$1=function(i,e){ve$1=e+1,me$1.set(i,e),ye$1.set(e,i)},we$1="style[".concat(f,"][").concat(y,'="').concat(v$1,'"]'),be$1=new RegExp("^".concat(f,'\\.g(\\d+)\\[id="([\\w\\d-]+)"\\].*?"([^"]*)')),Ee=function(i,e,a){for(var c,h=a.split(","),d=0,et=h.length;d<et;d++)(c=h[d])&&i.registerName(e,c)},Ne=function(i,e){for(var a,c=((a=e.textContent)!==null&&a!==void 0?a:"").split(g),h=[],d=0,et=c.length;d<et;d++){var ft=c[d].trim();if(ft){var gt=ft.match(be$1);if(gt){var _t=0|parseInt(gt[1],10),wt=gt[2];_t!==0&&(Se$1(wt,_t),Ee(i,wt,gt[3]),i.getTag().insertRules(_t,h)),h.length=0}else h.push(ft)}}};function Pe$1(){return typeof __webpack_nonce__<"u"?__webpack_nonce__:null}var _e=function(i){var e=document.head,a=i||e,c=document.createElement("style"),h=function(ft){var gt=Array.from(ft.querySelectorAll("style[".concat(f,"]")));return gt[gt.length-1]}(a),d=h!==void 0?h.nextSibling:null;c.setAttribute(f,m$1),c.setAttribute(y,v$1);var et=Pe$1();return et&&c.setAttribute("nonce",et),a.insertBefore(c,d),c},Ce=function(){function i(e){this.element=_e(e),this.element.appendChild(document.createTextNode("")),this.sheet=function(a){if(a.sheet)return a.sheet;for(var c=document.styleSheets,h=0,d=c.length;h<d;h++){var et=c[h];if(et.ownerNode===a)return et}throw he(17)}(this.element),this.length=0}return i.prototype.insertRule=function(e,a){try{return this.sheet.insertRule(a,e),this.length++,!0}catch{return!1}},i.prototype.deleteRule=function(e){this.sheet.deleteRule(e),this.length--},i.prototype.getRule=function(e){var a=this.sheet.cssRules[e];return a&&a.cssText?a.cssText:""},i}(),Ie=function(){function i(e){this.element=_e(e),this.nodes=this.element.childNodes,this.length=0}return i.prototype.insertRule=function(e,a){if(e<=this.length&&e>=0){var c=document.createTextNode(a);return this.element.insertBefore(c,this.nodes[e]||null),this.length++,!0}return!1},i.prototype.deleteRule=function(e){this.element.removeChild(this.nodes[e]),this.length--},i.prototype.getRule=function(e){return e<this.length?this.nodes[e].textContent:""},i}(),Ae=function(){function i(e){this.rules=[],this.length=0}return i.prototype.insertRule=function(e,a){return e<=this.length&&(this.rules.splice(e,0,a),this.length++,!0)},i.prototype.deleteRule=function(e){this.rules.splice(e,1),this.length--},i.prototype.getRule=function(e){return e<this.length?this.rules[e]:""},i}(),Oe=S,De={isServer:!S,useCSSOMInjection:!w},Re=function(){function i(e,a,c){e===void 0&&(e=C),a===void 0&&(a={});var h=this;this.options=__assign$1(__assign$1({},De),e),this.gs=a,this.names=new Map(c),this.server=!!e.isServer,!this.server&&S&&Oe&&(Oe=!1,function(d){for(var et=document.querySelectorAll(we$1),ft=0,gt=et.length;ft<gt;ft++){var _t=et[ft];_t&&_t.getAttribute(f)!==m$1&&(Ne(d,_t),_t.parentNode&&_t.parentNode.removeChild(_t))}}(this)),ue(this,function(){return function(d){for(var et=d.getTag(),ft=et.length,gt="",_t=function($t){var It=function(xt){return ye$1.get(xt)}($t);if(It===void 0)return"continue";var Rt=d.names.get(It),Tt=et.getGroup($t);if(Rt===void 0||Tt.length===0)return"continue";var At="".concat(f,".g").concat($t,'[id="').concat(It,'"]'),kt="";Rt!==void 0&&Rt.forEach(function(xt){xt.length>0&&(kt+="".concat(xt,","))}),gt+="".concat(Tt).concat(At,'{content:"').concat(kt,'"}').concat(g)},wt=0;wt<ft;wt++)_t(wt);return gt}(h)})}return i.registerId=function(e){return ge$1(e)},i.prototype.reconstructWithOptions=function(e,a){return a===void 0&&(a=!0),new i(__assign$1(__assign$1({},this.options),e),this.gs,a&&this.names||void 0)},i.prototype.allocateGSInstance=function(e){return this.gs[e]=(this.gs[e]||0)+1},i.prototype.getTag=function(){return this.tag||(this.tag=(e=function(a){var c=a.useCSSOMInjection,h=a.target;return a.isServer?new Ae(h):c?new Ce(h):new Ie(h)}(this.options),new fe$2(e)));var e},i.prototype.hasNameForId=function(e,a){return this.names.has(e)&&this.names.get(e).has(a)},i.prototype.registerName=function(e,a){if(ge$1(e),this.names.has(e))this.names.get(e).add(a);else{var c=new Set;c.add(a),this.names.set(e,c)}},i.prototype.insertRules=function(e,a,c){this.registerName(e,a),this.getTag().insertRules(ge$1(e),c)},i.prototype.clearNames=function(e){this.names.has(e)&&this.names.get(e).clear()},i.prototype.clearRules=function(e){this.getTag().clearGroup(ge$1(e)),this.clearNames(e)},i.prototype.clearTag=function(){this.tag=void 0},i}(),Te=/&/g,ke$1=/^\s*\/\/.*$/gm;function je(i,e){return i.map(function(a){return a.type==="rule"&&(a.value="".concat(e," ").concat(a.value),a.value=a.value.replaceAll(",",",".concat(e," ")),a.props=a.props.map(function(c){return"".concat(e," ").concat(c)})),Array.isArray(a.children)&&a.type!=="@keyframes"&&(a.children=je(a.children,e)),a})}function xe(i){var e,a,c,h=i===void 0?C:i,d=h.options,et=d===void 0?C:d,ft=h.plugins,gt=ft===void 0?_$1:ft,_t=function(It,Rt,Tt){return Tt.startsWith(a)&&Tt.endsWith(a)&&Tt.replaceAll(a,"").length>0?".".concat(e):It},wt=gt.slice();wt.push(function(It){It.type===RULESET&&It.value.includes("&")&&(It.props[0]=It.props[0].replace(Te,a).replace(c,_t))}),et.prefix&&wt.push(prefixer),wt.push(stringify$1);var $t=function(It,Rt,Tt,At){Rt===void 0&&(Rt=""),Tt===void 0&&(Tt=""),At===void 0&&(At="&"),e=At,a=Rt,c=new RegExp("\\".concat(a,"\\b"),"g");var kt=It.replace(ke$1,""),xt=compile(Tt||Rt?"".concat(Tt," ").concat(Rt," { ").concat(kt," }"):kt);et.namespace&&(xt=je(xt,et.namespace));var Nt=[];return serialize(xt,middleware(wt.concat(rulesheet(function(Ft){return Nt.push(Ft)})))),Nt};return $t.hash=gt.length?gt.reduce(function(It,Rt){return Rt.name||he(15),M$1(It,Rt.name)},F).toString():"",$t}var Ve=new Re,Fe$1=xe(),Me$1=o.createContext({shouldForwardProp:void 0,styleSheet:Ve,stylis:Fe$1});Me$1.Consumer;o.createContext(void 0);function Be$1(){return reactExports.useContext(Me$1)}var Ge=function(){function i(e,a){var c=this;this.inject=function(h,d){d===void 0&&(d=Fe$1);var et=c.name+d.hash;h.hasNameForId(c.id,et)||h.insertRules(c.id,et,d(c.rules,et,"@keyframes"))},this.name=e,this.id="sc-keyframes-".concat(e),this.rules=a,ue(this,function(){throw he(12,String(c.name))})}return i.prototype.getName=function(e){return e===void 0&&(e=Fe$1),this.name+e.hash},i}(),Ye=function(i){return i>="A"&&i<="Z"};function We(i){for(var e="",a=0;a<i.length;a++){var c=i[a];if(a===1&&c==="-"&&i[0]==="-")return i;Ye(c)?e+="-"+c.toLowerCase():e+=c}return e.startsWith("ms-")?"-"+e:e}var qe=function(i){return i==null||i===!1||i===""},He=function(i){var e,a,c=[];for(var h in i){var d=i[h];i.hasOwnProperty(h)&&!qe(d)&&(Array.isArray(d)&&d.isCss||re$1(d)?c.push("".concat(We(h),":"),d,";"):ce$1(d)?c.push.apply(c,__spreadArray(__spreadArray(["".concat(h," {")],He(d),!1),["}"],!1)):c.push("".concat(We(h),": ").concat((e=h,(a=d)==null||typeof a=="boolean"||a===""?"":typeof a!="number"||a===0||e in unitlessKeys||e.startsWith("--")?String(a).trim():"".concat(a,"px")),";")))}return c};function Ue(i,e,a,c){if(qe(i))return[];if(se(i))return[".".concat(i.styledComponentId)];if(re$1(i)){if(!re$1(d=i)||d.prototype&&d.prototype.isReactComponent||!e)return[i];var h=i(e);return Ue(h,e,a,c)}var d;return i instanceof Ge?a?(i.inject(a,c),[i.getName(c)]):[i]:ce$1(i)?He(i):Array.isArray(i)?Array.prototype.concat.apply(_$1,i.map(function(et){return Ue(et,e,a,c)})):[i.toString()]}function Je$1(i){for(var e=0;e<i.length;e+=1){var a=i[e];if(re$1(a)&&!se(a))return!1}return!0}var Xe=$(v$1),Ze=function(){function i(e,a,c){this.rules=e,this.staticRulesId="",this.isStatic=(c===void 0||c.isStatic)&&Je$1(e),this.componentId=a,this.baseHash=M$1(Xe,a),this.baseStyle=c,Re.registerId(a)}return i.prototype.generateAndInjectStyles=function(e,a,c){var h=this.baseStyle?this.baseStyle.generateAndInjectStyles(e,a,c):"";if(this.isStatic&&!c.hash)if(this.staticRulesId&&a.hasNameForId(this.componentId,this.staticRulesId))h=ie(h,this.staticRulesId);else{var d=ae(Ue(this.rules,e,a,c)),et=x$1(M$1(this.baseHash,d)>>>0);if(!a.hasNameForId(this.componentId,et)){var ft=c(d,".".concat(et),void 0,this.componentId);a.insertRules(this.componentId,et,ft)}h=ie(h,et),this.staticRulesId=et}else{for(var gt=M$1(this.baseHash,c.hash),_t="",wt=0;wt<this.rules.length;wt++){var $t=this.rules[wt];if(typeof $t=="string")_t+=$t;else if($t){var It=ae(Ue($t,e,a,c));gt=M$1(gt,It+wt),_t+=It}}if(_t){var Rt=x$1(gt>>>0);a.hasNameForId(this.componentId,Rt)||a.insertRules(this.componentId,Rt,c(_t,".".concat(Rt),void 0,this.componentId)),h=ie(h,Rt)}}return h},i}(),Ke=o.createContext(void 0);Ke.Consumer;var nt$1={};function rt(i,e,a){var c=se(i),h=i,d=!L(i),et=e.attrs,ft=et===void 0?_$1:et,gt=e.componentId,_t=gt===void 0?function(jt,Gt){var Kt=typeof jt!="string"?"sc":R(jt);nt$1[Kt]=(nt$1[Kt]||0)+1;var Wt="".concat(Kt,"-").concat(z(v$1+Kt+nt$1[Kt]));return Gt?"".concat(Gt,"-").concat(Wt):Wt}(e.displayName,e.parentComponentId):gt,wt=e.displayName,$t=wt===void 0?function(jt){return L(jt)?"styled.".concat(jt):"Styled(".concat(B$1(jt),")")}(i):wt,It=e.displayName&&e.componentId?"".concat(R(e.displayName),"-").concat(e.componentId):e.componentId||_t,Rt=c&&h.attrs?h.attrs.concat(ft).filter(Boolean):ft,Tt=e.shouldForwardProp;if(c&&h.shouldForwardProp){var At=h.shouldForwardProp;if(e.shouldForwardProp){var kt=e.shouldForwardProp;Tt=function(jt,Gt){return At(jt,Gt)&&kt(jt,Gt)}}else Tt=At}var xt=new Ze(a,It,c?h.componentStyle:void 0);function Nt(jt,Gt){return function(Kt,Wt,Zt){var cr=Kt.attrs,hr=Kt.componentStyle,gr=Kt.defaultProps,er=Kt.foldedComponentIds,mr=Kt.styledComponentId,Mr=Kt.target,wr=o.useContext(Ke),Dr=Be$1(),Tr=Kt.shouldForwardProp||Dr.shouldForwardProp,fr=I(Wt,wr,gr)||C,yr=function(Jr,zr,br){for(var _r,Vr=__assign$1(__assign$1({},zr),{className:void 0,theme:br}),lr=0;lr<Jr.length;lr+=1){var Cr=re$1(_r=Jr[lr])?_r(Vr):_r;for(var xr in Cr)Vr[xr]=xr==="className"?ie(Vr[xr],Cr[xr]):xr==="style"?__assign$1(__assign$1({},Vr[xr]),Cr[xr]):Cr[xr]}return zr.className&&(Vr.className=ie(Vr.className,zr.className)),Vr}(cr,Wt,fr),$r=yr.as||Mr,Fr={};for(var dr in yr)yr[dr]===void 0||dr[0]==="$"||dr==="as"||dr==="theme"&&yr.theme===fr||(dr==="forwardedAs"?Fr.as=yr.forwardedAs:Tr&&!Tr(dr,$r)||(Fr[dr]=yr[dr]));var Br=function(Jr,zr){var br=Be$1(),_r=Jr.generateAndInjectStyles(zr,br.styleSheet,br.stylis);return _r}(hr,yr),Hr=ie(er,mr);return Br&&(Hr+=" "+Br),yr.className&&(Hr+=" "+yr.className),Fr[L($r)&&!A.has($r)?"class":"className"]=Hr,Fr.ref=Zt,reactExports.createElement($r,Fr)}(Ft,jt,Gt)}Nt.displayName=$t;var Ft=o.forwardRef(Nt);return Ft.attrs=Rt,Ft.componentStyle=xt,Ft.displayName=$t,Ft.shouldForwardProp=Tt,Ft.foldedComponentIds=c?ie(h.foldedComponentIds,h.styledComponentId):"",Ft.styledComponentId=It,Ft.target=c?h.target:i,Object.defineProperty(Ft,"defaultProps",{get:function(){return this._foldedDefaultProps},set:function(jt){this._foldedDefaultProps=c?function(Gt){for(var Kt=[],Wt=1;Wt<arguments.length;Wt++)Kt[Wt-1]=arguments[Wt];for(var Zt=0,cr=Kt;Zt<cr.length;Zt++)le(Gt,cr[Zt],!0);return Gt}({},h.defaultProps,jt):jt}}),ue(Ft,function(){return".".concat(Ft.styledComponentId)}),d&&oe(Ft,i,{attrs:!0,componentStyle:!0,displayName:!0,foldedComponentIds:!0,shouldForwardProp:!0,styledComponentId:!0,target:!0}),Ft}function st(i,e){for(var a=[i[0]],c=0,h=e.length;c<h;c+=1)a.push(e[c],i[c+1]);return a}var it$1=function(i){return Object.assign(i,{isCss:!0})};function at$1(i){for(var e=[],a=1;a<arguments.length;a++)e[a-1]=arguments[a];if(re$1(i)||ce$1(i))return it$1(Ue(st(_$1,__spreadArray([i],e,!0))));var c=i;return e.length===0&&c.length===1&&typeof c[0]=="string"?Ue(c):it$1(Ue(st(c,e)))}function ct(i,e,a){if(a===void 0&&(a=C),!e)throw he(1,e);var c=function(h){for(var d=[],et=1;et<arguments.length;et++)d[et-1]=arguments[et];return i(e,a,at$1.apply(void 0,__spreadArray([h],d,!1)))};return c.attrs=function(h){return ct(i,e,__assign$1(__assign$1({},a),{attrs:Array.prototype.concat(a.attrs,h).filter(Boolean)}))},c.withConfig=function(h){return ct(i,e,__assign$1(__assign$1({},a),h))},c}var lt$1=function(i){return ct(rt,i)},ut$1=lt$1;A.forEach(function(i){ut$1[i]=lt$1(i)});var pt$1=function(){function i(e,a){this.rules=e,this.componentId=a,this.isStatic=Je$1(e),Re.registerId(this.componentId+1)}return i.prototype.createStyles=function(e,a,c,h){var d=h(ae(Ue(this.rules,a,c,h)),""),et=this.componentId+e;c.insertRules(et,et,d)},i.prototype.removeStyles=function(e,a){a.clearRules(this.componentId+e)},i.prototype.renderStyles=function(e,a,c,h){e>2&&Re.registerId(this.componentId+e),this.removeStyles(e,c),this.createStyles(e,a,c,h)},i}();function dt$1(i){for(var e=[],a=1;a<arguments.length;a++)e[a-1]=arguments[a];var c=at$1.apply(void 0,__spreadArray([i],e,!1)),h="sc-global-".concat(z(JSON.stringify(c))),d=new pt$1(c,h),et=function(gt){var _t=Be$1(),wt=o.useContext(Ke),$t=o.useRef(_t.styleSheet.allocateGSInstance(h)).current;return _t.styleSheet.server&&ft($t,gt,_t.styleSheet,wt,_t.stylis),o.useLayoutEffect(function(){if(!_t.styleSheet.server)return ft($t,gt,_t.styleSheet,wt,_t.stylis),function(){return d.removeStyles($t,_t.styleSheet)}},[$t,gt,_t.styleSheet,wt,_t.stylis]),null};function ft(gt,_t,wt,$t,It){if(d.isStatic)d.renderStyles(gt,b,wt,It);else{var Rt=__assign$1(__assign$1({},_t),{theme:I(_t,$t,et.defaultProps)});d.renderStyles(gt,Rt,wt,It)}}return o.memo(et)}const StyledHeader=ut$1.header`
    display: flex;
    flex-direction: row;
    justify-content: space-around;
    align-items: center;
    flex-wrap: wrap;

    padding: 18px 40px;
    border-radius: 0;
    background-color: rgba(58, 183, 246, 0.5);

    a {
        text-decoration: none;
        color: black;
    }

    p {
        line-height: 30pt;
        text-align: center;
        vertical-align: middle;
    }

    nav {
        display: flex;
        gap: 0.75rem;
    }
`,colorMapping={black:"#0A0A0A",red:"#E94952",green:"#27A151",blue:"#3F45DE"},Button=ut$1.button`
    color: #FFFFFF;
    padding: 5px 14px;
    font-family: Inter, serif;
    font-size: 18px;
    font-style: normal;
    font-weight: 400;
    line-height: normal;
    cursor: pointer;

    &:disabled {
        cursor: default;
    }

    background-color: ${i=>i.$state!=="empty"?colorMapping[i.$color]:"transparent"};

    border: ${i=>i.$state!=="default"?`2px solid ${colorMapping[i.$color]}`:"none"};

    border-radius: ${i=>i.$roundness==="round"?"25px":"10px"}
`;Button.defaultProps={$state:"default",$roundness:"block"};const logo="/testTrysteroChat/logo.png";function getID(){return crypto.randomUUID()}const unique_id=getID(),defaultUser={username:"noname",id:unique_id};function getNewUser(){return defaultUser}const UserContext=reactExports.createContext({user:getNewUser(),setUser:()=>{}}),useUser=()=>{const{user:i,setUser:e}=reactExports.useContext(UserContext);function a(c){const h={username:c,id:i.id};e(h),localStorage.setItem("user",JSON.stringify(h))}return{user:i,addUser:a}};function getUsernameWithID(i,e,a=10){i.length>a&&(i=i.slice(0,a));const c="#"+e.slice(0,4);return{usernameId:`${i}${c}`,username_part:i,id_part:c}}const Header=()=>{const{user:i,addUser:e}=useUser(),{username_part:a,id_part:c}=getUsernameWithID(i.username,i.id);function h(){const d=prompt("Set new username",i.username);d&&e(d)}return jsxRuntimeExports.jsxs(StyledHeader,{children:[jsxRuntimeExports.jsx(Link,{to:"/",children:jsxRuntimeExports.jsx("img",{src:logo,alt:"logo",width:40,height:40})}),jsxRuntimeExports.jsx("nav",{children:jsxRuntimeExports.jsx(Link,{to:"/about",children:jsxRuntimeExports.jsx("p",{children:"About"})})}),jsxRuntimeExports.jsx("nav",{children:jsxRuntimeExports.jsx(Link,{to:"/global_chat",children:jsxRuntimeExports.jsx("p",{children:"Global"})})}),jsxRuntimeExports.jsx("nav",{children:jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Button,{onClick:h,$color:"black",children:a}),jsxRuntimeExports.jsx("p",{children:c})]})})]})},RootLayout=()=>jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Header,{}),jsxRuntimeExports.jsx(Outlet,{})]}),StyledDiv$5=ut$1.div` 
  padding: 1rem;
`,Home=()=>jsxRuntimeExports.jsx(StyledDiv$5,{children:jsxRuntimeExports.jsx("h1",{children:"Just home page, nothing interesting here..."})});/*! simple-peer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */const MAX_BUFFERED_AMOUNT=64*1024,ICECOMPLETE_TIMEOUT=5*1e3,CHANNEL_CLOSING_TIMEOUT=5*1e3;function randombytes(i){const e=new Uint8Array(i);for(let a=0;a<i;a++)e[a]=Math.random()*256|0;return e}function getBrowserRTC(){if(typeof globalThis>"u")return null;const i={RTCPeerConnection:globalThis.RTCPeerConnection||globalThis.mozRTCPeerConnection||globalThis.webkitRTCPeerConnection,RTCSessionDescription:globalThis.RTCSessionDescription||globalThis.mozRTCSessionDescription||globalThis.webkitRTCSessionDescription,RTCIceCandidate:globalThis.RTCIceCandidate||globalThis.mozRTCIceCandidate||globalThis.webkitRTCIceCandidate};return i.RTCPeerConnection?i:null}function errCode$2(i,e){return Object.defineProperty(i,"code",{value:e,enumerable:!0,configurable:!0}),i}function filterTrickle(i){return i.replace(/a=ice-options:trickle\s\n/g,"")}function warn$1(i){console.warn(i)}let Peer$1=class Go{constructor(e={}){if(this._map=new Map,this._id=randombytes(4).toString("hex").slice(0,7),this._doDebug=e.debug,this._debug("new peer %o",e),this.channelName=e.initiator?e.channelName||randombytes(20).toString("hex"):null,this.initiator=e.initiator||!1,this.channelConfig=e.channelConfig||Go.channelConfig,this.channelNegotiated=this.channelConfig.negotiated,this.config=Object.assign({},Go.config,e.config),this.offerOptions=e.offerOptions||{},this.answerOptions=e.answerOptions||{},this.sdpTransform=e.sdpTransform||(a=>a),this.streams=e.streams||(e.stream?[e.stream]:[]),this.trickle=e.trickle!==void 0?e.trickle:!0,this.allowHalfTrickle=e.allowHalfTrickle!==void 0?e.allowHalfTrickle:!1,this.iceCompleteTimeout=e.iceCompleteTimeout||ICECOMPLETE_TIMEOUT,this.destroyed=!1,this.destroying=!1,this._connected=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,this._wrtc=e.wrtc&&typeof e.wrtc=="object"?e.wrtc:getBrowserRTC(),!this._wrtc)throw errCode$2(typeof window>"u"?new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"):new Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");this._pcReady=!1,this._channelReady=!1,this._iceComplete=!1,this._iceCompleteTimer=null,this._channel=null,this._pendingCandidates=[],this._isNegotiating=!1,this._firstNegotiation=!0,this._batchedNegotiation=!1,this._queuedNegotiation=!1,this._sendersAwaitingStable=[],this._senderMap=new Map,this._closingInterval=null,this._remoteTracks=[],this._remoteStreams=[],this._chunk=null,this._cb=null,this._interval=null;try{this._pc=new this._wrtc.RTCPeerConnection(this.config)}catch(a){this.destroy(errCode$2(a,"ERR_PC_CONSTRUCTOR"));return}this._isReactNativeWebrtc=typeof this._pc._peerConnectionId=="number",this._pc.oniceconnectionstatechange=()=>{this._onIceStateChange()},this._pc.onicegatheringstatechange=()=>{this._onIceStateChange()},this._pc.onconnectionstatechange=()=>{this._onConnectionStateChange()},this._pc.onsignalingstatechange=()=>{this._onSignalingStateChange()},this._pc.onicecandidate=a=>{this._onIceCandidate(a)},typeof this._pc.peerIdentity=="object"&&this._pc.peerIdentity.catch(a=>{this.destroy(errCode$2(a,"ERR_PC_PEER_IDENTITY"))}),this.initiator||this.channelNegotiated?this._setupData({channel:this._pc.createDataChannel(this.channelName,this.channelConfig)}):this._pc.ondatachannel=a=>{this._setupData(a)},this.streams&&this.streams.forEach(a=>{this.addStream(a)}),this._pc.ontrack=a=>{this._onTrack(a)},this._debug("initial negotiation"),this._needsNegotiation()}get bufferSize(){return this._channel&&this._channel.bufferedAmount||0}get connected(){return this._connected&&this._channel.readyState==="open"}address(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}signal(e){if(!this.destroying){if(this.destroyed)throw errCode$2(new Error("cannot signal after peer is destroyed"),"ERR_DESTROYED");if(typeof e=="string")try{e=JSON.parse(e)}catch{e={}}this._debug("signal()"),e.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),e.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(e.transceiverRequest.kind,e.transceiverRequest.init)),e.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(e.candidate):this._pendingCandidates.push(e.candidate)),e.sdp&&this._pc.setRemoteDescription(new this._wrtc.RTCSessionDescription(e)).then(()=>{this.destroyed||(this._pendingCandidates.forEach(a=>{this._addIceCandidate(a)}),this._pendingCandidates=[],this._pc.remoteDescription.type==="offer"&&this._createAnswer())}).catch(a=>{this.destroy(errCode$2(a,"ERR_SET_REMOTE_DESCRIPTION"))}),!e.sdp&&!e.candidate&&!e.renegotiate&&!e.transceiverRequest&&this.destroy(errCode$2(new Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}}_addIceCandidate(e){const a=new this._wrtc.RTCIceCandidate(e);this._pc.addIceCandidate(a).catch(c=>{!a.address||a.address.endsWith(".local")?warn$1("Ignoring unsupported ICE candidate."):this.destroy(errCode$2(c,"ERR_ADD_ICE_CANDIDATE"))})}send(e){if(!this.destroying){if(this.destroyed)throw errCode$2(new Error("cannot send after peer is destroyed"),"ERR_DESTROYED");this._channel.send(e)}}addTransceiver(e,a){if(!this.destroying){if(this.destroyed)throw errCode$2(new Error("cannot addTransceiver after peer is destroyed"),"ERR_DESTROYED");if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(e,a),this._needsNegotiation()}catch(c){this.destroy(errCode$2(c,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{type:"transceiverRequest",transceiverRequest:{kind:e,init:a}})}}addStream(e){if(!this.destroying){if(this.destroyed)throw errCode$2(new Error("cannot addStream after peer is destroyed"),"ERR_DESTROYED");this._debug("addStream()"),e.getTracks().forEach(a=>{this.addTrack(a,e)})}}addTrack(e,a){if(this.destroying)return;if(this.destroyed)throw errCode$2(new Error("cannot addTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("addTrack()");const c=this._senderMap.get(e)||new Map;let h=c.get(a);if(!h)h=this._pc.addTrack(e,a),c.set(a,h),this._senderMap.set(e,c),this._needsNegotiation();else throw h.removed?errCode$2(new Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):errCode$2(new Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED")}replaceTrack(e,a,c){if(this.destroying)return;if(this.destroyed)throw errCode$2(new Error("cannot replaceTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("replaceTrack()");const h=this._senderMap.get(e),d=h?h.get(c):null;if(!d)throw errCode$2(new Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");a&&this._senderMap.set(a,h),d.replaceTrack!=null?d.replaceTrack(a):this.destroy(errCode$2(new Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK"))}removeTrack(e,a){if(this.destroying)return;if(this.destroyed)throw errCode$2(new Error("cannot removeTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSender()");const c=this._senderMap.get(e),h=c?c.get(a):null;if(!h)throw errCode$2(new Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{h.removed=!0,this._pc.removeTrack(h)}catch(d){d.name==="NS_ERROR_UNEXPECTED"?this._sendersAwaitingStable.push(h):this.destroy(errCode$2(d,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}removeStream(e){if(!this.destroying){if(this.destroyed)throw errCode$2(new Error("cannot removeStream after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSenders()"),e.getTracks().forEach(a=>{this.removeTrack(a,e)})}}_needsNegotiation(){this._debug("_needsNegotiation"),!this._batchedNegotiation&&(this._batchedNegotiation=!0,queueMicrotask(()=>{this._batchedNegotiation=!1,this.initiator||!this._firstNegotiation?(this._debug("starting batched negotiation"),this.negotiate()):this._debug("non-initiator initial negotiation request discarded"),this._firstNegotiation=!1}))}negotiate(){if(!this.destroying){if(this.destroyed)throw errCode$2(new Error("cannot negotiate after peer is destroyed"),"ERR_DESTROYED");this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout(()=>{this._createOffer()},0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{type:"renegotiate",renegotiate:!0})),this._isNegotiating=!0}}destroy(e){this.destroyed||this.destroying||(this.destroying=!0,this._debug("destroying (error: %s)",e&&(e.message||e)),queueMicrotask(()=>{if(this.destroyed=!0,this.destroying=!1,this._debug("destroy (error: %s)",e&&(e.message||e)),this._connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._closingInterval),this._closingInterval=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._channel){try{this._channel.close()}catch{}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch{}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.ondatachannel=null}this._pc=null,this._channel=null,e&&this.emit("error",e),this.emit("close")}))}_setupData(e){if(!e.channel)return this.destroy(errCode$2(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=e.channel,this._channel.binaryType="arraybuffer",typeof this._channel.bufferedAmountLowThreshold=="number"&&(this._channel.bufferedAmountLowThreshold=MAX_BUFFERED_AMOUNT),this.channelName=this._channel.label,this._channel.onmessage=c=>{this._onChannelMessage(c)},this._channel.onbufferedamountlow=()=>{this._onChannelBufferedAmountLow()},this._channel.onopen=()=>{this._onChannelOpen()},this._channel.onclose=()=>{this._onChannelClose()},this._channel.onerror=c=>{this.destroy(errCode$2(c,"ERR_DATA_CHANNEL"))};let a=!1;this._closingInterval=setInterval(()=>{this._channel&&this._channel.readyState==="closing"?(a&&this._onChannelClose(),a=!0):a=!1},CHANNEL_CLOSING_TIMEOUT)}_startIceCompleteTimeout(){this.destroyed||this._iceCompleteTimer||(this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout(()=>{this._iceComplete||(this._iceComplete=!0,this._debug("iceComplete timeout completed"),this.emit("iceTimeout"),this.emit("_iceComplete"))},this.iceCompleteTimeout))}_createOffer(){this.destroyed||this._pc.createOffer(this.offerOptions).then(e=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(e.sdp=filterTrickle(e.sdp)),e.sdp=this.sdpTransform(e.sdp);const a=()=>{if(this.destroyed)return;const d=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:d.type,sdp:d.sdp})},c=()=>{this._debug("createOffer success"),!this.destroyed&&(this.trickle||this._iceComplete?a():this.once("_iceComplete",a))},h=d=>{this.destroy(errCode$2(d,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(e).then(c).catch(h)}).catch(e=>{this.destroy(errCode$2(e,"ERR_CREATE_OFFER"))})}_requestMissingTransceivers(){this._pc.getTransceivers&&this._pc.getTransceivers().forEach(e=>{!e.mid&&e.sender.track&&!e.requested&&(e.requested=!0,this.addTransceiver(e.sender.track.kind))})}_createAnswer(){this.destroyed||this._pc.createAnswer(this.answerOptions).then(e=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(e.sdp=filterTrickle(e.sdp)),e.sdp=this.sdpTransform(e.sdp);const a=()=>{if(this.destroyed)return;const d=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:d.type,sdp:d.sdp}),this.initiator||this._requestMissingTransceivers()},c=()=>{this.destroyed||(this.trickle||this._iceComplete?a():this.once("_iceComplete",a))},h=d=>{this.destroy(errCode$2(d,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(e).then(c).catch(h)}).catch(e=>{this.destroy(errCode$2(e,"ERR_CREATE_ANSWER"))})}_onConnectionStateChange(){this.destroyed||this._pc.connectionState==="failed"&&this.destroy(errCode$2(new Error("Connection failed."),"ERR_CONNECTION_FAILURE"))}_onIceStateChange(){if(this.destroyed)return;const e=this._pc.iceConnectionState,a=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",e,a),this.emit("iceStateChange",e,a),(e==="connected"||e==="completed")&&(this._pcReady=!0,this._maybeReady()),e==="failed"&&this.destroy(errCode$2(new Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),e==="closed"&&this.destroy(errCode$2(new Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}getStats(e){const a=c=>(Object.prototype.toString.call(c.values)==="[object Array]"&&c.values.forEach(h=>{Object.assign(c,h)}),c);this._pc.getStats.length===0||this._isReactNativeWebrtc?this._pc.getStats().then(c=>{const h=[];c.forEach(d=>{h.push(a(d))}),e(null,h)},c=>e(c)):this._pc.getStats.length>0?this._pc.getStats(c=>{if(this.destroyed)return;const h=[];c.result().forEach(d=>{const et={};d.names().forEach(ft=>{et[ft]=d.stat(ft)}),et.id=d.id,et.type=d.type,et.timestamp=d.timestamp,h.push(a(et))}),e(null,h)},c=>e(c)):e(null,[])}_maybeReady(){if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),this._connected||this._connecting||!this._pcReady||!this._channelReady)return;this._connecting=!0;const e=()=>{this.destroyed||this.getStats((a,c)=>{if(this.destroyed)return;a&&(c=[]);const h={},d={},et={};let ft=!1;c.forEach(_t=>{(_t.type==="remotecandidate"||_t.type==="remote-candidate")&&(h[_t.id]=_t),(_t.type==="localcandidate"||_t.type==="local-candidate")&&(d[_t.id]=_t),(_t.type==="candidatepair"||_t.type==="candidate-pair")&&(et[_t.id]=_t)});const gt=_t=>{ft=!0;let wt=d[_t.localCandidateId];wt&&(wt.ip||wt.address)?(this.localAddress=wt.ip||wt.address,this.localPort=Number(wt.port)):wt&&wt.ipAddress?(this.localAddress=wt.ipAddress,this.localPort=Number(wt.portNumber)):typeof _t.googLocalAddress=="string"&&(wt=_t.googLocalAddress.split(":"),this.localAddress=wt[0],this.localPort=Number(wt[1])),this.localAddress&&(this.localFamily=this.localAddress.includes(":")?"IPv6":"IPv4");let $t=h[_t.remoteCandidateId];$t&&($t.ip||$t.address)?(this.remoteAddress=$t.ip||$t.address,this.remotePort=Number($t.port)):$t&&$t.ipAddress?(this.remoteAddress=$t.ipAddress,this.remotePort=Number($t.portNumber)):typeof _t.googRemoteAddress=="string"&&($t=_t.googRemoteAddress.split(":"),this.remoteAddress=$t[0],this.remotePort=Number($t[1])),this.remoteAddress&&(this.remoteFamily=this.remoteAddress.includes(":")?"IPv6":"IPv4"),this._debug("connect local: %s:%s remote: %s:%s",this.localAddress,this.localPort,this.remoteAddress,this.remotePort)};if(c.forEach(_t=>{_t.type==="transport"&&_t.selectedCandidatePairId&&gt(et[_t.selectedCandidatePairId]),(_t.type==="googCandidatePair"&&_t.googActiveConnection==="true"||(_t.type==="candidatepair"||_t.type==="candidate-pair")&&_t.selected)&&gt(_t)}),!ft&&(!Object.keys(et).length||Object.keys(d).length)){setTimeout(e,100);return}else this._connecting=!1,this._connected=!0;if(this._chunk){try{this.send(this._chunk)}catch(wt){return this.destroy(errCode$2(wt,"ERR_DATA_CHANNEL"))}this._chunk=null,this._debug('sent chunk from "write before connect"');const _t=this._cb;this._cb=null,_t(null)}typeof this._channel.bufferedAmountLowThreshold!="number"&&(this._interval=setInterval(()=>this._onInterval(),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")})};e()}_onInterval(){!this._cb||!this._channel||this._channel.bufferedAmount>MAX_BUFFERED_AMOUNT||this._onChannelBufferedAmountLow()}_onSignalingStateChange(){this.destroyed||(this._pc.signalingState==="stable"&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach(e=>{this._pc.removeTrack(e),this._queuedNegotiation=!0}),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()):(this._debug("negotiated"),this.emit("negotiated"))),this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}_onIceCandidate(e){this.destroyed||(e.candidate&&this.trickle?this.emit("signal",{type:"candidate",candidate:{candidate:e.candidate.candidate,sdpMLineIndex:e.candidate.sdpMLineIndex,sdpMid:e.candidate.sdpMid}}):!e.candidate&&!this._iceComplete&&(this._iceComplete=!0,this.emit("_iceComplete")),e.candidate&&this._startIceCompleteTimeout())}_onChannelMessage(e){if(this.destroyed)return;let a=e.data;a instanceof ArrayBuffer&&(a=new Uint8Array(a)),this.emit("data",a)}_onChannelBufferedAmountLow(){if(this.destroyed||!this._cb)return;this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);const e=this._cb;this._cb=null,e(null)}_onChannelOpen(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}_onChannelClose(){this.destroyed||(this._debug("on channel close"),this.destroy())}_onTrack(e){this.destroyed||e.streams.forEach(a=>{this._debug("on track"),this.emit("track",e.track,a),this._remoteTracks.push({track:e.track,stream:a}),!this._remoteStreams.some(c=>c.id===a.id)&&(this._remoteStreams.push(a),queueMicrotask(()=>{this._debug("on stream"),this.emit("stream",a)}))})}_debug(...e){this._doDebug&&(e[0]="["+this._id+"] "+e[0],console.log(...e))}on(e,a){const c=this._map;c.has(e)||c.set(e,new Set),c.get(e).add(a)}off(e,a){const c=this._map,h=c.get(e);h&&(h.delete(a),h.size===0&&c.delete(e))}once(e,a){const c=(...h)=>{this.off(e,c),a(...h)};this.on(e,c)}emit(e,...a){const c=this._map;if(c.has(e))for(const h of c.get(e))try{h(...a)}catch(d){console.error(d)}}};Peer$1.WEBRTC_SUPPORT=!!getBrowserRTC();Peer$1.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"};Peer$1.channelConfig={};const charSet="0123456789AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz",initPeer=(i,e,a)=>{const c=new Peer$1({initiator:i,trickle:e,config:a}),h=d=>c.__earlyDataBuffer.push(d);return c.on(events$1.data,h),c.__earlyDataBuffer=[],c.__drainEarlyData=d=>{c.off(events$1.data,h),c.__earlyDataBuffer.forEach(d),delete c.__earlyDataBuffer,delete c.__drainEarlyData},c},genId=i=>Array(i).fill().map(()=>charSet[Math.floor(Math.random()*charSet.length)]).join(""),initGuard=(i,e)=>(a,c)=>{if(i[c])return i[c];if(!a)throw mkErr("requires a config map as the first argument");if(!a.appId&&!a.firebaseApp)throw mkErr("config map is missing appId field");if(!c)throw mkErr("namespace argument required");return i[c]=e(a,c)},libName="Trystero",selfId=genId(20),{keys,values,entries,fromEntries}=Object,noOp=()=>{},mkErr=i=>new Error(`${libName}: ${i}`),encodeBytes=i=>new TextEncoder().encode(i),decodeBytes=i=>new TextDecoder().decode(i),toHex=i=>i.reduce((e,a)=>e+a.toString(16).padStart(2,"0"),""),events$1=fromEntries(["close","connect","data","error","signal","stream","track"].map(i=>[i,i])),getRelays=(i,e,a)=>(i.relayUrls||e).slice(0,i.relayUrls?i.relayUrls.length:i.relayRedundancy||a),sleep=i=>new Promise(e=>setTimeout(e,i)),TypedArray=Object.getPrototypeOf(Uint8Array),typeByteLimit=12,typeIndex=0,nonceIndex=typeIndex+typeByteLimit,tagIndex=nonceIndex+1,progressIndex=tagIndex+1,payloadIndex=progressIndex+1,chunkSize=16*2**10-payloadIndex,oneByteMax=255,buffLowEvent="bufferedamountlow",room=(i,e)=>{const a={},c={},h={},d={},et={},ft={},gt=(hr,gr)=>(hr?Array.isArray(hr)?hr:[hr]:keys(a)).flatMap(er=>{const mr=a[er];return mr?gr(er,mr):(console.warn(`${libName}: no peer with id ${er} found`),[])}),_t=hr=>{a[hr]&&(delete a[hr],delete h[hr],delete d[hr],Wt(hr))},wt=hr=>{if(c[hr])return[c[hr].send,c[hr].setOnComplete,c[hr].setOnProgress];if(!hr)throw mkErr("action type argument is required");const gr=encodeBytes(hr);if(gr.byteLength>typeByteLimit)throw mkErr(`action type string "${hr}" (${gr.byteLength}b) exceeds byte limit (${typeByteLimit}). Hint: choose a shorter name.`);const er=new Uint8Array(typeByteLimit);er.set(gr);let mr=0;return c[hr]={onComplete:noOp,onProgress:noOp,setOnComplete:Mr=>c[hr]={...c[hr],onComplete:Mr},setOnProgress:Mr=>c[hr]={...c[hr],onProgress:Mr},send:async(Mr,wr,Dr,Tr)=>{if(Dr&&typeof Dr!="object")throw mkErr("action meta argument must be an object");if(Mr===void 0)throw mkErr("action data cannot be undefined");const fr=typeof Mr!="string",yr=Mr instanceof Blob,$r=yr||Mr instanceof ArrayBuffer||Mr instanceof TypedArray;if(Dr&&!$r)throw mkErr("action meta argument can only be used with binary data");const Fr=$r?new Uint8Array(yr?await Mr.arrayBuffer():Mr):encodeBytes(fr?JSON.stringify(Mr):Mr),dr=Dr?encodeBytes(JSON.stringify(Dr)):null,Br=Math.ceil(Fr.byteLength/chunkSize)+(Dr?1:0)||1,Hr=Array(Br).fill().map((Jr,zr)=>{const br=zr===Br-1,_r=Dr&&zr===0,Vr=new Uint8Array(payloadIndex+(_r?dr.byteLength:br?Fr.byteLength-chunkSize*(Br-(Dr?2:1)):chunkSize));return Vr.set(er),Vr.set([mr],nonceIndex),Vr.set([br|_r<<1|$r<<2|fr<<3],tagIndex),Vr.set([Math.round((zr+1)/Br*oneByteMax)],progressIndex),Vr.set(Dr?_r?dr:Fr.subarray((zr-1)*chunkSize,zr*chunkSize):Fr.subarray(zr*chunkSize,(zr+1)*chunkSize),payloadIndex),Vr});return mr=mr+1&oneByteMax,Promise.all(gt(wr,async(Jr,zr)=>{const br=zr._channel;let _r=0;for(;_r<Br;){const Vr=Hr[_r];if(br.bufferedAmount>br.bufferedAmountLowThreshold&&await new Promise(lr=>{const Cr=()=>{br.removeEventListener(buffLowEvent,Cr),lr()};br.addEventListener(buffLowEvent,Cr)}),!a[Jr])break;zr.send(Vr),_r++,Tr&&Tr(Vr[progressIndex]/oneByteMax,Jr,Dr)}}))}},[c[hr].send,c[hr].setOnComplete,c[hr].setOnProgress]},$t=(hr,gr)=>{const er=new Uint8Array(gr),mr=decodeBytes(er.subarray(typeIndex,nonceIndex)).replaceAll("\0",""),[Mr]=er.subarray(nonceIndex,tagIndex),[wr]=er.subarray(tagIndex,progressIndex),[Dr]=er.subarray(progressIndex,payloadIndex),Tr=er.subarray(payloadIndex),fr=!!(wr&1),yr=!!(wr&2),$r=!!(wr&4),Fr=!!(wr&8);if(!c[mr])throw mkErr(`received message with unregistered type (${mr})`);h[hr]||(h[hr]={}),h[hr][mr]||(h[hr][mr]={});let dr=h[hr][mr][Mr];if(dr||(dr=h[hr][mr][Mr]={chunks:[]}),yr?dr.meta=JSON.parse(decodeBytes(Tr)):dr.chunks.push(Tr),c[mr].onProgress(Dr/oneByteMax,hr,dr.meta),!fr)return;const Br=new Uint8Array(dr.chunks.reduce((Hr,Jr)=>Hr+Jr.byteLength,0));if(dr.chunks.reduce((Hr,Jr)=>(Br.set(Jr,Hr),Hr+Jr.byteLength),0),$r)c[mr].onComplete(Br,hr,dr.meta);else{const Hr=decodeBytes(Br);c[mr].onComplete(Fr?JSON.parse(Hr):Hr,hr)}delete h[hr][mr][Mr]},[It,Rt]=wt("__91n6__"),[Tt,At]=wt("__90n6__"),[kt,xt]=wt("__516n4L__"),[Nt,Ft]=wt("__57r34m__"),[jt,Gt]=wt("__7r4ck__");let Kt=noOp,Wt=noOp,Zt=noOp,cr=noOp;return i((hr,gr)=>{if(a[gr])return;const er=$t.bind(null,gr);a[gr]=hr,hr.on(events$1.signal,mr=>kt(mr,gr)),hr.on(events$1.close,()=>_t(gr)),hr.on(events$1.data,er),hr.on(events$1.stream,mr=>{Zt(mr,gr,et[gr]),delete et[gr]}),hr.on(events$1.track,(mr,Mr)=>{cr(mr,Mr,gr,ft[gr]),delete ft[gr]}),hr.on(events$1.error,mr=>{mr.code!=="ERR_DATA_CHANNEL"&&console.error(mr)}),Kt(gr),hr.__drainEarlyData(er)}),Rt((hr,gr)=>Tt("",gr)),At((hr,gr)=>{d[gr]&&(d[gr](),delete d[gr])}),xt((hr,gr)=>{a[gr]&&a[gr].signal(hr)}),Ft((hr,gr)=>et[gr]=hr),Gt((hr,gr)=>ft[gr]=hr),{makeAction:wt,ping:async hr=>{if(!hr)throw mkErr("ping() must be called with target peer ID");const gr=Date.now();return It("",hr),await new Promise(er=>d[hr]=er),Date.now()-gr},leave:()=>{entries(a).forEach(([hr,gr])=>{gr.destroy(),delete a[hr]}),e()},getPeers:()=>fromEntries(entries(a).map(([hr,gr])=>[hr,gr._pc])),addStream:(hr,gr,er)=>gt(gr,async(mr,Mr)=>{er&&await Nt(er,mr),Mr.addStream(hr)}),removeStream:(hr,gr)=>gt(gr,(er,mr)=>mr.removeStream(hr)),addTrack:(hr,gr,er,mr)=>gt(er,async(Mr,wr)=>{mr&&await jt(mr,Mr),wr.addTrack(hr,gr)}),removeTrack:(hr,gr,er)=>gt(er,(mr,Mr)=>Mr.removeTrack(hr,gr)),replaceTrack:(hr,gr,er,mr,Mr)=>gt(mr,async(wr,Dr)=>{Mr&&await jt(Mr,wr),Dr.replaceTrack(hr,gr,er)}),onPeerJoin:hr=>Kt=hr,onPeerLeave:hr=>Wt=hr,onPeerStream:hr=>Zt=hr,onPeerTrack:hr=>cr=hr}},algo="AES-CBC",pack=i=>btoa(String.fromCharCode.apply(null,new Uint8Array(i))),unpack=i=>{const e=atob(i);return new Uint8Array(e.length).map((a,c)=>e.charCodeAt(c)).buffer},genKey=async(i,e)=>crypto.subtle.importKey("raw",await crypto.subtle.digest({name:"SHA-256"},encodeBytes(`${i}:${e}`)),{name:algo},!1,["encrypt","decrypt"]),encrypt$2=async(i,e)=>{const a=crypto.getRandomValues(new Uint8Array(16));return JSON.stringify({c:pack(await crypto.subtle.encrypt({name:algo,iv:a},await i,encodeBytes(e))),iv:[...a]})},decrypt$2=async(i,e)=>{const{c:a,iv:c}=JSON.parse(e);return decodeBytes(await crypto.subtle.decrypt({name:algo,iv:new Uint8Array(c)},await i,unpack(a)))},occupiedRooms$4={},socketPromises={},socketRetryTimeouts={},socketListeners={},hashLimit=20,offerPoolSize=10,defaultRedundancy$2=3,defaultAnnounceSecs=33,maxAnnounceSecs=120,trackerRetrySecs=4,trackerAction="announce",defaultRelayUrls$2=["wss://tracker.webtorrent.dev","wss://tracker.openwebtorrent.com","wss://tracker.files.fm:7073/announce","wss://tracker.btorrent.xyz"],joinRoom$5=initGuard(occupiedRooms$4,(i,e)=>{if(i.trackerUrls||i.trackerRedundancy)throw mkErr("trackerUrls/trackerRedundancy have been replaced by relayUrls/relayRedundancy");const a={},c=i.password&&genKey(i.password,e),h=getRelays(i,defaultRelayUrls$2,defaultRedundancy$2),d=crypto.subtle.digest("SHA-1",encodeBytes(`${libName}:${i.appId}:${e}`)).then(Ft=>Array.from(new Uint8Array(Ft)).map(jt=>jt.toString(36)).join("").slice(0,hashLimit)),et=Ft=>fromEntries(Array(Ft).fill().map(()=>{const jt=initPeer(!0,!1,i.rtcConfig);return[genId(hashLimit),{peer:jt,offerP:new Promise(Gt=>jt.once(events$1.signal,Gt))}]})),ft=async(Ft,jt)=>{const Gt=await d;let Kt;try{Kt=JSON.parse(jt.data)}catch{console.error(`${libName}: received malformed SDP JSON`);return}if(Kt.info_hash!==Gt||Kt.peer_id&&Kt.peer_id===selfId)return;const Wt=Kt["failure reason"];if(Wt){console.warn(`${libName}: torrent tracker failure from ${Ft.url} - ${Wt}`);return}if(Kt.interval&&Kt.interval>Tt&&Kt.interval<=maxAnnounceSecs&&(clearInterval(At),Tt=Kt.interval,At=setInterval(wt,Tt*1e3)),Kt.offer&&Kt.offer_id){if(a[Kt.peer_id]||xt[Kt.offer_id])return;xt[Kt.offer_id]=!0;const Zt=initPeer(!1,!1,i.rtcConfig);Zt.once(events$1.signal,async cr=>Ft.send(JSON.stringify({answer:c?{...cr,sdp:await encrypt$2(c,cr.sdp)}:cr,action:trackerAction,info_hash:Gt,peer_id:selfId,to_peer_id:Kt.peer_id,offer_id:Kt.offer_id}))),Zt.on(events$1.connect,()=>It(Zt,Kt.peer_id)),Zt.on(events$1.close,()=>Rt(Zt,Kt.peer_id,Kt.offer_id)),Zt.signal(c?{...Kt.offer,sdp:await decrypt$2(c,Kt.offer.sdp)}:Kt.offer);return}if(Kt.answer){if(a[Kt.peer_id]||xt[Kt.offer_id])return;const Zt=Nt[Kt.offer_id];if(Zt){const{peer:cr}=Zt;if(cr.destroyed)return;xt[Kt.offer_id]=!0,cr.on(events$1.connect,()=>It(cr,Kt.peer_id,Kt.offer_id)),cr.on(events$1.close,()=>Rt(cr,Kt.peer_id,Kt.offer_id)),cr.signal(c?{...Kt.answer,sdp:await decrypt$2(c,Kt.answer.sdp)}:Kt.answer)}}},gt=async(Ft,jt)=>Ft.send(JSON.stringify({action:trackerAction,info_hash:jt,numwant:offerPoolSize,peer_id:selfId,offers:await Promise.all(entries(Nt).map(async([Gt,{offerP:Kt}])=>{const Wt=await Kt;return{offer_id:Gt,offer:c?{...Wt,sdp:await encrypt$2(c,Wt.sdp)}:Wt}}))})),_t=(Ft,jt,Gt)=>(Gt||!socketPromises[Ft]?(socketListeners[Ft]={...socketListeners[Ft],[jt]:ft},socketPromises[Ft]=new Promise(Kt=>{const Wt=new WebSocket(Ft);Wt.addEventListener("open",()=>{socketRetryTimeouts[Ft]=trackerRetrySecs*1e3,Kt(Wt)}),Wt.addEventListener("message",Zt=>values(socketListeners[Ft]).forEach(cr=>cr(Wt,Zt))),Wt.addEventListener("close",async()=>{socketRetryTimeouts[Ft]=socketRetryTimeouts[Ft]??trackerRetrySecs*1e3,await sleep(socketRetryTimeouts[Ft]),socketRetryTimeouts[Ft]*=2,_t(Ft,jt,!0)})})):socketListeners[Ft][jt]=ft,socketPromises[Ft]),wt=async()=>{const Ft=await d;Nt&&$t(),Nt=et(offerPoolSize),h.forEach(async jt=>{const Gt=await _t(jt,Ft);Gt.readyState===WebSocket.OPEN?gt(Gt,Ft):Gt.readyState!==WebSocket.CONNECTING&&gt(await _t(jt,Ft,!0),Ft)})},$t=()=>{entries(Nt).forEach(([Ft,{peer:jt}])=>{!xt[Ft]&&!a[Ft]&&jt.destroy()}),xt={}},It=(Ft,jt,Gt)=>{kt(Ft,jt),a[jt]=!0,Gt&&(a[Gt]=!0)},Rt=(Ft,jt,Gt)=>{delete a[jt],Ft.destroy(),Gt in Nt&&(delete Nt[Gt],Nt={...Nt,...et(1)})};let Tt=defaultAnnounceSecs,At=setInterval(wt,Tt*1e3),kt=noOp,xt={},Nt;return wt(),room(Ft=>kt=Ft,async()=>{const Ft=await d;h.forEach(jt=>delete socketListeners[jt][Ft]),delete occupiedRooms$4[e],clearInterval(At),$t()})});function number$2(i){if(!Number.isSafeInteger(i)||i<0)throw new Error(`positive integer expected, not ${i}`)}function isBytes$4(i){return i instanceof Uint8Array||i!=null&&typeof i=="object"&&i.constructor.name==="Uint8Array"}function bytes$1(i,...e){if(!isBytes$4(i))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(i.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${i.length}`)}function hash$1(i){if(typeof i!="function"||typeof i.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");number$2(i.outputLen),number$2(i.blockLen)}function exists$1(i,e=!0){if(i.destroyed)throw new Error("Hash instance has been destroyed");if(e&&i.finished)throw new Error("Hash#digest() has already been called")}function output$1(i,e){bytes$1(i);const a=e.outputLen;if(i.length<a)throw new Error(`digestInto() expects output buffer of length at least ${a}`)}const crypto$4=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const createView$1=i=>new DataView(i.buffer,i.byteOffset,i.byteLength),rotr=(i,e)=>i<<32-e|i>>>e;new Uint8Array(new Uint32Array([287454020]).buffer)[0];function utf8ToBytes$3(i){if(typeof i!="string")throw new Error(`utf8ToBytes expected string, got ${typeof i}`);return new Uint8Array(new TextEncoder().encode(i))}function toBytes$2(i){return typeof i=="string"&&(i=utf8ToBytes$3(i)),bytes$1(i),i}function concatBytes$2(...i){let e=0;for(let c=0;c<i.length;c++){const h=i[c];bytes$1(h),e+=h.length}const a=new Uint8Array(e);for(let c=0,h=0;c<i.length;c++){const d=i[c];a.set(d,h),h+=d.length}return a}class Hash{clone(){return this._cloneInto()}}function wrapConstructor(i){const e=c=>i().update(toBytes$2(c)).digest(),a=i();return e.outputLen=a.outputLen,e.blockLen=a.blockLen,e.create=()=>i(),e}function randomBytes$2(i=32){if(crypto$4&&typeof crypto$4.getRandomValues=="function")return crypto$4.getRandomValues(new Uint8Array(i));throw new Error("crypto.getRandomValues must be defined")}function setBigUint64$1(i,e,a,c){if(typeof i.setBigUint64=="function")return i.setBigUint64(e,a,c);const h=BigInt(32),d=BigInt(4294967295),et=Number(a>>h&d),ft=Number(a&d),gt=c?4:0,_t=c?0:4;i.setUint32(e+gt,et,c),i.setUint32(e+_t,ft,c)}const Chi=(i,e,a)=>i&e^~i&a,Maj=(i,e,a)=>i&e^i&a^e&a;class HashMD extends Hash{constructor(e,a,c,h){super(),this.blockLen=e,this.outputLen=a,this.padOffset=c,this.isLE=h,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=createView$1(this.buffer)}update(e){exists$1(this);const{view:a,buffer:c,blockLen:h}=this;e=toBytes$2(e);const d=e.length;for(let et=0;et<d;){const ft=Math.min(h-this.pos,d-et);if(ft===h){const gt=createView$1(e);for(;h<=d-et;et+=h)this.process(gt,et);continue}c.set(e.subarray(et,et+ft),this.pos),this.pos+=ft,et+=ft,this.pos===h&&(this.process(a,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){exists$1(this),output$1(e,this),this.finished=!0;const{buffer:a,view:c,blockLen:h,isLE:d}=this;let{pos:et}=this;a[et++]=128,this.buffer.subarray(et).fill(0),this.padOffset>h-et&&(this.process(c,0),et=0);for(let $t=et;$t<h;$t++)a[$t]=0;setBigUint64$1(c,h-8,BigInt(this.length*8),d),this.process(c,0);const ft=createView$1(e),gt=this.outputLen;if(gt%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const _t=gt/4,wt=this.get();if(_t>wt.length)throw new Error("_sha2: outputLen bigger than state");for(let $t=0;$t<_t;$t++)ft.setUint32(4*$t,wt[$t],d)}digest(){const{buffer:e,outputLen:a}=this;this.digestInto(e);const c=e.slice(0,a);return this.destroy(),c}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:a,buffer:c,length:h,finished:d,destroyed:et,pos:ft}=this;return e.length=h,e.pos=ft,e.finished=d,e.destroyed=et,h%a&&e.buffer.set(c),e}}const SHA256_K=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),SHA256_IV=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),SHA256_W=new Uint32Array(64);class SHA256 extends HashMD{constructor(){super(64,32,8,!1),this.A=SHA256_IV[0]|0,this.B=SHA256_IV[1]|0,this.C=SHA256_IV[2]|0,this.D=SHA256_IV[3]|0,this.E=SHA256_IV[4]|0,this.F=SHA256_IV[5]|0,this.G=SHA256_IV[6]|0,this.H=SHA256_IV[7]|0}get(){const{A:e,B:a,C:c,D:h,E:d,F:et,G:ft,H:gt}=this;return[e,a,c,h,d,et,ft,gt]}set(e,a,c,h,d,et,ft,gt){this.A=e|0,this.B=a|0,this.C=c|0,this.D=h|0,this.E=d|0,this.F=et|0,this.G=ft|0,this.H=gt|0}process(e,a){for(let $t=0;$t<16;$t++,a+=4)SHA256_W[$t]=e.getUint32(a,!1);for(let $t=16;$t<64;$t++){const It=SHA256_W[$t-15],Rt=SHA256_W[$t-2],Tt=rotr(It,7)^rotr(It,18)^It>>>3,At=rotr(Rt,17)^rotr(Rt,19)^Rt>>>10;SHA256_W[$t]=At+SHA256_W[$t-7]+Tt+SHA256_W[$t-16]|0}let{A:c,B:h,C:d,D:et,E:ft,F:gt,G:_t,H:wt}=this;for(let $t=0;$t<64;$t++){const It=rotr(ft,6)^rotr(ft,11)^rotr(ft,25),Rt=wt+It+Chi(ft,gt,_t)+SHA256_K[$t]+SHA256_W[$t]|0,At=(rotr(c,2)^rotr(c,13)^rotr(c,22))+Maj(c,h,d)|0;wt=_t,_t=gt,gt=ft,ft=et+Rt|0,et=d,d=h,h=c,c=Rt+At|0}c=c+this.A|0,h=h+this.B|0,d=d+this.C|0,et=et+this.D|0,ft=ft+this.E|0,gt=gt+this.F|0,_t=_t+this.G|0,wt=wt+this.H|0,this.set(c,h,d,et,ft,gt,_t,wt)}roundClean(){SHA256_W.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const sha256$3=wrapConstructor(()=>new SHA256);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$7=BigInt(0),_1n$8=BigInt(1),_2n$5=BigInt(2);function isBytes$3(i){return i instanceof Uint8Array||i!=null&&typeof i=="object"&&i.constructor.name==="Uint8Array"}function abytes(i){if(!isBytes$3(i))throw new Error("Uint8Array expected")}const hexes$1=Array.from({length:256},(i,e)=>e.toString(16).padStart(2,"0"));function bytesToHex$2(i){abytes(i);let e="";for(let a=0;a<i.length;a++)e+=hexes$1[i[a]];return e}function numberToHexUnpadded$1(i){const e=i.toString(16);return e.length&1?`0${e}`:e}function hexToNumber$1(i){if(typeof i!="string")throw new Error("hex string expected, got "+typeof i);return BigInt(i===""?"0":`0x${i}`)}const asciis={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function asciiToBase16(i){if(i>=asciis._0&&i<=asciis._9)return i-asciis._0;if(i>=asciis._A&&i<=asciis._F)return i-(asciis._A-10);if(i>=asciis._a&&i<=asciis._f)return i-(asciis._a-10)}function hexToBytes$2(i){if(typeof i!="string")throw new Error("hex string expected, got "+typeof i);const e=i.length,a=e/2;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const c=new Uint8Array(a);for(let h=0,d=0;h<a;h++,d+=2){const et=asciiToBase16(i.charCodeAt(d)),ft=asciiToBase16(i.charCodeAt(d+1));if(et===void 0||ft===void 0){const gt=i[d]+i[d+1];throw new Error('hex string expected, got non-hex character "'+gt+'" at index '+d)}c[h]=et*16+ft}return c}function bytesToNumberBE(i){return hexToNumber$1(bytesToHex$2(i))}function bytesToNumberLE(i){return abytes(i),hexToNumber$1(bytesToHex$2(Uint8Array.from(i).reverse()))}function numberToBytesBE(i,e){return hexToBytes$2(i.toString(16).padStart(e*2,"0"))}function numberToBytesLE(i,e){return numberToBytesBE(i,e).reverse()}function numberToVarBytesBE(i){return hexToBytes$2(numberToHexUnpadded$1(i))}function ensureBytes$2(i,e,a){let c;if(typeof e=="string")try{c=hexToBytes$2(e)}catch(d){throw new Error(`${i} must be valid hex string, got "${e}". Cause: ${d}`)}else if(isBytes$3(e))c=Uint8Array.from(e);else throw new Error(`${i} must be hex string or Uint8Array`);const h=c.length;if(typeof a=="number"&&h!==a)throw new Error(`${i} expected ${a} bytes, got ${h}`);return c}function concatBytes$1(...i){let e=0;for(let c=0;c<i.length;c++){const h=i[c];abytes(h),e+=h.length}const a=new Uint8Array(e);for(let c=0,h=0;c<i.length;c++){const d=i[c];a.set(d,h),h+=d.length}return a}function equalBytes$1(i,e){if(i.length!==e.length)return!1;let a=0;for(let c=0;c<i.length;c++)a|=i[c]^e[c];return a===0}function utf8ToBytes$2(i){if(typeof i!="string")throw new Error(`utf8ToBytes expected string, got ${typeof i}`);return new Uint8Array(new TextEncoder().encode(i))}function bitLen(i){let e;for(e=0;i>_0n$7;i>>=_1n$8,e+=1);return e}function bitGet(i,e){return i>>BigInt(e)&_1n$8}function bitSet(i,e,a){return i|(a?_1n$8:_0n$7)<<BigInt(e)}const bitMask=i=>(_2n$5<<BigInt(i-1))-_1n$8,u8n=i=>new Uint8Array(i),u8fr=i=>Uint8Array.from(i);function createHmacDrbg(i,e,a){if(typeof i!="number"||i<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof a!="function")throw new Error("hmacFn must be a function");let c=u8n(i),h=u8n(i),d=0;const et=()=>{c.fill(1),h.fill(0),d=0},ft=(...$t)=>a(h,c,...$t),gt=($t=u8n())=>{h=ft(u8fr([0]),$t),c=ft(),$t.length!==0&&(h=ft(u8fr([1]),$t),c=ft())},_t=()=>{if(d++>=1e3)throw new Error("drbg: tried 1000 values");let $t=0;const It=[];for(;$t<e;){c=ft();const Rt=c.slice();It.push(Rt),$t+=c.length}return concatBytes$1(...It)};return($t,It)=>{et(),gt($t);let Rt;for(;!(Rt=It(_t()));)gt();return et(),Rt}}const validatorFns={bigint:i=>typeof i=="bigint",function:i=>typeof i=="function",boolean:i=>typeof i=="boolean",string:i=>typeof i=="string",stringOrUint8Array:i=>typeof i=="string"||isBytes$3(i),isSafeInteger:i=>Number.isSafeInteger(i),array:i=>Array.isArray(i),field:(i,e)=>e.Fp.isValid(i),hash:i=>typeof i=="function"&&Number.isSafeInteger(i.outputLen)};function validateObject(i,e,a={}){const c=(h,d,et)=>{const ft=validatorFns[d];if(typeof ft!="function")throw new Error(`Invalid validator "${d}", expected function`);const gt=i[h];if(!(et&&gt===void 0)&&!ft(gt,i))throw new Error(`Invalid param ${String(h)}=${gt} (${typeof gt}), expected ${d}`)};for(const[h,d]of Object.entries(e))c(h,d,!1);for(const[h,d]of Object.entries(a))c(h,d,!0);return i}const ut=Object.freeze(Object.defineProperty({__proto__:null,abytes,bitGet,bitLen,bitMask,bitSet,bytesToHex:bytesToHex$2,bytesToNumberBE,bytesToNumberLE,concatBytes:concatBytes$1,createHmacDrbg,ensureBytes:ensureBytes$2,equalBytes:equalBytes$1,hexToBytes:hexToBytes$2,hexToNumber:hexToNumber$1,isBytes:isBytes$3,numberToBytesBE,numberToBytesLE,numberToHexUnpadded:numberToHexUnpadded$1,numberToVarBytesBE,utf8ToBytes:utf8ToBytes$2,validateObject},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$6=BigInt(0),_1n$7=BigInt(1),_2n$4=BigInt(2),_3n$2=BigInt(3),_4n=BigInt(4),_5n$1=BigInt(5),_8n$2=BigInt(8);BigInt(9);BigInt(16);function mod$1(i,e){const a=i%e;return a>=_0n$6?a:e+a}function pow(i,e,a){if(a<=_0n$6||e<_0n$6)throw new Error("Expected power/modulo > 0");if(a===_1n$7)return _0n$6;let c=_1n$7;for(;e>_0n$6;)e&_1n$7&&(c=c*i%a),i=i*i%a,e>>=_1n$7;return c}function pow2$1(i,e,a){let c=i;for(;e-- >_0n$6;)c*=c,c%=a;return c}function invert$1(i,e){if(i===_0n$6||e<=_0n$6)throw new Error(`invert: expected positive integers, got n=${i} mod=${e}`);let a=mod$1(i,e),c=e,h=_0n$6,d=_1n$7;for(;a!==_0n$6;){const ft=c/a,gt=c%a,_t=h-d*ft;c=a,a=gt,h=d,d=_t}if(c!==_1n$7)throw new Error("invert: does not exist");return mod$1(h,e)}function tonelliShanks(i){const e=(i-_1n$7)/_2n$4;let a,c,h;for(a=i-_1n$7,c=0;a%_2n$4===_0n$6;a/=_2n$4,c++);for(h=_2n$4;h<i&&pow(h,e,i)!==i-_1n$7;h++);if(c===1){const et=(i+_1n$7)/_4n;return function(gt,_t){const wt=gt.pow(_t,et);if(!gt.eql(gt.sqr(wt),_t))throw new Error("Cannot find square root");return wt}}const d=(a+_1n$7)/_2n$4;return function(ft,gt){if(ft.pow(gt,e)===ft.neg(ft.ONE))throw new Error("Cannot find square root");let _t=c,wt=ft.pow(ft.mul(ft.ONE,h),a),$t=ft.pow(gt,d),It=ft.pow(gt,a);for(;!ft.eql(It,ft.ONE);){if(ft.eql(It,ft.ZERO))return ft.ZERO;let Rt=1;for(let At=ft.sqr(It);Rt<_t&&!ft.eql(At,ft.ONE);Rt++)At=ft.sqr(At);const Tt=ft.pow(wt,_1n$7<<BigInt(_t-Rt-1));wt=ft.sqr(Tt),$t=ft.mul($t,Tt),It=ft.mul(It,wt),_t=Rt}return $t}}function FpSqrt(i){if(i%_4n===_3n$2){const e=(i+_1n$7)/_4n;return function(c,h){const d=c.pow(h,e);if(!c.eql(c.sqr(d),h))throw new Error("Cannot find square root");return d}}if(i%_8n$2===_5n$1){const e=(i-_5n$1)/_8n$2;return function(c,h){const d=c.mul(h,_2n$4),et=c.pow(d,e),ft=c.mul(h,et),gt=c.mul(c.mul(ft,_2n$4),et),_t=c.mul(ft,c.sub(gt,c.ONE));if(!c.eql(c.sqr(_t),h))throw new Error("Cannot find square root");return _t}}return tonelliShanks(i)}const isNegativeLE=(i,e)=>(mod$1(i,e)&_1n$7)===_1n$7,FIELD_FIELDS=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function validateField(i){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},a=FIELD_FIELDS.reduce((c,h)=>(c[h]="function",c),e);return validateObject(i,a)}function FpPow(i,e,a){if(a<_0n$6)throw new Error("Expected power > 0");if(a===_0n$6)return i.ONE;if(a===_1n$7)return e;let c=i.ONE,h=e;for(;a>_0n$6;)a&_1n$7&&(c=i.mul(c,h)),h=i.sqr(h),a>>=_1n$7;return c}function FpInvertBatch(i,e){const a=new Array(e.length),c=e.reduce((d,et,ft)=>i.is0(et)?d:(a[ft]=d,i.mul(d,et)),i.ONE),h=i.inv(c);return e.reduceRight((d,et,ft)=>i.is0(et)?d:(a[ft]=i.mul(d,a[ft]),i.mul(d,et)),h),a}function nLength(i,e){const a=e!==void 0?e:i.toString(2).length,c=Math.ceil(a/8);return{nBitLength:a,nByteLength:c}}function Field(i,e,a=!1,c={}){if(i<=_0n$6)throw new Error(`Expected Field ORDER > 0, got ${i}`);const{nBitLength:h,nByteLength:d}=nLength(i,e);if(d>2048)throw new Error("Field lengths over 2048 bytes are not supported");const et=FpSqrt(i),ft=Object.freeze({ORDER:i,BITS:h,BYTES:d,MASK:bitMask(h),ZERO:_0n$6,ONE:_1n$7,create:gt=>mod$1(gt,i),isValid:gt=>{if(typeof gt!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof gt}`);return _0n$6<=gt&&gt<i},is0:gt=>gt===_0n$6,isOdd:gt=>(gt&_1n$7)===_1n$7,neg:gt=>mod$1(-gt,i),eql:(gt,_t)=>gt===_t,sqr:gt=>mod$1(gt*gt,i),add:(gt,_t)=>mod$1(gt+_t,i),sub:(gt,_t)=>mod$1(gt-_t,i),mul:(gt,_t)=>mod$1(gt*_t,i),pow:(gt,_t)=>FpPow(ft,gt,_t),div:(gt,_t)=>mod$1(gt*invert$1(_t,i),i),sqrN:gt=>gt*gt,addN:(gt,_t)=>gt+_t,subN:(gt,_t)=>gt-_t,mulN:(gt,_t)=>gt*_t,inv:gt=>invert$1(gt,i),sqrt:c.sqrt||(gt=>et(ft,gt)),invertBatch:gt=>FpInvertBatch(ft,gt),cmov:(gt,_t,wt)=>wt?_t:gt,toBytes:gt=>a?numberToBytesLE(gt,d):numberToBytesBE(gt,d),fromBytes:gt=>{if(gt.length!==d)throw new Error(`Fp.fromBytes: expected ${d}, got ${gt.length}`);return a?bytesToNumberLE(gt):bytesToNumberBE(gt)}});return Object.freeze(ft)}function FpSqrtEven(i,e){if(!i.isOdd)throw new Error("Field doesn't have isOdd");const a=i.sqrt(e);return i.isOdd(a)?i.neg(a):a}function getFieldBytesLength(i){if(typeof i!="bigint")throw new Error("field order must be bigint");const e=i.toString(2).length;return Math.ceil(e/8)}function getMinHashLength(i){const e=getFieldBytesLength(i);return e+Math.ceil(e/2)}function mapHashToField(i,e,a=!1){const c=i.length,h=getFieldBytesLength(e),d=getMinHashLength(e);if(c<16||c<d||c>1024)throw new Error(`expected ${d}-1024 bytes of input, got ${c}`);const et=a?bytesToNumberBE(i):bytesToNumberLE(i),ft=mod$1(et,e-_1n$7)+_1n$7;return a?numberToBytesLE(ft,h):numberToBytesBE(ft,h)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$5=BigInt(0),_1n$6=BigInt(1);function wNAF(i,e){const a=(h,d)=>{const et=d.negate();return h?et:d},c=h=>{const d=Math.ceil(e/h)+1,et=2**(h-1);return{windows:d,windowSize:et}};return{constTimeNegate:a,unsafeLadder(h,d){let et=i.ZERO,ft=h;for(;d>_0n$5;)d&_1n$6&&(et=et.add(ft)),ft=ft.double(),d>>=_1n$6;return et},precomputeWindow(h,d){const{windows:et,windowSize:ft}=c(d),gt=[];let _t=h,wt=_t;for(let $t=0;$t<et;$t++){wt=_t,gt.push(wt);for(let It=1;It<ft;It++)wt=wt.add(_t),gt.push(wt);_t=wt.double()}return gt},wNAF(h,d,et){const{windows:ft,windowSize:gt}=c(h);let _t=i.ZERO,wt=i.BASE;const $t=BigInt(2**h-1),It=2**h,Rt=BigInt(h);for(let Tt=0;Tt<ft;Tt++){const At=Tt*gt;let kt=Number(et&$t);et>>=Rt,kt>gt&&(kt-=It,et+=_1n$6);const xt=At,Nt=At+Math.abs(kt)-1,Ft=Tt%2!==0,jt=kt<0;kt===0?wt=wt.add(a(Ft,d[xt])):_t=_t.add(a(jt,d[Nt]))}return{p:_t,f:wt}},wNAFCached(h,d,et,ft){const gt=h._WINDOW_SIZE||1;let _t=d.get(h);return _t||(_t=this.precomputeWindow(h,gt),gt!==1&&d.set(h,ft(_t))),this.wNAF(gt,_t,et)}}}function validateBasic(i){return validateField(i.Fp),validateObject(i,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...nLength(i.n,i.nBitLength),...i,p:i.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function validatePointOpts(i){const e=validateBasic(i);validateObject(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:a,Fp:c,a:h}=e;if(a){if(!c.eql(h,c.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof a!="object"||typeof a.beta!="bigint"||typeof a.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...e})}const{bytesToNumberBE:b2n,hexToBytes:h2b}=ut,DER={Err:class extends Error{constructor(e=""){super(e)}},_parseInt(i){const{Err:e}=DER;if(i.length<2||i[0]!==2)throw new e("Invalid signature integer tag");const a=i[1],c=i.subarray(2,a+2);if(!a||c.length!==a)throw new e("Invalid signature integer: wrong length");if(c[0]&128)throw new e("Invalid signature integer: negative");if(c[0]===0&&!(c[1]&128))throw new e("Invalid signature integer: unnecessary leading zero");return{d:b2n(c),l:i.subarray(a+2)}},toSig(i){const{Err:e}=DER,a=typeof i=="string"?h2b(i):i;abytes(a);let c=a.length;if(c<2||a[0]!=48)throw new e("Invalid signature tag");if(a[1]!==c-2)throw new e("Invalid signature: incorrect length");const{d:h,l:d}=DER._parseInt(a.subarray(2)),{d:et,l:ft}=DER._parseInt(d);if(ft.length)throw new e("Invalid signature: left bytes after parsing");return{r:h,s:et}},hexFromSig(i){const e=_t=>Number.parseInt(_t[0],16)&8?"00"+_t:_t,a=_t=>{const wt=_t.toString(16);return wt.length&1?`0${wt}`:wt},c=e(a(i.s)),h=e(a(i.r)),d=c.length/2,et=h.length/2,ft=a(d),gt=a(et);return`30${a(et+d+4)}02${gt}${h}02${ft}${c}`}},_0n$4=BigInt(0),_1n$5=BigInt(1);BigInt(2);const _3n$1=BigInt(3);BigInt(4);function weierstrassPoints(i){const e=validatePointOpts(i),{Fp:a}=e,c=e.toBytes||((Tt,At,kt)=>{const xt=At.toAffine();return concatBytes$1(Uint8Array.from([4]),a.toBytes(xt.x),a.toBytes(xt.y))}),h=e.fromBytes||(Tt=>{const At=Tt.subarray(1),kt=a.fromBytes(At.subarray(0,a.BYTES)),xt=a.fromBytes(At.subarray(a.BYTES,2*a.BYTES));return{x:kt,y:xt}});function d(Tt){const{a:At,b:kt}=e,xt=a.sqr(Tt),Nt=a.mul(xt,Tt);return a.add(a.add(Nt,a.mul(Tt,At)),kt)}if(!a.eql(a.sqr(e.Gy),d(e.Gx)))throw new Error("bad generator point: equation left != right");function et(Tt){return typeof Tt=="bigint"&&_0n$4<Tt&&Tt<e.n}function ft(Tt){if(!et(Tt))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function gt(Tt){const{allowedPrivateKeyLengths:At,nByteLength:kt,wrapPrivateKey:xt,n:Nt}=e;if(At&&typeof Tt!="bigint"){if(isBytes$3(Tt)&&(Tt=bytesToHex$2(Tt)),typeof Tt!="string"||!At.includes(Tt.length))throw new Error("Invalid key");Tt=Tt.padStart(kt*2,"0")}let Ft;try{Ft=typeof Tt=="bigint"?Tt:bytesToNumberBE(ensureBytes$2("private key",Tt,kt))}catch{throw new Error(`private key must be ${kt} bytes, hex or bigint, not ${typeof Tt}`)}return xt&&(Ft=mod$1(Ft,Nt)),ft(Ft),Ft}const _t=new Map;function wt(Tt){if(!(Tt instanceof $t))throw new Error("ProjectivePoint expected")}class $t{constructor(At,kt,xt){if(this.px=At,this.py=kt,this.pz=xt,At==null||!a.isValid(At))throw new Error("x required");if(kt==null||!a.isValid(kt))throw new Error("y required");if(xt==null||!a.isValid(xt))throw new Error("z required")}static fromAffine(At){const{x:kt,y:xt}=At||{};if(!At||!a.isValid(kt)||!a.isValid(xt))throw new Error("invalid affine point");if(At instanceof $t)throw new Error("projective point not allowed");const Nt=Ft=>a.eql(Ft,a.ZERO);return Nt(kt)&&Nt(xt)?$t.ZERO:new $t(kt,xt,a.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(At){const kt=a.invertBatch(At.map(xt=>xt.pz));return At.map((xt,Nt)=>xt.toAffine(kt[Nt])).map($t.fromAffine)}static fromHex(At){const kt=$t.fromAffine(h(ensureBytes$2("pointHex",At)));return kt.assertValidity(),kt}static fromPrivateKey(At){return $t.BASE.multiply(gt(At))}_setWindowSize(At){this._WINDOW_SIZE=At,_t.delete(this)}assertValidity(){if(this.is0()){if(e.allowInfinityPoint&&!a.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:At,y:kt}=this.toAffine();if(!a.isValid(At)||!a.isValid(kt))throw new Error("bad point: x or y not FE");const xt=a.sqr(kt),Nt=d(At);if(!a.eql(xt,Nt))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:At}=this.toAffine();if(a.isOdd)return!a.isOdd(At);throw new Error("Field doesn't support isOdd")}equals(At){wt(At);const{px:kt,py:xt,pz:Nt}=this,{px:Ft,py:jt,pz:Gt}=At,Kt=a.eql(a.mul(kt,Gt),a.mul(Ft,Nt)),Wt=a.eql(a.mul(xt,Gt),a.mul(jt,Nt));return Kt&&Wt}negate(){return new $t(this.px,a.neg(this.py),this.pz)}double(){const{a:At,b:kt}=e,xt=a.mul(kt,_3n$1),{px:Nt,py:Ft,pz:jt}=this;let Gt=a.ZERO,Kt=a.ZERO,Wt=a.ZERO,Zt=a.mul(Nt,Nt),cr=a.mul(Ft,Ft),hr=a.mul(jt,jt),gr=a.mul(Nt,Ft);return gr=a.add(gr,gr),Wt=a.mul(Nt,jt),Wt=a.add(Wt,Wt),Gt=a.mul(At,Wt),Kt=a.mul(xt,hr),Kt=a.add(Gt,Kt),Gt=a.sub(cr,Kt),Kt=a.add(cr,Kt),Kt=a.mul(Gt,Kt),Gt=a.mul(gr,Gt),Wt=a.mul(xt,Wt),hr=a.mul(At,hr),gr=a.sub(Zt,hr),gr=a.mul(At,gr),gr=a.add(gr,Wt),Wt=a.add(Zt,Zt),Zt=a.add(Wt,Zt),Zt=a.add(Zt,hr),Zt=a.mul(Zt,gr),Kt=a.add(Kt,Zt),hr=a.mul(Ft,jt),hr=a.add(hr,hr),Zt=a.mul(hr,gr),Gt=a.sub(Gt,Zt),Wt=a.mul(hr,cr),Wt=a.add(Wt,Wt),Wt=a.add(Wt,Wt),new $t(Gt,Kt,Wt)}add(At){wt(At);const{px:kt,py:xt,pz:Nt}=this,{px:Ft,py:jt,pz:Gt}=At;let Kt=a.ZERO,Wt=a.ZERO,Zt=a.ZERO;const cr=e.a,hr=a.mul(e.b,_3n$1);let gr=a.mul(kt,Ft),er=a.mul(xt,jt),mr=a.mul(Nt,Gt),Mr=a.add(kt,xt),wr=a.add(Ft,jt);Mr=a.mul(Mr,wr),wr=a.add(gr,er),Mr=a.sub(Mr,wr),wr=a.add(kt,Nt);let Dr=a.add(Ft,Gt);return wr=a.mul(wr,Dr),Dr=a.add(gr,mr),wr=a.sub(wr,Dr),Dr=a.add(xt,Nt),Kt=a.add(jt,Gt),Dr=a.mul(Dr,Kt),Kt=a.add(er,mr),Dr=a.sub(Dr,Kt),Zt=a.mul(cr,wr),Kt=a.mul(hr,mr),Zt=a.add(Kt,Zt),Kt=a.sub(er,Zt),Zt=a.add(er,Zt),Wt=a.mul(Kt,Zt),er=a.add(gr,gr),er=a.add(er,gr),mr=a.mul(cr,mr),wr=a.mul(hr,wr),er=a.add(er,mr),mr=a.sub(gr,mr),mr=a.mul(cr,mr),wr=a.add(wr,mr),gr=a.mul(er,wr),Wt=a.add(Wt,gr),gr=a.mul(Dr,wr),Kt=a.mul(Mr,Kt),Kt=a.sub(Kt,gr),gr=a.mul(Mr,er),Zt=a.mul(Dr,Zt),Zt=a.add(Zt,gr),new $t(Kt,Wt,Zt)}subtract(At){return this.add(At.negate())}is0(){return this.equals($t.ZERO)}wNAF(At){return Rt.wNAFCached(this,_t,At,kt=>{const xt=a.invertBatch(kt.map(Nt=>Nt.pz));return kt.map((Nt,Ft)=>Nt.toAffine(xt[Ft])).map($t.fromAffine)})}multiplyUnsafe(At){const kt=$t.ZERO;if(At===_0n$4)return kt;if(ft(At),At===_1n$5)return this;const{endo:xt}=e;if(!xt)return Rt.unsafeLadder(this,At);let{k1neg:Nt,k1:Ft,k2neg:jt,k2:Gt}=xt.splitScalar(At),Kt=kt,Wt=kt,Zt=this;for(;Ft>_0n$4||Gt>_0n$4;)Ft&_1n$5&&(Kt=Kt.add(Zt)),Gt&_1n$5&&(Wt=Wt.add(Zt)),Zt=Zt.double(),Ft>>=_1n$5,Gt>>=_1n$5;return Nt&&(Kt=Kt.negate()),jt&&(Wt=Wt.negate()),Wt=new $t(a.mul(Wt.px,xt.beta),Wt.py,Wt.pz),Kt.add(Wt)}multiply(At){ft(At);let kt=At,xt,Nt;const{endo:Ft}=e;if(Ft){const{k1neg:jt,k1:Gt,k2neg:Kt,k2:Wt}=Ft.splitScalar(kt);let{p:Zt,f:cr}=this.wNAF(Gt),{p:hr,f:gr}=this.wNAF(Wt);Zt=Rt.constTimeNegate(jt,Zt),hr=Rt.constTimeNegate(Kt,hr),hr=new $t(a.mul(hr.px,Ft.beta),hr.py,hr.pz),xt=Zt.add(hr),Nt=cr.add(gr)}else{const{p:jt,f:Gt}=this.wNAF(kt);xt=jt,Nt=Gt}return $t.normalizeZ([xt,Nt])[0]}multiplyAndAddUnsafe(At,kt,xt){const Nt=$t.BASE,Ft=(Gt,Kt)=>Kt===_0n$4||Kt===_1n$5||!Gt.equals(Nt)?Gt.multiplyUnsafe(Kt):Gt.multiply(Kt),jt=Ft(this,kt).add(Ft(At,xt));return jt.is0()?void 0:jt}toAffine(At){const{px:kt,py:xt,pz:Nt}=this,Ft=this.is0();At==null&&(At=Ft?a.ONE:a.inv(Nt));const jt=a.mul(kt,At),Gt=a.mul(xt,At),Kt=a.mul(Nt,At);if(Ft)return{x:a.ZERO,y:a.ZERO};if(!a.eql(Kt,a.ONE))throw new Error("invZ was invalid");return{x:jt,y:Gt}}isTorsionFree(){const{h:At,isTorsionFree:kt}=e;if(At===_1n$5)return!0;if(kt)return kt($t,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:At,clearCofactor:kt}=e;return At===_1n$5?this:kt?kt($t,this):this.multiplyUnsafe(e.h)}toRawBytes(At=!0){return this.assertValidity(),c($t,this,At)}toHex(At=!0){return bytesToHex$2(this.toRawBytes(At))}}$t.BASE=new $t(e.Gx,e.Gy,a.ONE),$t.ZERO=new $t(a.ZERO,a.ONE,a.ZERO);const It=e.nBitLength,Rt=wNAF($t,e.endo?Math.ceil(It/2):It);return{CURVE:e,ProjectivePoint:$t,normPrivateKeyToScalar:gt,weierstrassEquation:d,isWithinCurveOrder:et}}function validateOpts$2(i){const e=validateBasic(i);return validateObject(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function weierstrass$1(i){const e=validateOpts$2(i),{Fp:a,n:c}=e,h=a.BYTES+1,d=2*a.BYTES+1;function et(wr){return _0n$4<wr&&wr<a.ORDER}function ft(wr){return mod$1(wr,c)}function gt(wr){return invert$1(wr,c)}const{ProjectivePoint:_t,normPrivateKeyToScalar:wt,weierstrassEquation:$t,isWithinCurveOrder:It}=weierstrassPoints({...e,toBytes(wr,Dr,Tr){const fr=Dr.toAffine(),yr=a.toBytes(fr.x),$r=concatBytes$1;return Tr?$r(Uint8Array.from([Dr.hasEvenY()?2:3]),yr):$r(Uint8Array.from([4]),yr,a.toBytes(fr.y))},fromBytes(wr){const Dr=wr.length,Tr=wr[0],fr=wr.subarray(1);if(Dr===h&&(Tr===2||Tr===3)){const yr=bytesToNumberBE(fr);if(!et(yr))throw new Error("Point is not on curve");const $r=$t(yr);let Fr;try{Fr=a.sqrt($r)}catch(Hr){const Jr=Hr instanceof Error?": "+Hr.message:"";throw new Error("Point is not on curve"+Jr)}const dr=(Fr&_1n$5)===_1n$5;return(Tr&1)===1!==dr&&(Fr=a.neg(Fr)),{x:yr,y:Fr}}else if(Dr===d&&Tr===4){const yr=a.fromBytes(fr.subarray(0,a.BYTES)),$r=a.fromBytes(fr.subarray(a.BYTES,2*a.BYTES));return{x:yr,y:$r}}else throw new Error(`Point of length ${Dr} was invalid. Expected ${h} compressed bytes or ${d} uncompressed bytes`)}}),Rt=wr=>bytesToHex$2(numberToBytesBE(wr,e.nByteLength));function Tt(wr){const Dr=c>>_1n$5;return wr>Dr}function At(wr){return Tt(wr)?ft(-wr):wr}const kt=(wr,Dr,Tr)=>bytesToNumberBE(wr.slice(Dr,Tr));class xt{constructor(Dr,Tr,fr){this.r=Dr,this.s=Tr,this.recovery=fr,this.assertValidity()}static fromCompact(Dr){const Tr=e.nByteLength;return Dr=ensureBytes$2("compactSignature",Dr,Tr*2),new xt(kt(Dr,0,Tr),kt(Dr,Tr,2*Tr))}static fromDER(Dr){const{r:Tr,s:fr}=DER.toSig(ensureBytes$2("DER",Dr));return new xt(Tr,fr)}assertValidity(){if(!It(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!It(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(Dr){return new xt(this.r,this.s,Dr)}recoverPublicKey(Dr){const{r:Tr,s:fr,recovery:yr}=this,$r=Wt(ensureBytes$2("msgHash",Dr));if(yr==null||![0,1,2,3].includes(yr))throw new Error("recovery id invalid");const Fr=yr===2||yr===3?Tr+e.n:Tr;if(Fr>=a.ORDER)throw new Error("recovery id 2 or 3 invalid");const dr=yr&1?"03":"02",Br=_t.fromHex(dr+Rt(Fr)),Hr=gt(Fr),Jr=ft(-$r*Hr),zr=ft(fr*Hr),br=_t.BASE.multiplyAndAddUnsafe(Br,Jr,zr);if(!br)throw new Error("point at infinify");return br.assertValidity(),br}hasHighS(){return Tt(this.s)}normalizeS(){return this.hasHighS()?new xt(this.r,ft(-this.s),this.recovery):this}toDERRawBytes(){return hexToBytes$2(this.toDERHex())}toDERHex(){return DER.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return hexToBytes$2(this.toCompactHex())}toCompactHex(){return Rt(this.r)+Rt(this.s)}}const Nt={isValidPrivateKey(wr){try{return wt(wr),!0}catch{return!1}},normPrivateKeyToScalar:wt,randomPrivateKey:()=>{const wr=getMinHashLength(e.n);return mapHashToField(e.randomBytes(wr),e.n)},precompute(wr=8,Dr=_t.BASE){return Dr._setWindowSize(wr),Dr.multiply(BigInt(3)),Dr}};function Ft(wr,Dr=!0){return _t.fromPrivateKey(wr).toRawBytes(Dr)}function jt(wr){const Dr=isBytes$3(wr),Tr=typeof wr=="string",fr=(Dr||Tr)&&wr.length;return Dr?fr===h||fr===d:Tr?fr===2*h||fr===2*d:wr instanceof _t}function Gt(wr,Dr,Tr=!0){if(jt(wr))throw new Error("first arg must be private key");if(!jt(Dr))throw new Error("second arg must be public key");return _t.fromHex(Dr).multiply(wt(wr)).toRawBytes(Tr)}const Kt=e.bits2int||function(wr){const Dr=bytesToNumberBE(wr),Tr=wr.length*8-e.nBitLength;return Tr>0?Dr>>BigInt(Tr):Dr},Wt=e.bits2int_modN||function(wr){return ft(Kt(wr))},Zt=bitMask(e.nBitLength);function cr(wr){if(typeof wr!="bigint")throw new Error("bigint expected");if(!(_0n$4<=wr&&wr<Zt))throw new Error(`bigint expected < 2^${e.nBitLength}`);return numberToBytesBE(wr,e.nByteLength)}function hr(wr,Dr,Tr=gr){if(["recovered","canonical"].some(Vr=>Vr in Tr))throw new Error("sign() legacy options not supported");const{hash:fr,randomBytes:yr}=e;let{lowS:$r,prehash:Fr,extraEntropy:dr}=Tr;$r==null&&($r=!0),wr=ensureBytes$2("msgHash",wr),Fr&&(wr=ensureBytes$2("prehashed msgHash",fr(wr)));const Br=Wt(wr),Hr=wt(Dr),Jr=[cr(Hr),cr(Br)];if(dr!=null&&dr!==!1){const Vr=dr===!0?yr(a.BYTES):dr;Jr.push(ensureBytes$2("extraEntropy",Vr))}const zr=concatBytes$1(...Jr),br=Br;function _r(Vr){const lr=Kt(Vr);if(!It(lr))return;const Cr=gt(lr),xr=_t.BASE.multiply(lr).toAffine(),Kr=ft(xr.x);if(Kr===_0n$4)return;const Gr=ft(Cr*ft(br+Kr*Hr));if(Gr===_0n$4)return;let vr=(xr.x===Kr?0:2)|Number(xr.y&_1n$5),Nr=Gr;return $r&&Tt(Gr)&&(Nr=At(Gr),vr^=1),new xt(Kr,Nr,vr)}return{seed:zr,k2sig:_r}}const gr={lowS:e.lowS,prehash:!1},er={lowS:e.lowS,prehash:!1};function mr(wr,Dr,Tr=gr){const{seed:fr,k2sig:yr}=hr(wr,Dr,Tr),$r=e;return createHmacDrbg($r.hash.outputLen,$r.nByteLength,$r.hmac)(fr,yr)}_t.BASE._setWindowSize(8);function Mr(wr,Dr,Tr,fr=er){var xr;const yr=wr;if(Dr=ensureBytes$2("msgHash",Dr),Tr=ensureBytes$2("publicKey",Tr),"strict"in fr)throw new Error("options.strict was renamed to lowS");const{lowS:$r,prehash:Fr}=fr;let dr,Br;try{if(typeof yr=="string"||isBytes$3(yr))try{dr=xt.fromDER(yr)}catch(Kr){if(!(Kr instanceof DER.Err))throw Kr;dr=xt.fromCompact(yr)}else if(typeof yr=="object"&&typeof yr.r=="bigint"&&typeof yr.s=="bigint"){const{r:Kr,s:Gr}=yr;dr=new xt(Kr,Gr)}else throw new Error("PARSE");Br=_t.fromHex(Tr)}catch(Kr){if(Kr.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if($r&&dr.hasHighS())return!1;Fr&&(Dr=e.hash(Dr));const{r:Hr,s:Jr}=dr,zr=Wt(Dr),br=gt(Jr),_r=ft(zr*br),Vr=ft(Hr*br),lr=(xr=_t.BASE.multiplyAndAddUnsafe(Br,_r,Vr))==null?void 0:xr.toAffine();return lr?ft(lr.x)===Hr:!1}return{CURVE:e,getPublicKey:Ft,getSharedSecret:Gt,sign:mr,verify:Mr,ProjectivePoint:_t,Signature:xt,utils:Nt}}class HMAC extends Hash{constructor(e,a){super(),this.finished=!1,this.destroyed=!1,hash$1(e);const c=toBytes$2(a);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const h=this.blockLen,d=new Uint8Array(h);d.set(c.length>h?e.create().update(c).digest():c);for(let et=0;et<d.length;et++)d[et]^=54;this.iHash.update(d),this.oHash=e.create();for(let et=0;et<d.length;et++)d[et]^=106;this.oHash.update(d),d.fill(0)}update(e){return exists$1(this),this.iHash.update(e),this}digestInto(e){exists$1(this),bytes$1(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:a,iHash:c,finished:h,destroyed:d,blockLen:et,outputLen:ft}=this;return e=e,e.finished=h,e.destroyed=d,e.blockLen=et,e.outputLen=ft,e.oHash=a._cloneInto(e.oHash),e.iHash=c._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const hmac$1=(i,e,a)=>new HMAC(i,e).update(a).digest();hmac$1.create=(i,e)=>new HMAC(i,e);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function getHash(i){return{hash:i,hmac:(e,...a)=>hmac$1(i,e,concatBytes$2(...a)),randomBytes:randomBytes$2}}function createCurve(i,e){const a=c=>weierstrass$1({...i,...getHash(c)});return Object.freeze({...a(e),create:a})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const secp256k1P=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),secp256k1N=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),_1n$4=BigInt(1),_2n$3=BigInt(2),divNearest$1=(i,e)=>(i+e/_2n$3)/e;function sqrtMod$1(i){const e=secp256k1P,a=BigInt(3),c=BigInt(6),h=BigInt(11),d=BigInt(22),et=BigInt(23),ft=BigInt(44),gt=BigInt(88),_t=i*i*i%e,wt=_t*_t*i%e,$t=pow2$1(wt,a,e)*wt%e,It=pow2$1($t,a,e)*wt%e,Rt=pow2$1(It,_2n$3,e)*_t%e,Tt=pow2$1(Rt,h,e)*Rt%e,At=pow2$1(Tt,d,e)*Tt%e,kt=pow2$1(At,ft,e)*At%e,xt=pow2$1(kt,gt,e)*kt%e,Nt=pow2$1(xt,ft,e)*At%e,Ft=pow2$1(Nt,a,e)*wt%e,jt=pow2$1(Ft,et,e)*Tt%e,Gt=pow2$1(jt,c,e)*_t%e,Kt=pow2$1(Gt,_2n$3,e);if(!Fp$1.eql(Fp$1.sqr(Kt),i))throw new Error("Cannot find square root");return Kt}const Fp$1=Field(secp256k1P,void 0,void 0,{sqrt:sqrtMod$1}),secp256k1=createCurve({a:BigInt(0),b:BigInt(7),Fp:Fp$1,n:secp256k1N,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:i=>{const e=secp256k1N,a=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),c=-_1n$4*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),h=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),d=a,et=BigInt("0x100000000000000000000000000000000"),ft=divNearest$1(d*i,e),gt=divNearest$1(-c*i,e);let _t=mod$1(i-ft*a-gt*h,e),wt=mod$1(-ft*c-gt*d,e);const $t=_t>et,It=wt>et;if($t&&(_t=e-_t),It&&(wt=e-wt),_t>et||wt>et)throw new Error("splitScalar: Endomorphism failed, k="+i);return{k1neg:$t,k1:_t,k2neg:It,k2:wt}}}},sha256$3),_0n$3=BigInt(0),fe$1=i=>typeof i=="bigint"&&_0n$3<i&&i<secp256k1P,ge=i=>typeof i=="bigint"&&_0n$3<i&&i<secp256k1N,TAGGED_HASH_PREFIXES$1={};function taggedHash(i,...e){let a=TAGGED_HASH_PREFIXES$1[i];if(a===void 0){const c=sha256$3(Uint8Array.from(i,h=>h.charCodeAt(0)));a=concatBytes$1(c,c),TAGGED_HASH_PREFIXES$1[i]=a}return sha256$3(concatBytes$1(a,...e))}const pointToBytes=i=>i.toRawBytes(!0).slice(1),numTo32b$1=i=>numberToBytesBE(i,32),modP=i=>mod$1(i,secp256k1P),modN=i=>mod$1(i,secp256k1N),Point$1=secp256k1.ProjectivePoint,GmulAdd=(i,e,a)=>Point$1.BASE.multiplyAndAddUnsafe(i,e,a);function schnorrGetExtPubKey(i){let e=secp256k1.utils.normPrivateKeyToScalar(i),a=Point$1.fromPrivateKey(e);return{scalar:a.hasEvenY()?e:modN(-e),bytes:pointToBytes(a)}}function lift_x(i){if(!fe$1(i))throw new Error("bad x: need 0 < x < p");const e=modP(i*i),a=modP(e*i+BigInt(7));let c=sqrtMod$1(a);c%_2n$3!==_0n$3&&(c=modP(-c));const h=new Point$1(i,c,_1n$4);return h.assertValidity(),h}function challenge(...i){return modN(bytesToNumberBE(taggedHash("BIP0340/challenge",...i)))}function schnorrGetPublicKey(i){return schnorrGetExtPubKey(i).bytes}function schnorrSign(i,e,a=randomBytes$2(32)){const c=ensureBytes$2("message",i),{bytes:h,scalar:d}=schnorrGetExtPubKey(e),et=ensureBytes$2("auxRand",a,32),ft=numTo32b$1(d^bytesToNumberBE(taggedHash("BIP0340/aux",et))),gt=taggedHash("BIP0340/nonce",ft,h,c),_t=modN(bytesToNumberBE(gt));if(_t===_0n$3)throw new Error("sign failed: k is zero");const{bytes:wt,scalar:$t}=schnorrGetExtPubKey(_t),It=challenge(wt,h,c),Rt=new Uint8Array(64);if(Rt.set(wt,0),Rt.set(numTo32b$1(modN($t+It*d)),32),!schnorrVerify(Rt,c,h))throw new Error("sign: Invalid signature produced");return Rt}function schnorrVerify(i,e,a){const c=ensureBytes$2("signature",i,64),h=ensureBytes$2("message",e),d=ensureBytes$2("publicKey",a,32);try{const et=lift_x(bytesToNumberBE(d)),ft=bytesToNumberBE(c.subarray(0,32));if(!fe$1(ft))return!1;const gt=bytesToNumberBE(c.subarray(32,64));if(!ge(gt))return!1;const _t=challenge(numTo32b$1(ft),pointToBytes(et),h),wt=GmulAdd(et,gt,modN(-_t));return!(!wt||!wt.hasEvenY()||wt.toAffine().x!==ft)}catch{return!1}}const schnorr={getPublicKey:schnorrGetPublicKey,sign:schnorrSign,verify:schnorrVerify,utils:{randomPrivateKey:secp256k1.utils.randomPrivateKey,lift_x,pointToBytes,numberToBytesBE,bytesToNumberBE,taggedHash,mod:mod$1}},occupiedRooms$3={},defaultRedundancy$1=4,kind=29333,tag="x",privateKey=toHex(crypto.getRandomValues(new Uint8Array(32))),publicKey=toHex(schnorr.getPublicKey(privateKey)),sockets={},now=()=>Math.floor(Date.now()/1e3),defaultRelayUrls$1=["wss://relay.nostr.net","wss://relay.blackbyte.nl","wss://relay.piazza.today","wss://relay.exit.pub","wss://relay.nostr.band","wss://relay.damus.io","wss://nostr.mom","wss://relay.snort.social","wss://nostr.lu.ke","wss://relay.plebstr.com","wss://nostr.sathoarder.com","wss://nsrelay.assilvestrar.club","wss://nostrasia.casa","wss://relay.nostr.bg","wss://relay.nostrr.de","wss://relay.nostrss.re"],joinRoom$4=initGuard(occupiedRooms$3,(i,e)=>{const a=i.password&&genKey(i.password,e),c=`${libName.toLowerCase()}/${i.appId}/${e}`,h=`${c}/${selfId}`,d=genId(64),et=genId(64),ft={},gt={},_t={},wt=getRelays(i,defaultRelayUrls$1,defaultRedundancy$1),$t=(xt,Nt)=>{kt(xt,Nt),_t[Nt]=xt},It=xt=>{delete ft[xt],delete gt[xt],delete _t[xt]},Rt=(xt,Nt)=>JSON.stringify(["REQ",xt,{kinds:[kind],since:now(),["#"+tag]:[Nt]}]),Tt=xt=>JSON.stringify(["CLOSE",xt]),At=async(xt,Nt)=>{const Ft={kind,content:JSON.stringify(Nt),pubkey:publicKey,created_at:now(),tags:[[tag,xt]]},jt=toHex(new Uint8Array(await crypto.subtle.digest("SHA-256",encodeBytes(JSON.stringify([0,Ft.pubkey,Ft.created_at,Ft.kind,Ft.tags,Ft.content])))));return JSON.stringify(["EVENT",{...Ft,id:jt,sig:toHex(await schnorr.sign(jt,privateKey))}])};let kt=noOp;return wt.forEach(xt=>{const Nt=new WebSocket(xt);sockets[xt]=Nt,Nt.addEventListener("open",async()=>{Nt.send(Rt(d,c)),Nt.send(Rt(et,h)),Nt.send(await At(c,selfId))}),Nt.addEventListener("message",async Ft=>{const[jt,Gt,Kt,Wt]=JSON.parse(Ft.data);if(jt!=="EVENT"){jt==="OK"&&!Kt&&console.warn(`${libName}: relay failure from ${Nt.url} - ${Wt}`);return}const Zt=JSON.parse(Kt.content);if(Gt===d){const cr=Zt;if(cr!==selfId&&!_t[cr]&&!gt[cr]){gt[cr]=!0;const hr=ft[cr]=initPeer(!0,!1,i.rtcConfig);hr.once(events$1.signal,async gr=>{Nt.send(await At(`${c}/${cr}`,{peerId:selfId,offer:a?{...gr,sdp:await encrypt$2(a,gr.sdp)}:gr}))}),hr.once(events$1.connect,()=>$t(hr,cr)),hr.once(events$1.close,()=>It(cr))}}else if(Gt===et){const{peerId:cr,offer:hr,answer:gr}=Zt;if(ft[cr]&&gr){ft[cr].signal(a?{...gr,sdp:await decrypt$2(a,gr.sdp)}:gr);return}if(!hr)return;const er=initPeer(!1,!1,i.rtcConfig);er.once(events$1.signal,async mr=>Nt.send(await At(`${c}/${cr}`,{peerId:selfId,answer:a?{...mr,sdp:await encrypt$2(a,mr.sdp)}:mr}))),er.once(events$1.connect,()=>$t(er,cr)),er.once(events$1.close,()=>It(cr)),er.signal(hr)}})}),room(xt=>kt=xt,()=>{delete occupiedRooms$3[e],values(sockets).forEach(xt=>{xt.send(Tt(d)),xt.send(Tt(et))})})});var ds=Object.defineProperty,Hg=Object.getOwnPropertyDescriptor,Vg=Object.getOwnPropertyNames,zg=Object.prototype.hasOwnProperty,be=(i,e)=>()=>(i&&(e=i(i=0)),e),M=(i,e)=>()=>(e||i((e={exports:{}}).exports,e),e.exports),Qt=(i,e)=>{for(var a in e)ds(i,a,{get:e[a],enumerable:!0})},Kg=(i,e,a,c)=>{if(e&&typeof e=="object"||typeof e=="function")for(let h of Vg(e))!zg.call(i,h)&&h!==a&&ds(i,h,{get:()=>e[h],enumerable:!(c=Hg(e,h))||c.enumerable});return i},Z=i=>Kg(ds({},"__esModule",{value:!0}),i),B,_=be(()=>{B={deviceMemory:8,hardwareConcurrency:8,language:"en-US"}}),P={};Qt(P,{_debugEnd:()=>gu,_debugProcess:()=>pu,_events:()=>Ou,_eventsCount:()=>ku,_exiting:()=>Ql,_fatalExceptions:()=>fu,_getActiveHandles:()=>Zl,_getActiveRequests:()=>Xl,_kill:()=>tu,_linkedBinding:()=>Kl,_maxListeners:()=>Pu,_preload_modules:()=>Ru,_rawDebug:()=>Vl,_startProfilerIdleNotifier:()=>yu,_stopProfilerIdleNotifier:()=>bu,_tickCallback:()=>du,abort:()=>vu,addListener:()=>xu,allowedNodeEnvironmentFlags:()=>au,arch:()=>kl,argv:()=>Ll,argv0:()=>Tu,assert:()=>lu,binding:()=>jl,chdir:()=>$l,config:()=>Yl,cpuUsage:()=>Fi,cwd:()=>Wl,debugPort:()=>Iu,default:()=>Wu,dlopen:()=>Jl,domain:()=>Gl,emit:()=>qu,emitWarning:()=>Dl,env:()=>Ml,execArgv:()=>Ul,execPath:()=>Au,exit:()=>su,features:()=>uu,hasUncaughtExceptionCaptureCallback:()=>hu,hrtime:()=>ji,kill:()=>nu,listeners:()=>Fu,memoryUsage:()=>iu,moduleLoadList:()=>zl,nextTick:()=>Bl,off:()=>Lu,on:()=>bt,once:()=>Mu,openStdin:()=>ou,pid:()=>Eu,platform:()=>xl,ppid:()=>Su,prependListener:()=>Du,prependOnceListener:()=>ju,reallyExit:()=>eu,release:()=>Hl,removeAllListeners:()=>Nu,removeListener:()=>Uu,resourceUsage:()=>ru,setSourceMapsEnabled:()=>Cu,setUncaughtExceptionCaptureCallback:()=>cu,stderr:()=>_u,stdin:()=>mu,stdout:()=>wu,title:()=>Ol,umask:()=>Fl,uptime:()=>Bu,version:()=>Nl,versions:()=>ql});function ys(i){throw new Error("Node.js process "+i+" is not supported by JSPM core outside of Node.js")}function Gg(){!kr||!Yt||(kr=!1,Yt.length?yt=Yt.concat(yt):Di=-1,yt.length&&Cl())}function Cl(){if(!kr){var i=setTimeout(Gg,0);kr=!0;for(var e=yt.length;e;){for(Yt=yt,yt=[];++Di<e;)Yt&&Yt[Di].run();Di=-1,e=yt.length}Yt=null,kr=!1,clearTimeout(i)}}function Bl(i){var e=new Array(arguments.length-1);if(arguments.length>1)for(var a=1;a<arguments.length;a++)e[a-1]=arguments[a];yt.push(new Pl(i,e)),yt.length===1&&!kr&&setTimeout(Cl,0)}function Pl(i,e){this.fun=i,this.array=e}function me(){}function Kl(i){ys("_linkedBinding")}function Jl(i){ys("dlopen")}function Xl(){return[]}function Zl(){return[]}function lu(i,e){if(!i)throw new Error(e||"assertion error")}function hu(){return!1}function Bu(){return Mt.now()/1e3}function ji(i){var e=Math.floor((Date.now()-Mt.now())*.001),a=Mt.now()*.001,c=Math.floor(a)+e,h=Math.floor(a%1*1e9);return i&&(c=c-i[0],h=h-i[1],h<0&&(c--,h+=gs)),[c,h]}function bt(){return Wu}function Fu(i){return[]}var yt,kr,Yt,Di,Ol,kl,xl,Ml,Ll,Ul,Nl,ql,Dl,jl,Fl,Wl,$l,Hl,Vl,zl,Gl,Ql,Yl,eu,tu,Fi,ru,iu,nu,su,ou,au,uu,fu,cu,du,pu,gu,yu,bu,wu,_u,mu,vu,Eu,Su,Au,Iu,Tu,Ru,Cu,Mt,ps,gs,Pu,Ou,ku,xu,Mu,Lu,Uu,Nu,qu,Du,ju,Wu,$u=be(()=>{v(),m(),_(),yt=[],kr=!1,Di=-1,Pl.prototype.run=function(){this.fun.apply(null,this.array)},Ol="browser",kl="x64",xl="browser",Ml={PATH:"/usr/bin",LANG:B.language+".UTF-8",PWD:"/",HOME:"/home",TMP:"/tmp"},Ll=["/usr/bin/node"],Ul=[],Nl="v16.8.0",ql={},Dl=function(i,e){console.warn((e?e+": ":"")+i)},jl=function(i){ys("binding")},Fl=function(i){return 0},Wl=function(){return"/"},$l=function(i){},Hl={name:"node",sourceUrl:"",headersUrl:"",libUrl:""},Vl=me,zl=[],Gl={},Ql=!1,Yl={},eu=me,tu=me,Fi=function(){return{}},ru=Fi,iu=Fi,nu=me,su=me,ou=me,au={},uu={inspector:!1,debug:!1,uv:!1,ipv6:!1,tls_alpn:!1,tls_sni:!1,tls_ocsp:!1,tls:!1,cached_builtins:!0},fu=me,cu=me,du=me,pu=me,gu=me,yu=me,bu=me,wu=void 0,_u=void 0,mu=void 0,vu=me,Eu=2,Su=1,Au="/bin/usr/node",Iu=9229,Tu="node",Ru=[],Cu=me,Mt={now:typeof performance<"u"?performance.now.bind(performance):void 0,timing:typeof performance<"u"?performance.timing:void 0},Mt.now===void 0&&(ps=Date.now(),Mt.timing&&Mt.timing.navigationStart&&(ps=Mt.timing.navigationStart),Mt.now=()=>Date.now()-ps),gs=1e9,ji.bigint=function(i){var e=ji(i);return typeof BigInt>"u"?e[0]*gs+e[1]:BigInt(e[0]*gs)+BigInt(e[1])},Pu=10,Ou={},ku=0,xu=bt,Mu=bt,Lu=bt,Uu=bt,Nu=bt,qu=me,Du=bt,ju=bt,Wu={version:Nl,versions:ql,arch:kl,platform:xl,release:Hl,_rawDebug:Vl,moduleLoadList:zl,binding:jl,_linkedBinding:Kl,_events:Ou,_eventsCount:ku,_maxListeners:Pu,on:bt,addListener:xu,once:Mu,off:Lu,removeListener:Uu,removeAllListeners:Nu,emit:qu,prependListener:Du,prependOnceListener:ju,listeners:Fu,domain:Gl,_exiting:Ql,config:Yl,dlopen:Jl,uptime:Bu,_getActiveRequests:Xl,_getActiveHandles:Zl,reallyExit:eu,_kill:tu,cpuUsage:Fi,resourceUsage:ru,memoryUsage:iu,kill:nu,exit:su,openStdin:ou,allowedNodeEnvironmentFlags:au,assert:lu,features:uu,_fatalExceptions:fu,setUncaughtExceptionCaptureCallback:cu,hasUncaughtExceptionCaptureCallback:hu,emitWarning:Dl,nextTick:Bl,_tickCallback:du,_debugProcess:pu,_debugEnd:gu,_startProfilerIdleNotifier:yu,_stopProfilerIdleNotifier:bu,stdout:wu,stdin:mu,stderr:_u,abort:vu,umask:Fl,chdir:$l,cwd:Wl,env:Ml,title:Ol,argv:Ll,execArgv:Ul,pid:Eu,ppid:Su,execPath:Au,debugPort:Iu,hrtime:ji,argv0:Tu,_preload_modules:Ru,setSourceMapsEnabled:Cu}}),m=be(()=>{$u()}),ve={};Qt(ve,{Buffer:()=>k,INSPECT_MAX_BYTES:()=>Xg,default:()=>Lt,kMaxLength:()=>Zg});function Qg(){if(Hu)return li;Hu=!0,li.byteLength=ft,li.toByteArray=_t,li.fromByteArray=It;for(var i=[],e=[],a=typeof Uint8Array<"u"?Uint8Array:Array,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",h=0,d=c.length;h<d;++h)i[h]=c[h],e[c.charCodeAt(h)]=h;e[45]=62,e[95]=63;function et(Rt){var Tt=Rt.length;if(Tt%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var At=Rt.indexOf("=");At===-1&&(At=Tt);var kt=At===Tt?0:4-At%4;return[At,kt]}function ft(Rt){var Tt=et(Rt),At=Tt[0],kt=Tt[1];return(At+kt)*3/4-kt}function gt(Rt,Tt,At){return(Tt+At)*3/4-At}function _t(Rt){var Tt,At=et(Rt),kt=At[0],xt=At[1],Nt=new a(gt(Rt,kt,xt)),Ft=0,jt=xt>0?kt-4:kt,Gt;for(Gt=0;Gt<jt;Gt+=4)Tt=e[Rt.charCodeAt(Gt)]<<18|e[Rt.charCodeAt(Gt+1)]<<12|e[Rt.charCodeAt(Gt+2)]<<6|e[Rt.charCodeAt(Gt+3)],Nt[Ft++]=Tt>>16&255,Nt[Ft++]=Tt>>8&255,Nt[Ft++]=Tt&255;return xt===2&&(Tt=e[Rt.charCodeAt(Gt)]<<2|e[Rt.charCodeAt(Gt+1)]>>4,Nt[Ft++]=Tt&255),xt===1&&(Tt=e[Rt.charCodeAt(Gt)]<<10|e[Rt.charCodeAt(Gt+1)]<<4|e[Rt.charCodeAt(Gt+2)]>>2,Nt[Ft++]=Tt>>8&255,Nt[Ft++]=Tt&255),Nt}function wt(Rt){return i[Rt>>18&63]+i[Rt>>12&63]+i[Rt>>6&63]+i[Rt&63]}function $t(Rt,Tt,At){for(var kt,xt=[],Nt=Tt;Nt<At;Nt+=3)kt=(Rt[Nt]<<16&16711680)+(Rt[Nt+1]<<8&65280)+(Rt[Nt+2]&255),xt.push(wt(kt));return xt.join("")}function It(Rt){for(var Tt,At=Rt.length,kt=At%3,xt=[],Nt=16383,Ft=0,jt=At-kt;Ft<jt;Ft+=Nt)xt.push($t(Rt,Ft,Ft+Nt>jt?jt:Ft+Nt));return kt===1?(Tt=Rt[At-1],xt.push(i[Tt>>2]+i[Tt<<4&63]+"==")):kt===2&&(Tt=(Rt[At-2]<<8)+Rt[At-1],xt.push(i[Tt>>10]+i[Tt>>4&63]+i[Tt<<2&63]+"=")),xt.join("")}return li}function Yg(){return Vu?Wi:(Vu=!0,Wi.read=function(i,e,a,c,h){var d,et,ft=h*8-c-1,gt=(1<<ft)-1,_t=gt>>1,wt=-7,$t=a?h-1:0,It=a?-1:1,Rt=i[e+$t];for($t+=It,d=Rt&(1<<-wt)-1,Rt>>=-wt,wt+=ft;wt>0;d=d*256+i[e+$t],$t+=It,wt-=8);for(et=d&(1<<-wt)-1,d>>=-wt,wt+=c;wt>0;et=et*256+i[e+$t],$t+=It,wt-=8);if(d===0)d=1-_t;else{if(d===gt)return et?NaN:(Rt?-1:1)*(1/0);et=et+Math.pow(2,c),d=d-_t}return(Rt?-1:1)*et*Math.pow(2,d-c)},Wi.write=function(i,e,a,c,h,d){var et,ft,gt,_t=d*8-h-1,wt=(1<<_t)-1,$t=wt>>1,It=h===23?Math.pow(2,-24)-Math.pow(2,-77):0,Rt=c?0:d-1,Tt=c?1:-1,At=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(ft=isNaN(e)?1:0,et=wt):(et=Math.floor(Math.log(e)/Math.LN2),e*(gt=Math.pow(2,-et))<1&&(et--,gt*=2),et+$t>=1?e+=It/gt:e+=It*Math.pow(2,1-$t),e*gt>=2&&(et++,gt/=2),et+$t>=wt?(ft=0,et=wt):et+$t>=1?(ft=(e*gt-1)*Math.pow(2,h),et=et+$t):(ft=e*Math.pow(2,$t-1)*Math.pow(2,h),et=0));h>=8;i[a+Rt]=ft&255,Rt+=Tt,ft/=256,h-=8);for(et=et<<h|ft,_t+=h;_t>0;i[a+Rt]=et&255,Rt+=Tt,et/=256,_t-=8);i[a+Rt-Tt]|=At*128},Wi)}function Jg(){if(zu)return Jt;zu=!0;let i=Qg(),e=Yg(),a=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;Jt.Buffer=et,Jt.SlowBuffer=xt,Jt.INSPECT_MAX_BYTES=50;let c=2147483647;Jt.kMaxLength=c,et.TYPED_ARRAY_SUPPORT=h(),!et.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function h(){try{let Ht=new Uint8Array(1),Vt={foo:function(){return 42}};return Object.setPrototypeOf(Vt,Uint8Array.prototype),Object.setPrototypeOf(Ht,Vt),Ht.foo()===42}catch{return!1}}Object.defineProperty(et.prototype,"parent",{enumerable:!0,get:function(){if(et.isBuffer(this))return this.buffer}}),Object.defineProperty(et.prototype,"offset",{enumerable:!0,get:function(){if(et.isBuffer(this))return this.byteOffset}});function d(Ht){if(Ht>c)throw new RangeError('The value "'+Ht+'" is invalid for option "size"');let Vt=new Uint8Array(Ht);return Object.setPrototypeOf(Vt,et.prototype),Vt}function et(Ht,Vt,Xt){if(typeof Ht=="number"){if(typeof Vt=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return wt(Ht)}return ft(Ht,Vt,Xt)}et.poolSize=8192;function ft(Ht,Vt,Xt){if(typeof Ht=="string")return $t(Ht,Vt);if(ArrayBuffer.isView(Ht))return Rt(Ht);if(Ht==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof Ht);if(Xr(Ht,ArrayBuffer)||Ht&&Xr(Ht.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(Xr(Ht,SharedArrayBuffer)||Ht&&Xr(Ht.buffer,SharedArrayBuffer)))return Tt(Ht,Vt,Xt);if(typeof Ht=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');let Er=Ht.valueOf&&Ht.valueOf();if(Er!=null&&Er!==Ht)return et.from(Er,Vt,Xt);let Sr=At(Ht);if(Sr)return Sr;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof Ht[Symbol.toPrimitive]=="function")return et.from(Ht[Symbol.toPrimitive]("string"),Vt,Xt);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof Ht)}et.from=function(Ht,Vt,Xt){return ft(Ht,Vt,Xt)},Object.setPrototypeOf(et.prototype,Uint8Array.prototype),Object.setPrototypeOf(et,Uint8Array);function gt(Ht){if(typeof Ht!="number")throw new TypeError('"size" argument must be of type number');if(Ht<0)throw new RangeError('The value "'+Ht+'" is invalid for option "size"')}function _t(Ht,Vt,Xt){return gt(Ht),Ht<=0?d(Ht):Vt!==void 0?typeof Xt=="string"?d(Ht).fill(Vt,Xt):d(Ht).fill(Vt):d(Ht)}et.alloc=function(Ht,Vt,Xt){return _t(Ht,Vt,Xt)};function wt(Ht){return gt(Ht),d(Ht<0?0:kt(Ht)|0)}et.allocUnsafe=function(Ht){return wt(Ht)},et.allocUnsafeSlow=function(Ht){return wt(Ht)};function $t(Ht,Vt){if((typeof Vt!="string"||Vt==="")&&(Vt="utf8"),!et.isEncoding(Vt))throw new TypeError("Unknown encoding: "+Vt);let Xt=Nt(Ht,Vt)|0,Er=d(Xt),Sr=Er.write(Ht,Vt);return Sr!==Xt&&(Er=Er.slice(0,Sr)),Er}function It(Ht){let Vt=Ht.length<0?0:kt(Ht.length)|0,Xt=d(Vt);for(let Er=0;Er<Vt;Er+=1)Xt[Er]=Ht[Er]&255;return Xt}function Rt(Ht){if(Xr(Ht,Uint8Array)){let Vt=new Uint8Array(Ht);return Tt(Vt.buffer,Vt.byteOffset,Vt.byteLength)}return It(Ht)}function Tt(Ht,Vt,Xt){if(Vt<0||Ht.byteLength<Vt)throw new RangeError('"offset" is outside of buffer bounds');if(Ht.byteLength<Vt+(Xt||0))throw new RangeError('"length" is outside of buffer bounds');let Er;return Vt===void 0&&Xt===void 0?Er=new Uint8Array(Ht):Xt===void 0?Er=new Uint8Array(Ht,Vt):Er=new Uint8Array(Ht,Vt,Xt),Object.setPrototypeOf(Er,et.prototype),Er}function At(Ht){if(et.isBuffer(Ht)){let Vt=kt(Ht.length)|0,Xt=d(Vt);return Xt.length===0||Ht.copy(Xt,0,0,Vt),Xt}if(Ht.length!==void 0)return typeof Ht.length!="number"||hn(Ht.length)?d(0):It(Ht);if(Ht.type==="Buffer"&&Array.isArray(Ht.data))return It(Ht.data)}function kt(Ht){if(Ht>=c)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+c.toString(16)+" bytes");return Ht|0}function xt(Ht){return+Ht!=Ht&&(Ht=0),et.alloc(+Ht)}et.isBuffer=function(Ht){return Ht!=null&&Ht._isBuffer===!0&&Ht!==et.prototype},et.compare=function(Ht,Vt){if(Xr(Ht,Uint8Array)&&(Ht=et.from(Ht,Ht.offset,Ht.byteLength)),Xr(Vt,Uint8Array)&&(Vt=et.from(Vt,Vt.offset,Vt.byteLength)),!et.isBuffer(Ht)||!et.isBuffer(Vt))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(Ht===Vt)return 0;let Xt=Ht.length,Er=Vt.length;for(let Sr=0,pr=Math.min(Xt,Er);Sr<pr;++Sr)if(Ht[Sr]!==Vt[Sr]){Xt=Ht[Sr],Er=Vt[Sr];break}return Xt<Er?-1:Er<Xt?1:0},et.isEncoding=function(Ht){switch(String(Ht).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},et.concat=function(Ht,Vt){if(!Array.isArray(Ht))throw new TypeError('"list" argument must be an Array of Buffers');if(Ht.length===0)return et.alloc(0);let Xt;if(Vt===void 0)for(Vt=0,Xt=0;Xt<Ht.length;++Xt)Vt+=Ht[Xt].length;let Er=et.allocUnsafe(Vt),Sr=0;for(Xt=0;Xt<Ht.length;++Xt){let pr=Ht[Xt];if(Xr(pr,Uint8Array))Sr+pr.length>Er.length?(et.isBuffer(pr)||(pr=et.from(pr)),pr.copy(Er,Sr)):Uint8Array.prototype.set.call(Er,pr,Sr);else if(et.isBuffer(pr))pr.copy(Er,Sr);else throw new TypeError('"list" argument must be an Array of Buffers');Sr+=pr.length}return Er};function Nt(Ht,Vt){if(et.isBuffer(Ht))return Ht.length;if(ArrayBuffer.isView(Ht)||Xr(Ht,ArrayBuffer))return Ht.byteLength;if(typeof Ht!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof Ht);let Xt=Ht.length,Er=arguments.length>2&&arguments[2]===!0;if(!Er&&Xt===0)return 0;let Sr=!1;for(;;)switch(Vt){case"ascii":case"latin1":case"binary":return Xt;case"utf8":case"utf-8":return Nr(Ht).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Xt*2;case"hex":return Xt>>>1;case"base64":return Wr(Ht).length;default:if(Sr)return Er?-1:Nr(Ht).length;Vt=(""+Vt).toLowerCase(),Sr=!0}}et.byteLength=Nt;function Ft(Ht,Vt,Xt){let Er=!1;if((Vt===void 0||Vt<0)&&(Vt=0),Vt>this.length||((Xt===void 0||Xt>this.length)&&(Xt=this.length),Xt<=0)||(Xt>>>=0,Vt>>>=0,Xt<=Vt))return"";for(Ht||(Ht="utf8");;)switch(Ht){case"hex":return fr(this,Vt,Xt);case"utf8":case"utf-8":return mr(this,Vt,Xt);case"ascii":return Dr(this,Vt,Xt);case"latin1":case"binary":return Tr(this,Vt,Xt);case"base64":return er(this,Vt,Xt);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return yr(this,Vt,Xt);default:if(Er)throw new TypeError("Unknown encoding: "+Ht);Ht=(Ht+"").toLowerCase(),Er=!0}}et.prototype._isBuffer=!0;function jt(Ht,Vt,Xt){let Er=Ht[Vt];Ht[Vt]=Ht[Xt],Ht[Xt]=Er}et.prototype.swap16=function(){let Ht=this.length;if(Ht%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let Vt=0;Vt<Ht;Vt+=2)jt(this,Vt,Vt+1);return this},et.prototype.swap32=function(){let Ht=this.length;if(Ht%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let Vt=0;Vt<Ht;Vt+=4)jt(this,Vt,Vt+3),jt(this,Vt+1,Vt+2);return this},et.prototype.swap64=function(){let Ht=this.length;if(Ht%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let Vt=0;Vt<Ht;Vt+=8)jt(this,Vt,Vt+7),jt(this,Vt+1,Vt+6),jt(this,Vt+2,Vt+5),jt(this,Vt+3,Vt+4);return this},et.prototype.toString=function(){let Ht=this.length;return Ht===0?"":arguments.length===0?mr(this,0,Ht):Ft.apply(this,arguments)},et.prototype.toLocaleString=et.prototype.toString,et.prototype.equals=function(Ht){if(!et.isBuffer(Ht))throw new TypeError("Argument must be a Buffer");return this===Ht?!0:et.compare(this,Ht)===0},et.prototype.inspect=function(){let Ht="",Vt=Jt.INSPECT_MAX_BYTES;return Ht=this.toString("hex",0,Vt).replace(/(.{2})/g,"$1 ").trim(),this.length>Vt&&(Ht+=" ... "),"<Buffer "+Ht+">"},a&&(et.prototype[a]=et.prototype.inspect),et.prototype.compare=function(Ht,Vt,Xt,Er,Sr){if(Xr(Ht,Uint8Array)&&(Ht=et.from(Ht,Ht.offset,Ht.byteLength)),!et.isBuffer(Ht))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof Ht);if(Vt===void 0&&(Vt=0),Xt===void 0&&(Xt=Ht?Ht.length:0),Er===void 0&&(Er=0),Sr===void 0&&(Sr=this.length),Vt<0||Xt>Ht.length||Er<0||Sr>this.length)throw new RangeError("out of range index");if(Er>=Sr&&Vt>=Xt)return 0;if(Er>=Sr)return-1;if(Vt>=Xt)return 1;if(Vt>>>=0,Xt>>>=0,Er>>>=0,Sr>>>=0,this===Ht)return 0;let pr=Sr-Er,Rr=Xt-Vt,Qr=Math.min(pr,Rr),nn=this.slice(Er,Sr),rn=Ht.slice(Vt,Xt);for(let fn=0;fn<Qr;++fn)if(nn[fn]!==rn[fn]){pr=nn[fn],Rr=rn[fn];break}return pr<Rr?-1:Rr<pr?1:0};function Gt(Ht,Vt,Xt,Er,Sr){if(Ht.length===0)return-1;if(typeof Xt=="string"?(Er=Xt,Xt=0):Xt>2147483647?Xt=2147483647:Xt<-2147483648&&(Xt=-2147483648),Xt=+Xt,hn(Xt)&&(Xt=Sr?0:Ht.length-1),Xt<0&&(Xt=Ht.length+Xt),Xt>=Ht.length){if(Sr)return-1;Xt=Ht.length-1}else if(Xt<0)if(Sr)Xt=0;else return-1;if(typeof Vt=="string"&&(Vt=et.from(Vt,Er)),et.isBuffer(Vt))return Vt.length===0?-1:Kt(Ht,Vt,Xt,Er,Sr);if(typeof Vt=="number")return Vt=Vt&255,typeof Uint8Array.prototype.indexOf=="function"?Sr?Uint8Array.prototype.indexOf.call(Ht,Vt,Xt):Uint8Array.prototype.lastIndexOf.call(Ht,Vt,Xt):Kt(Ht,[Vt],Xt,Er,Sr);throw new TypeError("val must be string, number or Buffer")}function Kt(Ht,Vt,Xt,Er,Sr){let pr=1,Rr=Ht.length,Qr=Vt.length;if(Er!==void 0&&(Er=String(Er).toLowerCase(),Er==="ucs2"||Er==="ucs-2"||Er==="utf16le"||Er==="utf-16le")){if(Ht.length<2||Vt.length<2)return-1;pr=2,Rr/=2,Qr/=2,Xt/=2}function nn(fn,bn){return pr===1?fn[bn]:fn.readUInt16BE(bn*pr)}let rn;if(Sr){let fn=-1;for(rn=Xt;rn<Rr;rn++)if(nn(Ht,rn)===nn(Vt,fn===-1?0:rn-fn)){if(fn===-1&&(fn=rn),rn-fn+1===Qr)return fn*pr}else fn!==-1&&(rn-=rn-fn),fn=-1}else for(Xt+Qr>Rr&&(Xt=Rr-Qr),rn=Xt;rn>=0;rn--){let fn=!0;for(let bn=0;bn<Qr;bn++)if(nn(Ht,rn+bn)!==nn(Vt,bn)){fn=!1;break}if(fn)return rn}return-1}et.prototype.includes=function(Ht,Vt,Xt){return this.indexOf(Ht,Vt,Xt)!==-1},et.prototype.indexOf=function(Ht,Vt,Xt){return Gt(this,Ht,Vt,Xt,!0)},et.prototype.lastIndexOf=function(Ht,Vt,Xt){return Gt(this,Ht,Vt,Xt,!1)};function Wt(Ht,Vt,Xt,Er){Xt=Number(Xt)||0;let Sr=Ht.length-Xt;Er?(Er=Number(Er),Er>Sr&&(Er=Sr)):Er=Sr;let pr=Vt.length;Er>pr/2&&(Er=pr/2);let Rr;for(Rr=0;Rr<Er;++Rr){let Qr=parseInt(Vt.substr(Rr*2,2),16);if(hn(Qr))return Rr;Ht[Xt+Rr]=Qr}return Rr}function Zt(Ht,Vt,Xt,Er){return Or(Nr(Vt,Ht.length-Xt),Ht,Xt,Er)}function cr(Ht,Vt,Xt,Er){return Or(Pr(Vt),Ht,Xt,Er)}function hr(Ht,Vt,Xt,Er){return Or(Wr(Vt),Ht,Xt,Er)}function gr(Ht,Vt,Xt,Er){return Or(en(Vt,Ht.length-Xt),Ht,Xt,Er)}et.prototype.write=function(Ht,Vt,Xt,Er){if(Vt===void 0)Er="utf8",Xt=this.length,Vt=0;else if(Xt===void 0&&typeof Vt=="string")Er=Vt,Xt=this.length,Vt=0;else if(isFinite(Vt))Vt=Vt>>>0,isFinite(Xt)?(Xt=Xt>>>0,Er===void 0&&(Er="utf8")):(Er=Xt,Xt=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");let Sr=this.length-Vt;if((Xt===void 0||Xt>Sr)&&(Xt=Sr),Ht.length>0&&(Xt<0||Vt<0)||Vt>this.length)throw new RangeError("Attempt to write outside buffer bounds");Er||(Er="utf8");let pr=!1;for(;;)switch(Er){case"hex":return Wt(this,Ht,Vt,Xt);case"utf8":case"utf-8":return Zt(this,Ht,Vt,Xt);case"ascii":case"latin1":case"binary":return cr(this,Ht,Vt,Xt);case"base64":return hr(this,Ht,Vt,Xt);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return gr(this,Ht,Vt,Xt);default:if(pr)throw new TypeError("Unknown encoding: "+Er);Er=(""+Er).toLowerCase(),pr=!0}},et.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function er(Ht,Vt,Xt){return Vt===0&&Xt===Ht.length?i.fromByteArray(Ht):i.fromByteArray(Ht.slice(Vt,Xt))}function mr(Ht,Vt,Xt){Xt=Math.min(Ht.length,Xt);let Er=[],Sr=Vt;for(;Sr<Xt;){let pr=Ht[Sr],Rr=null,Qr=pr>239?4:pr>223?3:pr>191?2:1;if(Sr+Qr<=Xt){let nn,rn,fn,bn;switch(Qr){case 1:pr<128&&(Rr=pr);break;case 2:nn=Ht[Sr+1],(nn&192)===128&&(bn=(pr&31)<<6|nn&63,bn>127&&(Rr=bn));break;case 3:nn=Ht[Sr+1],rn=Ht[Sr+2],(nn&192)===128&&(rn&192)===128&&(bn=(pr&15)<<12|(nn&63)<<6|rn&63,bn>2047&&(bn<55296||bn>57343)&&(Rr=bn));break;case 4:nn=Ht[Sr+1],rn=Ht[Sr+2],fn=Ht[Sr+3],(nn&192)===128&&(rn&192)===128&&(fn&192)===128&&(bn=(pr&15)<<18|(nn&63)<<12|(rn&63)<<6|fn&63,bn>65535&&bn<1114112&&(Rr=bn))}}Rr===null?(Rr=65533,Qr=1):Rr>65535&&(Rr-=65536,Er.push(Rr>>>10&1023|55296),Rr=56320|Rr&1023),Er.push(Rr),Sr+=Qr}return wr(Er)}let Mr=4096;function wr(Ht){let Vt=Ht.length;if(Vt<=Mr)return String.fromCharCode.apply(String,Ht);let Xt="",Er=0;for(;Er<Vt;)Xt+=String.fromCharCode.apply(String,Ht.slice(Er,Er+=Mr));return Xt}function Dr(Ht,Vt,Xt){let Er="";Xt=Math.min(Ht.length,Xt);for(let Sr=Vt;Sr<Xt;++Sr)Er+=String.fromCharCode(Ht[Sr]&127);return Er}function Tr(Ht,Vt,Xt){let Er="";Xt=Math.min(Ht.length,Xt);for(let Sr=Vt;Sr<Xt;++Sr)Er+=String.fromCharCode(Ht[Sr]);return Er}function fr(Ht,Vt,Xt){let Er=Ht.length;(!Vt||Vt<0)&&(Vt=0),(!Xt||Xt<0||Xt>Er)&&(Xt=Er);let Sr="";for(let pr=Vt;pr<Xt;++pr)Sr+=pn[Ht[pr]];return Sr}function yr(Ht,Vt,Xt){let Er=Ht.slice(Vt,Xt),Sr="";for(let pr=0;pr<Er.length-1;pr+=2)Sr+=String.fromCharCode(Er[pr]+Er[pr+1]*256);return Sr}et.prototype.slice=function(Ht,Vt){let Xt=this.length;Ht=~~Ht,Vt=Vt===void 0?Xt:~~Vt,Ht<0?(Ht+=Xt,Ht<0&&(Ht=0)):Ht>Xt&&(Ht=Xt),Vt<0?(Vt+=Xt,Vt<0&&(Vt=0)):Vt>Xt&&(Vt=Xt),Vt<Ht&&(Vt=Ht);let Er=this.subarray(Ht,Vt);return Object.setPrototypeOf(Er,et.prototype),Er};function $r(Ht,Vt,Xt){if(Ht%1!==0||Ht<0)throw new RangeError("offset is not uint");if(Ht+Vt>Xt)throw new RangeError("Trying to access beyond buffer length")}et.prototype.readUintLE=et.prototype.readUIntLE=function(Ht,Vt,Xt){Ht=Ht>>>0,Vt=Vt>>>0,Xt||$r(Ht,Vt,this.length);let Er=this[Ht],Sr=1,pr=0;for(;++pr<Vt&&(Sr*=256);)Er+=this[Ht+pr]*Sr;return Er},et.prototype.readUintBE=et.prototype.readUIntBE=function(Ht,Vt,Xt){Ht=Ht>>>0,Vt=Vt>>>0,Xt||$r(Ht,Vt,this.length);let Er=this[Ht+--Vt],Sr=1;for(;Vt>0&&(Sr*=256);)Er+=this[Ht+--Vt]*Sr;return Er},et.prototype.readUint8=et.prototype.readUInt8=function(Ht,Vt){return Ht=Ht>>>0,Vt||$r(Ht,1,this.length),this[Ht]},et.prototype.readUint16LE=et.prototype.readUInt16LE=function(Ht,Vt){return Ht=Ht>>>0,Vt||$r(Ht,2,this.length),this[Ht]|this[Ht+1]<<8},et.prototype.readUint16BE=et.prototype.readUInt16BE=function(Ht,Vt){return Ht=Ht>>>0,Vt||$r(Ht,2,this.length),this[Ht]<<8|this[Ht+1]},et.prototype.readUint32LE=et.prototype.readUInt32LE=function(Ht,Vt){return Ht=Ht>>>0,Vt||$r(Ht,4,this.length),(this[Ht]|this[Ht+1]<<8|this[Ht+2]<<16)+this[Ht+3]*16777216},et.prototype.readUint32BE=et.prototype.readUInt32BE=function(Ht,Vt){return Ht=Ht>>>0,Vt||$r(Ht,4,this.length),this[Ht]*16777216+(this[Ht+1]<<16|this[Ht+2]<<8|this[Ht+3])},et.prototype.readBigUInt64LE=vn(function(Ht){Ht=Ht>>>0,xr(Ht,"offset");let Vt=this[Ht],Xt=this[Ht+7];(Vt===void 0||Xt===void 0)&&Kr(Ht,this.length-8);let Er=Vt+this[++Ht]*2**8+this[++Ht]*2**16+this[++Ht]*2**24,Sr=this[++Ht]+this[++Ht]*2**8+this[++Ht]*2**16+Xt*2**24;return BigInt(Er)+(BigInt(Sr)<<BigInt(32))}),et.prototype.readBigUInt64BE=vn(function(Ht){Ht=Ht>>>0,xr(Ht,"offset");let Vt=this[Ht],Xt=this[Ht+7];(Vt===void 0||Xt===void 0)&&Kr(Ht,this.length-8);let Er=Vt*2**24+this[++Ht]*2**16+this[++Ht]*2**8+this[++Ht],Sr=this[++Ht]*2**24+this[++Ht]*2**16+this[++Ht]*2**8+Xt;return(BigInt(Er)<<BigInt(32))+BigInt(Sr)}),et.prototype.readIntLE=function(Ht,Vt,Xt){Ht=Ht>>>0,Vt=Vt>>>0,Xt||$r(Ht,Vt,this.length);let Er=this[Ht],Sr=1,pr=0;for(;++pr<Vt&&(Sr*=256);)Er+=this[Ht+pr]*Sr;return Sr*=128,Er>=Sr&&(Er-=Math.pow(2,8*Vt)),Er},et.prototype.readIntBE=function(Ht,Vt,Xt){Ht=Ht>>>0,Vt=Vt>>>0,Xt||$r(Ht,Vt,this.length);let Er=Vt,Sr=1,pr=this[Ht+--Er];for(;Er>0&&(Sr*=256);)pr+=this[Ht+--Er]*Sr;return Sr*=128,pr>=Sr&&(pr-=Math.pow(2,8*Vt)),pr},et.prototype.readInt8=function(Ht,Vt){return Ht=Ht>>>0,Vt||$r(Ht,1,this.length),this[Ht]&128?(255-this[Ht]+1)*-1:this[Ht]},et.prototype.readInt16LE=function(Ht,Vt){Ht=Ht>>>0,Vt||$r(Ht,2,this.length);let Xt=this[Ht]|this[Ht+1]<<8;return Xt&32768?Xt|4294901760:Xt},et.prototype.readInt16BE=function(Ht,Vt){Ht=Ht>>>0,Vt||$r(Ht,2,this.length);let Xt=this[Ht+1]|this[Ht]<<8;return Xt&32768?Xt|4294901760:Xt},et.prototype.readInt32LE=function(Ht,Vt){return Ht=Ht>>>0,Vt||$r(Ht,4,this.length),this[Ht]|this[Ht+1]<<8|this[Ht+2]<<16|this[Ht+3]<<24},et.prototype.readInt32BE=function(Ht,Vt){return Ht=Ht>>>0,Vt||$r(Ht,4,this.length),this[Ht]<<24|this[Ht+1]<<16|this[Ht+2]<<8|this[Ht+3]},et.prototype.readBigInt64LE=vn(function(Ht){Ht=Ht>>>0,xr(Ht,"offset");let Vt=this[Ht],Xt=this[Ht+7];(Vt===void 0||Xt===void 0)&&Kr(Ht,this.length-8);let Er=this[Ht+4]+this[Ht+5]*2**8+this[Ht+6]*2**16+(Xt<<24);return(BigInt(Er)<<BigInt(32))+BigInt(Vt+this[++Ht]*2**8+this[++Ht]*2**16+this[++Ht]*2**24)}),et.prototype.readBigInt64BE=vn(function(Ht){Ht=Ht>>>0,xr(Ht,"offset");let Vt=this[Ht],Xt=this[Ht+7];(Vt===void 0||Xt===void 0)&&Kr(Ht,this.length-8);let Er=(Vt<<24)+this[++Ht]*2**16+this[++Ht]*2**8+this[++Ht];return(BigInt(Er)<<BigInt(32))+BigInt(this[++Ht]*2**24+this[++Ht]*2**16+this[++Ht]*2**8+Xt)}),et.prototype.readFloatLE=function(Ht,Vt){return Ht=Ht>>>0,Vt||$r(Ht,4,this.length),e.read(this,Ht,!0,23,4)},et.prototype.readFloatBE=function(Ht,Vt){return Ht=Ht>>>0,Vt||$r(Ht,4,this.length),e.read(this,Ht,!1,23,4)},et.prototype.readDoubleLE=function(Ht,Vt){return Ht=Ht>>>0,Vt||$r(Ht,8,this.length),e.read(this,Ht,!0,52,8)},et.prototype.readDoubleBE=function(Ht,Vt){return Ht=Ht>>>0,Vt||$r(Ht,8,this.length),e.read(this,Ht,!1,52,8)};function Fr(Ht,Vt,Xt,Er,Sr,pr){if(!et.isBuffer(Ht))throw new TypeError('"buffer" argument must be a Buffer instance');if(Vt>Sr||Vt<pr)throw new RangeError('"value" argument is out of bounds');if(Xt+Er>Ht.length)throw new RangeError("Index out of range")}et.prototype.writeUintLE=et.prototype.writeUIntLE=function(Ht,Vt,Xt,Er){if(Ht=+Ht,Vt=Vt>>>0,Xt=Xt>>>0,!Er){let Rr=Math.pow(2,8*Xt)-1;Fr(this,Ht,Vt,Xt,Rr,0)}let Sr=1,pr=0;for(this[Vt]=Ht&255;++pr<Xt&&(Sr*=256);)this[Vt+pr]=Ht/Sr&255;return Vt+Xt},et.prototype.writeUintBE=et.prototype.writeUIntBE=function(Ht,Vt,Xt,Er){if(Ht=+Ht,Vt=Vt>>>0,Xt=Xt>>>0,!Er){let Rr=Math.pow(2,8*Xt)-1;Fr(this,Ht,Vt,Xt,Rr,0)}let Sr=Xt-1,pr=1;for(this[Vt+Sr]=Ht&255;--Sr>=0&&(pr*=256);)this[Vt+Sr]=Ht/pr&255;return Vt+Xt},et.prototype.writeUint8=et.prototype.writeUInt8=function(Ht,Vt,Xt){return Ht=+Ht,Vt=Vt>>>0,Xt||Fr(this,Ht,Vt,1,255,0),this[Vt]=Ht&255,Vt+1},et.prototype.writeUint16LE=et.prototype.writeUInt16LE=function(Ht,Vt,Xt){return Ht=+Ht,Vt=Vt>>>0,Xt||Fr(this,Ht,Vt,2,65535,0),this[Vt]=Ht&255,this[Vt+1]=Ht>>>8,Vt+2},et.prototype.writeUint16BE=et.prototype.writeUInt16BE=function(Ht,Vt,Xt){return Ht=+Ht,Vt=Vt>>>0,Xt||Fr(this,Ht,Vt,2,65535,0),this[Vt]=Ht>>>8,this[Vt+1]=Ht&255,Vt+2},et.prototype.writeUint32LE=et.prototype.writeUInt32LE=function(Ht,Vt,Xt){return Ht=+Ht,Vt=Vt>>>0,Xt||Fr(this,Ht,Vt,4,4294967295,0),this[Vt+3]=Ht>>>24,this[Vt+2]=Ht>>>16,this[Vt+1]=Ht>>>8,this[Vt]=Ht&255,Vt+4},et.prototype.writeUint32BE=et.prototype.writeUInt32BE=function(Ht,Vt,Xt){return Ht=+Ht,Vt=Vt>>>0,Xt||Fr(this,Ht,Vt,4,4294967295,0),this[Vt]=Ht>>>24,this[Vt+1]=Ht>>>16,this[Vt+2]=Ht>>>8,this[Vt+3]=Ht&255,Vt+4};function dr(Ht,Vt,Xt,Er,Sr){Cr(Vt,Er,Sr,Ht,Xt,7);let pr=Number(Vt&BigInt(4294967295));Ht[Xt++]=pr,pr=pr>>8,Ht[Xt++]=pr,pr=pr>>8,Ht[Xt++]=pr,pr=pr>>8,Ht[Xt++]=pr;let Rr=Number(Vt>>BigInt(32)&BigInt(4294967295));return Ht[Xt++]=Rr,Rr=Rr>>8,Ht[Xt++]=Rr,Rr=Rr>>8,Ht[Xt++]=Rr,Rr=Rr>>8,Ht[Xt++]=Rr,Xt}function Br(Ht,Vt,Xt,Er,Sr){Cr(Vt,Er,Sr,Ht,Xt,7);let pr=Number(Vt&BigInt(4294967295));Ht[Xt+7]=pr,pr=pr>>8,Ht[Xt+6]=pr,pr=pr>>8,Ht[Xt+5]=pr,pr=pr>>8,Ht[Xt+4]=pr;let Rr=Number(Vt>>BigInt(32)&BigInt(4294967295));return Ht[Xt+3]=Rr,Rr=Rr>>8,Ht[Xt+2]=Rr,Rr=Rr>>8,Ht[Xt+1]=Rr,Rr=Rr>>8,Ht[Xt]=Rr,Xt+8}et.prototype.writeBigUInt64LE=vn(function(Ht,Vt=0){return dr(this,Ht,Vt,BigInt(0),BigInt("0xffffffffffffffff"))}),et.prototype.writeBigUInt64BE=vn(function(Ht,Vt=0){return Br(this,Ht,Vt,BigInt(0),BigInt("0xffffffffffffffff"))}),et.prototype.writeIntLE=function(Ht,Vt,Xt,Er){if(Ht=+Ht,Vt=Vt>>>0,!Er){let Qr=Math.pow(2,8*Xt-1);Fr(this,Ht,Vt,Xt,Qr-1,-Qr)}let Sr=0,pr=1,Rr=0;for(this[Vt]=Ht&255;++Sr<Xt&&(pr*=256);)Ht<0&&Rr===0&&this[Vt+Sr-1]!==0&&(Rr=1),this[Vt+Sr]=(Ht/pr>>0)-Rr&255;return Vt+Xt},et.prototype.writeIntBE=function(Ht,Vt,Xt,Er){if(Ht=+Ht,Vt=Vt>>>0,!Er){let Qr=Math.pow(2,8*Xt-1);Fr(this,Ht,Vt,Xt,Qr-1,-Qr)}let Sr=Xt-1,pr=1,Rr=0;for(this[Vt+Sr]=Ht&255;--Sr>=0&&(pr*=256);)Ht<0&&Rr===0&&this[Vt+Sr+1]!==0&&(Rr=1),this[Vt+Sr]=(Ht/pr>>0)-Rr&255;return Vt+Xt},et.prototype.writeInt8=function(Ht,Vt,Xt){return Ht=+Ht,Vt=Vt>>>0,Xt||Fr(this,Ht,Vt,1,127,-128),Ht<0&&(Ht=255+Ht+1),this[Vt]=Ht&255,Vt+1},et.prototype.writeInt16LE=function(Ht,Vt,Xt){return Ht=+Ht,Vt=Vt>>>0,Xt||Fr(this,Ht,Vt,2,32767,-32768),this[Vt]=Ht&255,this[Vt+1]=Ht>>>8,Vt+2},et.prototype.writeInt16BE=function(Ht,Vt,Xt){return Ht=+Ht,Vt=Vt>>>0,Xt||Fr(this,Ht,Vt,2,32767,-32768),this[Vt]=Ht>>>8,this[Vt+1]=Ht&255,Vt+2},et.prototype.writeInt32LE=function(Ht,Vt,Xt){return Ht=+Ht,Vt=Vt>>>0,Xt||Fr(this,Ht,Vt,4,2147483647,-2147483648),this[Vt]=Ht&255,this[Vt+1]=Ht>>>8,this[Vt+2]=Ht>>>16,this[Vt+3]=Ht>>>24,Vt+4},et.prototype.writeInt32BE=function(Ht,Vt,Xt){return Ht=+Ht,Vt=Vt>>>0,Xt||Fr(this,Ht,Vt,4,2147483647,-2147483648),Ht<0&&(Ht=4294967295+Ht+1),this[Vt]=Ht>>>24,this[Vt+1]=Ht>>>16,this[Vt+2]=Ht>>>8,this[Vt+3]=Ht&255,Vt+4},et.prototype.writeBigInt64LE=vn(function(Ht,Vt=0){return dr(this,Ht,Vt,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),et.prototype.writeBigInt64BE=vn(function(Ht,Vt=0){return Br(this,Ht,Vt,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Hr(Ht,Vt,Xt,Er,Sr,pr){if(Xt+Er>Ht.length)throw new RangeError("Index out of range");if(Xt<0)throw new RangeError("Index out of range")}function Jr(Ht,Vt,Xt,Er,Sr){return Vt=+Vt,Xt=Xt>>>0,Sr||Hr(Ht,Vt,Xt,4),e.write(Ht,Vt,Xt,Er,23,4),Xt+4}et.prototype.writeFloatLE=function(Ht,Vt,Xt){return Jr(this,Ht,Vt,!0,Xt)},et.prototype.writeFloatBE=function(Ht,Vt,Xt){return Jr(this,Ht,Vt,!1,Xt)};function zr(Ht,Vt,Xt,Er,Sr){return Vt=+Vt,Xt=Xt>>>0,Sr||Hr(Ht,Vt,Xt,8),e.write(Ht,Vt,Xt,Er,52,8),Xt+8}et.prototype.writeDoubleLE=function(Ht,Vt,Xt){return zr(this,Ht,Vt,!0,Xt)},et.prototype.writeDoubleBE=function(Ht,Vt,Xt){return zr(this,Ht,Vt,!1,Xt)},et.prototype.copy=function(Ht,Vt,Xt,Er){if(!et.isBuffer(Ht))throw new TypeError("argument should be a Buffer");if(Xt||(Xt=0),!Er&&Er!==0&&(Er=this.length),Vt>=Ht.length&&(Vt=Ht.length),Vt||(Vt=0),Er>0&&Er<Xt&&(Er=Xt),Er===Xt||Ht.length===0||this.length===0)return 0;if(Vt<0)throw new RangeError("targetStart out of bounds");if(Xt<0||Xt>=this.length)throw new RangeError("Index out of range");if(Er<0)throw new RangeError("sourceEnd out of bounds");Er>this.length&&(Er=this.length),Ht.length-Vt<Er-Xt&&(Er=Ht.length-Vt+Xt);let Sr=Er-Xt;return this===Ht&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(Vt,Xt,Er):Uint8Array.prototype.set.call(Ht,this.subarray(Xt,Er),Vt),Sr},et.prototype.fill=function(Ht,Vt,Xt,Er){if(typeof Ht=="string"){if(typeof Vt=="string"?(Er=Vt,Vt=0,Xt=this.length):typeof Xt=="string"&&(Er=Xt,Xt=this.length),Er!==void 0&&typeof Er!="string")throw new TypeError("encoding must be a string");if(typeof Er=="string"&&!et.isEncoding(Er))throw new TypeError("Unknown encoding: "+Er);if(Ht.length===1){let pr=Ht.charCodeAt(0);(Er==="utf8"&&pr<128||Er==="latin1")&&(Ht=pr)}}else typeof Ht=="number"?Ht=Ht&255:typeof Ht=="boolean"&&(Ht=Number(Ht));if(Vt<0||this.length<Vt||this.length<Xt)throw new RangeError("Out of range index");if(Xt<=Vt)return this;Vt=Vt>>>0,Xt=Xt===void 0?this.length:Xt>>>0,Ht||(Ht=0);let Sr;if(typeof Ht=="number")for(Sr=Vt;Sr<Xt;++Sr)this[Sr]=Ht;else{let pr=et.isBuffer(Ht)?Ht:et.from(Ht,Er),Rr=pr.length;if(Rr===0)throw new TypeError('The value "'+Ht+'" is invalid for argument "value"');for(Sr=0;Sr<Xt-Vt;++Sr)this[Sr+Vt]=pr[Sr%Rr]}return this};let br={};function _r(Ht,Vt,Xt){br[Ht]=class extends Xt{constructor(){super(),Object.defineProperty(this,"message",{value:Vt.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${Ht}]`,this.stack,delete this.name}get code(){return Ht}set code(Er){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:Er,writable:!0})}toString(){return`${this.name} [${Ht}]: ${this.message}`}}}_r("ERR_BUFFER_OUT_OF_BOUNDS",function(Ht){return Ht?`${Ht} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),_r("ERR_INVALID_ARG_TYPE",function(Ht,Vt){return`The "${Ht}" argument must be of type number. Received type ${typeof Vt}`},TypeError),_r("ERR_OUT_OF_RANGE",function(Ht,Vt,Xt){let Er=`The value of "${Ht}" is out of range.`,Sr=Xt;return Number.isInteger(Xt)&&Math.abs(Xt)>2**32?Sr=Vr(String(Xt)):typeof Xt=="bigint"&&(Sr=String(Xt),(Xt>BigInt(2)**BigInt(32)||Xt<-(BigInt(2)**BigInt(32)))&&(Sr=Vr(Sr)),Sr+="n"),Er+=` It must be ${Vt}. Received ${Sr}`,Er},RangeError);function Vr(Ht){let Vt="",Xt=Ht.length,Er=Ht[0]==="-"?1:0;for(;Xt>=Er+4;Xt-=3)Vt=`_${Ht.slice(Xt-3,Xt)}${Vt}`;return`${Ht.slice(0,Xt)}${Vt}`}function lr(Ht,Vt,Xt){xr(Vt,"offset"),(Ht[Vt]===void 0||Ht[Vt+Xt]===void 0)&&Kr(Vt,Ht.length-(Xt+1))}function Cr(Ht,Vt,Xt,Er,Sr,pr){if(Ht>Xt||Ht<Vt){let Rr=typeof Vt=="bigint"?"n":"",Qr;throw pr>3?Vt===0||Vt===BigInt(0)?Qr=`>= 0${Rr} and < 2${Rr} ** ${(pr+1)*8}${Rr}`:Qr=`>= -(2${Rr} ** ${(pr+1)*8-1}${Rr}) and < 2 ** ${(pr+1)*8-1}${Rr}`:Qr=`>= ${Vt}${Rr} and <= ${Xt}${Rr}`,new br.ERR_OUT_OF_RANGE("value",Qr,Ht)}lr(Er,Sr,pr)}function xr(Ht,Vt){if(typeof Ht!="number")throw new br.ERR_INVALID_ARG_TYPE(Vt,"number",Ht)}function Kr(Ht,Vt,Xt){throw Math.floor(Ht)!==Ht?(xr(Ht,Xt),new br.ERR_OUT_OF_RANGE(Xt||"offset","an integer",Ht)):Vt<0?new br.ERR_BUFFER_OUT_OF_BOUNDS:new br.ERR_OUT_OF_RANGE(Xt||"offset",`>= ${Xt?1:0} and <= ${Vt}`,Ht)}let Gr=/[^+/0-9A-Za-z-_]/g;function vr(Ht){if(Ht=Ht.split("=")[0],Ht=Ht.trim().replace(Gr,""),Ht.length<2)return"";for(;Ht.length%4!==0;)Ht=Ht+"=";return Ht}function Nr(Ht,Vt){Vt=Vt||1/0;let Xt,Er=Ht.length,Sr=null,pr=[];for(let Rr=0;Rr<Er;++Rr){if(Xt=Ht.charCodeAt(Rr),Xt>55295&&Xt<57344){if(!Sr){if(Xt>56319){(Vt-=3)>-1&&pr.push(239,191,189);continue}else if(Rr+1===Er){(Vt-=3)>-1&&pr.push(239,191,189);continue}Sr=Xt;continue}if(Xt<56320){(Vt-=3)>-1&&pr.push(239,191,189),Sr=Xt;continue}Xt=(Sr-55296<<10|Xt-56320)+65536}else Sr&&(Vt-=3)>-1&&pr.push(239,191,189);if(Sr=null,Xt<128){if((Vt-=1)<0)break;pr.push(Xt)}else if(Xt<2048){if((Vt-=2)<0)break;pr.push(Xt>>6|192,Xt&63|128)}else if(Xt<65536){if((Vt-=3)<0)break;pr.push(Xt>>12|224,Xt>>6&63|128,Xt&63|128)}else if(Xt<1114112){if((Vt-=4)<0)break;pr.push(Xt>>18|240,Xt>>12&63|128,Xt>>6&63|128,Xt&63|128)}else throw new Error("Invalid code point")}return pr}function Pr(Ht){let Vt=[];for(let Xt=0;Xt<Ht.length;++Xt)Vt.push(Ht.charCodeAt(Xt)&255);return Vt}function en(Ht,Vt){let Xt,Er,Sr,pr=[];for(let Rr=0;Rr<Ht.length&&!((Vt-=2)<0);++Rr)Xt=Ht.charCodeAt(Rr),Er=Xt>>8,Sr=Xt%256,pr.push(Sr),pr.push(Er);return pr}function Wr(Ht){return i.toByteArray(vr(Ht))}function Or(Ht,Vt,Xt,Er){let Sr;for(Sr=0;Sr<Er&&!(Sr+Xt>=Vt.length||Sr>=Ht.length);++Sr)Vt[Sr+Xt]=Ht[Sr];return Sr}function Xr(Ht,Vt){return Ht instanceof Vt||Ht!=null&&Ht.constructor!=null&&Ht.constructor.name!=null&&Ht.constructor.name===Vt.name}function hn(Ht){return Ht!==Ht}let pn=function(){let Ht="0123456789abcdef",Vt=new Array(256);for(let Xt=0;Xt<16;++Xt){let Er=Xt*16;for(let Sr=0;Sr<16;++Sr)Vt[Er+Sr]=Ht[Xt]+Ht[Sr]}return Vt}();function vn(Ht){return typeof BigInt>"u"?Tn:Ht}function Tn(){throw new Error("BigInt not supported")}return Jt}var li,Hu,Wi,Vu,Jt,zu,Lt,k,Xg,Zg,we=be(()=>{v(),m(),_(),li={},Hu=!1,Wi={},Vu=!1,Jt={},zu=!1,Lt=Jg(),Lt.Buffer,Lt.SlowBuffer,Lt.INSPECT_MAX_BYTES,Lt.kMaxLength,k=Lt.Buffer,Xg=Lt.INSPECT_MAX_BYTES,Zg=Lt.kMaxLength}),v=be(()=>{we()}),Ku=M(i=>{v(),m(),_(),Object.defineProperty(i,"__esModule",{value:!0});var e=class{constructor(a){this.aliasToTopic={},this.max=a}put(a,c){return c===0||c>this.max?!1:(this.aliasToTopic[c]=a,this.length=Object.keys(this.aliasToTopic).length,!0)}getTopicByAlias(a){return this.aliasToTopic[a]}clear(){this.aliasToTopic={}}};i.default=e}),ce=M((i,e)=>{v(),m(),_(),e.exports={ArrayIsArray(a){return Array.isArray(a)},ArrayPrototypeIncludes(a,c){return a.includes(c)},ArrayPrototypeIndexOf(a,c){return a.indexOf(c)},ArrayPrototypeJoin(a,c){return a.join(c)},ArrayPrototypeMap(a,c){return a.map(c)},ArrayPrototypePop(a,c){return a.pop(c)},ArrayPrototypePush(a,c){return a.push(c)},ArrayPrototypeSlice(a,c,h){return a.slice(c,h)},Error,FunctionPrototypeCall(a,c,...h){return a.call(c,...h)},FunctionPrototypeSymbolHasInstance(a,c){return Function.prototype[Symbol.hasInstance].call(a,c)},MathFloor:Math.floor,Number,NumberIsInteger:Number.isInteger,NumberIsNaN:Number.isNaN,NumberMAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER,NumberMIN_SAFE_INTEGER:Number.MIN_SAFE_INTEGER,NumberParseInt:Number.parseInt,ObjectDefineProperties(a,c){return Object.defineProperties(a,c)},ObjectDefineProperty(a,c,h){return Object.defineProperty(a,c,h)},ObjectGetOwnPropertyDescriptor(a,c){return Object.getOwnPropertyDescriptor(a,c)},ObjectKeys(a){return Object.keys(a)},ObjectSetPrototypeOf(a,c){return Object.setPrototypeOf(a,c)},Promise,PromisePrototypeCatch(a,c){return a.catch(c)},PromisePrototypeThen(a,c,h){return a.then(c,h)},PromiseReject(a){return Promise.reject(a)},ReflectApply:Reflect.apply,RegExpPrototypeTest(a,c){return a.test(c)},SafeSet:Set,String,StringPrototypeSlice(a,c,h){return a.slice(c,h)},StringPrototypeToLowerCase(a){return a.toLowerCase()},StringPrototypeToUpperCase(a){return a.toUpperCase()},StringPrototypeTrim(a){return a.trim()},Symbol,SymbolFor:Symbol.for,SymbolAsyncIterator:Symbol.asyncIterator,SymbolHasInstance:Symbol.hasInstance,SymbolIterator:Symbol.iterator,TypedArrayPrototypeSet(a,c,h){return a.set(c,h)},Uint8Array}}),Je=M((i,e)=>{v(),m(),_();var a=(we(),Z(ve)),c=Object.getPrototypeOf(async function(){}).constructor,h=globalThis.Blob||a.Blob,d=typeof h<"u"?function(ft){return ft instanceof h}:function(ft){return!1},et=class extends Error{constructor(ft){if(!Array.isArray(ft))throw new TypeError(`Expected input to be an Array, got ${typeof ft}`);let gt="";for(let _t=0;_t<ft.length;_t++)gt+=`    ${ft[_t].stack}
`;super(gt),this.name="AggregateError",this.errors=ft}};e.exports={AggregateError:et,kEmptyObject:Object.freeze({}),once(ft){let gt=!1;return function(..._t){gt||(gt=!0,ft.apply(this,_t))}},createDeferredPromise:function(){let ft,gt;return{promise:new Promise((_t,wt)=>{ft=_t,gt=wt}),resolve:ft,reject:gt}},promisify(ft){return new Promise((gt,_t)=>{ft((wt,...$t)=>wt?_t(wt):gt(...$t))})},debuglog(){return function(){}},format(ft,...gt){return ft.replace(/%([sdifj])/g,function(...[_t,wt]){let $t=gt.shift();return wt==="f"?$t.toFixed(6):wt==="j"?JSON.stringify($t):wt==="s"&&typeof $t=="object"?`${$t.constructor!==Object?$t.constructor.name:""} {}`.trim():$t.toString()})},inspect(ft){switch(typeof ft){case"string":if(ft.includes("'"))if(ft.includes('"')){if(!ft.includes("`")&&!ft.includes("${"))return`\`${ft}\``}else return`"${ft}"`;return`'${ft}'`;case"number":return isNaN(ft)?"NaN":Object.is(ft,-0)?String(ft):ft;case"bigint":return`${String(ft)}n`;case"boolean":case"undefined":return String(ft);case"object":return"{}"}},types:{isAsyncFunction(ft){return ft instanceof c},isArrayBufferView(ft){return ArrayBuffer.isView(ft)}},isBlob:d},e.exports.promisify.custom=Symbol.for("nodejs.util.promisify.custom")}),Hi=M((i,e)=>{v(),m(),_();var{AbortController:a,AbortSignal:c}=typeof self<"u"?self:typeof window<"u"?window:void 0;e.exports=a,e.exports.AbortSignal=c,e.exports.default=a}),Se=M((i,e)=>{v(),m(),_();var{format:a,inspect:c,AggregateError:h}=Je(),d=globalThis.AggregateError||h,et=Symbol("kIsNodeError"),ft=["string","function","number","object","Function","Object","boolean","bigint","symbol"],gt=/^([A-Z][a-z0-9]*)+$/,_t="__node_internal_",wt={};function $t(Nt,Ft){if(!Nt)throw new wt.ERR_INTERNAL_ASSERTION(Ft)}function It(Nt){let Ft="",jt=Nt.length,Gt=Nt[0]==="-"?1:0;for(;jt>=Gt+4;jt-=3)Ft=`_${Nt.slice(jt-3,jt)}${Ft}`;return`${Nt.slice(0,jt)}${Ft}`}function Rt(Nt,Ft,jt){if(typeof Ft=="function")return $t(Ft.length<=jt.length,`Code: ${Nt}; The provided arguments length (${jt.length}) does not match the required ones (${Ft.length}).`),Ft(...jt);let Gt=(Ft.match(/%[dfijoOs]/g)||[]).length;return $t(Gt===jt.length,`Code: ${Nt}; The provided arguments length (${jt.length}) does not match the required ones (${Gt}).`),jt.length===0?Ft:a(Ft,...jt)}function Tt(Nt,Ft,jt){jt||(jt=Error);class Gt extends jt{constructor(...Wt){super(Rt(Nt,Ft,Wt))}toString(){return`${this.name} [${Nt}]: ${this.message}`}}Object.defineProperties(Gt.prototype,{name:{value:jt.name,writable:!0,enumerable:!1,configurable:!0},toString:{value(){return`${this.name} [${Nt}]: ${this.message}`},writable:!0,enumerable:!1,configurable:!0}}),Gt.prototype.code=Nt,Gt.prototype[et]=!0,wt[Nt]=Gt}function At(Nt){let Ft=_t+Nt.name;return Object.defineProperty(Nt,"name",{value:Ft}),Nt}function kt(Nt,Ft){if(Nt&&Ft&&Nt!==Ft){if(Array.isArray(Ft.errors))return Ft.errors.push(Nt),Ft;let jt=new d([Ft,Nt],Ft.message);return jt.code=Ft.code,jt}return Nt||Ft}var xt=class extends Error{constructor(Nt="The operation was aborted",Ft=void 0){if(Ft!==void 0&&typeof Ft!="object")throw new wt.ERR_INVALID_ARG_TYPE("options","Object",Ft);super(Nt,Ft),this.code="ABORT_ERR",this.name="AbortError"}};Tt("ERR_ASSERTION","%s",Error),Tt("ERR_INVALID_ARG_TYPE",(Nt,Ft,jt)=>{$t(typeof Nt=="string","'name' must be a string"),Array.isArray(Ft)||(Ft=[Ft]);let Gt="The ";Nt.endsWith(" argument")?Gt+=`${Nt} `:Gt+=`"${Nt}" ${Nt.includes(".")?"property":"argument"} `,Gt+="must be ";let Kt=[],Wt=[],Zt=[];for(let hr of Ft)$t(typeof hr=="string","All expected entries have to be of type string"),ft.includes(hr)?Kt.push(hr.toLowerCase()):gt.test(hr)?Wt.push(hr):($t(hr!=="object",'The value "object" should be written as "Object"'),Zt.push(hr));if(Wt.length>0){let hr=Kt.indexOf("object");hr!==-1&&(Kt.splice(Kt,hr,1),Wt.push("Object"))}if(Kt.length>0){switch(Kt.length){case 1:Gt+=`of type ${Kt[0]}`;break;case 2:Gt+=`one of type ${Kt[0]} or ${Kt[1]}`;break;default:{let hr=Kt.pop();Gt+=`one of type ${Kt.join(", ")}, or ${hr}`}}(Wt.length>0||Zt.length>0)&&(Gt+=" or ")}if(Wt.length>0){switch(Wt.length){case 1:Gt+=`an instance of ${Wt[0]}`;break;case 2:Gt+=`an instance of ${Wt[0]} or ${Wt[1]}`;break;default:{let hr=Wt.pop();Gt+=`an instance of ${Wt.join(", ")}, or ${hr}`}}Zt.length>0&&(Gt+=" or ")}switch(Zt.length){case 0:break;case 1:Zt[0].toLowerCase()!==Zt[0]&&(Gt+="an "),Gt+=`${Zt[0]}`;break;case 2:Gt+=`one of ${Zt[0]} or ${Zt[1]}`;break;default:{let hr=Zt.pop();Gt+=`one of ${Zt.join(", ")}, or ${hr}`}}if(jt==null)Gt+=`. Received ${jt}`;else if(typeof jt=="function"&&jt.name)Gt+=`. Received function ${jt.name}`;else if(typeof jt=="object"){var cr;if((cr=jt.constructor)!==null&&cr!==void 0&&cr.name)Gt+=`. Received an instance of ${jt.constructor.name}`;else{let hr=c(jt,{depth:-1});Gt+=`. Received ${hr}`}}else{let hr=c(jt,{colors:!1});hr.length>25&&(hr=`${hr.slice(0,25)}...`),Gt+=`. Received type ${typeof jt} (${hr})`}return Gt},TypeError),Tt("ERR_INVALID_ARG_VALUE",(Nt,Ft,jt="is invalid")=>{let Gt=c(Ft);return Gt.length>128&&(Gt=Gt.slice(0,128)+"..."),`The ${Nt.includes(".")?"property":"argument"} '${Nt}' ${jt}. Received ${Gt}`},TypeError),Tt("ERR_INVALID_RETURN_VALUE",(Nt,Ft,jt)=>{var Gt;let Kt=jt!=null&&(Gt=jt.constructor)!==null&&Gt!==void 0&&Gt.name?`instance of ${jt.constructor.name}`:`type ${typeof jt}`;return`Expected ${Nt} to be returned from the "${Ft}" function but got ${Kt}.`},TypeError),Tt("ERR_MISSING_ARGS",(...Nt)=>{$t(Nt.length>0,"At least one arg needs to be specified");let Ft,jt=Nt.length;switch(Nt=(Array.isArray(Nt)?Nt:[Nt]).map(Gt=>`"${Gt}"`).join(" or "),jt){case 1:Ft+=`The ${Nt[0]} argument`;break;case 2:Ft+=`The ${Nt[0]} and ${Nt[1]} arguments`;break;default:{let Gt=Nt.pop();Ft+=`The ${Nt.join(", ")}, and ${Gt} arguments`}break}return`${Ft} must be specified`},TypeError),Tt("ERR_OUT_OF_RANGE",(Nt,Ft,jt)=>{$t(Ft,'Missing "range" argument');let Gt;return Number.isInteger(jt)&&Math.abs(jt)>2**32?Gt=It(String(jt)):typeof jt=="bigint"?(Gt=String(jt),(jt>2n**32n||jt<-(2n**32n))&&(Gt=It(Gt)),Gt+="n"):Gt=c(jt),`The value of "${Nt}" is out of range. It must be ${Ft}. Received ${Gt}`},RangeError),Tt("ERR_MULTIPLE_CALLBACK","Callback called multiple times",Error),Tt("ERR_METHOD_NOT_IMPLEMENTED","The %s method is not implemented",Error),Tt("ERR_STREAM_ALREADY_FINISHED","Cannot call %s after a stream was finished",Error),Tt("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable",Error),Tt("ERR_STREAM_DESTROYED","Cannot call %s after a stream was destroyed",Error),Tt("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),Tt("ERR_STREAM_PREMATURE_CLOSE","Premature close",Error),Tt("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF",Error),Tt("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event",Error),Tt("ERR_STREAM_WRITE_AFTER_END","write after end",Error),Tt("ERR_UNKNOWN_ENCODING","Unknown encoding: %s",TypeError),e.exports={AbortError:xt,aggregateTwoErrors:At(kt),hideStackFrames:At,codes:wt}}),ui=M((i,e)=>{v(),m(),_();var{ArrayIsArray:a,ArrayPrototypeIncludes:c,ArrayPrototypeJoin:h,ArrayPrototypeMap:d,NumberIsInteger:et,NumberIsNaN:ft,NumberMAX_SAFE_INTEGER:gt,NumberMIN_SAFE_INTEGER:_t,NumberParseInt:wt,ObjectPrototypeHasOwnProperty:$t,RegExpPrototypeExec:It,String:Rt,StringPrototypeToUpperCase:Tt,StringPrototypeTrim:At}=ce(),{hideStackFrames:kt,codes:{ERR_SOCKET_BAD_PORT:xt,ERR_INVALID_ARG_TYPE:Nt,ERR_INVALID_ARG_VALUE:Ft,ERR_OUT_OF_RANGE:jt,ERR_UNKNOWN_SIGNAL:Gt}}=Se(),{normalizeEncoding:Kt}=Je(),{isAsyncFunction:Wt,isArrayBufferView:Zt}=Je().types,cr={};function hr(Or){return Or===(Or|0)}function gr(Or){return Or===Or>>>0}var er=/^[0-7]+$/,mr="must be a 32-bit unsigned integer or an octal string";function Mr(Or,Xr,hn){if(typeof Or>"u"&&(Or=hn),typeof Or=="string"){if(It(er,Or)===null)throw new Ft(Xr,Or,mr);Or=wt(Or,8)}return Tr(Or,Xr),Or}var wr=kt((Or,Xr,hn=_t,pn=gt)=>{if(typeof Or!="number")throw new Nt(Xr,"number",Or);if(!et(Or))throw new jt(Xr,"an integer",Or);if(Or<hn||Or>pn)throw new jt(Xr,`>= ${hn} && <= ${pn}`,Or)}),Dr=kt((Or,Xr,hn=-2147483648,pn=2147483647)=>{if(typeof Or!="number")throw new Nt(Xr,"number",Or);if(!et(Or))throw new jt(Xr,"an integer",Or);if(Or<hn||Or>pn)throw new jt(Xr,`>= ${hn} && <= ${pn}`,Or)}),Tr=kt((Or,Xr,hn=!1)=>{if(typeof Or!="number")throw new Nt(Xr,"number",Or);if(!et(Or))throw new jt(Xr,"an integer",Or);let pn=hn?1:0,vn=4294967295;if(Or<pn||Or>vn)throw new jt(Xr,`>= ${pn} && <= ${vn}`,Or)});function fr(Or,Xr){if(typeof Or!="string")throw new Nt(Xr,"string",Or)}function yr(Or,Xr,hn=void 0,pn){if(typeof Or!="number")throw new Nt(Xr,"number",Or);if(hn!=null&&Or<hn||pn!=null&&Or>pn||(hn!=null||pn!=null)&&ft(Or))throw new jt(Xr,`${hn!=null?`>= ${hn}`:""}${hn!=null&&pn!=null?" && ":""}${pn!=null?`<= ${pn}`:""}`,Or)}var $r=kt((Or,Xr,hn)=>{if(!c(hn,Or)){let pn="must be one of: "+h(d(hn,vn=>typeof vn=="string"?`'${vn}'`:Rt(vn)),", ");throw new Ft(Xr,Or,pn)}});function Fr(Or,Xr){if(typeof Or!="boolean")throw new Nt(Xr,"boolean",Or)}function dr(Or,Xr,hn){return Or==null||!$t(Or,Xr)?hn:Or[Xr]}var Br=kt((Or,Xr,hn=null)=>{let pn=dr(hn,"allowArray",!1),vn=dr(hn,"allowFunction",!1);if(!dr(hn,"nullable",!1)&&Or===null||!pn&&a(Or)||typeof Or!="object"&&(!vn||typeof Or!="function"))throw new Nt(Xr,"Object",Or)}),Hr=kt((Or,Xr)=>{if(Or!=null&&typeof Or!="object"&&typeof Or!="function")throw new Nt(Xr,"a dictionary",Or)}),Jr=kt((Or,Xr,hn=0)=>{if(!a(Or))throw new Nt(Xr,"Array",Or);if(Or.length<hn){let pn=`must be longer than ${hn}`;throw new Ft(Xr,Or,pn)}});function zr(Or,Xr){Jr(Or,Xr);for(let hn=0;hn<Or.length;hn++)fr(Or[hn],`${Xr}[${hn}]`)}function br(Or,Xr){Jr(Or,Xr);for(let hn=0;hn<Or.length;hn++)Fr(Or[hn],`${Xr}[${hn}]`)}function _r(Or,Xr="signal"){if(fr(Or,Xr),cr[Or]===void 0)throw cr[Tt(Or)]!==void 0?new Gt(Or+" (signals must use all capital letters)"):new Gt(Or)}var Vr=kt((Or,Xr="buffer")=>{if(!Zt(Or))throw new Nt(Xr,["Buffer","TypedArray","DataView"],Or)});function lr(Or,Xr){let hn=Kt(Xr),pn=Or.length;if(hn==="hex"&&pn%2!==0)throw new Ft("encoding",Xr,`is invalid for data of length ${pn}`)}function Cr(Or,Xr="Port",hn=!0){if(typeof Or!="number"&&typeof Or!="string"||typeof Or=="string"&&At(Or).length===0||+Or!==+Or>>>0||Or>65535||Or===0&&!hn)throw new xt(Xr,Or,hn);return Or|0}var xr=kt((Or,Xr)=>{if(Or!==void 0&&(Or===null||typeof Or!="object"||!("aborted"in Or)))throw new Nt(Xr,"AbortSignal",Or)}),Kr=kt((Or,Xr)=>{if(typeof Or!="function")throw new Nt(Xr,"Function",Or)}),Gr=kt((Or,Xr)=>{if(typeof Or!="function"||Wt(Or))throw new Nt(Xr,"Function",Or)}),vr=kt((Or,Xr)=>{if(Or!==void 0)throw new Nt(Xr,"undefined",Or)});function Nr(Or,Xr,hn){if(!c(hn,Or))throw new Nt(Xr,`('${h(hn,"|")}')`,Or)}var Pr=/^(?:<[^>]*>)(?:\s*;\s*[^;"\s]+(?:=(")?[^;"\s]*\1)?)*$/;function en(Or,Xr){if(typeof Or>"u"||!It(Pr,Or))throw new Ft(Xr,Or,'must be an array or string of format "</styles.css>; rel=preload; as=style"')}function Wr(Or){if(typeof Or=="string")return en(Or,"hints"),Or;if(a(Or)){let Xr=Or.length,hn="";if(Xr===0)return hn;for(let pn=0;pn<Xr;pn++){let vn=Or[pn];en(vn,"hints"),hn+=vn,pn!==Xr-1&&(hn+=", ")}return hn}throw new Ft("hints",Or,'must be an array or string of format "</styles.css>; rel=preload; as=style"')}e.exports={isInt32:hr,isUint32:gr,parseFileMode:Mr,validateArray:Jr,validateStringArray:zr,validateBooleanArray:br,validateBoolean:Fr,validateBuffer:Vr,validateDictionary:Hr,validateEncoding:lr,validateFunction:Kr,validateInt32:Dr,validateInteger:wr,validateNumber:yr,validateObject:Br,validateOneOf:$r,validatePlainFunction:Gr,validatePort:Cr,validateSignalName:_r,validateString:fr,validateUint32:Tr,validateUndefined:vr,validateUnion:Nr,validateAbortSignal:xr,validateLinkHeaderValue:Wr}}),Ut=M((i,e)=>{v(),m(),_();var a=e.exports={},c,h;function d(){throw new Error("setTimeout has not been defined")}function et(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?c=setTimeout:c=d}catch{c=d}try{typeof clearTimeout=="function"?h=clearTimeout:h=et}catch{h=et}})();function ft(xt){if(c===setTimeout)return setTimeout(xt,0);if((c===d||!c)&&setTimeout)return c=setTimeout,setTimeout(xt,0);try{return c(xt,0)}catch{try{return c.call(null,xt,0)}catch{return c.call(this,xt,0)}}}function gt(xt){if(h===clearTimeout)return clearTimeout(xt);if((h===et||!h)&&clearTimeout)return h=clearTimeout,clearTimeout(xt);try{return h(xt)}catch{try{return h.call(null,xt)}catch{return h.call(this,xt)}}}var _t=[],wt=!1,$t,It=-1;function Rt(){!wt||!$t||(wt=!1,$t.length?_t=$t.concat(_t):It=-1,_t.length&&Tt())}function Tt(){if(!wt){var xt=ft(Rt);wt=!0;for(var Nt=_t.length;Nt;){for($t=_t,_t=[];++It<Nt;)$t&&$t[It].run();It=-1,Nt=_t.length}$t=null,wt=!1,gt(xt)}}a.nextTick=function(xt){var Nt=new Array(arguments.length-1);if(arguments.length>1)for(var Ft=1;Ft<arguments.length;Ft++)Nt[Ft-1]=arguments[Ft];_t.push(new At(xt,Nt)),_t.length===1&&!wt&&ft(Tt)};function At(xt,Nt){this.fun=xt,this.array=Nt}At.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={};function kt(){}a.on=kt,a.addListener=kt,a.once=kt,a.off=kt,a.removeListener=kt,a.removeAllListeners=kt,a.emit=kt,a.prependListener=kt,a.prependOnceListener=kt,a.listeners=function(xt){return[]},a.binding=function(xt){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(xt){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}}),tt=M((i,e)=>{v(),m(),_();var{Symbol:a,SymbolAsyncIterator:c,SymbolIterator:h,SymbolFor:d}=ce(),et=a("kDestroyed"),ft=a("kIsErrored"),gt=a("kIsReadable"),_t=a("kIsDisturbed"),wt=d("nodejs.webstream.isClosedPromise"),$t=d("nodejs.webstream.controllerErrorFunction");function It(dr,Br=!1){var Hr;return!!(dr&&typeof dr.pipe=="function"&&typeof dr.on=="function"&&(!Br||typeof dr.pause=="function"&&typeof dr.resume=="function")&&(!dr._writableState||((Hr=dr._readableState)===null||Hr===void 0?void 0:Hr.readable)!==!1)&&(!dr._writableState||dr._readableState))}function Rt(dr){var Br;return!!(dr&&typeof dr.write=="function"&&typeof dr.on=="function"&&(!dr._readableState||((Br=dr._writableState)===null||Br===void 0?void 0:Br.writable)!==!1))}function Tt(dr){return!!(dr&&typeof dr.pipe=="function"&&dr._readableState&&typeof dr.on=="function"&&typeof dr.write=="function")}function At(dr){return dr&&(dr._readableState||dr._writableState||typeof dr.write=="function"&&typeof dr.on=="function"||typeof dr.pipe=="function"&&typeof dr.on=="function")}function kt(dr){return!!(dr&&!At(dr)&&typeof dr.pipeThrough=="function"&&typeof dr.getReader=="function"&&typeof dr.cancel=="function")}function xt(dr){return!!(dr&&!At(dr)&&typeof dr.getWriter=="function"&&typeof dr.abort=="function")}function Nt(dr){return!!(dr&&!At(dr)&&typeof dr.readable=="object"&&typeof dr.writable=="object")}function Ft(dr){return kt(dr)||xt(dr)||Nt(dr)}function jt(dr,Br){return dr==null?!1:Br===!0?typeof dr[c]=="function":Br===!1?typeof dr[h]=="function":typeof dr[c]=="function"||typeof dr[h]=="function"}function Gt(dr){if(!At(dr))return null;let Br=dr._writableState,Hr=dr._readableState,Jr=Br||Hr;return!!(dr.destroyed||dr[et]||Jr!=null&&Jr.destroyed)}function Kt(dr){if(!Rt(dr))return null;if(dr.writableEnded===!0)return!0;let Br=dr._writableState;return Br!=null&&Br.errored?!1:typeof(Br==null?void 0:Br.ended)!="boolean"?null:Br.ended}function Wt(dr,Br){if(!Rt(dr))return null;if(dr.writableFinished===!0)return!0;let Hr=dr._writableState;return Hr!=null&&Hr.errored?!1:typeof(Hr==null?void 0:Hr.finished)!="boolean"?null:!!(Hr.finished||Br===!1&&Hr.ended===!0&&Hr.length===0)}function Zt(dr){if(!It(dr))return null;if(dr.readableEnded===!0)return!0;let Br=dr._readableState;return!Br||Br.errored?!1:typeof(Br==null?void 0:Br.ended)!="boolean"?null:Br.ended}function cr(dr,Br){if(!It(dr))return null;let Hr=dr._readableState;return Hr!=null&&Hr.errored?!1:typeof(Hr==null?void 0:Hr.endEmitted)!="boolean"?null:!!(Hr.endEmitted||Br===!1&&Hr.ended===!0&&Hr.length===0)}function hr(dr){return dr&&dr[gt]!=null?dr[gt]:typeof(dr==null?void 0:dr.readable)!="boolean"?null:Gt(dr)?!1:It(dr)&&dr.readable&&!cr(dr)}function gr(dr){return typeof(dr==null?void 0:dr.writable)!="boolean"?null:Gt(dr)?!1:Rt(dr)&&dr.writable&&!Kt(dr)}function er(dr,Br){return At(dr)?Gt(dr)?!0:!((Br==null?void 0:Br.readable)!==!1&&hr(dr)||(Br==null?void 0:Br.writable)!==!1&&gr(dr)):null}function mr(dr){var Br,Hr;return At(dr)?dr.writableErrored?dr.writableErrored:(Br=(Hr=dr._writableState)===null||Hr===void 0?void 0:Hr.errored)!==null&&Br!==void 0?Br:null:null}function Mr(dr){var Br,Hr;return At(dr)?dr.readableErrored?dr.readableErrored:(Br=(Hr=dr._readableState)===null||Hr===void 0?void 0:Hr.errored)!==null&&Br!==void 0?Br:null:null}function wr(dr){if(!At(dr))return null;if(typeof dr.closed=="boolean")return dr.closed;let Br=dr._writableState,Hr=dr._readableState;return typeof(Br==null?void 0:Br.closed)=="boolean"||typeof(Hr==null?void 0:Hr.closed)=="boolean"?(Br==null?void 0:Br.closed)||(Hr==null?void 0:Hr.closed):typeof dr._closed=="boolean"&&Dr(dr)?dr._closed:null}function Dr(dr){return typeof dr._closed=="boolean"&&typeof dr._defaultKeepAlive=="boolean"&&typeof dr._removedConnection=="boolean"&&typeof dr._removedContLen=="boolean"}function Tr(dr){return typeof dr._sent100=="boolean"&&Dr(dr)}function fr(dr){var Br;return typeof dr._consuming=="boolean"&&typeof dr._dumped=="boolean"&&((Br=dr.req)===null||Br===void 0?void 0:Br.upgradeOrConnect)===void 0}function yr(dr){if(!At(dr))return null;let Br=dr._writableState,Hr=dr._readableState,Jr=Br||Hr;return!Jr&&Tr(dr)||!!(Jr&&Jr.autoDestroy&&Jr.emitClose&&Jr.closed===!1)}function $r(dr){var Br;return!!(dr&&((Br=dr[_t])!==null&&Br!==void 0?Br:dr.readableDidRead||dr.readableAborted))}function Fr(dr){var Br,Hr,Jr,zr,br,_r,Vr,lr,Cr,xr;return!!(dr&&((Br=(Hr=(Jr=(zr=(br=(_r=dr[ft])!==null&&_r!==void 0?_r:dr.readableErrored)!==null&&br!==void 0?br:dr.writableErrored)!==null&&zr!==void 0?zr:(Vr=dr._readableState)===null||Vr===void 0?void 0:Vr.errorEmitted)!==null&&Jr!==void 0?Jr:(lr=dr._writableState)===null||lr===void 0?void 0:lr.errorEmitted)!==null&&Hr!==void 0?Hr:(Cr=dr._readableState)===null||Cr===void 0?void 0:Cr.errored)!==null&&Br!==void 0?Br:!((xr=dr._writableState)===null||xr===void 0)&&xr.errored))}e.exports={kDestroyed:et,isDisturbed:$r,kIsDisturbed:_t,isErrored:Fr,kIsErrored:ft,isReadable:hr,kIsReadable:gt,kIsClosedPromise:wt,kControllerErrorFunction:$t,isClosed:wr,isDestroyed:Gt,isDuplexNodeStream:Tt,isFinished:er,isIterable:jt,isReadableNodeStream:It,isReadableStream:kt,isReadableEnded:Zt,isReadableFinished:cr,isReadableErrored:Mr,isNodeStream:At,isWebStream:Ft,isWritable:gr,isWritableNodeStream:Rt,isWritableStream:xt,isWritableEnded:Kt,isWritableFinished:Wt,isWritableErrored:mr,isServerRequest:fr,isServerResponse:Tr,willEmitClose:yr,isTransformStream:Nt}}),mt=M((i,e)=>{v(),m(),_();var a=Ut(),{AbortError:c,codes:h}=Se(),{ERR_INVALID_ARG_TYPE:d,ERR_STREAM_PREMATURE_CLOSE:et}=h,{kEmptyObject:ft,once:gt}=Je(),{validateAbortSignal:_t,validateFunction:wt,validateObject:$t,validateBoolean:It}=ui(),{Promise:Rt,PromisePrototypeThen:Tt}=ce(),{isClosed:At,isReadable:kt,isReadableNodeStream:xt,isReadableStream:Nt,isReadableFinished:Ft,isReadableErrored:jt,isWritable:Gt,isWritableNodeStream:Kt,isWritableStream:Wt,isWritableFinished:Zt,isWritableErrored:cr,isNodeStream:hr,willEmitClose:gr,kIsClosedPromise:er}=tt();function mr(fr){return fr.setHeader&&typeof fr.abort=="function"}var Mr=()=>{};function wr(fr,yr,$r){var Fr,dr;if(arguments.length===2?($r=yr,yr=ft):yr==null?yr=ft:$t(yr,"options"),wt($r,"callback"),_t(yr.signal,"options.signal"),$r=gt($r),Nt(fr)||Wt(fr))return Dr(fr,yr,$r);if(!hr(fr))throw new d("stream",["ReadableStream","WritableStream","Stream"],fr);let Br=(Fr=yr.readable)!==null&&Fr!==void 0?Fr:xt(fr),Hr=(dr=yr.writable)!==null&&dr!==void 0?dr:Kt(fr),Jr=fr._writableState,zr=fr._readableState,br=()=>{fr.writable||lr()},_r=gr(fr)&&xt(fr)===Br&&Kt(fr)===Hr,Vr=Zt(fr,!1),lr=()=>{Vr=!0,fr.destroyed&&(_r=!1),!(_r&&(!fr.readable||Br))&&(!Br||Cr)&&$r.call(fr)},Cr=Ft(fr,!1),xr=()=>{Cr=!0,fr.destroyed&&(_r=!1),!(_r&&(!fr.writable||Hr))&&(!Hr||Vr)&&$r.call(fr)},Kr=Wr=>{$r.call(fr,Wr)},Gr=At(fr),vr=()=>{Gr=!0;let Wr=cr(fr)||jt(fr);if(Wr&&typeof Wr!="boolean")return $r.call(fr,Wr);if(Br&&!Cr&&xt(fr,!0)&&!Ft(fr,!1))return $r.call(fr,new et);if(Hr&&!Vr&&!Zt(fr,!1))return $r.call(fr,new et);$r.call(fr)},Nr=()=>{Gr=!0;let Wr=cr(fr)||jt(fr);if(Wr&&typeof Wr!="boolean")return $r.call(fr,Wr);$r.call(fr)},Pr=()=>{fr.req.on("finish",lr)};mr(fr)?(fr.on("complete",lr),_r||fr.on("abort",vr),fr.req?Pr():fr.on("request",Pr)):Hr&&!Jr&&(fr.on("end",br),fr.on("close",br)),!_r&&typeof fr.aborted=="boolean"&&fr.on("aborted",vr),fr.on("end",xr),fr.on("finish",lr),yr.error!==!1&&fr.on("error",Kr),fr.on("close",vr),Gr?a.nextTick(vr):Jr!=null&&Jr.errorEmitted||zr!=null&&zr.errorEmitted?_r||a.nextTick(Nr):(!Br&&(!_r||kt(fr))&&(Vr||Gt(fr)===!1)||!Hr&&(!_r||Gt(fr))&&(Cr||kt(fr)===!1)||zr&&fr.req&&fr.aborted)&&a.nextTick(Nr);let en=()=>{$r=Mr,fr.removeListener("aborted",vr),fr.removeListener("complete",lr),fr.removeListener("abort",vr),fr.removeListener("request",Pr),fr.req&&fr.req.removeListener("finish",lr),fr.removeListener("end",br),fr.removeListener("close",br),fr.removeListener("finish",lr),fr.removeListener("end",xr),fr.removeListener("error",Kr),fr.removeListener("close",vr)};if(yr.signal&&!Gr){let Wr=()=>{let Or=$r;en(),Or.call(fr,new c(void 0,{cause:yr.signal.reason}))};if(yr.signal.aborted)a.nextTick(Wr);else{let Or=$r;$r=gt((...Xr)=>{yr.signal.removeEventListener("abort",Wr),Or.apply(fr,Xr)}),yr.signal.addEventListener("abort",Wr)}}return en}function Dr(fr,yr,$r){let Fr=!1,dr=Mr;if(yr.signal)if(dr=()=>{Fr=!0,$r.call(fr,new c(void 0,{cause:yr.signal.reason}))},yr.signal.aborted)a.nextTick(dr);else{let Hr=$r;$r=gt((...Jr)=>{yr.signal.removeEventListener("abort",dr),Hr.apply(fr,Jr)}),yr.signal.addEventListener("abort",dr)}let Br=(...Hr)=>{Fr||a.nextTick(()=>$r.apply(fr,Hr))};return Tt(fr[er].promise,Br,Br),Mr}function Tr(fr,yr){var $r;let Fr=!1;return yr===null&&(yr=ft),($r=yr)!==null&&$r!==void 0&&$r.cleanup&&(It(yr.cleanup,"cleanup"),Fr=yr.cleanup),new Rt((dr,Br)=>{let Hr=wr(fr,yr,Jr=>{Fr&&Hr(),Jr?Br(Jr):dr()})})}e.exports=wr,e.exports.finished=Tr}),tr=M((i,e)=>{v(),m(),_();var a=Ut(),{aggregateTwoErrors:c,codes:{ERR_MULTIPLE_CALLBACK:h},AbortError:d}=Se(),{Symbol:et}=ce(),{kDestroyed:ft,isDestroyed:gt,isFinished:_t,isServerRequest:wt}=tt(),$t=et("kDestroy"),It=et("kConstruct");function Rt(er,mr,Mr){er&&(er.stack,mr&&!mr.errored&&(mr.errored=er),Mr&&!Mr.errored&&(Mr.errored=er))}function Tt(er,mr){let Mr=this._readableState,wr=this._writableState,Dr=wr||Mr;return wr!=null&&wr.destroyed||Mr!=null&&Mr.destroyed?(typeof mr=="function"&&mr(),this):(Rt(er,wr,Mr),wr&&(wr.destroyed=!0),Mr&&(Mr.destroyed=!0),Dr.constructed?At(this,er,mr):this.once($t,function(Tr){At(this,c(Tr,er),mr)}),this)}function At(er,mr,Mr){let wr=!1;function Dr(Tr){if(wr)return;wr=!0;let fr=er._readableState,yr=er._writableState;Rt(Tr,yr,fr),yr&&(yr.closed=!0),fr&&(fr.closed=!0),typeof Mr=="function"&&Mr(Tr),Tr?a.nextTick(kt,er,Tr):a.nextTick(xt,er)}try{er._destroy(mr||null,Dr)}catch(Tr){Dr(Tr)}}function kt(er,mr){Nt(er,mr),xt(er)}function xt(er){let mr=er._readableState,Mr=er._writableState;Mr&&(Mr.closeEmitted=!0),mr&&(mr.closeEmitted=!0),(Mr!=null&&Mr.emitClose||mr!=null&&mr.emitClose)&&er.emit("close")}function Nt(er,mr){let Mr=er._readableState,wr=er._writableState;wr!=null&&wr.errorEmitted||Mr!=null&&Mr.errorEmitted||(wr&&(wr.errorEmitted=!0),Mr&&(Mr.errorEmitted=!0),er.emit("error",mr))}function Ft(){let er=this._readableState,mr=this._writableState;er&&(er.constructed=!0,er.closed=!1,er.closeEmitted=!1,er.destroyed=!1,er.errored=null,er.errorEmitted=!1,er.reading=!1,er.ended=er.readable===!1,er.endEmitted=er.readable===!1),mr&&(mr.constructed=!0,mr.destroyed=!1,mr.closed=!1,mr.closeEmitted=!1,mr.errored=null,mr.errorEmitted=!1,mr.finalCalled=!1,mr.prefinished=!1,mr.ended=mr.writable===!1,mr.ending=mr.writable===!1,mr.finished=mr.writable===!1)}function jt(er,mr,Mr){let wr=er._readableState,Dr=er._writableState;if(Dr!=null&&Dr.destroyed||wr!=null&&wr.destroyed)return this;wr!=null&&wr.autoDestroy||Dr!=null&&Dr.autoDestroy?er.destroy(mr):mr&&(mr.stack,Dr&&!Dr.errored&&(Dr.errored=mr),wr&&!wr.errored&&(wr.errored=mr),Mr?a.nextTick(Nt,er,mr):Nt(er,mr))}function Gt(er,mr){if(typeof er._construct!="function")return;let Mr=er._readableState,wr=er._writableState;Mr&&(Mr.constructed=!1),wr&&(wr.constructed=!1),er.once(It,mr),!(er.listenerCount(It)>1)&&a.nextTick(Kt,er)}function Kt(er){let mr=!1;function Mr(wr){if(mr){jt(er,wr??new h);return}mr=!0;let Dr=er._readableState,Tr=er._writableState,fr=Tr||Dr;Dr&&(Dr.constructed=!0),Tr&&(Tr.constructed=!0),fr.destroyed?er.emit($t,wr):wr?jt(er,wr,!0):a.nextTick(Wt,er)}try{er._construct(wr=>{a.nextTick(Mr,wr)})}catch(wr){a.nextTick(Mr,wr)}}function Wt(er){er.emit(It)}function Zt(er){return(er==null?void 0:er.setHeader)&&typeof er.abort=="function"}function cr(er){er.emit("close")}function hr(er,mr){er.emit("error",mr),a.nextTick(cr,er)}function gr(er,mr){!er||gt(er)||(!mr&&!_t(er)&&(mr=new d),wt(er)?(er.socket=null,er.destroy(mr)):Zt(er)?er.abort():Zt(er.req)?er.req.abort():typeof er.destroy=="function"?er.destroy(mr):typeof er.close=="function"?er.close():mr?a.nextTick(hr,er,mr):a.nextTick(cr,er),er.destroyed||(er[ft]=!0))}e.exports={construct:Gt,destroyer:gr,destroy:Tt,undestroy:Ft,errorOrDestroy:jt}});function Y(){Y.init.call(this)}function Xi(i){if(typeof i!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof i)}function ic(i){return i._maxListeners===void 0?Y.defaultMaxListeners:i._maxListeners}function Jf(i,e,a,c){var h,d,et,ft;if(Xi(a),(d=i._events)===void 0?(d=i._events=Object.create(null),i._eventsCount=0):(d.newListener!==void 0&&(i.emit("newListener",e,a.listener?a.listener:a),d=i._events),et=d[e]),et===void 0)et=d[e]=a,++i._eventsCount;else if(typeof et=="function"?et=d[e]=c?[a,et]:[et,a]:c?et.unshift(a):et.push(a),(h=ic(i))>0&&et.length>h&&!et.warned){et.warned=!0;var gt=new Error("Possible EventEmitter memory leak detected. "+et.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");gt.name="MaxListenersExceededWarning",gt.emitter=i,gt.type=e,gt.count=et.length,ft=gt,console&&console.warn&&console.warn(ft)}return i}function Vb(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Xf(i,e,a){var c={fired:!1,wrapFn:void 0,target:i,type:e,listener:a},h=Vb.bind(c);return h.listener=a,c.wrapFn=h,h}function Zf(i,e,a){var c=i._events;if(c===void 0)return[];var h=c[e];return h===void 0?[]:typeof h=="function"?a?[h.listener||h]:[h]:a?function(d){for(var et=new Array(d.length),ft=0;ft<et.length;++ft)et[ft]=d[ft].listener||d[ft];return et}(h):nc(h,h.length)}function ec(i){var e=this._events;if(e!==void 0){var a=e[i];if(typeof a=="function")return 1;if(a!==void 0)return a.length}return 0}function nc(i,e){for(var a=new Array(e),c=0;c<e;++c)a[c]=i[c];return a}var tc,rc,Lr,Gf,Qf,Yf,Be,qs=be(()=>{v(),m(),_(),Lr=typeof Reflect=="object"?Reflect:null,Gf=Lr&&typeof Lr.apply=="function"?Lr.apply:function(i,e,a){return Function.prototype.apply.call(i,e,a)},rc=Lr&&typeof Lr.ownKeys=="function"?Lr.ownKeys:Object.getOwnPropertySymbols?function(i){return Object.getOwnPropertyNames(i).concat(Object.getOwnPropertySymbols(i))}:function(i){return Object.getOwnPropertyNames(i)},Qf=Number.isNaN||function(i){return i!=i},tc=Y,Y.EventEmitter=Y,Y.prototype._events=void 0,Y.prototype._eventsCount=0,Y.prototype._maxListeners=void 0,Yf=10,Object.defineProperty(Y,"defaultMaxListeners",{enumerable:!0,get:function(){return Yf},set:function(i){if(typeof i!="number"||i<0||Qf(i))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+i+".");Yf=i}}),Y.init=function(){this._events!==void 0&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},Y.prototype.setMaxListeners=function(i){if(typeof i!="number"||i<0||Qf(i))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+i+".");return this._maxListeners=i,this},Y.prototype.getMaxListeners=function(){return ic(this)},Y.prototype.emit=function(i){for(var e=[],a=1;a<arguments.length;a++)e.push(arguments[a]);var c=i==="error",h=this._events;if(h!==void 0)c=c&&h.error===void 0;else if(!c)return!1;if(c){var d;if(e.length>0&&(d=e[0]),d instanceof Error)throw d;var et=new Error("Unhandled error."+(d?" ("+d.message+")":""));throw et.context=d,et}var ft=h[i];if(ft===void 0)return!1;if(typeof ft=="function")Gf(ft,this,e);else{var gt=ft.length,_t=nc(ft,gt);for(a=0;a<gt;++a)Gf(_t[a],this,e)}return!0},Y.prototype.addListener=function(i,e){return Jf(this,i,e,!1)},Y.prototype.on=Y.prototype.addListener,Y.prototype.prependListener=function(i,e){return Jf(this,i,e,!0)},Y.prototype.once=function(i,e){return Xi(e),this.on(i,Xf(this,i,e)),this},Y.prototype.prependOnceListener=function(i,e){return Xi(e),this.prependListener(i,Xf(this,i,e)),this},Y.prototype.removeListener=function(i,e){var a,c,h,d,et;if(Xi(e),(c=this._events)===void 0)return this;if((a=c[i])===void 0)return this;if(a===e||a.listener===e)--this._eventsCount==0?this._events=Object.create(null):(delete c[i],c.removeListener&&this.emit("removeListener",i,a.listener||e));else if(typeof a!="function"){for(h=-1,d=a.length-1;d>=0;d--)if(a[d]===e||a[d].listener===e){et=a[d].listener,h=d;break}if(h<0)return this;h===0?a.shift():function(ft,gt){for(;gt+1<ft.length;gt++)ft[gt]=ft[gt+1];ft.pop()}(a,h),a.length===1&&(c[i]=a[0]),c.removeListener!==void 0&&this.emit("removeListener",i,et||e)}return this},Y.prototype.off=Y.prototype.removeListener,Y.prototype.removeAllListeners=function(i){var e,a,c;if((a=this._events)===void 0)return this;if(a.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):a[i]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete a[i]),this;if(arguments.length===0){var h,d=Object.keys(a);for(c=0;c<d.length;++c)(h=d[c])!=="removeListener"&&this.removeAllListeners(h);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(typeof(e=a[i])=="function")this.removeListener(i,e);else if(e!==void 0)for(c=e.length-1;c>=0;c--)this.removeListener(i,e[c]);return this},Y.prototype.listeners=function(i){return Zf(this,i,!0)},Y.prototype.rawListeners=function(i){return Zf(this,i,!1)},Y.listenerCount=function(i,e){return typeof i.listenerCount=="function"?i.listenerCount(e):ec.call(i,e)},Y.prototype.listenerCount=ec,Y.prototype.eventNames=function(){return this._eventsCount>0?rc(this._events):[]},Be=tc,Be.EventEmitter,Be.defaultMaxListeners,Be.init,Be.listenerCount,Be.EventEmitter,Be.defaultMaxListeners,Be.init,Be.listenerCount}),rr$1={};Qt(rr$1,{EventEmitter:()=>zb,default:()=>Be,defaultMaxListeners:()=>Kb,init:()=>Gb,listenerCount:()=>Qb,on:()=>Yb,once:()=>Jb});var zb,Kb,Gb,Qb,Yb,Jb,ir=be(()=>{v(),m(),_(),qs(),qs(),Be.once=function(i,e){return new Promise((a,c)=>{function h(...et){d!==void 0&&i.removeListener("error",d),a(et)}let d;e!=="error"&&(d=et=>{i.removeListener(name,h),c(et)},i.once("error",d)),i.once(e,h)})},Be.on=function(i,e){let a=[],c=[],h=null,d=!1,et={async next(){let _t=a.shift();if(_t)return createIterResult(_t,!1);if(h){let wt=Promise.reject(h);return h=null,wt}return d?createIterResult(void 0,!0):new Promise((wt,$t)=>c.push({resolve:wt,reject:$t}))},async return(){i.removeListener(e,ft),i.removeListener("error",gt),d=!0;for(let _t of c)_t.resolve(createIterResult(void 0,!0));return createIterResult(void 0,!0)},throw(_t){h=_t,i.removeListener(e,ft),i.removeListener("error",gt)},[Symbol.asyncIterator](){return this}};return i.on(e,ft),i.on("error",gt),et;function ft(..._t){let wt=c.shift();wt?wt.resolve(createIterResult(_t,!1)):a.push(_t)}function gt(_t){d=!0;let wt=c.shift();wt?wt.reject(_t):h=_t,et.return()}},{EventEmitter:zb,defaultMaxListeners:Kb,init:Gb,listenerCount:Qb,on:Yb,once:Jb}=Be}),tn=M((i,e)=>{v(),m(),_();var{ArrayIsArray:a,ObjectSetPrototypeOf:c}=ce(),{EventEmitter:h}=(ir(),Z(rr$1));function d(ft){h.call(this,ft)}c(d.prototype,h.prototype),c(d,h),d.prototype.pipe=function(ft,gt){let _t=this;function wt(xt){ft.writable&&ft.write(xt)===!1&&_t.pause&&_t.pause()}_t.on("data",wt);function $t(){_t.readable&&_t.resume&&_t.resume()}ft.on("drain",$t),!ft._isStdio&&(!gt||gt.end!==!1)&&(_t.on("end",Rt),_t.on("close",Tt));let It=!1;function Rt(){It||(It=!0,ft.end())}function Tt(){It||(It=!0,typeof ft.destroy=="function"&&ft.destroy())}function At(xt){kt(),h.listenerCount(this,"error")===0&&this.emit("error",xt)}et(_t,"error",At),et(ft,"error",At);function kt(){_t.removeListener("data",wt),ft.removeListener("drain",$t),_t.removeListener("end",Rt),_t.removeListener("close",Tt),_t.removeListener("error",At),ft.removeListener("error",At),_t.removeListener("end",kt),_t.removeListener("close",kt),ft.removeListener("close",kt)}return _t.on("end",kt),_t.on("close",kt),ft.on("close",kt),ft.emit("pipe",_t),ft};function et(ft,gt,_t){if(typeof ft.prependListener=="function")return ft.prependListener(gt,_t);!ft._events||!ft._events[gt]?ft.on(gt,_t):a(ft._events[gt])?ft._events[gt].unshift(_t):ft._events[gt]=[_t,ft._events[gt]]}e.exports={Stream:d,prependListener:et}}),fi=M((i,e)=>{v(),m(),_();var{AbortError:a,codes:c}=Se(),{isNodeStream:h,isWebStream:d,kControllerErrorFunction:et}=tt(),ft=mt(),{ERR_INVALID_ARG_TYPE:gt}=c,_t=(wt,$t)=>{if(typeof wt!="object"||!("aborted"in wt))throw new gt($t,"AbortSignal",wt)};e.exports.addAbortSignal=function(wt,$t){if(_t(wt,"signal"),!h($t)&&!d($t))throw new gt("stream",["ReadableStream","WritableStream","Stream"],$t);return e.exports.addAbortSignalNoValidate(wt,$t)},e.exports.addAbortSignalNoValidate=function(wt,$t){if(typeof wt!="object"||!("aborted"in wt))return $t;let It=h($t)?()=>{$t.destroy(new a(void 0,{cause:wt.reason}))}:()=>{$t[et](new a(void 0,{cause:wt.reason}))};return wt.aborted?It():(wt.addEventListener("abort",It),ft($t,()=>wt.removeEventListener("abort",It))),$t}}),hc=M((i,e)=>{v(),m(),_();var{StringPrototypeSlice:a,SymbolIterator:c,TypedArrayPrototypeSet:h,Uint8Array:d}=ce(),{Buffer:et}=(we(),Z(ve)),{inspect:ft}=Je();e.exports=class{constructor(){this.head=null,this.tail=null,this.length=0}push(gt){let _t={data:gt,next:null};this.length>0?this.tail.next=_t:this.head=_t,this.tail=_t,++this.length}unshift(gt){let _t={data:gt,next:this.head};this.length===0&&(this.tail=_t),this.head=_t,++this.length}shift(){if(this.length===0)return;let gt=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,gt}clear(){this.head=this.tail=null,this.length=0}join(gt){if(this.length===0)return"";let _t=this.head,wt=""+_t.data;for(;(_t=_t.next)!==null;)wt+=gt+_t.data;return wt}concat(gt){if(this.length===0)return et.alloc(0);let _t=et.allocUnsafe(gt>>>0),wt=this.head,$t=0;for(;wt;)h(_t,wt.data,$t),$t+=wt.data.length,wt=wt.next;return _t}consume(gt,_t){let wt=this.head.data;if(gt<wt.length){let $t=wt.slice(0,gt);return this.head.data=wt.slice(gt),$t}return gt===wt.length?this.shift():_t?this._getString(gt):this._getBuffer(gt)}first(){return this.head.data}*[c](){for(let gt=this.head;gt;gt=gt.next)yield gt.data}_getString(gt){let _t="",wt=this.head,$t=0;do{let It=wt.data;if(gt>It.length)_t+=It,gt-=It.length;else{gt===It.length?(_t+=It,++$t,wt.next?this.head=wt.next:this.head=this.tail=null):(_t+=a(It,0,gt),this.head=wt,wt.data=a(It,gt));break}++$t}while((wt=wt.next)!==null);return this.length-=$t,_t}_getBuffer(gt){let _t=et.allocUnsafe(gt),wt=gt,$t=this.head,It=0;do{let Rt=$t.data;if(gt>Rt.length)h(_t,Rt,wt-gt),gt-=Rt.length;else{gt===Rt.length?(h(_t,Rt,wt-gt),++It,$t.next?this.head=$t.next:this.head=this.tail=null):(h(_t,new d(Rt.buffer,Rt.byteOffset,gt),wt-gt),this.head=$t,$t.data=Rt.slice(gt));break}++It}while(($t=$t.next)!==null);return this.length-=It,_t}[Symbol.for("nodejs.util.inspect.custom")](gt,_t){return ft(this,{..._t,depth:0,customInspect:!1})}}}),sn=M((i,e)=>{v(),m(),_();var{MathFloor:a,NumberIsInteger:c}=ce(),{ERR_INVALID_ARG_VALUE:h}=Se().codes;function d(gt,_t,wt){return gt.highWaterMark!=null?gt.highWaterMark:_t?gt[wt]:null}function et(gt){return gt?16:16*1024}function ft(gt,_t,wt,$t){let It=d(_t,$t,wt);if(It!=null){if(!c(It)||It<0){let Rt=$t?`options.${wt}`:"options.highWaterMark";throw new h(Rt,It)}return a(It)}return et(gt.objectMode)}e.exports={getHighWaterMark:ft,getDefaultHighWaterMark:et}});function bc(i){var e=i.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var a=i.indexOf("=");return a===-1&&(a=e),[a,a===e?0:4-a%4]}function hw(i,e,a){for(var c,h,d=[],et=e;et<a;et+=3)c=(i[et]<<16&16711680)+(i[et+1]<<8&65280)+(255&i[et+2]),d.push($e[(h=c)>>18&63]+$e[h>>12&63]+$e[h>>6&63]+$e[63&h]);return d.join("")}function vt(i){if(i>2147483647)throw new RangeError('The value "'+i+'" is invalid for option "size"');var e=new Uint8Array(i);return Object.setPrototypeOf(e,x.prototype),e}function x(i,e,a){if(typeof i=="number"){if(typeof e=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return Hs(i)}return Rc(i,e,a)}function Rc(i,e,a){if(typeof i=="string")return function(d,et){if(typeof et=="string"&&et!==""||(et="utf8"),!x.isEncoding(et))throw new TypeError("Unknown encoding: "+et);var ft=0|Bc(d,et),gt=vt(ft),_t=gt.write(d,et);return _t!==ft&&(gt=gt.slice(0,_t)),gt}(i,e);if(ArrayBuffer.isView(i))return Fs(i);if(i==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof i);if(Et(i,ArrayBuffer)||i&&Et(i.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(Et(i,SharedArrayBuffer)||i&&Et(i.buffer,SharedArrayBuffer)))return _c(i,e,a);if(typeof i=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var c=i.valueOf&&i.valueOf();if(c!=null&&c!==i)return x.from(c,e,a);var h=function(d){if(x.isBuffer(d)){var et=0|Ks(d.length),ft=vt(et);return ft.length===0||d.copy(ft,0,0,et),ft}if(d.length!==void 0)return typeof d.length!="number"||Gs(d.length)?vt(0):Fs(d);if(d.type==="Buffer"&&Array.isArray(d.data))return Fs(d.data)}(i);if(h)return h;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof i[Symbol.toPrimitive]=="function")return x.from(i[Symbol.toPrimitive]("string"),e,a);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof i)}function Cc(i){if(typeof i!="number")throw new TypeError('"size" argument must be of type number');if(i<0)throw new RangeError('The value "'+i+'" is invalid for option "size"')}function Hs(i){return Cc(i),vt(i<0?0:0|Ks(i))}function Fs(i){for(var e=i.length<0?0:0|Ks(i.length),a=vt(e),c=0;c<e;c+=1)a[c]=255&i[c];return a}function _c(i,e,a){if(e<0||i.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(i.byteLength<e+(a||0))throw new RangeError('"length" is outside of buffer bounds');var c;return c=e===void 0&&a===void 0?new Uint8Array(i):a===void 0?new Uint8Array(i,e):new Uint8Array(i,e,a),Object.setPrototypeOf(c,x.prototype),c}function Ks(i){if(i>=2147483647)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|i}function Bc(i,e){if(x.isBuffer(i))return i.length;if(ArrayBuffer.isView(i)||Et(i,ArrayBuffer))return i.byteLength;if(typeof i!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof i);var a=i.length,c=arguments.length>2&&arguments[2]===!0;if(!c&&a===0)return 0;for(var h=!1;;)switch(e){case"ascii":case"latin1":case"binary":return a;case"utf8":case"utf-8":return Vs(i).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*a;case"hex":return a>>>1;case"base64":return xc(i).length;default:if(h)return c?-1:Vs(i).length;e=(""+e).toLowerCase(),h=!0}}function pw(i,e,a){var c=!1;if((e===void 0||e<0)&&(e=0),e>this.length||((a===void 0||a>this.length)&&(a=this.length),a<=0)||(a>>>=0)<=(e>>>=0))return"";for(i||(i="utf8");;)switch(i){case"hex":return Sw(this,e,a);case"utf8":case"utf-8":return Oc(this,e,a);case"ascii":return vw(this,e,a);case"latin1":case"binary":return Ew(this,e,a);case"base64":return mw(this,e,a);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Aw(this,e,a);default:if(c)throw new TypeError("Unknown encoding: "+i);i=(i+"").toLowerCase(),c=!0}}function sr(i,e,a){var c=i[e];i[e]=i[a],i[a]=c}function mc(i,e,a,c,h){if(i.length===0)return-1;if(typeof a=="string"?(c=a,a=0):a>2147483647?a=2147483647:a<-2147483648&&(a=-2147483648),Gs(a=+a)&&(a=h?0:i.length-1),a<0&&(a=i.length+a),a>=i.length){if(h)return-1;a=i.length-1}else if(a<0){if(!h)return-1;a=0}if(typeof e=="string"&&(e=x.from(e,c)),x.isBuffer(e))return e.length===0?-1:vc(i,e,a,c,h);if(typeof e=="number")return e&=255,typeof Uint8Array.prototype.indexOf=="function"?h?Uint8Array.prototype.indexOf.call(i,e,a):Uint8Array.prototype.lastIndexOf.call(i,e,a):vc(i,[e],a,c,h);throw new TypeError("val must be string, number or Buffer")}function vc(i,e,a,c,h){var d,et=1,ft=i.length,gt=e.length;if(c!==void 0&&((c=String(c).toLowerCase())==="ucs2"||c==="ucs-2"||c==="utf16le"||c==="utf-16le")){if(i.length<2||e.length<2)return-1;et=2,ft/=2,gt/=2,a/=2}function _t(Rt,Tt){return et===1?Rt[Tt]:Rt.readUInt16BE(Tt*et)}if(h){var wt=-1;for(d=a;d<ft;d++)if(_t(i,d)===_t(e,wt===-1?0:d-wt)){if(wt===-1&&(wt=d),d-wt+1===gt)return wt*et}else wt!==-1&&(d-=d-wt),wt=-1}else for(a+gt>ft&&(a=ft-gt),d=a;d>=0;d--){for(var $t=!0,It=0;It<gt;It++)if(_t(i,d+It)!==_t(e,It)){$t=!1;break}if($t)return d}return-1}function gw(i,e,a,c){a=Number(a)||0;var h=i.length-a;c?(c=Number(c))>h&&(c=h):c=h;var d=e.length;c>d/2&&(c=d/2);for(var et=0;et<c;++et){var ft=parseInt(e.substr(2*et,2),16);if(Gs(ft))return et;i[a+et]=ft}return et}function yw(i,e,a,c){return un(Vs(e,i.length-a),i,a,c)}function Pc(i,e,a,c){return un(function(h){for(var d=[],et=0;et<h.length;++et)d.push(255&h.charCodeAt(et));return d}(e),i,a,c)}function bw(i,e,a,c){return Pc(i,e,a,c)}function ww(i,e,a,c){return un(xc(e),i,a,c)}function _w(i,e,a,c){return un(function(h,d){for(var et,ft,gt,_t=[],wt=0;wt<h.length&&!((d-=2)<0);++wt)et=h.charCodeAt(wt),ft=et>>8,gt=et%256,_t.push(gt),_t.push(ft);return _t}(e,i.length-a),i,a,c)}function mw(i,e,a){return e===0&&a===i.length?$s.fromByteArray(i):$s.fromByteArray(i.slice(e,a))}function Oc(i,e,a){a=Math.min(i.length,a);for(var c=[],h=e;h<a;){var d,et,ft,gt,_t=i[h],wt=null,$t=_t>239?4:_t>223?3:_t>191?2:1;if(h+$t<=a)switch($t){case 1:_t<128&&(wt=_t);break;case 2:(192&(d=i[h+1]))==128&&(gt=(31&_t)<<6|63&d)>127&&(wt=gt);break;case 3:d=i[h+1],et=i[h+2],(192&d)==128&&(192&et)==128&&(gt=(15&_t)<<12|(63&d)<<6|63&et)>2047&&(gt<55296||gt>57343)&&(wt=gt);break;case 4:d=i[h+1],et=i[h+2],ft=i[h+3],(192&d)==128&&(192&et)==128&&(192&ft)==128&&(gt=(15&_t)<<18|(63&d)<<12|(63&et)<<6|63&ft)>65535&&gt<1114112&&(wt=gt)}wt===null?(wt=65533,$t=1):wt>65535&&(wt-=65536,c.push(wt>>>10&1023|55296),wt=56320|1023&wt),c.push(wt),h+=$t}return function(It){var Rt=It.length;if(Rt<=4096)return String.fromCharCode.apply(String,It);for(var Tt="",At=0;At<Rt;)Tt+=String.fromCharCode.apply(String,It.slice(At,At+=4096));return Tt}(c)}function vw(i,e,a){var c="";a=Math.min(i.length,a);for(var h=e;h<a;++h)c+=String.fromCharCode(127&i[h]);return c}function Ew(i,e,a){var c="";a=Math.min(i.length,a);for(var h=e;h<a;++h)c+=String.fromCharCode(i[h]);return c}function Sw(i,e,a){var c=i.length;(!e||e<0)&&(e=0),(!a||a<0||a>c)&&(a=c);for(var h="",d=e;d<a;++d)h+=Tw[i[d]];return h}function Aw(i,e,a){for(var c=i.slice(e,a),h="",d=0;d<c.length;d+=2)h+=String.fromCharCode(c[d]+256*c[d+1]);return h}function ye(i,e,a){if(i%1!=0||i<0)throw new RangeError("offset is not uint");if(i+e>a)throw new RangeError("Trying to access beyond buffer length")}function Pe(i,e,a,c,h,d){if(!x.isBuffer(i))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>h||e<d)throw new RangeError('"value" argument is out of bounds');if(a+c>i.length)throw new RangeError("Index out of range")}function kc(i,e,a,c,h,d){if(a+c>i.length)throw new RangeError("Index out of range");if(a<0)throw new RangeError("Index out of range")}function Ec(i,e,a,c,h){return e=+e,a>>>=0,h||kc(i,0,a,4),Ur.write(i,e,a,c,23,4),a+4}function Sc(i,e,a,c,h){return e=+e,a>>>=0,h||kc(i,0,a,8),Ur.write(i,e,a,c,52,8),a+8}function Vs(i,e){var a;e=e||1/0;for(var c=i.length,h=null,d=[],et=0;et<c;++et){if((a=i.charCodeAt(et))>55295&&a<57344){if(!h){if(a>56319){(e-=3)>-1&&d.push(239,191,189);continue}if(et+1===c){(e-=3)>-1&&d.push(239,191,189);continue}h=a;continue}if(a<56320){(e-=3)>-1&&d.push(239,191,189),h=a;continue}a=65536+(h-55296<<10|a-56320)}else h&&(e-=3)>-1&&d.push(239,191,189);if(h=null,a<128){if((e-=1)<0)break;d.push(a)}else if(a<2048){if((e-=2)<0)break;d.push(a>>6|192,63&a|128)}else if(a<65536){if((e-=3)<0)break;d.push(a>>12|224,a>>6&63|128,63&a|128)}else{if(!(a<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;d.push(a>>18|240,a>>12&63|128,a>>6&63|128,63&a|128)}}return d}function xc(i){return $s.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(Iw,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(i))}function un(i,e,a,c){for(var h=0;h<c&&!(h+a>=e.length||h>=i.length);++h)e[h+a]=i[h];return h}function Et(i,e){return i instanceof e||i!=null&&i.constructor!=null&&i.constructor.name!=null&&i.constructor.name===e.name}function Gs(i){return i!=i}function Ac(i,e){for(var a in i)e[a]=i[a]}function or$a(i,e,a){return it(i,e,a)}function ci(i){var e;switch(this.encoding=function(a){var c=function(h){if(!h)return"utf8";for(var d;;)switch(h){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return h;default:if(d)return;h=(""+h).toLowerCase(),d=!0}}(a);if(typeof c!="string"&&(zs.isEncoding===Ic||!Ic(a)))throw new Error("Unknown encoding: "+a);return c||a}(i),this.encoding){case"utf16le":this.text=Bw,this.end=Pw,e=4;break;case"utf8":this.fillLast=Cw,e=4;break;case"base64":this.text=Ow,this.end=kw,e=3;break;default:return this.write=xw,this.end=Mw,void 0}this.lastNeed=0,this.lastTotal=0,this.lastChar=zs.allocUnsafe(e)}function Ws(i){return i<=127?0:i>>5==6?2:i>>4==14?3:i>>3==30?4:i>>6==2?-1:-2}function Cw(i){var e=this.lastTotal-this.lastNeed,a=function(c,h,d){if((192&h[0])!=128)return c.lastNeed=0,"�";if(c.lastNeed>1&&h.length>1){if((192&h[1])!=128)return c.lastNeed=1,"�";if(c.lastNeed>2&&h.length>2&&(192&h[2])!=128)return c.lastNeed=2,"�"}}(this,i);return a!==void 0?a:this.lastNeed<=i.length?(i.copy(this.lastChar,e,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(i.copy(this.lastChar,e,0,i.length),this.lastNeed-=i.length,void 0)}function Bw(i,e){if((i.length-e)%2==0){var a=i.toString("utf16le",e);if(a){var c=a.charCodeAt(a.length-1);if(c>=55296&&c<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=i[i.length-2],this.lastChar[1]=i[i.length-1],a.slice(0,-1)}return a}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=i[i.length-1],i.toString("utf16le",e,i.length-1)}function Pw(i){var e=i&&i.length?this.write(i):"";if(this.lastNeed){var a=this.lastTotal-this.lastNeed;return e+this.lastChar.toString("utf16le",0,a)}return e}function Ow(i,e){var a=(i.length-e)%3;return a===0?i.toString("base64",e):(this.lastNeed=3-a,this.lastTotal=3,a===1?this.lastChar[0]=i[i.length-1]:(this.lastChar[0]=i[i.length-2],this.lastChar[1]=i[i.length-1]),i.toString("base64",e,i.length-a))}function kw(i){var e=i&&i.length?this.write(i):"";return this.lastNeed?e+this.lastChar.toString("base64",0,3-this.lastNeed):e}function xw(i){return i.toString(this.encoding)}function Mw(i){return i&&i.length?this.write(i):""}var Tc,$e,ke,gc,on,nr,yc,dw,St,$s,Ur,wc,Iw,Tw,an,ln,it,Rw,ar,zs,Ic,Qs=be(()=>{for(v(),m(),_(),Tc={byteLength:function(i){var e=bc(i),a=e[0],c=e[1];return 3*(a+c)/4-c},toByteArray:function(i){var e,a,c=bc(i),h=c[0],d=c[1],et=new gc(function(_t,wt,$t){return 3*(wt+$t)/4-$t}(0,h,d)),ft=0,gt=d>0?h-4:h;for(a=0;a<gt;a+=4)e=ke[i.charCodeAt(a)]<<18|ke[i.charCodeAt(a+1)]<<12|ke[i.charCodeAt(a+2)]<<6|ke[i.charCodeAt(a+3)],et[ft++]=e>>16&255,et[ft++]=e>>8&255,et[ft++]=255&e;return d===2&&(e=ke[i.charCodeAt(a)]<<2|ke[i.charCodeAt(a+1)]>>4,et[ft++]=255&e),d===1&&(e=ke[i.charCodeAt(a)]<<10|ke[i.charCodeAt(a+1)]<<4|ke[i.charCodeAt(a+2)]>>2,et[ft++]=e>>8&255,et[ft++]=255&e),et},fromByteArray:function(i){for(var e,a=i.length,c=a%3,h=[],d=0,et=a-c;d<et;d+=16383)h.push(hw(i,d,d+16383>et?et:d+16383));return c===1?(e=i[a-1],h.push($e[e>>2]+$e[e<<4&63]+"==")):c===2&&(e=(i[a-2]<<8)+i[a-1],h.push($e[e>>10]+$e[e>>4&63]+$e[e<<2&63]+"=")),h.join("")}},$e=[],ke=[],gc=typeof Uint8Array<"u"?Uint8Array:Array,on="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",nr=0,yc=on.length;nr<yc;++nr)$e[nr]=on[nr],ke[on.charCodeAt(nr)]=nr;ke[45]=62,ke[95]=63,dw={read:function(i,e,a,c,h){var d,et,ft=8*h-c-1,gt=(1<<ft)-1,_t=gt>>1,wt=-7,$t=a?h-1:0,It=a?-1:1,Rt=i[e+$t];for($t+=It,d=Rt&(1<<-wt)-1,Rt>>=-wt,wt+=ft;wt>0;d=256*d+i[e+$t],$t+=It,wt-=8);for(et=d&(1<<-wt)-1,d>>=-wt,wt+=c;wt>0;et=256*et+i[e+$t],$t+=It,wt-=8);if(d===0)d=1-_t;else{if(d===gt)return et?NaN:1/0*(Rt?-1:1);et+=Math.pow(2,c),d-=_t}return(Rt?-1:1)*et*Math.pow(2,d-c)},write:function(i,e,a,c,h,d){var et,ft,gt,_t=8*d-h-1,wt=(1<<_t)-1,$t=wt>>1,It=h===23?Math.pow(2,-24)-Math.pow(2,-77):0,Rt=c?0:d-1,Tt=c?1:-1,At=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(ft=isNaN(e)?1:0,et=wt):(et=Math.floor(Math.log(e)/Math.LN2),e*(gt=Math.pow(2,-et))<1&&(et--,gt*=2),(e+=et+$t>=1?It/gt:It*Math.pow(2,1-$t))*gt>=2&&(et++,gt/=2),et+$t>=wt?(ft=0,et=wt):et+$t>=1?(ft=(e*gt-1)*Math.pow(2,h),et+=$t):(ft=e*Math.pow(2,$t-1)*Math.pow(2,h),et=0));h>=8;i[a+Rt]=255&ft,Rt+=Tt,ft/=256,h-=8);for(et=et<<h|ft,_t+=h;_t>0;i[a+Rt]=255&et,Rt+=Tt,et/=256,_t-=8);i[a+Rt-Tt]|=128*At}},St={},$s=Tc,Ur=dw,wc=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null,St.Buffer=x,St.SlowBuffer=function(i){return+i!=i&&(i=0),x.alloc(+i)},St.INSPECT_MAX_BYTES=50,St.kMaxLength=2147483647,x.TYPED_ARRAY_SUPPORT=function(){try{var i=new Uint8Array(1),e={foo:function(){return 42}};return Object.setPrototypeOf(e,Uint8Array.prototype),Object.setPrototypeOf(i,e),i.foo()===42}catch{return!1}}(),x.TYPED_ARRAY_SUPPORT||typeof console>"u"||typeof console.error!="function"||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(x.prototype,"parent",{enumerable:!0,get:function(){if(x.isBuffer(this))return this.buffer}}),Object.defineProperty(x.prototype,"offset",{enumerable:!0,get:function(){if(x.isBuffer(this))return this.byteOffset}}),x.poolSize=8192,x.from=function(i,e,a){return Rc(i,e,a)},Object.setPrototypeOf(x.prototype,Uint8Array.prototype),Object.setPrototypeOf(x,Uint8Array),x.alloc=function(i,e,a){return function(c,h,d){return Cc(c),c<=0?vt(c):h!==void 0?typeof d=="string"?vt(c).fill(h,d):vt(c).fill(h):vt(c)}(i,e,a)},x.allocUnsafe=function(i){return Hs(i)},x.allocUnsafeSlow=function(i){return Hs(i)},x.isBuffer=function(i){return i!=null&&i._isBuffer===!0&&i!==x.prototype},x.compare=function(i,e){if(Et(i,Uint8Array)&&(i=x.from(i,i.offset,i.byteLength)),Et(e,Uint8Array)&&(e=x.from(e,e.offset,e.byteLength)),!x.isBuffer(i)||!x.isBuffer(e))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(i===e)return 0;for(var a=i.length,c=e.length,h=0,d=Math.min(a,c);h<d;++h)if(i[h]!==e[h]){a=i[h],c=e[h];break}return a<c?-1:c<a?1:0},x.isEncoding=function(i){switch(String(i).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},x.concat=function(i,e){if(!Array.isArray(i))throw new TypeError('"list" argument must be an Array of Buffers');if(i.length===0)return x.alloc(0);var a;if(e===void 0)for(e=0,a=0;a<i.length;++a)e+=i[a].length;var c=x.allocUnsafe(e),h=0;for(a=0;a<i.length;++a){var d=i[a];if(Et(d,Uint8Array)&&(d=x.from(d)),!x.isBuffer(d))throw new TypeError('"list" argument must be an Array of Buffers');d.copy(c,h),h+=d.length}return c},x.byteLength=Bc,x.prototype._isBuffer=!0,x.prototype.swap16=function(){var i=this.length;if(i%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<i;e+=2)sr(this,e,e+1);return this},x.prototype.swap32=function(){var i=this.length;if(i%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<i;e+=4)sr(this,e,e+3),sr(this,e+1,e+2);return this},x.prototype.swap64=function(){var i=this.length;if(i%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<i;e+=8)sr(this,e,e+7),sr(this,e+1,e+6),sr(this,e+2,e+5),sr(this,e+3,e+4);return this},x.prototype.toString=function(){var i=this.length;return i===0?"":arguments.length===0?Oc(this,0,i):pw.apply(this,arguments)},x.prototype.toLocaleString=x.prototype.toString,x.prototype.equals=function(i){if(!x.isBuffer(i))throw new TypeError("Argument must be a Buffer");return this===i||x.compare(this,i)===0},x.prototype.inspect=function(){var i="",e=St.INSPECT_MAX_BYTES;return i=this.toString("hex",0,e).replace(/(.{2})/g,"$1 ").trim(),this.length>e&&(i+=" ... "),"<Buffer "+i+">"},wc&&(x.prototype[wc]=x.prototype.inspect),x.prototype.compare=function(i,e,a,c,h){if(Et(i,Uint8Array)&&(i=x.from(i,i.offset,i.byteLength)),!x.isBuffer(i))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof i);if(e===void 0&&(e=0),a===void 0&&(a=i?i.length:0),c===void 0&&(c=0),h===void 0&&(h=this.length),e<0||a>i.length||c<0||h>this.length)throw new RangeError("out of range index");if(c>=h&&e>=a)return 0;if(c>=h)return-1;if(e>=a)return 1;if(this===i)return 0;for(var d=(h>>>=0)-(c>>>=0),et=(a>>>=0)-(e>>>=0),ft=Math.min(d,et),gt=this.slice(c,h),_t=i.slice(e,a),wt=0;wt<ft;++wt)if(gt[wt]!==_t[wt]){d=gt[wt],et=_t[wt];break}return d<et?-1:et<d?1:0},x.prototype.includes=function(i,e,a){return this.indexOf(i,e,a)!==-1},x.prototype.indexOf=function(i,e,a){return mc(this,i,e,a,!0)},x.prototype.lastIndexOf=function(i,e,a){return mc(this,i,e,a,!1)},x.prototype.write=function(i,e,a,c){if(e===void 0)c="utf8",a=this.length,e=0;else if(a===void 0&&typeof e=="string")c=e,a=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e>>>=0,isFinite(a)?(a>>>=0,c===void 0&&(c="utf8")):(c=a,a=void 0)}var h=this.length-e;if((a===void 0||a>h)&&(a=h),i.length>0&&(a<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");c||(c="utf8");for(var d=!1;;)switch(c){case"hex":return gw(this,i,e,a);case"utf8":case"utf-8":return yw(this,i,e,a);case"ascii":return Pc(this,i,e,a);case"latin1":case"binary":return bw(this,i,e,a);case"base64":return ww(this,i,e,a);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return _w(this,i,e,a);default:if(d)throw new TypeError("Unknown encoding: "+c);c=(""+c).toLowerCase(),d=!0}},x.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},x.prototype.slice=function(i,e){var a=this.length;(i=~~i)<0?(i+=a)<0&&(i=0):i>a&&(i=a),(e=e===void 0?a:~~e)<0?(e+=a)<0&&(e=0):e>a&&(e=a),e<i&&(e=i);var c=this.subarray(i,e);return Object.setPrototypeOf(c,x.prototype),c},x.prototype.readUIntLE=function(i,e,a){i>>>=0,e>>>=0,a||ye(i,e,this.length);for(var c=this[i],h=1,d=0;++d<e&&(h*=256);)c+=this[i+d]*h;return c},x.prototype.readUIntBE=function(i,e,a){i>>>=0,e>>>=0,a||ye(i,e,this.length);for(var c=this[i+--e],h=1;e>0&&(h*=256);)c+=this[i+--e]*h;return c},x.prototype.readUInt8=function(i,e){return i>>>=0,e||ye(i,1,this.length),this[i]},x.prototype.readUInt16LE=function(i,e){return i>>>=0,e||ye(i,2,this.length),this[i]|this[i+1]<<8},x.prototype.readUInt16BE=function(i,e){return i>>>=0,e||ye(i,2,this.length),this[i]<<8|this[i+1]},x.prototype.readUInt32LE=function(i,e){return i>>>=0,e||ye(i,4,this.length),(this[i]|this[i+1]<<8|this[i+2]<<16)+16777216*this[i+3]},x.prototype.readUInt32BE=function(i,e){return i>>>=0,e||ye(i,4,this.length),16777216*this[i]+(this[i+1]<<16|this[i+2]<<8|this[i+3])},x.prototype.readIntLE=function(i,e,a){i>>>=0,e>>>=0,a||ye(i,e,this.length);for(var c=this[i],h=1,d=0;++d<e&&(h*=256);)c+=this[i+d]*h;return c>=(h*=128)&&(c-=Math.pow(2,8*e)),c},x.prototype.readIntBE=function(i,e,a){i>>>=0,e>>>=0,a||ye(i,e,this.length);for(var c=e,h=1,d=this[i+--c];c>0&&(h*=256);)d+=this[i+--c]*h;return d>=(h*=128)&&(d-=Math.pow(2,8*e)),d},x.prototype.readInt8=function(i,e){return i>>>=0,e||ye(i,1,this.length),128&this[i]?-1*(255-this[i]+1):this[i]},x.prototype.readInt16LE=function(i,e){i>>>=0,e||ye(i,2,this.length);var a=this[i]|this[i+1]<<8;return 32768&a?4294901760|a:a},x.prototype.readInt16BE=function(i,e){i>>>=0,e||ye(i,2,this.length);var a=this[i+1]|this[i]<<8;return 32768&a?4294901760|a:a},x.prototype.readInt32LE=function(i,e){return i>>>=0,e||ye(i,4,this.length),this[i]|this[i+1]<<8|this[i+2]<<16|this[i+3]<<24},x.prototype.readInt32BE=function(i,e){return i>>>=0,e||ye(i,4,this.length),this[i]<<24|this[i+1]<<16|this[i+2]<<8|this[i+3]},x.prototype.readFloatLE=function(i,e){return i>>>=0,e||ye(i,4,this.length),Ur.read(this,i,!0,23,4)},x.prototype.readFloatBE=function(i,e){return i>>>=0,e||ye(i,4,this.length),Ur.read(this,i,!1,23,4)},x.prototype.readDoubleLE=function(i,e){return i>>>=0,e||ye(i,8,this.length),Ur.read(this,i,!0,52,8)},x.prototype.readDoubleBE=function(i,e){return i>>>=0,e||ye(i,8,this.length),Ur.read(this,i,!1,52,8)},x.prototype.writeUIntLE=function(i,e,a,c){i=+i,e>>>=0,a>>>=0,c||Pe(this,i,e,a,Math.pow(2,8*a)-1,0);var h=1,d=0;for(this[e]=255&i;++d<a&&(h*=256);)this[e+d]=i/h&255;return e+a},x.prototype.writeUIntBE=function(i,e,a,c){i=+i,e>>>=0,a>>>=0,c||Pe(this,i,e,a,Math.pow(2,8*a)-1,0);var h=a-1,d=1;for(this[e+h]=255&i;--h>=0&&(d*=256);)this[e+h]=i/d&255;return e+a},x.prototype.writeUInt8=function(i,e,a){return i=+i,e>>>=0,a||Pe(this,i,e,1,255,0),this[e]=255&i,e+1},x.prototype.writeUInt16LE=function(i,e,a){return i=+i,e>>>=0,a||Pe(this,i,e,2,65535,0),this[e]=255&i,this[e+1]=i>>>8,e+2},x.prototype.writeUInt16BE=function(i,e,a){return i=+i,e>>>=0,a||Pe(this,i,e,2,65535,0),this[e]=i>>>8,this[e+1]=255&i,e+2},x.prototype.writeUInt32LE=function(i,e,a){return i=+i,e>>>=0,a||Pe(this,i,e,4,4294967295,0),this[e+3]=i>>>24,this[e+2]=i>>>16,this[e+1]=i>>>8,this[e]=255&i,e+4},x.prototype.writeUInt32BE=function(i,e,a){return i=+i,e>>>=0,a||Pe(this,i,e,4,4294967295,0),this[e]=i>>>24,this[e+1]=i>>>16,this[e+2]=i>>>8,this[e+3]=255&i,e+4},x.prototype.writeIntLE=function(i,e,a,c){if(i=+i,e>>>=0,!c){var h=Math.pow(2,8*a-1);Pe(this,i,e,a,h-1,-h)}var d=0,et=1,ft=0;for(this[e]=255&i;++d<a&&(et*=256);)i<0&&ft===0&&this[e+d-1]!==0&&(ft=1),this[e+d]=(i/et>>0)-ft&255;return e+a},x.prototype.writeIntBE=function(i,e,a,c){if(i=+i,e>>>=0,!c){var h=Math.pow(2,8*a-1);Pe(this,i,e,a,h-1,-h)}var d=a-1,et=1,ft=0;for(this[e+d]=255&i;--d>=0&&(et*=256);)i<0&&ft===0&&this[e+d+1]!==0&&(ft=1),this[e+d]=(i/et>>0)-ft&255;return e+a},x.prototype.writeInt8=function(i,e,a){return i=+i,e>>>=0,a||Pe(this,i,e,1,127,-128),i<0&&(i=255+i+1),this[e]=255&i,e+1},x.prototype.writeInt16LE=function(i,e,a){return i=+i,e>>>=0,a||Pe(this,i,e,2,32767,-32768),this[e]=255&i,this[e+1]=i>>>8,e+2},x.prototype.writeInt16BE=function(i,e,a){return i=+i,e>>>=0,a||Pe(this,i,e,2,32767,-32768),this[e]=i>>>8,this[e+1]=255&i,e+2},x.prototype.writeInt32LE=function(i,e,a){return i=+i,e>>>=0,a||Pe(this,i,e,4,2147483647,-2147483648),this[e]=255&i,this[e+1]=i>>>8,this[e+2]=i>>>16,this[e+3]=i>>>24,e+4},x.prototype.writeInt32BE=function(i,e,a){return i=+i,e>>>=0,a||Pe(this,i,e,4,2147483647,-2147483648),i<0&&(i=4294967295+i+1),this[e]=i>>>24,this[e+1]=i>>>16,this[e+2]=i>>>8,this[e+3]=255&i,e+4},x.prototype.writeFloatLE=function(i,e,a){return Ec(this,i,e,!0,a)},x.prototype.writeFloatBE=function(i,e,a){return Ec(this,i,e,!1,a)},x.prototype.writeDoubleLE=function(i,e,a){return Sc(this,i,e,!0,a)},x.prototype.writeDoubleBE=function(i,e,a){return Sc(this,i,e,!1,a)},x.prototype.copy=function(i,e,a,c){if(!x.isBuffer(i))throw new TypeError("argument should be a Buffer");if(a||(a=0),c||c===0||(c=this.length),e>=i.length&&(e=i.length),e||(e=0),c>0&&c<a&&(c=a),c===a||i.length===0||this.length===0)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(a<0||a>=this.length)throw new RangeError("Index out of range");if(c<0)throw new RangeError("sourceEnd out of bounds");c>this.length&&(c=this.length),i.length-e<c-a&&(c=i.length-e+a);var h=c-a;if(this===i&&typeof Uint8Array.prototype.copyWithin=="function")this.copyWithin(e,a,c);else if(this===i&&a<e&&e<c)for(var d=h-1;d>=0;--d)i[d+e]=this[d+a];else Uint8Array.prototype.set.call(i,this.subarray(a,c),e);return h},x.prototype.fill=function(i,e,a,c){if(typeof i=="string"){if(typeof e=="string"?(c=e,e=0,a=this.length):typeof a=="string"&&(c=a,a=this.length),c!==void 0&&typeof c!="string")throw new TypeError("encoding must be a string");if(typeof c=="string"&&!x.isEncoding(c))throw new TypeError("Unknown encoding: "+c);if(i.length===1){var h=i.charCodeAt(0);(c==="utf8"&&h<128||c==="latin1")&&(i=h)}}else typeof i=="number"?i&=255:typeof i=="boolean"&&(i=Number(i));if(e<0||this.length<e||this.length<a)throw new RangeError("Out of range index");if(a<=e)return this;var d;if(e>>>=0,a=a===void 0?this.length:a>>>0,i||(i=0),typeof i=="number")for(d=e;d<a;++d)this[d]=i;else{var et=x.isBuffer(i)?i:x.from(i,c),ft=et.length;if(ft===0)throw new TypeError('The value "'+i+'" is invalid for argument "value"');for(d=0;d<a-e;++d)this[d+e]=et[d%ft]}return this},Iw=/[^+/0-9A-Za-z-_]/g,Tw=function(){for(var i=new Array(256),e=0;e<16;++e)for(var a=16*e,c=0;c<16;++c)i[a+c]="0123456789abcdef"[e]+"0123456789abcdef"[c];return i}(),St.Buffer,St.INSPECT_MAX_BYTES,St.kMaxLength,an={},ln=St,it=ln.Buffer,it.from&&it.alloc&&it.allocUnsafe&&it.allocUnsafeSlow?an=ln:(Ac(ln,an),an.Buffer=or$a),or$a.prototype=Object.create(it.prototype),Ac(it,or$a),or$a.from=function(i,e,a){if(typeof i=="number")throw new TypeError("Argument must not be a number");return it(i,e,a)},or$a.alloc=function(i,e,a){if(typeof i!="number")throw new TypeError("Argument must be a number");var c=it(i);return e!==void 0?typeof a=="string"?c.fill(e,a):c.fill(e):c.fill(0),c},or$a.allocUnsafe=function(i){if(typeof i!="number")throw new TypeError("Argument must be a number");return it(i)},or$a.allocUnsafeSlow=function(i){if(typeof i!="number")throw new TypeError("Argument must be a number");return ln.SlowBuffer(i)},Rw=an,ar={},zs=Rw.Buffer,Ic=zs.isEncoding||function(i){switch((i=""+i)&&i.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}},ar.StringDecoder=ci,ci.prototype.write=function(i){if(i.length===0)return"";var e,a;if(this.lastNeed){if((e=this.fillLast(i))===void 0)return"";a=this.lastNeed,this.lastNeed=0}else a=0;return a<i.length?e?e+this.text(i,a):this.text(i,a):e||""},ci.prototype.end=function(i){var e=i&&i.length?this.write(i):"";return this.lastNeed?e+"�":e},ci.prototype.text=function(i,e){var a=function(h,d,et){var ft=d.length-1;if(ft<et)return 0;var gt=Ws(d[ft]);return gt>=0?(gt>0&&(h.lastNeed=gt-1),gt):--ft<et||gt===-2?0:(gt=Ws(d[ft]))>=0?(gt>0&&(h.lastNeed=gt-2),gt):--ft<et||gt===-2?0:(gt=Ws(d[ft]))>=0?(gt>0&&(gt===2?gt=0:h.lastNeed=gt-3),gt):0}(this,i,e);if(!this.lastNeed)return i.toString("utf8",e);this.lastTotal=a;var c=i.length-(a-this.lastNeed);return i.copy(this.lastChar,0,c),i.toString("utf8",e,c)},ci.prototype.fillLast=function(i){if(this.lastNeed<=i.length)return i.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);i.copy(this.lastChar,this.lastTotal-this.lastNeed,0,i.length),this.lastNeed-=i.length},ar.StringDecoder,ar.StringDecoder}),Mc={};Qt(Mc,{StringDecoder:()=>Lw,default:()=>ar});var Lw,Lc=be(()=>{v(),m(),_(),Qs(),Qs(),Lw=ar.StringDecoder}),Ys=M((i,e)=>{v(),m(),_();var a=Ut(),{PromisePrototypeThen:c,SymbolAsyncIterator:h,SymbolIterator:d}=ce(),{Buffer:et}=(we(),Z(ve)),{ERR_INVALID_ARG_TYPE:ft,ERR_STREAM_NULL_VALUES:gt}=Se().codes;function _t(wt,$t,It){let Rt;if(typeof $t=="string"||$t instanceof et)return new wt({objectMode:!0,...It,read(){this.push($t),this.push(null)}});let Tt;if($t&&$t[h])Tt=!0,Rt=$t[h]();else if($t&&$t[d])Tt=!1,Rt=$t[d]();else throw new ft("iterable",["Iterable"],$t);let At=new wt({objectMode:!0,highWaterMark:1,...It}),kt=!1;At._read=function(){kt||(kt=!0,Nt())},At._destroy=function(Ft,jt){c(xt(Ft),()=>a.nextTick(jt,Ft),Gt=>a.nextTick(jt,Gt||Ft))};async function xt(Ft){let jt=Ft!=null,Gt=typeof Rt.throw=="function";if(jt&&Gt){let{value:Kt,done:Wt}=await Rt.throw(Ft);if(await Kt,Wt)return}if(typeof Rt.return=="function"){let{value:Kt}=await Rt.return();await Kt}}async function Nt(){for(;;){try{let{value:Ft,done:jt}=Tt?await Rt.next():Rt.next();if(jt)At.push(null);else{let Gt=Ft&&typeof Ft.then=="function"?await Ft:Ft;if(Gt===null)throw kt=!1,new gt;if(At.push(Gt))continue;kt=!1}}catch(Ft){At.destroy(Ft)}break}}return At}e.exports=_t}),hi=M((i,e)=>{v(),m(),_();var a=Ut(),{ArrayPrototypeIndexOf:c,NumberIsInteger:h,NumberIsNaN:d,NumberParseInt:et,ObjectDefineProperties:ft,ObjectKeys:gt,ObjectSetPrototypeOf:_t,Promise:wt,SafeSet:$t,SymbolAsyncIterator:It,Symbol:Rt}=ce();e.exports=dr,dr.ReadableState=Fr;var{EventEmitter:Tt}=(ir(),Z(rr$1)),{Stream:At,prependListener:kt}=tn(),{Buffer:xt}=(we(),Z(ve)),{addAbortSignal:Nt}=fi(),Ft=mt(),jt=Je().debuglog("stream",Vt=>{jt=Vt}),Gt=hc(),Kt=tr(),{getHighWaterMark:Wt,getDefaultHighWaterMark:Zt}=sn(),{aggregateTwoErrors:cr,codes:{ERR_INVALID_ARG_TYPE:hr,ERR_METHOD_NOT_IMPLEMENTED:gr,ERR_OUT_OF_RANGE:er,ERR_STREAM_PUSH_AFTER_EOF:mr,ERR_STREAM_UNSHIFT_AFTER_END_EVENT:Mr}}=Se(),{validateObject:wr}=ui(),Dr=Rt("kPaused"),{StringDecoder:Tr}=(Lc(),Z(Mc)),fr=Ys();_t(dr.prototype,At.prototype),_t(dr,At);var yr=()=>{},{errorOrDestroy:$r}=Kt;function Fr(Vt,Xt,Er){typeof Er!="boolean"&&(Er=Xt instanceof nt()),this.objectMode=!!(Vt&&Vt.objectMode),Er&&(this.objectMode=this.objectMode||!!(Vt&&Vt.readableObjectMode)),this.highWaterMark=Vt?Wt(this,Vt,"readableHighWaterMark",Er):Zt(!1),this.buffer=new Gt,this.length=0,this.pipes=[],this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.constructed=!0,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this[Dr]=null,this.errorEmitted=!1,this.emitClose=!Vt||Vt.emitClose!==!1,this.autoDestroy=!Vt||Vt.autoDestroy!==!1,this.destroyed=!1,this.errored=null,this.closed=!1,this.closeEmitted=!1,this.defaultEncoding=Vt&&Vt.defaultEncoding||"utf8",this.awaitDrainWriters=null,this.multiAwaitDrain=!1,this.readingMore=!1,this.dataEmitted=!1,this.decoder=null,this.encoding=null,Vt&&Vt.encoding&&(this.decoder=new Tr(Vt.encoding),this.encoding=Vt.encoding)}function dr(Vt){if(!(this instanceof dr))return new dr(Vt);let Xt=this instanceof nt();this._readableState=new Fr(Vt,this,Xt),Vt&&(typeof Vt.read=="function"&&(this._read=Vt.read),typeof Vt.destroy=="function"&&(this._destroy=Vt.destroy),typeof Vt.construct=="function"&&(this._construct=Vt.construct),Vt.signal&&!Xt&&Nt(Vt.signal,this)),At.call(this,Vt),Kt.construct(this,()=>{this._readableState.needReadable&&Cr(this,this._readableState)})}dr.prototype.destroy=Kt.destroy,dr.prototype._undestroy=Kt.undestroy,dr.prototype._destroy=function(Vt,Xt){Xt(Vt)},dr.prototype[Tt.captureRejectionSymbol]=function(Vt){this.destroy(Vt)},dr.prototype.push=function(Vt,Xt){return Br(this,Vt,Xt,!1)},dr.prototype.unshift=function(Vt,Xt){return Br(this,Vt,Xt,!0)};function Br(Vt,Xt,Er,Sr){jt("readableAddChunk",Xt);let pr=Vt._readableState,Rr;if(pr.objectMode||(typeof Xt=="string"?(Er=Er||pr.defaultEncoding,pr.encoding!==Er&&(Sr&&pr.encoding?Xt=xt.from(Xt,Er).toString(pr.encoding):(Xt=xt.from(Xt,Er),Er=""))):Xt instanceof xt?Er="":At._isUint8Array(Xt)?(Xt=At._uint8ArrayToBuffer(Xt),Er=""):Xt!=null&&(Rr=new hr("chunk",["string","Buffer","Uint8Array"],Xt))),Rr)$r(Vt,Rr);else if(Xt===null)pr.reading=!1,_r(Vt,pr);else if(pr.objectMode||Xt&&Xt.length>0)if(Sr)if(pr.endEmitted)$r(Vt,new Mr);else{if(pr.destroyed||pr.errored)return!1;Hr(Vt,pr,Xt,!0)}else if(pr.ended)$r(Vt,new mr);else{if(pr.destroyed||pr.errored)return!1;pr.reading=!1,pr.decoder&&!Er?(Xt=pr.decoder.write(Xt),pr.objectMode||Xt.length!==0?Hr(Vt,pr,Xt,!1):Cr(Vt,pr)):Hr(Vt,pr,Xt,!1)}else Sr||(pr.reading=!1,Cr(Vt,pr));return!pr.ended&&(pr.length<pr.highWaterMark||pr.length===0)}function Hr(Vt,Xt,Er,Sr){Xt.flowing&&Xt.length===0&&!Xt.sync&&Vt.listenerCount("data")>0?(Xt.multiAwaitDrain?Xt.awaitDrainWriters.clear():Xt.awaitDrainWriters=null,Xt.dataEmitted=!0,Vt.emit("data",Er)):(Xt.length+=Xt.objectMode?1:Er.length,Sr?Xt.buffer.unshift(Er):Xt.buffer.push(Er),Xt.needReadable&&Vr(Vt)),Cr(Vt,Xt)}dr.prototype.isPaused=function(){let Vt=this._readableState;return Vt[Dr]===!0||Vt.flowing===!1},dr.prototype.setEncoding=function(Vt){let Xt=new Tr(Vt);this._readableState.decoder=Xt,this._readableState.encoding=this._readableState.decoder.encoding;let Er=this._readableState.buffer,Sr="";for(let pr of Er)Sr+=Xt.write(pr);return Er.clear(),Sr!==""&&Er.push(Sr),this._readableState.length=Sr.length,this};var Jr=1073741824;function zr(Vt){if(Vt>Jr)throw new er("size","<= 1GiB",Vt);return Vt--,Vt|=Vt>>>1,Vt|=Vt>>>2,Vt|=Vt>>>4,Vt|=Vt>>>8,Vt|=Vt>>>16,Vt++,Vt}function br(Vt,Xt){return Vt<=0||Xt.length===0&&Xt.ended?0:Xt.objectMode?1:d(Vt)?Xt.flowing&&Xt.length?Xt.buffer.first().length:Xt.length:Vt<=Xt.length?Vt:Xt.ended?Xt.length:0}dr.prototype.read=function(Vt){jt("read",Vt),Vt===void 0?Vt=NaN:h(Vt)||(Vt=et(Vt,10));let Xt=this._readableState,Er=Vt;if(Vt>Xt.highWaterMark&&(Xt.highWaterMark=zr(Vt)),Vt!==0&&(Xt.emittedReadable=!1),Vt===0&&Xt.needReadable&&((Xt.highWaterMark!==0?Xt.length>=Xt.highWaterMark:Xt.length>0)||Xt.ended))return jt("read: emitReadable",Xt.length,Xt.ended),Xt.length===0&&Xt.ended?hn(this):Vr(this),null;if(Vt=br(Vt,Xt),Vt===0&&Xt.ended)return Xt.length===0&&hn(this),null;let Sr=Xt.needReadable;if(jt("need readable",Sr),(Xt.length===0||Xt.length-Vt<Xt.highWaterMark)&&(Sr=!0,jt("length less than watermark",Sr)),Xt.ended||Xt.reading||Xt.destroyed||Xt.errored||!Xt.constructed)Sr=!1,jt("reading, ended or constructing",Sr);else if(Sr){jt("do read"),Xt.reading=!0,Xt.sync=!0,Xt.length===0&&(Xt.needReadable=!0);try{this._read(Xt.highWaterMark)}catch(Rr){$r(this,Rr)}Xt.sync=!1,Xt.reading||(Vt=br(Er,Xt))}let pr;return Vt>0?pr=Xr(Vt,Xt):pr=null,pr===null?(Xt.needReadable=Xt.length<=Xt.highWaterMark,Vt=0):(Xt.length-=Vt,Xt.multiAwaitDrain?Xt.awaitDrainWriters.clear():Xt.awaitDrainWriters=null),Xt.length===0&&(Xt.ended||(Xt.needReadable=!0),Er!==Vt&&Xt.ended&&hn(this)),pr!==null&&!Xt.errorEmitted&&!Xt.closeEmitted&&(Xt.dataEmitted=!0,this.emit("data",pr)),pr};function _r(Vt,Xt){if(jt("onEofChunk"),!Xt.ended){if(Xt.decoder){let Er=Xt.decoder.end();Er&&Er.length&&(Xt.buffer.push(Er),Xt.length+=Xt.objectMode?1:Er.length)}Xt.ended=!0,Xt.sync?Vr(Vt):(Xt.needReadable=!1,Xt.emittedReadable=!0,lr(Vt))}}function Vr(Vt){let Xt=Vt._readableState;jt("emitReadable",Xt.needReadable,Xt.emittedReadable),Xt.needReadable=!1,Xt.emittedReadable||(jt("emitReadable",Xt.flowing),Xt.emittedReadable=!0,a.nextTick(lr,Vt))}function lr(Vt){let Xt=Vt._readableState;jt("emitReadable_",Xt.destroyed,Xt.length,Xt.ended),!Xt.destroyed&&!Xt.errored&&(Xt.length||Xt.ended)&&(Vt.emit("readable"),Xt.emittedReadable=!1),Xt.needReadable=!Xt.flowing&&!Xt.ended&&Xt.length<=Xt.highWaterMark,en(Vt)}function Cr(Vt,Xt){!Xt.readingMore&&Xt.constructed&&(Xt.readingMore=!0,a.nextTick(xr,Vt,Xt))}function xr(Vt,Xt){for(;!Xt.reading&&!Xt.ended&&(Xt.length<Xt.highWaterMark||Xt.flowing&&Xt.length===0);){let Er=Xt.length;if(jt("maybeReadMore read 0"),Vt.read(0),Er===Xt.length)break}Xt.readingMore=!1}dr.prototype._read=function(Vt){throw new gr("_read()")},dr.prototype.pipe=function(Vt,Xt){let Er=this,Sr=this._readableState;Sr.pipes.length===1&&(Sr.multiAwaitDrain||(Sr.multiAwaitDrain=!0,Sr.awaitDrainWriters=new $t(Sr.awaitDrainWriters?[Sr.awaitDrainWriters]:[]))),Sr.pipes.push(Vt),jt("pipe count=%d opts=%j",Sr.pipes.length,Xt);let pr=(!Xt||Xt.end!==!1)&&Vt!==a.stdout&&Vt!==a.stderr?Qr:jn;Sr.endEmitted?a.nextTick(pr):Er.once("end",pr),Vt.on("unpipe",Rr);function Rr(jr,qr){jt("onunpipe"),jr===Er&&qr&&qr.hasUnpiped===!1&&(qr.hasUnpiped=!0,fn())}function Qr(){jt("onend"),Vt.end()}let nn,rn=!1;function fn(){jt("cleanup"),Vt.removeListener("close",Vn),Vt.removeListener("finish",xn),nn&&Vt.removeListener("drain",nn),Vt.removeListener("error",On),Vt.removeListener("unpipe",Rr),Er.removeListener("end",Qr),Er.removeListener("end",jn),Er.removeListener("data",In),rn=!0,nn&&Sr.awaitDrainWriters&&(!Vt._writableState||Vt._writableState.needDrain)&&nn()}function bn(){rn||(Sr.pipes.length===1&&Sr.pipes[0]===Vt?(jt("false write response, pause",0),Sr.awaitDrainWriters=Vt,Sr.multiAwaitDrain=!1):Sr.pipes.length>1&&Sr.pipes.includes(Vt)&&(jt("false write response, pause",Sr.awaitDrainWriters.size),Sr.awaitDrainWriters.add(Vt)),Er.pause()),nn||(nn=Kr(Er,Vt),Vt.on("drain",nn))}Er.on("data",In);function In(jr){jt("ondata");let qr=Vt.write(jr);jt("dest.write",qr),qr===!1&&bn()}function On(jr){if(jt("onerror",jr),jn(),Vt.removeListener("error",On),Vt.listenerCount("error")===0){let qr=Vt._writableState||Vt._readableState;qr&&!qr.errorEmitted?$r(Vt,jr):Vt.emit("error",jr)}}kt(Vt,"error",On);function Vn(){Vt.removeListener("finish",xn),jn()}Vt.once("close",Vn);function xn(){jt("onfinish"),Vt.removeListener("close",Vn),jn()}Vt.once("finish",xn);function jn(){jt("unpipe"),Er.unpipe(Vt)}return Vt.emit("pipe",Er),Vt.writableNeedDrain===!0?Sr.flowing&&bn():Sr.flowing||(jt("pipe resume"),Er.resume()),Vt};function Kr(Vt,Xt){return function(){let Er=Vt._readableState;Er.awaitDrainWriters===Xt?(jt("pipeOnDrain",1),Er.awaitDrainWriters=null):Er.multiAwaitDrain&&(jt("pipeOnDrain",Er.awaitDrainWriters.size),Er.awaitDrainWriters.delete(Xt)),(!Er.awaitDrainWriters||Er.awaitDrainWriters.size===0)&&Vt.listenerCount("data")&&Vt.resume()}}dr.prototype.unpipe=function(Vt){let Xt=this._readableState,Er={hasUnpiped:!1};if(Xt.pipes.length===0)return this;if(!Vt){let pr=Xt.pipes;Xt.pipes=[],this.pause();for(let Rr=0;Rr<pr.length;Rr++)pr[Rr].emit("unpipe",this,{hasUnpiped:!1});return this}let Sr=c(Xt.pipes,Vt);return Sr===-1?this:(Xt.pipes.splice(Sr,1),Xt.pipes.length===0&&this.pause(),Vt.emit("unpipe",this,Er),this)},dr.prototype.on=function(Vt,Xt){let Er=At.prototype.on.call(this,Vt,Xt),Sr=this._readableState;return Vt==="data"?(Sr.readableListening=this.listenerCount("readable")>0,Sr.flowing!==!1&&this.resume()):Vt==="readable"&&!Sr.endEmitted&&!Sr.readableListening&&(Sr.readableListening=Sr.needReadable=!0,Sr.flowing=!1,Sr.emittedReadable=!1,jt("on readable",Sr.length,Sr.reading),Sr.length?Vr(this):Sr.reading||a.nextTick(vr,this)),Er},dr.prototype.addListener=dr.prototype.on,dr.prototype.removeListener=function(Vt,Xt){let Er=At.prototype.removeListener.call(this,Vt,Xt);return Vt==="readable"&&a.nextTick(Gr,this),Er},dr.prototype.off=dr.prototype.removeListener,dr.prototype.removeAllListeners=function(Vt){let Xt=At.prototype.removeAllListeners.apply(this,arguments);return(Vt==="readable"||Vt===void 0)&&a.nextTick(Gr,this),Xt};function Gr(Vt){let Xt=Vt._readableState;Xt.readableListening=Vt.listenerCount("readable")>0,Xt.resumeScheduled&&Xt[Dr]===!1?Xt.flowing=!0:Vt.listenerCount("data")>0?Vt.resume():Xt.readableListening||(Xt.flowing=null)}function vr(Vt){jt("readable nexttick read 0"),Vt.read(0)}dr.prototype.resume=function(){let Vt=this._readableState;return Vt.flowing||(jt("resume"),Vt.flowing=!Vt.readableListening,Nr(this,Vt)),Vt[Dr]=!1,this};function Nr(Vt,Xt){Xt.resumeScheduled||(Xt.resumeScheduled=!0,a.nextTick(Pr,Vt,Xt))}function Pr(Vt,Xt){jt("resume",Xt.reading),Xt.reading||Vt.read(0),Xt.resumeScheduled=!1,Vt.emit("resume"),en(Vt),Xt.flowing&&!Xt.reading&&Vt.read(0)}dr.prototype.pause=function(){return jt("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(jt("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState[Dr]=!0,this};function en(Vt){let Xt=Vt._readableState;for(jt("flow",Xt.flowing);Xt.flowing&&Vt.read()!==null;);}dr.prototype.wrap=function(Vt){let Xt=!1;Vt.on("data",Sr=>{!this.push(Sr)&&Vt.pause&&(Xt=!0,Vt.pause())}),Vt.on("end",()=>{this.push(null)}),Vt.on("error",Sr=>{$r(this,Sr)}),Vt.on("close",()=>{this.destroy()}),Vt.on("destroy",()=>{this.destroy()}),this._read=()=>{Xt&&Vt.resume&&(Xt=!1,Vt.resume())};let Er=gt(Vt);for(let Sr=1;Sr<Er.length;Sr++){let pr=Er[Sr];this[pr]===void 0&&typeof Vt[pr]=="function"&&(this[pr]=Vt[pr].bind(Vt))}return this},dr.prototype[It]=function(){return Wr(this)},dr.prototype.iterator=function(Vt){return Vt!==void 0&&wr(Vt,"options"),Wr(this,Vt)};function Wr(Vt,Xt){typeof Vt.read!="function"&&(Vt=dr.wrap(Vt,{objectMode:!0}));let Er=Or(Vt,Xt);return Er.stream=Vt,Er}async function*Or(Vt,Xt){let Er=yr;function Sr(Qr){this===Vt?(Er(),Er=yr):Er=Qr}Vt.on("readable",Sr);let pr,Rr=Ft(Vt,{writable:!1},Qr=>{pr=Qr?cr(pr,Qr):null,Er(),Er=yr});try{for(;;){let Qr=Vt.destroyed?null:Vt.read();if(Qr!==null)yield Qr;else{if(pr)throw pr;if(pr===null)return;await new wt(Sr)}}}catch(Qr){throw pr=cr(pr,Qr),pr}finally{(pr||(Xt==null?void 0:Xt.destroyOnReturn)!==!1)&&(pr===void 0||Vt._readableState.autoDestroy)?Kt.destroyer(Vt,null):(Vt.off("readable",Sr),Rr())}}ft(dr.prototype,{readable:{__proto__:null,get(){let Vt=this._readableState;return!!Vt&&Vt.readable!==!1&&!Vt.destroyed&&!Vt.errorEmitted&&!Vt.endEmitted},set(Vt){this._readableState&&(this._readableState.readable=!!Vt)}},readableDidRead:{__proto__:null,enumerable:!1,get:function(){return this._readableState.dataEmitted}},readableAborted:{__proto__:null,enumerable:!1,get:function(){return!!(this._readableState.readable!==!1&&(this._readableState.destroyed||this._readableState.errored)&&!this._readableState.endEmitted)}},readableHighWaterMark:{__proto__:null,enumerable:!1,get:function(){return this._readableState.highWaterMark}},readableBuffer:{__proto__:null,enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}},readableFlowing:{__proto__:null,enumerable:!1,get:function(){return this._readableState.flowing},set:function(Vt){this._readableState&&(this._readableState.flowing=Vt)}},readableLength:{__proto__:null,enumerable:!1,get(){return this._readableState.length}},readableObjectMode:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.objectMode:!1}},readableEncoding:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.encoding:null}},errored:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.errored:null}},closed:{__proto__:null,get(){return this._readableState?this._readableState.closed:!1}},destroyed:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.destroyed:!1},set(Vt){this._readableState&&(this._readableState.destroyed=Vt)}},readableEnded:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.endEmitted:!1}}}),ft(Fr.prototype,{pipesCount:{__proto__:null,get(){return this.pipes.length}},paused:{__proto__:null,get(){return this[Dr]!==!1},set(Vt){this[Dr]=!!Vt}}}),dr._fromList=Xr;function Xr(Vt,Xt){if(Xt.length===0)return null;let Er;return Xt.objectMode?Er=Xt.buffer.shift():!Vt||Vt>=Xt.length?(Xt.decoder?Er=Xt.buffer.join(""):Xt.buffer.length===1?Er=Xt.buffer.first():Er=Xt.buffer.concat(Xt.length),Xt.buffer.clear()):Er=Xt.buffer.consume(Vt,Xt.decoder),Er}function hn(Vt){let Xt=Vt._readableState;jt("endReadable",Xt.endEmitted),Xt.endEmitted||(Xt.ended=!0,a.nextTick(pn,Xt,Vt))}function pn(Vt,Xt){if(jt("endReadableNT",Vt.endEmitted,Vt.length),!Vt.errored&&!Vt.closeEmitted&&!Vt.endEmitted&&Vt.length===0){if(Vt.endEmitted=!0,Xt.emit("end"),Xt.writable&&Xt.allowHalfOpen===!1)a.nextTick(vn,Xt);else if(Vt.autoDestroy){let Er=Xt._writableState;(!Er||Er.autoDestroy&&(Er.finished||Er.writable===!1))&&Xt.destroy()}}}function vn(Vt){Vt.writable&&!Vt.writableEnded&&!Vt.destroyed&&Vt.end()}dr.from=function(Vt,Xt){return fr(dr,Vt,Xt)};var Tn;function Ht(){return Tn===void 0&&(Tn={}),Tn}dr.fromWeb=function(Vt,Xt){return Ht().newStreamReadableFromReadableStream(Vt,Xt)},dr.toWeb=function(Vt,Xt){return Ht().newReadableStreamFromStreamReadable(Vt,Xt)},dr.wrap=function(Vt,Xt){var Er,Sr;return new dr({objectMode:(Er=(Sr=Vt.readableObjectMode)!==null&&Sr!==void 0?Sr:Vt.objectMode)!==null&&Er!==void 0?Er:!0,...Xt,destroy(pr,Rr){Kt.destroyer(Vt,pr),Rr(pr)}}).wrap(Vt)}}),uo=M((i,e)=>{v(),m(),_();var a=Ut(),{ArrayPrototypeSlice:c,Error:h,FunctionPrototypeSymbolHasInstance:d,ObjectDefineProperty:et,ObjectDefineProperties:ft,ObjectSetPrototypeOf:gt,StringPrototypeToLowerCase:_t,Symbol:wt,SymbolHasInstance:$t}=ce();e.exports=Tr,Tr.WritableState=wr;var{EventEmitter:It}=(ir(),Z(rr$1)),Rt=tn().Stream,{Buffer:Tt}=(we(),Z(ve)),At=tr(),{addAbortSignal:kt}=fi(),{getHighWaterMark:xt,getDefaultHighWaterMark:Nt}=sn(),{ERR_INVALID_ARG_TYPE:Ft,ERR_METHOD_NOT_IMPLEMENTED:jt,ERR_MULTIPLE_CALLBACK:Gt,ERR_STREAM_CANNOT_PIPE:Kt,ERR_STREAM_DESTROYED:Wt,ERR_STREAM_ALREADY_FINISHED:Zt,ERR_STREAM_NULL_VALUES:cr,ERR_STREAM_WRITE_AFTER_END:hr,ERR_UNKNOWN_ENCODING:gr}=Se().codes,{errorOrDestroy:er}=At;gt(Tr.prototype,Rt.prototype),gt(Tr,Rt);function mr(){}var Mr=wt("kOnFinished");function wr(vr,Nr,Pr){typeof Pr!="boolean"&&(Pr=Nr instanceof nt()),this.objectMode=!!(vr&&vr.objectMode),Pr&&(this.objectMode=this.objectMode||!!(vr&&vr.writableObjectMode)),this.highWaterMark=vr?xt(this,vr,"writableHighWaterMark",Pr):Nt(!1),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;let en=!!(vr&&vr.decodeStrings===!1);this.decodeStrings=!en,this.defaultEncoding=vr&&vr.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=dr.bind(void 0,Nr),this.writecb=null,this.writelen=0,this.afterWriteTickInfo=null,Dr(this),this.pendingcb=0,this.constructed=!0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!vr||vr.emitClose!==!1,this.autoDestroy=!vr||vr.autoDestroy!==!1,this.errored=null,this.closed=!1,this.closeEmitted=!1,this[Mr]=[]}function Dr(vr){vr.buffered=[],vr.bufferedIndex=0,vr.allBuffers=!0,vr.allNoop=!0}wr.prototype.getBuffer=function(){return c(this.buffered,this.bufferedIndex)},et(wr.prototype,"bufferedRequestCount",{__proto__:null,get(){return this.buffered.length-this.bufferedIndex}});function Tr(vr){let Nr=this instanceof nt();if(!Nr&&!d(Tr,this))return new Tr(vr);this._writableState=new wr(vr,this,Nr),vr&&(typeof vr.write=="function"&&(this._write=vr.write),typeof vr.writev=="function"&&(this._writev=vr.writev),typeof vr.destroy=="function"&&(this._destroy=vr.destroy),typeof vr.final=="function"&&(this._final=vr.final),typeof vr.construct=="function"&&(this._construct=vr.construct),vr.signal&&kt(vr.signal,this)),Rt.call(this,vr),At.construct(this,()=>{let Pr=this._writableState;Pr.writing||zr(this,Pr),lr(this,Pr)})}et(Tr,$t,{__proto__:null,value:function(vr){return d(this,vr)?!0:this!==Tr?!1:vr&&vr._writableState instanceof wr}}),Tr.prototype.pipe=function(){er(this,new Kt)};function fr(vr,Nr,Pr,en){let Wr=vr._writableState;if(typeof Pr=="function")en=Pr,Pr=Wr.defaultEncoding;else{if(!Pr)Pr=Wr.defaultEncoding;else if(Pr!=="buffer"&&!Tt.isEncoding(Pr))throw new gr(Pr);typeof en!="function"&&(en=mr)}if(Nr===null)throw new cr;if(!Wr.objectMode)if(typeof Nr=="string")Wr.decodeStrings!==!1&&(Nr=Tt.from(Nr,Pr),Pr="buffer");else if(Nr instanceof Tt)Pr="buffer";else if(Rt._isUint8Array(Nr))Nr=Rt._uint8ArrayToBuffer(Nr),Pr="buffer";else throw new Ft("chunk",["string","Buffer","Uint8Array"],Nr);let Or;return Wr.ending?Or=new hr:Wr.destroyed&&(Or=new Wt("write")),Or?(a.nextTick(en,Or),er(vr,Or,!0),Or):(Wr.pendingcb++,yr(vr,Wr,Nr,Pr,en))}Tr.prototype.write=function(vr,Nr,Pr){return fr(this,vr,Nr,Pr)===!0},Tr.prototype.cork=function(){this._writableState.corked++},Tr.prototype.uncork=function(){let vr=this._writableState;vr.corked&&(vr.corked--,vr.writing||zr(this,vr))},Tr.prototype.setDefaultEncoding=function(vr){if(typeof vr=="string"&&(vr=_t(vr)),!Tt.isEncoding(vr))throw new gr(vr);return this._writableState.defaultEncoding=vr,this};function yr(vr,Nr,Pr,en,Wr){let Or=Nr.objectMode?1:Pr.length;Nr.length+=Or;let Xr=Nr.length<Nr.highWaterMark;return Xr||(Nr.needDrain=!0),Nr.writing||Nr.corked||Nr.errored||!Nr.constructed?(Nr.buffered.push({chunk:Pr,encoding:en,callback:Wr}),Nr.allBuffers&&en!=="buffer"&&(Nr.allBuffers=!1),Nr.allNoop&&Wr!==mr&&(Nr.allNoop=!1)):(Nr.writelen=Or,Nr.writecb=Wr,Nr.writing=!0,Nr.sync=!0,vr._write(Pr,en,Nr.onwrite),Nr.sync=!1),Xr&&!Nr.errored&&!Nr.destroyed}function $r(vr,Nr,Pr,en,Wr,Or,Xr){Nr.writelen=en,Nr.writecb=Xr,Nr.writing=!0,Nr.sync=!0,Nr.destroyed?Nr.onwrite(new Wt("write")):Pr?vr._writev(Wr,Nr.onwrite):vr._write(Wr,Or,Nr.onwrite),Nr.sync=!1}function Fr(vr,Nr,Pr,en){--Nr.pendingcb,en(Pr),Jr(Nr),er(vr,Pr)}function dr(vr,Nr){let Pr=vr._writableState,en=Pr.sync,Wr=Pr.writecb;if(typeof Wr!="function"){er(vr,new Gt);return}Pr.writing=!1,Pr.writecb=null,Pr.length-=Pr.writelen,Pr.writelen=0,Nr?(Nr.stack,Pr.errored||(Pr.errored=Nr),vr._readableState&&!vr._readableState.errored&&(vr._readableState.errored=Nr),en?a.nextTick(Fr,vr,Pr,Nr,Wr):Fr(vr,Pr,Nr,Wr)):(Pr.buffered.length>Pr.bufferedIndex&&zr(vr,Pr),en?Pr.afterWriteTickInfo!==null&&Pr.afterWriteTickInfo.cb===Wr?Pr.afterWriteTickInfo.count++:(Pr.afterWriteTickInfo={count:1,cb:Wr,stream:vr,state:Pr},a.nextTick(Br,Pr.afterWriteTickInfo)):Hr(vr,Pr,1,Wr))}function Br({stream:vr,state:Nr,count:Pr,cb:en}){return Nr.afterWriteTickInfo=null,Hr(vr,Nr,Pr,en)}function Hr(vr,Nr,Pr,en){for(!Nr.ending&&!vr.destroyed&&Nr.length===0&&Nr.needDrain&&(Nr.needDrain=!1,vr.emit("drain"));Pr-- >0;)Nr.pendingcb--,en();Nr.destroyed&&Jr(Nr),lr(vr,Nr)}function Jr(vr){if(vr.writing)return;for(let Wr=vr.bufferedIndex;Wr<vr.buffered.length;++Wr){var Nr;let{chunk:Or,callback:Xr}=vr.buffered[Wr],hn=vr.objectMode?1:Or.length;vr.length-=hn,Xr((Nr=vr.errored)!==null&&Nr!==void 0?Nr:new Wt("write"))}let Pr=vr[Mr].splice(0);for(let Wr=0;Wr<Pr.length;Wr++){var en;Pr[Wr]((en=vr.errored)!==null&&en!==void 0?en:new Wt("end"))}Dr(vr)}function zr(vr,Nr){if(Nr.corked||Nr.bufferProcessing||Nr.destroyed||!Nr.constructed)return;let{buffered:Pr,bufferedIndex:en,objectMode:Wr}=Nr,Or=Pr.length-en;if(!Or)return;let Xr=en;if(Nr.bufferProcessing=!0,Or>1&&vr._writev){Nr.pendingcb-=Or-1;let hn=Nr.allNoop?mr:vn=>{for(let Tn=Xr;Tn<Pr.length;++Tn)Pr[Tn].callback(vn)},pn=Nr.allNoop&&Xr===0?Pr:c(Pr,Xr);pn.allBuffers=Nr.allBuffers,$r(vr,Nr,!0,Nr.length,pn,"",hn),Dr(Nr)}else{do{let{chunk:hn,encoding:pn,callback:vn}=Pr[Xr];Pr[Xr++]=null;let Tn=Wr?1:hn.length;$r(vr,Nr,!1,Tn,hn,pn,vn)}while(Xr<Pr.length&&!Nr.writing);Xr===Pr.length?Dr(Nr):Xr>256?(Pr.splice(0,Xr),Nr.bufferedIndex=0):Nr.bufferedIndex=Xr}Nr.bufferProcessing=!1}Tr.prototype._write=function(vr,Nr,Pr){if(this._writev)this._writev([{chunk:vr,encoding:Nr}],Pr);else throw new jt("_write()")},Tr.prototype._writev=null,Tr.prototype.end=function(vr,Nr,Pr){let en=this._writableState;typeof vr=="function"?(Pr=vr,vr=null,Nr=null):typeof Nr=="function"&&(Pr=Nr,Nr=null);let Wr;if(vr!=null){let Or=fr(this,vr,Nr);Or instanceof h&&(Wr=Or)}return en.corked&&(en.corked=1,this.uncork()),Wr||(!en.errored&&!en.ending?(en.ending=!0,lr(this,en,!0),en.ended=!0):en.finished?Wr=new Zt("end"):en.destroyed&&(Wr=new Wt("end"))),typeof Pr=="function"&&(Wr||en.finished?a.nextTick(Pr,Wr):en[Mr].push(Pr)),this};function br(vr){return vr.ending&&!vr.destroyed&&vr.constructed&&vr.length===0&&!vr.errored&&vr.buffered.length===0&&!vr.finished&&!vr.writing&&!vr.errorEmitted&&!vr.closeEmitted}function _r(vr,Nr){let Pr=!1;function en(Wr){if(Pr){er(vr,Wr??Gt());return}if(Pr=!0,Nr.pendingcb--,Wr){let Or=Nr[Mr].splice(0);for(let Xr=0;Xr<Or.length;Xr++)Or[Xr](Wr);er(vr,Wr,Nr.sync)}else br(Nr)&&(Nr.prefinished=!0,vr.emit("prefinish"),Nr.pendingcb++,a.nextTick(Cr,vr,Nr))}Nr.sync=!0,Nr.pendingcb++;try{vr._final(en)}catch(Wr){en(Wr)}Nr.sync=!1}function Vr(vr,Nr){!Nr.prefinished&&!Nr.finalCalled&&(typeof vr._final=="function"&&!Nr.destroyed?(Nr.finalCalled=!0,_r(vr,Nr)):(Nr.prefinished=!0,vr.emit("prefinish")))}function lr(vr,Nr,Pr){br(Nr)&&(Vr(vr,Nr),Nr.pendingcb===0&&(Pr?(Nr.pendingcb++,a.nextTick((en,Wr)=>{br(Wr)?Cr(en,Wr):Wr.pendingcb--},vr,Nr)):br(Nr)&&(Nr.pendingcb++,Cr(vr,Nr))))}function Cr(vr,Nr){Nr.pendingcb--,Nr.finished=!0;let Pr=Nr[Mr].splice(0);for(let en=0;en<Pr.length;en++)Pr[en]();if(vr.emit("finish"),Nr.autoDestroy){let en=vr._readableState;(!en||en.autoDestroy&&(en.endEmitted||en.readable===!1))&&vr.destroy()}}ft(Tr.prototype,{closed:{__proto__:null,get(){return this._writableState?this._writableState.closed:!1}},destroyed:{__proto__:null,get(){return this._writableState?this._writableState.destroyed:!1},set(vr){this._writableState&&(this._writableState.destroyed=vr)}},writable:{__proto__:null,get(){let vr=this._writableState;return!!vr&&vr.writable!==!1&&!vr.destroyed&&!vr.errored&&!vr.ending&&!vr.ended},set(vr){this._writableState&&(this._writableState.writable=!!vr)}},writableFinished:{__proto__:null,get(){return this._writableState?this._writableState.finished:!1}},writableObjectMode:{__proto__:null,get(){return this._writableState?this._writableState.objectMode:!1}},writableBuffer:{__proto__:null,get(){return this._writableState&&this._writableState.getBuffer()}},writableEnded:{__proto__:null,get(){return this._writableState?this._writableState.ending:!1}},writableNeedDrain:{__proto__:null,get(){let vr=this._writableState;return vr?!vr.destroyed&&!vr.ending&&vr.needDrain:!1}},writableHighWaterMark:{__proto__:null,get(){return this._writableState&&this._writableState.highWaterMark}},writableCorked:{__proto__:null,get(){return this._writableState?this._writableState.corked:0}},writableLength:{__proto__:null,get(){return this._writableState&&this._writableState.length}},errored:{__proto__:null,enumerable:!1,get(){return this._writableState?this._writableState.errored:null}},writableAborted:{__proto__:null,enumerable:!1,get:function(){return!!(this._writableState.writable!==!1&&(this._writableState.destroyed||this._writableState.errored)&&!this._writableState.finished)}}});var xr=At.destroy;Tr.prototype.destroy=function(vr,Nr){let Pr=this._writableState;return!Pr.destroyed&&(Pr.bufferedIndex<Pr.buffered.length||Pr[Mr].length)&&a.nextTick(Jr,Pr),xr.call(this,vr,Nr),this},Tr.prototype._undestroy=At.undestroy,Tr.prototype._destroy=function(vr,Nr){Nr(vr)},Tr.prototype[It.captureRejectionSymbol]=function(vr){this.destroy(vr)};var Kr;function Gr(){return Kr===void 0&&(Kr={}),Kr}Tr.fromWeb=function(vr,Nr){return Gr().newStreamWritableFromWritableStream(vr,Nr)},Tr.toWeb=function(vr){return Gr().newWritableStreamFromStreamWritable(vr)}}),Eh=M((i,e)=>{v(),m(),_();var a=Ut(),c=(we(),Z(ve)),{isReadable:h,isWritable:d,isIterable:et,isNodeStream:ft,isReadableNodeStream:gt,isWritableNodeStream:_t,isDuplexNodeStream:wt}=tt(),$t=mt(),{AbortError:It,codes:{ERR_INVALID_ARG_TYPE:Rt,ERR_INVALID_RETURN_VALUE:Tt}}=Se(),{destroyer:At}=tr(),kt=nt(),xt=hi(),{createDeferredPromise:Nt}=Je(),Ft=Ys(),jt=globalThis.Blob||c.Blob,Gt=typeof jt<"u"?function(gr){return gr instanceof jt}:function(gr){return!1},Kt=globalThis.AbortController||Hi().AbortController,{FunctionPrototypeCall:Wt}=ce(),Zt=class extends kt{constructor(gr){super(gr),(gr==null?void 0:gr.readable)===!1&&(this._readableState.readable=!1,this._readableState.ended=!0,this._readableState.endEmitted=!0),(gr==null?void 0:gr.writable)===!1&&(this._writableState.writable=!1,this._writableState.ending=!0,this._writableState.ended=!0,this._writableState.finished=!0)}};e.exports=function gr(er,mr){if(wt(er))return er;if(gt(er))return hr({readable:er});if(_t(er))return hr({writable:er});if(ft(er))return hr({writable:!1,readable:!1});if(typeof er=="function"){let{value:wr,write:Dr,final:Tr,destroy:fr}=cr(er);if(et(wr))return Ft(Zt,wr,{objectMode:!0,write:Dr,final:Tr,destroy:fr});let yr=wr==null?void 0:wr.then;if(typeof yr=="function"){let $r,Fr=Wt(yr,wr,dr=>{if(dr!=null)throw new Tt("nully","body",dr)},dr=>{At($r,dr)});return $r=new Zt({objectMode:!0,readable:!1,write:Dr,final(dr){Tr(async()=>{try{await Fr,a.nextTick(dr,null)}catch(Br){a.nextTick(dr,Br)}})},destroy:fr})}throw new Tt("Iterable, AsyncIterable or AsyncFunction",mr,wr)}if(Gt(er))return gr(er.arrayBuffer());if(et(er))return Ft(Zt,er,{objectMode:!0,writable:!1});if(typeof(er==null?void 0:er.writable)=="object"||typeof(er==null?void 0:er.readable)=="object"){let wr=er!=null&&er.readable?gt(er==null?void 0:er.readable)?er==null?void 0:er.readable:gr(er.readable):void 0,Dr=er!=null&&er.writable?_t(er==null?void 0:er.writable)?er==null?void 0:er.writable:gr(er.writable):void 0;return hr({readable:wr,writable:Dr})}let Mr=er==null?void 0:er.then;if(typeof Mr=="function"){let wr;return Wt(Mr,er,Dr=>{Dr!=null&&wr.push(Dr),wr.push(null)},Dr=>{At(wr,Dr)}),wr=new Zt({objectMode:!0,writable:!1,read(){}})}throw new Rt(mr,["Blob","ReadableStream","WritableStream","Stream","Iterable","AsyncIterable","Function","{ readable, writable } pair","Promise"],er)};function cr(gr){let{promise:er,resolve:mr}=Nt(),Mr=new Kt,wr=Mr.signal;return{value:gr(async function*(){for(;;){let Dr=er;er=null;let{chunk:Tr,done:fr,cb:yr}=await Dr;if(a.nextTick(yr),fr)return;if(wr.aborted)throw new It(void 0,{cause:wr.reason});({promise:er,resolve:mr}=Nt()),yield Tr}}(),{signal:wr}),write(Dr,Tr,fr){let yr=mr;mr=null,yr({chunk:Dr,done:!1,cb:fr})},final(Dr){let Tr=mr;mr=null,Tr({done:!0,cb:Dr})},destroy(Dr,Tr){Mr.abort(),Tr(Dr)}}}function hr(gr){let er=gr.readable&&typeof gr.readable.read!="function"?xt.wrap(gr.readable):gr.readable,mr=gr.writable,Mr=!!h(er),wr=!!d(mr),Dr,Tr,fr,yr,$r;function Fr(dr){let Br=yr;yr=null,Br?Br(dr):dr&&$r.destroy(dr)}return $r=new Zt({readableObjectMode:!!(er!=null&&er.readableObjectMode),writableObjectMode:!!(mr!=null&&mr.writableObjectMode),readable:Mr,writable:wr}),wr&&($t(mr,dr=>{wr=!1,dr&&At(er,dr),Fr(dr)}),$r._write=function(dr,Br,Hr){mr.write(dr,Br)?Hr():Dr=Hr},$r._final=function(dr){mr.end(),Tr=dr},mr.on("drain",function(){if(Dr){let dr=Dr;Dr=null,dr()}}),mr.on("finish",function(){if(Tr){let dr=Tr;Tr=null,dr()}})),Mr&&($t(er,dr=>{Mr=!1,dr&&At(er,dr),Fr(dr)}),er.on("readable",function(){if(fr){let dr=fr;fr=null,dr()}}),er.on("end",function(){$r.push(null)}),$r._read=function(){for(;;){let dr=er.read();if(dr===null){fr=$r._read;return}if(!$r.push(dr))return}}),$r._destroy=function(dr,Br){!dr&&yr!==null&&(dr=new It),fr=null,Dr=null,Tr=null,yr===null?Br(dr):(yr=Br,At(mr,dr),At(er,dr))},$r}}),nt=M((i,e)=>{v(),m(),_();var{ObjectDefineProperties:a,ObjectGetOwnPropertyDescriptor:c,ObjectKeys:h,ObjectSetPrototypeOf:d}=ce();e.exports=gt;var et=hi(),ft=uo();d(gt.prototype,et.prototype),d(gt,et);{let It=h(ft.prototype);for(let Rt=0;Rt<It.length;Rt++){let Tt=It[Rt];gt.prototype[Tt]||(gt.prototype[Tt]=ft.prototype[Tt])}}function gt(It){if(!(this instanceof gt))return new gt(It);et.call(this,It),ft.call(this,It),It?(this.allowHalfOpen=It.allowHalfOpen!==!1,It.readable===!1&&(this._readableState.readable=!1,this._readableState.ended=!0,this._readableState.endEmitted=!0),It.writable===!1&&(this._writableState.writable=!1,this._writableState.ending=!0,this._writableState.ended=!0,this._writableState.finished=!0)):this.allowHalfOpen=!0}a(gt.prototype,{writable:{__proto__:null,...c(ft.prototype,"writable")},writableHighWaterMark:{__proto__:null,...c(ft.prototype,"writableHighWaterMark")},writableObjectMode:{__proto__:null,...c(ft.prototype,"writableObjectMode")},writableBuffer:{__proto__:null,...c(ft.prototype,"writableBuffer")},writableLength:{__proto__:null,...c(ft.prototype,"writableLength")},writableFinished:{__proto__:null,...c(ft.prototype,"writableFinished")},writableCorked:{__proto__:null,...c(ft.prototype,"writableCorked")},writableEnded:{__proto__:null,...c(ft.prototype,"writableEnded")},writableNeedDrain:{__proto__:null,...c(ft.prototype,"writableNeedDrain")},destroyed:{__proto__:null,get(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set(It){this._readableState&&this._writableState&&(this._readableState.destroyed=It,this._writableState.destroyed=It)}}});var _t;function wt(){return _t===void 0&&(_t={}),_t}gt.fromWeb=function(It,Rt){return wt().newStreamDuplexFromReadableWritablePair(It,Rt)},gt.toWeb=function(It){return wt().newReadableWritablePairFromDuplex(It)};var $t;gt.from=function(It){return $t||($t=Eh()),$t(It,"body")}}),bo=M((i,e)=>{v(),m(),_();var{ObjectSetPrototypeOf:a,Symbol:c}=ce();e.exports=gt;var{ERR_METHOD_NOT_IMPLEMENTED:h}=Se().codes,d=nt(),{getHighWaterMark:et}=sn();a(gt.prototype,d.prototype),a(gt,d);var ft=c("kCallback");function gt($t){if(!(this instanceof gt))return new gt($t);let It=$t?et(this,$t,"readableHighWaterMark",!0):null;It===0&&($t={...$t,highWaterMark:null,readableHighWaterMark:It,writableHighWaterMark:$t.writableHighWaterMark||0}),d.call(this,$t),this._readableState.sync=!1,this[ft]=null,$t&&(typeof $t.transform=="function"&&(this._transform=$t.transform),typeof $t.flush=="function"&&(this._flush=$t.flush)),this.on("prefinish",wt)}function _t($t){typeof this._flush=="function"&&!this.destroyed?this._flush((It,Rt)=>{if(It){$t?$t(It):this.destroy(It);return}Rt!=null&&this.push(Rt),this.push(null),$t&&$t()}):(this.push(null),$t&&$t())}function wt(){this._final!==_t&&_t.call(this)}gt.prototype._final=_t,gt.prototype._transform=function($t,It,Rt){throw new h("_transform()")},gt.prototype._write=function($t,It,Rt){let Tt=this._readableState,At=this._writableState,kt=Tt.length;this._transform($t,It,(xt,Nt)=>{if(xt){Rt(xt);return}Nt!=null&&this.push(Nt),At.ended||kt===Tt.length||Tt.length<Tt.highWaterMark?Rt():this[ft]=Rt})},gt.prototype._read=function(){if(this[ft]){let $t=this[ft];this[ft]=null,$t()}}}),_o=M((i,e)=>{v(),m(),_();var{ObjectSetPrototypeOf:a}=ce();e.exports=h;var c=bo();a(h.prototype,c.prototype),a(h,c);function h(d){if(!(this instanceof h))return new h(d);c.call(this,d)}h.prototype._transform=function(d,et,ft){ft(null,d)}}),mn=M((i,e)=>{v(),m(),_();var a=Ut(),{ArrayIsArray:c,Promise:h,SymbolAsyncIterator:d}=ce(),et=mt(),{once:ft}=Je(),gt=tr(),_t=nt(),{aggregateTwoErrors:wt,codes:{ERR_INVALID_ARG_TYPE:$t,ERR_INVALID_RETURN_VALUE:It,ERR_MISSING_ARGS:Rt,ERR_STREAM_DESTROYED:Tt,ERR_STREAM_PREMATURE_CLOSE:At},AbortError:kt}=Se(),{validateFunction:xt,validateAbortSignal:Nt}=ui(),{isIterable:Ft,isReadable:jt,isReadableNodeStream:Gt,isNodeStream:Kt,isTransformStream:Wt,isWebStream:Zt,isReadableStream:cr,isReadableEnded:hr}=tt(),gr=globalThis.AbortController||Hi().AbortController,er,mr;function Mr(Br,Hr,Jr){let zr=!1;Br.on("close",()=>{zr=!0});let br=et(Br,{readable:Hr,writable:Jr},_r=>{zr=!_r});return{destroy:_r=>{zr||(zr=!0,gt.destroyer(Br,_r||new Tt("pipe")))},cleanup:br}}function wr(Br){return xt(Br[Br.length-1],"streams[stream.length - 1]"),Br.pop()}function Dr(Br){if(Ft(Br))return Br;if(Gt(Br))return Tr(Br);throw new $t("val",["Readable","Iterable","AsyncIterable"],Br)}async function*Tr(Br){mr||(mr=hi()),yield*mr.prototype[d].call(Br)}async function fr(Br,Hr,Jr,{end:zr}){let br,_r=null,Vr=xr=>{if(xr&&(br=xr),_r){let Kr=_r;_r=null,Kr()}},lr=()=>new h((xr,Kr)=>{br?Kr(br):_r=()=>{br?Kr(br):xr()}});Hr.on("drain",Vr);let Cr=et(Hr,{readable:!1},Vr);try{Hr.writableNeedDrain&&await lr();for await(let xr of Br)Hr.write(xr)||await lr();zr&&Hr.end(),await lr(),Jr()}catch(xr){Jr(br!==xr?wt(br,xr):xr)}finally{Cr(),Hr.off("drain",Vr)}}async function yr(Br,Hr,Jr,{end:zr}){Wt(Hr)&&(Hr=Hr.writable);let br=Hr.getWriter();try{for await(let _r of Br)await br.ready,br.write(_r).catch(()=>{});await br.ready,zr&&await br.close(),Jr()}catch(_r){try{await br.abort(_r),Jr(_r)}catch(Vr){Jr(Vr)}}}function $r(...Br){return Fr(Br,ft(wr(Br)))}function Fr(Br,Hr,Jr){if(Br.length===1&&c(Br[0])&&(Br=Br[0]),Br.length<2)throw new Rt("streams");let zr=new gr,br=zr.signal,_r=Jr==null?void 0:Jr.signal,Vr=[];Nt(_r,"options.signal");function lr(){Nr(new kt)}_r==null||_r.addEventListener("abort",lr);let Cr,xr,Kr=[],Gr=0;function vr(Or){Nr(Or,--Gr===0)}function Nr(Or,Xr){if(Or&&(!Cr||Cr.code==="ERR_STREAM_PREMATURE_CLOSE")&&(Cr=Or),!(!Cr&&!Xr)){for(;Kr.length;)Kr.shift()(Cr);_r==null||_r.removeEventListener("abort",lr),zr.abort(),Xr&&(Cr||Vr.forEach(hn=>hn()),a.nextTick(Hr,Cr,xr))}}let Pr;for(let Or=0;Or<Br.length;Or++){let Xr=Br[Or],hn=Or<Br.length-1,pn=Or>0,vn=hn||(Jr==null?void 0:Jr.end)!==!1,Tn=Or===Br.length-1;if(Kt(Xr)){let Ht=function(Vt){Vt&&Vt.name!=="AbortError"&&Vt.code!=="ERR_STREAM_PREMATURE_CLOSE"&&vr(Vt)};if(vn){let{destroy:Vt,cleanup:Xt}=Mr(Xr,hn,pn);Kr.push(Vt),jt(Xr)&&Tn&&Vr.push(Xt)}Xr.on("error",Ht),jt(Xr)&&Tn&&Vr.push(()=>{Xr.removeListener("error",Ht)})}if(Or===0)if(typeof Xr=="function"){if(Pr=Xr({signal:br}),!Ft(Pr))throw new It("Iterable, AsyncIterable or Stream","source",Pr)}else Ft(Xr)||Gt(Xr)||Wt(Xr)?Pr=Xr:Pr=_t.from(Xr);else if(typeof Xr=="function"){if(Wt(Pr)){var en;Pr=Dr((en=Pr)===null||en===void 0?void 0:en.readable)}else Pr=Dr(Pr);if(Pr=Xr(Pr,{signal:br}),hn){if(!Ft(Pr,!0))throw new It("AsyncIterable",`transform[${Or-1}]`,Pr)}else{var Wr;er||(er=_o());let Ht=new er({objectMode:!0}),Vt=(Wr=Pr)===null||Wr===void 0?void 0:Wr.then;if(typeof Vt=="function")Gr++,Vt.call(Pr,Sr=>{xr=Sr,Sr!=null&&Ht.write(Sr),vn&&Ht.end(),a.nextTick(vr)},Sr=>{Ht.destroy(Sr),a.nextTick(vr,Sr)});else if(Ft(Pr,!0))Gr++,fr(Pr,Ht,vr,{end:vn});else if(cr(Pr)||Wt(Pr)){let Sr=Pr.readable||Pr;Gr++,fr(Sr,Ht,vr,{end:vn})}else throw new It("AsyncIterable or Promise","destination",Pr);Pr=Ht;let{destroy:Xt,cleanup:Er}=Mr(Pr,!1,!0);Kr.push(Xt),Tn&&Vr.push(Er)}}else if(Kt(Xr)){if(Gt(Pr)){Gr+=2;let Ht=dr(Pr,Xr,vr,{end:vn});jt(Xr)&&Tn&&Vr.push(Ht)}else if(Wt(Pr)||cr(Pr)){let Ht=Pr.readable||Pr;Gr++,fr(Ht,Xr,vr,{end:vn})}else if(Ft(Pr))Gr++,fr(Pr,Xr,vr,{end:vn});else throw new $t("val",["Readable","Iterable","AsyncIterable","ReadableStream","TransformStream"],Pr);Pr=Xr}else if(Zt(Xr)){if(Gt(Pr))Gr++,yr(Dr(Pr),Xr,vr,{end:vn});else if(cr(Pr)||Ft(Pr))Gr++,yr(Pr,Xr,vr,{end:vn});else if(Wt(Pr))Gr++,yr(Pr.readable,Xr,vr,{end:vn});else throw new $t("val",["Readable","Iterable","AsyncIterable","ReadableStream","TransformStream"],Pr);Pr=Xr}else Pr=_t.from(Xr)}return(br!=null&&br.aborted||_r!=null&&_r.aborted)&&a.nextTick(lr),Pr}function dr(Br,Hr,Jr,{end:zr}){let br=!1;if(Hr.on("close",()=>{br||Jr(new At)}),Br.pipe(Hr,{end:!1}),zr){let _r=function(){br=!0,Hr.end()};hr(Br)?a.nextTick(_r):Br.once("end",_r)}else Jr();return et(Br,{readable:!0,writable:!1},_r=>{let Vr=Br._readableState;_r&&_r.code==="ERR_STREAM_PREMATURE_CLOSE"&&Vr&&Vr.ended&&!Vr.errored&&!Vr.errorEmitted?Br.once("end",Jr).once("error",Jr):Jr(_r)}),et(Hr,{readable:!1,writable:!0},Jr)}e.exports={pipelineImpl:Fr,pipeline:$r}}),Bo=M((i,e)=>{v(),m(),_();var{pipeline:a}=mn(),c=nt(),{destroyer:h}=tr(),{isNodeStream:d,isReadable:et,isWritable:ft,isWebStream:gt,isTransformStream:_t,isWritableStream:wt,isReadableStream:$t}=tt(),{AbortError:It,codes:{ERR_INVALID_ARG_VALUE:Rt,ERR_MISSING_ARGS:Tt}}=Se(),At=mt();e.exports=function(...kt){if(kt.length===0)throw new Tt("streams");if(kt.length===1)return c.from(kt[0]);let xt=[...kt];if(typeof kt[0]=="function"&&(kt[0]=c.from(kt[0])),typeof kt[kt.length-1]=="function"){let er=kt.length-1;kt[er]=c.from(kt[er])}for(let er=0;er<kt.length;++er)if(!(!d(kt[er])&&!gt(kt[er]))){if(er<kt.length-1&&!(et(kt[er])||$t(kt[er])||_t(kt[er])))throw new Rt(`streams[${er}]`,xt[er],"must be readable");if(er>0&&!(ft(kt[er])||wt(kt[er])||_t(kt[er])))throw new Rt(`streams[${er}]`,xt[er],"must be writable")}let Nt,Ft,jt,Gt,Kt;function Wt(er){let mr=Gt;Gt=null,mr?mr(er):er?Kt.destroy(er):!gr&&!hr&&Kt.destroy()}let Zt=kt[0],cr=a(kt,Wt),hr=!!(ft(Zt)||wt(Zt)||_t(Zt)),gr=!!(et(cr)||$t(cr)||_t(cr));if(Kt=new c({writableObjectMode:!!(Zt!=null&&Zt.writableObjectMode),readableObjectMode:!!(cr!=null&&cr.writableObjectMode),writable:hr,readable:gr}),hr){if(d(Zt))Kt._write=function(mr,Mr,wr){Zt.write(mr,Mr)?wr():Nt=wr},Kt._final=function(mr){Zt.end(),Ft=mr},Zt.on("drain",function(){if(Nt){let mr=Nt;Nt=null,mr()}});else if(gt(Zt)){let mr=(_t(Zt)?Zt.writable:Zt).getWriter();Kt._write=async function(Mr,wr,Dr){try{await mr.ready,mr.write(Mr).catch(()=>{}),Dr()}catch(Tr){Dr(Tr)}},Kt._final=async function(Mr){try{await mr.ready,mr.close().catch(()=>{}),Ft=Mr}catch(wr){Mr(wr)}}}let er=_t(cr)?cr.readable:cr;At(er,()=>{if(Ft){let mr=Ft;Ft=null,mr()}})}if(gr){if(d(cr))cr.on("readable",function(){if(jt){let er=jt;jt=null,er()}}),cr.on("end",function(){Kt.push(null)}),Kt._read=function(){for(;;){let er=cr.read();if(er===null){jt=Kt._read;return}if(!Kt.push(er))return}};else if(gt(cr)){let er=(_t(cr)?cr.readable:cr).getReader();Kt._read=async function(){for(;;)try{let{value:mr,done:Mr}=await er.read();if(!Kt.push(mr))return;if(Mr){Kt.push(null);return}}catch{return}}}}return Kt._destroy=function(er,mr){!er&&Gt!==null&&(er=new It),jt=null,Nt=null,Ft=null,Gt===null?mr(er):(Gt=mr,d(cr)&&h(cr,er))},Kt}}),Gh=M((i,e)=>{v(),m(),_();var a=globalThis.AbortController||Hi().AbortController,{codes:{ERR_INVALID_ARG_VALUE:c,ERR_INVALID_ARG_TYPE:h,ERR_MISSING_ARGS:d,ERR_OUT_OF_RANGE:et},AbortError:ft}=Se(),{validateAbortSignal:gt,validateInteger:_t,validateObject:wt}=ui(),$t=ce().Symbol("kWeak"),{finished:It}=mt(),Rt=Bo(),{addAbortSignalNoValidate:Tt}=fi(),{isWritable:At,isNodeStream:kt}=tt(),{ArrayPrototypePush:xt,MathFloor:Nt,Number:Ft,NumberIsNaN:jt,Promise:Gt,PromiseReject:Kt,PromisePrototypeThen:Wt,Symbol:Zt}=ce(),cr=Zt("kEmpty"),hr=Zt("kEof");function gr(zr,br){if(br!=null&&wt(br,"options"),(br==null?void 0:br.signal)!=null&&gt(br.signal,"options.signal"),kt(zr)&&!At(zr))throw new c("stream",zr,"must be writable");let _r=Rt(this,zr);return br!=null&&br.signal&&Tt(br.signal,_r),_r}function er(zr,br){if(typeof zr!="function")throw new h("fn",["Function","AsyncFunction"],zr);br!=null&&wt(br,"options"),(br==null?void 0:br.signal)!=null&&gt(br.signal,"options.signal");let _r=1;return(br==null?void 0:br.concurrency)!=null&&(_r=Nt(br.concurrency)),_t(_r,"concurrency",1),(async function*(){var Vr,lr;let Cr=new a,xr=this,Kr=[],Gr=Cr.signal,vr={signal:Gr},Nr=()=>Cr.abort();br!=null&&(Vr=br.signal)!==null&&Vr!==void 0&&Vr.aborted&&Nr(),br==null||(lr=br.signal)===null||lr===void 0||lr.addEventListener("abort",Nr);let Pr,en,Wr=!1;function Or(){Wr=!0}async function Xr(){try{for await(let vn of xr){var hn;if(Wr)return;if(Gr.aborted)throw new ft;try{vn=zr(vn,vr)}catch(Tn){vn=Kt(Tn)}vn!==cr&&(typeof((hn=vn)===null||hn===void 0?void 0:hn.catch)=="function"&&vn.catch(Or),Kr.push(vn),Pr&&(Pr(),Pr=null),!Wr&&Kr.length&&Kr.length>=_r&&await new Gt(Tn=>{en=Tn}))}Kr.push(hr)}catch(vn){let Tn=Kt(vn);Wt(Tn,void 0,Or),Kr.push(Tn)}finally{var pn;Wr=!0,Pr&&(Pr(),Pr=null),br==null||(pn=br.signal)===null||pn===void 0||pn.removeEventListener("abort",Nr)}}Xr();try{for(;;){for(;Kr.length>0;){let hn=await Kr[0];if(hn===hr)return;if(Gr.aborted)throw new ft;hn!==cr&&(yield hn),Kr.shift(),en&&(en(),en=null)}await new Gt(hn=>{Pr=hn})}}finally{Cr.abort(),Wr=!0,en&&(en(),en=null)}}).call(this)}function mr(zr=void 0){return zr!=null&&wt(zr,"options"),(zr==null?void 0:zr.signal)!=null&&gt(zr.signal,"options.signal"),(async function*(){let br=0;for await(let Vr of this){var _r;if(zr!=null&&(_r=zr.signal)!==null&&_r!==void 0&&_r.aborted)throw new ft({cause:zr.signal.reason});yield[br++,Vr]}}).call(this)}async function Mr(zr,br=void 0){for await(let _r of fr.call(this,zr,br))return!0;return!1}async function wr(zr,br=void 0){if(typeof zr!="function")throw new h("fn",["Function","AsyncFunction"],zr);return!await Mr.call(this,async(..._r)=>!await zr(..._r),br)}async function Dr(zr,br){for await(let _r of fr.call(this,zr,br))return _r}async function Tr(zr,br){if(typeof zr!="function")throw new h("fn",["Function","AsyncFunction"],zr);async function _r(Vr,lr){return await zr(Vr,lr),cr}for await(let Vr of er.call(this,_r,br));}function fr(zr,br){if(typeof zr!="function")throw new h("fn",["Function","AsyncFunction"],zr);async function _r(Vr,lr){return await zr(Vr,lr)?Vr:cr}return er.call(this,_r,br)}var yr=class extends d{constructor(){super("reduce"),this.message="Reduce of an empty stream requires an initial value"}};async function $r(zr,br,_r){var Vr;if(typeof zr!="function")throw new h("reducer",["Function","AsyncFunction"],zr);_r!=null&&wt(_r,"options"),(_r==null?void 0:_r.signal)!=null&&gt(_r.signal,"options.signal");let lr=arguments.length>1;if(_r!=null&&(Vr=_r.signal)!==null&&Vr!==void 0&&Vr.aborted){let vr=new ft(void 0,{cause:_r.signal.reason});throw this.once("error",()=>{}),await It(this.destroy(vr)),vr}let Cr=new a,xr=Cr.signal;if(_r!=null&&_r.signal){let vr={once:!0,[$t]:this};_r.signal.addEventListener("abort",()=>Cr.abort(),vr)}let Kr=!1;try{for await(let vr of this){var Gr;if(Kr=!0,_r!=null&&(Gr=_r.signal)!==null&&Gr!==void 0&&Gr.aborted)throw new ft;lr?br=await zr(br,vr,{signal:xr}):(br=vr,lr=!0)}if(!Kr&&!lr)throw new yr}finally{Cr.abort()}return br}async function Fr(zr){zr!=null&&wt(zr,"options"),(zr==null?void 0:zr.signal)!=null&&gt(zr.signal,"options.signal");let br=[];for await(let Vr of this){var _r;if(zr!=null&&(_r=zr.signal)!==null&&_r!==void 0&&_r.aborted)throw new ft(void 0,{cause:zr.signal.reason});xt(br,Vr)}return br}function dr(zr,br){let _r=er.call(this,zr,br);return(async function*(){for await(let Vr of _r)yield*Vr}).call(this)}function Br(zr){if(zr=Ft(zr),jt(zr))return 0;if(zr<0)throw new et("number",">= 0",zr);return zr}function Hr(zr,br=void 0){return br!=null&&wt(br,"options"),(br==null?void 0:br.signal)!=null&&gt(br.signal,"options.signal"),zr=Br(zr),(async function*(){var _r;if(br!=null&&(_r=br.signal)!==null&&_r!==void 0&&_r.aborted)throw new ft;for await(let lr of this){var Vr;if(br!=null&&(Vr=br.signal)!==null&&Vr!==void 0&&Vr.aborted)throw new ft;zr--<=0&&(yield lr)}}).call(this)}function Jr(zr,br=void 0){return br!=null&&wt(br,"options"),(br==null?void 0:br.signal)!=null&&gt(br.signal,"options.signal"),zr=Br(zr),(async function*(){var _r;if(br!=null&&(_r=br.signal)!==null&&_r!==void 0&&_r.aborted)throw new ft;for await(let lr of this){var Vr;if(br!=null&&(Vr=br.signal)!==null&&Vr!==void 0&&Vr.aborted)throw new ft;if(zr-- >0)yield lr;else return}}).call(this)}e.exports.streamReturningOperators={asIndexedPairs:mr,drop:Hr,filter:fr,flatMap:dr,map:er,take:Jr,compose:gr},e.exports.promiseReturningOperators={every:wr,forEach:Tr,reduce:$r,toArray:Fr,some:Mr,find:Dr}}),xo=M((i,e)=>{v(),m(),_();var{ArrayPrototypePop:a,Promise:c}=ce(),{isIterable:h,isNodeStream:d,isWebStream:et}=tt(),{pipelineImpl:ft}=mn(),{finished:gt}=mt();Mo();function _t(...wt){return new c(($t,It)=>{let Rt,Tt,At=wt[wt.length-1];if(At&&typeof At=="object"&&!d(At)&&!h(At)&&!et(At)){let kt=a(wt);Rt=kt.signal,Tt=kt.end}ft(wt,(kt,xt)=>{kt?It(kt):$t(xt)},{signal:Rt,end:Tt})})}e.exports={finished:gt,pipeline:_t}}),Mo=M((i,e)=>{v(),m(),_();var{Buffer:a}=(we(),Z(ve)),{ObjectDefineProperty:c,ObjectKeys:h,ReflectApply:d}=ce(),{promisify:{custom:et}}=Je(),{streamReturningOperators:ft,promiseReturningOperators:gt}=Gh(),{codes:{ERR_ILLEGAL_CONSTRUCTOR:_t}}=Se(),wt=Bo(),{pipeline:$t}=mn(),{destroyer:It}=tr(),Rt=mt(),Tt=xo(),At=tt(),kt=e.exports=tn().Stream;kt.isDisturbed=At.isDisturbed,kt.isErrored=At.isErrored,kt.isReadable=At.isReadable,kt.Readable=hi();for(let Nt of h(ft)){let Ft=function(...Gt){if(new.target)throw _t();return kt.Readable.from(d(jt,this,Gt))},jt=ft[Nt];c(Ft,"name",{__proto__:null,value:jt.name}),c(Ft,"length",{__proto__:null,value:jt.length}),c(kt.Readable.prototype,Nt,{__proto__:null,value:Ft,enumerable:!1,configurable:!0,writable:!0})}for(let Nt of h(gt)){let Ft=function(...Gt){if(new.target)throw _t();return d(jt,this,Gt)},jt=gt[Nt];c(Ft,"name",{__proto__:null,value:jt.name}),c(Ft,"length",{__proto__:null,value:jt.length}),c(kt.Readable.prototype,Nt,{__proto__:null,value:Ft,enumerable:!1,configurable:!0,writable:!0})}kt.Writable=uo(),kt.Duplex=nt(),kt.Transform=bo(),kt.PassThrough=_o(),kt.pipeline=$t;var{addAbortSignal:xt}=fi();kt.addAbortSignal=xt,kt.finished=Rt,kt.destroy=It,kt.compose=wt,c(kt,"promises",{__proto__:null,configurable:!0,enumerable:!0,get(){return Tt}}),c($t,et,{__proto__:null,enumerable:!0,get(){return Tt.pipeline}}),c(Rt,et,{__proto__:null,enumerable:!0,get(){return Tt.finished}}),kt.Stream=kt,kt._isUint8Array=function(Nt){return Nt instanceof Uint8Array},kt._uint8ArrayToBuffer=function(Nt){return a.from(Nt.buffer,Nt.byteOffset,Nt.byteLength)}}),Dt=M((i,e)=>{v(),m(),_();var a=Mo(),c=xo(),h=a.Readable.destroy;e.exports=a.Readable,e.exports._uint8ArrayToBuffer=a._uint8ArrayToBuffer,e.exports._isUint8Array=a._isUint8Array,e.exports.isDisturbed=a.isDisturbed,e.exports.isErrored=a.isErrored,e.exports.isReadable=a.isReadable,e.exports.Readable=a.Readable,e.exports.Writable=a.Writable,e.exports.Duplex=a.Duplex,e.exports.Transform=a.Transform,e.exports.PassThrough=a.PassThrough,e.exports.addAbortSignal=a.addAbortSignal,e.exports.finished=a.finished,e.exports.destroy=a.destroy,e.exports.destroy=h,e.exports.pipeline=a.pipeline,e.exports.compose=a.compose,Object.defineProperty(a,"promises",{configurable:!0,enumerable:!0,get(){return c}}),e.exports.Stream=a.Stream,e.exports.default=e.exports}),sd=M((i,e)=>{v(),m(),_(),typeof Object.create=="function"?e.exports=function(a,c){c&&(a.super_=c,a.prototype=Object.create(c.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(a,c){if(c){a.super_=c;var h=function(){};h.prototype=c.prototype,a.prototype=new h,a.prototype.constructor=a}}}),ld=M((i,e)=>{v(),m(),_();var{Buffer:a}=(we(),Z(ve)),c=Symbol.for("BufferList");function h(d){if(!(this instanceof h))return new h(d);h._init.call(this,d)}h._init=function(d){Object.defineProperty(this,c,{value:!0}),this._bufs=[],this.length=0,d&&this.append(d)},h.prototype._new=function(d){return new h(d)},h.prototype._offset=function(d){if(d===0)return[0,0];let et=0;for(let ft=0;ft<this._bufs.length;ft++){let gt=et+this._bufs[ft].length;if(d<gt||ft===this._bufs.length-1)return[ft,d-et];et=gt}},h.prototype._reverseOffset=function(d){let et=d[0],ft=d[1];for(let gt=0;gt<et;gt++)ft+=this._bufs[gt].length;return ft},h.prototype.get=function(d){if(d>this.length||d<0)return;let et=this._offset(d);return this._bufs[et[0]][et[1]]},h.prototype.slice=function(d,et){return typeof d=="number"&&d<0&&(d+=this.length),typeof et=="number"&&et<0&&(et+=this.length),this.copy(null,0,d,et)},h.prototype.copy=function(d,et,ft,gt){if((typeof ft!="number"||ft<0)&&(ft=0),(typeof gt!="number"||gt>this.length)&&(gt=this.length),ft>=this.length||gt<=0)return d||a.alloc(0);let _t=!!d,wt=this._offset(ft),$t=gt-ft,It=$t,Rt=_t&&et||0,Tt=wt[1];if(ft===0&&gt===this.length){if(!_t)return this._bufs.length===1?this._bufs[0]:a.concat(this._bufs,this.length);for(let At=0;At<this._bufs.length;At++)this._bufs[At].copy(d,Rt),Rt+=this._bufs[At].length;return d}if(It<=this._bufs[wt[0]].length-Tt)return _t?this._bufs[wt[0]].copy(d,et,Tt,Tt+It):this._bufs[wt[0]].slice(Tt,Tt+It);_t||(d=a.allocUnsafe($t));for(let At=wt[0];At<this._bufs.length;At++){let kt=this._bufs[At].length-Tt;if(It>kt)this._bufs[At].copy(d,Rt,Tt),Rt+=kt;else{this._bufs[At].copy(d,Rt,Tt,Tt+It),Rt+=kt;break}It-=kt,Tt&&(Tt=0)}return d.length>Rt?d.slice(0,Rt):d},h.prototype.shallowSlice=function(d,et){if(d=d||0,et=typeof et!="number"?this.length:et,d<0&&(d+=this.length),et<0&&(et+=this.length),d===et)return this._new();let ft=this._offset(d),gt=this._offset(et),_t=this._bufs.slice(ft[0],gt[0]+1);return gt[1]===0?_t.pop():_t[_t.length-1]=_t[_t.length-1].slice(0,gt[1]),ft[1]!==0&&(_t[0]=_t[0].slice(ft[1])),this._new(_t)},h.prototype.toString=function(d,et,ft){return this.slice(et,ft).toString(d)},h.prototype.consume=function(d){if(d=Math.trunc(d),Number.isNaN(d)||d<=0)return this;for(;this._bufs.length;)if(d>=this._bufs[0].length)d-=this._bufs[0].length,this.length-=this._bufs[0].length,this._bufs.shift();else{this._bufs[0]=this._bufs[0].slice(d),this.length-=d;break}return this},h.prototype.duplicate=function(){let d=this._new();for(let et=0;et<this._bufs.length;et++)d.append(this._bufs[et]);return d},h.prototype.append=function(d){if(d==null)return this;if(d.buffer)this._appendBuffer(a.from(d.buffer,d.byteOffset,d.byteLength));else if(Array.isArray(d))for(let et=0;et<d.length;et++)this.append(d[et]);else if(this._isBufferList(d))for(let et=0;et<d._bufs.length;et++)this.append(d._bufs[et]);else typeof d=="number"&&(d=d.toString()),this._appendBuffer(a.from(d));return this},h.prototype._appendBuffer=function(d){this._bufs.push(d),this.length+=d.length},h.prototype.indexOf=function(d,et,ft){if(ft===void 0&&typeof et=="string"&&(ft=et,et=void 0),typeof d=="function"||Array.isArray(d))throw new TypeError('The "value" argument must be one of type string, Buffer, BufferList, or Uint8Array.');if(typeof d=="number"?d=a.from([d]):typeof d=="string"?d=a.from(d,ft):this._isBufferList(d)?d=d.slice():Array.isArray(d.buffer)?d=a.from(d.buffer,d.byteOffset,d.byteLength):a.isBuffer(d)||(d=a.from(d)),et=Number(et||0),isNaN(et)&&(et=0),et<0&&(et=this.length+et),et<0&&(et=0),d.length===0)return et>this.length?this.length:et;let gt=this._offset(et),_t=gt[0],wt=gt[1];for(;_t<this._bufs.length;_t++){let $t=this._bufs[_t];for(;wt<$t.length;)if($t.length-wt>=d.length){let It=$t.indexOf(d,wt);if(It!==-1)return this._reverseOffset([_t,It]);wt=$t.length-d.length+1}else{let It=this._reverseOffset([_t,wt]);if(this._match(It,d))return It;wt++}wt=0}return-1},h.prototype._match=function(d,et){if(this.length-d<et.length)return!1;for(let ft=0;ft<et.length;ft++)if(this.get(d+ft)!==et[ft])return!1;return!0},function(){let d={readDoubleBE:8,readDoubleLE:8,readFloatBE:4,readFloatLE:4,readBigInt64BE:8,readBigInt64LE:8,readBigUInt64BE:8,readBigUInt64LE:8,readInt32BE:4,readInt32LE:4,readUInt32BE:4,readUInt32LE:4,readInt16BE:2,readInt16LE:2,readUInt16BE:2,readUInt16LE:2,readInt8:1,readUInt8:1,readIntBE:null,readIntLE:null,readUIntBE:null,readUIntLE:null};for(let et in d)(function(ft){d[ft]===null?h.prototype[ft]=function(gt,_t){return this.slice(gt,gt+_t)[ft](0,_t)}:h.prototype[ft]=function(gt=0){return this.slice(gt,gt+d[ft])[ft](0)}})(et)}(),h.prototype._isBufferList=function(d){return d instanceof h||h.isBufferList(d)},h.isBufferList=function(d){return d!=null&&d[c]},e.exports=h}),ud=M((i,e)=>{v(),m(),_();var a=Dt().Duplex,c=sd(),h=ld();function d(et){if(!(this instanceof d))return new d(et);if(typeof et=="function"){this._callback=et;let ft=(function(gt){this._callback&&(this._callback(gt),this._callback=null)}).bind(this);this.on("pipe",function(gt){gt.on("error",ft)}),this.on("unpipe",function(gt){gt.removeListener("error",ft)}),et=null}h._init.call(this,et),a.call(this)}c(d,a),Object.assign(d.prototype,h.prototype),d.prototype._new=function(et){return new d(et)},d.prototype._write=function(et,ft,gt){this._appendBuffer(et),typeof gt=="function"&&gt()},d.prototype._read=function(et){if(!this.length)return this.push(null);et=Math.min(et,this.length),this.push(this.slice(0,et)),this.consume(et)},d.prototype.end=function(et){a.prototype.end.call(this,et),this._callback&&(this._callback(null,this.slice()),this._callback=null)},d.prototype._destroy=function(et,ft){this._bufs.length=0,this.length=0,ft(et)},d.prototype._isBufferList=function(et){return et instanceof d||et instanceof h||d.isBufferList(et)},d.isBufferList=h.isBufferList,e.exports=d,e.exports.BufferListStream=d,e.exports.BufferList=h}),cd=M((i,e)=>{v(),m(),_();var a=class{constructor(){this.cmd=null,this.retain=!1,this.qos=0,this.dup=!1,this.length=-1,this.topic=null,this.payload=null}};e.exports=a}),Fo=M((i,e)=>{v(),m(),_();var a=e.exports,{Buffer:c}=(we(),Z(ve));a.types={0:"reserved",1:"connect",2:"connack",3:"publish",4:"puback",5:"pubrec",6:"pubrel",7:"pubcomp",8:"subscribe",9:"suback",10:"unsubscribe",11:"unsuback",12:"pingreq",13:"pingresp",14:"disconnect",15:"auth"},a.requiredHeaderFlags={1:0,2:0,4:0,5:0,6:2,7:0,8:2,9:0,10:2,11:0,12:0,13:0,14:0,15:0},a.requiredHeaderFlagsErrors={};for(let d in a.requiredHeaderFlags){let et=a.requiredHeaderFlags[d];a.requiredHeaderFlagsErrors[d]="Invalid header flag bits, must be 0x"+et.toString(16)+" for "+a.types[d]+" packet"}a.codes={};for(let d in a.types){let et=a.types[d];a.codes[et]=d}a.CMD_SHIFT=4,a.CMD_MASK=240,a.DUP_MASK=8,a.QOS_MASK=3,a.QOS_SHIFT=1,a.RETAIN_MASK=1,a.VARBYTEINT_MASK=127,a.VARBYTEINT_FIN_MASK=128,a.VARBYTEINT_MAX=268435455,a.SESSIONPRESENT_MASK=1,a.SESSIONPRESENT_HEADER=c.from([a.SESSIONPRESENT_MASK]),a.CONNACK_HEADER=c.from([a.codes.connack<<a.CMD_SHIFT]),a.USERNAME_MASK=128,a.PASSWORD_MASK=64,a.WILL_RETAIN_MASK=32,a.WILL_QOS_MASK=24,a.WILL_QOS_SHIFT=3,a.WILL_FLAG_MASK=4,a.CLEAN_SESSION_MASK=2,a.CONNECT_HEADER=c.from([a.codes.connect<<a.CMD_SHIFT]),a.properties={sessionExpiryInterval:17,willDelayInterval:24,receiveMaximum:33,maximumPacketSize:39,topicAliasMaximum:34,requestResponseInformation:25,requestProblemInformation:23,userProperties:38,authenticationMethod:21,authenticationData:22,payloadFormatIndicator:1,messageExpiryInterval:2,contentType:3,responseTopic:8,correlationData:9,maximumQoS:36,retainAvailable:37,assignedClientIdentifier:18,reasonString:31,wildcardSubscriptionAvailable:40,subscriptionIdentifiersAvailable:41,sharedSubscriptionAvailable:42,serverKeepAlive:19,responseInformation:26,serverReference:28,topicAlias:35,subscriptionIdentifier:11},a.propertiesCodes={};for(let d in a.properties){let et=a.properties[d];a.propertiesCodes[et]=d}a.propertiesTypes={sessionExpiryInterval:"int32",willDelayInterval:"int32",receiveMaximum:"int16",maximumPacketSize:"int32",topicAliasMaximum:"int16",requestResponseInformation:"byte",requestProblemInformation:"byte",userProperties:"pair",authenticationMethod:"string",authenticationData:"binary",payloadFormatIndicator:"byte",messageExpiryInterval:"int32",contentType:"string",responseTopic:"string",correlationData:"binary",maximumQoS:"int8",retainAvailable:"byte",assignedClientIdentifier:"string",reasonString:"string",wildcardSubscriptionAvailable:"byte",subscriptionIdentifiersAvailable:"byte",sharedSubscriptionAvailable:"byte",serverKeepAlive:"int16",responseInformation:"string",serverReference:"string",topicAlias:"int16",subscriptionIdentifier:"var"};function h(d){return[0,1,2].map(et=>[0,1].map(ft=>[0,1].map(gt=>{let _t=c.alloc(1);return _t.writeUInt8(a.codes[d]<<a.CMD_SHIFT|(ft?a.DUP_MASK:0)|et<<a.QOS_SHIFT|gt,0,!0),_t})))}a.PUBLISH_HEADER=h("publish"),a.SUBSCRIBE_HEADER=h("subscribe"),a.SUBSCRIBE_OPTIONS_QOS_MASK=3,a.SUBSCRIBE_OPTIONS_NL_MASK=1,a.SUBSCRIBE_OPTIONS_NL_SHIFT=2,a.SUBSCRIBE_OPTIONS_RAP_MASK=1,a.SUBSCRIBE_OPTIONS_RAP_SHIFT=3,a.SUBSCRIBE_OPTIONS_RH_MASK=3,a.SUBSCRIBE_OPTIONS_RH_SHIFT=4,a.SUBSCRIBE_OPTIONS_RH=[0,16,32],a.SUBSCRIBE_OPTIONS_NL=4,a.SUBSCRIBE_OPTIONS_RAP=8,a.SUBSCRIBE_OPTIONS_QOS=[0,1,2],a.UNSUBSCRIBE_HEADER=h("unsubscribe"),a.ACKS={unsuback:h("unsuback"),puback:h("puback"),pubcomp:h("pubcomp"),pubrel:h("pubrel"),pubrec:h("pubrec")},a.SUBACK_HEADER=c.from([a.codes.suback<<a.CMD_SHIFT]),a.VERSION3=c.from([3]),a.VERSION4=c.from([4]),a.VERSION5=c.from([5]),a.VERSION131=c.from([131]),a.VERSION132=c.from([132]),a.QOS=[0,1,2].map(d=>c.from([d])),a.EMPTY={pingreq:c.from([a.codes.pingreq<<4,0]),pingresp:c.from([a.codes.pingresp<<4,0]),disconnect:c.from([a.codes.disconnect<<4,0])},a.MQTT5_PUBACK_PUBREC_CODES={0:"Success",16:"No matching subscribers",128:"Unspecified error",131:"Implementation specific error",135:"Not authorized",144:"Topic Name invalid",145:"Packet identifier in use",151:"Quota exceeded",153:"Payload format invalid"},a.MQTT5_PUBREL_PUBCOMP_CODES={0:"Success",146:"Packet Identifier not found"},a.MQTT5_SUBACK_CODES={0:"Granted QoS 0",1:"Granted QoS 1",2:"Granted QoS 2",128:"Unspecified error",131:"Implementation specific error",135:"Not authorized",143:"Topic Filter invalid",145:"Packet Identifier in use",151:"Quota exceeded",158:"Shared Subscriptions not supported",161:"Subscription Identifiers not supported",162:"Wildcard Subscriptions not supported"},a.MQTT5_UNSUBACK_CODES={0:"Success",17:"No subscription existed",128:"Unspecified error",131:"Implementation specific error",135:"Not authorized",143:"Topic Filter invalid",145:"Packet Identifier in use"},a.MQTT5_DISCONNECT_CODES={0:"Normal disconnection",4:"Disconnect with Will Message",128:"Unspecified error",129:"Malformed Packet",130:"Protocol Error",131:"Implementation specific error",135:"Not authorized",137:"Server busy",139:"Server shutting down",141:"Keep Alive timeout",142:"Session taken over",143:"Topic Filter invalid",144:"Topic Name invalid",147:"Receive Maximum exceeded",148:"Topic Alias invalid",149:"Packet too large",150:"Message rate too high",151:"Quota exceeded",152:"Administrative action",153:"Payload format invalid",154:"Retain not supported",155:"QoS not supported",156:"Use another server",157:"Server moved",158:"Shared Subscriptions not supported",159:"Connection rate exceeded",160:"Maximum connect time",161:"Subscription Identifiers not supported",162:"Wildcard Subscriptions not supported"},a.MQTT5_AUTH_CODES={0:"Success",24:"Continue authentication",25:"Re-authenticate"}}),pd=M((i,e)=>{v(),m(),_();var a=1e3,c=a*60,h=c*60,d=h*24,et=d*7,ft=d*365.25;e.exports=function(It,Rt){Rt=Rt||{};var Tt=typeof It;if(Tt==="string"&&It.length>0)return gt(It);if(Tt==="number"&&isFinite(It))return Rt.long?wt(It):_t(It);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(It))};function gt(It){if(It=String(It),!(It.length>100)){var Rt=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(It);if(Rt){var Tt=parseFloat(Rt[1]),At=(Rt[2]||"ms").toLowerCase();switch(At){case"years":case"year":case"yrs":case"yr":case"y":return Tt*ft;case"weeks":case"week":case"w":return Tt*et;case"days":case"day":case"d":return Tt*d;case"hours":case"hour":case"hrs":case"hr":case"h":return Tt*h;case"minutes":case"minute":case"mins":case"min":case"m":return Tt*c;case"seconds":case"second":case"secs":case"sec":case"s":return Tt*a;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return Tt;default:return}}}}function _t(It){var Rt=Math.abs(It);return Rt>=d?Math.round(It/d)+"d":Rt>=h?Math.round(It/h)+"h":Rt>=c?Math.round(It/c)+"m":Rt>=a?Math.round(It/a)+"s":It+"ms"}function wt(It){var Rt=Math.abs(It);return Rt>=d?$t(It,Rt,d,"day"):Rt>=h?$t(It,Rt,h,"hour"):Rt>=c?$t(It,Rt,c,"minute"):Rt>=a?$t(It,Rt,a,"second"):It+" ms"}function $t(It,Rt,Tt,At){var kt=Rt>=Tt*1.5;return Math.round(It/Tt)+" "+At+(kt?"s":"")}}),yd=M((i,e)=>{v(),m(),_();function a(c){d.debug=d,d.default=d,d.coerce=$t,d.disable=gt,d.enable=ft,d.enabled=_t,d.humanize=pd(),d.destroy=It,Object.keys(c).forEach(Rt=>{d[Rt]=c[Rt]}),d.names=[],d.skips=[],d.formatters={};function h(Rt){let Tt=0;for(let At=0;At<Rt.length;At++)Tt=(Tt<<5)-Tt+Rt.charCodeAt(At),Tt|=0;return d.colors[Math.abs(Tt)%d.colors.length]}d.selectColor=h;function d(Rt){let Tt,At=null,kt,xt;function Nt(...Ft){if(!Nt.enabled)return;let jt=Nt,Gt=Number(new Date),Kt=Gt-(Tt||Gt);jt.diff=Kt,jt.prev=Tt,jt.curr=Gt,Tt=Gt,Ft[0]=d.coerce(Ft[0]),typeof Ft[0]!="string"&&Ft.unshift("%O");let Wt=0;Ft[0]=Ft[0].replace(/%([a-zA-Z%])/g,(Zt,cr)=>{if(Zt==="%%")return"%";Wt++;let hr=d.formatters[cr];if(typeof hr=="function"){let gr=Ft[Wt];Zt=hr.call(jt,gr),Ft.splice(Wt,1),Wt--}return Zt}),d.formatArgs.call(jt,Ft),(jt.log||d.log).apply(jt,Ft)}return Nt.namespace=Rt,Nt.useColors=d.useColors(),Nt.color=d.selectColor(Rt),Nt.extend=et,Nt.destroy=d.destroy,Object.defineProperty(Nt,"enabled",{enumerable:!0,configurable:!1,get:()=>At!==null?At:(kt!==d.namespaces&&(kt=d.namespaces,xt=d.enabled(Rt)),xt),set:Ft=>{At=Ft}}),typeof d.init=="function"&&d.init(Nt),Nt}function et(Rt,Tt){let At=d(this.namespace+(typeof Tt>"u"?":":Tt)+Rt);return At.log=this.log,At}function ft(Rt){d.save(Rt),d.namespaces=Rt,d.names=[],d.skips=[];let Tt,At=(typeof Rt=="string"?Rt:"").split(/[\s,]+/),kt=At.length;for(Tt=0;Tt<kt;Tt++)At[Tt]&&(Rt=At[Tt].replace(/\*/g,".*?"),Rt[0]==="-"?d.skips.push(new RegExp("^"+Rt.slice(1)+"$")):d.names.push(new RegExp("^"+Rt+"$")))}function gt(){let Rt=[...d.names.map(wt),...d.skips.map(wt).map(Tt=>"-"+Tt)].join(",");return d.enable(""),Rt}function _t(Rt){if(Rt[Rt.length-1]==="*")return!0;let Tt,At;for(Tt=0,At=d.skips.length;Tt<At;Tt++)if(d.skips[Tt].test(Rt))return!1;for(Tt=0,At=d.names.length;Tt<At;Tt++)if(d.names[Tt].test(Rt))return!0;return!1}function wt(Rt){return Rt.toString().substring(2,Rt.toString().length-2).replace(/\.\*\?$/,"*")}function $t(Rt){return Rt instanceof Error?Rt.stack||Rt.message:Rt}function It(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return d.enable(d.load()),d}e.exports=a}),ot=M((i,e)=>{v(),m(),_(),i.formatArgs=c,i.save=h,i.load=d,i.useColors=a,i.storage=et(),i.destroy=(()=>{let gt=!1;return()=>{gt||(gt=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),i.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function a(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof B<"u"&&B.userAgent&&B.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof B<"u"&&B.userAgent&&B.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof B<"u"&&B.userAgent&&B.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function c(gt){if(gt[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+gt[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;let _t="color: "+this.color;gt.splice(1,0,_t,"color: inherit");let wt=0,$t=0;gt[0].replace(/%[a-zA-Z%]/g,It=>{It!=="%%"&&(wt++,It==="%c"&&($t=wt))}),gt.splice($t,0,_t)}i.log=console.debug||console.log||(()=>{});function h(gt){try{gt?i.storage.setItem("debug",gt):i.storage.removeItem("debug")}catch{}}function d(){let gt;try{gt=i.storage.getItem("debug")}catch{}return!gt&&typeof P<"u"&&"env"in P&&(gt=P.env.DEBUG),gt}function et(){try{return localStorage}catch{}}e.exports=yd()(i);var{formatters:ft}=e.exports;ft.j=function(gt){try{return JSON.stringify(gt)}catch(_t){return"[UnexpectedJSONParseError]: "+_t.message}}}),_d=M((i,e)=>{v(),m(),_();var a=ud(),{EventEmitter:c}=(ir(),Z(rr$1)),h=cd(),d=Fo(),et=ot()("mqtt-packet:parser"),ft=class qo extends c{constructor(){super(),this.parser=this.constructor.parser}static parser(_t){return this instanceof qo?(this.settings=_t||{},this._states=["_parseHeader","_parseLength","_parsePayload","_newPacket"],this._resetState(),this):new qo().parser(_t)}_resetState(){et("_resetState: resetting packet, error, _list, and _stateCounter"),this.packet=new h,this.error=null,this._list=a(),this._stateCounter=0}parse(_t){for(this.error&&this._resetState(),this._list.append(_t),et("parse: current state: %s",this._states[this._stateCounter]);(this.packet.length!==-1||this._list.length>0)&&this[this._states[this._stateCounter]]()&&!this.error;)this._stateCounter++,et("parse: state complete. _stateCounter is now: %d",this._stateCounter),et("parse: packet.length: %d, buffer list length: %d",this.packet.length,this._list.length),this._stateCounter>=this._states.length&&(this._stateCounter=0);return et("parse: exited while loop. packet: %d, buffer list length: %d",this.packet.length,this._list.length),this._list.length}_parseHeader(){let _t=this._list.readUInt8(0),wt=_t>>d.CMD_SHIFT;this.packet.cmd=d.types[wt];let $t=_t&15,It=d.requiredHeaderFlags[wt];return It!=null&&$t!==It?this._emitError(new Error(d.requiredHeaderFlagsErrors[wt])):(this.packet.retain=(_t&d.RETAIN_MASK)!==0,this.packet.qos=_t>>d.QOS_SHIFT&d.QOS_MASK,this.packet.qos>2?this._emitError(new Error("Packet must not have both QoS bits set to 1")):(this.packet.dup=(_t&d.DUP_MASK)!==0,et("_parseHeader: packet: %o",this.packet),this._list.consume(1),!0))}_parseLength(){let _t=this._parseVarByteNum(!0);return _t&&(this.packet.length=_t.value,this._list.consume(_t.bytes)),et("_parseLength %d",_t.value),!!_t}_parsePayload(){et("_parsePayload: payload %O",this._list);let _t=!1;if(this.packet.length===0||this._list.length>=this.packet.length){switch(this._pos=0,this.packet.cmd){case"connect":this._parseConnect();break;case"connack":this._parseConnack();break;case"publish":this._parsePublish();break;case"puback":case"pubrec":case"pubrel":case"pubcomp":this._parseConfirmation();break;case"subscribe":this._parseSubscribe();break;case"suback":this._parseSuback();break;case"unsubscribe":this._parseUnsubscribe();break;case"unsuback":this._parseUnsuback();break;case"pingreq":case"pingresp":break;case"disconnect":this._parseDisconnect();break;case"auth":this._parseAuth();break;default:this._emitError(new Error("Not supported"))}_t=!0}return et("_parsePayload complete result: %s",_t),_t}_parseConnect(){et("_parseConnect");let _t,wt,$t,It,Rt={},Tt=this.packet,At=this._parseString();if(At===null)return this._emitError(new Error("Cannot parse protocolId"));if(At!=="MQTT"&&At!=="MQIsdp")return this._emitError(new Error("Invalid protocolId"));if(Tt.protocolId=At,this._pos>=this._list.length)return this._emitError(new Error("Packet too short"));if(Tt.protocolVersion=this._list.readUInt8(this._pos),Tt.protocolVersion>=128&&(Tt.bridgeMode=!0,Tt.protocolVersion=Tt.protocolVersion-128),Tt.protocolVersion!==3&&Tt.protocolVersion!==4&&Tt.protocolVersion!==5)return this._emitError(new Error("Invalid protocol version"));if(this._pos++,this._pos>=this._list.length)return this._emitError(new Error("Packet too short"));if(this._list.readUInt8(this._pos)&1)return this._emitError(new Error("Connect flag bit 0 must be 0, but got 1"));Rt.username=this._list.readUInt8(this._pos)&d.USERNAME_MASK,Rt.password=this._list.readUInt8(this._pos)&d.PASSWORD_MASK,Rt.will=this._list.readUInt8(this._pos)&d.WILL_FLAG_MASK;let kt=!!(this._list.readUInt8(this._pos)&d.WILL_RETAIN_MASK),xt=(this._list.readUInt8(this._pos)&d.WILL_QOS_MASK)>>d.WILL_QOS_SHIFT;if(Rt.will)Tt.will={},Tt.will.retain=kt,Tt.will.qos=xt;else{if(kt)return this._emitError(new Error("Will Retain Flag must be set to zero when Will Flag is set to 0"));if(xt)return this._emitError(new Error("Will QoS must be set to zero when Will Flag is set to 0"))}if(Tt.clean=(this._list.readUInt8(this._pos)&d.CLEAN_SESSION_MASK)!==0,this._pos++,Tt.keepalive=this._parseNum(),Tt.keepalive===-1)return this._emitError(new Error("Packet too short"));if(Tt.protocolVersion===5){let Ft=this._parseProperties();Object.getOwnPropertyNames(Ft).length&&(Tt.properties=Ft)}let Nt=this._parseString();if(Nt===null)return this._emitError(new Error("Packet too short"));if(Tt.clientId=Nt,et("_parseConnect: packet.clientId: %s",Tt.clientId),Rt.will){if(Tt.protocolVersion===5){let Ft=this._parseProperties();Object.getOwnPropertyNames(Ft).length&&(Tt.will.properties=Ft)}if(_t=this._parseString(),_t===null)return this._emitError(new Error("Cannot parse will topic"));if(Tt.will.topic=_t,et("_parseConnect: packet.will.topic: %s",Tt.will.topic),wt=this._parseBuffer(),wt===null)return this._emitError(new Error("Cannot parse will payload"));Tt.will.payload=wt,et("_parseConnect: packet.will.paylaod: %s",Tt.will.payload)}if(Rt.username){if(It=this._parseString(),It===null)return this._emitError(new Error("Cannot parse username"));Tt.username=It,et("_parseConnect: packet.username: %s",Tt.username)}if(Rt.password){if($t=this._parseBuffer(),$t===null)return this._emitError(new Error("Cannot parse password"));Tt.password=$t}return this.settings=Tt,et("_parseConnect: complete"),Tt}_parseConnack(){et("_parseConnack");let _t=this.packet;if(this._list.length<1)return null;let wt=this._list.readUInt8(this._pos++);if(wt>1)return this._emitError(new Error("Invalid connack flags, bits 7-1 must be set to 0"));if(_t.sessionPresent=!!(wt&d.SESSIONPRESENT_MASK),this.settings.protocolVersion===5)this._list.length>=2?_t.reasonCode=this._list.readUInt8(this._pos++):_t.reasonCode=0;else{if(this._list.length<2)return null;_t.returnCode=this._list.readUInt8(this._pos++)}if(_t.returnCode===-1||_t.reasonCode===-1)return this._emitError(new Error("Cannot parse return code"));if(this.settings.protocolVersion===5){let $t=this._parseProperties();Object.getOwnPropertyNames($t).length&&(_t.properties=$t)}et("_parseConnack: complete")}_parsePublish(){et("_parsePublish");let _t=this.packet;if(_t.topic=this._parseString(),_t.topic===null)return this._emitError(new Error("Cannot parse topic"));if(!(_t.qos>0&&!this._parseMessageId())){if(this.settings.protocolVersion===5){let wt=this._parseProperties();Object.getOwnPropertyNames(wt).length&&(_t.properties=wt)}_t.payload=this._list.slice(this._pos,_t.length),et("_parsePublish: payload from buffer list: %o",_t.payload)}}_parseSubscribe(){et("_parseSubscribe");let _t=this.packet,wt,$t,It,Rt,Tt,At,kt;if(_t.subscriptions=[],!!this._parseMessageId()){if(this.settings.protocolVersion===5){let xt=this._parseProperties();Object.getOwnPropertyNames(xt).length&&(_t.properties=xt)}if(_t.length<=0)return this._emitError(new Error("Malformed subscribe, no payload specified"));for(;this._pos<_t.length;){if(wt=this._parseString(),wt===null)return this._emitError(new Error("Cannot parse topic"));if(this._pos>=_t.length)return this._emitError(new Error("Malformed Subscribe Payload"));if($t=this._parseByte(),this.settings.protocolVersion===5){if($t&192)return this._emitError(new Error("Invalid subscribe topic flag bits, bits 7-6 must be 0"))}else if($t&252)return this._emitError(new Error("Invalid subscribe topic flag bits, bits 7-2 must be 0"));if(It=$t&d.SUBSCRIBE_OPTIONS_QOS_MASK,It>2)return this._emitError(new Error("Invalid subscribe QoS, must be <= 2"));if(At=($t>>d.SUBSCRIBE_OPTIONS_NL_SHIFT&d.SUBSCRIBE_OPTIONS_NL_MASK)!==0,Tt=($t>>d.SUBSCRIBE_OPTIONS_RAP_SHIFT&d.SUBSCRIBE_OPTIONS_RAP_MASK)!==0,Rt=$t>>d.SUBSCRIBE_OPTIONS_RH_SHIFT&d.SUBSCRIBE_OPTIONS_RH_MASK,Rt>2)return this._emitError(new Error("Invalid retain handling, must be <= 2"));kt={topic:wt,qos:It},this.settings.protocolVersion===5?(kt.nl=At,kt.rap=Tt,kt.rh=Rt):this.settings.bridgeMode&&(kt.rh=0,kt.rap=!0,kt.nl=!0),et("_parseSubscribe: push subscription `%s` to subscription",kt),_t.subscriptions.push(kt)}}}_parseSuback(){et("_parseSuback");let _t=this.packet;if(this.packet.granted=[],!!this._parseMessageId()){if(this.settings.protocolVersion===5){let wt=this._parseProperties();Object.getOwnPropertyNames(wt).length&&(_t.properties=wt)}if(_t.length<=0)return this._emitError(new Error("Malformed suback, no payload specified"));for(;this._pos<this.packet.length;){let wt=this._list.readUInt8(this._pos++);if(this.settings.protocolVersion===5){if(!d.MQTT5_SUBACK_CODES[wt])return this._emitError(new Error("Invalid suback code"))}else if(wt>2&&wt!==128)return this._emitError(new Error("Invalid suback QoS, must be 0, 1, 2 or 128"));this.packet.granted.push(wt)}}}_parseUnsubscribe(){et("_parseUnsubscribe");let _t=this.packet;if(_t.unsubscriptions=[],!!this._parseMessageId()){if(this.settings.protocolVersion===5){let wt=this._parseProperties();Object.getOwnPropertyNames(wt).length&&(_t.properties=wt)}if(_t.length<=0)return this._emitError(new Error("Malformed unsubscribe, no payload specified"));for(;this._pos<_t.length;){let wt=this._parseString();if(wt===null)return this._emitError(new Error("Cannot parse topic"));et("_parseUnsubscribe: push topic `%s` to unsubscriptions",wt),_t.unsubscriptions.push(wt)}}}_parseUnsuback(){et("_parseUnsuback");let _t=this.packet;if(!this._parseMessageId())return this._emitError(new Error("Cannot parse messageId"));if((this.settings.protocolVersion===3||this.settings.protocolVersion===4)&&_t.length!==2)return this._emitError(new Error("Malformed unsuback, payload length must be 2"));if(_t.length<=0)return this._emitError(new Error("Malformed unsuback, no payload specified"));if(this.settings.protocolVersion===5){let wt=this._parseProperties();for(Object.getOwnPropertyNames(wt).length&&(_t.properties=wt),_t.granted=[];this._pos<this.packet.length;){let $t=this._list.readUInt8(this._pos++);if(!d.MQTT5_UNSUBACK_CODES[$t])return this._emitError(new Error("Invalid unsuback code"));this.packet.granted.push($t)}}}_parseConfirmation(){et("_parseConfirmation: packet.cmd: `%s`",this.packet.cmd);let _t=this.packet;if(this._parseMessageId(),this.settings.protocolVersion===5){if(_t.length>2){switch(_t.reasonCode=this._parseByte(),this.packet.cmd){case"puback":case"pubrec":if(!d.MQTT5_PUBACK_PUBREC_CODES[_t.reasonCode])return this._emitError(new Error("Invalid "+this.packet.cmd+" reason code"));break;case"pubrel":case"pubcomp":if(!d.MQTT5_PUBREL_PUBCOMP_CODES[_t.reasonCode])return this._emitError(new Error("Invalid "+this.packet.cmd+" reason code"));break}et("_parseConfirmation: packet.reasonCode `%d`",_t.reasonCode)}else _t.reasonCode=0;if(_t.length>3){let wt=this._parseProperties();Object.getOwnPropertyNames(wt).length&&(_t.properties=wt)}}return!0}_parseDisconnect(){let _t=this.packet;if(et("_parseDisconnect"),this.settings.protocolVersion===5){this._list.length>0?(_t.reasonCode=this._parseByte(),d.MQTT5_DISCONNECT_CODES[_t.reasonCode]||this._emitError(new Error("Invalid disconnect reason code"))):_t.reasonCode=0;let wt=this._parseProperties();Object.getOwnPropertyNames(wt).length&&(_t.properties=wt)}return et("_parseDisconnect result: true"),!0}_parseAuth(){et("_parseAuth");let _t=this.packet;if(this.settings.protocolVersion!==5)return this._emitError(new Error("Not supported auth packet for this version MQTT"));if(_t.reasonCode=this._parseByte(),!d.MQTT5_AUTH_CODES[_t.reasonCode])return this._emitError(new Error("Invalid auth reason code"));let wt=this._parseProperties();return Object.getOwnPropertyNames(wt).length&&(_t.properties=wt),et("_parseAuth: result: true"),!0}_parseMessageId(){let _t=this.packet;return _t.messageId=this._parseNum(),_t.messageId===null?(this._emitError(new Error("Cannot parse messageId")),!1):(et("_parseMessageId: packet.messageId %d",_t.messageId),!0)}_parseString(_t){let wt=this._parseNum(),$t=wt+this._pos;if(wt===-1||$t>this._list.length||$t>this.packet.length)return null;let It=this._list.toString("utf8",this._pos,$t);return this._pos+=wt,et("_parseString: result: %s",It),It}_parseStringPair(){return et("_parseStringPair"),{name:this._parseString(),value:this._parseString()}}_parseBuffer(){let _t=this._parseNum(),wt=_t+this._pos;if(_t===-1||wt>this._list.length||wt>this.packet.length)return null;let $t=this._list.slice(this._pos,wt);return this._pos+=_t,et("_parseBuffer: result: %o",$t),$t}_parseNum(){if(this._list.length-this._pos<2)return-1;let _t=this._list.readUInt16BE(this._pos);return this._pos+=2,et("_parseNum: result: %s",_t),_t}_parse4ByteNum(){if(this._list.length-this._pos<4)return-1;let _t=this._list.readUInt32BE(this._pos);return this._pos+=4,et("_parse4ByteNum: result: %s",_t),_t}_parseVarByteNum(_t){et("_parseVarByteNum");let wt=4,$t=0,It=1,Rt=0,Tt=!1,At,kt=this._pos?this._pos:0;for(;$t<wt&&kt+$t<this._list.length;){if(At=this._list.readUInt8(kt+$t++),Rt+=It*(At&d.VARBYTEINT_MASK),It*=128,!(At&d.VARBYTEINT_FIN_MASK)){Tt=!0;break}if(this._list.length<=$t)break}return!Tt&&$t===wt&&this._list.length>=$t&&this._emitError(new Error("Invalid variable byte integer")),kt&&(this._pos+=$t),Tt?_t?Tt={bytes:$t,value:Rt}:Tt=Rt:Tt=!1,et("_parseVarByteNum: result: %o",Tt),Tt}_parseByte(){let _t;return this._pos<this._list.length&&(_t=this._list.readUInt8(this._pos),this._pos++),et("_parseByte: result: %o",_t),_t}_parseByType(_t){switch(et("_parseByType: type: %s",_t),_t){case"byte":return this._parseByte()!==0;case"int8":return this._parseByte();case"int16":return this._parseNum();case"int32":return this._parse4ByteNum();case"var":return this._parseVarByteNum();case"string":return this._parseString();case"pair":return this._parseStringPair();case"binary":return this._parseBuffer()}}_parseProperties(){et("_parseProperties");let _t=this._parseVarByteNum(),wt=this._pos+_t,$t={};for(;this._pos<wt;){let It=this._parseByte();if(!It)return this._emitError(new Error("Cannot parse property code type")),!1;let Rt=d.propertiesCodes[It];if(!Rt)return this._emitError(new Error("Unknown property")),!1;if(Rt==="userProperties"){$t[Rt]||($t[Rt]=Object.create(null));let Tt=this._parseByType(d.propertiesTypes[Rt]);if($t[Rt][Tt.name])if(Array.isArray($t[Rt][Tt.name]))$t[Rt][Tt.name].push(Tt.value);else{let At=$t[Rt][Tt.name];$t[Rt][Tt.name]=[At],$t[Rt][Tt.name].push(Tt.value)}else $t[Rt][Tt.name]=Tt.value;continue}$t[Rt]?Array.isArray($t[Rt])?$t[Rt].push(this._parseByType(d.propertiesTypes[Rt])):($t[Rt]=[$t[Rt]],$t[Rt].push(this._parseByType(d.propertiesTypes[Rt]))):$t[Rt]=this._parseByType(d.propertiesTypes[Rt])}return $t}_newPacket(){return et("_newPacket"),this.packet&&(this._list.consume(this.packet.length),et("_newPacket: parser emit packet: packet.cmd: %s, packet.payload: %s, packet.length: %d",this.packet.cmd,this.packet.payload,this.packet.length),this.emit("packet",this.packet)),et("_newPacket: new packet"),this.packet=new h,this._pos=0,!0}_emitError(_t){et("_emitError",_t),this.error=_t,this.emit("error",_t)}};e.exports=ft}),Sd=M((i,e)=>{v(),m(),_();var{Buffer:a}=(we(),Z(ve)),c=65536,h={},d=a.isBuffer(a.from([1,2]).subarray(0,1));function et(wt){let $t=a.allocUnsafe(2);return $t.writeUInt8(wt>>8,0),$t.writeUInt8(wt&255,1),$t}function ft(){for(let wt=0;wt<c;wt++)h[wt]=et(wt)}function gt(wt){let $t=0,It=0,Rt=a.allocUnsafe(4);do $t=wt%128|0,wt=wt/128|0,wt>0&&($t=$t|128),Rt.writeUInt8($t,It++);while(wt>0&&It<4);return wt>0&&(It=0),d?Rt.subarray(0,It):Rt.slice(0,It)}function _t(wt){let $t=a.allocUnsafe(4);return $t.writeUInt32BE(wt,0),$t}e.exports={cache:h,generateCache:ft,generateNumber:et,genBufVariableByteInt:gt,generate4ByteBuffer:_t}}),Ad=M((i,e)=>{v(),m(),_(),typeof P>"u"||!P.version||P.version.indexOf("v0.")===0||P.version.indexOf("v1.")===0&&P.version.indexOf("v1.8.")!==0?e.exports={nextTick:a}:e.exports=P;function a(c,h,d,et){if(typeof c!="function")throw new TypeError('"callback" argument must be a function');var ft=arguments.length,gt,_t;switch(ft){case 0:case 1:return P.nextTick(c);case 2:return P.nextTick(function(){c.call(null,h)});case 3:return P.nextTick(function(){c.call(null,h,d)});case 4:return P.nextTick(function(){c.call(null,h,d,et)});default:for(gt=new Array(ft-1),_t=0;_t<gt.length;)gt[_t++]=arguments[_t];return P.nextTick(function(){c.apply(null,gt)})}}}),zo=M((i,e)=>{v(),m(),_();var a=Fo(),{Buffer:c}=(we(),Z(ve)),h=c.allocUnsafe(0),d=c.from([0]),et=Sd(),ft=Ad().nextTick,gt=ot()("mqtt-packet:writeToStream"),_t=et.cache,wt=et.generateNumber,$t=et.generateCache,It=et.genBufVariableByteInt,Rt=et.generate4ByteBuffer,Tt=Tr,At=!0;function kt(br,_r,Vr){switch(gt("generate called"),_r.cork&&(_r.cork(),ft(xt,_r)),At&&(At=!1,$t()),gt("generate: packet.cmd: %s",br.cmd),br.cmd){case"connect":return Nt(br,_r);case"connack":return Ft(br,_r,Vr);case"publish":return jt(br,_r,Vr);case"puback":case"pubrec":case"pubrel":case"pubcomp":return Gt(br,_r,Vr);case"subscribe":return Kt(br,_r,Vr);case"suback":return Wt(br,_r,Vr);case"unsubscribe":return Zt(br,_r,Vr);case"unsuback":return cr(br,_r,Vr);case"pingreq":case"pingresp":return hr(br,_r);case"disconnect":return gr(br,_r,Vr);case"auth":return er(br,_r,Vr);default:return _r.destroy(new Error("Unknown command")),!1}}Object.defineProperty(kt,"cacheNumbers",{get(){return Tt===Tr},set(br){br?((!_t||Object.keys(_t).length===0)&&(At=!0),Tt=Tr):(At=!1,Tt=fr)}});function xt(br){br.uncork()}function Nt(br,_r,Vr){let lr=br||{},Cr=lr.protocolId||"MQTT",xr=lr.protocolVersion||4,Kr=lr.will,Gr=lr.clean,vr=lr.keepalive||0,Nr=lr.clientId||"",Pr=lr.username,en=lr.password,Wr=lr.properties;Gr===void 0&&(Gr=!0);let Or=0;if(!Cr||typeof Cr!="string"&&!c.isBuffer(Cr))return _r.destroy(new Error("Invalid protocolId")),!1;if(Or+=Cr.length+2,xr!==3&&xr!==4&&xr!==5)return _r.destroy(new Error("Invalid protocol version")),!1;if(Or+=1,(typeof Nr=="string"||c.isBuffer(Nr))&&(Nr||xr>=4)&&(Nr||Gr))Or+=c.byteLength(Nr)+2;else{if(xr<4)return _r.destroy(new Error("clientId must be supplied before 3.1.1")),!1;if(Gr*1===0)return _r.destroy(new Error("clientId must be given if cleanSession set to 0")),!1}if(typeof vr!="number"||vr<0||vr>65535||vr%1!==0)return _r.destroy(new Error("Invalid keepalive")),!1;Or+=2,Or+=1;let Xr,hn;if(xr===5){if(Xr=Fr(_r,Wr),!Xr)return!1;Or+=Xr.length}if(Kr){if(typeof Kr!="object")return _r.destroy(new Error("Invalid will")),!1;if(!Kr.topic||typeof Kr.topic!="string")return _r.destroy(new Error("Invalid will topic")),!1;if(Or+=c.byteLength(Kr.topic)+2,Or+=2,Kr.payload)if(Kr.payload.length>=0)typeof Kr.payload=="string"?Or+=c.byteLength(Kr.payload):Or+=Kr.payload.length;else return _r.destroy(new Error("Invalid will payload")),!1;if(hn={},xr===5){if(hn=Fr(_r,Kr.properties),!hn)return!1;Or+=hn.length}}let pn=!1;if(Pr!=null)if(zr(Pr))pn=!0,Or+=c.byteLength(Pr)+2;else return _r.destroy(new Error("Invalid username")),!1;if(en!=null){if(!pn)return _r.destroy(new Error("Username is required to use password")),!1;if(zr(en))Or+=Jr(en)+2;else return _r.destroy(new Error("Invalid password")),!1}_r.write(a.CONNECT_HEADER),Mr(_r,Or),$r(_r,Cr),lr.bridgeMode&&(xr+=128),_r.write(xr===131?a.VERSION131:xr===132?a.VERSION132:xr===4?a.VERSION4:xr===5?a.VERSION5:a.VERSION3);let vn=0;return vn|=Pr!=null?a.USERNAME_MASK:0,vn|=en!=null?a.PASSWORD_MASK:0,vn|=Kr&&Kr.retain?a.WILL_RETAIN_MASK:0,vn|=Kr&&Kr.qos?Kr.qos<<a.WILL_QOS_SHIFT:0,vn|=Kr?a.WILL_FLAG_MASK:0,vn|=Gr?a.CLEAN_SESSION_MASK:0,_r.write(c.from([vn])),Tt(_r,vr),xr===5&&Xr.write(),$r(_r,Nr),Kr&&(xr===5&&hn.write(),wr(_r,Kr.topic),$r(_r,Kr.payload)),Pr!=null&&$r(_r,Pr),en!=null&&$r(_r,en),!0}function Ft(br,_r,Vr){let lr=Vr?Vr.protocolVersion:4,Cr=br||{},xr=lr===5?Cr.reasonCode:Cr.returnCode,Kr=Cr.properties,Gr=2;if(typeof xr!="number")return _r.destroy(new Error("Invalid return code")),!1;let vr=null;if(lr===5){if(vr=Fr(_r,Kr),!vr)return!1;Gr+=vr.length}return _r.write(a.CONNACK_HEADER),Mr(_r,Gr),_r.write(Cr.sessionPresent?a.SESSIONPRESENT_HEADER:d),_r.write(c.from([xr])),vr==null||vr.write(),!0}function jt(br,_r,Vr){gt("publish: packet: %o",br);let lr=Vr?Vr.protocolVersion:4,Cr=br||{},xr=Cr.qos||0,Kr=Cr.retain?a.RETAIN_MASK:0,Gr=Cr.topic,vr=Cr.payload||h,Nr=Cr.messageId,Pr=Cr.properties,en=0;if(typeof Gr=="string")en+=c.byteLength(Gr)+2;else if(c.isBuffer(Gr))en+=Gr.length+2;else return _r.destroy(new Error("Invalid topic")),!1;if(c.isBuffer(vr)?en+=vr.length:en+=c.byteLength(vr),xr&&typeof Nr!="number")return _r.destroy(new Error("Invalid messageId")),!1;xr&&(en+=2);let Wr=null;if(lr===5){if(Wr=Fr(_r,Pr),!Wr)return!1;en+=Wr.length}return _r.write(a.PUBLISH_HEADER[xr][Cr.dup?1:0][Kr?1:0]),Mr(_r,en),Tt(_r,Jr(Gr)),_r.write(Gr),xr>0&&Tt(_r,Nr),Wr==null||Wr.write(),gt("publish: payload: %o",vr),_r.write(vr)}function Gt(br,_r,Vr){let lr=Vr?Vr.protocolVersion:4,Cr=br||{},xr=Cr.cmd||"puback",Kr=Cr.messageId,Gr=Cr.dup&&xr==="pubrel"?a.DUP_MASK:0,vr=0,Nr=Cr.reasonCode,Pr=Cr.properties,en=lr===5?3:2;if(xr==="pubrel"&&(vr=1),typeof Kr!="number")return _r.destroy(new Error("Invalid messageId")),!1;let Wr=null;if(lr===5&&typeof Pr=="object"){if(Wr=dr(_r,Pr,Vr,en),!Wr)return!1;en+=Wr.length}return _r.write(a.ACKS[xr][vr][Gr][0]),en===3&&(en+=Nr!==0?1:-1),Mr(_r,en),Tt(_r,Kr),lr===5&&en!==2&&_r.write(c.from([Nr])),Wr!==null?Wr.write():en===4&&_r.write(c.from([0])),!0}function Kt(br,_r,Vr){gt("subscribe: packet: ");let lr=Vr?Vr.protocolVersion:4,Cr=br||{},xr=Cr.dup?a.DUP_MASK:0,Kr=Cr.messageId,Gr=Cr.subscriptions,vr=Cr.properties,Nr=0;if(typeof Kr!="number")return _r.destroy(new Error("Invalid messageId")),!1;Nr+=2;let Pr=null;if(lr===5){if(Pr=Fr(_r,vr),!Pr)return!1;Nr+=Pr.length}if(typeof Gr=="object"&&Gr.length)for(let Wr=0;Wr<Gr.length;Wr+=1){let Or=Gr[Wr].topic,Xr=Gr[Wr].qos;if(typeof Or!="string")return _r.destroy(new Error("Invalid subscriptions - invalid topic")),!1;if(typeof Xr!="number")return _r.destroy(new Error("Invalid subscriptions - invalid qos")),!1;if(lr===5){if(typeof(Gr[Wr].nl||!1)!="boolean")return _r.destroy(new Error("Invalid subscriptions - invalid No Local")),!1;if(typeof(Gr[Wr].rap||!1)!="boolean")return _r.destroy(new Error("Invalid subscriptions - invalid Retain as Published")),!1;let hn=Gr[Wr].rh||0;if(typeof hn!="number"||hn>2)return _r.destroy(new Error("Invalid subscriptions - invalid Retain Handling")),!1}Nr+=c.byteLength(Or)+2+1}else return _r.destroy(new Error("Invalid subscriptions")),!1;gt("subscribe: writing to stream: %o",a.SUBSCRIBE_HEADER),_r.write(a.SUBSCRIBE_HEADER[1][xr?1:0][0]),Mr(_r,Nr),Tt(_r,Kr),Pr!==null&&Pr.write();let en=!0;for(let Wr of Gr){let Or=Wr.topic,Xr=Wr.qos,hn=+Wr.nl,pn=+Wr.rap,vn=Wr.rh,Tn;wr(_r,Or),Tn=a.SUBSCRIBE_OPTIONS_QOS[Xr],lr===5&&(Tn|=hn?a.SUBSCRIBE_OPTIONS_NL:0,Tn|=pn?a.SUBSCRIBE_OPTIONS_RAP:0,Tn|=vn?a.SUBSCRIBE_OPTIONS_RH[vn]:0),en=_r.write(c.from([Tn]))}return en}function Wt(br,_r,Vr){let lr=Vr?Vr.protocolVersion:4,Cr=br||{},xr=Cr.messageId,Kr=Cr.granted,Gr=Cr.properties,vr=0;if(typeof xr!="number")return _r.destroy(new Error("Invalid messageId")),!1;if(vr+=2,typeof Kr=="object"&&Kr.length)for(let Pr=0;Pr<Kr.length;Pr+=1){if(typeof Kr[Pr]!="number")return _r.destroy(new Error("Invalid qos vector")),!1;vr+=1}else return _r.destroy(new Error("Invalid qos vector")),!1;let Nr=null;if(lr===5){if(Nr=dr(_r,Gr,Vr,vr),!Nr)return!1;vr+=Nr.length}return _r.write(a.SUBACK_HEADER),Mr(_r,vr),Tt(_r,xr),Nr!==null&&Nr.write(),_r.write(c.from(Kr))}function Zt(br,_r,Vr){let lr=Vr?Vr.protocolVersion:4,Cr=br||{},xr=Cr.messageId,Kr=Cr.dup?a.DUP_MASK:0,Gr=Cr.unsubscriptions,vr=Cr.properties,Nr=0;if(typeof xr!="number")return _r.destroy(new Error("Invalid messageId")),!1;if(Nr+=2,typeof Gr=="object"&&Gr.length)for(let Wr=0;Wr<Gr.length;Wr+=1){if(typeof Gr[Wr]!="string")return _r.destroy(new Error("Invalid unsubscriptions")),!1;Nr+=c.byteLength(Gr[Wr])+2}else return _r.destroy(new Error("Invalid unsubscriptions")),!1;let Pr=null;if(lr===5){if(Pr=Fr(_r,vr),!Pr)return!1;Nr+=Pr.length}_r.write(a.UNSUBSCRIBE_HEADER[1][Kr?1:0][0]),Mr(_r,Nr),Tt(_r,xr),Pr!==null&&Pr.write();let en=!0;for(let Wr=0;Wr<Gr.length;Wr++)en=wr(_r,Gr[Wr]);return en}function cr(br,_r,Vr){let lr=Vr?Vr.protocolVersion:4,Cr=br||{},xr=Cr.messageId,Kr=Cr.dup?a.DUP_MASK:0,Gr=Cr.granted,vr=Cr.properties,Nr=Cr.cmd,Pr=0,en=2;if(typeof xr!="number")return _r.destroy(new Error("Invalid messageId")),!1;if(lr===5)if(typeof Gr=="object"&&Gr.length)for(let Or=0;Or<Gr.length;Or+=1){if(typeof Gr[Or]!="number")return _r.destroy(new Error("Invalid qos vector")),!1;en+=1}else return _r.destroy(new Error("Invalid qos vector")),!1;let Wr=null;if(lr===5){if(Wr=dr(_r,vr,Vr,en),!Wr)return!1;en+=Wr.length}return _r.write(a.ACKS[Nr][Pr][Kr][0]),Mr(_r,en),Tt(_r,xr),Wr!==null&&Wr.write(),lr===5&&_r.write(c.from(Gr)),!0}function hr(br,_r,Vr){return _r.write(a.EMPTY[br.cmd])}function gr(br,_r,Vr){let lr=Vr?Vr.protocolVersion:4,Cr=br||{},xr=Cr.reasonCode,Kr=Cr.properties,Gr=lr===5?1:0,vr=null;if(lr===5){if(vr=dr(_r,Kr,Vr,Gr),!vr)return!1;Gr+=vr.length}return _r.write(c.from([a.codes.disconnect<<4])),Mr(_r,Gr),lr===5&&_r.write(c.from([xr])),vr!==null&&vr.write(),!0}function er(br,_r,Vr){let lr=Vr?Vr.protocolVersion:4,Cr=br||{},xr=Cr.reasonCode,Kr=Cr.properties,Gr=lr===5?1:0;lr!==5&&_r.destroy(new Error("Invalid mqtt version for auth packet"));let vr=dr(_r,Kr,Vr,Gr);return vr?(Gr+=vr.length,_r.write(c.from([a.codes.auth<<4])),Mr(_r,Gr),_r.write(c.from([xr])),vr!==null&&vr.write(),!0):!1}var mr={};function Mr(br,_r){if(_r>a.VARBYTEINT_MAX)return br.destroy(new Error(`Invalid variable byte integer: ${_r}`)),!1;let Vr=mr[_r];return Vr||(Vr=It(_r),_r<16384&&(mr[_r]=Vr)),gt("writeVarByteInt: writing to stream: %o",Vr),br.write(Vr)}function wr(br,_r){let Vr=c.byteLength(_r);return Tt(br,Vr),gt("writeString: %s",_r),br.write(_r,"utf8")}function Dr(br,_r,Vr){wr(br,_r),wr(br,Vr)}function Tr(br,_r){return gt("writeNumberCached: number: %d",_r),gt("writeNumberCached: %o",_t[_r]),br.write(_t[_r])}function fr(br,_r){let Vr=wt(_r);return gt("writeNumberGenerated: %o",Vr),br.write(Vr)}function yr(br,_r){let Vr=Rt(_r);return gt("write4ByteNumber: %o",Vr),br.write(Vr)}function $r(br,_r){typeof _r=="string"?wr(br,_r):_r?(Tt(br,_r.length),br.write(_r)):Tt(br,0)}function Fr(br,_r){if(typeof _r!="object"||_r.length!=null)return{length:1,write(){Hr(br,{},0)}};let Vr=0;function lr(Cr,xr){let Kr=a.propertiesTypes[Cr],Gr=0;switch(Kr){case"byte":{if(typeof xr!="boolean")return br.destroy(new Error(`Invalid ${Cr}: ${xr}`)),!1;Gr+=2;break}case"int8":{if(typeof xr!="number"||xr<0||xr>255)return br.destroy(new Error(`Invalid ${Cr}: ${xr}`)),!1;Gr+=2;break}case"binary":{if(xr&&xr===null)return br.destroy(new Error(`Invalid ${Cr}: ${xr}`)),!1;Gr+=1+c.byteLength(xr)+2;break}case"int16":{if(typeof xr!="number"||xr<0||xr>65535)return br.destroy(new Error(`Invalid ${Cr}: ${xr}`)),!1;Gr+=3;break}case"int32":{if(typeof xr!="number"||xr<0||xr>4294967295)return br.destroy(new Error(`Invalid ${Cr}: ${xr}`)),!1;Gr+=5;break}case"var":{if(typeof xr!="number"||xr<0||xr>268435455)return br.destroy(new Error(`Invalid ${Cr}: ${xr}`)),!1;Gr+=1+c.byteLength(It(xr));break}case"string":{if(typeof xr!="string")return br.destroy(new Error(`Invalid ${Cr}: ${xr}`)),!1;Gr+=3+c.byteLength(xr.toString());break}case"pair":{if(typeof xr!="object")return br.destroy(new Error(`Invalid ${Cr}: ${xr}`)),!1;Gr+=Object.getOwnPropertyNames(xr).reduce((vr,Nr)=>{let Pr=xr[Nr];return Array.isArray(Pr)?vr+=Pr.reduce((en,Wr)=>(en+=3+c.byteLength(Nr.toString())+2+c.byteLength(Wr.toString()),en),0):vr+=3+c.byteLength(Nr.toString())+2+c.byteLength(xr[Nr].toString()),vr},0);break}default:return br.destroy(new Error(`Invalid property ${Cr}: ${xr}`)),!1}return Gr}if(_r)for(let Cr in _r){let xr=0,Kr=0,Gr=_r[Cr];if(Array.isArray(Gr))for(let vr=0;vr<Gr.length;vr++){if(Kr=lr(Cr,Gr[vr]),!Kr)return!1;xr+=Kr}else{if(Kr=lr(Cr,Gr),!Kr)return!1;xr=Kr}if(!xr)return!1;Vr+=xr}return{length:c.byteLength(It(Vr))+Vr,write(){Hr(br,_r,Vr)}}}function dr(br,_r,Vr,lr){let Cr=["reasonString","userProperties"],xr=Vr&&Vr.properties&&Vr.properties.maximumPacketSize?Vr.properties.maximumPacketSize:0,Kr=Fr(br,_r);if(xr)for(;lr+Kr.length>xr;){let Gr=Cr.shift();if(Gr&&_r[Gr])delete _r[Gr],Kr=Fr(br,_r);else return!1}return Kr}function Br(br,_r,Vr){switch(a.propertiesTypes[_r]){case"byte":{br.write(c.from([a.properties[_r]])),br.write(c.from([+Vr]));break}case"int8":{br.write(c.from([a.properties[_r]])),br.write(c.from([Vr]));break}case"binary":{br.write(c.from([a.properties[_r]])),$r(br,Vr);break}case"int16":{br.write(c.from([a.properties[_r]])),Tt(br,Vr);break}case"int32":{br.write(c.from([a.properties[_r]])),yr(br,Vr);break}case"var":{br.write(c.from([a.properties[_r]])),Mr(br,Vr);break}case"string":{br.write(c.from([a.properties[_r]])),wr(br,Vr);break}case"pair":{Object.getOwnPropertyNames(Vr).forEach(lr=>{let Cr=Vr[lr];Array.isArray(Cr)?Cr.forEach(xr=>{br.write(c.from([a.properties[_r]])),Dr(br,lr.toString(),xr.toString())}):(br.write(c.from([a.properties[_r]])),Dr(br,lr.toString(),Cr.toString()))});break}default:return br.destroy(new Error(`Invalid property ${_r} value: ${Vr}`)),!1}}function Hr(br,_r,Vr){Mr(br,Vr);for(let lr in _r)if(Object.prototype.hasOwnProperty.call(_r,lr)&&_r[lr]!==null){let Cr=_r[lr];if(Array.isArray(Cr))for(let xr=0;xr<Cr.length;xr++)Br(br,lr,Cr[xr]);else Br(br,lr,Cr)}}function Jr(br){return br?br instanceof c?br.length:c.byteLength(br):0}function zr(br){return typeof br=="string"||br instanceof c}e.exports=kt}),Ld=M((i,e)=>{v(),m(),_();var a=zo(),{EventEmitter:c}=(ir(),Z(rr$1)),{Buffer:h}=(we(),Z(ve));function d(ft,gt){let _t=new et;return a(ft,_t,gt),_t.concat()}var et=class extends c{constructor(){super(),this._array=new Array(20),this._i=0}write(ft){return this._array[this._i++]=ft,!0}concat(){let ft=0,gt=new Array(this._array.length),_t=this._array,wt=0,$t;for($t=0;$t<_t.length&&_t[$t]!==void 0;$t++)typeof _t[$t]!="string"?gt[$t]=_t[$t].length:gt[$t]=h.byteLength(_t[$t]),ft+=gt[$t];let It=h.allocUnsafe(ft);for($t=0;$t<_t.length&&_t[$t]!==void 0;$t++)typeof _t[$t]!="string"?(_t[$t].copy(It,wt),wt+=gt[$t]):(It.write(_t[$t],wt),wt+=gt[$t]);return It}destroy(ft){ft&&this.emit("error",ft)}};e.exports=d}),Ud=M(i=>{v(),m(),_(),i.parser=_d().parser,i.generate=Ld(),i.writeToStream=zo()}),Yo=M(i=>{v(),m(),_(),Object.defineProperty(i,"__esModule",{value:!0});var e=class{constructor(){this.nextId=Math.max(1,Math.floor(Math.random()*65535))}allocate(){let a=this.nextId++;return this.nextId===65536&&(this.nextId=1),a}getLastAllocated(){return this.nextId===1?65535:this.nextId-1}register(a){return!0}deallocate(a){}clear(){}};i.default=e}),qd=M((i,e)=>{v(),m(),_(),e.exports=c;function a(d){return d instanceof k?k.from(d):new d.constructor(d.buffer.slice(),d.byteOffset,d.length)}function c(d){if(d=d||{},d.circles)return h(d);return d.proto?gt:ft;function et(_t,wt){for(var $t=Object.keys(_t),It=new Array($t.length),Rt=0;Rt<$t.length;Rt++){var Tt=$t[Rt],At=_t[Tt];typeof At!="object"||At===null?It[Tt]=At:At instanceof Date?It[Tt]=new Date(At):ArrayBuffer.isView(At)?It[Tt]=a(At):It[Tt]=wt(At)}return It}function ft(_t){if(typeof _t!="object"||_t===null)return _t;if(_t instanceof Date)return new Date(_t);if(Array.isArray(_t))return et(_t,ft);if(_t instanceof Map)return new Map(et(Array.from(_t),ft));if(_t instanceof Set)return new Set(et(Array.from(_t),ft));var wt={};for(var $t in _t)if(Object.hasOwnProperty.call(_t,$t)!==!1){var It=_t[$t];typeof It!="object"||It===null?wt[$t]=It:It instanceof Date?wt[$t]=new Date(It):It instanceof Map?wt[$t]=new Map(et(Array.from(It),ft)):It instanceof Set?wt[$t]=new Set(et(Array.from(It),ft)):ArrayBuffer.isView(It)?wt[$t]=a(It):wt[$t]=ft(It)}return wt}function gt(_t){if(typeof _t!="object"||_t===null)return _t;if(_t instanceof Date)return new Date(_t);if(Array.isArray(_t))return et(_t,gt);if(_t instanceof Map)return new Map(et(Array.from(_t),gt));if(_t instanceof Set)return new Set(et(Array.from(_t),gt));var wt={};for(var $t in _t){var It=_t[$t];typeof It!="object"||It===null?wt[$t]=It:It instanceof Date?wt[$t]=new Date(It):It instanceof Map?wt[$t]=new Map(et(Array.from(It),gt)):It instanceof Set?wt[$t]=new Set(et(Array.from(It),gt)):ArrayBuffer.isView(It)?wt[$t]=a(It):wt[$t]=gt(It)}return wt}}function h(d){var et=[],ft=[];return d.proto?wt:_t;function gt($t,It){for(var Rt=Object.keys($t),Tt=new Array(Rt.length),At=0;At<Rt.length;At++){var kt=Rt[At],xt=$t[kt];if(typeof xt!="object"||xt===null)Tt[kt]=xt;else if(xt instanceof Date)Tt[kt]=new Date(xt);else if(ArrayBuffer.isView(xt))Tt[kt]=a(xt);else{var Nt=et.indexOf(xt);Nt!==-1?Tt[kt]=ft[Nt]:Tt[kt]=It(xt)}}return Tt}function _t($t){if(typeof $t!="object"||$t===null)return $t;if($t instanceof Date)return new Date($t);if(Array.isArray($t))return gt($t,_t);if($t instanceof Map)return new Map(gt(Array.from($t),_t));if($t instanceof Set)return new Set(gt(Array.from($t),_t));var It={};et.push($t),ft.push(It);for(var Rt in $t)if(Object.hasOwnProperty.call($t,Rt)!==!1){var Tt=$t[Rt];if(typeof Tt!="object"||Tt===null)It[Rt]=Tt;else if(Tt instanceof Date)It[Rt]=new Date(Tt);else if(Tt instanceof Map)It[Rt]=new Map(gt(Array.from(Tt),_t));else if(Tt instanceof Set)It[Rt]=new Set(gt(Array.from(Tt),_t));else if(ArrayBuffer.isView(Tt))It[Rt]=a(Tt);else{var At=et.indexOf(Tt);At!==-1?It[Rt]=ft[At]:It[Rt]=_t(Tt)}}return et.pop(),ft.pop(),It}function wt($t){if(typeof $t!="object"||$t===null)return $t;if($t instanceof Date)return new Date($t);if(Array.isArray($t))return gt($t,wt);if($t instanceof Map)return new Map(gt(Array.from($t),wt));if($t instanceof Set)return new Set(gt(Array.from($t),wt));var It={};et.push($t),ft.push(It);for(var Rt in $t){var Tt=$t[Rt];if(typeof Tt!="object"||Tt===null)It[Rt]=Tt;else if(Tt instanceof Date)It[Rt]=new Date(Tt);else if(Tt instanceof Map)It[Rt]=new Map(gt(Array.from(Tt),wt));else if(Tt instanceof Set)It[Rt]=new Set(gt(Array.from(Tt),wt));else if(ArrayBuffer.isView(Tt))It[Rt]=a(Tt);else{var At=et.indexOf(Tt);At!==-1?It[Rt]=ft[At]:It[Rt]=wt(Tt)}}return et.pop(),ft.pop(),It}}}),jd=M((i,e)=>{v(),m(),_(),e.exports=qd()()}),Wd=M(i=>{v(),m(),_(),Object.defineProperty(i,"__esModule",{value:!0}),i.validateTopics=i.validateTopic=void 0;function e(c){let h=c.split("/");for(let d=0;d<h.length;d++)if(h[d]!=="+"){if(h[d]==="#")return d===h.length-1;if(h[d].indexOf("+")!==-1||h[d].indexOf("#")!==-1)return!1}return!0}i.validateTopic=e;function a(c){if(c.length===0)return"empty_topic_list";for(let h=0;h<c.length;h++)if(!e(c[h]))return c[h];return null}i.validateTopics=a}),Zo=M(i=>{v(),m(),_(),Object.defineProperty(i,"__esModule",{value:!0});var e=Dt(),a={objectMode:!0},c={clean:!0},h=class{constructor(d){this.options=d||{},this.options=Object.assign(Object.assign({},c),d),this._inflights=new Map}put(d,et){return this._inflights.set(d.messageId,d),et&&et(),this}createStream(){let d=new e.Readable(a),et=[],ft=!1,gt=0;return this._inflights.forEach((_t,wt)=>{et.push(_t)}),d._read=()=>{!ft&&gt<et.length?d.push(et[gt++]):d.push(null)},d.destroy=_t=>{if(!ft)return ft=!0,setTimeout(()=>{d.emit("close")},0),d},d}del(d,et){let ft=this._inflights.get(d.messageId);return ft?(this._inflights.delete(d.messageId),et(null,ft)):et&&et(new Error("missing packet")),this}get(d,et){let ft=this._inflights.get(d.messageId);return ft?et(null,ft):et&&et(new Error("missing packet")),this}close(d){this.options.clean&&(this._inflights=null),d&&d()}};i.default=h}),Hd=M(i=>{v(),m(),_(),Object.defineProperty(i,"__esModule",{value:!0});var e=[0,16,128,131,135,144,145,151,153],a=(c,h,d)=>{c.log("handlePublish: packet %o",h),d=typeof d<"u"?d:c.noop;let et=h.topic.toString(),ft=h.payload,{qos:gt}=h,{messageId:_t}=h,{options:wt}=c;if(c.options.protocolVersion===5){let $t;if(h.properties&&($t=h.properties.topicAlias),typeof $t<"u")if(et.length===0)if($t>0&&$t<=65535){let It=c.topicAliasRecv.getTopicByAlias($t);if(It)et=It,c.log("handlePublish :: topic complemented by alias. topic: %s - alias: %d",et,$t);else{c.log("handlePublish :: unregistered topic alias. alias: %d",$t),c.emit("error",new Error("Received unregistered Topic Alias"));return}}else{c.log("handlePublish :: topic alias out of range. alias: %d",$t),c.emit("error",new Error("Received Topic Alias is out of range"));return}else if(c.topicAliasRecv.put(et,$t))c.log("handlePublish :: registered topic: %s - alias: %d",et,$t);else{c.log("handlePublish :: topic alias out of range. alias: %d",$t),c.emit("error",new Error("Received Topic Alias is out of range"));return}}switch(c.log("handlePublish: qos %d",gt),gt){case 2:{wt.customHandleAcks(et,ft,h,($t,It)=>{if(typeof $t=="number"&&(It=$t,$t=null),$t)return c.emit("error",$t);if(e.indexOf(It)===-1)return c.emit("error",new Error("Wrong reason code for pubrec"));It?c._sendPacket({cmd:"pubrec",messageId:_t,reasonCode:It},d):c.incomingStore.put(h,()=>{c._sendPacket({cmd:"pubrec",messageId:_t},d)})});break}case 1:{wt.customHandleAcks(et,ft,h,($t,It)=>{if(typeof $t=="number"&&(It=$t,$t=null),$t)return c.emit("error",$t);if(e.indexOf(It)===-1)return c.emit("error",new Error("Wrong reason code for puback"));It||c.emit("message",et,ft,h),c.handleMessage(h,Rt=>{if(Rt)return d&&d(Rt);c._sendPacket({cmd:"puback",messageId:_t,reasonCode:It},d)})});break}case 0:c.emit("message",et,ft,h),c.handleMessage(h,d);break;default:c.log("handlePublish: unknown QoS. Doing nothing.");break}};i.default=a}),Yr=M(i=>{v(),m(),_(),Object.defineProperty(i,"__esModule",{value:!0}),i.nextTick=i.applyMixin=i.ErrorWithReasonCode=void 0;var e=class Rl extends Error{constructor(h,d){super(h),this.code=d,Object.setPrototypeOf(this,Rl.prototype),Object.getPrototypeOf(this).name="ErrorWithReasonCode"}};i.ErrorWithReasonCode=e;function a(c,h,d=!1){var et;let ft=[h];for(;;){let gt=ft[0],_t=Object.getPrototypeOf(gt);if(_t!=null&&_t.prototype)ft.unshift(_t);else break}for(let gt of ft)for(let _t of Object.getOwnPropertyNames(gt.prototype))(d||_t!=="constructor")&&Object.defineProperty(c.prototype,_t,(et=Object.getOwnPropertyDescriptor(gt.prototype,_t))!==null&&et!==void 0?et:Object.create(null))}i.applyMixin=a,i.nextTick=P?P.nextTick:c=>{setTimeout(c,0)}}),Si=M(i=>{v(),m(),_(),Object.defineProperty(i,"__esModule",{value:!0}),i.ReasonCodes=void 0,i.ReasonCodes={0:"",1:"Unacceptable protocol version",2:"Identifier rejected",3:"Server unavailable",4:"Bad username or password",5:"Not authorized",16:"No matching subscribers",17:"No subscription existed",128:"Unspecified error",129:"Malformed Packet",130:"Protocol Error",131:"Implementation specific error",132:"Unsupported Protocol Version",133:"Client Identifier not valid",134:"Bad User Name or Password",135:"Not authorized",136:"Server unavailable",137:"Server busy",138:"Banned",139:"Server shutting down",140:"Bad authentication method",141:"Keep Alive timeout",142:"Session taken over",143:"Topic Filter invalid",144:"Topic Name invalid",145:"Packet identifier in use",146:"Packet Identifier not found",147:"Receive Maximum exceeded",148:"Topic Alias invalid",149:"Packet too large",150:"Message rate too high",151:"Quota exceeded",152:"Administrative action",153:"Payload format invalid",154:"Retain not supported",155:"QoS not supported",156:"Use another server",157:"Server moved",158:"Shared Subscriptions not supported",159:"Connection rate exceeded",160:"Maximum connect time",161:"Subscription Identifiers not supported",162:"Wildcard Subscriptions not supported"};var e=(a,c)=>{let{messageId:h}=c,d=c.cmd,et=null,ft=a.outgoing[h]?a.outgoing[h].cb:null,gt;if(!ft){a.log("_handleAck :: Server sent an ack in error. Ignoring.");return}switch(a.log("_handleAck :: packet type",d),d){case"pubcomp":case"puback":{let _t=c.reasonCode;_t&&_t>0&&_t!==16?(gt=new Error(`Publish error: ${i.ReasonCodes[_t]}`),gt.code=_t,a._removeOutgoingAndStoreMessage(h,()=>{ft(gt,c)})):a._removeOutgoingAndStoreMessage(h,ft);break}case"pubrec":{et={cmd:"pubrel",qos:2,messageId:h};let _t=c.reasonCode;_t&&_t>0&&_t!==16?(gt=new Error(`Publish error: ${i.ReasonCodes[_t]}`),gt.code=_t,a._removeOutgoingAndStoreMessage(h,()=>{ft(gt,c)})):a._sendPacket(et);break}case"suback":{delete a.outgoing[h],a.messageIdProvider.deallocate(h);let _t=c.granted;for(let wt=0;wt<_t.length;wt++)if(_t[wt]&128){let $t=a.messageIdToTopic[h];$t&&$t.forEach(It=>{delete a._resubscribeTopics[It]})}delete a.messageIdToTopic[h],a._invokeStoreProcessingQueue(),ft(null,c);break}case"unsuback":{delete a.outgoing[h],a.messageIdProvider.deallocate(h),a._invokeStoreProcessingQueue(),ft(null);break}default:a.emit("error",new Error("unrecognized packet type"))}a.disconnecting&&Object.keys(a.outgoing).length===0&&a.emit("outgoingEmpty")};i.default=e}),zd=M(i=>{v(),m(),_(),Object.defineProperty(i,"__esModule",{value:!0});var e=Yr(),a=Si(),c=(h,d)=>{let{options:et}=h,ft=et.protocolVersion,gt=ft===5?d.reasonCode:d.returnCode;if(ft!==5){let _t=new e.ErrorWithReasonCode(`Protocol error: Auth packets are only supported in MQTT 5. Your version:${ft}`,gt);h.emit("error",_t);return}h.handleAuth(d,(_t,wt)=>{if(_t){h.emit("error",_t);return}if(gt===24)h.reconnecting=!1,h._sendPacket(wt);else{let $t=new e.ErrorWithReasonCode(`Connection refused: ${a.ReasonCodes[gt]}`,gt);h.emit("error",$t)}})};i.default=c}),Jd=M(i=>{var Rt,Tt,At,kt,xt,Nt,Ft,jt,Gt,Kt,Wt,Zt,cr,hr,gr,er,mr,Mr,wr,Dr,Tr,fr,yr,$r,Fr,dr,Qo,Hr,Jr,zr,br,_r,Al,lr,Cr,xr,Kr,Rs,vr,As,Pr,Xo,Wr,So,Xr,$o,pn,Mn,Tn,Jo,Vt,ao,Er;v(),m(),_(),Object.defineProperty(i,"__esModule",{value:!0}),i.LRUCache=void 0;var e=typeof performance=="object"&&performance&&typeof performance.now=="function"?performance:Date,a=new Set,c=typeof P=="object"&&P?P:{},h=(Sr,pr,Rr,Qr)=>{typeof c.emitWarning=="function"?c.emitWarning(Sr,pr,Rr,Qr):console.error(`[${Rr}] ${pr}: ${Sr}`)},d=globalThis.AbortController,et=globalThis.AbortSignal;if(typeof d>"u"){et=class{constructor(){qt(this,"onabort");qt(this,"_onabort",[]);qt(this,"reason");qt(this,"aborted",!1)}addEventListener(Rr,Qr){this._onabort.push(Qr)}},d=class{constructor(){qt(this,"signal",new et);pr()}abort(Rr){var Qr,nn;if(!this.signal.aborted){this.signal.reason=Rr,this.signal.aborted=!0;for(let rn of this.signal._onabort)rn(Rr);(nn=(Qr=this.signal).onabort)==null||nn.call(Qr,Rr)}}};let Sr=((Rt=c.env)==null?void 0:Rt.LRU_CACHE_IGNORE_AC_WARNING)!=="1",pr=()=>{Sr&&(Sr=!1,h("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",pr))}}var ft=Sr=>!a.has(Sr),gt=Sr=>Sr&&Sr===Math.floor(Sr)&&Sr>0&&isFinite(Sr),_t=Sr=>gt(Sr)?Sr<=Math.pow(2,8)?Uint8Array:Sr<=Math.pow(2,16)?Uint16Array:Sr<=Math.pow(2,32)?Uint32Array:Sr<=Number.MAX_SAFE_INTEGER?wt:null:null,wt=class extends Array{constructor(Sr){super(Sr),this.fill(0)}},$t=(Tt=class{constructor(pr,Rr){qt(this,"heap");qt(this,"length");if(!ur(Tt,At))throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new Rr(pr),this.length=0}static create(pr){let Rr=_t(pr);if(!Rr)return[];yn(Tt,At,!0);let Qr=new Tt(pr,Rr);return yn(Tt,At,!1),Qr}push(pr){this.heap[this.length++]=pr}pop(){return this.heap[--this.length]}},At=new WeakMap,gn(Tt,At,!1),Tt),It=(Er=class{constructor(pr){gn(this,dr);gn(this,_r);gn(this,Kr);gn(this,vr);gn(this,Pr);gn(this,Wr);gn(this,Xr);gn(this,pn);gn(this,Tn);gn(this,Vt);gn(this,kt,void 0);gn(this,xt,void 0);gn(this,Nt,void 0);gn(this,Ft,void 0);gn(this,jt,void 0);qt(this,"ttl");qt(this,"ttlResolution");qt(this,"ttlAutopurge");qt(this,"updateAgeOnGet");qt(this,"updateAgeOnHas");qt(this,"allowStale");qt(this,"noDisposeOnSet");qt(this,"noUpdateTTL");qt(this,"maxEntrySize");qt(this,"sizeCalculation");qt(this,"noDeleteOnFetchRejection");qt(this,"noDeleteOnStaleGet");qt(this,"allowStaleOnFetchAbort");qt(this,"allowStaleOnFetchRejection");qt(this,"ignoreFetchAbort");gn(this,Gt,void 0);gn(this,Kt,void 0);gn(this,Wt,void 0);gn(this,Zt,void 0);gn(this,cr,void 0);gn(this,hr,void 0);gn(this,gr,void 0);gn(this,er,void 0);gn(this,mr,void 0);gn(this,Mr,void 0);gn(this,wr,void 0);gn(this,Dr,void 0);gn(this,Tr,void 0);gn(this,fr,void 0);gn(this,yr,void 0);gn(this,$r,void 0);gn(this,Fr,void 0);gn(this,Hr,()=>{});gn(this,Jr,()=>{});gn(this,zr,()=>{});gn(this,br,()=>!1);gn(this,lr,pr=>{});gn(this,Cr,(pr,Rr,Qr)=>{});gn(this,xr,(pr,Rr,Qr,nn)=>{if(Qr||nn)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0});let{max:Rr=0,ttl:Qr,ttlResolution:nn=1,ttlAutopurge:rn,updateAgeOnGet:fn,updateAgeOnHas:bn,allowStale:In,dispose:On,disposeAfter:Vn,noDisposeOnSet:xn,noUpdateTTL:jn,maxSize:jr=0,maxEntrySize:qr=0,sizeCalculation:Zr,fetchMethod:dn,noDeleteOnFetchRejection:cn,noDeleteOnStaleGet:Sn,allowStaleOnFetchRejection:$n,allowStaleOnFetchAbort:En,ignoreFetchAbort:wn}=pr;if(Rr!==0&&!gt(Rr))throw new TypeError("max option must be a nonnegative integer");let Cn=Rr?_t(Rr):Array;if(!Cn)throw new Error("invalid max value: "+Rr);if(yn(this,kt,Rr),yn(this,xt,jr),this.maxEntrySize=qr||ur(this,xt),this.sizeCalculation=Zr,this.sizeCalculation){if(!ur(this,xt)&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if(typeof this.sizeCalculation!="function")throw new TypeError("sizeCalculation set to non-function")}if(dn!==void 0&&typeof dn!="function")throw new TypeError("fetchMethod must be a function if specified");if(yn(this,jt,dn),yn(this,$r,!!dn),yn(this,Wt,new Map),yn(this,Zt,new Array(Rr).fill(void 0)),yn(this,cr,new Array(Rr).fill(void 0)),yn(this,hr,new Cn(Rr)),yn(this,gr,new Cn(Rr)),yn(this,er,0),yn(this,mr,0),yn(this,Mr,$t.create(Rr)),yn(this,Gt,0),yn(this,Kt,0),typeof On=="function"&&yn(this,Nt,On),typeof Vn=="function"?(yn(this,Ft,Vn),yn(this,wr,[])):(yn(this,Ft,void 0),yn(this,wr,void 0)),yn(this,yr,!!ur(this,Nt)),yn(this,Fr,!!ur(this,Ft)),this.noDisposeOnSet=!!xn,this.noUpdateTTL=!!jn,this.noDeleteOnFetchRejection=!!cn,this.allowStaleOnFetchRejection=!!$n,this.allowStaleOnFetchAbort=!!En,this.ignoreFetchAbort=!!wn,this.maxEntrySize!==0){if(ur(this,xt)!==0&&!gt(ur(this,xt)))throw new TypeError("maxSize must be a positive integer if specified");if(!gt(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");_n(this,_r,Al).call(this)}if(this.allowStale=!!In,this.noDeleteOnStaleGet=!!Sn,this.updateAgeOnGet=!!fn,this.updateAgeOnHas=!!bn,this.ttlResolution=gt(nn)||nn===0?nn:1,this.ttlAutopurge=!!rn,this.ttl=Qr||0,this.ttl){if(!gt(this.ttl))throw new TypeError("ttl must be a positive integer if specified");_n(this,dr,Qo).call(this)}if(ur(this,kt)===0&&this.ttl===0&&ur(this,xt)===0)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!ur(this,kt)&&!ur(this,xt)){let Nn="LRU_CACHE_UNBOUNDED";ft(Nn)&&(a.add(Nn),h("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",Nn,Er))}}static unsafeExposeInternals(pr){return{starts:ur(pr,Tr),ttls:ur(pr,fr),sizes:ur(pr,Dr),keyMap:ur(pr,Wt),keyList:ur(pr,Zt),valList:ur(pr,cr),next:ur(pr,hr),prev:ur(pr,gr),get head(){return ur(pr,er)},get tail(){return ur(pr,mr)},free:ur(pr,Mr),isBackgroundFetch:Rr=>{var Qr;return _n(Qr=pr,pn,Mn).call(Qr,Rr)},backgroundFetch:(Rr,Qr,nn,rn)=>{var fn;return _n(fn=pr,Xr,$o).call(fn,Rr,Qr,nn,rn)},moveToTail:Rr=>{var Qr;return _n(Qr=pr,Vt,ao).call(Qr,Rr)},indexes:Rr=>{var Qr;return _n(Qr=pr,Kr,Rs).call(Qr,Rr)},rindexes:Rr=>{var Qr;return _n(Qr=pr,vr,As).call(Qr,Rr)},isStale:Rr=>{var Qr;return ur(Qr=pr,br).call(Qr,Rr)}}}get max(){return ur(this,kt)}get maxSize(){return ur(this,xt)}get calculatedSize(){return ur(this,Kt)}get size(){return ur(this,Gt)}get fetchMethod(){return ur(this,jt)}get dispose(){return ur(this,Nt)}get disposeAfter(){return ur(this,Ft)}getRemainingTTL(pr){return ur(this,Wt).has(pr)?1/0:0}*entries(){for(let pr of _n(this,Kr,Rs).call(this))ur(this,cr)[pr]!==void 0&&ur(this,Zt)[pr]!==void 0&&!_n(this,pn,Mn).call(this,ur(this,cr)[pr])&&(yield[ur(this,Zt)[pr],ur(this,cr)[pr]])}*rentries(){for(let pr of _n(this,vr,As).call(this))ur(this,cr)[pr]!==void 0&&ur(this,Zt)[pr]!==void 0&&!_n(this,pn,Mn).call(this,ur(this,cr)[pr])&&(yield[ur(this,Zt)[pr],ur(this,cr)[pr]])}*keys(){for(let pr of _n(this,Kr,Rs).call(this)){let Rr=ur(this,Zt)[pr];Rr!==void 0&&!_n(this,pn,Mn).call(this,ur(this,cr)[pr])&&(yield Rr)}}*rkeys(){for(let pr of _n(this,vr,As).call(this)){let Rr=ur(this,Zt)[pr];Rr!==void 0&&!_n(this,pn,Mn).call(this,ur(this,cr)[pr])&&(yield Rr)}}*values(){for(let pr of _n(this,Kr,Rs).call(this))ur(this,cr)[pr]!==void 0&&!_n(this,pn,Mn).call(this,ur(this,cr)[pr])&&(yield ur(this,cr)[pr])}*rvalues(){for(let pr of _n(this,vr,As).call(this))ur(this,cr)[pr]!==void 0&&!_n(this,pn,Mn).call(this,ur(this,cr)[pr])&&(yield ur(this,cr)[pr])}[Symbol.iterator](){return this.entries()}find(pr,Rr={}){for(let Qr of _n(this,Kr,Rs).call(this)){let nn=ur(this,cr)[Qr],rn=_n(this,pn,Mn).call(this,nn)?nn.__staleWhileFetching:nn;if(rn!==void 0&&pr(rn,ur(this,Zt)[Qr],this))return this.get(ur(this,Zt)[Qr],Rr)}}forEach(pr,Rr=this){for(let Qr of _n(this,Kr,Rs).call(this)){let nn=ur(this,cr)[Qr],rn=_n(this,pn,Mn).call(this,nn)?nn.__staleWhileFetching:nn;rn!==void 0&&pr.call(Rr,rn,ur(this,Zt)[Qr],this)}}rforEach(pr,Rr=this){for(let Qr of _n(this,vr,As).call(this)){let nn=ur(this,cr)[Qr],rn=_n(this,pn,Mn).call(this,nn)?nn.__staleWhileFetching:nn;rn!==void 0&&pr.call(Rr,rn,ur(this,Zt)[Qr],this)}}purgeStale(){let pr=!1;for(let Rr of _n(this,vr,As).call(this,{allowStale:!0}))ur(this,br).call(this,Rr)&&(this.delete(ur(this,Zt)[Rr]),pr=!0);return pr}dump(){let pr=[];for(let Rr of _n(this,Kr,Rs).call(this,{allowStale:!0})){let Qr=ur(this,Zt)[Rr],nn=ur(this,cr)[Rr],rn=_n(this,pn,Mn).call(this,nn)?nn.__staleWhileFetching:nn;if(rn===void 0||Qr===void 0)continue;let fn={value:rn};if(ur(this,fr)&&ur(this,Tr)){fn.ttl=ur(this,fr)[Rr];let bn=e.now()-ur(this,Tr)[Rr];fn.start=Math.floor(Date.now()-bn)}ur(this,Dr)&&(fn.size=ur(this,Dr)[Rr]),pr.unshift([Qr,fn])}return pr}load(pr){this.clear();for(let[Rr,Qr]of pr){if(Qr.start){let nn=Date.now()-Qr.start;Qr.start=e.now()-nn}this.set(Rr,Qr.value,Qr)}}set(pr,Rr,Qr={}){var jn,jr,qr,Zr,dn;if(Rr===void 0)return this.delete(pr),this;let{ttl:nn=this.ttl,start:rn,noDisposeOnSet:fn=this.noDisposeOnSet,sizeCalculation:bn=this.sizeCalculation,status:In}=Qr,{noUpdateTTL:On=this.noUpdateTTL}=Qr,Vn=ur(this,xr).call(this,pr,Rr,Qr.size||0,bn);if(this.maxEntrySize&&Vn>this.maxEntrySize)return In&&(In.set="miss",In.maxEntrySizeExceeded=!0),this.delete(pr),this;let xn=ur(this,Gt)===0?void 0:ur(this,Wt).get(pr);if(xn===void 0)xn=ur(this,Gt)===0?ur(this,mr):ur(this,Mr).length!==0?ur(this,Mr).pop():ur(this,Gt)===ur(this,kt)?_n(this,Wr,So).call(this,!1):ur(this,Gt),ur(this,Zt)[xn]=pr,ur(this,cr)[xn]=Rr,ur(this,Wt).set(pr,xn),ur(this,hr)[ur(this,mr)]=xn,ur(this,gr)[xn]=ur(this,mr),yn(this,mr,xn),Ds(this,Gt)._++,ur(this,Cr).call(this,xn,Vn,In),In&&(In.set="add"),On=!1;else{_n(this,Vt,ao).call(this,xn);let cn=ur(this,cr)[xn];if(Rr!==cn){if(ur(this,$r)&&_n(this,pn,Mn).call(this,cn)){cn.__abortController.abort(new Error("replaced"));let{__staleWhileFetching:Sn}=cn;Sn!==void 0&&!fn&&(ur(this,yr)&&((jn=ur(this,Nt))==null||jn.call(this,Sn,pr,"set")),ur(this,Fr)&&((jr=ur(this,wr))==null||jr.push([Sn,pr,"set"])))}else fn||(ur(this,yr)&&((qr=ur(this,Nt))==null||qr.call(this,cn,pr,"set")),ur(this,Fr)&&((Zr=ur(this,wr))==null||Zr.push([cn,pr,"set"])));if(ur(this,lr).call(this,xn),ur(this,Cr).call(this,xn,Vn,In),ur(this,cr)[xn]=Rr,In){In.set="replace";let Sn=cn&&_n(this,pn,Mn).call(this,cn)?cn.__staleWhileFetching:cn;Sn!==void 0&&(In.oldValue=Sn)}}else In&&(In.set="update")}if(nn!==0&&!ur(this,fr)&&_n(this,dr,Qo).call(this),ur(this,fr)&&(On||ur(this,zr).call(this,xn,nn,rn),In&&ur(this,Jr).call(this,In,xn)),!fn&&ur(this,Fr)&&ur(this,wr)){let cn=ur(this,wr),Sn;for(;Sn=cn==null?void 0:cn.shift();)(dn=ur(this,Ft))==null||dn.call(this,...Sn)}return this}pop(){var pr;try{for(;ur(this,Gt);){let Rr=ur(this,cr)[ur(this,er)];if(_n(this,Wr,So).call(this,!0),_n(this,pn,Mn).call(this,Rr)){if(Rr.__staleWhileFetching)return Rr.__staleWhileFetching}else if(Rr!==void 0)return Rr}}finally{if(ur(this,Fr)&&ur(this,wr)){let Rr=ur(this,wr),Qr;for(;Qr=Rr==null?void 0:Rr.shift();)(pr=ur(this,Ft))==null||pr.call(this,...Qr)}}}has(pr,Rr={}){let{updateAgeOnHas:Qr=this.updateAgeOnHas,status:nn}=Rr,rn=ur(this,Wt).get(pr);if(rn!==void 0){let fn=ur(this,cr)[rn];if(_n(this,pn,Mn).call(this,fn)&&fn.__staleWhileFetching===void 0)return!1;if(ur(this,br).call(this,rn))nn&&(nn.has="stale",ur(this,Jr).call(this,nn,rn));else return Qr&&ur(this,Hr).call(this,rn),nn&&(nn.has="hit",ur(this,Jr).call(this,nn,rn)),!0}else nn&&(nn.has="miss");return!1}peek(pr,Rr={}){let{allowStale:Qr=this.allowStale}=Rr,nn=ur(this,Wt).get(pr);if(nn!==void 0&&(Qr||!ur(this,br).call(this,nn))){let rn=ur(this,cr)[nn];return _n(this,pn,Mn).call(this,rn)?rn.__staleWhileFetching:rn}}async fetch(pr,Rr={}){let{allowStale:Qr=this.allowStale,updateAgeOnGet:nn=this.updateAgeOnGet,noDeleteOnStaleGet:rn=this.noDeleteOnStaleGet,ttl:fn=this.ttl,noDisposeOnSet:bn=this.noDisposeOnSet,size:In=0,sizeCalculation:On=this.sizeCalculation,noUpdateTTL:Vn=this.noUpdateTTL,noDeleteOnFetchRejection:xn=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:jn=this.allowStaleOnFetchRejection,ignoreFetchAbort:jr=this.ignoreFetchAbort,allowStaleOnFetchAbort:qr=this.allowStaleOnFetchAbort,context:Zr,forceRefresh:dn=!1,status:cn,signal:Sn}=Rr;if(!ur(this,$r))return cn&&(cn.fetch="get"),this.get(pr,{allowStale:Qr,updateAgeOnGet:nn,noDeleteOnStaleGet:rn,status:cn});let $n={allowStale:Qr,updateAgeOnGet:nn,noDeleteOnStaleGet:rn,ttl:fn,noDisposeOnSet:bn,size:In,sizeCalculation:On,noUpdateTTL:Vn,noDeleteOnFetchRejection:xn,allowStaleOnFetchRejection:jn,allowStaleOnFetchAbort:qr,ignoreFetchAbort:jr,status:cn,signal:Sn},En=ur(this,Wt).get(pr);if(En===void 0){cn&&(cn.fetch="miss");let wn=_n(this,Xr,$o).call(this,pr,En,$n,Zr);return wn.__returned=wn}else{let wn=ur(this,cr)[En];if(_n(this,pn,Mn).call(this,wn)){let Pn=Qr&&wn.__staleWhileFetching!==void 0;return cn&&(cn.fetch="inflight",Pn&&(cn.returnedStale=!0)),Pn?wn.__staleWhileFetching:wn.__returned=wn}let Cn=ur(this,br).call(this,En);if(!dn&&!Cn)return cn&&(cn.fetch="hit"),_n(this,Vt,ao).call(this,En),nn&&ur(this,Hr).call(this,En),cn&&ur(this,Jr).call(this,cn,En),wn;let Nn=_n(this,Xr,$o).call(this,pr,En,$n,Zr),Rn=Nn.__staleWhileFetching!==void 0&&Qr;return cn&&(cn.fetch=Cn?"stale":"refresh",Rn&&Cn&&(cn.returnedStale=!0)),Rn?Nn.__staleWhileFetching:Nn.__returned=Nn}}get(pr,Rr={}){let{allowStale:Qr=this.allowStale,updateAgeOnGet:nn=this.updateAgeOnGet,noDeleteOnStaleGet:rn=this.noDeleteOnStaleGet,status:fn}=Rr,bn=ur(this,Wt).get(pr);if(bn!==void 0){let In=ur(this,cr)[bn],On=_n(this,pn,Mn).call(this,In);return fn&&ur(this,Jr).call(this,fn,bn),ur(this,br).call(this,bn)?(fn&&(fn.get="stale"),On?(fn&&Qr&&In.__staleWhileFetching!==void 0&&(fn.returnedStale=!0),Qr?In.__staleWhileFetching:void 0):(rn||this.delete(pr),fn&&Qr&&(fn.returnedStale=!0),Qr?In:void 0)):(fn&&(fn.get="hit"),On?In.__staleWhileFetching:(_n(this,Vt,ao).call(this,bn),nn&&ur(this,Hr).call(this,bn),In))}else fn&&(fn.get="miss")}delete(pr){var Qr,nn,rn,fn;let Rr=!1;if(ur(this,Gt)!==0){let bn=ur(this,Wt).get(pr);if(bn!==void 0)if(Rr=!0,ur(this,Gt)===1)this.clear();else{ur(this,lr).call(this,bn);let In=ur(this,cr)[bn];_n(this,pn,Mn).call(this,In)?In.__abortController.abort(new Error("deleted")):(ur(this,yr)||ur(this,Fr))&&(ur(this,yr)&&((Qr=ur(this,Nt))==null||Qr.call(this,In,pr,"delete")),ur(this,Fr)&&((nn=ur(this,wr))==null||nn.push([In,pr,"delete"]))),ur(this,Wt).delete(pr),ur(this,Zt)[bn]=void 0,ur(this,cr)[bn]=void 0,bn===ur(this,mr)?yn(this,mr,ur(this,gr)[bn]):bn===ur(this,er)?yn(this,er,ur(this,hr)[bn]):(ur(this,hr)[ur(this,gr)[bn]]=ur(this,hr)[bn],ur(this,gr)[ur(this,hr)[bn]]=ur(this,gr)[bn]),Ds(this,Gt)._--,ur(this,Mr).push(bn)}}if(ur(this,Fr)&&((rn=ur(this,wr))!=null&&rn.length)){let bn=ur(this,wr),In;for(;In=bn==null?void 0:bn.shift();)(fn=ur(this,Ft))==null||fn.call(this,...In)}return Rr}clear(){var pr,Rr,Qr;for(let nn of _n(this,vr,As).call(this,{allowStale:!0})){let rn=ur(this,cr)[nn];if(_n(this,pn,Mn).call(this,rn))rn.__abortController.abort(new Error("deleted"));else{let fn=ur(this,Zt)[nn];ur(this,yr)&&((pr=ur(this,Nt))==null||pr.call(this,rn,fn,"delete")),ur(this,Fr)&&((Rr=ur(this,wr))==null||Rr.push([rn,fn,"delete"]))}}if(ur(this,Wt).clear(),ur(this,cr).fill(void 0),ur(this,Zt).fill(void 0),ur(this,fr)&&ur(this,Tr)&&(ur(this,fr).fill(0),ur(this,Tr).fill(0)),ur(this,Dr)&&ur(this,Dr).fill(0),yn(this,er,0),yn(this,mr,0),ur(this,Mr).length=0,yn(this,Kt,0),yn(this,Gt,0),ur(this,Fr)&&ur(this,wr)){let nn=ur(this,wr),rn;for(;rn=nn==null?void 0:nn.shift();)(Qr=ur(this,Ft))==null||Qr.call(this,...rn)}}},kt=new WeakMap,xt=new WeakMap,Nt=new WeakMap,Ft=new WeakMap,jt=new WeakMap,Gt=new WeakMap,Kt=new WeakMap,Wt=new WeakMap,Zt=new WeakMap,cr=new WeakMap,hr=new WeakMap,gr=new WeakMap,er=new WeakMap,mr=new WeakMap,Mr=new WeakMap,wr=new WeakMap,Dr=new WeakMap,Tr=new WeakMap,fr=new WeakMap,yr=new WeakMap,$r=new WeakMap,Fr=new WeakMap,dr=new WeakSet,Qo=function(){let pr=new wt(ur(this,kt)),Rr=new wt(ur(this,kt));yn(this,fr,pr),yn(this,Tr,Rr),yn(this,zr,(rn,fn,bn=e.now())=>{if(Rr[rn]=fn!==0?bn:0,pr[rn]=fn,fn!==0&&this.ttlAutopurge){let In=setTimeout(()=>{ur(this,br).call(this,rn)&&this.delete(ur(this,Zt)[rn])},fn+1);In.unref&&In.unref()}}),yn(this,Hr,rn=>{Rr[rn]=pr[rn]!==0?e.now():0}),yn(this,Jr,(rn,fn)=>{if(pr[fn]){let bn=pr[fn],In=Rr[fn];rn.ttl=bn,rn.start=In,rn.now=Qr||nn();let On=rn.now-In;rn.remainingTTL=bn-On}});let Qr=0,nn=()=>{let rn=e.now();if(this.ttlResolution>0){Qr=rn;let fn=setTimeout(()=>Qr=0,this.ttlResolution);fn.unref&&fn.unref()}return rn};this.getRemainingTTL=rn=>{let fn=ur(this,Wt).get(rn);if(fn===void 0)return 0;let bn=pr[fn],In=Rr[fn];if(bn===0||In===0)return 1/0;let On=(Qr||nn())-In;return bn-On},yn(this,br,rn=>pr[rn]!==0&&Rr[rn]!==0&&(Qr||nn())-Rr[rn]>pr[rn])},Hr=new WeakMap,Jr=new WeakMap,zr=new WeakMap,br=new WeakMap,_r=new WeakSet,Al=function(){let pr=new wt(ur(this,kt));yn(this,Kt,0),yn(this,Dr,pr),yn(this,lr,Rr=>{yn(this,Kt,ur(this,Kt)-pr[Rr]),pr[Rr]=0}),yn(this,xr,(Rr,Qr,nn,rn)=>{if(_n(this,pn,Mn).call(this,Qr))return 0;if(!gt(nn))if(rn){if(typeof rn!="function")throw new TypeError("sizeCalculation must be a function");if(nn=rn(Qr,Rr),!gt(nn))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}else throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");return nn}),yn(this,Cr,(Rr,Qr,nn)=>{if(pr[Rr]=Qr,ur(this,xt)){let rn=ur(this,xt)-pr[Rr];for(;ur(this,Kt)>rn;)_n(this,Wr,So).call(this,!0)}yn(this,Kt,ur(this,Kt)+pr[Rr]),nn&&(nn.entrySize=Qr,nn.totalCalculatedSize=ur(this,Kt))})},lr=new WeakMap,Cr=new WeakMap,xr=new WeakMap,Kr=new WeakSet,Rs=function*({allowStale:pr=this.allowStale}={}){if(ur(this,Gt))for(let Rr=ur(this,mr);!(!_n(this,Pr,Xo).call(this,Rr)||((pr||!ur(this,br).call(this,Rr))&&(yield Rr),Rr===ur(this,er)));)Rr=ur(this,gr)[Rr]},vr=new WeakSet,As=function*({allowStale:pr=this.allowStale}={}){if(ur(this,Gt))for(let Rr=ur(this,er);!(!_n(this,Pr,Xo).call(this,Rr)||((pr||!ur(this,br).call(this,Rr))&&(yield Rr),Rr===ur(this,mr)));)Rr=ur(this,hr)[Rr]},Pr=new WeakSet,Xo=function(pr){return pr!==void 0&&ur(this,Wt).get(ur(this,Zt)[pr])===pr},Wr=new WeakSet,So=function(pr){var rn,fn;let Rr=ur(this,er),Qr=ur(this,Zt)[Rr],nn=ur(this,cr)[Rr];return ur(this,$r)&&_n(this,pn,Mn).call(this,nn)?nn.__abortController.abort(new Error("evicted")):(ur(this,yr)||ur(this,Fr))&&(ur(this,yr)&&((rn=ur(this,Nt))==null||rn.call(this,nn,Qr,"evict")),ur(this,Fr)&&((fn=ur(this,wr))==null||fn.push([nn,Qr,"evict"]))),ur(this,lr).call(this,Rr),pr&&(ur(this,Zt)[Rr]=void 0,ur(this,cr)[Rr]=void 0,ur(this,Mr).push(Rr)),ur(this,Gt)===1?(yn(this,er,yn(this,mr,0)),ur(this,Mr).length=0):yn(this,er,ur(this,hr)[Rr]),ur(this,Wt).delete(Qr),Ds(this,Gt)._--,Rr},Xr=new WeakSet,$o=function(pr,Rr,Qr,nn){let rn=Rr===void 0?void 0:ur(this,cr)[Rr];if(_n(this,pn,Mn).call(this,rn))return rn;let fn=new d,{signal:bn}=Qr;bn==null||bn.addEventListener("abort",()=>fn.abort(bn.reason),{signal:fn.signal});let In={signal:fn.signal,options:Qr,context:nn},On=(Zr,dn=!1)=>{let{aborted:cn}=fn.signal,Sn=Qr.ignoreFetchAbort&&Zr!==void 0;if(Qr.status&&(cn&&!dn?(Qr.status.fetchAborted=!0,Qr.status.fetchError=fn.signal.reason,Sn&&(Qr.status.fetchAbortIgnored=!0)):Qr.status.fetchResolved=!0),cn&&!Sn&&!dn)return xn(fn.signal.reason);let $n=jr;return ur(this,cr)[Rr]===jr&&(Zr===void 0?$n.__staleWhileFetching?ur(this,cr)[Rr]=$n.__staleWhileFetching:this.delete(pr):(Qr.status&&(Qr.status.fetchUpdated=!0),this.set(pr,Zr,In.options))),Zr},Vn=Zr=>(Qr.status&&(Qr.status.fetchRejected=!0,Qr.status.fetchError=Zr),xn(Zr)),xn=Zr=>{let{aborted:dn}=fn.signal,cn=dn&&Qr.allowStaleOnFetchAbort,Sn=cn||Qr.allowStaleOnFetchRejection,$n=Sn||Qr.noDeleteOnFetchRejection,En=jr;if(ur(this,cr)[Rr]===jr&&(!$n||En.__staleWhileFetching===void 0?this.delete(pr):cn||(ur(this,cr)[Rr]=En.__staleWhileFetching)),Sn)return Qr.status&&En.__staleWhileFetching!==void 0&&(Qr.status.returnedStale=!0),En.__staleWhileFetching;if(En.__returned===En)throw Zr},jn=(Zr,dn)=>{var Sn;let cn=(Sn=ur(this,jt))==null?void 0:Sn.call(this,pr,rn,In);cn&&cn instanceof Promise&&cn.then($n=>Zr($n===void 0?void 0:$n),dn),fn.signal.addEventListener("abort",()=>{(!Qr.ignoreFetchAbort||Qr.allowStaleOnFetchAbort)&&(Zr(void 0),Qr.allowStaleOnFetchAbort&&(Zr=$n=>On($n,!0)))})};Qr.status&&(Qr.status.fetchDispatched=!0);let jr=new Promise(jn).then(On,Vn),qr=Object.assign(jr,{__abortController:fn,__staleWhileFetching:rn,__returned:void 0});return Rr===void 0?(this.set(pr,qr,{...In.options,status:void 0}),Rr=ur(this,Wt).get(pr)):ur(this,cr)[Rr]=qr,qr},pn=new WeakSet,Mn=function(pr){if(!ur(this,$r))return!1;let Rr=pr;return!!Rr&&Rr instanceof Promise&&Rr.hasOwnProperty("__staleWhileFetching")&&Rr.__abortController instanceof d},Tn=new WeakSet,Jo=function(pr,Rr){ur(this,gr)[Rr]=pr,ur(this,hr)[pr]=Rr},Vt=new WeakSet,ao=function(pr){pr!==ur(this,mr)&&(pr===ur(this,er)?yn(this,er,ur(this,hr)[pr]):_n(this,Tn,Jo).call(this,ur(this,gr)[pr],ur(this,hr)[pr]),_n(this,Tn,Jo).call(this,ur(this,mr),pr),yn(this,mr,pr))},Er);i.LRUCache=It}),at=M(i=>{v(),m(),_(),Object.defineProperty(i,"t",{value:!0}),i.ContainerIterator=i.Container=i.Base=void 0;var e=class{constructor(h=0){this.iteratorType=h}equals(h){return this.o===h.o}};i.ContainerIterator=e;var a=class{constructor(){this.i=0}get length(){return this.i}size(){return this.i}empty(){return this.i===0}};i.Base=a;var c=class extends a{};i.Container=c}),Xd=M(i=>{v(),m(),_(),Object.defineProperty(i,"t",{value:!0}),i.default=void 0;var e=at(),a=class extends e.Base{constructor(h=[]){super(),this.S=[];let d=this;h.forEach(function(et){d.push(et)})}clear(){this.i=0,this.S=[]}push(h){return this.S.push(h),this.i+=1,this.i}pop(){if(this.i!==0)return this.i-=1,this.S.pop()}top(){return this.S[this.i-1]}},c=a;i.default=c}),Zd=M(i=>{v(),m(),_(),Object.defineProperty(i,"t",{value:!0}),i.default=void 0;var e=at(),a=class extends e.Base{constructor(h=[]){super(),this.j=0,this.q=[];let d=this;h.forEach(function(et){d.push(et)})}clear(){this.q=[],this.i=this.j=0}push(h){let d=this.q.length;if(this.j/d>.5&&this.j+this.i>=d&&d>4096){let et=this.i;for(let ft=0;ft<et;++ft)this.q[ft]=this.q[this.j+ft];this.j=0,this.q[this.i]=h}else this.q[this.j+this.i]=h;return++this.i}pop(){if(this.i===0)return;let h=this.q[this.j++];return this.i-=1,h}front(){if(this.i!==0)return this.q[this.j]}},c=a;i.default=c}),ep=M(i=>{v(),m(),_(),Object.defineProperty(i,"t",{value:!0}),i.default=void 0;var e=at(),a=class extends e.Base{constructor(h=[],d=function(ft,gt){return ft>gt?-1:ft<gt?1:0},et=!0){if(super(),this.v=d,Array.isArray(h))this.C=et?[...h]:h;else{this.C=[];let gt=this;h.forEach(function(_t){gt.C.push(_t)})}this.i=this.C.length;let ft=this.i>>1;for(let gt=this.i-1>>1;gt>=0;--gt)this.k(gt,ft)}m(h){let d=this.C[h];for(;h>0;){let et=h-1>>1,ft=this.C[et];if(this.v(ft,d)<=0)break;this.C[h]=ft,h=et}this.C[h]=d}k(h,d){let et=this.C[h];for(;h<d;){let ft=h<<1|1,gt=ft+1,_t=this.C[ft];if(gt<this.i&&this.v(_t,this.C[gt])>0&&(ft=gt,_t=this.C[gt]),this.v(_t,et)>=0)break;this.C[h]=_t,h=ft}this.C[h]=et}clear(){this.i=0,this.C.length=0}push(h){this.C.push(h),this.m(this.i),this.i+=1}pop(){if(this.i===0)return;let h=this.C[0],d=this.C.pop();return this.i-=1,this.i&&(this.C[0]=d,this.k(0,this.i>>1)),h}top(){return this.C[0]}find(h){return this.C.indexOf(h)>=0}remove(h){let d=this.C.indexOf(h);return d<0?!1:(d===0?this.pop():d===this.i-1?(this.C.pop(),this.i-=1):(this.C.splice(d,1,this.C.pop()),this.i-=1,this.m(d),this.k(d,this.i>>1)),!0)}updateItem(h){let d=this.C.indexOf(h);return d<0?!1:(this.m(d),this.k(d,this.i>>1),!0)}toArray(){return[...this.C]}},c=a;i.default=c}),qn=M(i=>{v(),m(),_(),Object.defineProperty(i,"t",{value:!0}),i.default=void 0;var e=at(),a=class extends e.Container{},c=a;i.default=c}),lt=M(i=>{v(),m(),_(),Object.defineProperty(i,"t",{value:!0}),i.throwIteratorAccessError=e;function e(){throw new RangeError("Iterator access denied!")}}),pa=M(i=>{v(),m(),_(),Object.defineProperty(i,"t",{value:!0}),i.RandomIterator=void 0;var e=at(),a=lt(),c=class extends e.ContainerIterator{constructor(h,d){super(d),this.o=h,this.iteratorType===0?(this.pre=function(){return this.o===0&&(0,a.throwIteratorAccessError)(),this.o-=1,this},this.next=function(){return this.o===this.container.size()&&(0,a.throwIteratorAccessError)(),this.o+=1,this}):(this.pre=function(){return this.o===this.container.size()-1&&(0,a.throwIteratorAccessError)(),this.o+=1,this},this.next=function(){return this.o===-1&&(0,a.throwIteratorAccessError)(),this.o-=1,this})}get pointer(){return this.container.getElementByPos(this.o)}set pointer(h){this.container.setElementByPos(this.o,h)}};i.RandomIterator=c}),tp=M(i=>{v(),m(),_(),Object.defineProperty(i,"t",{value:!0}),i.default=void 0;var e=c(qn()),a=pa();function c(ft){return ft&&ft.t?ft:{default:ft}}var h=class Gu extends a.RandomIterator{constructor(gt,_t,wt){super(gt,wt),this.container=_t}copy(){return new Gu(this.o,this.container,this.iteratorType)}},d=class extends e.default{constructor(ft=[],gt=!0){if(super(),Array.isArray(ft))this.J=gt?[...ft]:ft,this.i=ft.length;else{this.J=[];let _t=this;ft.forEach(function(wt){_t.pushBack(wt)})}}clear(){this.i=0,this.J.length=0}begin(){return new h(0,this)}end(){return new h(this.i,this)}rBegin(){return new h(this.i-1,this,1)}rEnd(){return new h(-1,this,1)}front(){return this.J[0]}back(){return this.J[this.i-1]}getElementByPos(ft){if(ft<0||ft>this.i-1)throw new RangeError;return this.J[ft]}eraseElementByPos(ft){if(ft<0||ft>this.i-1)throw new RangeError;return this.J.splice(ft,1),this.i-=1,this.i}eraseElementByValue(ft){let gt=0;for(let _t=0;_t<this.i;++_t)this.J[_t]!==ft&&(this.J[gt++]=this.J[_t]);return this.i=this.J.length=gt,this.i}eraseElementByIterator(ft){let gt=ft.o;return ft=ft.next(),this.eraseElementByPos(gt),ft}pushBack(ft){return this.J.push(ft),this.i+=1,this.i}popBack(){if(this.i!==0)return this.i-=1,this.J.pop()}setElementByPos(ft,gt){if(ft<0||ft>this.i-1)throw new RangeError;this.J[ft]=gt}insert(ft,gt,_t=1){if(ft<0||ft>this.i)throw new RangeError;return this.J.splice(ft,0,...new Array(_t).fill(gt)),this.i+=_t,this.i}find(ft){for(let gt=0;gt<this.i;++gt)if(this.J[gt]===ft)return new h(gt,this);return this.end()}reverse(){this.J.reverse()}unique(){let ft=1;for(let gt=1;gt<this.i;++gt)this.J[gt]!==this.J[gt-1]&&(this.J[ft++]=this.J[gt]);return this.i=this.J.length=ft,this.i}sort(ft){this.J.sort(ft)}forEach(ft){for(let gt=0;gt<this.i;++gt)ft(this.J[gt],gt,this)}[Symbol.iterator](){return(function*(){yield*this.J}).bind(this)()}},et=d;i.default=et}),rp=M(i=>{v(),m(),_(),Object.defineProperty(i,"t",{value:!0}),i.default=void 0;var e=h(qn()),a=at(),c=lt();function h(gt){return gt&&gt.t?gt:{default:gt}}var d=class Yu extends a.ContainerIterator{constructor(_t,wt,$t,It){super(It),this.o=_t,this.h=wt,this.container=$t,this.iteratorType===0?(this.pre=function(){return this.o.L===this.h&&(0,c.throwIteratorAccessError)(),this.o=this.o.L,this},this.next=function(){return this.o===this.h&&(0,c.throwIteratorAccessError)(),this.o=this.o.B,this}):(this.pre=function(){return this.o.B===this.h&&(0,c.throwIteratorAccessError)(),this.o=this.o.B,this},this.next=function(){return this.o===this.h&&(0,c.throwIteratorAccessError)(),this.o=this.o.L,this})}get pointer(){return this.o===this.h&&(0,c.throwIteratorAccessError)(),this.o.l}set pointer(_t){this.o===this.h&&(0,c.throwIteratorAccessError)(),this.o.l=_t}copy(){return new Yu(this.o,this.h,this.container,this.iteratorType)}},et=class extends e.default{constructor(gt=[]){super(),this.h={},this.p=this._=this.h.L=this.h.B=this.h;let _t=this;gt.forEach(function(wt){_t.pushBack(wt)})}V(gt){let{L:_t,B:wt}=gt;_t.B=wt,wt.L=_t,gt===this.p&&(this.p=wt),gt===this._&&(this._=_t),this.i-=1}G(gt,_t){let wt=_t.B,$t={l:gt,L:_t,B:wt};_t.B=$t,wt.L=$t,_t===this.h&&(this.p=$t),wt===this.h&&(this._=$t),this.i+=1}clear(){this.i=0,this.p=this._=this.h.L=this.h.B=this.h}begin(){return new d(this.p,this.h,this)}end(){return new d(this.h,this.h,this)}rBegin(){return new d(this._,this.h,this,1)}rEnd(){return new d(this.h,this.h,this,1)}front(){return this.p.l}back(){return this._.l}getElementByPos(gt){if(gt<0||gt>this.i-1)throw new RangeError;let _t=this.p;for(;gt--;)_t=_t.B;return _t.l}eraseElementByPos(gt){if(gt<0||gt>this.i-1)throw new RangeError;let _t=this.p;for(;gt--;)_t=_t.B;return this.V(_t),this.i}eraseElementByValue(gt){let _t=this.p;for(;_t!==this.h;)_t.l===gt&&this.V(_t),_t=_t.B;return this.i}eraseElementByIterator(gt){let _t=gt.o;return _t===this.h&&(0,c.throwIteratorAccessError)(),gt=gt.next(),this.V(_t),gt}pushBack(gt){return this.G(gt,this._),this.i}popBack(){if(this.i===0)return;let gt=this._.l;return this.V(this._),gt}pushFront(gt){return this.G(gt,this.h),this.i}popFront(){if(this.i===0)return;let gt=this.p.l;return this.V(this.p),gt}setElementByPos(gt,_t){if(gt<0||gt>this.i-1)throw new RangeError;let wt=this.p;for(;gt--;)wt=wt.B;wt.l=_t}insert(gt,_t,wt=1){if(gt<0||gt>this.i)throw new RangeError;if(wt<=0)return this.i;if(gt===0)for(;wt--;)this.pushFront(_t);else if(gt===this.i)for(;wt--;)this.pushBack(_t);else{let $t=this.p;for(let Rt=1;Rt<gt;++Rt)$t=$t.B;let It=$t.B;for(this.i+=wt;wt--;)$t.B={l:_t,L:$t},$t.B.L=$t,$t=$t.B;$t.B=It,It.L=$t}return this.i}find(gt){let _t=this.p;for(;_t!==this.h;){if(_t.l===gt)return new d(_t,this.h,this);_t=_t.B}return this.end()}reverse(){if(this.i<=1)return;let gt=this.p,_t=this._,wt=0;for(;wt<<1<this.i;){let $t=gt.l;gt.l=_t.l,_t.l=$t,gt=gt.B,_t=_t.L,wt+=1}}unique(){if(this.i<=1)return this.i;let gt=this.p;for(;gt!==this.h;){let _t=gt;for(;_t.B!==this.h&&_t.l===_t.B.l;)_t=_t.B,this.i-=1;gt.B=_t.B,gt.B.L=gt,gt=gt.B}return this.i}sort(gt){if(this.i<=1)return;let _t=[];this.forEach(function($t){_t.push($t)}),_t.sort(gt);let wt=this.p;_t.forEach(function($t){wt.l=$t,wt=wt.B})}merge(gt){let _t=this;if(this.i===0)gt.forEach(function(wt){_t.pushBack(wt)});else{let wt=this.p;gt.forEach(function($t){for(;wt!==_t.h&&wt.l<=$t;)wt=wt.B;_t.G($t,wt.L)})}return this.i}forEach(gt){let _t=this.p,wt=0;for(;_t!==this.h;)gt(_t.l,wt++,this),_t=_t.B}[Symbol.iterator](){return(function*(){if(this.i===0)return;let gt=this.p;for(;gt!==this.h;)yield gt.l,gt=gt.B}).bind(this)()}},ft=et;i.default=ft}),ip=M(i=>{v(),m(),_(),Object.defineProperty(i,"t",{value:!0}),i.default=void 0;var e=c(qn()),a=pa();function c(ft){return ft&&ft.t?ft:{default:ft}}var h=class Qu extends a.RandomIterator{constructor(gt,_t,wt){super(gt,wt),this.container=_t}copy(){return new Qu(this.o,this.container,this.iteratorType)}},d=class extends e.default{constructor(ft=[],gt=4096){super(),this.j=0,this.D=0,this.R=0,this.N=0,this.P=0,this.A=[];let _t=(()=>{if(typeof ft.length=="number")return ft.length;if(typeof ft.size=="number")return ft.size;if(typeof ft.size=="function")return ft.size();throw new TypeError("Cannot get the length or size of the container")})();this.F=gt,this.P=Math.max(Math.ceil(_t/this.F),1);for(let It=0;It<this.P;++It)this.A.push(new Array(this.F));let wt=Math.ceil(_t/this.F);this.j=this.R=(this.P>>1)-(wt>>1),this.D=this.N=this.F-_t%this.F>>1;let $t=this;ft.forEach(function(It){$t.pushBack(It)})}T(){let ft=[],gt=Math.max(this.P>>1,1);for(let _t=0;_t<gt;++_t)ft[_t]=new Array(this.F);for(let _t=this.j;_t<this.P;++_t)ft[ft.length]=this.A[_t];for(let _t=0;_t<this.R;++_t)ft[ft.length]=this.A[_t];ft[ft.length]=[...this.A[this.R]],this.j=gt,this.R=ft.length-1;for(let _t=0;_t<gt;++_t)ft[ft.length]=new Array(this.F);this.A=ft,this.P=ft.length}O(ft){let gt=this.D+ft+1,_t=gt%this.F,wt=_t-1,$t=this.j+(gt-_t)/this.F;return _t===0&&($t-=1),$t%=this.P,wt<0&&(wt+=this.F),{curNodeBucketIndex:$t,curNodePointerIndex:wt}}clear(){this.A=[new Array(this.F)],this.P=1,this.j=this.R=this.i=0,this.D=this.N=this.F>>1}begin(){return new h(0,this)}end(){return new h(this.i,this)}rBegin(){return new h(this.i-1,this,1)}rEnd(){return new h(-1,this,1)}front(){if(this.i!==0)return this.A[this.j][this.D]}back(){if(this.i!==0)return this.A[this.R][this.N]}pushBack(ft){return this.i&&(this.N<this.F-1?this.N+=1:this.R<this.P-1?(this.R+=1,this.N=0):(this.R=0,this.N=0),this.R===this.j&&this.N===this.D&&this.T()),this.i+=1,this.A[this.R][this.N]=ft,this.i}popBack(){if(this.i===0)return;let ft=this.A[this.R][this.N];return this.i!==1&&(this.N>0?this.N-=1:this.R>0?(this.R-=1,this.N=this.F-1):(this.R=this.P-1,this.N=this.F-1)),this.i-=1,ft}pushFront(ft){return this.i&&(this.D>0?this.D-=1:this.j>0?(this.j-=1,this.D=this.F-1):(this.j=this.P-1,this.D=this.F-1),this.j===this.R&&this.D===this.N&&this.T()),this.i+=1,this.A[this.j][this.D]=ft,this.i}popFront(){if(this.i===0)return;let ft=this.A[this.j][this.D];return this.i!==1&&(this.D<this.F-1?this.D+=1:this.j<this.P-1?(this.j+=1,this.D=0):(this.j=0,this.D=0)),this.i-=1,ft}getElementByPos(ft){if(ft<0||ft>this.i-1)throw new RangeError;let{curNodeBucketIndex:gt,curNodePointerIndex:_t}=this.O(ft);return this.A[gt][_t]}setElementByPos(ft,gt){if(ft<0||ft>this.i-1)throw new RangeError;let{curNodeBucketIndex:_t,curNodePointerIndex:wt}=this.O(ft);this.A[_t][wt]=gt}insert(ft,gt,_t=1){if(ft<0||ft>this.i)throw new RangeError;if(ft===0)for(;_t--;)this.pushFront(gt);else if(ft===this.i)for(;_t--;)this.pushBack(gt);else{let wt=[];for(let $t=ft;$t<this.i;++$t)wt.push(this.getElementByPos($t));this.cut(ft-1);for(let $t=0;$t<_t;++$t)this.pushBack(gt);for(let $t=0;$t<wt.length;++$t)this.pushBack(wt[$t])}return this.i}cut(ft){if(ft<0)return this.clear(),0;let{curNodeBucketIndex:gt,curNodePointerIndex:_t}=this.O(ft);return this.R=gt,this.N=_t,this.i=ft+1,this.i}eraseElementByPos(ft){if(ft<0||ft>this.i-1)throw new RangeError;if(ft===0)this.popFront();else if(ft===this.i-1)this.popBack();else{let gt=[];for(let wt=ft+1;wt<this.i;++wt)gt.push(this.getElementByPos(wt));this.cut(ft),this.popBack();let _t=this;gt.forEach(function(wt){_t.pushBack(wt)})}return this.i}eraseElementByValue(ft){if(this.i===0)return 0;let gt=[];for(let wt=0;wt<this.i;++wt){let $t=this.getElementByPos(wt);$t!==ft&&gt.push($t)}let _t=gt.length;for(let wt=0;wt<_t;++wt)this.setElementByPos(wt,gt[wt]);return this.cut(_t-1)}eraseElementByIterator(ft){let gt=ft.o;return this.eraseElementByPos(gt),ft=ft.next(),ft}find(ft){for(let gt=0;gt<this.i;++gt)if(this.getElementByPos(gt)===ft)return new h(gt,this);return this.end()}reverse(){let ft=0,gt=this.i-1;for(;ft<gt;){let _t=this.getElementByPos(ft);this.setElementByPos(ft,this.getElementByPos(gt)),this.setElementByPos(gt,_t),ft+=1,gt-=1}}unique(){if(this.i<=1)return this.i;let ft=1,gt=this.getElementByPos(0);for(let _t=1;_t<this.i;++_t){let wt=this.getElementByPos(_t);wt!==gt&&(gt=wt,this.setElementByPos(ft++,wt))}for(;this.i>ft;)this.popBack();return this.i}sort(ft){let gt=[];for(let _t=0;_t<this.i;++_t)gt.push(this.getElementByPos(_t));gt.sort(ft);for(let _t=0;_t<this.i;++_t)this.setElementByPos(_t,gt[_t])}shrinkToFit(){if(this.i===0)return;let ft=[];this.forEach(function(gt){ft.push(gt)}),this.P=Math.max(Math.ceil(this.i/this.F),1),this.i=this.j=this.R=this.D=this.N=0,this.A=[];for(let gt=0;gt<this.P;++gt)this.A.push(new Array(this.F));for(let gt=0;gt<ft.length;++gt)this.pushBack(ft[gt])}forEach(ft){for(let gt=0;gt<this.i;++gt)ft(this.getElementByPos(gt),gt,this)}[Symbol.iterator](){return(function*(){for(let ft=0;ft<this.i;++ft)yield this.getElementByPos(ft)}).bind(this)()}},et=d;i.default=et}),np=M(i=>{v(),m(),_(),Object.defineProperty(i,"t",{value:!0}),i.TreeNodeEnableIndex=i.TreeNode=void 0;var e=class{constructor(c,h){this.ee=1,this.u=void 0,this.l=void 0,this.U=void 0,this.W=void 0,this.tt=void 0,this.u=c,this.l=h}L(){let c=this;if(c.ee===1&&c.tt.tt===c)c=c.W;else if(c.U)for(c=c.U;c.W;)c=c.W;else{let h=c.tt;for(;h.U===c;)c=h,h=c.tt;c=h}return c}B(){let c=this;if(c.W){for(c=c.W;c.U;)c=c.U;return c}else{let h=c.tt;for(;h.W===c;)c=h,h=c.tt;return c.W!==h?h:c}}te(){let c=this.tt,h=this.W,d=h.U;return c.tt===this?c.tt=h:c.U===this?c.U=h:c.W=h,h.tt=c,h.U=this,this.tt=h,this.W=d,d&&(d.tt=this),h}se(){let c=this.tt,h=this.U,d=h.W;return c.tt===this?c.tt=h:c.U===this?c.U=h:c.W=h,h.tt=c,h.W=this,this.tt=h,this.U=d,d&&(d.tt=this),h}};i.TreeNode=e;var a=class extends e{constructor(){super(...arguments),this.rt=1}te(){let c=super.te();return this.ie(),c.ie(),c}se(){let c=super.se();return this.ie(),c.ie(),c}ie(){this.rt=1,this.U&&(this.rt+=this.U.rt),this.W&&(this.rt+=this.W.rt)}};i.TreeNodeEnableIndex=a}),ma=M(i=>{v(),m(),_(),Object.defineProperty(i,"t",{value:!0}),i.default=void 0;var e=np(),a=at(),c=lt(),h=class extends a.Container{constructor(et=function(gt,_t){return gt<_t?-1:gt>_t?1:0},ft=!1){super(),this.Y=void 0,this.v=et,ft?(this.re=e.TreeNodeEnableIndex,this.M=function(gt,_t,wt){let $t=this.ne(gt,_t,wt);if($t){let It=$t.tt;for(;It!==this.h;)It.rt+=1,It=It.tt;let Rt=this.he($t);if(Rt){let{parentNode:Tt,grandParent:At,curNode:kt}=Rt;Tt.ie(),At.ie(),kt.ie()}}return this.i},this.V=function(gt){let _t=this.fe(gt);for(;_t!==this.h;)_t.rt-=1,_t=_t.tt}):(this.re=e.TreeNode,this.M=function(gt,_t,wt){let $t=this.ne(gt,_t,wt);return $t&&this.he($t),this.i},this.V=this.fe),this.h=new this.re}X(et,ft){let gt=this.h;for(;et;){let _t=this.v(et.u,ft);if(_t<0)et=et.W;else if(_t>0)gt=et,et=et.U;else return et}return gt}Z(et,ft){let gt=this.h;for(;et;)this.v(et.u,ft)<=0?et=et.W:(gt=et,et=et.U);return gt}$(et,ft){let gt=this.h;for(;et;){let _t=this.v(et.u,ft);if(_t<0)gt=et,et=et.W;else if(_t>0)et=et.U;else return et}return gt}rr(et,ft){let gt=this.h;for(;et;)this.v(et.u,ft)<0?(gt=et,et=et.W):et=et.U;return gt}ue(et){for(;;){let ft=et.tt;if(ft===this.h)return;if(et.ee===1){et.ee=0;return}if(et===ft.U){let gt=ft.W;if(gt.ee===1)gt.ee=0,ft.ee=1,ft===this.Y?this.Y=ft.te():ft.te();else if(gt.W&&gt.W.ee===1){gt.ee=ft.ee,ft.ee=0,gt.W.ee=0,ft===this.Y?this.Y=ft.te():ft.te();return}else gt.U&&gt.U.ee===1?(gt.ee=1,gt.U.ee=0,gt.se()):(gt.ee=1,et=ft)}else{let gt=ft.U;if(gt.ee===1)gt.ee=0,ft.ee=1,ft===this.Y?this.Y=ft.se():ft.se();else if(gt.U&&gt.U.ee===1){gt.ee=ft.ee,ft.ee=0,gt.U.ee=0,ft===this.Y?this.Y=ft.se():ft.se();return}else gt.W&&gt.W.ee===1?(gt.ee=1,gt.W.ee=0,gt.te()):(gt.ee=1,et=ft)}}}fe(et){if(this.i===1)return this.clear(),this.h;let ft=et;for(;ft.U||ft.W;){if(ft.W)for(ft=ft.W;ft.U;)ft=ft.U;else ft=ft.U;[et.u,ft.u]=[ft.u,et.u],[et.l,ft.l]=[ft.l,et.l],et=ft}this.h.U===ft?this.h.U=ft.tt:this.h.W===ft&&(this.h.W=ft.tt),this.ue(ft);let gt=ft.tt;return ft===gt.U?gt.U=void 0:gt.W=void 0,this.i-=1,this.Y.ee=0,gt}oe(et,ft){return et===void 0?!1:this.oe(et.U,ft)||ft(et)?!0:this.oe(et.W,ft)}he(et){for(;;){let ft=et.tt;if(ft.ee===0)return;let gt=ft.tt;if(ft===gt.U){let _t=gt.W;if(_t&&_t.ee===1){if(_t.ee=ft.ee=0,gt===this.Y)return;gt.ee=1,et=gt;continue}else if(et===ft.W){if(et.ee=0,et.U&&(et.U.tt=ft),et.W&&(et.W.tt=gt),ft.W=et.U,gt.U=et.W,et.U=ft,et.W=gt,gt===this.Y)this.Y=et,this.h.tt=et;else{let wt=gt.tt;wt.U===gt?wt.U=et:wt.W=et}return et.tt=gt.tt,ft.tt=et,gt.tt=et,gt.ee=1,{parentNode:ft,grandParent:gt,curNode:et}}else ft.ee=0,gt===this.Y?this.Y=gt.se():gt.se(),gt.ee=1}else{let _t=gt.U;if(_t&&_t.ee===1){if(_t.ee=ft.ee=0,gt===this.Y)return;gt.ee=1,et=gt;continue}else if(et===ft.U){if(et.ee=0,et.U&&(et.U.tt=gt),et.W&&(et.W.tt=ft),gt.W=et.U,ft.U=et.W,et.U=gt,et.W=ft,gt===this.Y)this.Y=et,this.h.tt=et;else{let wt=gt.tt;wt.U===gt?wt.U=et:wt.W=et}return et.tt=gt.tt,ft.tt=et,gt.tt=et,gt.ee=1,{parentNode:ft,grandParent:gt,curNode:et}}else ft.ee=0,gt===this.Y?this.Y=gt.te():gt.te(),gt.ee=1}return}}ne(et,ft,gt){if(this.Y===void 0){this.i+=1,this.Y=new this.re(et,ft),this.Y.ee=0,this.Y.tt=this.h,this.h.tt=this.Y,this.h.U=this.Y,this.h.W=this.Y;return}let _t,wt=this.h.U,$t=this.v(wt.u,et);if($t===0){wt.l=ft;return}else if($t>0)wt.U=new this.re(et,ft),wt.U.tt=wt,_t=wt.U,this.h.U=_t;else{let It=this.h.W,Rt=this.v(It.u,et);if(Rt===0){It.l=ft;return}else if(Rt<0)It.W=new this.re(et,ft),It.W.tt=It,_t=It.W,this.h.W=_t;else{if(gt!==void 0){let Tt=gt.o;if(Tt!==this.h){let At=this.v(Tt.u,et);if(At===0){Tt.l=ft;return}else if(At>0){let kt=Tt.L(),xt=this.v(kt.u,et);if(xt===0){kt.l=ft;return}else xt<0&&(_t=new this.re(et,ft),kt.W===void 0?(kt.W=_t,_t.tt=kt):(Tt.U=_t,_t.tt=Tt))}}}if(_t===void 0)for(_t=this.Y;;){let Tt=this.v(_t.u,et);if(Tt>0){if(_t.U===void 0){_t.U=new this.re(et,ft),_t.U.tt=_t,_t=_t.U;break}_t=_t.U}else if(Tt<0){if(_t.W===void 0){_t.W=new this.re(et,ft),_t.W.tt=_t,_t=_t.W;break}_t=_t.W}else{_t.l=ft;return}}}}return this.i+=1,_t}I(et,ft){for(;et;){let gt=this.v(et.u,ft);if(gt<0)et=et.W;else if(gt>0)et=et.U;else return et}return et||this.h}clear(){this.i=0,this.Y=void 0,this.h.tt=void 0,this.h.U=this.h.W=void 0}updateKeyByIterator(et,ft){let gt=et.o;if(gt===this.h&&(0,c.throwIteratorAccessError)(),this.i===1)return gt.u=ft,!0;if(gt===this.h.U)return this.v(gt.B().u,ft)>0?(gt.u=ft,!0):!1;if(gt===this.h.W)return this.v(gt.L().u,ft)<0?(gt.u=ft,!0):!1;let _t=gt.L().u;if(this.v(_t,ft)>=0)return!1;let wt=gt.B().u;return this.v(wt,ft)<=0?!1:(gt.u=ft,!0)}eraseElementByPos(et){if(et<0||et>this.i-1)throw new RangeError;let ft=0,gt=this;return this.oe(this.Y,function(_t){return et===ft?(gt.V(_t),!0):(ft+=1,!1)}),this.i}eraseElementByKey(et){if(this.i===0)return!1;let ft=this.I(this.Y,et);return ft===this.h?!1:(this.V(ft),!0)}eraseElementByIterator(et){let ft=et.o;ft===this.h&&(0,c.throwIteratorAccessError)();let gt=ft.W===void 0;return et.iteratorType===0?gt&&et.next():(!gt||ft.U===void 0)&&et.next(),this.V(ft),et}forEach(et){let ft=0;for(let gt of this)et(gt,ft++,this)}getElementByPos(et){if(et<0||et>this.i-1)throw new RangeError;let ft,gt=0;for(let _t of this){if(gt===et){ft=_t;break}gt+=1}return ft}getHeight(){if(this.i===0)return 0;let et=function(ft){return ft?Math.max(et(ft.U),et(ft.W))+1:0};return et(this.Y)}},d=h;i.default=d}),Ea=M(i=>{v(),m(),_(),Object.defineProperty(i,"t",{value:!0}),i.default=void 0;var e=at(),a=lt(),c=class extends e.ContainerIterator{constructor(d,et,ft){super(ft),this.o=d,this.h=et,this.iteratorType===0?(this.pre=function(){return this.o===this.h.U&&(0,a.throwIteratorAccessError)(),this.o=this.o.L(),this},this.next=function(){return this.o===this.h&&(0,a.throwIteratorAccessError)(),this.o=this.o.B(),this}):(this.pre=function(){return this.o===this.h.W&&(0,a.throwIteratorAccessError)(),this.o=this.o.B(),this},this.next=function(){return this.o===this.h&&(0,a.throwIteratorAccessError)(),this.o=this.o.L(),this})}get index(){let d=this.o,et=this.h.tt;if(d===this.h)return et?et.rt-1:0;let ft=0;for(d.U&&(ft+=d.U.rt);d!==et;){let gt=d.tt;d===gt.W&&(ft+=1,gt.U&&(ft+=gt.U.rt)),d=gt}return ft}},h=c;i.default=h}),lp=M(i=>{v(),m(),_(),Object.defineProperty(i,"t",{value:!0}),i.default=void 0;var e=h(ma()),a=h(Ea()),c=lt();function h(gt){return gt&&gt.t?gt:{default:gt}}var d=class Xu extends a.default{constructor(_t,wt,$t,It){super(_t,wt,It),this.container=$t}get pointer(){return this.o===this.h&&(0,c.throwIteratorAccessError)(),this.o.u}copy(){return new Xu(this.o,this.h,this.container,this.iteratorType)}},et=class extends e.default{constructor(gt=[],_t,wt){super(_t,wt);let $t=this;gt.forEach(function(It){$t.insert(It)})}*K(gt){gt!==void 0&&(yield*this.K(gt.U),yield gt.u,yield*this.K(gt.W))}begin(){return new d(this.h.U||this.h,this.h,this)}end(){return new d(this.h,this.h,this)}rBegin(){return new d(this.h.W||this.h,this.h,this,1)}rEnd(){return new d(this.h,this.h,this,1)}front(){return this.h.U?this.h.U.u:void 0}back(){return this.h.W?this.h.W.u:void 0}insert(gt,_t){return this.M(gt,void 0,_t)}find(gt){let _t=this.I(this.Y,gt);return new d(_t,this.h,this)}lowerBound(gt){let _t=this.X(this.Y,gt);return new d(_t,this.h,this)}upperBound(gt){let _t=this.Z(this.Y,gt);return new d(_t,this.h,this)}reverseLowerBound(gt){let _t=this.$(this.Y,gt);return new d(_t,this.h,this)}reverseUpperBound(gt){let _t=this.rr(this.Y,gt);return new d(_t,this.h,this)}union(gt){let _t=this;return gt.forEach(function(wt){_t.insert(wt)}),this.i}[Symbol.iterator](){return this.K(this.Y)}},ft=et;i.default=ft}),fp=M(i=>{v(),m(),_(),Object.defineProperty(i,"t",{value:!0}),i.default=void 0;var e=h(ma()),a=h(Ea()),c=lt();function h(gt){return gt&&gt.t?gt:{default:gt}}var d=class Ju extends a.default{constructor(_t,wt,$t,It){super(_t,wt,It),this.container=$t}get pointer(){this.o===this.h&&(0,c.throwIteratorAccessError)();let _t=this;return new Proxy([],{get(wt,$t){if($t==="0")return _t.o.u;if($t==="1")return _t.o.l},set(wt,$t,It){if($t!=="1")throw new TypeError("props must be 1");return _t.o.l=It,!0}})}copy(){return new Ju(this.o,this.h,this.container,this.iteratorType)}},et=class extends e.default{constructor(gt=[],_t,wt){super(_t,wt);let $t=this;gt.forEach(function(It){$t.setElement(It[0],It[1])})}*K(gt){gt!==void 0&&(yield*this.K(gt.U),yield[gt.u,gt.l],yield*this.K(gt.W))}begin(){return new d(this.h.U||this.h,this.h,this)}end(){return new d(this.h,this.h,this)}rBegin(){return new d(this.h.W||this.h,this.h,this,1)}rEnd(){return new d(this.h,this.h,this,1)}front(){if(this.i===0)return;let gt=this.h.U;return[gt.u,gt.l]}back(){if(this.i===0)return;let gt=this.h.W;return[gt.u,gt.l]}lowerBound(gt){let _t=this.X(this.Y,gt);return new d(_t,this.h,this)}upperBound(gt){let _t=this.Z(this.Y,gt);return new d(_t,this.h,this)}reverseLowerBound(gt){let _t=this.$(this.Y,gt);return new d(_t,this.h,this)}reverseUpperBound(gt){let _t=this.rr(this.Y,gt);return new d(_t,this.h,this)}setElement(gt,_t,wt){return this.M(gt,_t,wt)}find(gt){let _t=this.I(this.Y,gt);return new d(_t,this.h,this)}getElementByKey(gt){return this.I(this.Y,gt).l}union(gt){let _t=this;return gt.forEach(function(wt){_t.setElement(wt[0],wt[1])}),this.i}[Symbol.iterator](){return this.K(this.Y)}},ft=et;i.default=ft}),Ta=M(i=>{v(),m(),_(),Object.defineProperty(i,"t",{value:!0}),i.default=e;function e(a){let c=typeof a;return c==="object"&&a!==null||c==="function"}}),Pa=M(i=>{v(),m(),_(),Object.defineProperty(i,"t",{value:!0}),i.HashContainerIterator=i.HashContainer=void 0;var e=at(),a=h(Ta()),c=lt();function h(ft){return ft&&ft.t?ft:{default:ft}}var d=class extends e.ContainerIterator{constructor(ft,gt,_t){super(_t),this.o=ft,this.h=gt,this.iteratorType===0?(this.pre=function(){return this.o.L===this.h&&(0,c.throwIteratorAccessError)(),this.o=this.o.L,this},this.next=function(){return this.o===this.h&&(0,c.throwIteratorAccessError)(),this.o=this.o.B,this}):(this.pre=function(){return this.o.B===this.h&&(0,c.throwIteratorAccessError)(),this.o=this.o.B,this},this.next=function(){return this.o===this.h&&(0,c.throwIteratorAccessError)(),this.o=this.o.L,this})}};i.HashContainerIterator=d;var et=class extends e.Container{constructor(){super(),this.H=[],this.g={},this.HASH_TAG=Symbol("@@HASH_TAG"),Object.setPrototypeOf(this.g,null),this.h={},this.h.L=this.h.B=this.p=this._=this.h}V(ft){let{L:gt,B:_t}=ft;gt.B=_t,_t.L=gt,ft===this.p&&(this.p=_t),ft===this._&&(this._=gt),this.i-=1}M(ft,gt,_t){_t===void 0&&(_t=(0,a.default)(ft));let wt;if(_t){let $t=ft[this.HASH_TAG];if($t!==void 0)return this.H[$t].l=gt,this.i;Object.defineProperty(ft,this.HASH_TAG,{value:this.H.length,configurable:!0}),wt={u:ft,l:gt,L:this._,B:this.h},this.H.push(wt)}else{let $t=this.g[ft];if($t)return $t.l=gt,this.i;wt={u:ft,l:gt,L:this._,B:this.h},this.g[ft]=wt}return this.i===0?(this.p=wt,this.h.B=wt):this._.B=wt,this._=wt,this.h.L=wt,++this.i}I(ft,gt){if(gt===void 0&&(gt=(0,a.default)(ft)),gt){let _t=ft[this.HASH_TAG];return _t===void 0?this.h:this.H[_t]}else return this.g[ft]||this.h}clear(){let ft=this.HASH_TAG;this.H.forEach(function(gt){delete gt.u[ft]}),this.H=[],this.g={},Object.setPrototypeOf(this.g,null),this.i=0,this.p=this._=this.h.L=this.h.B=this.h}eraseElementByKey(ft,gt){let _t;if(gt===void 0&&(gt=(0,a.default)(ft)),gt){let wt=ft[this.HASH_TAG];if(wt===void 0)return!1;delete ft[this.HASH_TAG],_t=this.H[wt],delete this.H[wt]}else{if(_t=this.g[ft],_t===void 0)return!1;delete this.g[ft]}return this.V(_t),!0}eraseElementByIterator(ft){let gt=ft.o;return gt===this.h&&(0,c.throwIteratorAccessError)(),this.V(gt),ft.next()}eraseElementByPos(ft){if(ft<0||ft>this.i-1)throw new RangeError;let gt=this.p;for(;ft--;)gt=gt.B;return this.V(gt),this.i}};i.HashContainer=et}),dp=M(i=>{v(),m(),_(),Object.defineProperty(i,"t",{value:!0}),i.default=void 0;var e=Pa(),a=lt(),c=class Zu extends e.HashContainerIterator{constructor(ft,gt,_t,wt){super(ft,gt,wt),this.container=_t}get pointer(){return this.o===this.h&&(0,a.throwIteratorAccessError)(),this.o.u}copy(){return new Zu(this.o,this.h,this.container,this.iteratorType)}},h=class extends e.HashContainer{constructor(et=[]){super();let ft=this;et.forEach(function(gt){ft.insert(gt)})}begin(){return new c(this.p,this.h,this)}end(){return new c(this.h,this.h,this)}rBegin(){return new c(this._,this.h,this,1)}rEnd(){return new c(this.h,this.h,this,1)}front(){return this.p.u}back(){return this._.u}insert(et,ft){return this.M(et,void 0,ft)}getElementByPos(et){if(et<0||et>this.i-1)throw new RangeError;let ft=this.p;for(;et--;)ft=ft.B;return ft.u}find(et,ft){let gt=this.I(et,ft);return new c(gt,this.h,this)}forEach(et){let ft=0,gt=this.p;for(;gt!==this.h;)et(gt.u,ft++,this),gt=gt.B}[Symbol.iterator](){return(function*(){let et=this.p;for(;et!==this.h;)yield et.u,et=et.B}).bind(this)()}},d=h;i.default=d}),gp=M(i=>{v(),m(),_(),Object.defineProperty(i,"t",{value:!0}),i.default=void 0;var e=Pa(),a=h(Ta()),c=lt();function h(gt){return gt&&gt.t?gt:{default:gt}}var d=class _h extends e.HashContainerIterator{constructor(_t,wt,$t,It){super(_t,wt,It),this.container=$t}get pointer(){this.o===this.h&&(0,c.throwIteratorAccessError)();let _t=this;return new Proxy([],{get(wt,$t){if($t==="0")return _t.o.u;if($t==="1")return _t.o.l},set(wt,$t,It){if($t!=="1")throw new TypeError("props must be 1");return _t.o.l=It,!0}})}copy(){return new _h(this.o,this.h,this.container,this.iteratorType)}},et=class extends e.HashContainer{constructor(gt=[]){super();let _t=this;gt.forEach(function(wt){_t.setElement(wt[0],wt[1])})}begin(){return new d(this.p,this.h,this)}end(){return new d(this.h,this.h,this)}rBegin(){return new d(this._,this.h,this,1)}rEnd(){return new d(this.h,this.h,this,1)}front(){if(this.i!==0)return[this.p.u,this.p.l]}back(){if(this.i!==0)return[this._.u,this._.l]}setElement(gt,_t,wt){return this.M(gt,_t,wt)}getElementByKey(gt,_t){if(_t===void 0&&(_t=(0,a.default)(gt)),_t){let $t=gt[this.HASH_TAG];return $t!==void 0?this.H[$t].l:void 0}let wt=this.g[gt];return wt?wt.l:void 0}getElementByPos(gt){if(gt<0||gt>this.i-1)throw new RangeError;let _t=this.p;for(;gt--;)_t=_t.B;return[_t.u,_t.l]}find(gt,_t){let wt=this.I(gt,_t);return new d(wt,this.h,this)}forEach(gt){let _t=0,wt=this.p;for(;wt!==this.h;)gt([wt.u,wt.l],_t++,this),wt=wt.B}[Symbol.iterator](){return(function*(){let gt=this.p;for(;gt!==this.h;)yield[gt.u,gt.l],gt=gt.B}).bind(this)()}},ft=et;i.default=ft}),yp=M(i=>{v(),m(),_(),Object.defineProperty(i,"t",{value:!0}),Object.defineProperty(i,"Deque",{enumerable:!0,get:function(){return et.default}}),Object.defineProperty(i,"HashMap",{enumerable:!0,get:function(){return wt.default}}),Object.defineProperty(i,"HashSet",{enumerable:!0,get:function(){return _t.default}}),Object.defineProperty(i,"LinkList",{enumerable:!0,get:function(){return d.default}}),Object.defineProperty(i,"OrderedMap",{enumerable:!0,get:function(){return gt.default}}),Object.defineProperty(i,"OrderedSet",{enumerable:!0,get:function(){return ft.default}}),Object.defineProperty(i,"PriorityQueue",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(i,"Queue",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(i,"Stack",{enumerable:!0,get:function(){return e.default}}),Object.defineProperty(i,"Vector",{enumerable:!0,get:function(){return h.default}});var e=$t(Xd()),a=$t(Zd()),c=$t(ep()),h=$t(tp()),d=$t(rp()),et=$t(ip()),ft=$t(lp()),gt=$t(fp()),_t=$t(dp()),wt=$t(gp());function $t(It){return It&&It.t?It:{default:It}}}),wp=M((i,e)=>{v(),m(),_();var a=yp().OrderedSet,c=ot()("number-allocator:trace"),h=ot()("number-allocator:error");function d(ft,gt){this.low=ft,this.high=gt}d.prototype.equals=function(ft){return this.low===ft.low&&this.high===ft.high},d.prototype.compare=function(ft){return this.low<ft.low&&this.high<ft.low?-1:ft.low<this.low&&ft.high<this.low?1:0};function et(ft,gt){if(!(this instanceof et))return new et(ft,gt);this.min=ft,this.max=gt,this.ss=new a([],(_t,wt)=>_t.compare(wt)),c("Create"),this.clear()}et.prototype.firstVacant=function(){return this.ss.size()===0?null:this.ss.front().low},et.prototype.alloc=function(){if(this.ss.size()===0)return c("alloc():empty"),null;let ft=this.ss.begin(),gt=ft.pointer.low,_t=ft.pointer.high,wt=gt;return wt+1<=_t?this.ss.updateKeyByIterator(ft,new d(gt+1,_t)):this.ss.eraseElementByPos(0),c("alloc():"+wt),wt},et.prototype.use=function(ft){let gt=new d(ft,ft),_t=this.ss.lowerBound(gt);if(!_t.equals(this.ss.end())){let wt=_t.pointer.low,$t=_t.pointer.high;return _t.pointer.equals(gt)?(this.ss.eraseElementByIterator(_t),c("use():"+ft),!0):wt>ft?!1:wt===ft?(this.ss.updateKeyByIterator(_t,new d(wt+1,$t)),c("use():"+ft),!0):$t===ft?(this.ss.updateKeyByIterator(_t,new d(wt,$t-1)),c("use():"+ft),!0):(this.ss.updateKeyByIterator(_t,new d(ft+1,$t)),this.ss.insert(new d(wt,ft-1)),c("use():"+ft),!0)}return c("use():failed"),!1},et.prototype.free=function(ft){if(ft<this.min||ft>this.max){h("free():"+ft+" is out of range");return}let gt=new d(ft,ft),_t=this.ss.upperBound(gt);if(_t.equals(this.ss.end())){if(_t.equals(this.ss.begin())){this.ss.insert(gt);return}_t.pre();let wt=_t.pointer.high;_t.pointer.high+1===ft?this.ss.updateKeyByIterator(_t,new d(wt,ft)):this.ss.insert(gt)}else if(_t.equals(this.ss.begin()))if(ft+1===_t.pointer.low){let wt=_t.pointer.high;this.ss.updateKeyByIterator(_t,new d(ft,wt))}else this.ss.insert(gt);else{let wt=_t.pointer.low,$t=_t.pointer.high;_t.pre();let It=_t.pointer.low;_t.pointer.high+1===ft?ft+1===wt?(this.ss.eraseElementByIterator(_t),this.ss.updateKeyByIterator(_t,new d(It,$t))):this.ss.updateKeyByIterator(_t,new d(It,ft)):ft+1===wt?(this.ss.eraseElementByIterator(_t.next()),this.ss.insert(new d(ft,$t))):this.ss.insert(gt)}c("free():"+ft)},et.prototype.clear=function(){c("clear()"),this.ss.clear(),this.ss.insert(new d(this.min,this.max))},et.prototype.intervalCount=function(){return this.ss.size()},et.prototype.dump=function(){console.log("length:"+this.ss.size());for(let ft of this.ss)console.log(ft)},e.exports=et}),xa=M((i,e)=>{v(),m(),_();var a=wp();e.exports.NumberAllocator=a}),mp=M(i=>{v(),m(),_(),Object.defineProperty(i,"__esModule",{value:!0});var e=Jd(),a=xa(),c=class{constructor(h){h>0&&(this.aliasToTopic=new e.LRUCache({max:h}),this.topicToAlias={},this.numberAllocator=new a.NumberAllocator(1,h),this.max=h,this.length=0)}put(h,d){if(d===0||d>this.max)return!1;let et=this.aliasToTopic.get(d);return et&&delete this.topicToAlias[et],this.aliasToTopic.set(d,h),this.topicToAlias[h]=d,this.numberAllocator.use(d),this.length=this.aliasToTopic.size,!0}getTopicByAlias(h){return this.aliasToTopic.get(h)}getAliasByTopic(h){let d=this.topicToAlias[h];return typeof d<"u"&&this.aliasToTopic.get(d),d}clear(){this.aliasToTopic.clear(),this.topicToAlias={},this.numberAllocator.clear(),this.length=0}getLruAlias(){return this.numberAllocator.firstVacant()||[...this.aliasToTopic.keys()][this.aliasToTopic.size-1]}};i.default=c}),vp=M(i=>{v(),m(),_();var e=i&&i.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(i,"__esModule",{value:!0});var a=Si(),c=e(mp()),h=Yr(),d=(et,ft)=>{et.log("_handleConnack");let{options:gt}=et,_t=gt.protocolVersion===5?ft.reasonCode:ft.returnCode;if(clearTimeout(et.connackTimer),delete et.topicAliasSend,ft.properties){if(ft.properties.topicAliasMaximum){if(ft.properties.topicAliasMaximum>65535){et.emit("error",new Error("topicAliasMaximum from broker is out of range"));return}ft.properties.topicAliasMaximum>0&&(et.topicAliasSend=new c.default(ft.properties.topicAliasMaximum))}ft.properties.serverKeepAlive&&gt.keepalive&&(gt.keepalive=ft.properties.serverKeepAlive,et._shiftPingInterval()),ft.properties.maximumPacketSize&&(gt.properties||(gt.properties={}),gt.properties.maximumPacketSize=ft.properties.maximumPacketSize)}if(_t===0)et.reconnecting=!1,et._onConnect(ft);else if(_t>0){let wt=new h.ErrorWithReasonCode(`Connection refused: ${a.ReasonCodes[_t]}`,_t);et.emit("error",wt)}};i.default=d}),Ep=M(i=>{v(),m(),_(),Object.defineProperty(i,"__esModule",{value:!0});var e=(a,c,h)=>{a.log("handling pubrel packet");let d=typeof h<"u"?h:a.noop,{messageId:et}=c,ft={cmd:"pubcomp",messageId:et};a.incomingStore.get(c,(gt,_t)=>{gt?a._sendPacket(ft,d):(a.emit("message",_t.topic,_t.payload,_t),a.handleMessage(_t,wt=>{if(wt)return d(wt);a.incomingStore.del(_t,a.noop),a._sendPacket(ft,d)}))})};i.default=e}),Sp=M(i=>{v(),m(),_();var e=i&&i.__importDefault||function(gt){return gt&&gt.__esModule?gt:{default:gt}};Object.defineProperty(i,"__esModule",{value:!0});var a=e(Hd()),c=e(zd()),h=e(vp()),d=e(Si()),et=e(Ep()),ft=(gt,_t,wt)=>{let{options:$t}=gt;if($t.protocolVersion===5&&$t.properties&&$t.properties.maximumPacketSize&&$t.properties.maximumPacketSize<_t.length)return gt.emit("error",new Error(`exceeding packets size ${_t.cmd}`)),gt.end({reasonCode:149,properties:{reasonString:"Maximum packet size was exceeded"}}),gt;switch(gt.log("_handlePacket :: emitting packetreceive"),gt.emit("packetreceive",_t),_t.cmd){case"publish":(0,a.default)(gt,_t,wt);break;case"puback":case"pubrec":case"pubcomp":case"suback":case"unsuback":(0,d.default)(gt,_t),wt();break;case"pubrel":(0,et.default)(gt,_t,wt);break;case"connack":(0,h.default)(gt,_t),wt();break;case"auth":(0,c.default)(gt,_t),wt();break;case"pingresp":gt.pingResp=!0,wt();break;case"disconnect":gt.emit("disconnect",_t),wt();break;default:gt.log("_handlePacket :: unknown command"),wt();break}};i.default=ft}),Ap=M(i=>{v(),m(),_();var e=i&&i.__importDefault||function(d){return d&&d.__esModule?d:{default:d}};Object.defineProperty(i,"__esModule",{value:!0}),i.TypedEventEmitter=void 0;var a=e((ir(),Z(rr$1))),c=Yr(),h=class{};i.TypedEventEmitter=h,(0,c.applyMixin)(h,a.default)}),Pi=M(i=>{v(),m(),_(),Object.defineProperty(i,"__esModule",{value:!0}),i.isWebWorker=void 0;var e=()=>typeof window<"u"&&typeof window.document<"u",a=()=>{var d,et;return!!(typeof self=="object"&&!((et=(d=self==null?void 0:self.constructor)===null||d===void 0?void 0:d.name)===null||et===void 0)&&et.includes("WorkerGlobalScope"))},c=()=>typeof B<"u"&&B.product==="ReactNative",h=e()||a()||c();i.isWebWorker=a(),i.default=h}),Rp=M((i,e)=>{v(),m(),_(),function(a,c){typeof i=="object"&&typeof e<"u"?c(i):typeof define=="function"&&define.amd?define(["exports"],c):(a=typeof globalThis<"u"?globalThis:a||self,c(a.fastUniqueNumbers={}))}(i,function(a){var c=function(Rt){return function(Tt){var At=Rt(Tt);return Tt.add(At),At}},h=function(Rt){return function(Tt,At){return Rt.set(Tt,At),At}},d=Number.MAX_SAFE_INTEGER===void 0?9007199254740991:Number.MAX_SAFE_INTEGER,et=536870912,ft=et*2,gt=function(Rt,Tt){return function(At){var kt=Tt.get(At),xt=kt===void 0?At.size:kt<ft?kt+1:0;if(!At.has(xt))return Rt(At,xt);if(At.size<et){for(;At.has(xt);)xt=Math.floor(Math.random()*ft);return Rt(At,xt)}if(At.size>d)throw new Error("Congratulations, you created a collection of unique numbers which uses all available integers!");for(;At.has(xt);)xt=Math.floor(Math.random()*d);return Rt(At,xt)}},_t=new WeakMap,wt=h(_t),$t=gt(wt,_t),It=c($t);a.addUniqueNumber=It,a.generateUniqueNumber=$t})}),Bp=M((i,e)=>{v(),m(),_(),function(a,c){typeof i=="object"&&typeof e<"u"?c(i,Rp()):typeof define=="function"&&define.amd?define(["exports","fast-unique-numbers"],c):(a=typeof globalThis<"u"?globalThis:a||self,c(a.workerTimersBroker={},a.fastUniqueNumbers))}(i,function(a,c){var h=function(ft){return ft.method!==void 0&&ft.method==="call"},d=function(ft){return ft.error===null&&typeof ft.id=="number"},et=function(ft){var gt=new Map([[0,function(){}]]),_t=new Map([[0,function(){}]]),wt=new Map,$t=new Worker(ft);$t.addEventListener("message",function(kt){var xt=kt.data;if(h(xt)){var Nt=xt.params,Ft=Nt.timerId,jt=Nt.timerType;if(jt==="interval"){var Gt=gt.get(Ft);if(typeof Gt=="number"){var Kt=wt.get(Gt);if(Kt===void 0||Kt.timerId!==Ft||Kt.timerType!==jt)throw new Error("The timer is in an undefined state.")}else if(typeof Gt<"u")Gt();else throw new Error("The timer is in an undefined state.")}else if(jt==="timeout"){var Wt=_t.get(Ft);if(typeof Wt=="number"){var Zt=wt.get(Wt);if(Zt===void 0||Zt.timerId!==Ft||Zt.timerType!==jt)throw new Error("The timer is in an undefined state.")}else if(typeof Wt<"u")Wt(),_t.delete(Ft);else throw new Error("The timer is in an undefined state.")}}else if(d(xt)){var cr=xt.id,hr=wt.get(cr);if(hr===void 0)throw new Error("The timer is in an undefined state.");var gr=hr.timerId,er=hr.timerType;wt.delete(cr),er==="interval"?gt.delete(gr):_t.delete(gr)}else{var mr=xt.error.message;throw new Error(mr)}});var It=function(kt){var xt=c.generateUniqueNumber(wt);wt.set(xt,{timerId:kt,timerType:"interval"}),gt.set(kt,xt),$t.postMessage({id:xt,method:"clear",params:{timerId:kt,timerType:"interval"}})},Rt=function(kt){var xt=c.generateUniqueNumber(wt);wt.set(xt,{timerId:kt,timerType:"timeout"}),_t.set(kt,xt),$t.postMessage({id:xt,method:"clear",params:{timerId:kt,timerType:"timeout"}})},Tt=function(kt){var xt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,Nt=c.generateUniqueNumber(gt);return gt.set(Nt,function(){kt(),typeof gt.get(Nt)=="function"&&$t.postMessage({id:null,method:"set",params:{delay:xt,now:performance.now(),timerId:Nt,timerType:"interval"}})}),$t.postMessage({id:null,method:"set",params:{delay:xt,now:performance.now(),timerId:Nt,timerType:"interval"}}),Nt},At=function(kt){var xt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,Nt=c.generateUniqueNumber(_t);return _t.set(Nt,kt),$t.postMessage({id:null,method:"set",params:{delay:xt,now:performance.now(),timerId:Nt,timerType:"timeout"}}),Nt};return{clearInterval:It,clearTimeout:Rt,setInterval:Tt,setTimeout:At}};a.load=et})}),Op$1=M((i,e)=>{v(),m(),_(),function(a,c){typeof i=="object"&&typeof e<"u"?c(i,Bp()):typeof define=="function"&&define.amd?define(["exports","worker-timers-broker"],c):(a=typeof globalThis<"u"?globalThis:a||self,c(a.workerTimers={},a.workerTimersBroker))}(i,function(a,c){var h=function($t,It){var Rt=null;return function(){if(Rt!==null)return Rt;var Tt=new Blob([It],{type:"application/javascript; charset=utf-8"}),At=URL.createObjectURL(Tt);return Rt=$t(At),setTimeout(function(){return URL.revokeObjectURL(At)}),Rt}},d=`(()=>{var e={472:(e,t,r)=>{var o,i;void 0===(i="function"==typeof(o=function(){"use strict";var e=new Map,t=new Map,r=function(t){var r=e.get(t);if(void 0===r)throw new Error('There is no interval scheduled with the given id "'.concat(t,'".'));clearTimeout(r),e.delete(t)},o=function(e){var r=t.get(e);if(void 0===r)throw new Error('There is no timeout scheduled with the given id "'.concat(e,'".'));clearTimeout(r),t.delete(e)},i=function(e,t){var r,o=performance.now();return{expected:o+(r=e-Math.max(0,o-t)),remainingDelay:r}},n=function e(t,r,o,i){var n=performance.now();n>o?postMessage({id:null,method:"call",params:{timerId:r,timerType:i}}):t.set(r,setTimeout(e,o-n,t,r,o,i))},a=function(t,r,o){var a=i(t,o),s=a.expected,d=a.remainingDelay;e.set(r,setTimeout(n,d,e,r,s,"interval"))},s=function(e,r,o){var a=i(e,o),s=a.expected,d=a.remainingDelay;t.set(r,setTimeout(n,d,t,r,s,"timeout"))};addEventListener("message",(function(e){var t=e.data;try{if("clear"===t.method){var i=t.id,n=t.params,d=n.timerId,c=n.timerType;if("interval"===c)r(d),postMessage({error:null,id:i});else{if("timeout"!==c)throw new Error('The given type "'.concat(c,'" is not supported'));o(d),postMessage({error:null,id:i})}}else{if("set"!==t.method)throw new Error('The given method "'.concat(t.method,'" is not supported'));var u=t.params,l=u.delay,p=u.now,m=u.timerId,v=u.timerType;if("interval"===v)a(l,m,p);else{if("timeout"!==v)throw new Error('The given type "'.concat(v,'" is not supported'));s(l,m,p)}}}catch(e){postMessage({error:{message:e.message},id:t.id,result:null})}}))})?o.call(t,r,t,e):o)||(e.exports=i)}},t={};function r(o){var i=t[o];if(void 0!==i)return i.exports;var n=t[o]={exports:{}};return e[o](n,n.exports,r),n.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var o in t)r.o(t,o)&&!r.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";r(472)})()})();`,et=h(c.load,d),ft=function($t){return et().clearInterval($t)},gt=function($t){return et().clearTimeout($t)},_t=function(){var $t;return($t=et()).setInterval.apply($t,arguments)},wt=function(){var $t;return($t=et()).setTimeout.apply($t,arguments)};a.clearInterval=ft,a.clearTimeout=gt,a.setInterval=_t,a.setTimeout=wt})}),Up=M(i=>{v(),m(),_();var e=i&&i.__createBinding||(Object.create?function(_t,wt,$t,It){It===void 0&&(It=$t);var Rt=Object.getOwnPropertyDescriptor(wt,$t);(!Rt||("get"in Rt?!wt.__esModule:Rt.writable||Rt.configurable))&&(Rt={enumerable:!0,get:function(){return wt[$t]}}),Object.defineProperty(_t,It,Rt)}:function(_t,wt,$t,It){It===void 0&&(It=$t),_t[It]=wt[$t]}),a=i&&i.__setModuleDefault||(Object.create?function(_t,wt){Object.defineProperty(_t,"default",{enumerable:!0,value:wt})}:function(_t,wt){_t.default=wt}),c=i&&i.__importStar||function(_t){if(_t&&_t.__esModule)return _t;var wt={};if(_t!=null)for(var $t in _t)$t!=="default"&&Object.prototype.hasOwnProperty.call(_t,$t)&&e(wt,_t,$t);return a(wt,_t),wt};Object.defineProperty(i,"__esModule",{value:!0});var h=c(Pi()),d=Op$1(),et={set:d.setTimeout,clear:d.clearTimeout},ft={set:(_t,wt)=>setTimeout(_t,wt),clear:_t=>clearTimeout(_t)},gt=_t=>{switch(_t){case"native":return ft;case"worker":return et;case"auto":default:return h.default&&!h.isWebWorker?et:ft}};i.default=gt}),qa=M(i=>{v(),m(),_();var e=i&&i.__importDefault||function(h){return h&&h.__esModule?h:{default:h}};Object.defineProperty(i,"__esModule",{value:!0});var a=e(Up()),c=class{constructor(h,d,et){this.keepalive=h*1e3,this.checkPing=d,this.timer=(0,a.default)(et),this.reschedule()}clear(){this.timerId&&(this.timer.clear(this.timerId),this.timerId=null)}reschedule(){this.clear(),this.timerId=this.timer.set(()=>{this.checkPing(),this.timerId&&this.reschedule()},this.keepalive)}};i.default=c}),ns=M(i=>{v(),m(),_();var e=i&&i.__createBinding||(Object.create?function(Gt,Kt,Wt,Zt){Zt===void 0&&(Zt=Wt);var cr=Object.getOwnPropertyDescriptor(Kt,Wt);(!cr||("get"in cr?!Kt.__esModule:cr.writable||cr.configurable))&&(cr={enumerable:!0,get:function(){return Kt[Wt]}}),Object.defineProperty(Gt,Zt,cr)}:function(Gt,Kt,Wt,Zt){Zt===void 0&&(Zt=Wt),Gt[Zt]=Kt[Wt]}),a=i&&i.__setModuleDefault||(Object.create?function(Gt,Kt){Object.defineProperty(Gt,"default",{enumerable:!0,value:Kt})}:function(Gt,Kt){Gt.default=Kt}),c=i&&i.__importStar||function(Gt){if(Gt&&Gt.__esModule)return Gt;var Kt={};if(Gt!=null)for(var Wt in Gt)Wt!=="default"&&Object.prototype.hasOwnProperty.call(Gt,Wt)&&e(Kt,Gt,Wt);return a(Kt,Gt),Kt},h=i&&i.__importDefault||function(Gt){return Gt&&Gt.__esModule?Gt:{default:Gt}};Object.defineProperty(i,"__esModule",{value:!0});var d=h(Ku()),et=h(Ud()),ft=h(Yo()),gt=Dt(),_t=h(jd()),wt=c(Wd()),$t=h(ot()),It=h(Zo()),Rt=h(Sp()),Tt=Yr(),At=Ap(),kt=h(qa()),xt=c(Pi()),Nt=globalThis.setImmediate||((...Gt)=>{let Kt=Gt.shift();(0,Tt.nextTick)(()=>{Kt(...Gt)})}),Ft={keepalive:60,reschedulePings:!0,protocolId:"MQTT",protocolVersion:4,reconnectPeriod:1e3,connectTimeout:30*1e3,clean:!0,resubscribe:!0,writeCache:!0,timerVariant:"auto"},jt=class na extends At.TypedEventEmitter{static defaultId(){return`mqttjs_${Math.random().toString(16).substr(2,8)}`}constructor(Kt,Wt){super(),this.options=Wt||{};for(let Zt in Ft)typeof this.options[Zt]>"u"?this.options[Zt]=Ft[Zt]:this.options[Zt]=Wt[Zt];this.log=this.options.log||(0,$t.default)("mqttjs:client"),this.noop=this._noop.bind(this),this.log("MqttClient :: version:",na.VERSION),xt.isWebWorker?this.log("MqttClient :: environment","webworker"):this.log("MqttClient :: environment",xt.default?"browser":"node"),this.log("MqttClient :: options.protocol",Wt.protocol),this.log("MqttClient :: options.protocolVersion",Wt.protocolVersion),this.log("MqttClient :: options.username",Wt.username),this.log("MqttClient :: options.keepalive",Wt.keepalive),this.log("MqttClient :: options.reconnectPeriod",Wt.reconnectPeriod),this.log("MqttClient :: options.rejectUnauthorized",Wt.rejectUnauthorized),this.log("MqttClient :: options.properties.topicAliasMaximum",Wt.properties?Wt.properties.topicAliasMaximum:void 0),this.options.clientId=typeof Wt.clientId=="string"?Wt.clientId:na.defaultId(),this.log("MqttClient :: clientId",this.options.clientId),this.options.customHandleAcks=Wt.protocolVersion===5&&Wt.customHandleAcks?Wt.customHandleAcks:(...Zt)=>{Zt[3](null,0)},this.options.writeCache||(et.default.writeToStream.cacheNumbers=!1),this.streamBuilder=Kt,this.messageIdProvider=typeof this.options.messageIdProvider>"u"?new ft.default:this.options.messageIdProvider,this.outgoingStore=Wt.outgoingStore||new It.default,this.incomingStore=Wt.incomingStore||new It.default,this.queueQoSZero=Wt.queueQoSZero===void 0?!0:Wt.queueQoSZero,this._resubscribeTopics={},this.messageIdToTopic={},this.pingTimer=null,this.connected=!1,this.disconnecting=!1,this.reconnecting=!1,this.queue=[],this.connackTimer=null,this.reconnectTimer=null,this._storeProcessing=!1,this._packetIdsDuringStoreProcessing={},this._storeProcessingQueue=[],this.outgoing={},this._firstConnection=!0,Wt.properties&&Wt.properties.topicAliasMaximum>0&&(Wt.properties.topicAliasMaximum>65535?this.log("MqttClient :: options.properties.topicAliasMaximum is out of range"):this.topicAliasRecv=new d.default(Wt.properties.topicAliasMaximum)),this.on("connect",()=>{let{queue:Zt}=this,cr=()=>{let hr=Zt.shift();this.log("deliver :: entry %o",hr);let gr=null;if(!hr){this._resubscribe();return}gr=hr.packet,this.log("deliver :: call _sendPacket for %o",gr);let er=!0;gr.messageId&&gr.messageId!==0&&(this.messageIdProvider.register(gr.messageId)||(er=!1)),er?this._sendPacket(gr,mr=>{hr.cb&&hr.cb(mr),cr()}):(this.log("messageId: %d has already used. The message is skipped and removed.",gr.messageId),cr())};this.log("connect :: sending queued packets"),cr()}),this.on("close",()=>{this.log("close :: connected set to `false`"),this.connected=!1,this.log("close :: clearing connackTimer"),clearTimeout(this.connackTimer),this.log("close :: clearing ping timer"),this.pingTimer&&(this.pingTimer.clear(),this.pingTimer=null),this.topicAliasRecv&&this.topicAliasRecv.clear(),this.log("close :: calling _setupReconnect"),this._setupReconnect()}),this.options.manualConnect||(this.log("MqttClient :: setting up stream"),this.connect())}handleAuth(Kt,Wt){Wt()}handleMessage(Kt,Wt){Wt()}_nextId(){return this.messageIdProvider.allocate()}getLastMessageId(){return this.messageIdProvider.getLastAllocated()}connect(){var Kt;let Wt=new gt.Writable,Zt=et.default.parser(this.options),cr=null,hr=[];this.log("connect :: calling method to clear reconnect"),this._clearReconnect(),this.log("connect :: using streamBuilder provided to client to create stream"),this.stream=this.streamBuilder(this),Zt.on("packet",wr=>{this.log("parser :: on packet push to packets array."),hr.push(wr)});let gr=()=>{this.log("work :: getting next packet in queue");let wr=hr.shift();if(wr)this.log("work :: packet pulled from queue"),(0,Rt.default)(this,wr,er);else{this.log("work :: no packets in queue");let Dr=cr;cr=null,this.log("work :: done flag is %s",!!Dr),Dr&&Dr()}},er=()=>{if(hr.length)(0,Tt.nextTick)(gr);else{let wr=cr;cr=null,wr()}};Wt._write=(wr,Dr,Tr)=>{cr=Tr,this.log("writable stream :: parsing buffer"),Zt.parse(wr),gr()};let mr=wr=>{this.log("streamErrorHandler :: error",wr.message),wr.code?(this.log("streamErrorHandler :: emitting error"),this.emit("error",wr)):this.noop(wr)};this.log("connect :: pipe stream to writable stream"),this.stream.pipe(Wt),this.stream.on("error",mr),this.stream.on("close",()=>{this.log("(%s)stream :: on close",this.options.clientId),this._flushVolatile(),this.log("stream: emit close to MqttClient"),this.emit("close")}),this.log("connect: sending packet `connect`");let Mr={cmd:"connect",protocolId:this.options.protocolId,protocolVersion:this.options.protocolVersion,clean:this.options.clean,clientId:this.options.clientId,keepalive:this.options.keepalive,username:this.options.username,password:this.options.password,properties:this.options.properties};if(this.options.will&&(Mr.will=Object.assign(Object.assign({},this.options.will),{payload:(Kt=this.options.will)===null||Kt===void 0?void 0:Kt.payload})),this.topicAliasRecv&&(Mr.properties||(Mr.properties={}),this.topicAliasRecv&&(Mr.properties.topicAliasMaximum=this.topicAliasRecv.max)),this._writePacket(Mr),Zt.on("error",this.emit.bind(this,"error")),this.options.properties){if(!this.options.properties.authenticationMethod&&this.options.properties.authenticationData)return this.end(()=>this.emit("error",new Error("Packet has no Authentication Method"))),this;if(this.options.properties.authenticationMethod&&this.options.authPacket&&typeof this.options.authPacket=="object"){let wr=Object.assign({cmd:"auth",reasonCode:0},this.options.authPacket);this._writePacket(wr)}}return this.stream.setMaxListeners(1e3),clearTimeout(this.connackTimer),this.connackTimer=setTimeout(()=>{this.log("!!connectTimeout hit!! Calling _cleanUp with force `true`"),this.emit("error",new Error("connack timeout")),this._cleanUp(!0)},this.options.connectTimeout),this}publish(Kt,Wt,Zt,cr){this.log("publish :: message `%s` to topic `%s`",Wt,Kt);let{options:hr}=this;typeof Zt=="function"&&(cr=Zt,Zt=null),Zt=Zt||{},Zt=Object.assign(Object.assign({},{qos:0,retain:!1,dup:!1}),Zt);let{qos:gr,retain:er,dup:mr,properties:Mr,cbStorePut:wr}=Zt;if(this._checkDisconnecting(cr))return this;let Dr=()=>{let Tr=0;if((gr===1||gr===2)&&(Tr=this._nextId(),Tr===null))return this.log("No messageId left"),!1;let fr={cmd:"publish",topic:Kt,payload:Wt,qos:gr,retain:er,messageId:Tr,dup:mr};switch(hr.protocolVersion===5&&(fr.properties=Mr),this.log("publish :: qos",gr),gr){case 1:case 2:this.outgoing[fr.messageId]={volatile:!1,cb:cr||this.noop},this.log("MqttClient:publish: packet cmd: %s",fr.cmd),this._sendPacket(fr,void 0,wr);break;default:this.log("MqttClient:publish: packet cmd: %s",fr.cmd),this._sendPacket(fr,cr,wr);break}return!0};return(this._storeProcessing||this._storeProcessingQueue.length>0||!Dr())&&this._storeProcessingQueue.push({invoke:Dr,cbStorePut:Zt.cbStorePut,callback:cr}),this}publishAsync(Kt,Wt,Zt){return new Promise((cr,hr)=>{this.publish(Kt,Wt,Zt,(gr,er)=>{gr?hr(gr):cr(er)})})}subscribe(Kt,Wt,Zt){let cr=this.options.protocolVersion;typeof Wt=="function"&&(Zt=Wt),Zt=Zt||this.noop;let hr=!1,gr=[];typeof Kt=="string"?(Kt=[Kt],gr=Kt):Array.isArray(Kt)?gr=Kt:typeof Kt=="object"&&(hr=Kt.resubscribe,delete Kt.resubscribe,gr=Object.keys(Kt));let er=wt.validateTopics(gr);if(er!==null)return Nt(Zt,new Error(`Invalid topic ${er}`)),this;if(this._checkDisconnecting(Zt))return this.log("subscribe: discconecting true"),this;let mr={qos:0};cr===5&&(mr.nl=!1,mr.rap=!1,mr.rh=0),Wt=Object.assign(Object.assign({},mr),Wt);let Mr=Wt.properties,wr=[],Dr=(fr,yr)=>{if(yr=yr||Wt,!Object.prototype.hasOwnProperty.call(this._resubscribeTopics,fr)||this._resubscribeTopics[fr].qos<yr.qos||hr){let $r={topic:fr,qos:yr.qos};cr===5&&($r.nl=yr.nl,$r.rap=yr.rap,$r.rh=yr.rh,$r.properties=Mr),this.log("subscribe: pushing topic `%s` and qos `%s` to subs list",$r.topic,$r.qos),wr.push($r)}};if(Array.isArray(Kt)?Kt.forEach(fr=>{this.log("subscribe: array topic %s",fr),Dr(fr)}):Object.keys(Kt).forEach(fr=>{this.log("subscribe: object topic %s, %o",fr,Kt[fr]),Dr(fr,Kt[fr])}),!wr.length)return Zt(null,[]),this;let Tr=()=>{let fr=this._nextId();if(fr===null)return this.log("No messageId left"),!1;let yr={cmd:"subscribe",subscriptions:wr,messageId:fr};if(Mr&&(yr.properties=Mr),this.options.resubscribe){this.log("subscribe :: resubscribe true");let $r=[];wr.forEach(Fr=>{if(this.options.reconnectPeriod>0){let dr={qos:Fr.qos};cr===5&&(dr.nl=Fr.nl||!1,dr.rap=Fr.rap||!1,dr.rh=Fr.rh||0,dr.properties=Fr.properties),this._resubscribeTopics[Fr.topic]=dr,$r.push(Fr.topic)}}),this.messageIdToTopic[yr.messageId]=$r}return this.outgoing[yr.messageId]={volatile:!0,cb($r,Fr){if(!$r){let{granted:dr}=Fr;for(let Br=0;Br<dr.length;Br+=1)wr[Br].qos=dr[Br]}Zt($r,wr)}},this.log("subscribe :: call _sendPacket"),this._sendPacket(yr),!0};return(this._storeProcessing||this._storeProcessingQueue.length>0||!Tr())&&this._storeProcessingQueue.push({invoke:Tr,callback:Zt}),this}subscribeAsync(Kt,Wt){return new Promise((Zt,cr)=>{this.subscribe(Kt,Wt,(hr,gr)=>{hr?cr(hr):Zt(gr)})})}unsubscribe(Kt,Wt,Zt){typeof Kt=="string"&&(Kt=[Kt]),typeof Wt=="function"&&(Zt=Wt),Zt=Zt||this.noop;let cr=wt.validateTopics(Kt);if(cr!==null)return Nt(Zt,new Error(`Invalid topic ${cr}`)),this;if(this._checkDisconnecting(Zt))return this;let hr=()=>{let gr=this._nextId();if(gr===null)return this.log("No messageId left"),!1;let er={cmd:"unsubscribe",messageId:gr,unsubscriptions:[]};return typeof Kt=="string"?er.unsubscriptions=[Kt]:Array.isArray(Kt)&&(er.unsubscriptions=Kt),this.options.resubscribe&&er.unsubscriptions.forEach(mr=>{delete this._resubscribeTopics[mr]}),typeof Wt=="object"&&Wt.properties&&(er.properties=Wt.properties),this.outgoing[er.messageId]={volatile:!0,cb:Zt},this.log("unsubscribe: call _sendPacket"),this._sendPacket(er),!0};return(this._storeProcessing||this._storeProcessingQueue.length>0||!hr())&&this._storeProcessingQueue.push({invoke:hr,callback:Zt}),this}unsubscribeAsync(Kt,Wt){return new Promise((Zt,cr)=>{this.unsubscribe(Kt,Wt,(hr,gr)=>{hr?cr(hr):Zt(gr)})})}end(Kt,Wt,Zt){this.log("end :: (%s)",this.options.clientId),(Kt==null||typeof Kt!="boolean")&&(Zt=Zt||Wt,Wt=Kt,Kt=!1),typeof Wt!="object"&&(Zt=Zt||Wt,Wt=null),this.log("end :: cb? %s",!!Zt),(!Zt||typeof Zt!="function")&&(Zt=this.noop);let cr=()=>{this.log("end :: closeStores: closing incoming and outgoing stores"),this.disconnected=!0,this.incomingStore.close(gr=>{this.outgoingStore.close(er=>{if(this.log("end :: closeStores: emitting end"),this.emit("end"),Zt){let mr=gr||er;this.log("end :: closeStores: invoking callback with args"),Zt(mr)}})}),this._deferredReconnect&&this._deferredReconnect()},hr=()=>{this.log("end :: (%s) :: finish :: calling _cleanUp with force %s",this.options.clientId,Kt),this._cleanUp(Kt,()=>{this.log("end :: finish :: calling process.nextTick on closeStores"),(0,Tt.nextTick)(cr)},Wt)};return this.disconnecting?(Zt(),this):(this._clearReconnect(),this.disconnecting=!0,!Kt&&Object.keys(this.outgoing).length>0?(this.log("end :: (%s) :: calling finish in 10ms once outgoing is empty",this.options.clientId),this.once("outgoingEmpty",setTimeout.bind(null,hr,10))):(this.log("end :: (%s) :: immediately calling finish",this.options.clientId),hr()),this)}endAsync(Kt,Wt){return new Promise((Zt,cr)=>{this.end(Kt,Wt,hr=>{hr?cr(hr):Zt()})})}removeOutgoingMessage(Kt){if(this.outgoing[Kt]){let{cb:Wt}=this.outgoing[Kt];this._removeOutgoingAndStoreMessage(Kt,()=>{Wt(new Error("Message removed"))})}return this}reconnect(Kt){this.log("client reconnect");let Wt=()=>{Kt?(this.options.incomingStore=Kt.incomingStore,this.options.outgoingStore=Kt.outgoingStore):(this.options.incomingStore=null,this.options.outgoingStore=null),this.incomingStore=this.options.incomingStore||new It.default,this.outgoingStore=this.options.outgoingStore||new It.default,this.disconnecting=!1,this.disconnected=!1,this._deferredReconnect=null,this._reconnect()};return this.disconnecting&&!this.disconnected?this._deferredReconnect=Wt:Wt(),this}_flushVolatile(){this.outgoing&&(this.log("_flushVolatile :: deleting volatile messages from the queue and setting their callbacks as error function"),Object.keys(this.outgoing).forEach(Kt=>{this.outgoing[Kt].volatile&&typeof this.outgoing[Kt].cb=="function"&&(this.outgoing[Kt].cb(new Error("Connection closed")),delete this.outgoing[Kt])}))}_flush(){this.outgoing&&(this.log("_flush: queue exists? %b",!!this.outgoing),Object.keys(this.outgoing).forEach(Kt=>{typeof this.outgoing[Kt].cb=="function"&&(this.outgoing[Kt].cb(new Error("Connection closed")),delete this.outgoing[Kt])}))}_removeTopicAliasAndRecoverTopicName(Kt){let Wt;Kt.properties&&(Wt=Kt.properties.topicAlias);let Zt=Kt.topic.toString();if(this.log("_removeTopicAliasAndRecoverTopicName :: alias %d, topic %o",Wt,Zt),Zt.length===0){if(typeof Wt>"u")return new Error("Unregistered Topic Alias");if(Zt=this.topicAliasSend.getTopicByAlias(Wt),typeof Zt>"u")return new Error("Unregistered Topic Alias");Kt.topic=Zt}Wt&&delete Kt.properties.topicAlias}_checkDisconnecting(Kt){return this.disconnecting&&(Kt&&Kt!==this.noop?Kt(new Error("client disconnecting")):this.emit("error",new Error("client disconnecting"))),this.disconnecting}_reconnect(){this.log("_reconnect: emitting reconnect to client"),this.emit("reconnect"),this.connected?(this.end(()=>{this.connect()}),this.log("client already connected. disconnecting first.")):(this.log("_reconnect: calling connect"),this.connect())}_setupReconnect(){!this.disconnecting&&!this.reconnectTimer&&this.options.reconnectPeriod>0?(this.reconnecting||(this.log("_setupReconnect :: emit `offline` state"),this.emit("offline"),this.log("_setupReconnect :: set `reconnecting` to `true`"),this.reconnecting=!0),this.log("_setupReconnect :: setting reconnectTimer for %d ms",this.options.reconnectPeriod),this.reconnectTimer=setInterval(()=>{this.log("reconnectTimer :: reconnect triggered!"),this._reconnect()},this.options.reconnectPeriod)):this.log("_setupReconnect :: doing nothing...")}_clearReconnect(){this.log("_clearReconnect : clearing reconnect timer"),this.reconnectTimer&&(clearInterval(this.reconnectTimer),this.reconnectTimer=null)}_cleanUp(Kt,Wt,Zt={}){if(Wt&&(this.log("_cleanUp :: done callback provided for on stream close"),this.stream.on("close",Wt)),this.log("_cleanUp :: forced? %s",Kt),Kt)this.options.reconnectPeriod===0&&this.options.clean&&this._flush(),this.log("_cleanUp :: (%s) :: destroying stream",this.options.clientId),this.stream.destroy();else{let cr=Object.assign({cmd:"disconnect"},Zt);this.log("_cleanUp :: (%s) :: call _sendPacket with disconnect packet",this.options.clientId),this._sendPacket(cr,()=>{this.log("_cleanUp :: (%s) :: destroying stream",this.options.clientId),Nt(()=>{this.stream.end(()=>{this.log("_cleanUp :: (%s) :: stream destroyed",this.options.clientId)})})})}!this.disconnecting&&!this.reconnecting&&(this.log("_cleanUp :: client not disconnecting/reconnecting. Clearing and resetting reconnect."),this._clearReconnect(),this._setupReconnect()),this.pingTimer&&(this.log("_cleanUp :: clearing pingTimer"),this.pingTimer.clear(),this.pingTimer=null),Wt&&!this.connected&&(this.log("_cleanUp :: (%s) :: removing stream `done` callback `close` listener",this.options.clientId),this.stream.removeListener("close",Wt),Wt())}_storeAndSend(Kt,Wt,Zt){this.log("storeAndSend :: store packet with cmd %s to outgoingStore",Kt.cmd);let cr=Kt,hr;if(cr.cmd==="publish"&&(cr=(0,_t.default)(Kt),hr=this._removeTopicAliasAndRecoverTopicName(cr),hr))return Wt&&Wt(hr);this.outgoingStore.put(cr,gr=>{if(gr)return Wt&&Wt(gr);Zt(),this._writePacket(Kt,Wt)})}_applyTopicAlias(Kt){if(this.options.protocolVersion===5&&Kt.cmd==="publish"){let Wt;Kt.properties&&(Wt=Kt.properties.topicAlias);let Zt=Kt.topic.toString();if(this.topicAliasSend)if(Wt){if(Zt.length!==0&&(this.log("applyTopicAlias :: register topic: %s - alias: %d",Zt,Wt),!this.topicAliasSend.put(Zt,Wt)))return this.log("applyTopicAlias :: error out of range. topic: %s - alias: %d",Zt,Wt),new Error("Sending Topic Alias out of range")}else Zt.length!==0&&(this.options.autoAssignTopicAlias?(Wt=this.topicAliasSend.getAliasByTopic(Zt),Wt?(Kt.topic="",Kt.properties=Object.assign(Object.assign({},Kt.properties),{topicAlias:Wt}),this.log("applyTopicAlias :: auto assign(use) topic: %s - alias: %d",Zt,Wt)):(Wt=this.topicAliasSend.getLruAlias(),this.topicAliasSend.put(Zt,Wt),Kt.properties=Object.assign(Object.assign({},Kt.properties),{topicAlias:Wt}),this.log("applyTopicAlias :: auto assign topic: %s - alias: %d",Zt,Wt))):this.options.autoUseTopicAlias&&(Wt=this.topicAliasSend.getAliasByTopic(Zt),Wt&&(Kt.topic="",Kt.properties=Object.assign(Object.assign({},Kt.properties),{topicAlias:Wt}),this.log("applyTopicAlias :: auto use topic: %s - alias: %d",Zt,Wt))));else if(Wt)return this.log("applyTopicAlias :: error out of range. topic: %s - alias: %d",Zt,Wt),new Error("Sending Topic Alias out of range")}}_noop(Kt){this.log("noop ::",Kt)}_writePacket(Kt,Wt){this.log("_writePacket :: packet: %O",Kt),this.log("_writePacket :: emitting `packetsend`"),this.emit("packetsend",Kt),this._shiftPingInterval(),this.log("_writePacket :: writing to stream");let Zt=et.default.writeToStream(Kt,this.stream,this.options);this.log("_writePacket :: writeToStream result %s",Zt),!Zt&&Wt&&Wt!==this.noop?(this.log("_writePacket :: handle events on `drain` once through callback."),this.stream.once("drain",Wt)):Wt&&(this.log("_writePacket :: invoking cb"),Wt())}_sendPacket(Kt,Wt,Zt,cr){this.log("_sendPacket :: (%s) ::  start",this.options.clientId),Zt=Zt||this.noop,Wt=Wt||this.noop;let hr=this._applyTopicAlias(Kt);if(hr){Wt(hr);return}if(!this.connected){if(Kt.cmd==="auth"){this._writePacket(Kt,Wt);return}this.log("_sendPacket :: client not connected. Storing packet offline."),this._storePacket(Kt,Wt,Zt);return}if(cr){this._writePacket(Kt,Wt);return}switch(Kt.cmd){case"publish":break;case"pubrel":this._storeAndSend(Kt,Wt,Zt);return;default:this._writePacket(Kt,Wt);return}switch(Kt.qos){case 2:case 1:this._storeAndSend(Kt,Wt,Zt);break;case 0:default:this._writePacket(Kt,Wt);break}this.log("_sendPacket :: (%s) ::  end",this.options.clientId)}_storePacket(Kt,Wt,Zt){this.log("_storePacket :: packet: %o",Kt),this.log("_storePacket :: cb? %s",!!Wt),Zt=Zt||this.noop;let cr=Kt;if(cr.cmd==="publish"){cr=(0,_t.default)(Kt);let gr=this._removeTopicAliasAndRecoverTopicName(cr);if(gr)return Wt&&Wt(gr)}let hr=cr.qos||0;hr===0&&this.queueQoSZero||cr.cmd!=="publish"?this.queue.push({packet:cr,cb:Wt}):hr>0?(Wt=this.outgoing[cr.messageId]?this.outgoing[cr.messageId].cb:null,this.outgoingStore.put(cr,gr=>{if(gr)return Wt&&Wt(gr);Zt()})):Wt&&Wt(new Error("No connection to broker"))}_setupPingTimer(){this.log("_setupPingTimer :: keepalive %d (seconds)",this.options.keepalive),!this.pingTimer&&this.options.keepalive&&(this.pingResp=!0,this.pingTimer=new kt.default(this.options.keepalive,()=>{this._checkPing()},this.options.timerVariant))}_shiftPingInterval(){this.pingTimer&&this.options.keepalive&&this.options.reschedulePings&&this.pingTimer.reschedule()}_checkPing(){this.log("_checkPing :: checking ping..."),this.pingResp?(this.log("_checkPing :: ping response received. Clearing flag and sending `pingreq`"),this.pingResp=!1,this._sendPacket({cmd:"pingreq"})):(this.emit("error",new Error("Keepalive timeout")),this.log("_checkPing :: calling _cleanUp with force true"),this._cleanUp(!0))}_resubscribe(){this.log("_resubscribe");let Kt=Object.keys(this._resubscribeTopics);if(!this._firstConnection&&(this.options.clean||this.options.protocolVersion>=4&&!this.connackPacket.sessionPresent)&&Kt.length>0)if(this.options.resubscribe)if(this.options.protocolVersion===5){this.log("_resubscribe: protocolVersion 5");for(let Wt=0;Wt<Kt.length;Wt++){let Zt={};Zt[Kt[Wt]]=this._resubscribeTopics[Kt[Wt]],Zt.resubscribe=!0,this.subscribe(Zt,{properties:Zt[Kt[Wt]].properties})}}else this._resubscribeTopics.resubscribe=!0,this.subscribe(this._resubscribeTopics);else this._resubscribeTopics={};this._firstConnection=!1}_onConnect(Kt){if(this.disconnected){this.emit("connect",Kt);return}this.connackPacket=Kt,this.messageIdProvider.clear(),this._setupPingTimer(),this.connected=!0;let Wt=()=>{let Zt=this.outgoingStore.createStream(),cr=()=>{Zt.destroy(),Zt=null,this._flushStoreProcessingQueue(),hr()},hr=()=>{this._storeProcessing=!1,this._packetIdsDuringStoreProcessing={}};this.once("close",cr),Zt.on("error",er=>{hr(),this._flushStoreProcessingQueue(),this.removeListener("close",cr),this.emit("error",er)});let gr=()=>{if(!Zt)return;let er=Zt.read(1),mr;if(!er){Zt.once("readable",gr);return}if(this._storeProcessing=!0,this._packetIdsDuringStoreProcessing[er.messageId]){gr();return}!this.disconnecting&&!this.reconnectTimer?(mr=this.outgoing[er.messageId]?this.outgoing[er.messageId].cb:null,this.outgoing[er.messageId]={volatile:!1,cb(Mr,wr){mr&&mr(Mr,wr),gr()}},this._packetIdsDuringStoreProcessing[er.messageId]=!0,this.messageIdProvider.register(er.messageId)?this._sendPacket(er,void 0,void 0,!0):this.log("messageId: %d has already used.",er.messageId)):Zt.destroy&&Zt.destroy()};Zt.on("end",()=>{let er=!0;for(let mr in this._packetIdsDuringStoreProcessing)if(!this._packetIdsDuringStoreProcessing[mr]){er=!1;break}this.removeListener("close",cr),er?(hr(),this._invokeAllStoreProcessingQueue(),this.emit("connect",Kt)):Wt()}),gr()};Wt()}_invokeStoreProcessingQueue(){if(!this._storeProcessing&&this._storeProcessingQueue.length>0){let Kt=this._storeProcessingQueue[0];if(Kt&&Kt.invoke())return this._storeProcessingQueue.shift(),!0}return!1}_invokeAllStoreProcessingQueue(){for(;this._invokeStoreProcessingQueue(););}_flushStoreProcessingQueue(){for(let Kt of this._storeProcessingQueue)Kt.cbStorePut&&Kt.cbStorePut(new Error("Connection closed")),Kt.callback&&Kt.callback(new Error("Connection closed"));this._storeProcessingQueue.splice(0)}_removeOutgoingAndStoreMessage(Kt,Wt){delete this.outgoing[Kt],this.outgoingStore.del({messageId:Kt},(Zt,cr)=>{Wt(Zt,cr),this.messageIdProvider.deallocate(Kt),this._invokeStoreProcessingQueue()})}};jt.VERSION="5.5.0",i.default=jt}),Wp=M(i=>{v(),m(),_(),Object.defineProperty(i,"__esModule",{value:!0});var e=xa(),a=class{constructor(){this.numberAllocator=new e.NumberAllocator(1,65535)}allocate(){return this.lastId=this.numberAllocator.alloc(),this.lastId}getLastAllocated(){return this.lastId}register(c){return this.numberAllocator.use(c)}deallocate(c){this.numberAllocator.free(c)}clear(){this.numberAllocator.clear()}};i.default=a});function Ar(i){throw new RangeError(rE[i])}function $p(i,e){let a=i.split("@"),c="";a.length>1&&(c=a[0]+"@",i=a[1]);let h=function(d,et){let ft=[],gt=d.length;for(;gt--;)ft[gt]=et(d[gt]);return ft}((i=i.replace(tE,".")).split("."),e).join(".");return c+h}function Kp(i){let e=[],a=0,c=i.length;for(;a<c;){let h=i.charCodeAt(a++);if(h>=55296&&h<=56319&&a<c){let d=i.charCodeAt(a++);(64512&d)==56320?e.push(((1023&h)<<10)+(1023&d)+65536):(e.push(h),a--)}else e.push(h)}return e}var Zv,eE,tE,rE,ht,Ha,Hp,Gp,Vp,zp,zt,Qp=be(()=>{v(),m(),_(),Zv=/^xn--/,eE=/[^\0-\x7E]/,tE=/[\x2E\u3002\uFF0E\uFF61]/g,rE={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},ht=Math.floor,Ha=String.fromCharCode,Hp=function(i,e){return i+22+75*(i<26)-((e!=0)<<5)},Gp=function(i,e,a){let c=0;for(i=a?ht(i/700):i>>1,i+=ht(i/e);i>455;c+=36)i=ht(i/35);return ht(c+36*i/(i+38))},Vp=function(i){let e=[],a=i.length,c=0,h=128,d=72,et=i.lastIndexOf("-");et<0&&(et=0);for(let gt=0;gt<et;++gt)i.charCodeAt(gt)>=128&&Ar("not-basic"),e.push(i.charCodeAt(gt));for(let gt=et>0?et+1:0;gt<a;){let _t=c;for(let $t=1,It=36;;It+=36){gt>=a&&Ar("invalid-input");let Rt=(ft=i.charCodeAt(gt++))-48<10?ft-22:ft-65<26?ft-65:ft-97<26?ft-97:36;(Rt>=36||Rt>ht((2147483647-c)/$t))&&Ar("overflow"),c+=Rt*$t;let Tt=It<=d?1:It>=d+26?26:It-d;if(Rt<Tt)break;let At=36-Tt;$t>ht(2147483647/At)&&Ar("overflow"),$t*=At}let wt=e.length+1;d=Gp(c-_t,wt,_t==0),ht(c/wt)>2147483647-h&&Ar("overflow"),h+=ht(c/wt),c%=wt,e.splice(c++,0,h)}var ft;return String.fromCodePoint(...e)},zp=function(i){let e=[],a=(i=Kp(i)).length,c=128,h=0,d=72;for(let gt of i)gt<128&&e.push(Ha(gt));let et=e.length,ft=et;for(et&&e.push("-");ft<a;){let gt=2147483647;for(let wt of i)wt>=c&&wt<gt&&(gt=wt);let _t=ft+1;gt-c>ht((2147483647-h)/_t)&&Ar("overflow"),h+=(gt-c)*_t,c=gt;for(let wt of i)if(wt<c&&++h>2147483647&&Ar("overflow"),wt==c){let $t=h;for(let It=36;;It+=36){let Rt=It<=d?1:It>=d+26?26:It-d;if($t<Rt)break;let Tt=$t-Rt,At=36-Rt;e.push(Ha(Hp(Rt+Tt%At,0))),$t=ht(Tt/At)}e.push(Ha(Hp($t,0))),d=Gp(h,_t,ft==et),h=0,++ft}++h,++c}return e.join("")},zt={version:"2.1.0",ucs2:{decode:Kp,encode:i=>String.fromCodePoint(...i)},decode:Vp,encode:zp,toASCII:function(i){return $p(i,function(e){return eE.test(e)?"xn--"+zp(e):e})},toUnicode:function(i){return $p(i,function(e){return Zv.test(e)?Vp(e.slice(4).toLowerCase()):e})}},zt.decode,zt.encode,zt.toASCII,zt.toUnicode,zt.ucs2,zt.version});function iE(i,e){return Object.prototype.hasOwnProperty.call(i,e)}var nE,ki,sE,dt,Yp=be(()=>{v(),m(),_(),nE=function(i,e,a,c){e=e||"&",a=a||"=";var h={};if(typeof i!="string"||i.length===0)return h;var d=/\+/g;i=i.split(e);var et=1e3;c&&typeof c.maxKeys=="number"&&(et=c.maxKeys);var ft=i.length;et>0&&ft>et&&(ft=et);for(var gt=0;gt<ft;++gt){var _t,wt,$t,It,Rt=i[gt].replace(d,"%20"),Tt=Rt.indexOf(a);Tt>=0?(_t=Rt.substr(0,Tt),wt=Rt.substr(Tt+1)):(_t=Rt,wt=""),$t=decodeURIComponent(_t),It=decodeURIComponent(wt),iE(h,$t)?Array.isArray(h[$t])?h[$t].push(It):h[$t]=[h[$t],It]:h[$t]=It}return h},ki=function(i){switch(typeof i){case"string":return i;case"boolean":return i?"true":"false";case"number":return isFinite(i)?i:"";default:return""}},sE=function(i,e,a,c){return e=e||"&",a=a||"=",i===null&&(i=void 0),typeof i=="object"?Object.keys(i).map(function(h){var d=encodeURIComponent(ki(h))+a;return Array.isArray(i[h])?i[h].map(function(et){return d+encodeURIComponent(ki(et))}).join(e):d+encodeURIComponent(ki(i[h]))}).join(e):c?encodeURIComponent(ki(c))+a+encodeURIComponent(ki(i)):""},dt={},dt.decode=dt.parse=nE,dt.encode=dt.stringify=sE,dt.decode,dt.encode,dt.parse,dt.stringify});function Va(){throw new Error("setTimeout has not been defined")}function za(){throw new Error("clearTimeout has not been defined")}function Zp(i){if(Bt===setTimeout)return setTimeout(i,0);if((Bt===Va||!Bt)&&setTimeout)return Bt=setTimeout,setTimeout(i,0);try{return Bt(i,0)}catch{try{return Bt.call(null,i,0)}catch{return Bt.call(this||ri,i,0)}}}function oE(){ti&&Ir&&(ti=!1,Ir.length?Ot=Ir.concat(Ot):ss=-1,Ot.length&&eg())}function eg(){if(!ti){var i=Zp(oE);ti=!0;for(var e=Ot.length;e;){for(Ir=Ot,Ot=[];++ss<e;)Ir&&Ir[ss].run();ss=-1,e=Ot.length}Ir=null,ti=!1,function(a){if(Pt===clearTimeout)return clearTimeout(a);if((Pt===za||!Pt)&&clearTimeout)return Pt=clearTimeout,clearTimeout(a);try{Pt(a)}catch{try{return Pt.call(null,a)}catch{return Pt.call(this||ri,a)}}}(i)}}function Jp(i,e){(this||ri).fun=i,(this||ri).array=e}function Ct(){}var Xp,Bt,Pt,ri,fe,Ir,Ot,ti,ss,ne,tg=be(()=>{v(),m(),_(),ri=typeof globalThis<"u"?globalThis:typeof self<"u"?self:global,fe=Xp={},function(){try{Bt=typeof setTimeout=="function"?setTimeout:Va}catch{Bt=Va}try{Pt=typeof clearTimeout=="function"?clearTimeout:za}catch{Pt=za}}(),Ot=[],ti=!1,ss=-1,fe.nextTick=function(i){var e=new Array(arguments.length-1);if(arguments.length>1)for(var a=1;a<arguments.length;a++)e[a-1]=arguments[a];Ot.push(new Jp(i,e)),Ot.length!==1||ti||Zp(eg)},Jp.prototype.run=function(){(this||ri).fun.apply(null,(this||ri).array)},fe.title="browser",fe.browser=!0,fe.env={},fe.argv=[],fe.version="",fe.versions={},fe.on=Ct,fe.addListener=Ct,fe.once=Ct,fe.off=Ct,fe.removeListener=Ct,fe.removeAllListeners=Ct,fe.emit=Ct,fe.prependListener=Ct,fe.prependOnceListener=Ct,fe.listeners=function(i){return[]},fe.binding=function(i){throw new Error("process.binding is not supported")},fe.cwd=function(){return"/"},fe.chdir=function(i){throw new Error("process.chdir is not supported")},fe.umask=function(){return 0},ne=Xp,ne.addListener,ne.argv,ne.binding,ne.browser,ne.chdir,ne.cwd,ne.emit,ne.env,ne.listeners,ne.nextTick,ne.off,ne.on,ne.once,ne.prependListener,ne.prependOnceListener,ne.removeAllListeners,ne.removeListener,ne.title,ne.umask,ne.version,ne.versions});function aE(){if(rg)return Ka;rg=!0;var i=Ka={},e,a;function c(){throw new Error("setTimeout has not been defined")}function h(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?e=setTimeout:e=c}catch{e=c}try{typeof clearTimeout=="function"?a=clearTimeout:a=h}catch{a=h}})();function d(At){if(e===setTimeout)return setTimeout(At,0);if((e===c||!e)&&setTimeout)return e=setTimeout,setTimeout(At,0);try{return e(At,0)}catch{try{return e.call(null,At,0)}catch{return e.call(this||ii,At,0)}}}function et(At){if(a===clearTimeout)return clearTimeout(At);if((a===h||!a)&&clearTimeout)return a=clearTimeout,clearTimeout(At);try{return a(At)}catch{try{return a.call(null,At)}catch{return a.call(this||ii,At)}}}var ft=[],gt=!1,_t,wt=-1;function $t(){!gt||!_t||(gt=!1,_t.length?ft=_t.concat(ft):wt=-1,ft.length&&It())}function It(){if(!gt){var At=d($t);gt=!0;for(var kt=ft.length;kt;){for(_t=ft,ft=[];++wt<kt;)_t&&_t[wt].run();wt=-1,kt=ft.length}_t=null,gt=!1,et(At)}}i.nextTick=function(At){var kt=new Array(arguments.length-1);if(arguments.length>1)for(var xt=1;xt<arguments.length;xt++)kt[xt-1]=arguments[xt];ft.push(new Rt(At,kt)),ft.length===1&&!gt&&d(It)};function Rt(At,kt){(this||ii).fun=At,(this||ii).array=kt}Rt.prototype.run=function(){(this||ii).fun.apply(null,(this||ii).array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={};function Tt(){}return i.on=Tt,i.addListener=Tt,i.once=Tt,i.off=Tt,i.removeListener=Tt,i.removeAllListeners=Tt,i.emit=Tt,i.prependListener=Tt,i.prependOnceListener=Tt,i.listeners=function(At){return[]},i.binding=function(At){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(At){throw new Error("process.chdir is not supported")},i.umask=function(){return 0},Ka}var Ka,rg,ii,re,Ga=be(()=>{v(),m(),_(),Ka={},rg=!1,ii=typeof globalThis<"u"?globalThis:typeof self<"u"?self:global,re=aE(),re.platform="browser",re.addListener,re.argv,re.binding,re.browser,re.chdir,re.cwd,re.emit,re.env,re.listeners,re.nextTick,re.off,re.on,re.once,re.prependListener,re.prependOnceListener,re.removeAllListeners,re.removeListener,re.title,re.umask,re.version,re.versions});function lE(){if(ig)return Qa;ig=!0;var i=re;function e(d){if(typeof d!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(d))}function a(d,et){for(var ft="",gt=0,_t=-1,wt=0,$t,It=0;It<=d.length;++It){if(It<d.length)$t=d.charCodeAt(It);else{if($t===47)break;$t=47}if($t===47){if(!(_t===It-1||wt===1))if(_t!==It-1&&wt===2){if(ft.length<2||gt!==2||ft.charCodeAt(ft.length-1)!==46||ft.charCodeAt(ft.length-2)!==46){if(ft.length>2){var Rt=ft.lastIndexOf("/");if(Rt!==ft.length-1){Rt===-1?(ft="",gt=0):(ft=ft.slice(0,Rt),gt=ft.length-1-ft.lastIndexOf("/")),_t=It,wt=0;continue}}else if(ft.length===2||ft.length===1){ft="",gt=0,_t=It,wt=0;continue}}et&&(ft.length>0?ft+="/..":ft="..",gt=2)}else ft.length>0?ft+="/"+d.slice(_t+1,It):ft=d.slice(_t+1,It),gt=It-_t-1;_t=It,wt=0}else $t===46&&wt!==-1?++wt:wt=-1}return ft}function c(d,et){var ft=et.dir||et.root,gt=et.base||(et.name||"")+(et.ext||"");return ft?ft===et.root?ft+gt:ft+d+gt:gt}var h={resolve:function(){for(var d="",et=!1,ft,gt=arguments.length-1;gt>=-1&&!et;gt--){var _t;gt>=0?_t=arguments[gt]:(ft===void 0&&(ft=i.cwd()),_t=ft),e(_t),_t.length!==0&&(d=_t+"/"+d,et=_t.charCodeAt(0)===47)}return d=a(d,!et),et?d.length>0?"/"+d:"/":d.length>0?d:"."},normalize:function(d){if(e(d),d.length===0)return".";var et=d.charCodeAt(0)===47,ft=d.charCodeAt(d.length-1)===47;return d=a(d,!et),d.length===0&&!et&&(d="."),d.length>0&&ft&&(d+="/"),et?"/"+d:d},isAbsolute:function(d){return e(d),d.length>0&&d.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var d,et=0;et<arguments.length;++et){var ft=arguments[et];e(ft),ft.length>0&&(d===void 0?d=ft:d+="/"+ft)}return d===void 0?".":h.normalize(d)},relative:function(d,et){if(e(d),e(et),d===et||(d=h.resolve(d),et=h.resolve(et),d===et))return"";for(var ft=1;ft<d.length&&d.charCodeAt(ft)===47;++ft);for(var gt=d.length,_t=gt-ft,wt=1;wt<et.length&&et.charCodeAt(wt)===47;++wt);for(var $t=et.length,It=$t-wt,Rt=_t<It?_t:It,Tt=-1,At=0;At<=Rt;++At){if(At===Rt){if(It>Rt){if(et.charCodeAt(wt+At)===47)return et.slice(wt+At+1);if(At===0)return et.slice(wt+At)}else _t>Rt&&(d.charCodeAt(ft+At)===47?Tt=At:At===0&&(Tt=0));break}var kt=d.charCodeAt(ft+At),xt=et.charCodeAt(wt+At);if(kt!==xt)break;kt===47&&(Tt=At)}var Nt="";for(At=ft+Tt+1;At<=gt;++At)(At===gt||d.charCodeAt(At)===47)&&(Nt.length===0?Nt+="..":Nt+="/..");return Nt.length>0?Nt+et.slice(wt+Tt):(wt+=Tt,et.charCodeAt(wt)===47&&++wt,et.slice(wt))},_makeLong:function(d){return d},dirname:function(d){if(e(d),d.length===0)return".";for(var et=d.charCodeAt(0),ft=et===47,gt=-1,_t=!0,wt=d.length-1;wt>=1;--wt)if(et=d.charCodeAt(wt),et===47){if(!_t){gt=wt;break}}else _t=!1;return gt===-1?ft?"/":".":ft&&gt===1?"//":d.slice(0,gt)},basename:function(d,et){if(et!==void 0&&typeof et!="string")throw new TypeError('"ext" argument must be a string');e(d);var ft=0,gt=-1,_t=!0,wt;if(et!==void 0&&et.length>0&&et.length<=d.length){if(et.length===d.length&&et===d)return"";var $t=et.length-1,It=-1;for(wt=d.length-1;wt>=0;--wt){var Rt=d.charCodeAt(wt);if(Rt===47){if(!_t){ft=wt+1;break}}else It===-1&&(_t=!1,It=wt+1),$t>=0&&(Rt===et.charCodeAt($t)?--$t===-1&&(gt=wt):($t=-1,gt=It))}return ft===gt?gt=It:gt===-1&&(gt=d.length),d.slice(ft,gt)}else{for(wt=d.length-1;wt>=0;--wt)if(d.charCodeAt(wt)===47){if(!_t){ft=wt+1;break}}else gt===-1&&(_t=!1,gt=wt+1);return gt===-1?"":d.slice(ft,gt)}},extname:function(d){e(d);for(var et=-1,ft=0,gt=-1,_t=!0,wt=0,$t=d.length-1;$t>=0;--$t){var It=d.charCodeAt($t);if(It===47){if(!_t){ft=$t+1;break}continue}gt===-1&&(_t=!1,gt=$t+1),It===46?et===-1?et=$t:wt!==1&&(wt=1):et!==-1&&(wt=-1)}return et===-1||gt===-1||wt===0||wt===1&&et===gt-1&&et===ft+1?"":d.slice(et,gt)},format:function(d){if(d===null||typeof d!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof d);return c("/",d)},parse:function(d){e(d);var et={root:"",dir:"",base:"",ext:"",name:""};if(d.length===0)return et;var ft=d.charCodeAt(0),gt=ft===47,_t;gt?(et.root="/",_t=1):_t=0;for(var wt=-1,$t=0,It=-1,Rt=!0,Tt=d.length-1,At=0;Tt>=_t;--Tt){if(ft=d.charCodeAt(Tt),ft===47){if(!Rt){$t=Tt+1;break}continue}It===-1&&(Rt=!1,It=Tt+1),ft===46?wt===-1?wt=Tt:At!==1&&(At=1):wt!==-1&&(At=-1)}return wt===-1||It===-1||At===0||At===1&&wt===It-1&&wt===$t+1?It!==-1&&($t===0&&gt?et.base=et.name=d.slice(1,It):et.base=et.name=d.slice($t,It)):($t===0&&gt?(et.name=d.slice(1,wt),et.base=d.slice(1,It)):(et.name=d.slice($t,wt),et.base=d.slice($t,It)),et.ext=d.slice(wt,It)),$t>0?et.dir=d.slice(0,$t-1):gt&&(et.dir="/"),et},sep:"/",delimiter:":",win32:null,posix:null};return h.posix=h,Qa=h,Qa}var Qa,ig,Ya,ng=be(()=>{v(),m(),_(),Ga(),Qa={},ig=!1,Ya=lE()}),hg={};Qt(hg,{URL:()=>qE,Url:()=>xE,default:()=>X,fileURLToPath:()=>fg,format:()=>ME,parse:()=>NE,pathToFileURL:()=>cg,resolve:()=>LE,resolveObject:()=>UE});function Fe(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}function xi(i,e,a){if(i&&pt.isObject(i)&&i instanceof Fe)return i;var c=new Fe;return c.parse(i,e,a),c}function yE(){if(lg)return Za;lg=!0;var i=ne;function e(d){if(typeof d!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(d))}function a(d,et){for(var ft="",gt=0,_t=-1,wt=0,$t,It=0;It<=d.length;++It){if(It<d.length)$t=d.charCodeAt(It);else{if($t===47)break;$t=47}if($t===47){if(!(_t===It-1||wt===1))if(_t!==It-1&&wt===2){if(ft.length<2||gt!==2||ft.charCodeAt(ft.length-1)!==46||ft.charCodeAt(ft.length-2)!==46){if(ft.length>2){var Rt=ft.lastIndexOf("/");if(Rt!==ft.length-1){Rt===-1?(ft="",gt=0):(ft=ft.slice(0,Rt),gt=ft.length-1-ft.lastIndexOf("/")),_t=It,wt=0;continue}}else if(ft.length===2||ft.length===1){ft="",gt=0,_t=It,wt=0;continue}}et&&(ft.length>0?ft+="/..":ft="..",gt=2)}else ft.length>0?ft+="/"+d.slice(_t+1,It):ft=d.slice(_t+1,It),gt=It-_t-1;_t=It,wt=0}else $t===46&&wt!==-1?++wt:wt=-1}return ft}function c(d,et){var ft=et.dir||et.root,gt=et.base||(et.name||"")+(et.ext||"");return ft?ft===et.root?ft+gt:ft+d+gt:gt}var h={resolve:function(){for(var d="",et=!1,ft,gt=arguments.length-1;gt>=-1&&!et;gt--){var _t;gt>=0?_t=arguments[gt]:(ft===void 0&&(ft=i.cwd()),_t=ft),e(_t),_t.length!==0&&(d=_t+"/"+d,et=_t.charCodeAt(0)===47)}return d=a(d,!et),et?d.length>0?"/"+d:"/":d.length>0?d:"."},normalize:function(d){if(e(d),d.length===0)return".";var et=d.charCodeAt(0)===47,ft=d.charCodeAt(d.length-1)===47;return d=a(d,!et),d.length===0&&!et&&(d="."),d.length>0&&ft&&(d+="/"),et?"/"+d:d},isAbsolute:function(d){return e(d),d.length>0&&d.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var d,et=0;et<arguments.length;++et){var ft=arguments[et];e(ft),ft.length>0&&(d===void 0?d=ft:d+="/"+ft)}return d===void 0?".":h.normalize(d)},relative:function(d,et){if(e(d),e(et),d===et||(d=h.resolve(d),et=h.resolve(et),d===et))return"";for(var ft=1;ft<d.length&&d.charCodeAt(ft)===47;++ft);for(var gt=d.length,_t=gt-ft,wt=1;wt<et.length&&et.charCodeAt(wt)===47;++wt);for(var $t=et.length,It=$t-wt,Rt=_t<It?_t:It,Tt=-1,At=0;At<=Rt;++At){if(At===Rt){if(It>Rt){if(et.charCodeAt(wt+At)===47)return et.slice(wt+At+1);if(At===0)return et.slice(wt+At)}else _t>Rt&&(d.charCodeAt(ft+At)===47?Tt=At:At===0&&(Tt=0));break}var kt=d.charCodeAt(ft+At),xt=et.charCodeAt(wt+At);if(kt!==xt)break;kt===47&&(Tt=At)}var Nt="";for(At=ft+Tt+1;At<=gt;++At)(At===gt||d.charCodeAt(At)===47)&&(Nt.length===0?Nt+="..":Nt+="/..");return Nt.length>0?Nt+et.slice(wt+Tt):(wt+=Tt,et.charCodeAt(wt)===47&&++wt,et.slice(wt))},_makeLong:function(d){return d},dirname:function(d){if(e(d),d.length===0)return".";for(var et=d.charCodeAt(0),ft=et===47,gt=-1,_t=!0,wt=d.length-1;wt>=1;--wt)if(et=d.charCodeAt(wt),et===47){if(!_t){gt=wt;break}}else _t=!1;return gt===-1?ft?"/":".":ft&&gt===1?"//":d.slice(0,gt)},basename:function(d,et){if(et!==void 0&&typeof et!="string")throw new TypeError('"ext" argument must be a string');e(d);var ft=0,gt=-1,_t=!0,wt;if(et!==void 0&&et.length>0&&et.length<=d.length){if(et.length===d.length&&et===d)return"";var $t=et.length-1,It=-1;for(wt=d.length-1;wt>=0;--wt){var Rt=d.charCodeAt(wt);if(Rt===47){if(!_t){ft=wt+1;break}}else It===-1&&(_t=!1,It=wt+1),$t>=0&&(Rt===et.charCodeAt($t)?--$t===-1&&(gt=wt):($t=-1,gt=It))}return ft===gt?gt=It:gt===-1&&(gt=d.length),d.slice(ft,gt)}else{for(wt=d.length-1;wt>=0;--wt)if(d.charCodeAt(wt)===47){if(!_t){ft=wt+1;break}}else gt===-1&&(_t=!1,gt=wt+1);return gt===-1?"":d.slice(ft,gt)}},extname:function(d){e(d);for(var et=-1,ft=0,gt=-1,_t=!0,wt=0,$t=d.length-1;$t>=0;--$t){var It=d.charCodeAt($t);if(It===47){if(!_t){ft=$t+1;break}continue}gt===-1&&(_t=!1,gt=$t+1),It===46?et===-1?et=$t:wt!==1&&(wt=1):et!==-1&&(wt=-1)}return et===-1||gt===-1||wt===0||wt===1&&et===gt-1&&et===ft+1?"":d.slice(et,gt)},format:function(d){if(d===null||typeof d!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof d);return c("/",d)},parse:function(d){e(d);var et={root:"",dir:"",base:"",ext:"",name:""};if(d.length===0)return et;var ft=d.charCodeAt(0),gt=ft===47,_t;gt?(et.root="/",_t=1):_t=0;for(var wt=-1,$t=0,It=-1,Rt=!0,Tt=d.length-1,At=0;Tt>=_t;--Tt){if(ft=d.charCodeAt(Tt),ft===47){if(!Rt){$t=Tt+1;break}continue}It===-1&&(Rt=!1,It=Tt+1),ft===46?wt===-1?wt=Tt:At!==1&&(At=1):wt!==-1&&(At=-1)}return wt===-1||It===-1||At===0||At===1&&wt===It-1&&wt===$t+1?It!==-1&&($t===0&&gt?et.base=et.name=d.slice(1,It):et.base=et.name=d.slice($t,It)):($t===0&&gt?(et.name=d.slice(1,wt),et.base=d.slice(1,It)):(et.name=d.slice($t,wt),et.base=d.slice($t,It)),et.ext=d.slice(wt,It)),$t>0?et.dir=d.slice(0,$t-1):gt&&(et.dir="/"),et},sep:"/",delimiter:":",win32:null,posix:null};return h.posix=h,Za=h,Za}function CE(i){if(typeof i=="string")i=new URL(i);else if(!(i instanceof URL))throw new Deno.errors.InvalidData("invalid argument path , must be a string or URL");if(i.protocol!=="file:")throw new Deno.errors.InvalidData("invalid url scheme");return tl?BE(i):PE(i)}function BE(i){let e=i.hostname,a=i.pathname;for(let c=0;c<a.length;c++)if(a[c]==="%"){let h=a.codePointAt(c+2)||32;if(a[c+1]==="2"&&h===102||a[c+1]==="5"&&h===99)throw new Deno.errors.InvalidData("must not include encoded \\ or / characters")}if(a=a.replace(EE,"\\"),a=decodeURIComponent(a),e!=="")return`\\\\${e}${a}`;{let c=a.codePointAt(1)|32,h=a[2];if(c<mE||c>vE||h!==":")throw new Deno.errors.InvalidData("file url path must be absolute");return a.slice(1)}}function PE(i){if(i.hostname!=="")throw new Deno.errors.InvalidData("invalid file url hostname");let e=i.pathname;for(let a=0;a<e.length;a++)if(e[a]==="%"){let c=e.codePointAt(a+2)||32;if(e[a+1]==="2"&&c===102)throw new Deno.errors.InvalidData("must not include encoded / characters")}return decodeURIComponent(e)}function OE(i){let e=ug.resolve(i),a=i.charCodeAt(i.length-1);(a===_E||tl&&a===wE)&&e[e.length-1]!==ug.sep&&(e+="/");let c=new URL("file://");return e.includes("%")&&(e=e.replace(SE,"%25")),!tl&&e.includes("\\")&&(e=e.replace(AE,"%5C")),e.includes(`
`)&&(e=e.replace(IE,"%0A")),e.includes("\r")&&(e=e.replace(TE,"%0D")),e.includes("	")&&(e=e.replace(RE,"%09")),c.pathname=e,c}function fg(i){if(typeof i=="string")i=new URL(i);else if(!(i instanceof URL))throw new Deno.errors.InvalidData("invalid argument path , must be a string or URL");if(i.protocol!=="file:")throw new Deno.errors.InvalidData("invalid url scheme");return rl?QE(i):YE(i)}function QE(i){let e=i.hostname,a=i.pathname;for(let c=0;c<a.length;c++)if(a[c]==="%"){let h=a.codePointAt(c+2)||32;if(a[c+1]==="2"&&h===102||a[c+1]==="5"&&h===99)throw new Deno.errors.InvalidData("must not include encoded \\ or / characters")}if(a=a.replace($E,"\\"),a=decodeURIComponent(a),e!=="")return`\\\\${e}${a}`;{let c=a.codePointAt(1)|32,h=a[2];if(c<FE||c>WE||h!==":")throw new Deno.errors.InvalidData("file url path must be absolute");return a.slice(1)}}function YE(i){if(i.hostname!=="")throw new Deno.errors.InvalidData("invalid file url hostname");let e=i.pathname;for(let a=0;a<e.length;a++)if(e[a]==="%"){let c=e.codePointAt(a+2)||32;if(e[a+1]==="2"&&c===102)throw new Deno.errors.InvalidData("must not include encoded / characters")}return decodeURIComponent(e)}function cg(i){let e=Ya.resolve(i),a=i.charCodeAt(i.length-1);(a===jE||rl&&a===DE)&&e[e.length-1]!==Ya.sep&&(e+="/");let c=new URL("file://");return e.includes("%")&&(e=e.replace(HE,"%25")),!rl&&e.includes("\\")&&(e=e.replace(VE,"%5C")),e.includes(`
`)&&(e=e.replace(zE,"%0A")),e.includes("\r")&&(e=e.replace(KE,"%0D")),e.includes("	")&&(e=e.replace(GE,"%09")),c.pathname=e,c}var X,uE,pt,fE,cE,hE,dE,el,sg,og,ag,pE,gE,Ja,ni,Xa,Za,lg,ug,bE,wE,_E,mE,vE,tl,EE,SE,AE,IE,TE,RE,kE,xE,ME,LE,UE,NE,qE,DE,jE,FE,WE,rl,$E,HE,VE,zE,KE,GE,dg=be(()=>{v(),m(),_(),Qp(),Yp(),tg(),ng(),Ga(),X={},uE=zt,pt={isString:function(i){return typeof i=="string"},isObject:function(i){return typeof i=="object"&&i!==null},isNull:function(i){return i===null},isNullOrUndefined:function(i){return i==null}},X.parse=xi,X.resolve=function(i,e){return xi(i,!1,!0).resolve(e)},X.resolveObject=function(i,e){return i?xi(i,!1,!0).resolveObject(e):e},X.format=function(i){return pt.isString(i)&&(i=xi(i)),i instanceof Fe?i.format():Fe.prototype.format.call(i)},X.Url=Fe,fE=/^([a-z0-9.+-]+:)/i,cE=/:[0-9]*$/,hE=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,dE=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r",`
`,"	"]),el=["'"].concat(dE),sg=["%","/","?",";","#"].concat(el),og=["/","?","#"],ag=/^[+a-z0-9A-Z_-]{0,63}$/,pE=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,gE={javascript:!0,"javascript:":!0},Ja={javascript:!0,"javascript:":!0},ni={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},Xa=dt,Fe.prototype.parse=function(i,e,a){if(!pt.isString(i))throw new TypeError("Parameter 'url' must be a string, not "+typeof i);var c=i.indexOf("?"),h=c!==-1&&c<i.indexOf("#")?"?":"#",d=i.split(h);d[0]=d[0].replace(/\\/g,"/");var et=i=d.join(h);if(et=et.trim(),!a&&i.split("#").length===1){var ft=hE.exec(et);if(ft)return this.path=et,this.href=et,this.pathname=ft[1],ft[2]?(this.search=ft[2],this.query=e?Xa.parse(this.search.substr(1)):this.search.substr(1)):e&&(this.search="",this.query={}),this}var gt=fE.exec(et);if(gt){var _t=(gt=gt[0]).toLowerCase();this.protocol=_t,et=et.substr(gt.length)}if(a||gt||et.match(/^\/\/[^@\/]+@[^@\/]+/)){var wt=et.substr(0,2)==="//";!wt||gt&&Ja[gt]||(et=et.substr(2),this.slashes=!0)}if(!Ja[gt]&&(wt||gt&&!ni[gt])){for(var $t,It,Rt=-1,Tt=0;Tt<og.length;Tt++)(At=et.indexOf(og[Tt]))!==-1&&(Rt===-1||At<Rt)&&(Rt=At);for((It=Rt===-1?et.lastIndexOf("@"):et.lastIndexOf("@",Rt))!==-1&&($t=et.slice(0,It),et=et.slice(It+1),this.auth=decodeURIComponent($t)),Rt=-1,Tt=0;Tt<sg.length;Tt++){var At;(At=et.indexOf(sg[Tt]))!==-1&&(Rt===-1||At<Rt)&&(Rt=At)}Rt===-1&&(Rt=et.length),this.host=et.slice(0,Rt),et=et.slice(Rt),this.parseHost(),this.hostname=this.hostname||"";var kt=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!kt)for(var xt=this.hostname.split(/\./),Nt=(Tt=0,xt.length);Tt<Nt;Tt++){var Ft=xt[Tt];if(Ft&&!Ft.match(ag)){for(var jt="",Gt=0,Kt=Ft.length;Gt<Kt;Gt++)Ft.charCodeAt(Gt)>127?jt+="x":jt+=Ft[Gt];if(!jt.match(ag)){var Wt=xt.slice(0,Tt),Zt=xt.slice(Tt+1),cr=Ft.match(pE);cr&&(Wt.push(cr[1]),Zt.unshift(cr[2])),Zt.length&&(et="/"+Zt.join(".")+et),this.hostname=Wt.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),kt||(this.hostname=uE.toASCII(this.hostname));var hr=this.port?":"+this.port:"",gr=this.hostname||"";this.host=gr+hr,this.href+=this.host,kt&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),et[0]!=="/"&&(et="/"+et))}if(!gE[_t])for(Tt=0,Nt=el.length;Tt<Nt;Tt++){var er=el[Tt];if(et.indexOf(er)!==-1){var mr=encodeURIComponent(er);mr===er&&(mr=escape(er)),et=et.split(er).join(mr)}}var Mr=et.indexOf("#");Mr!==-1&&(this.hash=et.substr(Mr),et=et.slice(0,Mr));var wr=et.indexOf("?");if(wr!==-1?(this.search=et.substr(wr),this.query=et.substr(wr+1),e&&(this.query=Xa.parse(this.query)),et=et.slice(0,wr)):e&&(this.search="",this.query={}),et&&(this.pathname=et),ni[_t]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){hr=this.pathname||"";var Dr=this.search||"";this.path=hr+Dr}return this.href=this.format(),this},Fe.prototype.format=function(){var i=this.auth||"";i&&(i=(i=encodeURIComponent(i)).replace(/%3A/i,":"),i+="@");var e=this.protocol||"",a=this.pathname||"",c=this.hash||"",h=!1,d="";this.host?h=i+this.host:this.hostname&&(h=i+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(h+=":"+this.port)),this.query&&pt.isObject(this.query)&&Object.keys(this.query).length&&(d=Xa.stringify(this.query));var et=this.search||d&&"?"+d||"";return e&&e.substr(-1)!==":"&&(e+=":"),this.slashes||(!e||ni[e])&&h!==!1?(h="//"+(h||""),a&&a.charAt(0)!=="/"&&(a="/"+a)):h||(h=""),c&&c.charAt(0)!=="#"&&(c="#"+c),et&&et.charAt(0)!=="?"&&(et="?"+et),e+h+(a=a.replace(/[?#]/g,function(ft){return encodeURIComponent(ft)}))+(et=et.replace("#","%23"))+c},Fe.prototype.resolve=function(i){return this.resolveObject(xi(i,!1,!0)).format()},Fe.prototype.resolveObject=function(i){if(pt.isString(i)){var e=new Fe;e.parse(i,!1,!0),i=e}for(var a=new Fe,c=Object.keys(this),h=0;h<c.length;h++){var d=c[h];a[d]=this[d]}if(a.hash=i.hash,i.href==="")return a.href=a.format(),a;if(i.slashes&&!i.protocol){for(var et=Object.keys(i),ft=0;ft<et.length;ft++){var gt=et[ft];gt!=="protocol"&&(a[gt]=i[gt])}return ni[a.protocol]&&a.hostname&&!a.pathname&&(a.path=a.pathname="/"),a.href=a.format(),a}if(i.protocol&&i.protocol!==a.protocol){if(!ni[i.protocol]){for(var _t=Object.keys(i),wt=0;wt<_t.length;wt++){var $t=_t[wt];a[$t]=i[$t]}return a.href=a.format(),a}if(a.protocol=i.protocol,i.host||Ja[i.protocol])a.pathname=i.pathname;else{for(var It=(i.pathname||"").split("/");It.length&&!(i.host=It.shift()););i.host||(i.host=""),i.hostname||(i.hostname=""),It[0]!==""&&It.unshift(""),It.length<2&&It.unshift(""),a.pathname=It.join("/")}if(a.search=i.search,a.query=i.query,a.host=i.host||"",a.auth=i.auth,a.hostname=i.hostname||i.host,a.port=i.port,a.pathname||a.search){var Rt=a.pathname||"",Tt=a.search||"";a.path=Rt+Tt}return a.slashes=a.slashes||i.slashes,a.href=a.format(),a}var At=a.pathname&&a.pathname.charAt(0)==="/",kt=i.host||i.pathname&&i.pathname.charAt(0)==="/",xt=kt||At||a.host&&i.pathname,Nt=xt,Ft=a.pathname&&a.pathname.split("/")||[],jt=(It=i.pathname&&i.pathname.split("/")||[],a.protocol&&!ni[a.protocol]);if(jt&&(a.hostname="",a.port=null,a.host&&(Ft[0]===""?Ft[0]=a.host:Ft.unshift(a.host)),a.host="",i.protocol&&(i.hostname=null,i.port=null,i.host&&(It[0]===""?It[0]=i.host:It.unshift(i.host)),i.host=null),xt=xt&&(It[0]===""||Ft[0]==="")),kt)a.host=i.host||i.host===""?i.host:a.host,a.hostname=i.hostname||i.hostname===""?i.hostname:a.hostname,a.search=i.search,a.query=i.query,Ft=It;else if(It.length)Ft||(Ft=[]),Ft.pop(),Ft=Ft.concat(It),a.search=i.search,a.query=i.query;else if(!pt.isNullOrUndefined(i.search))return jt&&(a.hostname=a.host=Ft.shift(),(cr=!!(a.host&&a.host.indexOf("@")>0)&&a.host.split("@"))&&(a.auth=cr.shift(),a.host=a.hostname=cr.shift())),a.search=i.search,a.query=i.query,pt.isNull(a.pathname)&&pt.isNull(a.search)||(a.path=(a.pathname?a.pathname:"")+(a.search?a.search:"")),a.href=a.format(),a;if(!Ft.length)return a.pathname=null,a.search?a.path="/"+a.search:a.path=null,a.href=a.format(),a;for(var Gt=Ft.slice(-1)[0],Kt=(a.host||i.host||Ft.length>1)&&(Gt==="."||Gt==="..")||Gt==="",Wt=0,Zt=Ft.length;Zt>=0;Zt--)(Gt=Ft[Zt])==="."?Ft.splice(Zt,1):Gt===".."?(Ft.splice(Zt,1),Wt++):Wt&&(Ft.splice(Zt,1),Wt--);if(!xt&&!Nt)for(;Wt--;Wt)Ft.unshift("..");!xt||Ft[0]===""||Ft[0]&&Ft[0].charAt(0)==="/"||Ft.unshift(""),Kt&&Ft.join("/").substr(-1)!=="/"&&Ft.push("");var cr,hr=Ft[0]===""||Ft[0]&&Ft[0].charAt(0)==="/";return jt&&(a.hostname=a.host=hr?"":Ft.length?Ft.shift():"",(cr=!!(a.host&&a.host.indexOf("@")>0)&&a.host.split("@"))&&(a.auth=cr.shift(),a.host=a.hostname=cr.shift())),(xt=xt||a.host&&Ft.length)&&!hr&&Ft.unshift(""),Ft.length?a.pathname=Ft.join("/"):(a.pathname=null,a.path=null),pt.isNull(a.pathname)&&pt.isNull(a.search)||(a.path=(a.pathname?a.pathname:"")+(a.search?a.search:"")),a.auth=i.auth||a.auth,a.slashes=a.slashes||i.slashes,a.href=a.format(),a},Fe.prototype.parseHost=function(){var i=this.host,e=cE.exec(i);e&&((e=e[0])!==":"&&(this.port=e.substr(1)),i=i.substr(0,i.length-e.length)),i&&(this.hostname=i)},X.Url,X.format,X.resolve,X.resolveObject,Za={},lg=!1,ug=yE(),bE=typeof Deno<"u"?Deno.build.os==="windows"?"win32":Deno.build.os:void 0,X.URL=typeof URL<"u"?URL:null,X.pathToFileURL=OE,X.fileURLToPath=CE,X.Url,X.format,X.resolve,X.resolveObject,X.URL,wE=92,_E=47,mE=97,vE=122,tl=bE==="win32",EE=/\//g,SE=/%/g,AE=/\\/g,IE=/\n/g,TE=/\r/g,RE=/\t/g,kE=typeof Deno<"u"?Deno.build.os==="windows"?"win32":Deno.build.os:void 0,X.URL=typeof URL<"u"?URL:null,X.pathToFileURL=cg,X.fileURLToPath=fg,xE=X.Url,ME=X.format,LE=X.resolve,UE=X.resolveObject,NE=X.parse,qE=X.URL,DE=92,jE=47,FE=97,WE=122,rl=kE==="win32",$E=/\//g,HE=/%/g,VE=/\\/g,zE=/\n/g,KE=/\r/g,GE=/\t/g}),il={};Qt(il,{Server:()=>Me,Socket:()=>Me,Stream:()=>Me,_createServerHandle:()=>Me,_normalizeArgs:()=>Me,_setSimultaneousAccepts:()=>Me,connect:()=>Me,createConnection:()=>Me,createServer:()=>Me,default:()=>JE,isIP:()=>Me,isIPv4:()=>Me,isIPv6:()=>Me});function Me(){throw new Error("Node.js net module is not supported by JSPM core outside of Node.js")}var JE,nl=be(()=>{v(),m(),_(),JE={_createServerHandle:Me,_normalizeArgs:Me,_setSimultaneousAccepts:Me,connect:Me,createConnection:Me,createServer:Me,isIP:Me,isIPv4:Me,isIPv6:Me,Server:Me,Socket:Me,Stream:Me}}),sl=M(i=>{v(),m(),_();var e=i&&i.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(i,"__esModule",{value:!0});var a=e((nl(),Z(il))),c=e(ot()),h=(0,c.default)("mqttjs:tcp"),d=(et,ft)=>{ft.port=ft.port||1883,ft.hostname=ft.hostname||ft.host||"localhost";let{port:gt}=ft,_t=ft.hostname;return h("port %d and host %s",gt,_t),a.default.createConnection(gt,_t)};i.default=d}),gg={};Qt(gg,{default:()=>rS});var rS,yg=be(()=>{v(),m(),_(),rS={}}),al=M(i=>{v(),m(),_();var e=i&&i.__importDefault||function(ft){return ft&&ft.__esModule?ft:{default:ft}};Object.defineProperty(i,"__esModule",{value:!0});var a=e((yg(),Z(gg))),c=e((nl(),Z(il))),h=e(ot()),d=(0,h.default)("mqttjs:tls"),et=(ft,gt)=>{gt.port=gt.port||8883,gt.host=gt.hostname||gt.host||"localhost",c.default.isIP(gt.host)===0&&(gt.servername=gt.host),gt.rejectUnauthorized=gt.rejectUnauthorized!==!1,delete gt.path,d("port %d host %s rejectUnauthorized %b",gt.port,gt.host,gt.rejectUnauthorized);let _t=a.default.connect(gt);_t.on("secureConnect",()=>{gt.rejectUnauthorized&&!_t.authorized?_t.emit("error",new Error("TLS not authorized")):_t.removeListener("error",wt)});function wt($t){gt.rejectUnauthorized&&ft.emit("error",$t),_t.end()}return _t.on("error",wt),_t};i.default=et}),os=M(i=>{v(),m(),_(),Object.defineProperty(i,"__esModule",{value:!0}),i.BufferedDuplex=i.writev=void 0;var e=Dt();function a(h,d){let et=new Array(h.length);for(let ft=0;ft<h.length;ft++)typeof h[ft].chunk=="string"?et[ft]=k.from(h[ft].chunk,"utf8"):et[ft]=h[ft].chunk;this._write(k.concat(et),"binary",d)}i.writev=a;var c=class extends e.Duplex{constructor(h,d,et){super({objectMode:!0}),this.proxy=d,this.socket=et,this.writeQueue=[],h.objectMode||(this._writev=a.bind(this)),this.isSocketOpen=!1,this.proxy.on("data",ft=>{this.push(ft)})}_read(h){this.proxy.read(h)}_write(h,d,et){this.isSocketOpen?this.writeToProxy(h,d,et):this.writeQueue.push({chunk:h,encoding:d,cb:et})}_final(h){this.writeQueue=[],this.proxy.end(h)}_destroy(h,d){this.writeQueue=[],this.proxy.destroy(h),d(h)}socketReady(){this.emit("connect"),this.isSocketOpen=!0,this.processWriteQueue()}writeToProxy(h,d,et){this.proxy.write(h,d)===!1?this.proxy.once("drain",et):et()}processWriteQueue(){for(;this.writeQueue.length>0;){let{chunk:h,encoding:d,cb:et}=this.writeQueue.shift();this.writeToProxy(h,d,et)}}};i.BufferedDuplex=c}),cl=M(i=>{v(),m(),_(),Object.defineProperty(i,"__esModule",{value:!0});var e=(we(),Z(ve)),a=Dt(),c=os(),h,d,et;function ft(){let It=new a.Transform;return It._write=(Rt,Tt,At)=>{h.send({data:Rt.buffer,success(){At()},fail(kt){At(new Error(kt))}})},It._flush=Rt=>{h.close({success(){Rt()}})},It}function gt(It){It.hostname||(It.hostname="localhost"),It.path||(It.path="/"),It.wsOptions||(It.wsOptions={})}function _t(It,Rt){let Tt=It.protocol==="wxs"?"wss":"ws",At=`${Tt}://${It.hostname}${It.path}`;return It.port&&It.port!==80&&It.port!==443&&(At=`${Tt}://${It.hostname}:${It.port}${It.path}`),typeof It.transformWsUrl=="function"&&(At=It.transformWsUrl(At,It,Rt)),At}function wt(){h.onOpen(()=>{et.socketReady()}),h.onMessage(It=>{let{data:Rt}=It;Rt instanceof ArrayBuffer?Rt=e.Buffer.from(Rt):Rt=e.Buffer.from(Rt,"utf8"),d.push(Rt)}),h.onClose(()=>{et.emit("close"),et.end(),et.destroy()}),h.onError(It=>{let Rt=new Error(It.errMsg);et.destroy(Rt)})}var $t=(It,Rt)=>{if(Rt.hostname=Rt.hostname||Rt.host,!Rt.hostname)throw new Error("Could not determine host. Specify host manually.");let Tt=Rt.protocolId==="MQIsdp"&&Rt.protocolVersion===3?"mqttv3.1":"mqtt";gt(Rt);let At=_t(Rt,It);h=wx.connectSocket({url:At,protocols:[Tt]}),d=ft(),et=new c.BufferedDuplex(Rt,d,h),et._destroy=(xt,Nt)=>{h.close({success(){Nt&&Nt(xt)}})};let kt=et.destroy;return et.destroy=(xt,Nt)=>(et.destroy=kt,setTimeout(()=>{h.close({fail(){et._destroy(xt,Nt)}})},0),et),wt(),et};i.default=$t}),pl=M(i=>{v(),m(),_(),Object.defineProperty(i,"__esModule",{value:!0});var e=(we(),Z(ve)),a=Dt(),c=os(),h,d,et,ft=!1;function gt(){let Rt=new a.Transform;return Rt._write=(Tt,At,kt)=>{h.sendSocketMessage({data:Tt.buffer,success(){kt()},fail(){kt(new Error)}})},Rt._flush=Tt=>{h.closeSocket({success(){Tt()}})},Rt}function _t(Rt){Rt.hostname||(Rt.hostname="localhost"),Rt.path||(Rt.path="/"),Rt.wsOptions||(Rt.wsOptions={})}function wt(Rt,Tt){let At=Rt.protocol==="alis"?"wss":"ws",kt=`${At}://${Rt.hostname}${Rt.path}`;return Rt.port&&Rt.port!==80&&Rt.port!==443&&(kt=`${At}://${Rt.hostname}:${Rt.port}${Rt.path}`),typeof Rt.transformWsUrl=="function"&&(kt=Rt.transformWsUrl(kt,Rt,Tt)),kt}function $t(){ft||(ft=!0,h.onSocketOpen(()=>{et.socketReady()}),h.onSocketMessage(Rt=>{if(typeof Rt.data=="string"){let Tt=e.Buffer.from(Rt.data,"base64");d.push(Tt)}else{let Tt=new FileReader;Tt.addEventListener("load",()=>{let At=Tt.result;At instanceof ArrayBuffer?At=e.Buffer.from(At):At=e.Buffer.from(At,"utf8"),d.push(At)}),Tt.readAsArrayBuffer(Rt.data)}}),h.onSocketClose(()=>{et.end(),et.destroy()}),h.onSocketError(Rt=>{et.destroy(Rt)}))}var It=(Rt,Tt)=>{if(Tt.hostname=Tt.hostname||Tt.host,!Tt.hostname)throw new Error("Could not determine host. Specify host manually.");let At=Tt.protocolId==="MQIsdp"&&Tt.protocolVersion===3?"mqttv3.1":"mqtt";_t(Tt);let kt=wt(Tt,Rt);return h=Tt.my,h.connectSocket({url:kt,protocols:At}),d=gt(),et=new c.BufferedDuplex(Tt,d,h),$t(),et};i.default=It}),vg=M((i,e)=>{v(),m(),_(),e.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}}),wl=M(i=>{v(),m(),_();var e=i&&i.__importDefault||function(xt){return xt&&xt.__esModule?xt:{default:xt}};Object.defineProperty(i,"__esModule",{value:!0});var a=(we(),Z(ve)),c=e(vg()),h=e(ot()),d=Dt(),et=e(Pi()),ft=os(),gt=(0,h.default)("mqttjs:ws"),_t=["rejectUnauthorized","ca","cert","key","pfx","passphrase"];function wt(xt,Nt){let Ft=`${xt.protocol}://${xt.hostname}:${xt.port}${xt.path}`;return typeof xt.transformWsUrl=="function"&&(Ft=xt.transformWsUrl(Ft,xt,Nt)),Ft}function $t(xt){let Nt=xt;return xt.hostname||(Nt.hostname="localhost"),xt.port||(xt.protocol==="wss"?Nt.port=443:Nt.port=80),xt.path||(Nt.path="/"),xt.wsOptions||(Nt.wsOptions={}),!et.default&&xt.protocol==="wss"&&_t.forEach(Ft=>{Object.prototype.hasOwnProperty.call(xt,Ft)&&!Object.prototype.hasOwnProperty.call(xt.wsOptions,Ft)&&(Nt.wsOptions[Ft]=xt[Ft])}),Nt}function It(xt){let Nt=$t(xt);if(Nt.hostname||(Nt.hostname=Nt.host),!Nt.hostname){if(typeof document>"u")throw new Error("Could not determine host. Specify host manually.");let Ft=new URL(document.URL);Nt.hostname=Ft.hostname,Nt.port||(Nt.port=Number(Ft.port))}return Nt.objectMode===void 0&&(Nt.objectMode=!(Nt.binary===!0||Nt.binary===void 0)),Nt}function Rt(xt,Nt,Ft){gt("createWebSocket"),gt(`protocol: ${Ft.protocolId} ${Ft.protocolVersion}`);let jt=Ft.protocolId==="MQIsdp"&&Ft.protocolVersion===3?"mqttv3.1":"mqtt";gt(`creating new Websocket for url: ${Nt} and protocol: ${jt}`);let Gt;return Ft.createWebsocket?Gt=Ft.createWebsocket(Nt,[jt],Ft):Gt=new c.default(Nt,[jt],Ft.wsOptions),Gt}function Tt(xt,Nt){let Ft=Nt.protocolId==="MQIsdp"&&Nt.protocolVersion===3?"mqttv3.1":"mqtt",jt=wt(Nt,xt),Gt;return Nt.createWebsocket?Gt=Nt.createWebsocket(jt,[Ft],Nt):Gt=new WebSocket(jt,[Ft]),Gt.binaryType="arraybuffer",Gt}var At=(xt,Nt)=>{gt("streamBuilder");let Ft=$t(Nt),jt=wt(Ft,xt),Gt=Rt(xt,jt,Ft),Kt=c.default.createWebSocketStream(Gt,Ft.wsOptions);return Kt.url=jt,Gt.on("close",()=>{Kt.destroy()}),Kt},kt=(xt,Nt)=>{gt("browserStreamBuilder");let Ft,jt=It(Nt).browserBufferSize||1024*512,Gt=Nt.browserBufferTimeout||1e3,Kt=!Nt.objectMode,Wt=Tt(xt,Nt),Zt=hr(Nt,wr,Dr);Nt.objectMode||(Zt._writev=ft.writev.bind(Zt)),Zt.on("close",()=>{Wt.close()});let cr=typeof Wt.addEventListener<"u";Wt.readyState===Wt.OPEN?(Ft=Zt,Ft.socket=Wt):(Ft=new ft.BufferedDuplex(Nt,Zt,Wt),cr?Wt.addEventListener("open",gr):Wt.onopen=gr),cr?(Wt.addEventListener("close",er),Wt.addEventListener("error",mr),Wt.addEventListener("message",Mr)):(Wt.onclose=er,Wt.onerror=mr,Wt.onmessage=Mr);function hr(Tr,fr,yr){let $r=new d.Transform({objectMode:Tr.objectMode});return $r._write=fr,$r._flush=yr,$r}function gr(){gt("WebSocket onOpen"),Ft instanceof ft.BufferedDuplex&&Ft.socketReady()}function er(Tr){gt("WebSocket onClose",Tr),Ft.end(),Ft.destroy()}function mr(Tr){gt("WebSocket onError",Tr);let fr=new Error("WebSocket error");fr.event=Tr,Ft.destroy(fr)}function Mr(Tr){let{data:fr}=Tr;fr instanceof ArrayBuffer?fr=a.Buffer.from(fr):fr=a.Buffer.from(fr,"utf8"),Zt.push(fr)}function wr(Tr,fr,yr){if(Wt.bufferedAmount>jt){setTimeout(wr,Gt,Tr,fr,yr);return}Kt&&typeof Tr=="string"&&(Tr=a.Buffer.from(Tr,"utf8"));try{Wt.send(Tr)}catch($r){return yr($r)}yr()}function Dr(Tr){Wt.close(),Tr()}return Ft};i.default=et.default?kt:At}),Cg=M(i=>{v(),m(),_();var e=i&&i.__importDefault||function($t){return $t&&$t.__esModule?$t:{default:$t}};Object.defineProperty(i,"__esModule",{value:!0}),i.connectAsync=void 0;var a=e(ot()),c=e((dg(),Z(hg))),h=e(ns()),d=e(Pi()),et=(0,a.default)("mqttjs"),ft={};d.default?(ft.wx=cl().default,ft.wxs=cl().default,ft.ali=pl().default,ft.alis=pl().default):(ft.mqtt=sl().default,ft.tcp=sl().default,ft.ssl=al().default,ft.tls=ft.ssl,ft.mqtts=al().default),ft.ws=wl().default,ft.wss=wl().default;function gt($t){let It;$t.auth&&(It=$t.auth.match(/^(.+):(.+)$/),It?($t.username=It[1],$t.password=It[2]):$t.username=$t.auth)}function _t($t,It){if(et("connecting to an MQTT broker..."),typeof $t=="object"&&!It&&(It=$t,$t=""),It=It||{},$t&&typeof $t=="string"){let At=c.default.parse($t,!0);if(At.port!=null&&(At.port=Number(At.port)),It=Object.assign(Object.assign({},At),It),It.protocol===null)throw new Error("Missing protocol");It.protocol=It.protocol.replace(/:$/,"")}if(gt(It),It.query&&typeof It.query.clientId=="string"&&(It.clientId=It.query.clientId),It.cert&&It.key)if(It.protocol){if(["mqtts","wss","wxs","alis"].indexOf(It.protocol)===-1)switch(It.protocol){case"mqtt":It.protocol="mqtts";break;case"ws":It.protocol="wss";break;case"wx":It.protocol="wxs";break;case"ali":It.protocol="alis";break;default:throw new Error(`Unknown protocol for secure connection: "${It.protocol}"!`)}}else throw new Error("Missing secure protocol key");if(!ft[It.protocol]){let At=["mqtts","wss"].indexOf(It.protocol)!==-1;It.protocol=["mqtt","mqtts","ws","wss","wx","wxs","ali","alis"].filter((kt,xt)=>At&&xt%2===0?!1:typeof ft[kt]=="function")[0]}if(It.clean===!1&&!It.clientId)throw new Error("Missing clientId for unclean clients");It.protocol&&(It.defaultProtocol=It.protocol);function Rt(At){return It.servers&&((!At._reconnectCount||At._reconnectCount===It.servers.length)&&(At._reconnectCount=0),It.host=It.servers[At._reconnectCount].host,It.port=It.servers[At._reconnectCount].port,It.protocol=It.servers[At._reconnectCount].protocol?It.servers[At._reconnectCount].protocol:It.defaultProtocol,It.hostname=It.host,At._reconnectCount++),et("calling streambuilder for",It.protocol),ft[It.protocol](At,It)}let Tt=new h.default(Rt,It);return Tt.on("error",()=>{}),Tt}function wt($t,It,Rt=!0){return new Promise((Tt,At)=>{let kt=_t($t,It),xt={connect:Ft=>{Nt(),Tt(kt)},end:()=>{Nt(),Tt(kt)},error:Ft=>{Nt(),kt.end(),At(Ft)}};Rt===!1&&(xt.close=()=>{xt.error(new Error("Couldn't connect to server"))});function Nt(){Object.keys(xt).forEach(Ft=>{kt.off(Ft,xt[Ft])})}Object.keys(xt).forEach(Ft=>{kt.on(Ft,xt[Ft])})})}i.connectAsync=wt,i.default=_t}),_l=M(i=>{v(),m(),_();var e=i&&i.__createBinding||(Object.create?function(Rt,Tt,At,kt){kt===void 0&&(kt=At);var xt=Object.getOwnPropertyDescriptor(Tt,At);(!xt||("get"in xt?!Tt.__esModule:xt.writable||xt.configurable))&&(xt={enumerable:!0,get:function(){return Tt[At]}}),Object.defineProperty(Rt,kt,xt)}:function(Rt,Tt,At,kt){kt===void 0&&(kt=At),Rt[kt]=Tt[At]}),a=i&&i.__setModuleDefault||(Object.create?function(Rt,Tt){Object.defineProperty(Rt,"default",{enumerable:!0,value:Tt})}:function(Rt,Tt){Rt.default=Tt}),c=i&&i.__importStar||function(Rt){if(Rt&&Rt.__esModule)return Rt;var Tt={};if(Rt!=null)for(var At in Rt)At!=="default"&&Object.prototype.hasOwnProperty.call(Rt,At)&&e(Tt,Rt,At);return a(Tt,Rt),Tt},h=i&&i.__exportStar||function(Rt,Tt){for(var At in Rt)At!=="default"&&!Object.prototype.hasOwnProperty.call(Tt,At)&&e(Tt,Rt,At)},d=i&&i.__importDefault||function(Rt){return Rt&&Rt.__esModule?Rt:{default:Rt}};Object.defineProperty(i,"__esModule",{value:!0}),i.ReasonCodes=i.PingTimer=i.UniqueMessageIdProvider=i.DefaultMessageIdProvider=i.Store=i.MqttClient=i.connectAsync=i.connect=i.Client=void 0;var et=d(ns());i.MqttClient=et.default;var ft=d(Yo());i.DefaultMessageIdProvider=ft.default;var gt=d(Wp());i.UniqueMessageIdProvider=gt.default;var _t=d(Zo());i.Store=_t.default;var wt=c(Cg());i.connect=wt.default,Object.defineProperty(i,"connectAsync",{enumerable:!0,get:function(){return wt.connectAsync}});var $t=d(qa());i.PingTimer=$t.default,i.Client=et.default,h(ns(),i),h(Yr(),i);var It=Si();Object.defineProperty(i,"ReasonCodes",{enumerable:!0,get:function(){return It.ReasonCodes}})}),GS=M(i=>{v(),m(),_();var e=i&&i.__createBinding||(Object.create?function(et,ft,gt,_t){_t===void 0&&(_t=gt);var wt=Object.getOwnPropertyDescriptor(ft,gt);(!wt||("get"in wt?!ft.__esModule:wt.writable||wt.configurable))&&(wt={enumerable:!0,get:function(){return ft[gt]}}),Object.defineProperty(et,_t,wt)}:function(et,ft,gt,_t){_t===void 0&&(_t=gt),et[_t]=ft[gt]}),a=i&&i.__setModuleDefault||(Object.create?function(et,ft){Object.defineProperty(et,"default",{enumerable:!0,value:ft})}:function(et,ft){et.default=ft}),c=i&&i.__importStar||function(et){if(et&&et.__esModule)return et;var ft={};if(et!=null)for(var gt in et)gt!=="default"&&Object.prototype.hasOwnProperty.call(et,gt)&&e(ft,et,gt);return a(ft,et),ft},h=i&&i.__exportStar||function(et,ft){for(var gt in et)gt!=="default"&&!Object.prototype.hasOwnProperty.call(ft,gt)&&e(ft,et,gt)};Object.defineProperty(i,"__esModule",{value:!0});var d=c(_l());i.default=d,h(_l(),i)});const mqtt=GS();/*! Bundled license information:

@jspm/core/nodelibs/browser/buffer.js:
  (*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> *)
*/const occupiedRooms$2={},defaultRedundancy=2,defaultRelayUrls=["wss://test.mosquitto.org:8081","wss://mqtt.eclipseprojects.io/mqtt","wss://broker.emqx.io:8084/mqtt","wss://broker.hivemq.com:8884/mqtt","wss://public.mqtthq.com:8084/mqtt"],joinRoom$3=initGuard(occupiedRooms$2,(i,e)=>{const a=i.password&&genKey(i.password,e),c=`${libName.toLowerCase()}/${i.appId}/${e}`,h=`${c}/${selfId}`,d={},et={},ft={},gt=getRelays(i,defaultRelayUrls,defaultRedundancy),_t=(Rt,Tt)=>{$t(Rt,Tt),ft[Tt]=Rt},wt=Rt=>{delete d[Rt],delete et[Rt],delete ft[Rt]};let $t=noOp,It=[];return gt.forEach(Rt=>{const Tt=mqtt.connect(Rt);Tt.stream.socket,It.push(Tt),Tt.on("connect",()=>{Tt.subscribe(c),Tt.subscribe(h),Tt.publish(c,selfId)}),Tt.on("message",async(At,kt)=>{const xt=kt.toString();if(At===c){const Nt=xt;if(Nt!==selfId&&!ft[Nt]&&!et[Nt]){et[Nt]=!0;const Ft=d[Nt]=initPeer(!0,!1,i.rtcConfig);Ft.once(events$1.signal,async jt=>Tt.publish(`${c}/${Nt}`,JSON.stringify({peerId:selfId,offer:a?{...jt,sdp:await encrypt$2(a,jt.sdp)}:jt}))),Ft.once(events$1.connect,()=>_t(Ft,Nt)),Ft.once(events$1.close,()=>wt(Nt))}}else if(At===h){const{peerId:Nt,offer:Ft,answer:jt}=JSON.parse(xt);if(d[Nt]&&jt){d[Nt].signal(a?{...jt,sdp:await decrypt$2(a,jt.sdp)}:jt);return}if(!Ft)return;const Gt=initPeer(!1,!1,i.rtcConfig);Gt.once(events$1.signal,async Kt=>Tt.publish(`${c}/${Nt}`,JSON.stringify({peerId:selfId,answer:a?{...Kt,sdp:await encrypt$2(a,Kt.sdp)}:Kt}))),Gt.once(events$1.connect,()=>_t(Gt,Nt)),Gt.once(events$1.close,()=>wt(Nt)),Gt.signal(a?{...Ft,sdp:await decrypt$2(a,Ft.sdp)}:Ft)}})}),room(Rt=>$t=Rt,()=>{delete occupiedRooms$2[e],It.forEach(Rt=>Rt.end())})}),symbol$4=Symbol.for("@libp2p/peer-id");function isPeerId(i){return i!=null&&!!i[symbol$4]}let CodeError$4=class extends Error{constructor(a,c,h){super(a);qt(this,"code");qt(this,"props");this.code=c,this.name=(h==null?void 0:h.name)??"CodeError",this.props=h??{}}},AggregateCodeError$1=class extends AggregateError{constructor(a,c,h,d){super(a,c);qt(this,"code");qt(this,"props");this.code=h,this.name=(d==null?void 0:d.name)??"AggregateCodeError",this.props=d??{}}};function equals$7(i,e){if(i===e)return!0;if(i.byteLength!==e.byteLength)return!1;for(let a=0;a<i.byteLength;a++)if(i[a]!==e[a])return!1;return!0}function coerce$7(i){if(i instanceof Uint8Array&&i.constructor.name==="Uint8Array")return i;if(i instanceof ArrayBuffer)return new Uint8Array(i);if(ArrayBuffer.isView(i))return new Uint8Array(i.buffer,i.byteOffset,i.byteLength);throw new Error("Unknown type, must be binary type")}function fromString$c(i){return new TextEncoder().encode(i)}function toString$h(i){return new TextDecoder().decode(i)}function base$8(i,e){if(i.length>=255)throw new TypeError("Alphabet too long");for(var a=new Uint8Array(256),c=0;c<a.length;c++)a[c]=255;for(var h=0;h<i.length;h++){var d=i.charAt(h),et=d.charCodeAt(0);if(a[et]!==255)throw new TypeError(d+" is ambiguous");a[et]=h}var ft=i.length,gt=i.charAt(0),_t=Math.log(ft)/Math.log(256),wt=Math.log(256)/Math.log(ft);function $t(Tt){if(Tt instanceof Uint8Array||(ArrayBuffer.isView(Tt)?Tt=new Uint8Array(Tt.buffer,Tt.byteOffset,Tt.byteLength):Array.isArray(Tt)&&(Tt=Uint8Array.from(Tt))),!(Tt instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(Tt.length===0)return"";for(var At=0,kt=0,xt=0,Nt=Tt.length;xt!==Nt&&Tt[xt]===0;)xt++,At++;for(var Ft=(Nt-xt)*wt+1>>>0,jt=new Uint8Array(Ft);xt!==Nt;){for(var Gt=Tt[xt],Kt=0,Wt=Ft-1;(Gt!==0||Kt<kt)&&Wt!==-1;Wt--,Kt++)Gt+=256*jt[Wt]>>>0,jt[Wt]=Gt%ft>>>0,Gt=Gt/ft>>>0;if(Gt!==0)throw new Error("Non-zero carry");kt=Kt,xt++}for(var Zt=Ft-kt;Zt!==Ft&&jt[Zt]===0;)Zt++;for(var cr=gt.repeat(At);Zt<Ft;++Zt)cr+=i.charAt(jt[Zt]);return cr}function It(Tt){if(typeof Tt!="string")throw new TypeError("Expected String");if(Tt.length===0)return new Uint8Array;var At=0;if(Tt[At]!==" "){for(var kt=0,xt=0;Tt[At]===gt;)kt++,At++;for(var Nt=(Tt.length-At)*_t+1>>>0,Ft=new Uint8Array(Nt);Tt[At];){var jt=a[Tt.charCodeAt(At)];if(jt===255)return;for(var Gt=0,Kt=Nt-1;(jt!==0||Gt<xt)&&Kt!==-1;Kt--,Gt++)jt+=ft*Ft[Kt]>>>0,Ft[Kt]=jt%256>>>0,jt=jt/256>>>0;if(jt!==0)throw new Error("Non-zero carry");xt=Gt,At++}if(Tt[At]!==" "){for(var Wt=Nt-xt;Wt!==Nt&&Ft[Wt]===0;)Wt++;for(var Zt=new Uint8Array(kt+(Nt-Wt)),cr=kt;Wt!==Nt;)Zt[cr++]=Ft[Wt++];return Zt}}}function Rt(Tt){var At=It(Tt);if(At)return At;throw new Error(`Non-${e} character`)}return{encode:$t,decodeUnsafe:It,decode:Rt}}var src$7=base$8,_brrp__multiformats_scope_baseX$7=src$7;let Encoder$9=class{constructor(e,a,c){qt(this,"name");qt(this,"prefix");qt(this,"baseEncode");this.name=e,this.prefix=a,this.baseEncode=c}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Decoder$9=class{constructor(e,a,c){qt(this,"name");qt(this,"prefix");qt(this,"baseDecode");qt(this,"prefixCodePoint");if(this.name=e,this.prefix=a,a.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=a.codePointAt(0),this.baseDecode=c}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return or$9(this,e)}},ComposedDecoder$7=class{constructor(e){qt(this,"decoders");this.decoders=e}or(e){return or$9(this,e)}decode(e){const a=e[0],c=this.decoders[a];if(c!=null)return c.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function or$9(i,e){return new ComposedDecoder$7({...i.decoders??{[i.prefix]:i},...e.decoders??{[e.prefix]:e}})}let Codec$7=class{constructor(e,a,c,h){qt(this,"name");qt(this,"prefix");qt(this,"baseEncode");qt(this,"baseDecode");qt(this,"encoder");qt(this,"decoder");this.name=e,this.prefix=a,this.baseEncode=c,this.baseDecode=h,this.encoder=new Encoder$9(e,a,c),this.decoder=new Decoder$9(e,a,h)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function from$a({name:i,prefix:e,encode:a,decode:c}){return new Codec$7(i,e,a,c)}function baseX$7({name:i,prefix:e,alphabet:a}){const{encode:c,decode:h}=_brrp__multiformats_scope_baseX$7(a,i);return from$a({prefix:e,name:i,encode:c,decode:d=>coerce$7(h(d))})}function decode$s(i,e,a,c){const h={};for(let wt=0;wt<e.length;++wt)h[e[wt]]=wt;let d=i.length;for(;i[d-1]==="=";)--d;const et=new Uint8Array(d*a/8|0);let ft=0,gt=0,_t=0;for(let wt=0;wt<d;++wt){const $t=h[i[wt]];if($t===void 0)throw new SyntaxError(`Non-${c} character`);gt=gt<<a|$t,ft+=a,ft>=8&&(ft-=8,et[_t++]=255&gt>>ft)}if(ft>=a||255&gt<<8-ft)throw new SyntaxError("Unexpected end of data");return et}function encode$r(i,e,a){const c=e[e.length-1]==="=",h=(1<<a)-1;let d="",et=0,ft=0;for(let gt=0;gt<i.length;++gt)for(ft=ft<<8|i[gt],et+=8;et>a;)et-=a,d+=e[h&ft>>et];if(et!==0&&(d+=e[h&ft<<a-et]),c)for(;d.length*a&7;)d+="=";return d}function rfc4648$7({name:i,prefix:e,bitsPerChar:a,alphabet:c}){return from$a({prefix:e,name:i,encode(h){return encode$r(h,c,a)},decode(h){return decode$s(h,c,a,i)}})}const base58btc$7=baseX$7({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),base58flickr$6=baseX$7({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),base58$6=Object.freeze(Object.defineProperty({__proto__:null,base58btc:base58btc$7,base58flickr:base58flickr$6},Symbol.toStringTag,{value:"Module"})),base32$e=rfc4648$7({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),base32upper$6=rfc4648$7({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),base32pad$6=rfc4648$7({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),base32padupper$6=rfc4648$7({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),base32hex$6=rfc4648$7({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),base32hexupper$6=rfc4648$7({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),base32hexpad$6=rfc4648$7({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),base32hexpadupper$6=rfc4648$7({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),base32z$6=rfc4648$7({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),base32$f=Object.freeze(Object.defineProperty({__proto__:null,base32:base32$e,base32hex:base32hex$6,base32hexpad:base32hexpad$6,base32hexpadupper:base32hexpadupper$6,base32hexupper:base32hexupper$6,base32pad:base32pad$6,base32padupper:base32padupper$6,base32upper:base32upper$6,base32z:base32z$6},Symbol.toStringTag,{value:"Module"}));var encode_1$2=encode$q,MSB$4=128,REST$4=127,MSBALL$2=~REST$4,INT$2=Math.pow(2,31);function encode$q(i,e,a){e=e||[],a=a||0;for(var c=a;i>=INT$2;)e[a++]=i&255|MSB$4,i/=128;for(;i&MSBALL$2;)e[a++]=i&255|MSB$4,i>>>=7;return e[a]=i|0,encode$q.bytes=a-c+1,e}var decode$r=read$4,MSB$1$3=128,REST$1$3=127;function read$4(i,c){var a=0,c=c||0,h=0,d=c,et,ft=i.length;do{if(d>=ft)throw read$4.bytes=0,new RangeError("Could not decode varint");et=i[d++],a+=h<28?(et&REST$1$3)<<h:(et&REST$1$3)*Math.pow(2,h),h+=7}while(et>=MSB$1$3);return read$4.bytes=d-c,a}var N1$3=Math.pow(2,7),N2$3=Math.pow(2,14),N3$3=Math.pow(2,21),N4$3=Math.pow(2,28),N5$3=Math.pow(2,35),N6$3=Math.pow(2,42),N7$3=Math.pow(2,49),N8$2=Math.pow(2,56),N9$2=Math.pow(2,63),length$3=function(i){return i<N1$3?1:i<N2$3?2:i<N3$3?3:i<N4$3?4:i<N5$3?5:i<N6$3?6:i<N7$3?7:i<N8$2?8:i<N9$2?9:10},varint$2={encode:encode_1$2,decode:decode$r,encodingLength:length$3},_brrp_varint$2=varint$2;function decode$q(i,e=0){return[_brrp_varint$2.decode(i,e),_brrp_varint$2.decode.bytes]}function encodeTo$2(i,e,a=0){return _brrp_varint$2.encode(i,e,a),e}function encodingLength$5(i){return _brrp_varint$2.encodingLength(i)}function create$4(i,e){const a=e.byteLength,c=encodingLength$5(i),h=c+encodingLength$5(a),d=new Uint8Array(h+a);return encodeTo$2(i,d,0),encodeTo$2(a,d,c),d.set(e,h),new Digest$2(i,a,e,d)}function decode$p(i){const e=coerce$7(i),[a,c]=decode$q(e),[h,d]=decode$q(e.subarray(c)),et=e.subarray(c+d);if(et.byteLength!==h)throw new Error("Incorrect length");return new Digest$2(a,h,et,e)}function equals$6(i,e){if(i===e)return!0;{const a=e;return i.code===a.code&&i.size===a.size&&a.bytes instanceof Uint8Array&&equals$7(i.bytes,a.bytes)}}let Digest$2=class{constructor(e,a,c,h){qt(this,"code");qt(this,"size");qt(this,"digest");qt(this,"bytes");this.code=e,this.size=a,this.digest=c,this.bytes=h}};function format$1(i,e){const{bytes:a,version:c}=i;switch(c){case 0:return toStringV0$1(a,baseCache$1(i),e??base58btc$7.encoder);default:return toStringV1$1(a,baseCache$1(i),e??base32$e.encoder)}}const cache$2=new WeakMap;function baseCache$1(i){const e=cache$2.get(i);if(e==null){const a=new Map;return cache$2.set(i,a),a}return e}var bp;let CID$1=class Qn{constructor(e,a,c,h){qt(this,"code");qt(this,"version");qt(this,"multihash");qt(this,"bytes");qt(this,"/");qt(this,bp,"CID");this.code=a,this.version=e,this.multihash=c,this.bytes=h,this["/"]=h}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:a}=this;if(e!==DAG_PB_CODE$1)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(a.code!==SHA_256_CODE$1)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Qn.createV0(a)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:a}=this.multihash,c=create$4(e,a);return Qn.createV1(this.code,c)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Qn.equals(this,e)}static equals(e,a){const c=a;return c!=null&&e.code===c.code&&e.version===c.version&&equals$6(e.multihash,c.multihash)}toString(e){return format$1(this,e)}toJSON(){return{"/":format$1(this)}}link(){return this}[(bp=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const a=e;if(a instanceof Qn)return a;if(a["/"]!=null&&a["/"]===a.bytes||a.asCID===a){const{version:c,code:h,multihash:d,bytes:et}=a;return new Qn(c,h,d,et??encodeCID$1(c,h,d.bytes))}else if(a[cidSymbol$1]===!0){const{version:c,multihash:h,code:d}=a,et=decode$p(h);return Qn.create(c,d,et)}else return null}static create(e,a,c){if(typeof a!="number")throw new Error("String codecs are no longer supported");if(!(c.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(a!==DAG_PB_CODE$1)throw new Error(`Version 0 CID must use dag-pb (code: ${DAG_PB_CODE$1}) block encoding`);return new Qn(e,a,c,c.bytes)}case 1:{const h=encodeCID$1(e,a,c.bytes);return new Qn(e,a,c,h)}default:throw new Error("Invalid version")}}static createV0(e){return Qn.create(0,DAG_PB_CODE$1,e)}static createV1(e,a){return Qn.create(1,e,a)}static decode(e){const[a,c]=Qn.decodeFirst(e);if(c.length!==0)throw new Error("Incorrect length");return a}static decodeFirst(e){const a=Qn.inspectBytes(e),c=a.size-a.multihashSize,h=coerce$7(e.subarray(c,c+a.multihashSize));if(h.byteLength!==a.multihashSize)throw new Error("Incorrect length");const d=h.subarray(a.multihashSize-a.digestSize),et=new Digest$2(a.multihashCode,a.digestSize,d,h);return[a.version===0?Qn.createV0(et):Qn.createV1(a.codec,et),e.subarray(a.size)]}static inspectBytes(e){let a=0;const c=()=>{const[$t,It]=decode$q(e.subarray(a));return a+=It,$t};let h=c(),d=DAG_PB_CODE$1;if(h===18?(h=0,a=0):d=c(),h!==0&&h!==1)throw new RangeError(`Invalid CID version ${h}`);const et=a,ft=c(),gt=c(),_t=a+gt,wt=_t-et;return{version:h,codec:d,multihashCode:ft,digestSize:gt,multihashSize:wt,size:_t}}static parse(e,a){const[c,h]=parseCIDtoBytes$1(e,a),d=Qn.decode(h);if(d.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return baseCache$1(d).set(c,e),d}};function parseCIDtoBytes$1(i,e){switch(i[0]){case"Q":{const a=e??base58btc$7;return[base58btc$7.prefix,a.decode(`${base58btc$7.prefix}${i}`)]}case base58btc$7.prefix:{const a=e??base58btc$7;return[base58btc$7.prefix,a.decode(i)]}case base32$e.prefix:{const a=e??base32$e;return[base32$e.prefix,a.decode(i)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[i[0],e.decode(i)]}}}function toStringV0$1(i,e,a){const{prefix:c}=a;if(c!==base58btc$7.prefix)throw Error(`Cannot string encode V0 in ${a.name} encoding`);const h=e.get(c);if(h==null){const d=a.encode(i).slice(1);return e.set(c,d),d}else return h}function toStringV1$1(i,e,a){const{prefix:c}=a,h=e.get(c);if(h==null){const d=a.encode(i);return e.set(c,d),d}else return h}const DAG_PB_CODE$1=112,SHA_256_CODE$1=18;function encodeCID$1(i,e,a){const c=encodingLength$5(i),h=c+encodingLength$5(e),d=new Uint8Array(h+a.byteLength);return encodeTo$2(i,d,0),encodeTo$2(e,d,c),d.set(a,h),d}const cidSymbol$1=Symbol.for("@ipld/js-cid/CID");function equals$5(i,e){if(i===e)return!0;if(i.byteLength!==e.byteLength)return!1;for(let a=0;a<i.byteLength;a++)if(i[a]!==e[a])return!1;return!0}const base10$c=baseX$7({prefix:"9",name:"base10",alphabet:"0123456789"}),base10$d=Object.freeze(Object.defineProperty({__proto__:null,base10:base10$c},Symbol.toStringTag,{value:"Module"})),base16$c=rfc4648$7({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),base16upper$6=rfc4648$7({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),base16$d=Object.freeze(Object.defineProperty({__proto__:null,base16:base16$c,base16upper:base16upper$6},Symbol.toStringTag,{value:"Module"})),base2$c=rfc4648$7({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),base2$d=Object.freeze(Object.defineProperty({__proto__:null,base2:base2$c},Symbol.toStringTag,{value:"Module"})),alphabet$6=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),alphabetBytesToChars$6=alphabet$6.reduce((i,e,a)=>(i[a]=e,i),[]),alphabetCharsToBytes$6=alphabet$6.reduce((i,e,a)=>(i[e.codePointAt(0)]=a,i),[]);function encode$p(i){return i.reduce((e,a)=>(e+=alphabetBytesToChars$6[a],e),"")}function decode$o(i){const e=[];for(const a of i){const c=alphabetCharsToBytes$6[a.codePointAt(0)];if(c===void 0)throw new Error(`Non-base256emoji character: ${a}`);e.push(c)}return new Uint8Array(e)}const base256emoji$c=from$a({prefix:"🚀",name:"base256emoji",encode:encode$p,decode:decode$o}),base256emoji$d=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:base256emoji$c},Symbol.toStringTag,{value:"Module"})),base36$c=baseX$7({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),base36upper$6=baseX$7({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),base36$d=Object.freeze(Object.defineProperty({__proto__:null,base36:base36$c,base36upper:base36upper$6},Symbol.toStringTag,{value:"Module"})),base64$e=rfc4648$7({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),base64pad$6=rfc4648$7({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),base64url$7=rfc4648$7({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),base64urlpad$6=rfc4648$7({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),base64$f=Object.freeze(Object.defineProperty({__proto__:null,base64:base64$e,base64pad:base64pad$6,base64url:base64url$7,base64urlpad:base64urlpad$6},Symbol.toStringTag,{value:"Module"})),base8$c=rfc4648$7({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),base8$d=Object.freeze(Object.defineProperty({__proto__:null,base8:base8$c},Symbol.toStringTag,{value:"Module"})),identity$8=from$a({prefix:"\0",name:"identity",encode:i=>toString$h(i),decode:i=>fromString$c(i)}),identityBase$6=Object.freeze(Object.defineProperty({__proto__:null,identity:identity$8},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const bases$6={...identityBase$6,...base2$d,...base8$d,...base10$d,...base16$d,...base32$f,...base36$d,...base58$6,...base64$f,...base256emoji$d};function allocUnsafe$a(i=0){return new Uint8Array(i)}function createCodec$7(i,e,a,c){return{name:i,prefix:e,encoder:{name:i,prefix:e,encode:a},decoder:{decode:c}}}const string$8=createCodec$7("utf8","u",i=>"u"+new TextDecoder("utf8").decode(i),i=>new TextEncoder().encode(i.substring(1))),ascii$6=createCodec$7("ascii","a",i=>{let e="a";for(let a=0;a<i.length;a++)e+=String.fromCharCode(i[a]);return e},i=>{i=i.substring(1);const e=allocUnsafe$a(i.length);for(let a=0;a<i.length;a++)e[a]=i.charCodeAt(a);return e}),BASES$6={utf8:string$8,"utf-8":string$8,hex:bases$6.base16,latin1:ascii$6,ascii:ascii$6,binary:ascii$6,...bases$6};function toString$g(i,e="utf8"){const a=BASES$6[e];if(a==null)throw new Error(`Unsupported encoding "${e}"`);return a.encoder.encode(i).substring(1)}function allocUnsafe$9(i=0){return new Uint8Array(i)}const N1$2=Math.pow(2,7),N2$2=Math.pow(2,14),N3$2=Math.pow(2,21),N4$2=Math.pow(2,28),N5$2=Math.pow(2,35),N6$2=Math.pow(2,42),N7$2=Math.pow(2,49),MSB$3=128,REST$3=127;function encodingLength$4(i){if(i<N1$2)return 1;if(i<N2$2)return 2;if(i<N3$2)return 3;if(i<N4$2)return 4;if(i<N5$2)return 5;if(i<N6$2)return 6;if(i<N7$2)return 7;if(Number.MAX_SAFE_INTEGER!=null&&i>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return 8}function encodeUint8Array(i,e,a=0){switch(encodingLength$4(i)){case 8:e[a++]=i&255|MSB$3,i/=128;case 7:e[a++]=i&255|MSB$3,i/=128;case 6:e[a++]=i&255|MSB$3,i/=128;case 5:e[a++]=i&255|MSB$3,i/=128;case 4:e[a++]=i&255|MSB$3,i>>>=7;case 3:e[a++]=i&255|MSB$3,i>>>=7;case 2:e[a++]=i&255|MSB$3,i>>>=7;case 1:{e[a++]=i&255,i>>>=7;break}default:throw new Error("unreachable")}return e}function encodeUint8ArrayList(i,e,a=0){switch(encodingLength$4(i)){case 8:e.set(a++,i&255|MSB$3),i/=128;case 7:e.set(a++,i&255|MSB$3),i/=128;case 6:e.set(a++,i&255|MSB$3),i/=128;case 5:e.set(a++,i&255|MSB$3),i/=128;case 4:e.set(a++,i&255|MSB$3),i>>>=7;case 3:e.set(a++,i&255|MSB$3),i>>>=7;case 2:e.set(a++,i&255|MSB$3),i>>>=7;case 1:{e.set(a++,i&255),i>>>=7;break}default:throw new Error("unreachable")}return e}function decodeUint8Array(i,e){let a=i[e],c=0;if(c+=a&REST$3,a<MSB$3||(a=i[e+1],c+=(a&REST$3)<<7,a<MSB$3)||(a=i[e+2],c+=(a&REST$3)<<14,a<MSB$3)||(a=i[e+3],c+=(a&REST$3)<<21,a<MSB$3)||(a=i[e+4],c+=(a&REST$3)*N4$2,a<MSB$3)||(a=i[e+5],c+=(a&REST$3)*N5$2,a<MSB$3)||(a=i[e+6],c+=(a&REST$3)*N6$2,a<MSB$3)||(a=i[e+7],c+=(a&REST$3)*N7$2,a<MSB$3))return c;throw new RangeError("Could not decode varint")}function decodeUint8ArrayList(i,e){let a=i.get(e),c=0;if(c+=a&REST$3,a<MSB$3||(a=i.get(e+1),c+=(a&REST$3)<<7,a<MSB$3)||(a=i.get(e+2),c+=(a&REST$3)<<14,a<MSB$3)||(a=i.get(e+3),c+=(a&REST$3)<<21,a<MSB$3)||(a=i.get(e+4),c+=(a&REST$3)*N4$2,a<MSB$3)||(a=i.get(e+5),c+=(a&REST$3)*N5$2,a<MSB$3)||(a=i.get(e+6),c+=(a&REST$3)*N6$2,a<MSB$3)||(a=i.get(e+7),c+=(a&REST$3)*N7$2,a<MSB$3))return c;throw new RangeError("Could not decode varint")}function encode$o(i,e,a=0){return e==null&&(e=allocUnsafe$9(encodingLength$4(i))),e instanceof Uint8Array?encodeUint8Array(i,e,a):encodeUint8ArrayList(i,e,a)}function decode$n(i,e=0){return i instanceof Uint8Array?decodeUint8Array(i,e):decodeUint8ArrayList(i,e)}function asUint8Array$3(i){return i}function concat$4(i,e){e==null&&(e=i.reduce((h,d)=>h+d.length,0));const a=allocUnsafe$a(e);let c=0;for(const h of i)a.set(h,c),c+=h.length;return a}class Parser{constructor(){qt(this,"index",0);qt(this,"input","")}new(e){return this.index=0,this.input=e,this}readAtomically(e){const a=this.index,c=e();return c===void 0&&(this.index=a),c}parseWith(e){const a=e();if(this.index===this.input.length)return a}peekChar(){if(!(this.index>=this.input.length))return this.input[this.index]}readChar(){if(!(this.index>=this.input.length))return this.input[this.index++]}readGivenChar(e){return this.readAtomically(()=>{const a=this.readChar();if(a===e)return a})}readSeparator(e,a,c){return this.readAtomically(()=>{if(!(a>0&&this.readGivenChar(e)===void 0))return c()})}readNumber(e,a,c,h){return this.readAtomically(()=>{let d=0,et=0;const ft=this.peekChar();if(ft===void 0)return;const gt=ft==="0",_t=2**(8*h)-1;for(;;){const wt=this.readAtomically(()=>{const $t=this.readChar();if($t===void 0)return;const It=Number.parseInt($t,e);if(!Number.isNaN(It))return It});if(wt===void 0)break;if(d*=e,d+=wt,d>_t||(et+=1,a!==void 0&&et>a))return}if(et!==0)return!c&&gt&&et>1?void 0:d})}readIPv4Addr(){return this.readAtomically(()=>{const e=new Uint8Array(4);for(let a=0;a<e.length;a++){const c=this.readSeparator(".",a,()=>this.readNumber(10,3,!1,1));if(c===void 0)return;e[a]=c}return e})}readIPv6Addr(){const e=a=>{for(let c=0;c<a.length/2;c++){const h=c*2;if(c<a.length-3){const et=this.readSeparator(":",c,()=>this.readIPv4Addr());if(et!==void 0)return a[h]=et[0],a[h+1]=et[1],a[h+2]=et[2],a[h+3]=et[3],[h+4,!0]}const d=this.readSeparator(":",c,()=>this.readNumber(16,4,!0,2));if(d===void 0)return[h,!1];a[h]=d>>8,a[h+1]=d&255}return[a.length,!1]};return this.readAtomically(()=>{const a=new Uint8Array(16),[c,h]=e(a);if(c===16)return a;if(h||this.readGivenChar(":")===void 0||this.readGivenChar(":")===void 0)return;const d=new Uint8Array(14),et=16-(c+2),[ft]=e(d.subarray(0,et));return a.set(d.subarray(0,ft),16-ft),a})}readIPAddr(){return this.readIPv4Addr()??this.readIPv6Addr()}}const MAX_IPV6_LENGTH=45,MAX_IPV4_LENGTH=15,parser=new Parser;function parseIPv4(i){if(!(i.length>MAX_IPV4_LENGTH))return parser.new(i).parseWith(()=>parser.readIPv4Addr())}function parseIPv6(i){if(i.includes("%")&&(i=i.split("%")[0]),!(i.length>MAX_IPV6_LENGTH))return parser.new(i).parseWith(()=>parser.readIPv6Addr())}function parseIP(i){if(i.includes("%")&&(i=i.split("%")[0]),!(i.length>MAX_IPV6_LENGTH))return parser.new(i).parseWith(()=>parser.readIPAddr())}function fromString$b(i,e="utf8"){const a=BASES$6[e];if(a==null)throw new Error(`Unsupported encoding "${e}"`);return a.decoder.decode(`${a.prefix}${i}`)}function isIPv4(i){return!!parseIPv4(i)}function isIPv6(i){return!!parseIPv6(i)}function isIP(i){return!!parseIP(i)}const isV4=isIPv4,isV6=isIPv6,toBytes$1=function(i){let e=0;if(i=i.toString().trim(),isV4(i)){const a=new Uint8Array(e+4);return i.split(/\./g).forEach(c=>{a[e++]=parseInt(c,10)&255}),a}if(isV6(i)){const a=i.split(":",8);let c;for(c=0;c<a.length;c++){const d=isV4(a[c]);let et;d&&(et=toBytes$1(a[c]),a[c]=toString$g(et.slice(0,2),"base16")),et!=null&&++c<8&&a.splice(c,0,toString$g(et.slice(2,4),"base16"))}if(a[0]==="")for(;a.length<8;)a.unshift("0");else if(a[a.length-1]==="")for(;a.length<8;)a.push("0");else if(a.length<8){for(c=0;c<a.length&&a[c]!=="";c++);const d=[c,1];for(c=9-a.length;c>0;c--)d.push("0");a.splice.apply(a,d)}const h=new Uint8Array(e+16);for(c=0;c<a.length;c++){const d=parseInt(a[c],16);h[e++]=d>>8&255,h[e++]=d&255}return h}throw new Error("invalid ip address")},toString$f=function(i,e=0,a){e=~~e,a=a??i.length-e;const c=new DataView(i.buffer);if(a===4){const h=[];for(let d=0;d<a;d++)h.push(i[e+d]);return h.join(".")}if(a===16){const h=[];for(let d=0;d<a;d+=2)h.push(c.getUint16(e+d).toString(16));return h.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""},V=-1,names={},codes$4={},table=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,V,"ip6zone"],[43,8,"ipcidr"],[53,V,"dns",!0],[54,V,"dns4",!0],[55,V,"dns6",!0],[56,V,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc-direct"],[281,0,"webrtc"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,V,"unix",!1,!0],[421,V,"ipfs"],[421,V,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,V,"garlic64"],[448,0,"tls"],[449,V,"sni"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,V,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,V,"memory"]];table.forEach(i=>{const e=createProtocol(...i);codes$4[e.code]=e,names[e.name]=e});function createProtocol(i,e,a,c,h){return{code:i,size:e,name:a,resolvable:!!c,path:!!h}}function getProtocol(i){if(typeof i=="number"){if(codes$4[i]!=null)return codes$4[i];throw new Error(`no protocol with code: ${i}`)}else if(typeof i=="string"){if(names[i]!=null)return names[i];throw new Error(`no protocol with name: ${i}`)}throw new Error(`invalid protocol id type: ${typeof i}`)}getProtocol("ip4");getProtocol("ip6");getProtocol("ipcidr");function convertToString(i,e){switch(getProtocol(i).code){case 4:case 41:return bytes2ip(e);case 42:return bytes2str(e);case 6:case 273:case 33:case 132:return bytes2port(e).toString();case 53:case 54:case 55:case 56:case 400:case 449:case 777:return bytes2str(e);case 421:return bytes2mh(e);case 444:return bytes2onion(e);case 445:return bytes2onion(e);case 466:return bytes2mb(e);default:return toString$g(e,"base16")}}function convertToBytes(i,e){switch(getProtocol(i).code){case 4:return ip2bytes(e);case 41:return ip2bytes(e);case 42:return str2bytes(e);case 6:case 273:case 33:case 132:return port2bytes(parseInt(e,10));case 53:case 54:case 55:case 56:case 400:case 449:case 777:return str2bytes(e);case 421:return mh2bytes(e);case 444:return onion2bytes(e);case 445:return onion32bytes(e);case 466:return mb2bytes(e);default:return fromString$b(e,"base16")}}const decoders=Object.values(bases$6).map(i=>i.decoder),anybaseDecoder=function(){let i=decoders[0].or(decoders[1]);return decoders.slice(2).forEach(e=>i=i.or(e)),i}();function ip2bytes(i){if(!isIP(i))throw new Error("invalid ip address");return toBytes$1(i)}function bytes2ip(i){const e=toString$f(i,0,i.length);if(e==null)throw new Error("ipBuff is required");if(!isIP(e))throw new Error("invalid ip address");return e}function port2bytes(i){const e=new ArrayBuffer(2);return new DataView(e).setUint16(0,i),new Uint8Array(e)}function bytes2port(i){return new DataView(i.buffer).getUint16(i.byteOffset)}function str2bytes(i){const e=fromString$b(i),a=Uint8Array.from(encode$o(e.length));return concat$4([a,e],a.length+e.length)}function bytes2str(i){const e=decode$n(i);if(i=i.slice(encodingLength$4(e)),i.length!==e)throw new Error("inconsistent lengths");return toString$g(i)}function mh2bytes(i){let e;i[0]==="Q"||i[0]==="1"?e=decode$p(base58btc$7.decode(`z${i}`)).bytes:e=CID$1.parse(i).multihash.bytes;const a=Uint8Array.from(encode$o(e.length));return concat$4([a,e],a.length+e.length)}function mb2bytes(i){const e=anybaseDecoder.decode(i),a=Uint8Array.from(encode$o(e.length));return concat$4([a,e],a.length+e.length)}function bytes2mb(i){const e=decode$n(i),a=i.slice(encodingLength$4(e));if(a.length!==e)throw new Error("inconsistent lengths");return"u"+toString$g(a,"base64url")}function bytes2mh(i){const e=decode$n(i),a=i.slice(encodingLength$4(e));if(a.length!==e)throw new Error("inconsistent lengths");return toString$g(a,"base58btc")}function onion2bytes(i){const e=i.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==16)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion address.`);const a=base32$e.decode("b"+e[0]),c=parseInt(e[1],10);if(c<1||c>65536)throw new Error("Port number is not in range(1, 65536)");const h=port2bytes(c);return concat$4([a,h],a.length+h.length)}function onion32bytes(i){const e=i.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==56)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion3 address.`);const a=base32$e.decode(`b${e[0]}`),c=parseInt(e[1],10);if(c<1||c>65536)throw new Error("Port number is not in range(1, 65536)");const h=port2bytes(c);return concat$4([a,h],a.length+h.length)}function bytes2onion(i){const e=i.slice(0,i.length-2),a=i.slice(i.length-2),c=toString$g(e,"base32"),h=bytes2port(a);return`${c}:${h}`}function stringToMultiaddrParts(i){i=cleanPath(i);const e=[],a=[];let c=null;const h=i.split("/").slice(1);if(h.length===1&&h[0]==="")return{bytes:new Uint8Array,string:"/",tuples:[],stringTuples:[],path:null};for(let d=0;d<h.length;d++){const et=h[d],ft=getProtocol(et);if(ft.size===0){e.push([ft.code]),a.push([ft.code]);continue}if(d++,d>=h.length)throw ParseError("invalid address: "+i);if(ft.path===!0){c=cleanPath(h.slice(d).join("/")),e.push([ft.code,convertToBytes(ft.code,c)]),a.push([ft.code,c]);break}const gt=convertToBytes(ft.code,h[d]);e.push([ft.code,gt]),a.push([ft.code,convertToString(ft.code,gt)])}return{string:stringTuplesToString(a),bytes:tuplesToBytes(e),tuples:e,stringTuples:a,path:c}}function bytesToMultiaddrParts(i){const e=[],a=[];let c=null,h=0;for(;h<i.length;){const d=decode$n(i,h),et=encodingLength$4(d),ft=getProtocol(d),gt=sizeForAddr(ft,i.slice(h+et));if(gt===0){e.push([d]),a.push([d]),h+=et;continue}const _t=i.slice(h+et,h+et+gt);if(h+=gt+et,h>i.length)throw ParseError("Invalid address Uint8Array: "+toString$g(i,"base16"));e.push([d,_t]);const wt=convertToString(d,_t);if(a.push([d,wt]),ft.path===!0){c=wt;break}}return{bytes:Uint8Array.from(i),string:stringTuplesToString(a),tuples:e,stringTuples:a,path:c}}function stringTuplesToString(i){const e=[];return i.map(a=>{const c=getProtocol(a[0]);return e.push(c.name),a.length>1&&a[1]!=null&&e.push(a[1]),null}),cleanPath(e.join("/"))}function tuplesToBytes(i){return concat$4(i.map(e=>{const a=getProtocol(e[0]);let c=Uint8Array.from(encode$o(a.code));return e.length>1&&e[1]!=null&&(c=concat$4([c,e[1]])),c}))}function sizeForAddr(i,e){if(i.size>0)return i.size/8;if(i.size===0)return 0;{const a=decode$n(e instanceof Uint8Array?e:Uint8Array.from(e));return a+encodingLength$4(a)}}function cleanPath(i){return"/"+i.trim().split("/").filter(e=>e).join("/")}function ParseError(i){return new Error("Error parsing address: "+i)}const inspect$1=Symbol.for("nodejs.util.inspect.custom"),symbol$3=Symbol.for("@multiformats/js-multiaddr/multiaddr"),DNS_CODES=[getProtocol("dns").code,getProtocol("dns4").code,getProtocol("dns6").code,getProtocol("dnsaddr").code];var Us,Ps,co,ho,Ip;const Ms=class Ms{constructor(e){qt(this,"bytes");gn(this,Us,void 0);gn(this,Ps,void 0);gn(this,co,void 0);gn(this,ho,void 0);qt(this,Ip,!0);e==null&&(e="");let a;if(e instanceof Uint8Array)a=bytesToMultiaddrParts(e);else if(typeof e=="string"){if(e.length>0&&e.charAt(0)!=="/")throw new Error(`multiaddr "${e}" must start with a "/"`);a=stringToMultiaddrParts(e)}else if(isMultiaddr(e))a=bytesToMultiaddrParts(e.bytes);else throw new Error("addr must be a string, Buffer, or another Multiaddr");this.bytes=a.bytes,yn(this,Us,a.string),yn(this,Ps,a.tuples),yn(this,co,a.stringTuples),yn(this,ho,a.path)}toString(){return ur(this,Us)}toJSON(){return this.toString()}toOptions(){let e,a,c,h,d="";const et=getProtocol("tcp"),ft=getProtocol("udp"),gt=getProtocol("ip4"),_t=getProtocol("ip6"),wt=getProtocol("dns6"),$t=getProtocol("ip6zone");for(const[Rt,Tt]of this.stringTuples())Rt===$t.code&&(d=`%${Tt??""}`),DNS_CODES.includes(Rt)&&(a=et.name,h=443,c=`${Tt??""}${d}`,e=Rt===wt.code?6:4),(Rt===et.code||Rt===ft.code)&&(a=getProtocol(Rt).name,h=parseInt(Tt??"")),(Rt===gt.code||Rt===_t.code)&&(a=getProtocol(Rt).name,c=`${Tt??""}${d}`,e=Rt===_t.code?6:4);if(e==null||a==null||c==null||h==null)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:e,host:c,transport:a,port:h}}protos(){return ur(this,Ps).map(([e])=>Object.assign({},getProtocol(e)))}protoCodes(){return ur(this,Ps).map(([e])=>e)}protoNames(){return ur(this,Ps).map(([e])=>getProtocol(e).name)}tuples(){return ur(this,Ps)}stringTuples(){return ur(this,co)}encapsulate(e){return e=new Ms(e),new Ms(this.toString()+e.toString())}decapsulate(e){const a=e.toString(),c=this.toString(),h=c.lastIndexOf(a);if(h<0)throw new Error(`Address ${this.toString()} does not contain subaddress: ${e.toString()}`);return new Ms(c.slice(0,h))}decapsulateCode(e){const a=this.tuples();for(let c=a.length-1;c>=0;c--)if(a[c][0]===e)return new Ms(tuplesToBytes(a.slice(0,c)));return this}getPeerId(){try{let e=[];this.stringTuples().forEach(([c,h])=>{c===names.p2p.code&&e.push([c,h]),c===names["p2p-circuit"].code&&(e=[])});const a=e.pop();if((a==null?void 0:a[1])!=null){const c=a[1];return c[0]==="Q"||c[0]==="1"?toString$g(base58btc$7.decode(`z${c}`),"base58btc"):toString$g(CID$1.parse(c).multihash.bytes,"base58btc")}return null}catch{return null}}getPath(){return ur(this,ho)}equals(e){return equals$5(this.bytes,e.bytes)}async resolve(e){const a=this.protos().find(d=>d.resolvable);if(a==null)return[this];const c=resolvers$1.get(a.name);if(c==null)throw new CodeError$4(`no available resolver for ${a.name}`,"ERR_NO_AVAILABLE_RESOLVER");return(await c(this,e)).map(d=>multiaddr(d))}nodeAddress(){const e=this.toOptions();if(e.transport!=="tcp"&&e.transport!=="udp")throw new Error(`multiaddr must have a valid format - no protocol with name: "${e.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:e.family,address:e.host,port:e.port}}isThinWaistAddress(e){const a=(e??this).protos();return!(a.length!==2||a[0].code!==4&&a[0].code!==41||a[1].code!==6&&a[1].code!==273)}[(Ip=symbol$3,inspect$1)](){return`Multiaddr(${ur(this,Us)})`}};Us=new WeakMap,Ps=new WeakMap,co=new WeakMap,ho=new WeakMap;let Multiaddr=Ms;const resolvers$1=new Map;function isMultiaddr(i){return!!(i!=null&&i[symbol$3])}function multiaddr(i){return new Multiaddr(i)}var Protocols$1;(function(i){i.Relay="relay",i.Store="store",i.LightPush="lightpush",i.Filter="filter"})(Protocols$1||(Protocols$1={}));var SendError;(function(i){i.GENERIC_FAIL="Generic error",i.ENCODE_FAILED="Failed to encode",i.DECODE_FAILED="Failed to decode",i.EMPTY_PAYLOAD="Payload is empty",i.SIZE_TOO_BIG="Size is too big",i.TOPIC_NOT_CONFIGURED="Topic not configured",i.NO_PEER_AVAILABLE="No peer available",i.REMOTE_PEER_FAULT="Remote peer fault",i.REMOTE_PEER_REJECTED="Remote peer rejected"})(SendError||(SendError={}));var PageDirection$1;(function(i){i.BACKWARD="backward",i.FORWARD="forward"})(PageDirection$1||(PageDirection$1={}));var Tags;(function(i){i.BOOTSTRAP="bootstrap",i.PEER_EXCHANGE="peer-exchange"})(Tags||(Tags={}));var EPeersByDiscoveryEvents;(function(i){i.PEER_DISCOVERY_BOOTSTRAP="peer:discovery:bootstrap",i.PEER_DISCOVERY_PEER_EXCHANGE="peer:discovery:peer-exchange",i.PEER_CONNECT_BOOTSTRAP="peer:connected:bootstrap",i.PEER_CONNECT_PEER_EXCHANGE="peer:connected:peer-exchange"})(EPeersByDiscoveryEvents||(EPeersByDiscoveryEvents={}));var EConnectionStateEvents;(function(i){i.CONNECTION_STATUS="waku:connection"})(EConnectionStateEvents||(EConnectionStateEvents={}));const DefaultPubsubTopic="/waku/2/default-waku/proto";function isDefined(i){return!!i}function groupByContentTopic(i){const e=new Map;return i.forEach(a=>{let c=e.get(a.contentTopic);c||(e.set(a.contentTopic,[]),c=e.get(a.contentTopic)),c.push(a)}),e}const FRAME_RATE=60;async function toAsyncIterator(i,e,a){const c=(a==null?void 0:a.iteratorDelay)??FRAME_RATE,h=[];let d;d=await i.subscribe(e,wt=>{h.push(wt)});const et=Number.isInteger(a==null?void 0:a.timeoutMs),ft=(a==null?void 0:a.timeoutMs)??0,gt=Date.now();async function*_t(){for(;;){if(et&&Date.now()-gt>=ft)return;await wait(c);const wt=h.shift();if(!d&&h.length===0)return wt;!wt&&d||(yield wt)}}return{iterator:_t(),async stop(){d&&(await d(),d=void 0)}}}function wait(i){return new Promise(e=>{setTimeout(e,i)})}const MB=1024**2,SIZE_CAP_IN_MB=1;async function isMessageSizeUnderCap(i,e){const a=await i.toWire(e);return a?isWireSizeUnderCap(a):!1}const isWireSizeUnderCap=i=>i.length/MB<=SIZE_CAP_IN_MB;function asUint8Array$2(i){return globalThis.Buffer!=null?new Uint8Array(i.buffer,i.byteOffset,i.byteLength):i}function base$7(i,e){if(i.length>=255)throw new TypeError("Alphabet too long");for(var a=new Uint8Array(256),c=0;c<a.length;c++)a[c]=255;for(var h=0;h<i.length;h++){var d=i.charAt(h),et=d.charCodeAt(0);if(a[et]!==255)throw new TypeError(d+" is ambiguous");a[et]=h}var ft=i.length,gt=i.charAt(0),_t=Math.log(ft)/Math.log(256),wt=Math.log(256)/Math.log(ft);function $t(Tt){if(Tt instanceof Uint8Array||(ArrayBuffer.isView(Tt)?Tt=new Uint8Array(Tt.buffer,Tt.byteOffset,Tt.byteLength):Array.isArray(Tt)&&(Tt=Uint8Array.from(Tt))),!(Tt instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(Tt.length===0)return"";for(var At=0,kt=0,xt=0,Nt=Tt.length;xt!==Nt&&Tt[xt]===0;)xt++,At++;for(var Ft=(Nt-xt)*wt+1>>>0,jt=new Uint8Array(Ft);xt!==Nt;){for(var Gt=Tt[xt],Kt=0,Wt=Ft-1;(Gt!==0||Kt<kt)&&Wt!==-1;Wt--,Kt++)Gt+=256*jt[Wt]>>>0,jt[Wt]=Gt%ft>>>0,Gt=Gt/ft>>>0;if(Gt!==0)throw new Error("Non-zero carry");kt=Kt,xt++}for(var Zt=Ft-kt;Zt!==Ft&&jt[Zt]===0;)Zt++;for(var cr=gt.repeat(At);Zt<Ft;++Zt)cr+=i.charAt(jt[Zt]);return cr}function It(Tt){if(typeof Tt!="string")throw new TypeError("Expected String");if(Tt.length===0)return new Uint8Array;var At=0;if(Tt[At]!==" "){for(var kt=0,xt=0;Tt[At]===gt;)kt++,At++;for(var Nt=(Tt.length-At)*_t+1>>>0,Ft=new Uint8Array(Nt);Tt[At];){var jt=a[Tt.charCodeAt(At)];if(jt===255)return;for(var Gt=0,Kt=Nt-1;(jt!==0||Gt<xt)&&Kt!==-1;Kt--,Gt++)jt+=ft*Ft[Kt]>>>0,Ft[Kt]=jt%256>>>0,jt=jt/256>>>0;if(jt!==0)throw new Error("Non-zero carry");xt=Gt,At++}if(Tt[At]!==" "){for(var Wt=Nt-xt;Wt!==Nt&&Ft[Wt]===0;)Wt++;for(var Zt=new Uint8Array(kt+(Nt-Wt)),cr=kt;Wt!==Nt;)Zt[cr++]=Ft[Wt++];return Zt}}}function Rt(Tt){var At=It(Tt);if(At)return At;throw new Error(`Non-${e} character`)}return{encode:$t,decodeUnsafe:It,decode:Rt}}var src$6=base$7,_brrp__multiformats_scope_baseX$6=src$6;const equals$4=(i,e)=>{if(i===e)return!0;if(i.byteLength!==e.byteLength)return!1;for(let a=0;a<i.byteLength;a++)if(i[a]!==e[a])return!1;return!0},coerce$6=i=>{if(i instanceof Uint8Array&&i.constructor.name==="Uint8Array")return i;if(i instanceof ArrayBuffer)return new Uint8Array(i);if(ArrayBuffer.isView(i))return new Uint8Array(i.buffer,i.byteOffset,i.byteLength);throw new Error("Unknown type, must be binary type")},fromString$a=i=>new TextEncoder().encode(i),toString$e=i=>new TextDecoder().decode(i);let Encoder$8=class{constructor(e,a,c){this.name=e,this.prefix=a,this.baseEncode=c}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Decoder$8=class{constructor(e,a,c){if(this.name=e,this.prefix=a,a.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=a.codePointAt(0),this.baseDecode=c}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return or$8(this,e)}},ComposedDecoder$6=class{constructor(e){this.decoders=e}or(e){return or$8(this,e)}decode(e){const a=e[0],c=this.decoders[a];if(c)return c.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const or$8=(i,e)=>new ComposedDecoder$6({...i.decoders||{[i.prefix]:i},...e.decoders||{[e.prefix]:e}});let Codec$6=class{constructor(e,a,c,h){this.name=e,this.prefix=a,this.baseEncode=c,this.baseDecode=h,this.encoder=new Encoder$8(e,a,c),this.decoder=new Decoder$8(e,a,h)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const from$9=({name:i,prefix:e,encode:a,decode:c})=>new Codec$6(i,e,a,c),baseX$6=({prefix:i,name:e,alphabet:a})=>{const{encode:c,decode:h}=_brrp__multiformats_scope_baseX$6(a,e);return from$9({prefix:i,name:e,encode:c,decode:d=>coerce$6(h(d))})},decode$m=(i,e,a,c)=>{const h={};for(let wt=0;wt<e.length;++wt)h[e[wt]]=wt;let d=i.length;for(;i[d-1]==="=";)--d;const et=new Uint8Array(d*a/8|0);let ft=0,gt=0,_t=0;for(let wt=0;wt<d;++wt){const $t=h[i[wt]];if($t===void 0)throw new SyntaxError(`Non-${c} character`);gt=gt<<a|$t,ft+=a,ft>=8&&(ft-=8,et[_t++]=255&gt>>ft)}if(ft>=a||255&gt<<8-ft)throw new SyntaxError("Unexpected end of data");return et},encode$n=(i,e,a)=>{const c=e[e.length-1]==="=",h=(1<<a)-1;let d="",et=0,ft=0;for(let gt=0;gt<i.length;++gt)for(ft=ft<<8|i[gt],et+=8;et>a;)et-=a,d+=e[h&ft>>et];if(et&&(d+=e[h&ft<<a-et]),c)for(;d.length*a&7;)d+="=";return d},rfc4648$6=({name:i,prefix:e,bitsPerChar:a,alphabet:c})=>from$9({prefix:e,name:i,encode(h){return encode$n(h,c,a)},decode(h){return decode$m(h,c,a,i)}}),base10$a=baseX$6({prefix:"9",name:"base10",alphabet:"0123456789"}),base10$b=Object.freeze(Object.defineProperty({__proto__:null,base10:base10$a},Symbol.toStringTag,{value:"Module"})),base16$a=rfc4648$6({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),base16upper$5=rfc4648$6({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),base16$b=Object.freeze(Object.defineProperty({__proto__:null,base16:base16$a,base16upper:base16upper$5},Symbol.toStringTag,{value:"Module"})),base2$a=rfc4648$6({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),base2$b=Object.freeze(Object.defineProperty({__proto__:null,base2:base2$a},Symbol.toStringTag,{value:"Module"})),alphabet$5=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),alphabetBytesToChars$5=alphabet$5.reduce((i,e,a)=>(i[a]=e,i),[]),alphabetCharsToBytes$5=alphabet$5.reduce((i,e,a)=>(i[e.codePointAt(0)]=a,i),[]);function encode$m(i){return i.reduce((e,a)=>(e+=alphabetBytesToChars$5[a],e),"")}function decode$l(i){const e=[];for(const a of i){const c=alphabetCharsToBytes$5[a.codePointAt(0)];if(c===void 0)throw new Error(`Non-base256emoji character: ${a}`);e.push(c)}return new Uint8Array(e)}const base256emoji$a=from$9({prefix:"🚀",name:"base256emoji",encode:encode$m,decode:decode$l}),base256emoji$b=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:base256emoji$a},Symbol.toStringTag,{value:"Module"})),base32$c=rfc4648$6({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),base32upper$5=rfc4648$6({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),base32pad$5=rfc4648$6({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),base32padupper$5=rfc4648$6({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),base32hex$5=rfc4648$6({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),base32hexupper$5=rfc4648$6({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),base32hexpad$5=rfc4648$6({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),base32hexpadupper$5=rfc4648$6({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),base32z$5=rfc4648$6({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),base32$d=Object.freeze(Object.defineProperty({__proto__:null,base32:base32$c,base32hex:base32hex$5,base32hexpad:base32hexpad$5,base32hexpadupper:base32hexpadupper$5,base32hexupper:base32hexupper$5,base32pad:base32pad$5,base32padupper:base32padupper$5,base32upper:base32upper$5,base32z:base32z$5},Symbol.toStringTag,{value:"Module"})),base36$a=baseX$6({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),base36upper$5=baseX$6({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),base36$b=Object.freeze(Object.defineProperty({__proto__:null,base36:base36$a,base36upper:base36upper$5},Symbol.toStringTag,{value:"Module"})),base58btc$6=baseX$6({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),base58flickr$5=baseX$6({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),base58$5=Object.freeze(Object.defineProperty({__proto__:null,base58btc:base58btc$6,base58flickr:base58flickr$5},Symbol.toStringTag,{value:"Module"})),base64$c=rfc4648$6({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),base64pad$5=rfc4648$6({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),base64url$6=rfc4648$6({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),base64urlpad$5=rfc4648$6({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),base64$d=Object.freeze(Object.defineProperty({__proto__:null,base64:base64$c,base64pad:base64pad$5,base64url:base64url$6,base64urlpad:base64urlpad$5},Symbol.toStringTag,{value:"Module"})),base8$a=rfc4648$6({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),base8$b=Object.freeze(Object.defineProperty({__proto__:null,base8:base8$a},Symbol.toStringTag,{value:"Module"})),identity$7=from$9({prefix:"\0",name:"identity",encode:i=>toString$e(i),decode:i=>fromString$a(i)}),identityBase$5=Object.freeze(Object.defineProperty({__proto__:null,identity:identity$7},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;var encode_1$1=encode$l,MSB$2=128,REST$2=127,MSBALL$1=~REST$2,INT$1=Math.pow(2,31);function encode$l(i,e,a){e=e||[],a=a||0;for(var c=a;i>=INT$1;)e[a++]=i&255|MSB$2,i/=128;for(;i&MSBALL$1;)e[a++]=i&255|MSB$2,i>>>=7;return e[a]=i|0,encode$l.bytes=a-c+1,e}var decode$k=read$3,MSB$1$2=128,REST$1$2=127;function read$3(i,c){var a=0,c=c||0,h=0,d=c,et,ft=i.length;do{if(d>=ft)throw read$3.bytes=0,new RangeError("Could not decode varint");et=i[d++],a+=h<28?(et&REST$1$2)<<h:(et&REST$1$2)*Math.pow(2,h),h+=7}while(et>=MSB$1$2);return read$3.bytes=d-c,a}var N1$1=Math.pow(2,7),N2$1=Math.pow(2,14),N3$1=Math.pow(2,21),N4$1=Math.pow(2,28),N5$1=Math.pow(2,35),N6$1=Math.pow(2,42),N7$1=Math.pow(2,49),N8$1=Math.pow(2,56),N9$1=Math.pow(2,63),length$2=function(i){return i<N1$1?1:i<N2$1?2:i<N3$1?3:i<N4$1?4:i<N5$1?5:i<N6$1?6:i<N7$1?7:i<N8$1?8:i<N9$1?9:10},varint$1={encode:encode_1$1,decode:decode$k,encodingLength:length$2},_brrp_varint$1=varint$1;const decode$j=(i,e=0)=>[_brrp_varint$1.decode(i,e),_brrp_varint$1.decode.bytes],encodeTo$1=(i,e,a=0)=>(_brrp_varint$1.encode(i,e,a),e),encodingLength$3=i=>_brrp_varint$1.encodingLength(i),create$3=(i,e)=>{const a=e.byteLength,c=encodingLength$3(i),h=c+encodingLength$3(a),d=new Uint8Array(h+a);return encodeTo$1(i,d,0),encodeTo$1(a,d,c),d.set(e,h),new Digest$1(i,a,e,d)},decode$i=i=>{const e=coerce$6(i),[a,c]=decode$j(e),[h,d]=decode$j(e.subarray(c)),et=e.subarray(c+d);if(et.byteLength!==h)throw new Error("Incorrect length");return new Digest$1(a,h,et,e)},equals$3=(i,e)=>{if(i===e)return!0;{const a=e;return i.code===a.code&&i.size===a.size&&a.bytes instanceof Uint8Array&&equals$4(i.bytes,a.bytes)}};let Digest$1=class{constructor(e,a,c,h){this.code=e,this.size=a,this.digest=c,this.bytes=h}};const code$1=0,name$s="identity",encode$k=coerce$6,digest$1=i=>create$3(code$1,encode$k(i)),identity$6={code:code$1,name:name$s,encode:encode$k,digest:digest$1},from$8=({name:i,code:e,encode:a})=>new Hasher$1(i,e,a);let Hasher$1=class{constructor(e,a,c){this.name=e,this.code=a,this.encode=c}digest(e){if(e instanceof Uint8Array){const a=this.encode(e);return a instanceof Uint8Array?create$3(this.code,a):a.then(c=>create$3(this.code,c))}else throw Error("Unknown type, must be binary type")}};const sha$1=i=>async e=>new Uint8Array(await crypto.subtle.digest(i,e)),sha256$2=from$8({name:"sha2-256",code:18,encode:sha$1("SHA-256")}),format=(i,e)=>{const{bytes:a,version:c}=i;switch(c){case 0:return toStringV0(a,baseCache(i),e||base58btc$6.encoder);default:return toStringV1(a,baseCache(i),e||base32$c.encoder)}},cache$1=new WeakMap,baseCache=i=>{const e=cache$1.get(i);if(e==null){const a=new Map;return cache$1.set(i,a),a}return e};class CID{constructor(e,a,c,h){this.code=a,this.version=e,this.multihash=c,this.bytes=h,this["/"]=h}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:a}=this;if(e!==DAG_PB_CODE)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(a.code!==SHA_256_CODE)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return CID.createV0(a)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:a}=this.multihash,c=create$3(e,a);return CID.createV1(this.code,c)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return CID.equals(this,e)}static equals(e,a){const c=a;return c&&e.code===c.code&&e.version===c.version&&equals$3(e.multihash,c.multihash)}toString(e){return format(this,e)}toJSON(){return{"/":format(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const a=e;if(a instanceof CID)return a;if(a["/"]!=null&&a["/"]===a.bytes||a.asCID===a){const{version:c,code:h,multihash:d,bytes:et}=a;return new CID(c,h,d,et||encodeCID(c,h,d.bytes))}else if(a[cidSymbol]===!0){const{version:c,multihash:h,code:d}=a,et=decode$i(h);return CID.create(c,d,et)}else return null}static create(e,a,c){if(typeof a!="number")throw new Error("String codecs are no longer supported");if(!(c.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(a!==DAG_PB_CODE)throw new Error(`Version 0 CID must use dag-pb (code: ${DAG_PB_CODE}) block encoding`);return new CID(e,a,c,c.bytes)}case 1:{const h=encodeCID(e,a,c.bytes);return new CID(e,a,c,h)}default:throw new Error("Invalid version")}}static createV0(e){return CID.create(0,DAG_PB_CODE,e)}static createV1(e,a){return CID.create(1,e,a)}static decode(e){const[a,c]=CID.decodeFirst(e);if(c.length)throw new Error("Incorrect length");return a}static decodeFirst(e){const a=CID.inspectBytes(e),c=a.size-a.multihashSize,h=coerce$6(e.subarray(c,c+a.multihashSize));if(h.byteLength!==a.multihashSize)throw new Error("Incorrect length");const d=h.subarray(a.multihashSize-a.digestSize),et=new Digest$1(a.multihashCode,a.digestSize,d,h);return[a.version===0?CID.createV0(et):CID.createV1(a.codec,et),e.subarray(a.size)]}static inspectBytes(e){let a=0;const c=()=>{const[$t,It]=decode$j(e.subarray(a));return a+=It,$t};let h=c(),d=DAG_PB_CODE;if(h===18?(h=0,a=0):d=c(),h!==0&&h!==1)throw new RangeError(`Invalid CID version ${h}`);const et=a,ft=c(),gt=c(),_t=a+gt,wt=_t-et;return{version:h,codec:d,multihashCode:ft,digestSize:gt,multihashSize:wt,size:_t}}static parse(e,a){const[c,h]=parseCIDtoBytes(e,a),d=CID.decode(h);if(d.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return baseCache(d).set(c,e),d}}const parseCIDtoBytes=(i,e)=>{switch(i[0]){case"Q":{const a=e||base58btc$6;return[base58btc$6.prefix,a.decode(`${base58btc$6.prefix}${i}`)]}case base58btc$6.prefix:{const a=e||base58btc$6;return[base58btc$6.prefix,a.decode(i)]}case base32$c.prefix:{const a=e||base32$c;return[base32$c.prefix,a.decode(i)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[i[0],e.decode(i)]}}},toStringV0=(i,e,a)=>{const{prefix:c}=a;if(c!==base58btc$6.prefix)throw Error(`Cannot string encode V0 in ${a.name} encoding`);const h=e.get(c);if(h==null){const d=a.encode(i).slice(1);return e.set(c,d),d}else return h},toStringV1=(i,e,a)=>{const{prefix:c}=a,h=e.get(c);if(h==null){const d=a.encode(i);return e.set(c,d),d}else return h},DAG_PB_CODE=112,SHA_256_CODE=18,encodeCID=(i,e,a)=>{const c=encodingLength$3(i),h=c+encodingLength$3(e),d=new Uint8Array(h+a.byteLength);return encodeTo$1(i,d,0),encodeTo$1(e,d,c),d.set(a,h),d},cidSymbol=Symbol.for("@ipld/js-cid/CID"),bases$5={...identityBase$5,...base2$b,...base8$b,...base10$b,...base16$b,...base32$d,...base36$b,...base58$5,...base64$d,...base256emoji$b};function alloc$3(i=0){var e;return((e=globalThis.Buffer)==null?void 0:e.alloc)!=null?asUint8Array$2(globalThis.Buffer.alloc(i)):new Uint8Array(i)}function allocUnsafe$8(i=0){var e;return((e=globalThis.Buffer)==null?void 0:e.allocUnsafe)!=null?asUint8Array$2(globalThis.Buffer.allocUnsafe(i)):new Uint8Array(i)}function createCodec$6(i,e,a,c){return{name:i,prefix:e,encoder:{name:i,prefix:e,encode:a},decoder:{decode:c}}}const string$7=createCodec$6("utf8","u",i=>"u"+new TextDecoder("utf8").decode(i),i=>new TextEncoder().encode(i.substring(1))),ascii$5=createCodec$6("ascii","a",i=>{let e="a";for(let a=0;a<i.length;a++)e+=String.fromCharCode(i[a]);return e},i=>{i=i.substring(1);const e=allocUnsafe$8(i.length);for(let a=0;a<i.length;a++)e[a]=i.charCodeAt(a);return e}),BASES$5={utf8:string$7,"utf-8":string$7,hex:bases$5.base16,latin1:ascii$5,ascii:ascii$5,binary:ascii$5,...bases$5};function fromString$9(i,e="utf8"){const a=BASES$5[e];if(a==null)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?asUint8Array$2(globalThis.Buffer.from(i,"utf-8")):a.decoder.decode(`${a.prefix}${i}`)}function toString$d(i,e="utf8"){const a=BASES$5[e];if(a==null)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(i.buffer,i.byteOffset,i.byteLength).toString("utf8"):a.encoder.encode(i).substring(1)}function hexToBytes$1(i){if(typeof i=="string"){const e=i.replace(/^0x/i,"");return fromString$9(e.toLowerCase(),"base16")}return i}const bytesToHex$1=i=>toString$d(i,"base16"),bytesToUtf8=i=>toString$d(i,"utf8"),utf8ToBytes$1=i=>fromString$9(i,"utf8");function concat$3(i,e){const a=e??i.reduce((d,et)=>d+et.length,0),c=new Uint8Array(a);let h=0;for(const d of i)c.set(d,h),h+=d.length;return c}const singleShardInfoToPubsubTopic=i=>{if(i.clusterId===void 0||i.shard===void 0)throw new Error("Invalid shard");return`/waku/2/rs/${i.clusterId}/${i.shard}`},shardInfoToPubsubTopics=i=>{if(i.clusterId===void 0)throw new Error("Cluster ID must be specified");if("contentTopics"in i)return Array.from(new Set(i.contentTopics.map(e=>contentTopicToPubsubTopic(e,i.clusterId))));if("shards"in i){if(i.shards===void 0)throw new Error("Invalid shard");return Array.from(new Set(i.shards.map(e=>`/waku/2/rs/${i.clusterId}/${e}`)))}else return[contentTopicToPubsubTopic(`/${i.application}/${i.version}/default/default`)]},pubsubTopicToSingleShardInfo=i=>{const e=i.split("/");if(e.length!=6||e[1]!=="waku"||e[2]!=="2"||e[3]!=="rs")throw new Error("Invalid pubsub topic");const a=parseInt(e[4]),c=parseInt(e[5]);if(isNaN(a)||isNaN(c))throw new Error("Invalid clusterId or shard");return{clusterId:a,shard:c}};function ensurePubsubTopicIsConfigured(i,e){if(!e.includes(i))throw new Error(`Pubsub topic ${i} has not been configured on this instance. Configured topics are: ${e}. Please update your configuration by passing in the topic during Waku node instantiation.`)}function ensureValidContentTopic(i){const e=i.split("/");if(e.length<5||e.length>6)throw Error("Content topic format is invalid");let a=0;if(e.length==6){if(a=parseInt(e[1]),isNaN(a))throw new Error("Invalid generation field in content topic");if(a>0)throw new Error("Generation greater than 0 is not supported")}const c=e.splice(-4);if(c[0].length==0)throw new Error("Application field cannot be empty");if(c[1].length==0)throw new Error("Version field cannot be empty");if(c[2].length==0)throw new Error("Topic name field cannot be empty");if(c[3].length==0)throw new Error("Encoding field cannot be empty");return{generation:a,application:c[0],version:c[1],topicName:c[2],encoding:c[3]}}function contentTopicToShardIndex(i,e=8){const{application:a,version:c}=ensureValidContentTopic(i),h=sha256$3(concat$3([utf8ToBytes$1(a),utf8ToBytes$1(c)])),d=new DataView(h.buffer.slice(-8));return Number(d.getBigUint64(0,!1)%BigInt(e))}function contentTopicToPubsubTopic(i,e=1,a=8){const c=contentTopicToShardIndex(i,a);return`/waku/2/rs/${e}/${c}`}function determinePubsubTopic(i,e=DefaultPubsubTopic){return typeof e=="string"?e:e?e.shard?singleShardInfoToPubsubTopic(e):contentTopicToPubsubTopic(i,e.clusterId):DefaultPubsubTopic}function pushOrInitMapSet(i,e,a){let c=i.get(e);typeof c>"u"&&(i.set(e,new Set),c=i.get(e)),c.add(a)}var browser$2={exports:{}},ms,hasRequiredMs;function requireMs(){if(hasRequiredMs)return ms;hasRequiredMs=1;var i=1e3,e=i*60,a=e*60,c=a*24,h=c*7,d=c*365.25;ms=function(wt,$t){$t=$t||{};var It=typeof wt;if(It==="string"&&wt.length>0)return et(wt);if(It==="number"&&isFinite(wt))return $t.long?gt(wt):ft(wt);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(wt))};function et(wt){if(wt=String(wt),!(wt.length>100)){var $t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(wt);if($t){var It=parseFloat($t[1]),Rt=($t[2]||"ms").toLowerCase();switch(Rt){case"years":case"year":case"yrs":case"yr":case"y":return It*d;case"weeks":case"week":case"w":return It*h;case"days":case"day":case"d":return It*c;case"hours":case"hour":case"hrs":case"hr":case"h":return It*a;case"minutes":case"minute":case"mins":case"min":case"m":return It*e;case"seconds":case"second":case"secs":case"sec":case"s":return It*i;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return It;default:return}}}}function ft(wt){var $t=Math.abs(wt);return $t>=c?Math.round(wt/c)+"d":$t>=a?Math.round(wt/a)+"h":$t>=e?Math.round(wt/e)+"m":$t>=i?Math.round(wt/i)+"s":wt+"ms"}function gt(wt){var $t=Math.abs(wt);return $t>=c?_t(wt,$t,c,"day"):$t>=a?_t(wt,$t,a,"hour"):$t>=e?_t(wt,$t,e,"minute"):$t>=i?_t(wt,$t,i,"second"):wt+" ms"}function _t(wt,$t,It,Rt){var Tt=$t>=It*1.5;return Math.round(wt/It)+" "+Rt+(Tt?"s":"")}return ms}function setup(i){a.debug=a,a.default=a,a.coerce=gt,a.disable=d,a.enable=h,a.enabled=et,a.humanize=requireMs(),a.destroy=_t,Object.keys(i).forEach(wt=>{a[wt]=i[wt]}),a.names=[],a.skips=[],a.formatters={};function e(wt){let $t=0;for(let It=0;It<wt.length;It++)$t=($t<<5)-$t+wt.charCodeAt(It),$t|=0;return a.colors[Math.abs($t)%a.colors.length]}a.selectColor=e;function a(wt){let $t,It=null,Rt,Tt;function At(...kt){if(!At.enabled)return;const xt=At,Nt=Number(new Date),Ft=Nt-($t||Nt);xt.diff=Ft,xt.prev=$t,xt.curr=Nt,$t=Nt,kt[0]=a.coerce(kt[0]),typeof kt[0]!="string"&&kt.unshift("%O");let jt=0;kt[0]=kt[0].replace(/%([a-zA-Z%])/g,(Kt,Wt)=>{if(Kt==="%%")return"%";jt++;const Zt=a.formatters[Wt];if(typeof Zt=="function"){const cr=kt[jt];Kt=Zt.call(xt,cr),kt.splice(jt,1),jt--}return Kt}),a.formatArgs.call(xt,kt),(xt.log||a.log).apply(xt,kt)}return At.namespace=wt,At.useColors=a.useColors(),At.color=a.selectColor(wt),At.extend=c,At.destroy=a.destroy,Object.defineProperty(At,"enabled",{enumerable:!0,configurable:!1,get:()=>It!==null?It:(Rt!==a.namespaces&&(Rt=a.namespaces,Tt=a.enabled(wt)),Tt),set:kt=>{It=kt}}),typeof a.init=="function"&&a.init(At),At}function c(wt,$t){const It=a(this.namespace+(typeof $t>"u"?":":$t)+wt);return It.log=this.log,It}function h(wt){a.save(wt),a.namespaces=wt,a.names=[],a.skips=[];let $t;const It=(typeof wt=="string"?wt:"").split(/[\s,]+/),Rt=It.length;for($t=0;$t<Rt;$t++)It[$t]&&(wt=It[$t].replace(/\*/g,".*?"),wt[0]==="-"?a.skips.push(new RegExp("^"+wt.slice(1)+"$")):a.names.push(new RegExp("^"+wt+"$")))}function d(){const wt=[...a.names.map(ft),...a.skips.map(ft).map($t=>"-"+$t)].join(",");return a.enable(""),wt}function et(wt){if(wt[wt.length-1]==="*")return!0;let $t,It;for($t=0,It=a.skips.length;$t<It;$t++)if(a.skips[$t].test(wt))return!1;for($t=0,It=a.names.length;$t<It;$t++)if(a.names[$t].test(wt))return!0;return!1}function ft(wt){return wt.toString().substring(2,wt.toString().length-2).replace(/\.\*\?$/,"*")}function gt(wt){return wt instanceof Error?wt.stack||wt.message:wt}function _t(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return a.enable(a.load()),a}var common=setup;(function(i,e){var a={};e.formatArgs=h,e.save=d,e.load=et,e.useColors=c,e.storage=ft(),e.destroy=(()=>{let _t=!1;return()=>{_t||(_t=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function c(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function h(_t){if(_t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+_t[0]+(this.useColors?"%c ":" ")+"+"+i.exports.humanize(this.diff),!this.useColors)return;const wt="color: "+this.color;_t.splice(1,0,wt,"color: inherit");let $t=0,It=0;_t[0].replace(/%[a-zA-Z%]/g,Rt=>{Rt!=="%%"&&($t++,Rt==="%c"&&(It=$t))}),_t.splice(It,0,wt)}e.log=console.debug||console.log||(()=>{});function d(_t){try{_t?e.storage.setItem("debug",_t):e.storage.removeItem("debug")}catch{}}function et(){let _t;try{_t=e.storage.getItem("debug")}catch{}return!_t&&typeof process<"u"&&"env"in process&&(_t=a.DEBUG),_t}function ft(){try{return localStorage}catch{}}i.exports=common(e);const{formatters:gt}=i.exports;gt.j=function(_t){try{return JSON.stringify(_t)}catch(wt){return"[UnexpectedJSONParseError]: "+wt.message}}})(browser$2,browser$2.exports);var browserExports=browser$2.exports;const debug=getDefaultExportFromCjs(browserExports),APP_NAME="waku";let Logger$2=class Io{constructor(e){qt(this,"_info");qt(this,"_warn");qt(this,"_error");this._info=debug(Io.createDebugNamespace("info",e)),this._warn=debug(Io.createDebugNamespace("warn",e)),this._error=debug(Io.createDebugNamespace("error",e))}static createDebugNamespace(e,a){return a?`${APP_NAME}:${e}:${a}`:`${APP_NAME}:${e}`}get info(){return this._info}get warn(){return this._warn}get error(){return this._error}log(e,...a){const c=this[e];c(...a)}};var us,yl;let EventEmitter$2=(yl=class extends EventTarget{constructor(){super(...arguments);gn(this,us,new Map)}listenerCount(a){const c=ur(this,us).get(a);return c==null?0:c.length}addEventListener(a,c,h){super.addEventListener(a,c,h);let d=ur(this,us).get(a);d==null&&(d=[],ur(this,us).set(a,d)),d.push({callback:c,once:(h!==!0&&h!==!1&&(h==null?void 0:h.once))??!1})}removeEventListener(a,c,h){super.removeEventListener(a.toString(),c??null,h);let d=ur(this,us).get(a);d!=null&&(d=d.filter(({callback:et})=>et!==c),ur(this,us).set(a,d))}dispatchEvent(a){const c=super.dispatchEvent(a);let h=ur(this,us).get(a.type);return h==null||(h=h.filter(({once:d})=>!d),ur(this,us).set(a.type,h)),c}safeDispatchEvent(a,c){return this.dispatchEvent(new CustomEvent$1(a,c))}},us=new WeakMap,yl),CustomEventPolyfill$1=class extends Event{constructor(a,c){super(a,c);qt(this,"detail");this.detail=c==null?void 0:c.detail}};const CustomEvent$1=globalThis.CustomEvent??CustomEventPolyfill$1,ERR_INVALID_ID="Invalid record id",MULTIADDR_LENGTH_SIZE=2,__viteBrowserExternal={},__viteBrowserExternal$1=Object.freeze(Object.defineProperty({__proto__:null,default:__viteBrowserExternal},Symbol.toStringTag,{value:"Module"}));/*! noble-secp256k1 - MIT License (c) 2019 Paul Miller (paulmillr.com) */const _0n$2=BigInt(0),_1n$3=BigInt(1),_2n$2=BigInt(2),_3n=BigInt(3),_8n$1=BigInt(8),CURVE=Object.freeze({a:_0n$2,b:BigInt(7),P:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:_1n$3,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee")}),divNearest=(i,e)=>(i+e/_2n$2)/e,endo={beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar(i){const{n:e}=CURVE,a=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),c=-_1n$3*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),h=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),d=a,et=BigInt("0x100000000000000000000000000000000"),ft=divNearest(d*i,e),gt=divNearest(-c*i,e);let _t=mod(i-ft*a-gt*h,e),wt=mod(-ft*c-gt*d,e);const $t=_t>et,It=wt>et;if($t&&(_t=e-_t),It&&(wt=e-wt),_t>et||wt>et)throw new Error("splitScalarEndo: Endomorphism failed, k="+i);return{k1neg:$t,k1:_t,k2neg:It,k2:wt}}},fieldLen=32,groupLen=32,hashLen=32,compressedLen=fieldLen+1,uncompressedLen=2*fieldLen+1;function weierstrass(i){const{a:e,b:a}=CURVE,c=mod(i*i),h=mod(c*i);return mod(h+e*i+a)}const USE_ENDOMORPHISM=CURVE.a===_0n$2;class ShaError extends Error{constructor(e){super(e)}}function assertJacPoint(i){if(!(i instanceof JacobianPoint))throw new TypeError("JacobianPoint expected")}class JacobianPoint{constructor(e,a,c){this.x=e,this.y=a,this.z=c}static fromAffine(e){if(!(e instanceof Point))throw new TypeError("JacobianPoint#fromAffine: expected Point");return e.equals(Point.ZERO)?JacobianPoint.ZERO:new JacobianPoint(e.x,e.y,_1n$3)}static toAffineBatch(e){const a=invertBatch(e.map(c=>c.z));return e.map((c,h)=>c.toAffine(a[h]))}static normalizeZ(e){return JacobianPoint.toAffineBatch(e).map(JacobianPoint.fromAffine)}equals(e){assertJacPoint(e);const{x:a,y:c,z:h}=this,{x:d,y:et,z:ft}=e,gt=mod(h*h),_t=mod(ft*ft),wt=mod(a*_t),$t=mod(d*gt),It=mod(mod(c*ft)*_t),Rt=mod(mod(et*h)*gt);return wt===$t&&It===Rt}negate(){return new JacobianPoint(this.x,mod(-this.y),this.z)}double(){const{x:e,y:a,z:c}=this,h=mod(e*e),d=mod(a*a),et=mod(d*d),ft=e+d,gt=mod(_2n$2*(mod(ft*ft)-h-et)),_t=mod(_3n*h),wt=mod(_t*_t),$t=mod(wt-_2n$2*gt),It=mod(_t*(gt-$t)-_8n$1*et),Rt=mod(_2n$2*a*c);return new JacobianPoint($t,It,Rt)}add(e){assertJacPoint(e);const{x:a,y:c,z:h}=this,{x:d,y:et,z:ft}=e;if(d===_0n$2||et===_0n$2)return this;if(a===_0n$2||c===_0n$2)return e;const gt=mod(h*h),_t=mod(ft*ft),wt=mod(a*_t),$t=mod(d*gt),It=mod(mod(c*ft)*_t),Rt=mod(mod(et*h)*gt),Tt=mod($t-wt),At=mod(Rt-It);if(Tt===_0n$2)return At===_0n$2?this.double():JacobianPoint.ZERO;const kt=mod(Tt*Tt),xt=mod(Tt*kt),Nt=mod(wt*kt),Ft=mod(At*At-xt-_2n$2*Nt),jt=mod(At*(Nt-Ft)-It*xt),Gt=mod(h*ft*Tt);return new JacobianPoint(Ft,jt,Gt)}subtract(e){return this.add(e.negate())}multiplyUnsafe(e){const a=JacobianPoint.ZERO;if(typeof e=="bigint"&&e===_0n$2)return a;let c=normalizeScalar(e);if(c===_1n$3)return this;if(!USE_ENDOMORPHISM){let $t=a,It=this;for(;c>_0n$2;)c&_1n$3&&($t=$t.add(It)),It=It.double(),c>>=_1n$3;return $t}let{k1neg:h,k1:d,k2neg:et,k2:ft}=endo.splitScalar(c),gt=a,_t=a,wt=this;for(;d>_0n$2||ft>_0n$2;)d&_1n$3&&(gt=gt.add(wt)),ft&_1n$3&&(_t=_t.add(wt)),wt=wt.double(),d>>=_1n$3,ft>>=_1n$3;return h&&(gt=gt.negate()),et&&(_t=_t.negate()),_t=new JacobianPoint(mod(_t.x*endo.beta),_t.y,_t.z),gt.add(_t)}precomputeWindow(e){const a=USE_ENDOMORPHISM?128/e+1:256/e+1,c=[];let h=this,d=h;for(let et=0;et<a;et++){d=h,c.push(d);for(let ft=1;ft<2**(e-1);ft++)d=d.add(h),c.push(d);h=d.double()}return c}wNAF(e,a){!a&&this.equals(JacobianPoint.BASE)&&(a=Point.BASE);const c=a&&a._WINDOW_SIZE||1;if(256%c)throw new Error("Point#wNAF: Invalid precomputation window, must be power of 2");let h=a&&pointPrecomputes.get(a);h||(h=this.precomputeWindow(c),a&&c!==1&&(h=JacobianPoint.normalizeZ(h),pointPrecomputes.set(a,h)));let d=JacobianPoint.ZERO,et=JacobianPoint.BASE;const ft=1+(USE_ENDOMORPHISM?128/c:256/c),gt=2**(c-1),_t=BigInt(2**c-1),wt=2**c,$t=BigInt(c);for(let It=0;It<ft;It++){const Rt=It*gt;let Tt=Number(e&_t);e>>=$t,Tt>gt&&(Tt-=wt,e+=_1n$3);const At=Rt,kt=Rt+Math.abs(Tt)-1,xt=It%2!==0,Nt=Tt<0;Tt===0?et=et.add(constTimeNegate(xt,h[At])):d=d.add(constTimeNegate(Nt,h[kt]))}return{p:d,f:et}}multiply(e,a){let c=normalizeScalar(e),h,d;if(USE_ENDOMORPHISM){const{k1neg:et,k1:ft,k2neg:gt,k2:_t}=endo.splitScalar(c);let{p:wt,f:$t}=this.wNAF(ft,a),{p:It,f:Rt}=this.wNAF(_t,a);wt=constTimeNegate(et,wt),It=constTimeNegate(gt,It),It=new JacobianPoint(mod(It.x*endo.beta),It.y,It.z),h=wt.add(It),d=$t.add(Rt)}else{const{p:et,f:ft}=this.wNAF(c,a);h=et,d=ft}return JacobianPoint.normalizeZ([h,d])[0]}toAffine(e){const{x:a,y:c,z:h}=this,d=this.equals(JacobianPoint.ZERO);e==null&&(e=d?_8n$1:invert(h));const et=e,ft=mod(et*et),gt=mod(ft*et),_t=mod(a*ft),wt=mod(c*gt),$t=mod(h*et);if(d)return Point.ZERO;if($t!==_1n$3)throw new Error("invZ was invalid");return new Point(_t,wt)}}JacobianPoint.BASE=new JacobianPoint(CURVE.Gx,CURVE.Gy,_1n$3);JacobianPoint.ZERO=new JacobianPoint(_0n$2,_1n$3,_0n$2);function constTimeNegate(i,e){const a=e.negate();return i?a:e}const pointPrecomputes=new WeakMap;class Point{constructor(e,a){this.x=e,this.y=a}_setWindowSize(e){this._WINDOW_SIZE=e,pointPrecomputes.delete(this)}hasEvenY(){return this.y%_2n$2===_0n$2}static fromCompressedHex(e){const a=e.length===32,c=bytesToNumber(a?e:e.subarray(1));if(!isValidFieldElement(c))throw new Error("Point is not on curve");const h=weierstrass(c);let d=sqrtMod(h);const et=(d&_1n$3)===_1n$3;a?et&&(d=mod(-d)):(e[0]&1)===1!==et&&(d=mod(-d));const ft=new Point(c,d);return ft.assertValidity(),ft}static fromUncompressedHex(e){const a=bytesToNumber(e.subarray(1,fieldLen+1)),c=bytesToNumber(e.subarray(fieldLen+1,fieldLen*2+1)),h=new Point(a,c);return h.assertValidity(),h}static fromHex(e){const a=ensureBytes$1(e),c=a.length,h=a[0];if(c===fieldLen)return this.fromCompressedHex(a);if(c===compressedLen&&(h===2||h===3))return this.fromCompressedHex(a);if(c===uncompressedLen&&h===4)return this.fromUncompressedHex(a);throw new Error(`Point.fromHex: received invalid point. Expected 32-${compressedLen} compressed bytes or ${uncompressedLen} uncompressed bytes, not ${c}`)}static fromPrivateKey(e){return Point.BASE.multiply(normalizePrivateKey(e))}static fromSignature(e,a,c){const{r:h,s:d}=normalizeSignature(a);if(![0,1,2,3].includes(c))throw new Error("Cannot recover: invalid recovery bit");const et=truncateHash(ensureBytes$1(e)),{n:ft}=CURVE,gt=c===2||c===3?h+ft:h,_t=invert(gt,ft),wt=mod(-et*_t,ft),$t=mod(d*_t,ft),It=c&1?"03":"02",Rt=Point.fromHex(It+numTo32bStr(gt)),Tt=Point.BASE.multiplyAndAddUnsafe(Rt,wt,$t);if(!Tt)throw new Error("Cannot recover signature: point at infinify");return Tt.assertValidity(),Tt}toRawBytes(e=!1){return hexToBytes(this.toHex(e))}toHex(e=!1){const a=numTo32bStr(this.x);return e?`${this.hasEvenY()?"02":"03"}${a}`:`04${a}${numTo32bStr(this.y)}`}toHexX(){return this.toHex(!0).slice(2)}toRawX(){return this.toRawBytes(!0).slice(1)}assertValidity(){const e="Point is not on elliptic curve",{x:a,y:c}=this;if(!isValidFieldElement(a)||!isValidFieldElement(c))throw new Error(e);const h=mod(c*c),d=weierstrass(a);if(mod(h-d)!==_0n$2)throw new Error(e)}equals(e){return this.x===e.x&&this.y===e.y}negate(){return new Point(this.x,mod(-this.y))}double(){return JacobianPoint.fromAffine(this).double().toAffine()}add(e){return JacobianPoint.fromAffine(this).add(JacobianPoint.fromAffine(e)).toAffine()}subtract(e){return this.add(e.negate())}multiply(e){return JacobianPoint.fromAffine(this).multiply(e,this).toAffine()}multiplyAndAddUnsafe(e,a,c){const h=JacobianPoint.fromAffine(this),d=a===_0n$2||a===_1n$3||this!==Point.BASE?h.multiplyUnsafe(a):h.multiply(a),et=JacobianPoint.fromAffine(e).multiplyUnsafe(c),ft=d.add(et);return ft.equals(JacobianPoint.ZERO)?void 0:ft.toAffine()}}Point.BASE=new Point(CURVE.Gx,CURVE.Gy);Point.ZERO=new Point(_0n$2,_0n$2);function sliceDER(i){return Number.parseInt(i[0],16)>=8?"00"+i:i}function parseDERInt(i){if(i.length<2||i[0]!==2)throw new Error(`Invalid signature integer tag: ${bytesToHex(i)}`);const e=i[1],a=i.subarray(2,e+2);if(!e||a.length!==e)throw new Error("Invalid signature integer: wrong length");if(a[0]===0&&a[1]<=127)throw new Error("Invalid signature integer: trailing length");return{data:bytesToNumber(a),left:i.subarray(e+2)}}function parseDERSignature(i){if(i.length<2||i[0]!=48)throw new Error(`Invalid signature tag: ${bytesToHex(i)}`);if(i[1]!==i.length-2)throw new Error("Invalid signature: incorrect length");const{data:e,left:a}=parseDERInt(i.subarray(2)),{data:c,left:h}=parseDERInt(a);if(h.length)throw new Error(`Invalid signature: left bytes after parsing: ${bytesToHex(h)}`);return{r:e,s:c}}class Signature{constructor(e,a){this.r=e,this.s=a,this.assertValidity()}static fromCompact(e){const a=e instanceof Uint8Array,c="Signature.fromCompact";if(typeof e!="string"&&!a)throw new TypeError(`${c}: Expected string or Uint8Array`);const h=a?bytesToHex(e):e;if(h.length!==128)throw new Error(`${c}: Expected 64-byte hex`);return new Signature(hexToNumber(h.slice(0,64)),hexToNumber(h.slice(64,128)))}static fromDER(e){const a=e instanceof Uint8Array;if(typeof e!="string"&&!a)throw new TypeError("Signature.fromDER: Expected string or Uint8Array");const{r:c,s:h}=parseDERSignature(a?e:hexToBytes(e));return new Signature(c,h)}static fromHex(e){return this.fromDER(e)}assertValidity(){const{r:e,s:a}=this;if(!isWithinCurveOrder(e))throw new Error("Invalid Signature: r must be 0 < r < n");if(!isWithinCurveOrder(a))throw new Error("Invalid Signature: s must be 0 < s < n")}hasHighS(){const e=CURVE.n>>_1n$3;return this.s>e}normalizeS(){return this.hasHighS()?new Signature(this.r,mod(-this.s,CURVE.n)):this}toDERRawBytes(){return hexToBytes(this.toDERHex())}toDERHex(){const e=sliceDER(numberToHexUnpadded(this.s)),a=sliceDER(numberToHexUnpadded(this.r)),c=e.length/2,h=a.length/2,d=numberToHexUnpadded(c),et=numberToHexUnpadded(h);return`30${numberToHexUnpadded(h+c+4)}02${et}${a}02${d}${e}`}toRawBytes(){return this.toDERRawBytes()}toHex(){return this.toDERHex()}toCompactRawBytes(){return hexToBytes(this.toCompactHex())}toCompactHex(){return numTo32bStr(this.r)+numTo32bStr(this.s)}}function concatBytes(...i){if(!i.every(c=>c instanceof Uint8Array))throw new Error("Uint8Array list expected");if(i.length===1)return i[0];const e=i.reduce((c,h)=>c+h.length,0),a=new Uint8Array(e);for(let c=0,h=0;c<i.length;c++){const d=i[c];a.set(d,h),h+=d.length}return a}const hexes=Array.from({length:256},(i,e)=>e.toString(16).padStart(2,"0"));function bytesToHex(i){if(!(i instanceof Uint8Array))throw new Error("Expected Uint8Array");let e="";for(let a=0;a<i.length;a++)e+=hexes[i[a]];return e}const POW_2_256=BigInt("0x10000000000000000000000000000000000000000000000000000000000000000");function numTo32bStr(i){if(typeof i!="bigint")throw new Error("Expected bigint");if(!(_0n$2<=i&&i<POW_2_256))throw new Error("Expected number 0 <= n < 2^256");return i.toString(16).padStart(64,"0")}function numTo32b(i){const e=hexToBytes(numTo32bStr(i));if(e.length!==32)throw new Error("Error: expected 32 bytes");return e}function numberToHexUnpadded(i){const e=i.toString(16);return e.length&1?`0${e}`:e}function hexToNumber(i){if(typeof i!="string")throw new TypeError("hexToNumber: expected string, got "+typeof i);return BigInt(`0x${i}`)}function hexToBytes(i){if(typeof i!="string")throw new TypeError("hexToBytes: expected string, got "+typeof i);if(i.length%2)throw new Error("hexToBytes: received invalid unpadded hex"+i.length);const e=new Uint8Array(i.length/2);for(let a=0;a<e.length;a++){const c=a*2,h=i.slice(c,c+2),d=Number.parseInt(h,16);if(Number.isNaN(d)||d<0)throw new Error("Invalid byte sequence");e[a]=d}return e}function bytesToNumber(i){return hexToNumber(bytesToHex(i))}function ensureBytes$1(i){return i instanceof Uint8Array?Uint8Array.from(i):hexToBytes(i)}function normalizeScalar(i){if(typeof i=="number"&&Number.isSafeInteger(i)&&i>0)return BigInt(i);if(typeof i=="bigint"&&isWithinCurveOrder(i))return i;throw new TypeError("Expected valid private scalar: 0 < scalar < curve.n")}function mod(i,e=CURVE.P){const a=i%e;return a>=_0n$2?a:e+a}function pow2(i,e){const{P:a}=CURVE;let c=i;for(;e-- >_0n$2;)c*=c,c%=a;return c}function sqrtMod(i){const{P:e}=CURVE,a=BigInt(6),c=BigInt(11),h=BigInt(22),d=BigInt(23),et=BigInt(44),ft=BigInt(88),gt=i*i*i%e,_t=gt*gt*i%e,wt=pow2(_t,_3n)*_t%e,$t=pow2(wt,_3n)*_t%e,It=pow2($t,_2n$2)*gt%e,Rt=pow2(It,c)*It%e,Tt=pow2(Rt,h)*Rt%e,At=pow2(Tt,et)*Tt%e,kt=pow2(At,ft)*At%e,xt=pow2(kt,et)*Tt%e,Nt=pow2(xt,_3n)*_t%e,Ft=pow2(Nt,d)*Rt%e,jt=pow2(Ft,a)*gt%e,Gt=pow2(jt,_2n$2);if(Gt*Gt%e!==i)throw new Error("Cannot find square root");return Gt}function invert(i,e=CURVE.P){if(i===_0n$2||e<=_0n$2)throw new Error(`invert: expected positive integers, got n=${i} mod=${e}`);let a=mod(i,e),c=e,h=_0n$2,d=_1n$3;for(;a!==_0n$2;){const ft=c/a,gt=c%a,_t=h-d*ft;c=a,a=gt,h=d,d=_t}if(c!==_1n$3)throw new Error("invert: does not exist");return mod(h,e)}function invertBatch(i,e=CURVE.P){const a=new Array(i.length),c=i.reduce((d,et,ft)=>et===_0n$2?d:(a[ft]=d,mod(d*et,e)),_1n$3),h=invert(c,e);return i.reduceRight((d,et,ft)=>et===_0n$2?d:(a[ft]=mod(d*a[ft],e),mod(d*et,e)),h),a}function bits2int_2(i){const e=i.length*8-groupLen*8,a=bytesToNumber(i);return e>0?a>>BigInt(e):a}function truncateHash(i,e=!1){const a=bits2int_2(i);if(e)return a;const{n:c}=CURVE;return a>=c?a-c:a}let _sha256Sync,_hmacSha256Sync;class HmacDrbg{constructor(e,a){if(this.hashLen=e,this.qByteLen=a,typeof e!="number"||e<2)throw new Error("hashLen must be a number");if(typeof a!="number"||a<2)throw new Error("qByteLen must be a number");this.v=new Uint8Array(e).fill(1),this.k=new Uint8Array(e).fill(0),this.counter=0}hmac(...e){return utils.hmacSha256(this.k,...e)}hmacSync(...e){return _hmacSha256Sync(this.k,...e)}checkSync(){if(typeof _hmacSha256Sync!="function")throw new ShaError("hmacSha256Sync needs to be set")}incr(){if(this.counter>=1e3)throw new Error("Tried 1,000 k values for sign(), all were invalid");this.counter+=1}async reseed(e=new Uint8Array){this.k=await this.hmac(this.v,Uint8Array.from([0]),e),this.v=await this.hmac(this.v),e.length!==0&&(this.k=await this.hmac(this.v,Uint8Array.from([1]),e),this.v=await this.hmac(this.v))}reseedSync(e=new Uint8Array){this.checkSync(),this.k=this.hmacSync(this.v,Uint8Array.from([0]),e),this.v=this.hmacSync(this.v),e.length!==0&&(this.k=this.hmacSync(this.v,Uint8Array.from([1]),e),this.v=this.hmacSync(this.v))}async generate(){this.incr();let e=0;const a=[];for(;e<this.qByteLen;){this.v=await this.hmac(this.v);const c=this.v.slice();a.push(c),e+=this.v.length}return concatBytes(...a)}generateSync(){this.checkSync(),this.incr();let e=0;const a=[];for(;e<this.qByteLen;){this.v=this.hmacSync(this.v);const c=this.v.slice();a.push(c),e+=this.v.length}return concatBytes(...a)}}function isWithinCurveOrder(i){return _0n$2<i&&i<CURVE.n}function isValidFieldElement(i){return _0n$2<i&&i<CURVE.P}function kmdToSig(i,e,a,c=!0){const{n:h}=CURVE,d=truncateHash(i,!0);if(!isWithinCurveOrder(d))return;const et=invert(d,h),ft=Point.BASE.multiply(d),gt=mod(ft.x,h);if(gt===_0n$2)return;const _t=mod(et*mod(e+a*gt,h),h);if(_t===_0n$2)return;let wt=new Signature(gt,_t),$t=(ft.x===wt.r?0:2)|Number(ft.y&_1n$3);return c&&wt.hasHighS()&&(wt=wt.normalizeS(),$t^=1),{sig:wt,recovery:$t}}function normalizePrivateKey(i){let e;if(typeof i=="bigint")e=i;else if(typeof i=="number"&&Number.isSafeInteger(i)&&i>0)e=BigInt(i);else if(typeof i=="string"){if(i.length!==2*groupLen)throw new Error("Expected 32 bytes of private key");e=hexToNumber(i)}else if(i instanceof Uint8Array){if(i.length!==groupLen)throw new Error("Expected 32 bytes of private key");e=bytesToNumber(i)}else throw new TypeError("Expected valid private key");if(!isWithinCurveOrder(e))throw new Error("Expected private key: 0 < key < n");return e}function normalizePublicKey(i){return i instanceof Point?(i.assertValidity(),i):Point.fromHex(i)}function normalizeSignature(i){if(i instanceof Signature)return i.assertValidity(),i;try{return Signature.fromDER(i)}catch{return Signature.fromCompact(i)}}function bits2int(i){const e=i.length>fieldLen?i.slice(0,fieldLen):i;return bytesToNumber(e)}function bits2octets(i){const e=bits2int(i),a=mod(e,CURVE.n);return int2octets(a<_0n$2?e:a)}function int2octets(i){return numTo32b(i)}function initSigArgs(i,e,a){if(i==null)throw new Error(`sign: expected valid message hash, not "${i}"`);const c=ensureBytes$1(i),h=normalizePrivateKey(e),d=[int2octets(h),bits2octets(c)];if(a!=null){a===!0&&(a=utils.randomBytes(fieldLen));const gt=ensureBytes$1(a);if(gt.length!==fieldLen)throw new Error(`sign: Expected ${fieldLen} bytes of extra data`);d.push(gt)}const et=concatBytes(...d),ft=bits2int(c);return{seed:et,m:ft,d:h}}function finalizeSig(i,e){const{sig:a,recovery:c}=i,{der:h,recovered:d}=Object.assign({canonical:!0,der:!0},e),et=h?a.toDERRawBytes():a.toCompactRawBytes();return d?[et,c]:et}async function sign$1(i,e,a={}){const{seed:c,m:h,d}=initSigArgs(i,e,a.extraEntropy),et=new HmacDrbg(hashLen,groupLen);await et.reseed(c);let ft;for(;!(ft=kmdToSig(await et.generate(),h,d,a.canonical));)await et.reseed();return finalizeSig(ft,a)}const vopts={strict:!0};function verify(i,e,a,c=vopts){let h;try{h=normalizeSignature(i),e=ensureBytes$1(e)}catch{return!1}const{r:d,s:et}=h;if(c.strict&&h.hasHighS())return!1;const ft=truncateHash(e);let gt;try{gt=normalizePublicKey(a)}catch{return!1}const{n:_t}=CURVE,wt=invert(et,_t),$t=mod(ft*wt,_t),It=mod(d*wt,_t),Rt=Point.BASE.multiplyAndAddUnsafe(gt,$t,It);return Rt?mod(Rt.x,_t)===d:!1}Point.BASE._setWindowSize(8);const crypto$3={node:__viteBrowserExternal$1,web:typeof self=="object"&&"crypto"in self?self.crypto:void 0},TAGGED_HASH_PREFIXES={},utils={bytesToHex,hexToBytes,concatBytes,mod,invert,isValidPrivateKey(i){try{return normalizePrivateKey(i),!0}catch{return!1}},_bigintTo32Bytes:numTo32b,_normalizePrivateKey:normalizePrivateKey,hashToPrivateKey:i=>{i=ensureBytes$1(i);const e=groupLen+8;if(i.length<e||i.length>1024)throw new Error("Expected valid bytes of private key as per FIPS 186");const a=mod(bytesToNumber(i),CURVE.n-_1n$3)+_1n$3;return numTo32b(a)},randomBytes:(i=32)=>{if(crypto$3.web)return crypto$3.web.getRandomValues(new Uint8Array(i));if(crypto$3.node){const{randomBytes:e}=crypto$3.node;return Uint8Array.from(e(i))}else throw new Error("The environment doesn't have randomBytes function")},randomPrivateKey:()=>utils.hashToPrivateKey(utils.randomBytes(groupLen+8)),precompute(i=8,e=Point.BASE){const a=e===Point.BASE?e:new Point(e.x,e.y);return a._setWindowSize(i),a.multiply(_3n),a},sha256:async(...i)=>{if(crypto$3.web){const e=await crypto$3.web.subtle.digest("SHA-256",concatBytes(...i));return new Uint8Array(e)}else if(crypto$3.node){const{createHash:e}=crypto$3.node,a=e("sha256");return i.forEach(c=>a.update(c)),Uint8Array.from(a.digest())}else throw new Error("The environment doesn't have sha256 function")},hmacSha256:async(i,...e)=>{if(crypto$3.web){const a=await crypto$3.web.subtle.importKey("raw",i,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),c=concatBytes(...e),h=await crypto$3.web.subtle.sign("HMAC",a,c);return new Uint8Array(h)}else if(crypto$3.node){const{createHmac:a}=crypto$3.node,c=a("sha256",i);return e.forEach(h=>c.update(h)),Uint8Array.from(c.digest())}else throw new Error("The environment doesn't have hmac-sha256 function")},sha256Sync:void 0,hmacSha256Sync:void 0,taggedHash:async(i,...e)=>{let a=TAGGED_HASH_PREFIXES[i];if(a===void 0){const c=await utils.sha256(Uint8Array.from(i,h=>h.charCodeAt(0)));a=concatBytes(c,c),TAGGED_HASH_PREFIXES[i]=a}return utils.sha256(a,...e)},taggedHashSync:(i,...e)=>{if(typeof _sha256Sync!="function")throw new ShaError("sha256Sync is undefined, you need to set it");let a=TAGGED_HASH_PREFIXES[i];if(a===void 0){const c=_sha256Sync(Uint8Array.from(i,h=>h.charCodeAt(0)));a=concatBytes(c,c),TAGGED_HASH_PREFIXES[i]=a}return _sha256Sync(a,...e)},_JacobianPoint:JacobianPoint};Object.defineProperties(utils,{sha256Sync:{configurable:!1,get(){return _sha256Sync},set(i){_sha256Sync||(_sha256Sync=i)}},hmacSha256Sync:{configurable:!1,get(){return _hmacSha256Sync},set(i){_hmacSha256Sync||(_hmacSha256Sync=i)}}});var sha3$1={exports:{}};/**
 * [js-sha3]{@link https://github.com/emn178/js-sha3}
 *
 * @version 0.9.3
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2015-2023
 * @license MIT
 */(function(i){(function(){var e="input is invalid type",a="finalize already called",c=typeof window=="object",h=c?window:{};h.JS_SHA3_NO_WINDOW&&(c=!1);var d=!c&&typeof self=="object",et=!h.JS_SHA3_NO_NODE_JS&&typeof process=="object"&&process.versions&&process.versions.node;et?h=commonjsGlobal:d&&(h=self);for(var ft=!h.JS_SHA3_NO_COMMON_JS&&!0&&i.exports,gt=!h.JS_SHA3_NO_ARRAY_BUFFER&&typeof ArrayBuffer<"u",_t="0123456789abcdef".split(""),wt=[31,7936,2031616,520093696],$t=[4,1024,262144,67108864],It=[1,256,65536,16777216],Rt=[6,1536,393216,100663296],Tt=[0,8,16,24],At=[1,0,32898,0,32906,2147483648,2147516416,2147483648,32907,0,2147483649,0,2147516545,2147483648,32777,2147483648,138,0,136,0,2147516425,0,2147483658,0,2147516555,0,139,2147483648,32905,2147483648,32771,2147483648,32770,2147483648,128,2147483648,32778,0,2147483658,2147483648,2147516545,2147483648,32896,2147483648,2147483649,0,2147516424,2147483648],kt=[224,256,384,512],xt=[128,256],Nt=["hex","buffer","arrayBuffer","array","digest"],Ft={128:168,256:136},jt=h.JS_SHA3_NO_NODE_JS||!Array.isArray?function(lr){return Object.prototype.toString.call(lr)==="[object Array]"}:Array.isArray,Gt=gt&&(h.JS_SHA3_NO_ARRAY_BUFFER_IS_VIEW||!ArrayBuffer.isView)?function(lr){return typeof lr=="object"&&lr.buffer&&lr.buffer.constructor===ArrayBuffer}:ArrayBuffer.isView,Kt=function(lr){var Cr=typeof lr;if(Cr==="string")return[lr,!0];if(Cr!=="object"||lr===null)throw new Error(e);if(gt&&lr.constructor===ArrayBuffer)return[new Uint8Array(lr),!1];if(!jt(lr)&&!Gt(lr))throw new Error(e);return[lr,!1]},Wt=function(lr){return Kt(lr)[0].length===0},Zt=function(lr){for(var Cr=[],xr=0;xr<lr.length;++xr)Cr[xr]=lr[xr];return Cr},cr=function(lr,Cr,xr){return function(Kr){return new br(lr,Cr,lr).update(Kr)[xr]()}},hr=function(lr,Cr,xr){return function(Kr,Gr){return new br(lr,Cr,Gr).update(Kr)[xr]()}},gr=function(lr,Cr,xr){return function(Kr,Gr,vr,Nr){return yr["cshake"+lr].update(Kr,Gr,vr,Nr)[xr]()}},er=function(lr,Cr,xr){return function(Kr,Gr,vr,Nr){return yr["kmac"+lr].update(Kr,Gr,vr,Nr)[xr]()}},mr=function(lr,Cr,xr,Kr){for(var Gr=0;Gr<Nt.length;++Gr){var vr=Nt[Gr];lr[vr]=Cr(xr,Kr,vr)}return lr},Mr=function(lr,Cr){var xr=cr(lr,Cr,"hex");return xr.create=function(){return new br(lr,Cr,lr)},xr.update=function(Kr){return xr.create().update(Kr)},mr(xr,cr,lr,Cr)},wr=function(lr,Cr){var xr=hr(lr,Cr,"hex");return xr.create=function(Kr){return new br(lr,Cr,Kr)},xr.update=function(Kr,Gr){return xr.create(Gr).update(Kr)},mr(xr,hr,lr,Cr)},Dr=function(lr,Cr){var xr=Ft[lr],Kr=gr(lr,Cr,"hex");return Kr.create=function(Gr,vr,Nr){return Wt(vr)&&Wt(Nr)?yr["shake"+lr].create(Gr):new br(lr,Cr,Gr).bytepad([vr,Nr],xr)},Kr.update=function(Gr,vr,Nr,Pr){return Kr.create(vr,Nr,Pr).update(Gr)},mr(Kr,gr,lr,Cr)},Tr=function(lr,Cr){var xr=Ft[lr],Kr=er(lr,Cr,"hex");return Kr.create=function(Gr,vr,Nr){return new _r(lr,Cr,vr).bytepad(["KMAC",Nr],xr).bytepad([Gr],xr)},Kr.update=function(Gr,vr,Nr,Pr){return Kr.create(Gr,Nr,Pr).update(vr)},mr(Kr,er,lr,Cr)},fr=[{name:"keccak",padding:It,bits:kt,createMethod:Mr},{name:"sha3",padding:Rt,bits:kt,createMethod:Mr},{name:"shake",padding:wt,bits:xt,createMethod:wr},{name:"cshake",padding:$t,bits:xt,createMethod:Dr},{name:"kmac",padding:$t,bits:xt,createMethod:Tr}],yr={},$r=[],Fr=0;Fr<fr.length;++Fr)for(var dr=fr[Fr],Br=dr.bits,Hr=0;Hr<Br.length;++Hr){var Jr=dr.name+"_"+Br[Hr];if($r.push(Jr),yr[Jr]=dr.createMethod(Br[Hr],dr.padding),dr.name!=="sha3"){var zr=dr.name+Br[Hr];$r.push(zr),yr[zr]=yr[Jr]}}function br(lr,Cr,xr){this.blocks=[],this.s=[],this.padding=Cr,this.outputBits=xr,this.reset=!0,this.finalized=!1,this.block=0,this.start=0,this.blockCount=1600-(lr<<1)>>5,this.byteCount=this.blockCount<<2,this.outputBlocks=xr>>5,this.extraBytes=(xr&31)>>3;for(var Kr=0;Kr<50;++Kr)this.s[Kr]=0}br.prototype.update=function(lr){if(this.finalized)throw new Error(a);var Cr=Kt(lr);lr=Cr[0];for(var xr=Cr[1],Kr=this.blocks,Gr=this.byteCount,vr=lr.length,Nr=this.blockCount,Pr=0,en=this.s,Wr,Or;Pr<vr;){if(this.reset)for(this.reset=!1,Kr[0]=this.block,Wr=1;Wr<Nr+1;++Wr)Kr[Wr]=0;if(xr)for(Wr=this.start;Pr<vr&&Wr<Gr;++Pr)Or=lr.charCodeAt(Pr),Or<128?Kr[Wr>>2]|=Or<<Tt[Wr++&3]:Or<2048?(Kr[Wr>>2]|=(192|Or>>6)<<Tt[Wr++&3],Kr[Wr>>2]|=(128|Or&63)<<Tt[Wr++&3]):Or<55296||Or>=57344?(Kr[Wr>>2]|=(224|Or>>12)<<Tt[Wr++&3],Kr[Wr>>2]|=(128|Or>>6&63)<<Tt[Wr++&3],Kr[Wr>>2]|=(128|Or&63)<<Tt[Wr++&3]):(Or=65536+((Or&1023)<<10|lr.charCodeAt(++Pr)&1023),Kr[Wr>>2]|=(240|Or>>18)<<Tt[Wr++&3],Kr[Wr>>2]|=(128|Or>>12&63)<<Tt[Wr++&3],Kr[Wr>>2]|=(128|Or>>6&63)<<Tt[Wr++&3],Kr[Wr>>2]|=(128|Or&63)<<Tt[Wr++&3]);else for(Wr=this.start;Pr<vr&&Wr<Gr;++Pr)Kr[Wr>>2]|=lr[Pr]<<Tt[Wr++&3];if(this.lastByteIndex=Wr,Wr>=Gr){for(this.start=Wr-Gr,this.block=Kr[Nr],Wr=0;Wr<Nr;++Wr)en[Wr]^=Kr[Wr];Vr(en),this.reset=!0}else this.start=Wr}return this},br.prototype.encode=function(lr,Cr){var xr=lr&255,Kr=1,Gr=[xr];for(lr=lr>>8,xr=lr&255;xr>0;)Gr.unshift(xr),lr=lr>>8,xr=lr&255,++Kr;return Cr?Gr.push(Kr):Gr.unshift(Kr),this.update(Gr),Gr.length},br.prototype.encodeString=function(lr){var Cr=Kt(lr);lr=Cr[0];var xr=Cr[1],Kr=0,Gr=lr.length;if(xr)for(var vr=0;vr<lr.length;++vr){var Nr=lr.charCodeAt(vr);Nr<128?Kr+=1:Nr<2048?Kr+=2:Nr<55296||Nr>=57344?Kr+=3:(Nr=65536+((Nr&1023)<<10|lr.charCodeAt(++vr)&1023),Kr+=4)}else Kr=Gr;return Kr+=this.encode(Kr*8),this.update(lr),Kr},br.prototype.bytepad=function(lr,Cr){for(var xr=this.encode(Cr),Kr=0;Kr<lr.length;++Kr)xr+=this.encodeString(lr[Kr]);var Gr=(Cr-xr%Cr)%Cr,vr=[];return vr.length=Gr,this.update(vr),this},br.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var lr=this.blocks,Cr=this.lastByteIndex,xr=this.blockCount,Kr=this.s;if(lr[Cr>>2]|=this.padding[Cr&3],this.lastByteIndex===this.byteCount)for(lr[0]=lr[xr],Cr=1;Cr<xr+1;++Cr)lr[Cr]=0;for(lr[xr-1]|=2147483648,Cr=0;Cr<xr;++Cr)Kr[Cr]^=lr[Cr];Vr(Kr)}},br.prototype.toString=br.prototype.hex=function(){this.finalize();for(var lr=this.blockCount,Cr=this.s,xr=this.outputBlocks,Kr=this.extraBytes,Gr=0,vr=0,Nr="",Pr;vr<xr;){for(Gr=0;Gr<lr&&vr<xr;++Gr,++vr)Pr=Cr[Gr],Nr+=_t[Pr>>4&15]+_t[Pr&15]+_t[Pr>>12&15]+_t[Pr>>8&15]+_t[Pr>>20&15]+_t[Pr>>16&15]+_t[Pr>>28&15]+_t[Pr>>24&15];vr%lr===0&&(Cr=Zt(Cr),Vr(Cr),Gr=0)}return Kr&&(Pr=Cr[Gr],Nr+=_t[Pr>>4&15]+_t[Pr&15],Kr>1&&(Nr+=_t[Pr>>12&15]+_t[Pr>>8&15]),Kr>2&&(Nr+=_t[Pr>>20&15]+_t[Pr>>16&15])),Nr},br.prototype.arrayBuffer=function(){this.finalize();var lr=this.blockCount,Cr=this.s,xr=this.outputBlocks,Kr=this.extraBytes,Gr=0,vr=0,Nr=this.outputBits>>3,Pr;Kr?Pr=new ArrayBuffer(xr+1<<2):Pr=new ArrayBuffer(Nr);for(var en=new Uint32Array(Pr);vr<xr;){for(Gr=0;Gr<lr&&vr<xr;++Gr,++vr)en[vr]=Cr[Gr];vr%lr===0&&(Cr=Zt(Cr),Vr(Cr))}return Kr&&(en[vr]=Cr[Gr],Pr=Pr.slice(0,Nr)),Pr},br.prototype.buffer=br.prototype.arrayBuffer,br.prototype.digest=br.prototype.array=function(){this.finalize();for(var lr=this.blockCount,Cr=this.s,xr=this.outputBlocks,Kr=this.extraBytes,Gr=0,vr=0,Nr=[],Pr,en;vr<xr;){for(Gr=0;Gr<lr&&vr<xr;++Gr,++vr)Pr=vr<<2,en=Cr[Gr],Nr[Pr]=en&255,Nr[Pr+1]=en>>8&255,Nr[Pr+2]=en>>16&255,Nr[Pr+3]=en>>24&255;vr%lr===0&&(Cr=Zt(Cr),Vr(Cr))}return Kr&&(Pr=vr<<2,en=Cr[Gr],Nr[Pr]=en&255,Kr>1&&(Nr[Pr+1]=en>>8&255),Kr>2&&(Nr[Pr+2]=en>>16&255)),Nr};function _r(lr,Cr,xr){br.call(this,lr,Cr,xr)}_r.prototype=new br,_r.prototype.finalize=function(){return this.encode(this.outputBits,!0),br.prototype.finalize.call(this)};var Vr=function(lr){var Cr,xr,Kr,Gr,vr,Nr,Pr,en,Wr,Or,Xr,hn,pn,vn,Tn,Ht,Vt,Xt,Er,Sr,pr,Rr,Qr,nn,rn,fn,bn,In,On,Vn,xn,jn,jr,qr,Zr,dn,cn,Sn,$n,En,wn,Cn,Nn,Rn,Pn,Un,Wn,Bn,ts,Is,rs,Jn,Zn,Ts,cs,Cs,is,bs,An,kn,Hn,vs,Ls;for(Kr=0;Kr<48;Kr+=2)Gr=lr[0]^lr[10]^lr[20]^lr[30]^lr[40],vr=lr[1]^lr[11]^lr[21]^lr[31]^lr[41],Nr=lr[2]^lr[12]^lr[22]^lr[32]^lr[42],Pr=lr[3]^lr[13]^lr[23]^lr[33]^lr[43],en=lr[4]^lr[14]^lr[24]^lr[34]^lr[44],Wr=lr[5]^lr[15]^lr[25]^lr[35]^lr[45],Or=lr[6]^lr[16]^lr[26]^lr[36]^lr[46],Xr=lr[7]^lr[17]^lr[27]^lr[37]^lr[47],hn=lr[8]^lr[18]^lr[28]^lr[38]^lr[48],pn=lr[9]^lr[19]^lr[29]^lr[39]^lr[49],Cr=hn^(Nr<<1|Pr>>>31),xr=pn^(Pr<<1|Nr>>>31),lr[0]^=Cr,lr[1]^=xr,lr[10]^=Cr,lr[11]^=xr,lr[20]^=Cr,lr[21]^=xr,lr[30]^=Cr,lr[31]^=xr,lr[40]^=Cr,lr[41]^=xr,Cr=Gr^(en<<1|Wr>>>31),xr=vr^(Wr<<1|en>>>31),lr[2]^=Cr,lr[3]^=xr,lr[12]^=Cr,lr[13]^=xr,lr[22]^=Cr,lr[23]^=xr,lr[32]^=Cr,lr[33]^=xr,lr[42]^=Cr,lr[43]^=xr,Cr=Nr^(Or<<1|Xr>>>31),xr=Pr^(Xr<<1|Or>>>31),lr[4]^=Cr,lr[5]^=xr,lr[14]^=Cr,lr[15]^=xr,lr[24]^=Cr,lr[25]^=xr,lr[34]^=Cr,lr[35]^=xr,lr[44]^=Cr,lr[45]^=xr,Cr=en^(hn<<1|pn>>>31),xr=Wr^(pn<<1|hn>>>31),lr[6]^=Cr,lr[7]^=xr,lr[16]^=Cr,lr[17]^=xr,lr[26]^=Cr,lr[27]^=xr,lr[36]^=Cr,lr[37]^=xr,lr[46]^=Cr,lr[47]^=xr,Cr=Or^(Gr<<1|vr>>>31),xr=Xr^(vr<<1|Gr>>>31),lr[8]^=Cr,lr[9]^=xr,lr[18]^=Cr,lr[19]^=xr,lr[28]^=Cr,lr[29]^=xr,lr[38]^=Cr,lr[39]^=xr,lr[48]^=Cr,lr[49]^=xr,vn=lr[0],Tn=lr[1],Un=lr[11]<<4|lr[10]>>>28,Wn=lr[10]<<4|lr[11]>>>28,In=lr[20]<<3|lr[21]>>>29,On=lr[21]<<3|lr[20]>>>29,kn=lr[31]<<9|lr[30]>>>23,Hn=lr[30]<<9|lr[31]>>>23,Cn=lr[40]<<18|lr[41]>>>14,Nn=lr[41]<<18|lr[40]>>>14,qr=lr[2]<<1|lr[3]>>>31,Zr=lr[3]<<1|lr[2]>>>31,Ht=lr[13]<<12|lr[12]>>>20,Vt=lr[12]<<12|lr[13]>>>20,Bn=lr[22]<<10|lr[23]>>>22,ts=lr[23]<<10|lr[22]>>>22,Vn=lr[33]<<13|lr[32]>>>19,xn=lr[32]<<13|lr[33]>>>19,vs=lr[42]<<2|lr[43]>>>30,Ls=lr[43]<<2|lr[42]>>>30,Ts=lr[5]<<30|lr[4]>>>2,cs=lr[4]<<30|lr[5]>>>2,dn=lr[14]<<6|lr[15]>>>26,cn=lr[15]<<6|lr[14]>>>26,Xt=lr[25]<<11|lr[24]>>>21,Er=lr[24]<<11|lr[25]>>>21,Is=lr[34]<<15|lr[35]>>>17,rs=lr[35]<<15|lr[34]>>>17,jn=lr[45]<<29|lr[44]>>>3,jr=lr[44]<<29|lr[45]>>>3,nn=lr[6]<<28|lr[7]>>>4,rn=lr[7]<<28|lr[6]>>>4,Cs=lr[17]<<23|lr[16]>>>9,is=lr[16]<<23|lr[17]>>>9,Sn=lr[26]<<25|lr[27]>>>7,$n=lr[27]<<25|lr[26]>>>7,Sr=lr[36]<<21|lr[37]>>>11,pr=lr[37]<<21|lr[36]>>>11,Jn=lr[47]<<24|lr[46]>>>8,Zn=lr[46]<<24|lr[47]>>>8,Rn=lr[8]<<27|lr[9]>>>5,Pn=lr[9]<<27|lr[8]>>>5,fn=lr[18]<<20|lr[19]>>>12,bn=lr[19]<<20|lr[18]>>>12,bs=lr[29]<<7|lr[28]>>>25,An=lr[28]<<7|lr[29]>>>25,En=lr[38]<<8|lr[39]>>>24,wn=lr[39]<<8|lr[38]>>>24,Rr=lr[48]<<14|lr[49]>>>18,Qr=lr[49]<<14|lr[48]>>>18,lr[0]=vn^~Ht&Xt,lr[1]=Tn^~Vt&Er,lr[10]=nn^~fn&In,lr[11]=rn^~bn&On,lr[20]=qr^~dn&Sn,lr[21]=Zr^~cn&$n,lr[30]=Rn^~Un&Bn,lr[31]=Pn^~Wn&ts,lr[40]=Ts^~Cs&bs,lr[41]=cs^~is&An,lr[2]=Ht^~Xt&Sr,lr[3]=Vt^~Er&pr,lr[12]=fn^~In&Vn,lr[13]=bn^~On&xn,lr[22]=dn^~Sn&En,lr[23]=cn^~$n&wn,lr[32]=Un^~Bn&Is,lr[33]=Wn^~ts&rs,lr[42]=Cs^~bs&kn,lr[43]=is^~An&Hn,lr[4]=Xt^~Sr&Rr,lr[5]=Er^~pr&Qr,lr[14]=In^~Vn&jn,lr[15]=On^~xn&jr,lr[24]=Sn^~En&Cn,lr[25]=$n^~wn&Nn,lr[34]=Bn^~Is&Jn,lr[35]=ts^~rs&Zn,lr[44]=bs^~kn&vs,lr[45]=An^~Hn&Ls,lr[6]=Sr^~Rr&vn,lr[7]=pr^~Qr&Tn,lr[16]=Vn^~jn&nn,lr[17]=xn^~jr&rn,lr[26]=En^~Cn&qr,lr[27]=wn^~Nn&Zr,lr[36]=Is^~Jn&Rn,lr[37]=rs^~Zn&Pn,lr[46]=kn^~vs&Ts,lr[47]=Hn^~Ls&cs,lr[8]=Rr^~vn&Ht,lr[9]=Qr^~Tn&Vt,lr[18]=jn^~nn&fn,lr[19]=jr^~rn&bn,lr[28]=Cn^~qr&dn,lr[29]=Nn^~Zr&cn,lr[38]=Jn^~Rn&Un,lr[39]=Zn^~Pn&Wn,lr[48]=vs^~Ts&Cs,lr[49]=Ls^~cs&is,lr[0]^=At[Kr],lr[1]^=At[Kr+1]};if(ft)i.exports=yr;else for(Fr=0;Fr<$r.length;++Fr)h[$r[Fr]]=yr[$r[Fr]]})()})(sha3$1);var sha3Exports=sha3$1.exports;const sha3=getDefaultExportFromCjs(sha3Exports);function keccak256(i){return new Uint8Array(sha3.keccak256.arrayBuffer(i))}function verifySignature(i,e,a){try{const c=Signature.fromCompact(i.slice(0,64));return verify(c,e,a)}catch{return!1}}function multiaddrFromFields(i,e,a,c){let h=multiaddr("/"+i+"/"+convertToString(i,a));return h=h.encapsulate(multiaddr("/"+e+"/"+convertToString(e,c))),h}function locationMultiaddrFromEnrFields(i,e){switch(e){case"udp":return locationMultiaddrFromEnrFields(i,"udp4")||locationMultiaddrFromEnrFields(i,"udp6");case"tcp":return locationMultiaddrFromEnrFields(i,"tcp4")||locationMultiaddrFromEnrFields(i,"tcp6")}const a=e.endsWith("6"),c=i.get(a?"ip6":"ip");if(!c)return;const h=e.slice(0,3);let d;switch(h){case"udp":d=a?i.get("udp6"):i.get("udp");break;case"tcp":d=a?i.get("tcp6"):i.get("tcp");break;default:return}if(d)return multiaddrFromFields(a?"ip6":"ip4",h,c,d)}var forge$m={options:{usePureJavaScript:!1}};const forge$n=getDefaultExportFromCjs(forge$m);var util$2={exports:{}},api={},baseN$1=api,_reverseAlphabets={};api.encode=function(i,e,a){if(typeof e!="string")throw new TypeError('"alphabet" must be a string.');if(a!==void 0&&typeof a!="number")throw new TypeError('"maxline" must be a number.');var c="";if(!(i instanceof Uint8Array))c=_encodeWithByteBuffer(i,e);else{var h=0,d=e.length,et=e.charAt(0),ft=[0];for(h=0;h<i.length;++h){for(var gt=0,_t=i[h];gt<ft.length;++gt)_t+=ft[gt]<<8,ft[gt]=_t%d,_t=_t/d|0;for(;_t>0;)ft.push(_t%d),_t=_t/d|0}for(h=0;i[h]===0&&h<i.length-1;++h)c+=et;for(h=ft.length-1;h>=0;--h)c+=e[ft[h]]}if(a){var wt=new RegExp(".{1,"+a+"}","g");c=c.match(wt).join(`\r
`)}return c};api.decode=function(i,e){if(typeof i!="string")throw new TypeError('"input" must be a string.');if(typeof e!="string")throw new TypeError('"alphabet" must be a string.');var a=_reverseAlphabets[e];if(!a){a=_reverseAlphabets[e]=[];for(var c=0;c<e.length;++c)a[e.charCodeAt(c)]=c}i=i.replace(/\s/g,"");for(var h=e.length,d=e.charAt(0),et=[0],c=0;c<i.length;c++){var ft=a[i.charCodeAt(c)];if(ft===void 0)return;for(var gt=0,_t=ft;gt<et.length;++gt)_t+=et[gt]*h,et[gt]=_t&255,_t>>=8;for(;_t>0;)et.push(_t&255),_t>>=8}for(var wt=0;i[wt]===d&&wt<i.length-1;++wt)et.push(0);return typeof Buffer<"u"?Buffer.from(et.reverse()):new Uint8Array(et.reverse())};function _encodeWithByteBuffer(i,e){var a=0,c=e.length,h=e.charAt(0),d=[0];for(a=0;a<i.length();++a){for(var et=0,ft=i.at(a);et<d.length;++et)ft+=d[et]<<8,d[et]=ft%c,ft=ft/c|0;for(;ft>0;)d.push(ft%c),ft=ft/c|0}var gt="";for(a=0;i.at(a)===0&&a<i.length()-1;++a)gt+=h;for(a=d.length-1;a>=0;--a)gt+=e[d[a]];return gt}var forge$l=forge$m,baseN=baseN$1,util$1=util$2.exports=forge$l.util=forge$l.util||{};(function(){if(typeof process<"u"&&process.nextTick&&!process.browser){util$1.nextTick=process.nextTick,typeof setImmediate=="function"?util$1.setImmediate=setImmediate:util$1.setImmediate=util$1.nextTick;return}if(typeof setImmediate=="function"){util$1.setImmediate=function(){return setImmediate.apply(void 0,arguments)},util$1.nextTick=function(ft){return setImmediate(ft)};return}if(util$1.setImmediate=function(ft){setTimeout(ft,0)},typeof window<"u"&&typeof window.postMessage=="function"){let ft=function(gt){if(gt.source===window&&gt.data===i){gt.stopPropagation();var _t=e.slice();e.length=0,_t.forEach(function(wt){wt()})}};var et=ft,i="forge.setImmediate",e=[];util$1.setImmediate=function(gt){e.push(gt),e.length===1&&window.postMessage(i,"*")},window.addEventListener("message",ft,!0)}if(typeof MutationObserver<"u"){var a=Date.now(),c=!0,h=document.createElement("div"),e=[];new MutationObserver(function(){var gt=e.slice();e.length=0,gt.forEach(function(_t){_t()})}).observe(h,{attributes:!0});var d=util$1.setImmediate;util$1.setImmediate=function(gt){Date.now()-a>15?(a=Date.now(),d(gt)):(e.push(gt),e.length===1&&h.setAttribute("a",c=!c))}}util$1.nextTick=util$1.setImmediate})();util$1.isNodejs=typeof process<"u"&&process.versions&&process.versions.node;util$1.globalScope=function(){return util$1.isNodejs?commonjsGlobal:typeof self>"u"?window:self}();util$1.isArray=Array.isArray||function(i){return Object.prototype.toString.call(i)==="[object Array]"};util$1.isArrayBuffer=function(i){return typeof ArrayBuffer<"u"&&i instanceof ArrayBuffer};util$1.isArrayBufferView=function(i){return i&&util$1.isArrayBuffer(i.buffer)&&i.byteLength!==void 0};function _checkBitsParam(i){if(!(i===8||i===16||i===24||i===32))throw new Error("Only 8, 16, 24, or 32 bits supported: "+i)}util$1.ByteBuffer=ByteStringBuffer;function ByteStringBuffer(i){if(this.data="",this.read=0,typeof i=="string")this.data=i;else if(util$1.isArrayBuffer(i)||util$1.isArrayBufferView(i))if(typeof Buffer<"u"&&i instanceof Buffer)this.data=i.toString("binary");else{var e=new Uint8Array(i);try{this.data=String.fromCharCode.apply(null,e)}catch{for(var a=0;a<e.length;++a)this.putByte(e[a])}}else(i instanceof ByteStringBuffer||typeof i=="object"&&typeof i.data=="string"&&typeof i.read=="number")&&(this.data=i.data,this.read=i.read);this._constructedStringLength=0}util$1.ByteStringBuffer=ByteStringBuffer;var _MAX_CONSTRUCTED_STRING_LENGTH=4096;util$1.ByteStringBuffer.prototype._optimizeConstructedString=function(i){this._constructedStringLength+=i,this._constructedStringLength>_MAX_CONSTRUCTED_STRING_LENGTH&&(this.data.substr(0,1),this._constructedStringLength=0)};util$1.ByteStringBuffer.prototype.length=function(){return this.data.length-this.read};util$1.ByteStringBuffer.prototype.isEmpty=function(){return this.length()<=0};util$1.ByteStringBuffer.prototype.putByte=function(i){return this.putBytes(String.fromCharCode(i))};util$1.ByteStringBuffer.prototype.fillWithByte=function(i,e){i=String.fromCharCode(i);for(var a=this.data;e>0;)e&1&&(a+=i),e>>>=1,e>0&&(i+=i);return this.data=a,this._optimizeConstructedString(e),this};util$1.ByteStringBuffer.prototype.putBytes=function(i){return this.data+=i,this._optimizeConstructedString(i.length),this};util$1.ByteStringBuffer.prototype.putString=function(i){return this.putBytes(util$1.encodeUtf8(i))};util$1.ByteStringBuffer.prototype.putInt16=function(i){return this.putBytes(String.fromCharCode(i>>8&255)+String.fromCharCode(i&255))};util$1.ByteStringBuffer.prototype.putInt24=function(i){return this.putBytes(String.fromCharCode(i>>16&255)+String.fromCharCode(i>>8&255)+String.fromCharCode(i&255))};util$1.ByteStringBuffer.prototype.putInt32=function(i){return this.putBytes(String.fromCharCode(i>>24&255)+String.fromCharCode(i>>16&255)+String.fromCharCode(i>>8&255)+String.fromCharCode(i&255))};util$1.ByteStringBuffer.prototype.putInt16Le=function(i){return this.putBytes(String.fromCharCode(i&255)+String.fromCharCode(i>>8&255))};util$1.ByteStringBuffer.prototype.putInt24Le=function(i){return this.putBytes(String.fromCharCode(i&255)+String.fromCharCode(i>>8&255)+String.fromCharCode(i>>16&255))};util$1.ByteStringBuffer.prototype.putInt32Le=function(i){return this.putBytes(String.fromCharCode(i&255)+String.fromCharCode(i>>8&255)+String.fromCharCode(i>>16&255)+String.fromCharCode(i>>24&255))};util$1.ByteStringBuffer.prototype.putInt=function(i,e){_checkBitsParam(e);var a="";do e-=8,a+=String.fromCharCode(i>>e&255);while(e>0);return this.putBytes(a)};util$1.ByteStringBuffer.prototype.putSignedInt=function(i,e){return i<0&&(i+=2<<e-1),this.putInt(i,e)};util$1.ByteStringBuffer.prototype.putBuffer=function(i){return this.putBytes(i.getBytes())};util$1.ByteStringBuffer.prototype.getByte=function(){return this.data.charCodeAt(this.read++)};util$1.ByteStringBuffer.prototype.getInt16=function(){var i=this.data.charCodeAt(this.read)<<8^this.data.charCodeAt(this.read+1);return this.read+=2,i};util$1.ByteStringBuffer.prototype.getInt24=function(){var i=this.data.charCodeAt(this.read)<<16^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2);return this.read+=3,i};util$1.ByteStringBuffer.prototype.getInt32=function(){var i=this.data.charCodeAt(this.read)<<24^this.data.charCodeAt(this.read+1)<<16^this.data.charCodeAt(this.read+2)<<8^this.data.charCodeAt(this.read+3);return this.read+=4,i};util$1.ByteStringBuffer.prototype.getInt16Le=function(){var i=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8;return this.read+=2,i};util$1.ByteStringBuffer.prototype.getInt24Le=function(){var i=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16;return this.read+=3,i};util$1.ByteStringBuffer.prototype.getInt32Le=function(){var i=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16^this.data.charCodeAt(this.read+3)<<24;return this.read+=4,i};util$1.ByteStringBuffer.prototype.getInt=function(i){_checkBitsParam(i);var e=0;do e=(e<<8)+this.data.charCodeAt(this.read++),i-=8;while(i>0);return e};util$1.ByteStringBuffer.prototype.getSignedInt=function(i){var e=this.getInt(i),a=2<<i-2;return e>=a&&(e-=a<<1),e};util$1.ByteStringBuffer.prototype.getBytes=function(i){var e;return i?(i=Math.min(this.length(),i),e=this.data.slice(this.read,this.read+i),this.read+=i):i===0?e="":(e=this.read===0?this.data:this.data.slice(this.read),this.clear()),e};util$1.ByteStringBuffer.prototype.bytes=function(i){return typeof i>"u"?this.data.slice(this.read):this.data.slice(this.read,this.read+i)};util$1.ByteStringBuffer.prototype.at=function(i){return this.data.charCodeAt(this.read+i)};util$1.ByteStringBuffer.prototype.setAt=function(i,e){return this.data=this.data.substr(0,this.read+i)+String.fromCharCode(e)+this.data.substr(this.read+i+1),this};util$1.ByteStringBuffer.prototype.last=function(){return this.data.charCodeAt(this.data.length-1)};util$1.ByteStringBuffer.prototype.copy=function(){var i=util$1.createBuffer(this.data);return i.read=this.read,i};util$1.ByteStringBuffer.prototype.compact=function(){return this.read>0&&(this.data=this.data.slice(this.read),this.read=0),this};util$1.ByteStringBuffer.prototype.clear=function(){return this.data="",this.read=0,this};util$1.ByteStringBuffer.prototype.truncate=function(i){var e=Math.max(0,this.length()-i);return this.data=this.data.substr(this.read,e),this.read=0,this};util$1.ByteStringBuffer.prototype.toHex=function(){for(var i="",e=this.read;e<this.data.length;++e){var a=this.data.charCodeAt(e);a<16&&(i+="0"),i+=a.toString(16)}return i};util$1.ByteStringBuffer.prototype.toString=function(){return util$1.decodeUtf8(this.bytes())};function DataBuffer(i,e){e=e||{},this.read=e.readOffset||0,this.growSize=e.growSize||1024;var a=util$1.isArrayBuffer(i),c=util$1.isArrayBufferView(i);if(a||c){a?this.data=new DataView(i):this.data=new DataView(i.buffer,i.byteOffset,i.byteLength),this.write="writeOffset"in e?e.writeOffset:this.data.byteLength;return}this.data=new DataView(new ArrayBuffer(0)),this.write=0,i!=null&&this.putBytes(i),"writeOffset"in e&&(this.write=e.writeOffset)}util$1.DataBuffer=DataBuffer;util$1.DataBuffer.prototype.length=function(){return this.write-this.read};util$1.DataBuffer.prototype.isEmpty=function(){return this.length()<=0};util$1.DataBuffer.prototype.accommodate=function(i,e){if(this.length()>=i)return this;e=Math.max(e||this.growSize,i);var a=new Uint8Array(this.data.buffer,this.data.byteOffset,this.data.byteLength),c=new Uint8Array(this.length()+e);return c.set(a),this.data=new DataView(c.buffer),this};util$1.DataBuffer.prototype.putByte=function(i){return this.accommodate(1),this.data.setUint8(this.write++,i),this};util$1.DataBuffer.prototype.fillWithByte=function(i,e){this.accommodate(e);for(var a=0;a<e;++a)this.data.setUint8(i);return this};util$1.DataBuffer.prototype.putBytes=function(i,e){if(util$1.isArrayBufferView(i)){var a=new Uint8Array(i.buffer,i.byteOffset,i.byteLength),c=a.byteLength-a.byteOffset;this.accommodate(c);var h=new Uint8Array(this.data.buffer,this.write);return h.set(a),this.write+=c,this}if(util$1.isArrayBuffer(i)){var a=new Uint8Array(i);this.accommodate(a.byteLength);var h=new Uint8Array(this.data.buffer);return h.set(a,this.write),this.write+=a.byteLength,this}if(i instanceof util$1.DataBuffer||typeof i=="object"&&typeof i.read=="number"&&typeof i.write=="number"&&util$1.isArrayBufferView(i.data)){var a=new Uint8Array(i.data.byteLength,i.read,i.length());this.accommodate(a.byteLength);var h=new Uint8Array(i.data.byteLength,this.write);return h.set(a),this.write+=a.byteLength,this}if(i instanceof util$1.ByteStringBuffer&&(i=i.data,e="binary"),e=e||"binary",typeof i=="string"){var d;if(e==="hex")return this.accommodate(Math.ceil(i.length/2)),d=new Uint8Array(this.data.buffer,this.write),this.write+=util$1.binary.hex.decode(i,d,this.write),this;if(e==="base64")return this.accommodate(Math.ceil(i.length/4)*3),d=new Uint8Array(this.data.buffer,this.write),this.write+=util$1.binary.base64.decode(i,d,this.write),this;if(e==="utf8"&&(i=util$1.encodeUtf8(i),e="binary"),e==="binary"||e==="raw")return this.accommodate(i.length),d=new Uint8Array(this.data.buffer,this.write),this.write+=util$1.binary.raw.decode(d),this;if(e==="utf16")return this.accommodate(i.length*2),d=new Uint16Array(this.data.buffer,this.write),this.write+=util$1.text.utf16.encode(d),this;throw new Error("Invalid encoding: "+e)}throw Error("Invalid parameter: "+i)};util$1.DataBuffer.prototype.putBuffer=function(i){return this.putBytes(i),i.clear(),this};util$1.DataBuffer.prototype.putString=function(i){return this.putBytes(i,"utf16")};util$1.DataBuffer.prototype.putInt16=function(i){return this.accommodate(2),this.data.setInt16(this.write,i),this.write+=2,this};util$1.DataBuffer.prototype.putInt24=function(i){return this.accommodate(3),this.data.setInt16(this.write,i>>8&65535),this.data.setInt8(this.write,i>>16&255),this.write+=3,this};util$1.DataBuffer.prototype.putInt32=function(i){return this.accommodate(4),this.data.setInt32(this.write,i),this.write+=4,this};util$1.DataBuffer.prototype.putInt16Le=function(i){return this.accommodate(2),this.data.setInt16(this.write,i,!0),this.write+=2,this};util$1.DataBuffer.prototype.putInt24Le=function(i){return this.accommodate(3),this.data.setInt8(this.write,i>>16&255),this.data.setInt16(this.write,i>>8&65535,!0),this.write+=3,this};util$1.DataBuffer.prototype.putInt32Le=function(i){return this.accommodate(4),this.data.setInt32(this.write,i,!0),this.write+=4,this};util$1.DataBuffer.prototype.putInt=function(i,e){_checkBitsParam(e),this.accommodate(e/8);do e-=8,this.data.setInt8(this.write++,i>>e&255);while(e>0);return this};util$1.DataBuffer.prototype.putSignedInt=function(i,e){return _checkBitsParam(e),this.accommodate(e/8),i<0&&(i+=2<<e-1),this.putInt(i,e)};util$1.DataBuffer.prototype.getByte=function(){return this.data.getInt8(this.read++)};util$1.DataBuffer.prototype.getInt16=function(){var i=this.data.getInt16(this.read);return this.read+=2,i};util$1.DataBuffer.prototype.getInt24=function(){var i=this.data.getInt16(this.read)<<8^this.data.getInt8(this.read+2);return this.read+=3,i};util$1.DataBuffer.prototype.getInt32=function(){var i=this.data.getInt32(this.read);return this.read+=4,i};util$1.DataBuffer.prototype.getInt16Le=function(){var i=this.data.getInt16(this.read,!0);return this.read+=2,i};util$1.DataBuffer.prototype.getInt24Le=function(){var i=this.data.getInt8(this.read)^this.data.getInt16(this.read+1,!0)<<8;return this.read+=3,i};util$1.DataBuffer.prototype.getInt32Le=function(){var i=this.data.getInt32(this.read,!0);return this.read+=4,i};util$1.DataBuffer.prototype.getInt=function(i){_checkBitsParam(i);var e=0;do e=(e<<8)+this.data.getInt8(this.read++),i-=8;while(i>0);return e};util$1.DataBuffer.prototype.getSignedInt=function(i){var e=this.getInt(i),a=2<<i-2;return e>=a&&(e-=a<<1),e};util$1.DataBuffer.prototype.getBytes=function(i){var e;return i?(i=Math.min(this.length(),i),e=this.data.slice(this.read,this.read+i),this.read+=i):i===0?e="":(e=this.read===0?this.data:this.data.slice(this.read),this.clear()),e};util$1.DataBuffer.prototype.bytes=function(i){return typeof i>"u"?this.data.slice(this.read):this.data.slice(this.read,this.read+i)};util$1.DataBuffer.prototype.at=function(i){return this.data.getUint8(this.read+i)};util$1.DataBuffer.prototype.setAt=function(i,e){return this.data.setUint8(i,e),this};util$1.DataBuffer.prototype.last=function(){return this.data.getUint8(this.write-1)};util$1.DataBuffer.prototype.copy=function(){return new util$1.DataBuffer(this)};util$1.DataBuffer.prototype.compact=function(){if(this.read>0){var i=new Uint8Array(this.data.buffer,this.read),e=new Uint8Array(i.byteLength);e.set(i),this.data=new DataView(e),this.write-=this.read,this.read=0}return this};util$1.DataBuffer.prototype.clear=function(){return this.data=new DataView(new ArrayBuffer(0)),this.read=this.write=0,this};util$1.DataBuffer.prototype.truncate=function(i){return this.write=Math.max(0,this.length()-i),this.read=Math.min(this.read,this.write),this};util$1.DataBuffer.prototype.toHex=function(){for(var i="",e=this.read;e<this.data.byteLength;++e){var a=this.data.getUint8(e);a<16&&(i+="0"),i+=a.toString(16)}return i};util$1.DataBuffer.prototype.toString=function(i){var e=new Uint8Array(this.data,this.read,this.length());if(i=i||"utf8",i==="binary"||i==="raw")return util$1.binary.raw.encode(e);if(i==="hex")return util$1.binary.hex.encode(e);if(i==="base64")return util$1.binary.base64.encode(e);if(i==="utf8")return util$1.text.utf8.decode(e);if(i==="utf16")return util$1.text.utf16.decode(e);throw new Error("Invalid encoding: "+i)};util$1.createBuffer=function(i,e){return e=e||"raw",i!==void 0&&e==="utf8"&&(i=util$1.encodeUtf8(i)),new util$1.ByteBuffer(i)};util$1.fillString=function(i,e){for(var a="";e>0;)e&1&&(a+=i),e>>>=1,e>0&&(i+=i);return a};util$1.xorBytes=function(i,e,a){for(var c="",h="",d="",et=0,ft=0;a>0;--a,++et)h=i.charCodeAt(et)^e.charCodeAt(et),ft>=10&&(c+=d,d="",ft=0),d+=String.fromCharCode(h),++ft;return c+=d,c};util$1.hexToBytes=function(i){var e="",a=0;for(i.length&!0&&(a=1,e+=String.fromCharCode(parseInt(i[0],16)));a<i.length;a+=2)e+=String.fromCharCode(parseInt(i.substr(a,2),16));return e};util$1.bytesToHex=function(i){return util$1.createBuffer(i).toHex()};util$1.int32ToBytes=function(i){return String.fromCharCode(i>>24&255)+String.fromCharCode(i>>16&255)+String.fromCharCode(i>>8&255)+String.fromCharCode(i&255)};var _base64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_base64Idx=[62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,64,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51],_base58="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";util$1.encode64=function(i,e){for(var a="",c="",h,d,et,ft=0;ft<i.length;)h=i.charCodeAt(ft++),d=i.charCodeAt(ft++),et=i.charCodeAt(ft++),a+=_base64.charAt(h>>2),a+=_base64.charAt((h&3)<<4|d>>4),isNaN(d)?a+="==":(a+=_base64.charAt((d&15)<<2|et>>6),a+=isNaN(et)?"=":_base64.charAt(et&63)),e&&a.length>e&&(c+=a.substr(0,e)+`\r
`,a=a.substr(e));return c+=a,c};util$1.decode64=function(i){i=i.replace(/[^A-Za-z0-9\+\/\=]/g,"");for(var e="",a,c,h,d,et=0;et<i.length;)a=_base64Idx[i.charCodeAt(et++)-43],c=_base64Idx[i.charCodeAt(et++)-43],h=_base64Idx[i.charCodeAt(et++)-43],d=_base64Idx[i.charCodeAt(et++)-43],e+=String.fromCharCode(a<<2|c>>4),h!==64&&(e+=String.fromCharCode((c&15)<<4|h>>2),d!==64&&(e+=String.fromCharCode((h&3)<<6|d)));return e};util$1.encodeUtf8=function(i){return unescape(encodeURIComponent(i))};util$1.decodeUtf8=function(i){return decodeURIComponent(escape(i))};util$1.binary={raw:{},hex:{},base64:{},base58:{},baseN:{encode:baseN.encode,decode:baseN.decode}};util$1.binary.raw.encode=function(i){return String.fromCharCode.apply(null,i)};util$1.binary.raw.decode=function(i,e,a){var c=e;c||(c=new Uint8Array(i.length)),a=a||0;for(var h=a,d=0;d<i.length;++d)c[h++]=i.charCodeAt(d);return e?h-a:c};util$1.binary.hex.encode=util$1.bytesToHex;util$1.binary.hex.decode=function(i,e,a){var c=e;c||(c=new Uint8Array(Math.ceil(i.length/2))),a=a||0;var h=0,d=a;for(i.length&1&&(h=1,c[d++]=parseInt(i[0],16));h<i.length;h+=2)c[d++]=parseInt(i.substr(h,2),16);return e?d-a:c};util$1.binary.base64.encode=function(i,e){for(var a="",c="",h,d,et,ft=0;ft<i.byteLength;)h=i[ft++],d=i[ft++],et=i[ft++],a+=_base64.charAt(h>>2),a+=_base64.charAt((h&3)<<4|d>>4),isNaN(d)?a+="==":(a+=_base64.charAt((d&15)<<2|et>>6),a+=isNaN(et)?"=":_base64.charAt(et&63)),e&&a.length>e&&(c+=a.substr(0,e)+`\r
`,a=a.substr(e));return c+=a,c};util$1.binary.base64.decode=function(i,e,a){var c=e;c||(c=new Uint8Array(Math.ceil(i.length/4)*3)),i=i.replace(/[^A-Za-z0-9\+\/\=]/g,""),a=a||0;for(var h,d,et,ft,gt=0,_t=a;gt<i.length;)h=_base64Idx[i.charCodeAt(gt++)-43],d=_base64Idx[i.charCodeAt(gt++)-43],et=_base64Idx[i.charCodeAt(gt++)-43],ft=_base64Idx[i.charCodeAt(gt++)-43],c[_t++]=h<<2|d>>4,et!==64&&(c[_t++]=(d&15)<<4|et>>2,ft!==64&&(c[_t++]=(et&3)<<6|ft));return e?_t-a:c.subarray(0,_t)};util$1.binary.base58.encode=function(i,e){return util$1.binary.baseN.encode(i,_base58,e)};util$1.binary.base58.decode=function(i,e){return util$1.binary.baseN.decode(i,_base58,e)};util$1.text={utf8:{},utf16:{}};util$1.text.utf8.encode=function(i,e,a){i=util$1.encodeUtf8(i);var c=e;c||(c=new Uint8Array(i.length)),a=a||0;for(var h=a,d=0;d<i.length;++d)c[h++]=i.charCodeAt(d);return e?h-a:c};util$1.text.utf8.decode=function(i){return util$1.decodeUtf8(String.fromCharCode.apply(null,i))};util$1.text.utf16.encode=function(i,e,a){var c=e;c||(c=new Uint8Array(i.length*2));var h=new Uint16Array(c.buffer);a=a||0;for(var d=a,et=a,ft=0;ft<i.length;++ft)h[et++]=i.charCodeAt(ft),d+=2;return e?d-a:c};util$1.text.utf16.decode=function(i){return String.fromCharCode.apply(null,new Uint16Array(i.buffer))};util$1.deflate=function(i,e,a){if(e=util$1.decode64(i.deflate(util$1.encode64(e)).rval),a){var c=2,h=e.charCodeAt(1);h&32&&(c=6),e=e.substring(c,e.length-4)}return e};util$1.inflate=function(i,e,a){var c=i.inflate(util$1.encode64(e)).rval;return c===null?null:util$1.decode64(c)};var _setStorageObject=function(i,e,a){if(!i)throw new Error("WebStorage not available.");var c;if(a===null?c=i.removeItem(e):(a=util$1.encode64(JSON.stringify(a)),c=i.setItem(e,a)),typeof c<"u"&&c.rval!==!0){var h=new Error(c.error.message);throw h.id=c.error.id,h.name=c.error.name,h}},_getStorageObject=function(i,e){if(!i)throw new Error("WebStorage not available.");var a=i.getItem(e);if(i.init)if(a.rval===null){if(a.error){var c=new Error(a.error.message);throw c.id=a.error.id,c.name=a.error.name,c}a=null}else a=a.rval;return a!==null&&(a=JSON.parse(util$1.decode64(a))),a},_setItem=function(i,e,a,c){var h=_getStorageObject(i,e);h===null&&(h={}),h[a]=c,_setStorageObject(i,e,h)},_getItem=function(i,e,a){var c=_getStorageObject(i,e);return c!==null&&(c=a in c?c[a]:null),c},_removeItem=function(i,e,a){var c=_getStorageObject(i,e);if(c!==null&&a in c){delete c[a];var h=!0;for(var d in c){h=!1;break}h&&(c=null),_setStorageObject(i,e,c)}},_clearItems=function(i,e){_setStorageObject(i,e,null)},_callStorageFunction=function(i,e,a){var c=null;typeof a>"u"&&(a=["web","flash"]);var h,d=!1,et=null;for(var ft in a){h=a[ft];try{if(h==="flash"||h==="both"){if(e[0]===null)throw new Error("Flash local storage not available.");c=i.apply(this,e),d=h==="flash"}(h==="web"||h==="both")&&(e[0]=localStorage,c=i.apply(this,e),d=!0)}catch(gt){et=gt}if(d)break}if(!d)throw et;return c};util$1.setItem=function(i,e,a,c,h){_callStorageFunction(_setItem,arguments,h)};util$1.getItem=function(i,e,a,c){return _callStorageFunction(_getItem,arguments,c)};util$1.removeItem=function(i,e,a,c){_callStorageFunction(_removeItem,arguments,c)};util$1.clearItems=function(i,e,a){_callStorageFunction(_clearItems,arguments,a)};util$1.isEmpty=function(i){for(var e in i)if(i.hasOwnProperty(e))return!1;return!0};util$1.format=function(i){for(var e=/%./g,a,c,h=0,d=[],et=0;a=e.exec(i);){c=i.substring(et,e.lastIndex-2),c.length>0&&d.push(c),et=e.lastIndex;var ft=a[0][1];switch(ft){case"s":case"o":h<arguments.length?d.push(arguments[h+++1]):d.push("<?>");break;case"%":d.push("%");break;default:d.push("<%"+ft+"?>")}}return d.push(i.substring(et)),d.join("")};util$1.formatNumber=function(i,e,a,c){var h=i,d=isNaN(e=Math.abs(e))?2:e,et=a===void 0?",":a,ft=c===void 0?".":c,gt=h<0?"-":"",_t=parseInt(h=Math.abs(+h||0).toFixed(d),10)+"",wt=_t.length>3?_t.length%3:0;return gt+(wt?_t.substr(0,wt)+ft:"")+_t.substr(wt).replace(/(\d{3})(?=\d)/g,"$1"+ft)+(d?et+Math.abs(h-_t).toFixed(d).slice(2):"")};util$1.formatSize=function(i){return i>=1073741824?i=util$1.formatNumber(i/1073741824,2,".","")+" GiB":i>=1048576?i=util$1.formatNumber(i/1048576,2,".","")+" MiB":i>=1024?i=util$1.formatNumber(i/1024,0)+" KiB":i=util$1.formatNumber(i,0)+" bytes",i};util$1.bytesFromIP=function(i){return i.indexOf(".")!==-1?util$1.bytesFromIPv4(i):i.indexOf(":")!==-1?util$1.bytesFromIPv6(i):null};util$1.bytesFromIPv4=function(i){if(i=i.split("."),i.length!==4)return null;for(var e=util$1.createBuffer(),a=0;a<i.length;++a){var c=parseInt(i[a],10);if(isNaN(c))return null;e.putByte(c)}return e.getBytes()};util$1.bytesFromIPv6=function(i){var e=0;i=i.split(":").filter(function(et){return et.length===0&&++e,!0});for(var a=(8-i.length+e)*2,c=util$1.createBuffer(),h=0;h<8;++h){if(!i[h]||i[h].length===0){c.fillWithByte(0,a),a=0;continue}var d=util$1.hexToBytes(i[h]);d.length<2&&c.putByte(0),c.putBytes(d)}return c.getBytes()};util$1.bytesToIP=function(i){return i.length===4?util$1.bytesToIPv4(i):i.length===16?util$1.bytesToIPv6(i):null};util$1.bytesToIPv4=function(i){if(i.length!==4)return null;for(var e=[],a=0;a<i.length;++a)e.push(i.charCodeAt(a));return e.join(".")};util$1.bytesToIPv6=function(i){if(i.length!==16)return null;for(var e=[],a=[],c=0,h=0;h<i.length;h+=2){for(var d=util$1.bytesToHex(i[h]+i[h+1]);d[0]==="0"&&d!=="0";)d=d.substr(1);if(d==="0"){var et=a[a.length-1],ft=e.length;!et||ft!==et.end+1?a.push({start:ft,end:ft}):(et.end=ft,et.end-et.start>a[c].end-a[c].start&&(c=a.length-1))}e.push(d)}if(a.length>0){var gt=a[c];gt.end-gt.start>0&&(e.splice(gt.start,gt.end-gt.start+1,""),gt.start===0&&e.unshift(""),gt.end===7&&e.push(""))}return e.join(":")};util$1.estimateCores=function(i,e){if(typeof i=="function"&&(e=i,i={}),i=i||{},"cores"in util$1&&!i.update)return e(null,util$1.cores);if(typeof navigator<"u"&&"hardwareConcurrency"in navigator&&navigator.hardwareConcurrency>0)return util$1.cores=navigator.hardwareConcurrency,e(null,util$1.cores);if(typeof Worker>"u")return util$1.cores=1,e(null,util$1.cores);if(typeof Blob>"u")return util$1.cores=2,e(null,util$1.cores);var a=URL.createObjectURL(new Blob(["(",(function(){self.addEventListener("message",function(et){var ft=Date.now(),gt=ft+4;self.postMessage({st:ft,et:gt})})}).toString(),")()"],{type:"application/javascript"}));c([],5,16);function c(et,ft,gt){if(ft===0){var _t=Math.floor(et.reduce(function(wt,$t){return wt+$t},0)/et.length);return util$1.cores=Math.max(1,_t),URL.revokeObjectURL(a),e(null,util$1.cores)}h(gt,function(wt,$t){et.push(d(gt,$t)),c(et,ft-1,gt)})}function h(et,ft){for(var gt=[],_t=[],wt=0;wt<et;++wt){var $t=new Worker(a);$t.addEventListener("message",function(It){if(_t.push(It.data),_t.length===et){for(var Rt=0;Rt<et;++Rt)gt[Rt].terminate();ft(null,_t)}}),gt.push($t)}for(var wt=0;wt<et;++wt)gt[wt].postMessage(wt)}function d(et,ft){for(var gt=[],_t=0;_t<et;++_t)for(var wt=ft[_t],$t=gt[_t]=[],It=0;It<et;++It)if(_t!==It){var Rt=ft[It];(wt.st>Rt.st&&wt.st<Rt.et||Rt.st>wt.st&&Rt.st<wt.et)&&$t.push(It)}return gt.reduce(function(Tt,At){return Math.max(Tt,At.length)},0)}};var utilExports=util$2.exports;const forgeUtil=getDefaultExportFromCjs(utilExports);var forge$k=forge$m;forge$k.pki=forge$k.pki||{};var oids$1=forge$k.pki.oids=forge$k.oids=forge$k.oids||{};function _IN(i,e){oids$1[i]=e,oids$1[e]=i}function _I_(i,e){oids$1[i]=e}_IN("1.2.840.113549.1.1.1","rsaEncryption");_IN("1.2.840.113549.1.1.4","md5WithRSAEncryption");_IN("1.2.840.113549.1.1.5","sha1WithRSAEncryption");_IN("1.2.840.113549.1.1.7","RSAES-OAEP");_IN("1.2.840.113549.1.1.8","mgf1");_IN("1.2.840.113549.1.1.9","pSpecified");_IN("1.2.840.113549.1.1.10","RSASSA-PSS");_IN("1.2.840.113549.1.1.11","sha256WithRSAEncryption");_IN("1.2.840.113549.1.1.12","sha384WithRSAEncryption");_IN("1.2.840.113549.1.1.13","sha512WithRSAEncryption");_IN("1.3.101.112","EdDSA25519");_IN("1.2.840.10040.4.3","dsa-with-sha1");_IN("1.3.14.3.2.7","desCBC");_IN("1.3.14.3.2.26","sha1");_IN("1.3.14.3.2.29","sha1WithRSASignature");_IN("2.16.840.1.101.3.4.2.1","sha256");_IN("2.16.840.1.101.3.4.2.2","sha384");_IN("2.16.840.1.101.3.4.2.3","sha512");_IN("2.16.840.1.101.3.4.2.4","sha224");_IN("2.16.840.1.101.3.4.2.5","sha512-224");_IN("2.16.840.1.101.3.4.2.6","sha512-256");_IN("1.2.840.113549.2.2","md2");_IN("1.2.840.113549.2.5","md5");_IN("1.2.840.113549.1.7.1","data");_IN("1.2.840.113549.1.7.2","signedData");_IN("1.2.840.113549.1.7.3","envelopedData");_IN("1.2.840.113549.1.7.4","signedAndEnvelopedData");_IN("1.2.840.113549.1.7.5","digestedData");_IN("1.2.840.113549.1.7.6","encryptedData");_IN("1.2.840.113549.1.9.1","emailAddress");_IN("1.2.840.113549.1.9.2","unstructuredName");_IN("1.2.840.113549.1.9.3","contentType");_IN("1.2.840.113549.1.9.4","messageDigest");_IN("1.2.840.113549.1.9.5","signingTime");_IN("1.2.840.113549.1.9.6","counterSignature");_IN("1.2.840.113549.1.9.7","challengePassword");_IN("1.2.840.113549.1.9.8","unstructuredAddress");_IN("1.2.840.113549.1.9.14","extensionRequest");_IN("1.2.840.113549.1.9.20","friendlyName");_IN("1.2.840.113549.1.9.21","localKeyId");_IN("1.2.840.113549.1.9.22.1","x509Certificate");_IN("1.2.840.113549.1.12.10.1.1","keyBag");_IN("1.2.840.113549.1.12.10.1.2","pkcs8ShroudedKeyBag");_IN("1.2.840.113549.1.12.10.1.3","certBag");_IN("1.2.840.113549.1.12.10.1.4","crlBag");_IN("1.2.840.113549.1.12.10.1.5","secretBag");_IN("1.2.840.113549.1.12.10.1.6","safeContentsBag");_IN("1.2.840.113549.1.5.13","pkcs5PBES2");_IN("1.2.840.113549.1.5.12","pkcs5PBKDF2");_IN("1.2.840.113549.1.12.1.1","pbeWithSHAAnd128BitRC4");_IN("1.2.840.113549.1.12.1.2","pbeWithSHAAnd40BitRC4");_IN("1.2.840.113549.1.12.1.3","pbeWithSHAAnd3-KeyTripleDES-CBC");_IN("1.2.840.113549.1.12.1.4","pbeWithSHAAnd2-KeyTripleDES-CBC");_IN("1.2.840.113549.1.12.1.5","pbeWithSHAAnd128BitRC2-CBC");_IN("1.2.840.113549.1.12.1.6","pbewithSHAAnd40BitRC2-CBC");_IN("1.2.840.113549.2.7","hmacWithSHA1");_IN("1.2.840.113549.2.8","hmacWithSHA224");_IN("1.2.840.113549.2.9","hmacWithSHA256");_IN("1.2.840.113549.2.10","hmacWithSHA384");_IN("1.2.840.113549.2.11","hmacWithSHA512");_IN("1.2.840.113549.3.7","des-EDE3-CBC");_IN("2.16.840.1.101.3.4.1.2","aes128-CBC");_IN("2.16.840.1.101.3.4.1.22","aes192-CBC");_IN("2.16.840.1.101.3.4.1.42","aes256-CBC");_IN("2.5.4.3","commonName");_IN("2.5.4.4","surname");_IN("2.5.4.5","serialNumber");_IN("2.5.4.6","countryName");_IN("2.5.4.7","localityName");_IN("2.5.4.8","stateOrProvinceName");_IN("2.5.4.9","streetAddress");_IN("2.5.4.10","organizationName");_IN("2.5.4.11","organizationalUnitName");_IN("2.5.4.12","title");_IN("2.5.4.13","description");_IN("2.5.4.15","businessCategory");_IN("2.5.4.17","postalCode");_IN("2.5.4.42","givenName");_IN("1.3.6.1.4.1.311.60.2.1.2","jurisdictionOfIncorporationStateOrProvinceName");_IN("1.3.6.1.4.1.311.60.2.1.3","jurisdictionOfIncorporationCountryName");_IN("2.16.840.1.113730.1.1","nsCertType");_IN("2.16.840.1.113730.1.13","nsComment");_I_("2.5.29.1","authorityKeyIdentifier");_I_("2.5.29.2","keyAttributes");_I_("2.5.29.3","certificatePolicies");_I_("2.5.29.4","keyUsageRestriction");_I_("2.5.29.5","policyMapping");_I_("2.5.29.6","subtreesConstraint");_I_("2.5.29.7","subjectAltName");_I_("2.5.29.8","issuerAltName");_I_("2.5.29.9","subjectDirectoryAttributes");_I_("2.5.29.10","basicConstraints");_I_("2.5.29.11","nameConstraints");_I_("2.5.29.12","policyConstraints");_I_("2.5.29.13","basicConstraints");_IN("2.5.29.14","subjectKeyIdentifier");_IN("2.5.29.15","keyUsage");_I_("2.5.29.16","privateKeyUsagePeriod");_IN("2.5.29.17","subjectAltName");_IN("2.5.29.18","issuerAltName");_IN("2.5.29.19","basicConstraints");_I_("2.5.29.20","cRLNumber");_I_("2.5.29.21","cRLReason");_I_("2.5.29.22","expirationDate");_I_("2.5.29.23","instructionCode");_I_("2.5.29.24","invalidityDate");_I_("2.5.29.25","cRLDistributionPoints");_I_("2.5.29.26","issuingDistributionPoint");_I_("2.5.29.27","deltaCRLIndicator");_I_("2.5.29.28","issuingDistributionPoint");_I_("2.5.29.29","certificateIssuer");_I_("2.5.29.30","nameConstraints");_IN("2.5.29.31","cRLDistributionPoints");_IN("2.5.29.32","certificatePolicies");_I_("2.5.29.33","policyMappings");_I_("2.5.29.34","policyConstraints");_IN("2.5.29.35","authorityKeyIdentifier");_I_("2.5.29.36","policyConstraints");_IN("2.5.29.37","extKeyUsage");_I_("2.5.29.46","freshestCRL");_I_("2.5.29.54","inhibitAnyPolicy");_IN("1.3.6.1.4.1.11129.2.4.2","timestampList");_IN("1.3.6.1.5.5.7.1.1","authorityInfoAccess");_IN("1.3.6.1.5.5.7.3.1","serverAuth");_IN("1.3.6.1.5.5.7.3.2","clientAuth");_IN("1.3.6.1.5.5.7.3.3","codeSigning");_IN("1.3.6.1.5.5.7.3.4","emailProtection");_IN("1.3.6.1.5.5.7.3.8","timeStamping");var forge$j=forge$m,asn1$2=forge$j.asn1=forge$j.asn1||{};asn1$2.Class={UNIVERSAL:0,APPLICATION:64,CONTEXT_SPECIFIC:128,PRIVATE:192};asn1$2.Type={NONE:0,BOOLEAN:1,INTEGER:2,BITSTRING:3,OCTETSTRING:4,NULL:5,OID:6,ODESC:7,EXTERNAL:8,REAL:9,ENUMERATED:10,EMBEDDED:11,UTF8:12,ROID:13,SEQUENCE:16,SET:17,PRINTABLESTRING:19,IA5STRING:22,UTCTIME:23,GENERALIZEDTIME:24,BMPSTRING:30};asn1$2.create=function(i,e,a,c,h){if(forge$j.util.isArray(c)){for(var d=[],et=0;et<c.length;++et)c[et]!==void 0&&d.push(c[et]);c=d}var ft={tagClass:i,type:e,constructed:a,composed:a||forge$j.util.isArray(c),value:c};return h&&"bitStringContents"in h&&(ft.bitStringContents=h.bitStringContents,ft.original=asn1$2.copy(ft)),ft};asn1$2.copy=function(i,e){var a;if(forge$j.util.isArray(i)){a=[];for(var c=0;c<i.length;++c)a.push(asn1$2.copy(i[c],e));return a}return typeof i=="string"?i:(a={tagClass:i.tagClass,type:i.type,constructed:i.constructed,composed:i.composed,value:asn1$2.copy(i.value,e)},e&&!e.excludeBitStringContents&&(a.bitStringContents=i.bitStringContents),a)};asn1$2.equals=function(i,e,a){if(forge$j.util.isArray(i)){if(!forge$j.util.isArray(e)||i.length!==e.length)return!1;for(var c=0;c<i.length;++c)if(!asn1$2.equals(i[c],e[c]))return!1;return!0}if(typeof i!=typeof e)return!1;if(typeof i=="string")return i===e;var h=i.tagClass===e.tagClass&&i.type===e.type&&i.constructed===e.constructed&&i.composed===e.composed&&asn1$2.equals(i.value,e.value);return a&&a.includeBitStringContents&&(h=h&&i.bitStringContents===e.bitStringContents),h};asn1$2.getBerValueLength=function(i){var e=i.getByte();if(e!==128){var a,c=e&128;return c?a=i.getInt((e&127)<<3):a=e,a}};function _checkBufferLength(i,e,a){if(a>e){var c=new Error("Too few bytes to parse DER.");throw c.available=i.length(),c.remaining=e,c.requested=a,c}}var _getValueLength=function(i,e){var a=i.getByte();if(e--,a!==128){var c,h=a&128;if(!h)c=a;else{var d=a&127;_checkBufferLength(i,e,d),c=i.getInt(d<<3)}if(c<0)throw new Error("Negative length: "+c);return c}};asn1$2.fromDer=function(i,e){e===void 0&&(e={strict:!0,parseAllBytes:!0,decodeBitStrings:!0}),typeof e=="boolean"&&(e={strict:e,parseAllBytes:!0,decodeBitStrings:!0}),"strict"in e||(e.strict=!0),"parseAllBytes"in e||(e.parseAllBytes=!0),"decodeBitStrings"in e||(e.decodeBitStrings=!0),typeof i=="string"&&(i=forge$j.util.createBuffer(i));var a=i.length(),c=_fromDer(i,i.length(),0,e);if(e.parseAllBytes&&i.length()!==0){var h=new Error("Unparsed DER bytes remain after ASN.1 parsing.");throw h.byteCount=a,h.remaining=i.length(),h}return c};function _fromDer(i,e,a,c){var h;_checkBufferLength(i,e,2);var d=i.getByte();e--;var et=d&192,ft=d&31;h=i.length();var gt=_getValueLength(i,e);if(e-=h-i.length(),gt!==void 0&&gt>e){if(c.strict){var _t=new Error("Too few bytes to read ASN.1 value.");throw _t.available=i.length(),_t.remaining=e,_t.requested=gt,_t}gt=e}var wt,$t,It=(d&32)===32;if(It)if(wt=[],gt===void 0)for(;;){if(_checkBufferLength(i,e,2),i.bytes(2)==="\0\0"){i.getBytes(2),e-=2;break}h=i.length(),wt.push(_fromDer(i,e,a+1,c)),e-=h-i.length()}else for(;gt>0;)h=i.length(),wt.push(_fromDer(i,gt,a+1,c)),e-=h-i.length(),gt-=h-i.length();if(wt===void 0&&et===asn1$2.Class.UNIVERSAL&&ft===asn1$2.Type.BITSTRING&&($t=i.bytes(gt)),wt===void 0&&c.decodeBitStrings&&et===asn1$2.Class.UNIVERSAL&&ft===asn1$2.Type.BITSTRING&&gt>1){var Rt=i.read,Tt=e,At=0;if(ft===asn1$2.Type.BITSTRING&&(_checkBufferLength(i,e,1),At=i.getByte(),e--),At===0)try{h=i.length();var kt={strict:!0,decodeBitStrings:!0},xt=_fromDer(i,e,a+1,kt),Nt=h-i.length();e-=Nt,ft==asn1$2.Type.BITSTRING&&Nt++;var Ft=xt.tagClass;Nt===gt&&(Ft===asn1$2.Class.UNIVERSAL||Ft===asn1$2.Class.CONTEXT_SPECIFIC)&&(wt=[xt])}catch{}wt===void 0&&(i.read=Rt,e=Tt)}if(wt===void 0){if(gt===void 0){if(c.strict)throw new Error("Non-constructed ASN.1 object of indefinite length.");gt=e}if(ft===asn1$2.Type.BMPSTRING)for(wt="";gt>0;gt-=2)_checkBufferLength(i,e,2),wt+=String.fromCharCode(i.getInt16()),e-=2;else wt=i.getBytes(gt),e-=gt}var jt=$t===void 0?null:{bitStringContents:$t};return asn1$2.create(et,ft,It,wt,jt)}asn1$2.toDer=function(i){var e=forge$j.util.createBuffer(),a=i.tagClass|i.type,c=forge$j.util.createBuffer(),h=!1;if("bitStringContents"in i&&(h=!0,i.original&&(h=asn1$2.equals(i,i.original))),h)c.putBytes(i.bitStringContents);else if(i.composed){i.constructed?a|=32:c.putByte(0);for(var d=0;d<i.value.length;++d)i.value[d]!==void 0&&c.putBuffer(asn1$2.toDer(i.value[d]))}else if(i.type===asn1$2.Type.BMPSTRING)for(var d=0;d<i.value.length;++d)c.putInt16(i.value.charCodeAt(d));else i.type===asn1$2.Type.INTEGER&&i.value.length>1&&(i.value.charCodeAt(0)===0&&!(i.value.charCodeAt(1)&128)||i.value.charCodeAt(0)===255&&(i.value.charCodeAt(1)&128)===128)?c.putBytes(i.value.substr(1)):c.putBytes(i.value);if(e.putByte(a),c.length()<=127)e.putByte(c.length()&127);else{var et=c.length(),ft="";do ft+=String.fromCharCode(et&255),et=et>>>8;while(et>0);e.putByte(ft.length|128);for(var d=ft.length-1;d>=0;--d)e.putByte(ft.charCodeAt(d))}return e.putBuffer(c),e};asn1$2.oidToDer=function(i){var e=i.split("."),a=forge$j.util.createBuffer();a.putByte(40*parseInt(e[0],10)+parseInt(e[1],10));for(var c,h,d,et,ft=2;ft<e.length;++ft){c=!0,h=[],d=parseInt(e[ft],10);do et=d&127,d=d>>>7,c||(et|=128),h.push(et),c=!1;while(d>0);for(var gt=h.length-1;gt>=0;--gt)a.putByte(h[gt])}return a};asn1$2.derToOid=function(i){var e;typeof i=="string"&&(i=forge$j.util.createBuffer(i));var a=i.getByte();e=Math.floor(a/40)+"."+a%40;for(var c=0;i.length()>0;)a=i.getByte(),c=c<<7,a&128?c+=a&127:(e+="."+(c+a),c=0);return e};asn1$2.utcTimeToDate=function(i){var e=new Date,a=parseInt(i.substr(0,2),10);a=a>=50?1900+a:2e3+a;var c=parseInt(i.substr(2,2),10)-1,h=parseInt(i.substr(4,2),10),d=parseInt(i.substr(6,2),10),et=parseInt(i.substr(8,2),10),ft=0;if(i.length>11){var gt=i.charAt(10),_t=10;gt!=="+"&&gt!=="-"&&(ft=parseInt(i.substr(10,2),10),_t+=2)}if(e.setUTCFullYear(a,c,h),e.setUTCHours(d,et,ft,0),_t&&(gt=i.charAt(_t),gt==="+"||gt==="-")){var wt=parseInt(i.substr(_t+1,2),10),$t=parseInt(i.substr(_t+4,2),10),It=wt*60+$t;It*=6e4,gt==="+"?e.setTime(+e-It):e.setTime(+e+It)}return e};asn1$2.generalizedTimeToDate=function(i){var e=new Date,a=parseInt(i.substr(0,4),10),c=parseInt(i.substr(4,2),10)-1,h=parseInt(i.substr(6,2),10),d=parseInt(i.substr(8,2),10),et=parseInt(i.substr(10,2),10),ft=parseInt(i.substr(12,2),10),gt=0,_t=0,wt=!1;i.charAt(i.length-1)==="Z"&&(wt=!0);var $t=i.length-5,It=i.charAt($t);if(It==="+"||It==="-"){var Rt=parseInt(i.substr($t+1,2),10),Tt=parseInt(i.substr($t+4,2),10);_t=Rt*60+Tt,_t*=6e4,It==="+"&&(_t*=-1),wt=!0}return i.charAt(14)==="."&&(gt=parseFloat(i.substr(14),10)*1e3),wt?(e.setUTCFullYear(a,c,h),e.setUTCHours(d,et,ft,gt),e.setTime(+e+_t)):(e.setFullYear(a,c,h),e.setHours(d,et,ft,gt)),e};asn1$2.dateToUtcTime=function(i){if(typeof i=="string")return i;var e="",a=[];a.push((""+i.getUTCFullYear()).substr(2)),a.push(""+(i.getUTCMonth()+1)),a.push(""+i.getUTCDate()),a.push(""+i.getUTCHours()),a.push(""+i.getUTCMinutes()),a.push(""+i.getUTCSeconds());for(var c=0;c<a.length;++c)a[c].length<2&&(e+="0"),e+=a[c];return e+="Z",e};asn1$2.dateToGeneralizedTime=function(i){if(typeof i=="string")return i;var e="",a=[];a.push(""+i.getUTCFullYear()),a.push(""+(i.getUTCMonth()+1)),a.push(""+i.getUTCDate()),a.push(""+i.getUTCHours()),a.push(""+i.getUTCMinutes()),a.push(""+i.getUTCSeconds());for(var c=0;c<a.length;++c)a[c].length<2&&(e+="0"),e+=a[c];return e+="Z",e};asn1$2.integerToDer=function(i){var e=forge$j.util.createBuffer();if(i>=-128&&i<128)return e.putSignedInt(i,8);if(i>=-32768&&i<32768)return e.putSignedInt(i,16);if(i>=-8388608&&i<8388608)return e.putSignedInt(i,24);if(i>=-2147483648&&i<2147483648)return e.putSignedInt(i,32);var a=new Error("Integer too large; max is 32-bits.");throw a.integer=i,a};asn1$2.derToInteger=function(i){typeof i=="string"&&(i=forge$j.util.createBuffer(i));var e=i.length()*8;if(e>32)throw new Error("Integer too large; max is 32-bits.");return i.getSignedInt(e)};asn1$2.validate=function(i,e,a,c){var h=!1;if((i.tagClass===e.tagClass||typeof e.tagClass>"u")&&(i.type===e.type||typeof e.type>"u"))if(i.constructed===e.constructed||typeof e.constructed>"u"){if(h=!0,e.value&&forge$j.util.isArray(e.value))for(var d=0,et=0;h&&et<e.value.length;++et)h=e.value[et].optional||!1,i.value[d]&&(h=asn1$2.validate(i.value[d],e.value[et],a,c),h?++d:e.value[et].optional&&(h=!0)),!h&&c&&c.push("["+e.name+'] Tag class "'+e.tagClass+'", type "'+e.type+'" expected value length "'+e.value.length+'", got "'+i.value.length+'"');if(h&&a&&(e.capture&&(a[e.capture]=i.value),e.captureAsn1&&(a[e.captureAsn1]=i),e.captureBitStringContents&&"bitStringContents"in i&&(a[e.captureBitStringContents]=i.bitStringContents),e.captureBitStringValue&&"bitStringContents"in i))if(i.bitStringContents.length<2)a[e.captureBitStringValue]="";else{var ft=i.bitStringContents.charCodeAt(0);if(ft!==0)throw new Error("captureBitStringValue only supported for zero unused bits");a[e.captureBitStringValue]=i.bitStringContents.slice(1)}}else c&&c.push("["+e.name+'] Expected constructed "'+e.constructed+'", got "'+i.constructed+'"');else c&&(i.tagClass!==e.tagClass&&c.push("["+e.name+'] Expected tag class "'+e.tagClass+'", got "'+i.tagClass+'"'),i.type!==e.type&&c.push("["+e.name+'] Expected type "'+e.type+'", got "'+i.type+'"'));return h};var _nonLatinRegex=/[^\\u0000-\\u00ff]/;asn1$2.prettyPrint=function(i,e,a){var c="";e=e||0,a=a||2,e>0&&(c+=`
`);for(var h="",d=0;d<e*a;++d)h+=" ";switch(c+=h+"Tag: ",i.tagClass){case asn1$2.Class.UNIVERSAL:c+="Universal:";break;case asn1$2.Class.APPLICATION:c+="Application:";break;case asn1$2.Class.CONTEXT_SPECIFIC:c+="Context-Specific:";break;case asn1$2.Class.PRIVATE:c+="Private:";break}if(i.tagClass===asn1$2.Class.UNIVERSAL)switch(c+=i.type,i.type){case asn1$2.Type.NONE:c+=" (None)";break;case asn1$2.Type.BOOLEAN:c+=" (Boolean)";break;case asn1$2.Type.INTEGER:c+=" (Integer)";break;case asn1$2.Type.BITSTRING:c+=" (Bit string)";break;case asn1$2.Type.OCTETSTRING:c+=" (Octet string)";break;case asn1$2.Type.NULL:c+=" (Null)";break;case asn1$2.Type.OID:c+=" (Object Identifier)";break;case asn1$2.Type.ODESC:c+=" (Object Descriptor)";break;case asn1$2.Type.EXTERNAL:c+=" (External or Instance of)";break;case asn1$2.Type.REAL:c+=" (Real)";break;case asn1$2.Type.ENUMERATED:c+=" (Enumerated)";break;case asn1$2.Type.EMBEDDED:c+=" (Embedded PDV)";break;case asn1$2.Type.UTF8:c+=" (UTF8)";break;case asn1$2.Type.ROID:c+=" (Relative Object Identifier)";break;case asn1$2.Type.SEQUENCE:c+=" (Sequence)";break;case asn1$2.Type.SET:c+=" (Set)";break;case asn1$2.Type.PRINTABLESTRING:c+=" (Printable String)";break;case asn1$2.Type.IA5String:c+=" (IA5String (ASCII))";break;case asn1$2.Type.UTCTIME:c+=" (UTC time)";break;case asn1$2.Type.GENERALIZEDTIME:c+=" (Generalized time)";break;case asn1$2.Type.BMPSTRING:c+=" (BMP String)";break}else c+=i.type;if(c+=`
`,c+=h+"Constructed: "+i.constructed+`
`,i.composed){for(var et=0,ft="",d=0;d<i.value.length;++d)i.value[d]!==void 0&&(et+=1,ft+=asn1$2.prettyPrint(i.value[d],e+1,a),d+1<i.value.length&&(ft+=","));c+=h+"Sub values: "+et+ft}else{if(c+=h+"Value: ",i.type===asn1$2.Type.OID){var gt=asn1$2.derToOid(i.value);c+=gt,forge$j.pki&&forge$j.pki.oids&&gt in forge$j.pki.oids&&(c+=" ("+forge$j.pki.oids[gt]+") ")}if(i.type===asn1$2.Type.INTEGER)try{c+=asn1$2.derToInteger(i.value)}catch{c+="0x"+forge$j.util.bytesToHex(i.value)}else if(i.type===asn1$2.Type.BITSTRING){if(i.value.length>1?c+="0x"+forge$j.util.bytesToHex(i.value.slice(1)):c+="(none)",i.value.length>0){var _t=i.value.charCodeAt(0);_t==1?c+=" (1 unused bit shown)":_t>1&&(c+=" ("+_t+" unused bits shown)")}}else if(i.type===asn1$2.Type.OCTETSTRING)_nonLatinRegex.test(i.value)||(c+="("+i.value+") "),c+="0x"+forge$j.util.bytesToHex(i.value);else if(i.type===asn1$2.Type.UTF8)try{c+=forge$j.util.decodeUtf8(i.value)}catch(wt){if(wt.message==="URI malformed")c+="0x"+forge$j.util.bytesToHex(i.value)+" (malformed UTF8)";else throw wt}else i.type===asn1$2.Type.PRINTABLESTRING||i.type===asn1$2.Type.IA5String?c+=i.value:_nonLatinRegex.test(i.value)?c+="0x"+forge$j.util.bytesToHex(i.value):i.value.length===0?c+="[null]":c+=i.value}return c};var forge$i=forge$m;forge$i.cipher=forge$i.cipher||{};forge$i.cipher.algorithms=forge$i.cipher.algorithms||{};forge$i.cipher.createCipher=function(i,e){var a=i;if(typeof a=="string"&&(a=forge$i.cipher.getAlgorithm(a),a&&(a=a())),!a)throw new Error("Unsupported algorithm: "+i);return new forge$i.cipher.BlockCipher({algorithm:a,key:e,decrypt:!1})};forge$i.cipher.createDecipher=function(i,e){var a=i;if(typeof a=="string"&&(a=forge$i.cipher.getAlgorithm(a),a&&(a=a())),!a)throw new Error("Unsupported algorithm: "+i);return new forge$i.cipher.BlockCipher({algorithm:a,key:e,decrypt:!0})};forge$i.cipher.registerAlgorithm=function(i,e){i=i.toUpperCase(),forge$i.cipher.algorithms[i]=e};forge$i.cipher.getAlgorithm=function(i){return i=i.toUpperCase(),i in forge$i.cipher.algorithms?forge$i.cipher.algorithms[i]:null};var BlockCipher=forge$i.cipher.BlockCipher=function(i){this.algorithm=i.algorithm,this.mode=this.algorithm.mode,this.blockSize=this.mode.blockSize,this._finish=!1,this._input=null,this.output=null,this._op=i.decrypt?this.mode.decrypt:this.mode.encrypt,this._decrypt=i.decrypt,this.algorithm.initialize(i)};BlockCipher.prototype.start=function(i){i=i||{};var e={};for(var a in i)e[a]=i[a];e.decrypt=this._decrypt,this._finish=!1,this._input=forge$i.util.createBuffer(),this.output=i.output||forge$i.util.createBuffer(),this.mode.start(e)};BlockCipher.prototype.update=function(i){for(i&&this._input.putBuffer(i);!this._op.call(this.mode,this._input,this.output,this._finish)&&!this._finish;);this._input.compact()};BlockCipher.prototype.finish=function(i){i&&(this.mode.name==="ECB"||this.mode.name==="CBC")&&(this.mode.pad=function(a){return i(this.blockSize,a,!1)},this.mode.unpad=function(a){return i(this.blockSize,a,!0)});var e={};return e.decrypt=this._decrypt,e.overflow=this._input.length()%this.blockSize,!(!this._decrypt&&this.mode.pad&&!this.mode.pad(this._input,e)||(this._finish=!0,this.update(),this._decrypt&&this.mode.unpad&&!this.mode.unpad(this.output,e))||this.mode.afterFinish&&!this.mode.afterFinish(this.output,e))};var forge$h=forge$m;forge$h.cipher=forge$h.cipher||{};var modes=forge$h.cipher.modes=forge$h.cipher.modes||{};modes.ecb=function(i){i=i||{},this.name="ECB",this.cipher=i.cipher,this.blockSize=i.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints)};modes.ecb.prototype.start=function(i){};modes.ecb.prototype.encrypt=function(i,e,a){if(i.length()<this.blockSize&&!(a&&i.length()>0))return!0;for(var c=0;c<this._ints;++c)this._inBlock[c]=i.getInt32();this.cipher.encrypt(this._inBlock,this._outBlock);for(var c=0;c<this._ints;++c)e.putInt32(this._outBlock[c])};modes.ecb.prototype.decrypt=function(i,e,a){if(i.length()<this.blockSize&&!(a&&i.length()>0))return!0;for(var c=0;c<this._ints;++c)this._inBlock[c]=i.getInt32();this.cipher.decrypt(this._inBlock,this._outBlock);for(var c=0;c<this._ints;++c)e.putInt32(this._outBlock[c])};modes.ecb.prototype.pad=function(i,e){var a=i.length()===this.blockSize?this.blockSize:this.blockSize-i.length();return i.fillWithByte(a,a),!0};modes.ecb.prototype.unpad=function(i,e){if(e.overflow>0)return!1;var a=i.length(),c=i.at(a-1);return c>this.blockSize<<2?!1:(i.truncate(c),!0)};modes.cbc=function(i){i=i||{},this.name="CBC",this.cipher=i.cipher,this.blockSize=i.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints)};modes.cbc.prototype.start=function(i){if(i.iv===null){if(!this._prev)throw new Error("Invalid IV parameter.");this._iv=this._prev.slice(0)}else if("iv"in i)this._iv=transformIV(i.iv,this.blockSize),this._prev=this._iv.slice(0);else throw new Error("Invalid IV parameter.")};modes.cbc.prototype.encrypt=function(i,e,a){if(i.length()<this.blockSize&&!(a&&i.length()>0))return!0;for(var c=0;c<this._ints;++c)this._inBlock[c]=this._prev[c]^i.getInt32();this.cipher.encrypt(this._inBlock,this._outBlock);for(var c=0;c<this._ints;++c)e.putInt32(this._outBlock[c]);this._prev=this._outBlock};modes.cbc.prototype.decrypt=function(i,e,a){if(i.length()<this.blockSize&&!(a&&i.length()>0))return!0;for(var c=0;c<this._ints;++c)this._inBlock[c]=i.getInt32();this.cipher.decrypt(this._inBlock,this._outBlock);for(var c=0;c<this._ints;++c)e.putInt32(this._prev[c]^this._outBlock[c]);this._prev=this._inBlock.slice(0)};modes.cbc.prototype.pad=function(i,e){var a=i.length()===this.blockSize?this.blockSize:this.blockSize-i.length();return i.fillWithByte(a,a),!0};modes.cbc.prototype.unpad=function(i,e){if(e.overflow>0)return!1;var a=i.length(),c=i.at(a-1);return c>this.blockSize<<2?!1:(i.truncate(c),!0)};modes.cfb=function(i){i=i||{},this.name="CFB",this.cipher=i.cipher,this.blockSize=i.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialBlock=new Array(this._ints),this._partialOutput=forge$h.util.createBuffer(),this._partialBytes=0};modes.cfb.prototype.start=function(i){if(!("iv"in i))throw new Error("Invalid IV parameter.");this._iv=transformIV(i.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0};modes.cfb.prototype.encrypt=function(i,e,a){var c=i.length();if(c===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&c>=this.blockSize){for(var h=0;h<this._ints;++h)this._inBlock[h]=i.getInt32()^this._outBlock[h],e.putInt32(this._inBlock[h]);return}var d=(this.blockSize-c)%this.blockSize;d>0&&(d=this.blockSize-d),this._partialOutput.clear();for(var h=0;h<this._ints;++h)this._partialBlock[h]=i.getInt32()^this._outBlock[h],this._partialOutput.putInt32(this._partialBlock[h]);if(d>0)i.read-=this.blockSize;else for(var h=0;h<this._ints;++h)this._inBlock[h]=this._partialBlock[h];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),d>0&&!a)return e.putBytes(this._partialOutput.getBytes(d-this._partialBytes)),this._partialBytes=d,!0;e.putBytes(this._partialOutput.getBytes(c-this._partialBytes)),this._partialBytes=0};modes.cfb.prototype.decrypt=function(i,e,a){var c=i.length();if(c===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&c>=this.blockSize){for(var h=0;h<this._ints;++h)this._inBlock[h]=i.getInt32(),e.putInt32(this._inBlock[h]^this._outBlock[h]);return}var d=(this.blockSize-c)%this.blockSize;d>0&&(d=this.blockSize-d),this._partialOutput.clear();for(var h=0;h<this._ints;++h)this._partialBlock[h]=i.getInt32(),this._partialOutput.putInt32(this._partialBlock[h]^this._outBlock[h]);if(d>0)i.read-=this.blockSize;else for(var h=0;h<this._ints;++h)this._inBlock[h]=this._partialBlock[h];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),d>0&&!a)return e.putBytes(this._partialOutput.getBytes(d-this._partialBytes)),this._partialBytes=d,!0;e.putBytes(this._partialOutput.getBytes(c-this._partialBytes)),this._partialBytes=0};modes.ofb=function(i){i=i||{},this.name="OFB",this.cipher=i.cipher,this.blockSize=i.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialOutput=forge$h.util.createBuffer(),this._partialBytes=0};modes.ofb.prototype.start=function(i){if(!("iv"in i))throw new Error("Invalid IV parameter.");this._iv=transformIV(i.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0};modes.ofb.prototype.encrypt=function(i,e,a){var c=i.length();if(i.length()===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&c>=this.blockSize){for(var h=0;h<this._ints;++h)e.putInt32(i.getInt32()^this._outBlock[h]),this._inBlock[h]=this._outBlock[h];return}var d=(this.blockSize-c)%this.blockSize;d>0&&(d=this.blockSize-d),this._partialOutput.clear();for(var h=0;h<this._ints;++h)this._partialOutput.putInt32(i.getInt32()^this._outBlock[h]);if(d>0)i.read-=this.blockSize;else for(var h=0;h<this._ints;++h)this._inBlock[h]=this._outBlock[h];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),d>0&&!a)return e.putBytes(this._partialOutput.getBytes(d-this._partialBytes)),this._partialBytes=d,!0;e.putBytes(this._partialOutput.getBytes(c-this._partialBytes)),this._partialBytes=0};modes.ofb.prototype.decrypt=modes.ofb.prototype.encrypt;modes.ctr=function(i){i=i||{},this.name="CTR",this.cipher=i.cipher,this.blockSize=i.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialOutput=forge$h.util.createBuffer(),this._partialBytes=0};modes.ctr.prototype.start=function(i){if(!("iv"in i))throw new Error("Invalid IV parameter.");this._iv=transformIV(i.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0};modes.ctr.prototype.encrypt=function(i,e,a){var c=i.length();if(c===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&c>=this.blockSize)for(var h=0;h<this._ints;++h)e.putInt32(i.getInt32()^this._outBlock[h]);else{var d=(this.blockSize-c)%this.blockSize;d>0&&(d=this.blockSize-d),this._partialOutput.clear();for(var h=0;h<this._ints;++h)this._partialOutput.putInt32(i.getInt32()^this._outBlock[h]);if(d>0&&(i.read-=this.blockSize),this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),d>0&&!a)return e.putBytes(this._partialOutput.getBytes(d-this._partialBytes)),this._partialBytes=d,!0;e.putBytes(this._partialOutput.getBytes(c-this._partialBytes)),this._partialBytes=0}inc32(this._inBlock)};modes.ctr.prototype.decrypt=modes.ctr.prototype.encrypt;modes.gcm=function(i){i=i||{},this.name="GCM",this.cipher=i.cipher,this.blockSize=i.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints),this._partialOutput=forge$h.util.createBuffer(),this._partialBytes=0,this._R=3774873600};modes.gcm.prototype.start=function(i){if(!("iv"in i))throw new Error("Invalid IV parameter.");var e=forge$h.util.createBuffer(i.iv);this._cipherLength=0;var a;if("additionalData"in i?a=forge$h.util.createBuffer(i.additionalData):a=forge$h.util.createBuffer(),"tagLength"in i?this._tagLength=i.tagLength:this._tagLength=128,this._tag=null,i.decrypt&&(this._tag=forge$h.util.createBuffer(i.tag).getBytes(),this._tag.length!==this._tagLength/8))throw new Error("Authentication tag does not match tag length.");this._hashBlock=new Array(this._ints),this.tag=null,this._hashSubkey=new Array(this._ints),this.cipher.encrypt([0,0,0,0],this._hashSubkey),this.componentBits=4,this._m=this.generateHashTable(this._hashSubkey,this.componentBits);var c=e.length();if(c===12)this._j0=[e.getInt32(),e.getInt32(),e.getInt32(),1];else{for(this._j0=[0,0,0,0];e.length()>0;)this._j0=this.ghash(this._hashSubkey,this._j0,[e.getInt32(),e.getInt32(),e.getInt32(),e.getInt32()]);this._j0=this.ghash(this._hashSubkey,this._j0,[0,0].concat(from64To32(c*8)))}this._inBlock=this._j0.slice(0),inc32(this._inBlock),this._partialBytes=0,a=forge$h.util.createBuffer(a),this._aDataLength=from64To32(a.length()*8);var h=a.length()%this.blockSize;for(h&&a.fillWithByte(0,this.blockSize-h),this._s=[0,0,0,0];a.length()>0;)this._s=this.ghash(this._hashSubkey,this._s,[a.getInt32(),a.getInt32(),a.getInt32(),a.getInt32()])};modes.gcm.prototype.encrypt=function(i,e,a){var c=i.length();if(c===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&c>=this.blockSize){for(var h=0;h<this._ints;++h)e.putInt32(this._outBlock[h]^=i.getInt32());this._cipherLength+=this.blockSize}else{var d=(this.blockSize-c)%this.blockSize;d>0&&(d=this.blockSize-d),this._partialOutput.clear();for(var h=0;h<this._ints;++h)this._partialOutput.putInt32(i.getInt32()^this._outBlock[h]);if(d<=0||a){if(a){var et=c%this.blockSize;this._cipherLength+=et,this._partialOutput.truncate(this.blockSize-et)}else this._cipherLength+=this.blockSize;for(var h=0;h<this._ints;++h)this._outBlock[h]=this._partialOutput.getInt32();this._partialOutput.read-=this.blockSize}if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),d>0&&!a)return i.read-=this.blockSize,e.putBytes(this._partialOutput.getBytes(d-this._partialBytes)),this._partialBytes=d,!0;e.putBytes(this._partialOutput.getBytes(c-this._partialBytes)),this._partialBytes=0}this._s=this.ghash(this._hashSubkey,this._s,this._outBlock),inc32(this._inBlock)};modes.gcm.prototype.decrypt=function(i,e,a){var c=i.length();if(c<this.blockSize&&!(a&&c>0))return!0;this.cipher.encrypt(this._inBlock,this._outBlock),inc32(this._inBlock),this._hashBlock[0]=i.getInt32(),this._hashBlock[1]=i.getInt32(),this._hashBlock[2]=i.getInt32(),this._hashBlock[3]=i.getInt32(),this._s=this.ghash(this._hashSubkey,this._s,this._hashBlock);for(var h=0;h<this._ints;++h)e.putInt32(this._outBlock[h]^this._hashBlock[h]);c<this.blockSize?this._cipherLength+=c%this.blockSize:this._cipherLength+=this.blockSize};modes.gcm.prototype.afterFinish=function(i,e){var a=!0;e.decrypt&&e.overflow&&i.truncate(this.blockSize-e.overflow),this.tag=forge$h.util.createBuffer();var c=this._aDataLength.concat(from64To32(this._cipherLength*8));this._s=this.ghash(this._hashSubkey,this._s,c);var h=[];this.cipher.encrypt(this._j0,h);for(var d=0;d<this._ints;++d)this.tag.putInt32(this._s[d]^h[d]);return this.tag.truncate(this.tag.length()%(this._tagLength/8)),e.decrypt&&this.tag.bytes()!==this._tag&&(a=!1),a};modes.gcm.prototype.multiply=function(i,e){for(var a=[0,0,0,0],c=e.slice(0),h=0;h<128;++h){var d=i[h/32|0]&1<<31-h%32;d&&(a[0]^=c[0],a[1]^=c[1],a[2]^=c[2],a[3]^=c[3]),this.pow(c,c)}return a};modes.gcm.prototype.pow=function(i,e){for(var a=i[3]&1,c=3;c>0;--c)e[c]=i[c]>>>1|(i[c-1]&1)<<31;e[0]=i[0]>>>1,a&&(e[0]^=this._R)};modes.gcm.prototype.tableMultiply=function(i){for(var e=[0,0,0,0],a=0;a<32;++a){var c=a/8|0,h=i[c]>>>(7-a%8)*4&15,d=this._m[a][h];e[0]^=d[0],e[1]^=d[1],e[2]^=d[2],e[3]^=d[3]}return e};modes.gcm.prototype.ghash=function(i,e,a){return e[0]^=a[0],e[1]^=a[1],e[2]^=a[2],e[3]^=a[3],this.tableMultiply(e)};modes.gcm.prototype.generateHashTable=function(i,e){for(var a=8/e,c=4*a,h=16*a,d=new Array(h),et=0;et<h;++et){var ft=[0,0,0,0],gt=et/c|0,_t=(c-1-et%c)*e;ft[gt]=1<<e-1<<_t,d[et]=this.generateSubHashTable(this.multiply(ft,i),e)}return d};modes.gcm.prototype.generateSubHashTable=function(i,e){var a=1<<e,c=a>>>1,h=new Array(a);h[c]=i.slice(0);for(var d=c>>>1;d>0;)this.pow(h[2*d],h[d]=[]),d>>=1;for(d=2;d<c;){for(var et=1;et<d;++et){var ft=h[d],gt=h[et];h[d+et]=[ft[0]^gt[0],ft[1]^gt[1],ft[2]^gt[2],ft[3]^gt[3]]}d*=2}for(h[0]=[0,0,0,0],d=c+1;d<a;++d){var _t=h[d^c];h[d]=[i[0]^_t[0],i[1]^_t[1],i[2]^_t[2],i[3]^_t[3]]}return h};function transformIV(i,e){if(typeof i=="string"&&(i=forge$h.util.createBuffer(i)),forge$h.util.isArray(i)&&i.length>4){var a=i;i=forge$h.util.createBuffer();for(var c=0;c<a.length;++c)i.putByte(a[c])}if(i.length()<e)throw new Error("Invalid IV length; got "+i.length()+" bytes and expected "+e+" bytes.");if(!forge$h.util.isArray(i)){for(var h=[],d=e/4,c=0;c<d;++c)h.push(i.getInt32());i=h}return i}function inc32(i){i[i.length-1]=i[i.length-1]+1&4294967295}function from64To32(i){return[i/4294967296|0,i&4294967295]}var forge$g=forge$m;forge$g.aes=forge$g.aes||{};forge$g.aes.startEncrypting=function(i,e,a,c){var h=_createCipher$1({key:i,output:a,decrypt:!1,mode:c});return h.start(e),h};forge$g.aes.createEncryptionCipher=function(i,e){return _createCipher$1({key:i,output:null,decrypt:!1,mode:e})};forge$g.aes.startDecrypting=function(i,e,a,c){var h=_createCipher$1({key:i,output:a,decrypt:!0,mode:c});return h.start(e),h};forge$g.aes.createDecryptionCipher=function(i,e){return _createCipher$1({key:i,output:null,decrypt:!0,mode:e})};forge$g.aes.Algorithm=function(i,e){init$2||initialize();var a=this;a.name=i,a.mode=new e({blockSize:16,cipher:{encrypt:function(c,h){return _updateBlock$1(a._w,c,h,!1)},decrypt:function(c,h){return _updateBlock$1(a._w,c,h,!0)}}}),a._init=!1};forge$g.aes.Algorithm.prototype.initialize=function(i){if(!this._init){var e=i.key,a;if(typeof e=="string"&&(e.length===16||e.length===24||e.length===32))e=forge$g.util.createBuffer(e);else if(forge$g.util.isArray(e)&&(e.length===16||e.length===24||e.length===32)){a=e,e=forge$g.util.createBuffer();for(var c=0;c<a.length;++c)e.putByte(a[c])}if(!forge$g.util.isArray(e)){a=e,e=[];var h=a.length();if(h===16||h===24||h===32){h=h>>>2;for(var c=0;c<h;++c)e.push(a.getInt32())}}if(!forge$g.util.isArray(e)||!(e.length===4||e.length===6||e.length===8))throw new Error("Invalid key parameter.");var d=this.mode.name,et=["CFB","OFB","CTR","GCM"].indexOf(d)!==-1;this._w=_expandKey(e,i.decrypt&&!et),this._init=!0}};forge$g.aes._expandKey=function(i,e){return init$2||initialize(),_expandKey(i,e)};forge$g.aes._updateBlock=_updateBlock$1;registerAlgorithm$1("AES-ECB",forge$g.cipher.modes.ecb);registerAlgorithm$1("AES-CBC",forge$g.cipher.modes.cbc);registerAlgorithm$1("AES-CFB",forge$g.cipher.modes.cfb);registerAlgorithm$1("AES-OFB",forge$g.cipher.modes.ofb);registerAlgorithm$1("AES-CTR",forge$g.cipher.modes.ctr);registerAlgorithm$1("AES-GCM",forge$g.cipher.modes.gcm);function registerAlgorithm$1(i,e){var a=function(){return new forge$g.aes.Algorithm(i,e)};forge$g.cipher.registerAlgorithm(i,a)}var init$2=!1,Nb=4,sbox,isbox,rcon,mix,imix;function initialize(){init$2=!0,rcon=[0,1,2,4,8,16,32,64,128,27,54];for(var i=new Array(256),e=0;e<128;++e)i[e]=e<<1,i[e+128]=e+128<<1^283;sbox=new Array(256),isbox=new Array(256),mix=new Array(4),imix=new Array(4);for(var e=0;e<4;++e)mix[e]=new Array(256),imix[e]=new Array(256);for(var a=0,c=0,h,d,et,ft,gt,_t,wt,e=0;e<256;++e){ft=c^c<<1^c<<2^c<<3^c<<4,ft=ft>>8^ft&255^99,sbox[a]=ft,isbox[ft]=a,gt=i[ft],h=i[a],d=i[h],et=i[d],_t=gt<<24^ft<<16^ft<<8^(ft^gt),wt=(h^d^et)<<24^(a^et)<<16^(a^d^et)<<8^(a^h^et);for(var $t=0;$t<4;++$t)mix[$t][a]=_t,imix[$t][ft]=wt,_t=_t<<24|_t>>>8,wt=wt<<24|wt>>>8;a===0?a=c=1:(a=h^i[i[i[h^et]]],c^=i[i[c]])}}function _expandKey(i,e){for(var a=i.slice(0),c,h=1,d=a.length,et=d+6+1,ft=Nb*et,gt=d;gt<ft;++gt)c=a[gt-1],gt%d===0?(c=sbox[c>>>16&255]<<24^sbox[c>>>8&255]<<16^sbox[c&255]<<8^sbox[c>>>24]^rcon[h]<<24,h++):d>6&&gt%d===4&&(c=sbox[c>>>24]<<24^sbox[c>>>16&255]<<16^sbox[c>>>8&255]<<8^sbox[c&255]),a[gt]=a[gt-d]^c;if(e){var _t,wt=imix[0],$t=imix[1],It=imix[2],Rt=imix[3],Tt=a.slice(0);ft=a.length;for(var gt=0,At=ft-Nb;gt<ft;gt+=Nb,At-=Nb)if(gt===0||gt===ft-Nb)Tt[gt]=a[At],Tt[gt+1]=a[At+3],Tt[gt+2]=a[At+2],Tt[gt+3]=a[At+1];else for(var kt=0;kt<Nb;++kt)_t=a[At+kt],Tt[gt+(3&-kt)]=wt[sbox[_t>>>24]]^$t[sbox[_t>>>16&255]]^It[sbox[_t>>>8&255]]^Rt[sbox[_t&255]];a=Tt}return a}function _updateBlock$1(i,e,a,c){var h=i.length/4-1,d,et,ft,gt,_t;c?(d=imix[0],et=imix[1],ft=imix[2],gt=imix[3],_t=isbox):(d=mix[0],et=mix[1],ft=mix[2],gt=mix[3],_t=sbox);var wt,$t,It,Rt,Tt,At,kt;wt=e[0]^i[0],$t=e[c?3:1]^i[1],It=e[2]^i[2],Rt=e[c?1:3]^i[3];for(var xt=3,Nt=1;Nt<h;++Nt)Tt=d[wt>>>24]^et[$t>>>16&255]^ft[It>>>8&255]^gt[Rt&255]^i[++xt],At=d[$t>>>24]^et[It>>>16&255]^ft[Rt>>>8&255]^gt[wt&255]^i[++xt],kt=d[It>>>24]^et[Rt>>>16&255]^ft[wt>>>8&255]^gt[$t&255]^i[++xt],Rt=d[Rt>>>24]^et[wt>>>16&255]^ft[$t>>>8&255]^gt[It&255]^i[++xt],wt=Tt,$t=At,It=kt;a[0]=_t[wt>>>24]<<24^_t[$t>>>16&255]<<16^_t[It>>>8&255]<<8^_t[Rt&255]^i[++xt],a[c?3:1]=_t[$t>>>24]<<24^_t[It>>>16&255]<<16^_t[Rt>>>8&255]<<8^_t[wt&255]^i[++xt],a[2]=_t[It>>>24]<<24^_t[Rt>>>16&255]<<16^_t[wt>>>8&255]<<8^_t[$t&255]^i[++xt],a[c?1:3]=_t[Rt>>>24]<<24^_t[wt>>>16&255]<<16^_t[$t>>>8&255]<<8^_t[It&255]^i[++xt]}function _createCipher$1(i){i=i||{};var e=(i.mode||"CBC").toUpperCase(),a="AES-"+e,c;i.decrypt?c=forge$g.cipher.createDecipher(a,i.key):c=forge$g.cipher.createCipher(a,i.key);var h=c.start;return c.start=function(d,et){var ft=null;et instanceof forge$g.util.ByteBuffer&&(ft=et,et={}),et=et||{},et.output=ft,et.iv=d,h.call(c,et)},c}var forge$f=forge$m;forge$f.des=forge$f.des||{};forge$f.des.startEncrypting=function(i,e,a,c){var h=_createCipher({key:i,output:a,decrypt:!1,mode:c||(e===null?"ECB":"CBC")});return h.start(e),h};forge$f.des.createEncryptionCipher=function(i,e){return _createCipher({key:i,output:null,decrypt:!1,mode:e})};forge$f.des.startDecrypting=function(i,e,a,c){var h=_createCipher({key:i,output:a,decrypt:!0,mode:c||(e===null?"ECB":"CBC")});return h.start(e),h};forge$f.des.createDecryptionCipher=function(i,e){return _createCipher({key:i,output:null,decrypt:!0,mode:e})};forge$f.des.Algorithm=function(i,e){var a=this;a.name=i,a.mode=new e({blockSize:8,cipher:{encrypt:function(c,h){return _updateBlock(a._keys,c,h,!1)},decrypt:function(c,h){return _updateBlock(a._keys,c,h,!0)}}}),a._init=!1};forge$f.des.Algorithm.prototype.initialize=function(i){if(!this._init){var e=forge$f.util.createBuffer(i.key);if(this.name.indexOf("3DES")===0&&e.length()!==24)throw new Error("Invalid Triple-DES key size: "+e.length()*8);this._keys=_createKeys(e),this._init=!0}};registerAlgorithm("DES-ECB",forge$f.cipher.modes.ecb);registerAlgorithm("DES-CBC",forge$f.cipher.modes.cbc);registerAlgorithm("DES-CFB",forge$f.cipher.modes.cfb);registerAlgorithm("DES-OFB",forge$f.cipher.modes.ofb);registerAlgorithm("DES-CTR",forge$f.cipher.modes.ctr);registerAlgorithm("3DES-ECB",forge$f.cipher.modes.ecb);registerAlgorithm("3DES-CBC",forge$f.cipher.modes.cbc);registerAlgorithm("3DES-CFB",forge$f.cipher.modes.cfb);registerAlgorithm("3DES-OFB",forge$f.cipher.modes.ofb);registerAlgorithm("3DES-CTR",forge$f.cipher.modes.ctr);function registerAlgorithm(i,e){var a=function(){return new forge$f.des.Algorithm(i,e)};forge$f.cipher.registerAlgorithm(i,a)}var spfunction1=[16843776,0,65536,16843780,16842756,66564,4,65536,1024,16843776,16843780,1024,16778244,16842756,16777216,4,1028,16778240,16778240,66560,66560,16842752,16842752,16778244,65540,16777220,16777220,65540,0,1028,66564,16777216,65536,16843780,4,16842752,16843776,16777216,16777216,1024,16842756,65536,66560,16777220,1024,4,16778244,66564,16843780,65540,16842752,16778244,16777220,1028,66564,16843776,1028,16778240,16778240,0,65540,66560,0,16842756],spfunction2=[-2146402272,-2147450880,32768,1081376,1048576,32,-2146435040,-2147450848,-2147483616,-2146402272,-2146402304,-2147483648,-2147450880,1048576,32,-2146435040,1081344,1048608,-2147450848,0,-2147483648,32768,1081376,-2146435072,1048608,-2147483616,0,1081344,32800,-2146402304,-2146435072,32800,0,1081376,-2146435040,1048576,-2147450848,-2146435072,-2146402304,32768,-2146435072,-2147450880,32,-2146402272,1081376,32,32768,-2147483648,32800,-2146402304,1048576,-2147483616,1048608,-2147450848,-2147483616,1048608,1081344,0,-2147450880,32800,-2147483648,-2146435040,-2146402272,1081344],spfunction3=[520,134349312,0,134348808,134218240,0,131592,134218240,131080,134217736,134217736,131072,134349320,131080,134348800,520,134217728,8,134349312,512,131584,134348800,134348808,131592,134218248,131584,131072,134218248,8,134349320,512,134217728,134349312,134217728,131080,520,131072,134349312,134218240,0,512,131080,134349320,134218240,134217736,512,0,134348808,134218248,131072,134217728,134349320,8,131592,131584,134217736,134348800,134218248,520,134348800,131592,8,134348808,131584],spfunction4=[8396801,8321,8321,128,8396928,8388737,8388609,8193,0,8396800,8396800,8396929,129,0,8388736,8388609,1,8192,8388608,8396801,128,8388608,8193,8320,8388737,1,8320,8388736,8192,8396928,8396929,129,8388736,8388609,8396800,8396929,129,0,0,8396800,8320,8388736,8388737,1,8396801,8321,8321,128,8396929,129,1,8192,8388609,8193,8396928,8388737,8193,8320,8388608,8396801,128,8388608,8192,8396928],spfunction5=[256,34078976,34078720,1107296512,524288,256,1073741824,34078720,1074266368,524288,33554688,1074266368,1107296512,1107820544,524544,1073741824,33554432,1074266112,1074266112,0,1073742080,1107820800,1107820800,33554688,1107820544,1073742080,0,1107296256,34078976,33554432,1107296256,524544,524288,1107296512,256,33554432,1073741824,34078720,1107296512,1074266368,33554688,1073741824,1107820544,34078976,1074266368,256,33554432,1107820544,1107820800,524544,1107296256,1107820800,34078720,0,1074266112,1107296256,524544,33554688,1073742080,524288,0,1074266112,34078976,1073742080],spfunction6=[536870928,541065216,16384,541081616,541065216,16,541081616,4194304,536887296,4210704,4194304,536870928,4194320,536887296,536870912,16400,0,4194320,536887312,16384,4210688,536887312,16,541065232,541065232,0,4210704,541081600,16400,4210688,541081600,536870912,536887296,16,541065232,4210688,541081616,4194304,16400,536870928,4194304,536887296,536870912,16400,536870928,541081616,4210688,541065216,4210704,541081600,0,541065232,16,16384,541065216,4210704,16384,4194320,536887312,0,541081600,536870912,4194320,536887312],spfunction7=[2097152,69206018,67110914,0,2048,67110914,2099202,69208064,69208066,2097152,0,67108866,2,67108864,69206018,2050,67110912,2099202,2097154,67110912,67108866,69206016,69208064,2097154,69206016,2048,2050,69208066,2099200,2,67108864,2099200,67108864,2099200,2097152,67110914,67110914,69206018,69206018,2,2097154,67108864,67110912,2097152,69208064,2050,2099202,69208064,2050,67108866,69208066,69206016,2099200,0,2,69208066,0,2099202,69206016,2048,67108866,67110912,2048,2097154],spfunction8=[268439616,4096,262144,268701760,268435456,268439616,64,268435456,262208,268697600,268701760,266240,268701696,266304,4096,64,268697600,268435520,268439552,4160,266240,262208,268697664,268701696,4160,0,0,268697664,268435520,268439552,266304,262144,266304,262144,268701696,4096,64,268697664,4096,266304,268439552,64,268435520,268697600,268697664,268435456,262144,268439616,0,268701760,262208,268435520,268697600,268439552,268439616,0,268701760,266240,266240,4160,4160,262208,268435456,268701696];function _createKeys(i){for(var e=[0,4,536870912,536870916,65536,65540,536936448,536936452,512,516,536871424,536871428,66048,66052,536936960,536936964],a=[0,1,1048576,1048577,67108864,67108865,68157440,68157441,256,257,1048832,1048833,67109120,67109121,68157696,68157697],c=[0,8,2048,2056,16777216,16777224,16779264,16779272,0,8,2048,2056,16777216,16777224,16779264,16779272],h=[0,2097152,134217728,136314880,8192,2105344,134225920,136323072,131072,2228224,134348800,136445952,139264,2236416,134356992,136454144],d=[0,262144,16,262160,0,262144,16,262160,4096,266240,4112,266256,4096,266240,4112,266256],et=[0,1024,32,1056,0,1024,32,1056,33554432,33555456,33554464,33555488,33554432,33555456,33554464,33555488],ft=[0,268435456,524288,268959744,2,268435458,524290,268959746,0,268435456,524288,268959744,2,268435458,524290,268959746],gt=[0,65536,2048,67584,536870912,536936448,536872960,536938496,131072,196608,133120,198656,537001984,537067520,537004032,537069568],_t=[0,262144,0,262144,2,262146,2,262146,33554432,33816576,33554432,33816576,33554434,33816578,33554434,33816578],wt=[0,268435456,8,268435464,0,268435456,8,268435464,1024,268436480,1032,268436488,1024,268436480,1032,268436488],$t=[0,32,0,32,1048576,1048608,1048576,1048608,8192,8224,8192,8224,1056768,1056800,1056768,1056800],It=[0,16777216,512,16777728,2097152,18874368,2097664,18874880,67108864,83886080,67109376,83886592,69206016,85983232,69206528,85983744],Rt=[0,4096,134217728,134221824,524288,528384,134742016,134746112,16,4112,134217744,134221840,524304,528400,134742032,134746128],Tt=[0,4,256,260,0,4,256,260,1,5,257,261,1,5,257,261],At=i.length()>8?3:1,kt=[],xt=[0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0],Nt=0,Ft,jt=0;jt<At;jt++){var Gt=i.getInt32(),Kt=i.getInt32();Ft=(Gt>>>4^Kt)&252645135,Kt^=Ft,Gt^=Ft<<4,Ft=(Kt>>>-16^Gt)&65535,Gt^=Ft,Kt^=Ft<<-16,Ft=(Gt>>>2^Kt)&858993459,Kt^=Ft,Gt^=Ft<<2,Ft=(Kt>>>-16^Gt)&65535,Gt^=Ft,Kt^=Ft<<-16,Ft=(Gt>>>1^Kt)&1431655765,Kt^=Ft,Gt^=Ft<<1,Ft=(Kt>>>8^Gt)&16711935,Gt^=Ft,Kt^=Ft<<8,Ft=(Gt>>>1^Kt)&1431655765,Kt^=Ft,Gt^=Ft<<1,Ft=Gt<<8|Kt>>>20&240,Gt=Kt<<24|Kt<<8&16711680|Kt>>>8&65280|Kt>>>24&240,Kt=Ft;for(var Wt=0;Wt<xt.length;++Wt){xt[Wt]?(Gt=Gt<<2|Gt>>>26,Kt=Kt<<2|Kt>>>26):(Gt=Gt<<1|Gt>>>27,Kt=Kt<<1|Kt>>>27),Gt&=-15,Kt&=-15;var Zt=e[Gt>>>28]|a[Gt>>>24&15]|c[Gt>>>20&15]|h[Gt>>>16&15]|d[Gt>>>12&15]|et[Gt>>>8&15]|ft[Gt>>>4&15],cr=gt[Kt>>>28]|_t[Kt>>>24&15]|wt[Kt>>>20&15]|$t[Kt>>>16&15]|It[Kt>>>12&15]|Rt[Kt>>>8&15]|Tt[Kt>>>4&15];Ft=(cr>>>16^Zt)&65535,kt[Nt++]=Zt^Ft,kt[Nt++]=cr^Ft<<16}}return kt}function _updateBlock(i,e,a,c){var h=i.length===32?3:9,d;h===3?d=c?[30,-2,-2]:[0,32,2]:d=c?[94,62,-2,32,64,2,30,-2,-2]:[0,32,2,62,30,-2,64,96,2];var et,ft=e[0],gt=e[1];et=(ft>>>4^gt)&252645135,gt^=et,ft^=et<<4,et=(ft>>>16^gt)&65535,gt^=et,ft^=et<<16,et=(gt>>>2^ft)&858993459,ft^=et,gt^=et<<2,et=(gt>>>8^ft)&16711935,ft^=et,gt^=et<<8,et=(ft>>>1^gt)&1431655765,gt^=et,ft^=et<<1,ft=ft<<1|ft>>>31,gt=gt<<1|gt>>>31;for(var _t=0;_t<h;_t+=3){for(var wt=d[_t+1],$t=d[_t+2],It=d[_t];It!=wt;It+=$t){var Rt=gt^i[It],Tt=(gt>>>4|gt<<28)^i[It+1];et=ft,ft=gt,gt=et^(spfunction2[Rt>>>24&63]|spfunction4[Rt>>>16&63]|spfunction6[Rt>>>8&63]|spfunction8[Rt&63]|spfunction1[Tt>>>24&63]|spfunction3[Tt>>>16&63]|spfunction5[Tt>>>8&63]|spfunction7[Tt&63])}et=ft,ft=gt,gt=et}ft=ft>>>1|ft<<31,gt=gt>>>1|gt<<31,et=(ft>>>1^gt)&1431655765,gt^=et,ft^=et<<1,et=(gt>>>8^ft)&16711935,ft^=et,gt^=et<<8,et=(gt>>>2^ft)&858993459,ft^=et,gt^=et<<2,et=(ft>>>16^gt)&65535,gt^=et,ft^=et<<16,et=(ft>>>4^gt)&252645135,gt^=et,ft^=et<<4,a[0]=ft,a[1]=gt}function _createCipher(i){i=i||{};var e=(i.mode||"CBC").toUpperCase(),a="DES-"+e,c;i.decrypt?c=forge$f.cipher.createDecipher(a,i.key):c=forge$f.cipher.createCipher(a,i.key);var h=c.start;return c.start=function(d,et){var ft=null;et instanceof forge$f.util.ByteBuffer&&(ft=et,et={}),et=et||{},et.output=ft,et.iv=d,h.call(c,et)},c}var forge$e=forge$m;forge$e.md=forge$e.md||{};forge$e.md.algorithms=forge$e.md.algorithms||{};var forge$d=forge$m,hmac=forge$d.hmac=forge$d.hmac||{};hmac.create=function(){var i=null,e=null,a=null,c=null,h={};return h.start=function(d,et){if(d!==null)if(typeof d=="string")if(d=d.toLowerCase(),d in forge$d.md.algorithms)e=forge$d.md.algorithms[d].create();else throw new Error('Unknown hash algorithm "'+d+'"');else e=d;if(et===null)et=i;else{if(typeof et=="string")et=forge$d.util.createBuffer(et);else if(forge$d.util.isArray(et)){var ft=et;et=forge$d.util.createBuffer();for(var gt=0;gt<ft.length;++gt)et.putByte(ft[gt])}var _t=et.length();_t>e.blockLength&&(e.start(),e.update(et.bytes()),et=e.digest()),a=forge$d.util.createBuffer(),c=forge$d.util.createBuffer(),_t=et.length();for(var gt=0;gt<_t;++gt){var ft=et.at(gt);a.putByte(54^ft),c.putByte(92^ft)}if(_t<e.blockLength)for(var ft=e.blockLength-_t,gt=0;gt<ft;++gt)a.putByte(54),c.putByte(92);i=et,a=a.bytes(),c=c.bytes()}e.start(),e.update(a)},h.update=function(d){e.update(d)},h.getMac=function(){var d=e.digest().bytes();return e.start(),e.update(c),e.update(d),e.digest()},h.digest=h.getMac,h};const require$$1=getAugmentedNamespace(__viteBrowserExternal$1);var forge$c=forge$m,pkcs5=forge$c.pkcs5=forge$c.pkcs5||{},crypto$2;forge$c.util.isNodejs&&!forge$c.options.usePureJavaScript&&(crypto$2=require$$1);var pbkdf2$1=forge$c.pbkdf2=pkcs5.pbkdf2=function(i,e,a,c,h,d){if(typeof h=="function"&&(d=h,h=null),forge$c.util.isNodejs&&!forge$c.options.usePureJavaScript&&crypto$2.pbkdf2&&(h===null||typeof h!="object")&&(crypto$2.pbkdf2Sync.length>4||!h||h==="sha1"))return typeof h!="string"&&(h="sha1"),i=Buffer.from(i,"binary"),e=Buffer.from(e,"binary"),d?crypto$2.pbkdf2Sync.length===4?crypto$2.pbkdf2(i,e,a,c,function(Ft,jt){if(Ft)return d(Ft);d(null,jt.toString("binary"))}):crypto$2.pbkdf2(i,e,a,c,h,function(Ft,jt){if(Ft)return d(Ft);d(null,jt.toString("binary"))}):crypto$2.pbkdf2Sync.length===4?crypto$2.pbkdf2Sync(i,e,a,c).toString("binary"):crypto$2.pbkdf2Sync(i,e,a,c,h).toString("binary");if((typeof h>"u"||h===null)&&(h="sha1"),typeof h=="string"){if(!(h in forge$c.md.algorithms))throw new Error("Unknown hash algorithm: "+h);h=forge$c.md[h].create()}var et=h.digestLength;if(c>4294967295*et){var ft=new Error("Derived key is too long.");if(d)return d(ft);throw ft}var gt=Math.ceil(c/et),_t=c-(gt-1)*et,wt=forge$c.hmac.create();wt.start(h,i);var $t="",It,Rt,Tt;if(!d){for(var At=1;At<=gt;++At){wt.start(null,null),wt.update(e),wt.update(forge$c.util.int32ToBytes(At)),It=Tt=wt.digest().getBytes();for(var kt=2;kt<=a;++kt)wt.start(null,null),wt.update(Tt),Rt=wt.digest().getBytes(),It=forge$c.util.xorBytes(It,Rt,et),Tt=Rt;$t+=At<gt?It:It.substr(0,_t)}return $t}var At=1,kt;function xt(){if(At>gt)return d(null,$t);wt.start(null,null),wt.update(e),wt.update(forge$c.util.int32ToBytes(At)),It=Tt=wt.digest().getBytes(),kt=2,Nt()}function Nt(){if(kt<=a)return wt.start(null,null),wt.update(Tt),Rt=wt.digest().getBytes(),It=forge$c.util.xorBytes(It,Rt,et),Tt=Rt,++kt,forge$c.util.setImmediate(Nt);$t+=At<gt?It:It.substr(0,_t),++At,xt()}xt()};const forgePbkdf2=getDefaultExportFromCjs(pbkdf2$1);var forge$b=forge$m,pem=forge$b.pem=forge$b.pem||{};pem.encode=function(i,e){e=e||{};var a="-----BEGIN "+i.type+`-----\r
`,c;if(i.procType&&(c={name:"Proc-Type",values:[String(i.procType.version),i.procType.type]},a+=foldHeader(c)),i.contentDomain&&(c={name:"Content-Domain",values:[i.contentDomain]},a+=foldHeader(c)),i.dekInfo&&(c={name:"DEK-Info",values:[i.dekInfo.algorithm]},i.dekInfo.parameters&&c.values.push(i.dekInfo.parameters),a+=foldHeader(c)),i.headers)for(var h=0;h<i.headers.length;++h)a+=foldHeader(i.headers[h]);return i.procType&&(a+=`\r
`),a+=forge$b.util.encode64(i.body,e.maxline||64)+`\r
`,a+="-----END "+i.type+`-----\r
`,a};pem.decode=function(i){for(var e=[],a=/\s*-----BEGIN ([A-Z0-9- ]+)-----\r?\n?([\x21-\x7e\s]+?(?:\r?\n\r?\n))?([:A-Za-z0-9+\/=\s]+?)-----END \1-----/g,c=/([\x21-\x7e]+):\s*([\x21-\x7e\s^:]+)/,h=/\r?\n/,d;d=a.exec(i),!!d;){var et=d[1];et==="NEW CERTIFICATE REQUEST"&&(et="CERTIFICATE REQUEST");var ft={type:et,procType:null,contentDomain:null,dekInfo:null,headers:[],body:forge$b.util.decode64(d[3])};if(e.push(ft),!!d[2]){for(var gt=d[2].split(h),_t=0;d&&_t<gt.length;){for(var wt=gt[_t].replace(/\s+$/,""),$t=_t+1;$t<gt.length;++$t){var It=gt[$t];if(!/\s/.test(It[0]))break;wt+=It,_t=$t}if(d=wt.match(c),d){for(var Rt={name:d[1],values:[]},Tt=d[2].split(","),At=0;At<Tt.length;++At)Rt.values.push(ltrim(Tt[At]));if(ft.procType)if(!ft.contentDomain&&Rt.name==="Content-Domain")ft.contentDomain=Tt[0]||"";else if(!ft.dekInfo&&Rt.name==="DEK-Info"){if(Rt.values.length===0)throw new Error('Invalid PEM formatted message. The "DEK-Info" header must have at least one subfield.');ft.dekInfo={algorithm:Tt[0],parameters:Tt[1]||null}}else ft.headers.push(Rt);else{if(Rt.name!=="Proc-Type")throw new Error('Invalid PEM formatted message. The first encapsulated header must be "Proc-Type".');if(Rt.values.length!==2)throw new Error('Invalid PEM formatted message. The "Proc-Type" header must have two subfields.');ft.procType={version:Tt[0],type:Tt[1]}}}++_t}if(ft.procType==="ENCRYPTED"&&!ft.dekInfo)throw new Error('Invalid PEM formatted message. The "DEK-Info" header must be present if "Proc-Type" is "ENCRYPTED".')}}if(e.length===0)throw new Error("Invalid PEM formatted message.");return e};function foldHeader(i){for(var e=i.name+": ",a=[],c=function(gt,_t){return" "+_t},h=0;h<i.values.length;++h)a.push(i.values[h].replace(/^(\S+\r\n)/,c));e+=a.join(",")+`\r
`;for(var d=0,et=-1,h=0;h<e.length;++h,++d)if(d>65&&et!==-1){var ft=e[et];ft===","?(++et,e=e.substr(0,et)+`\r
 `+e.substr(et)):e=e.substr(0,et)+`\r
`+ft+e.substr(et+1),d=h-et-1,et=-1,++h}else(e[h]===" "||e[h]==="	"||e[h]===",")&&(et=h);return e}function ltrim(i){return i.replace(/^\s+/,"")}var forge$a=forge$m,sha256$1=forge$a.sha256=forge$a.sha256||{};forge$a.md.sha256=forge$a.md.algorithms.sha256=sha256$1;sha256$1.create=function(){_initialized$2||_init$2();var i=null,e=forge$a.util.createBuffer(),a=new Array(64),c={algorithm:"sha256",blockLength:64,digestLength:32,messageLength:0,fullMessageLength:null,messageLengthSize:8};return c.start=function(){c.messageLength=0,c.fullMessageLength=c.messageLength64=[];for(var h=c.messageLengthSize/4,d=0;d<h;++d)c.fullMessageLength.push(0);return e=forge$a.util.createBuffer(),i={h0:1779033703,h1:3144134277,h2:1013904242,h3:2773480762,h4:1359893119,h5:2600822924,h6:528734635,h7:1541459225},c},c.start(),c.update=function(h,d){d==="utf8"&&(h=forge$a.util.encodeUtf8(h));var et=h.length;c.messageLength+=et,et=[et/4294967296>>>0,et>>>0];for(var ft=c.fullMessageLength.length-1;ft>=0;--ft)c.fullMessageLength[ft]+=et[1],et[1]=et[0]+(c.fullMessageLength[ft]/4294967296>>>0),c.fullMessageLength[ft]=c.fullMessageLength[ft]>>>0,et[0]=et[1]/4294967296>>>0;return e.putBytes(h),_update$2(i,a,e),(e.read>2048||e.length()===0)&&e.compact(),c},c.digest=function(){var h=forge$a.util.createBuffer();h.putBytes(e.bytes());var d=c.fullMessageLength[c.fullMessageLength.length-1]+c.messageLengthSize,et=d&c.blockLength-1;h.putBytes(_padding$2.substr(0,c.blockLength-et));for(var ft,gt,_t=c.fullMessageLength[0]*8,wt=0;wt<c.fullMessageLength.length-1;++wt)ft=c.fullMessageLength[wt+1]*8,gt=ft/4294967296>>>0,_t+=gt,h.putInt32(_t>>>0),_t=ft>>>0;h.putInt32(_t);var $t={h0:i.h0,h1:i.h1,h2:i.h2,h3:i.h3,h4:i.h4,h5:i.h5,h6:i.h6,h7:i.h7};_update$2($t,a,h);var It=forge$a.util.createBuffer();return It.putInt32($t.h0),It.putInt32($t.h1),It.putInt32($t.h2),It.putInt32($t.h3),It.putInt32($t.h4),It.putInt32($t.h5),It.putInt32($t.h6),It.putInt32($t.h7),It},c};var _padding$2=null,_initialized$2=!1,_k$1=null;function _init$2(){_padding$2="",_padding$2+=forge$a.util.fillString("\0",64),_k$1=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],_initialized$2=!0}function _update$2(i,e,a){for(var c,h,d,et,ft,gt,_t,wt,$t,It,Rt,Tt,At,kt,xt,Nt=a.length();Nt>=64;){for(_t=0;_t<16;++_t)e[_t]=a.getInt32();for(;_t<64;++_t)c=e[_t-2],c=(c>>>17|c<<15)^(c>>>19|c<<13)^c>>>10,h=e[_t-15],h=(h>>>7|h<<25)^(h>>>18|h<<14)^h>>>3,e[_t]=c+e[_t-7]+h+e[_t-16]|0;for(wt=i.h0,$t=i.h1,It=i.h2,Rt=i.h3,Tt=i.h4,At=i.h5,kt=i.h6,xt=i.h7,_t=0;_t<64;++_t)et=(Tt>>>6|Tt<<26)^(Tt>>>11|Tt<<21)^(Tt>>>25|Tt<<7),ft=kt^Tt&(At^kt),d=(wt>>>2|wt<<30)^(wt>>>13|wt<<19)^(wt>>>22|wt<<10),gt=wt&$t|It&(wt^$t),c=xt+et+ft+_k$1[_t]+e[_t],h=d+gt,xt=kt,kt=At,At=Tt,Tt=Rt+c>>>0,Rt=It,It=$t,$t=wt,wt=c+h>>>0;i.h0=i.h0+wt|0,i.h1=i.h1+$t|0,i.h2=i.h2+It|0,i.h3=i.h3+Rt|0,i.h4=i.h4+Tt|0,i.h5=i.h5+At|0,i.h6=i.h6+kt|0,i.h7=i.h7+xt|0,Nt-=64}}var forge$9=forge$m,_crypto$1=null;forge$9.util.isNodejs&&!forge$9.options.usePureJavaScript&&!process.versions["node-webkit"]&&(_crypto$1=require$$1);var prng=forge$9.prng=forge$9.prng||{};prng.create=function(i){for(var e={plugin:i,key:null,seed:null,time:null,reseeds:0,generated:0,keyBytes:""},a=i.md,c=new Array(32),h=0;h<32;++h)c[h]=a.create();e.pools=c,e.pool=0,e.generate=function(_t,wt){if(!wt)return e.generateSync(_t);var $t=e.plugin.cipher,It=e.plugin.increment,Rt=e.plugin.formatKey,Tt=e.plugin.formatSeed,At=forge$9.util.createBuffer();e.key=null,kt();function kt(xt){if(xt)return wt(xt);if(At.length()>=_t)return wt(null,At.getBytes(_t));if(e.generated>1048575&&(e.key=null),e.key===null)return forge$9.util.nextTick(function(){d(kt)});var Nt=$t(e.key,e.seed);e.generated+=Nt.length,At.putBytes(Nt),e.key=Rt($t(e.key,It(e.seed))),e.seed=Tt($t(e.key,e.seed)),forge$9.util.setImmediate(kt)}},e.generateSync=function(_t){var wt=e.plugin.cipher,$t=e.plugin.increment,It=e.plugin.formatKey,Rt=e.plugin.formatSeed;e.key=null;for(var Tt=forge$9.util.createBuffer();Tt.length()<_t;){e.generated>1048575&&(e.key=null),e.key===null&&et();var At=wt(e.key,e.seed);e.generated+=At.length,Tt.putBytes(At),e.key=It(wt(e.key,$t(e.seed))),e.seed=Rt(wt(e.key,e.seed))}return Tt.getBytes(_t)};function d(_t){if(e.pools[0].messageLength>=32)return ft(),_t();var wt=32-e.pools[0].messageLength<<5;e.seedFile(wt,function($t,It){if($t)return _t($t);e.collect(It),ft(),_t()})}function et(){if(e.pools[0].messageLength>=32)return ft();var _t=32-e.pools[0].messageLength<<5;e.collect(e.seedFileSync(_t)),ft()}function ft(){e.reseeds=e.reseeds===4294967295?0:e.reseeds+1;var _t=e.plugin.md.create();_t.update(e.keyBytes);for(var wt=1,$t=0;$t<32;++$t)e.reseeds%wt===0&&(_t.update(e.pools[$t].digest().getBytes()),e.pools[$t].start()),wt=wt<<1;e.keyBytes=_t.digest().getBytes(),_t.start(),_t.update(e.keyBytes);var It=_t.digest().getBytes();e.key=e.plugin.formatKey(e.keyBytes),e.seed=e.plugin.formatSeed(It),e.generated=0}function gt(_t){var wt=null,$t=forge$9.util.globalScope,It=$t.crypto||$t.msCrypto;It&&It.getRandomValues&&(wt=function(Gt){return It.getRandomValues(Gt)});var Rt=forge$9.util.createBuffer();if(wt)for(;Rt.length()<_t;){var Tt=Math.max(1,Math.min(_t-Rt.length(),65536)/4),At=new Uint32Array(Math.floor(Tt));try{wt(At);for(var kt=0;kt<At.length;++kt)Rt.putInt32(At[kt])}catch(Gt){if(!(typeof QuotaExceededError<"u"&&Gt instanceof QuotaExceededError))throw Gt}}if(Rt.length()<_t)for(var xt,Nt,Ft,jt=Math.floor(Math.random()*65536);Rt.length()<_t;){Nt=16807*(jt&65535),xt=16807*(jt>>16),Nt+=(xt&32767)<<16,Nt+=xt>>15,Nt=(Nt&2147483647)+(Nt>>31),jt=Nt&4294967295;for(var kt=0;kt<3;++kt)Ft=jt>>>(kt<<3),Ft^=Math.floor(Math.random()*256),Rt.putByte(Ft&255)}return Rt.getBytes(_t)}return _crypto$1?(e.seedFile=function(_t,wt){_crypto$1.randomBytes(_t,function($t,It){if($t)return wt($t);wt(null,It.toString())})},e.seedFileSync=function(_t){return _crypto$1.randomBytes(_t).toString()}):(e.seedFile=function(_t,wt){try{wt(null,gt(_t))}catch($t){wt($t)}},e.seedFileSync=gt),e.collect=function(_t){for(var wt=_t.length,$t=0;$t<wt;++$t)e.pools[e.pool].update(_t.substr($t,1)),e.pool=e.pool===31?0:e.pool+1},e.collectInt=function(_t,wt){for(var $t="",It=0;It<wt;It+=8)$t+=String.fromCharCode(_t>>It&255);e.collect($t)},e.registerWorker=function(_t){if(_t===self)e.seedFile=function($t,It){function Rt(Tt){var At=Tt.data;At.forge&&At.forge.prng&&(self.removeEventListener("message",Rt),It(At.forge.prng.err,At.forge.prng.bytes))}self.addEventListener("message",Rt),self.postMessage({forge:{prng:{needed:$t}}})};else{var wt=function($t){var It=$t.data;It.forge&&It.forge.prng&&e.seedFile(It.forge.prng.needed,function(Rt,Tt){_t.postMessage({forge:{prng:{err:Rt,bytes:Tt}}})})};_t.addEventListener("message",wt)}},e};var forge$8=forge$m;(function(){if(forge$8.random&&forge$8.random.getBytes){forge$8.random;return}(function(i){var e={},a=new Array(4),c=forge$8.util.createBuffer();e.formatKey=function($t){var It=forge$8.util.createBuffer($t);return $t=new Array(4),$t[0]=It.getInt32(),$t[1]=It.getInt32(),$t[2]=It.getInt32(),$t[3]=It.getInt32(),forge$8.aes._expandKey($t,!1)},e.formatSeed=function($t){var It=forge$8.util.createBuffer($t);return $t=new Array(4),$t[0]=It.getInt32(),$t[1]=It.getInt32(),$t[2]=It.getInt32(),$t[3]=It.getInt32(),$t},e.cipher=function($t,It){return forge$8.aes._updateBlock($t,It,a,!1),c.putInt32(a[0]),c.putInt32(a[1]),c.putInt32(a[2]),c.putInt32(a[3]),c.getBytes()},e.increment=function($t){return++$t[3],$t},e.md=forge$8.md.sha256;function h(){var $t=forge$8.prng.create(e);return $t.getBytes=function(It,Rt){return $t.generate(It,Rt)},$t.getBytesSync=function(It){return $t.generate(It)},$t}var d=h(),et=null,ft=forge$8.util.globalScope,gt=ft.crypto||ft.msCrypto;if(gt&&gt.getRandomValues&&(et=function($t){return gt.getRandomValues($t)}),forge$8.options.usePureJavaScript||!forge$8.util.isNodejs&&!et){if(d.collectInt(+new Date,32),typeof navigator<"u"){var _t="";for(var wt in navigator)try{typeof navigator[wt]=="string"&&(_t+=navigator[wt])}catch{}d.collect(_t),_t=null}i&&(i().mousemove(function($t){d.collectInt($t.clientX,16),d.collectInt($t.clientY,16)}),i().keypress(function($t){d.collectInt($t.charCode,8)}))}if(!forge$8.random)forge$8.random=d;else for(var wt in d)forge$8.random[wt]=d[wt];forge$8.random.createInstance=h,forge$8.random})(typeof jQuery<"u"?jQuery:null)})();var forge$7=forge$m,piTable=[217,120,249,196,25,221,181,237,40,233,253,121,74,160,216,157,198,126,55,131,43,118,83,142,98,76,100,136,68,139,251,162,23,154,89,245,135,179,79,19,97,69,109,141,9,129,125,50,189,143,64,235,134,183,123,11,240,149,33,34,92,107,78,130,84,214,101,147,206,96,178,28,115,86,192,20,167,140,241,220,18,117,202,31,59,190,228,209,66,61,212,48,163,60,182,38,111,191,14,218,70,105,7,87,39,242,29,155,188,148,67,3,248,17,199,246,144,239,62,231,6,195,213,47,200,102,30,215,8,232,234,222,128,82,238,247,132,170,114,172,53,77,106,42,150,26,210,113,90,21,73,116,75,159,208,94,4,24,164,236,194,224,65,110,15,81,203,204,36,145,175,80,161,244,112,57,153,124,58,133,35,184,180,122,252,2,54,91,37,85,151,49,45,93,250,152,227,138,146,174,5,223,41,16,103,108,186,201,211,0,230,207,225,158,168,44,99,22,1,63,88,226,137,169,13,56,52,27,171,51,255,176,187,72,12,95,185,177,205,46,197,243,219,71,229,165,156,119,10,166,32,104,254,127,193,173],s=[1,2,3,5],rol=function(i,e){return i<<e&65535|(i&65535)>>16-e},ror=function(i,e){return(i&65535)>>e|i<<16-e&65535};forge$7.rc2=forge$7.rc2||{};forge$7.rc2.expandKey=function(i,e){typeof i=="string"&&(i=forge$7.util.createBuffer(i)),e=e||128;var a=i,c=i.length(),h=e,d=Math.ceil(h/8),et=255>>(h&7),ft;for(ft=c;ft<128;ft++)a.putByte(piTable[a.at(ft-1)+a.at(ft-c)&255]);for(a.setAt(128-d,piTable[a.at(128-d)&et]),ft=127-d;ft>=0;ft--)a.setAt(ft,piTable[a.at(ft+1)^a.at(ft+d)]);return a};var createCipher$1=function(i,e,a){var c=!1,h=null,d=null,et=null,ft,gt,_t,wt,$t=[];for(i=forge$7.rc2.expandKey(i,e),_t=0;_t<64;_t++)$t.push(i.getInt16Le());a?(ft=function(Tt){for(_t=0;_t<4;_t++)Tt[_t]+=$t[wt]+(Tt[(_t+3)%4]&Tt[(_t+2)%4])+(~Tt[(_t+3)%4]&Tt[(_t+1)%4]),Tt[_t]=rol(Tt[_t],s[_t]),wt++},gt=function(Tt){for(_t=0;_t<4;_t++)Tt[_t]+=$t[Tt[(_t+3)%4]&63]}):(ft=function(Tt){for(_t=3;_t>=0;_t--)Tt[_t]=ror(Tt[_t],s[_t]),Tt[_t]-=$t[wt]+(Tt[(_t+3)%4]&Tt[(_t+2)%4])+(~Tt[(_t+3)%4]&Tt[(_t+1)%4]),wt--},gt=function(Tt){for(_t=3;_t>=0;_t--)Tt[_t]-=$t[Tt[(_t+3)%4]&63]});var It=function(Tt){var At=[];for(_t=0;_t<4;_t++){var kt=h.getInt16Le();et!==null&&(a?kt^=et.getInt16Le():et.putInt16Le(kt)),At.push(kt&65535)}wt=a?0:63;for(var xt=0;xt<Tt.length;xt++)for(var Nt=0;Nt<Tt[xt][0];Nt++)Tt[xt][1](At);for(_t=0;_t<4;_t++)et!==null&&(a?et.putInt16Le(At[_t]):At[_t]^=et.getInt16Le()),d.putInt16Le(At[_t])},Rt=null;return Rt={start:function(Tt,At){Tt&&typeof Tt=="string"&&(Tt=forge$7.util.createBuffer(Tt)),c=!1,h=forge$7.util.createBuffer(),d=At||new forge$7.util.createBuffer,et=Tt,Rt.output=d},update:function(Tt){for(c||h.putBuffer(Tt);h.length()>=8;)It([[5,ft],[1,gt],[6,ft],[1,gt],[5,ft]])},finish:function(Tt){var At=!0;if(a)if(Tt)At=Tt(8,h,!a);else{var kt=h.length()===8?8:8-h.length();h.fillWithByte(kt,kt)}if(At&&(c=!0,Rt.update()),!a&&(At=h.length()===0,At))if(Tt)At=Tt(8,d,!a);else{var xt=d.length(),Nt=d.at(xt-1);Nt>xt?At=!1:d.truncate(Nt)}return At}},Rt};forge$7.rc2.startEncrypting=function(i,e,a){var c=forge$7.rc2.createEncryptionCipher(i,128);return c.start(e,a),c};forge$7.rc2.createEncryptionCipher=function(i,e){return createCipher$1(i,e,!0)};forge$7.rc2.startDecrypting=function(i,e,a){var c=forge$7.rc2.createDecryptionCipher(i,128);return c.start(e,a),c};forge$7.rc2.createDecryptionCipher=function(i,e){return createCipher$1(i,e,!1)};var forge$6=forge$m;forge$6.jsbn=forge$6.jsbn||{};var dbits;function BigInteger$2(i,e,a){this.data=[],i!=null&&(typeof i=="number"?this.fromNumber(i,e,a):e==null&&typeof i!="string"?this.fromString(i,256):this.fromString(i,e))}forge$6.jsbn.BigInteger=BigInteger$2;function nbi(){return new BigInteger$2(null)}function am1(i,e,a,c,h,d){for(;--d>=0;){var et=e*this.data[i++]+a.data[c]+h;h=Math.floor(et/67108864),a.data[c++]=et&67108863}return h}function am2(i,e,a,c,h,d){for(var et=e&32767,ft=e>>15;--d>=0;){var gt=this.data[i]&32767,_t=this.data[i++]>>15,wt=ft*gt+_t*et;gt=et*gt+((wt&32767)<<15)+a.data[c]+(h&1073741823),h=(gt>>>30)+(wt>>>15)+ft*_t+(h>>>30),a.data[c++]=gt&1073741823}return h}function am3(i,e,a,c,h,d){for(var et=e&16383,ft=e>>14;--d>=0;){var gt=this.data[i]&16383,_t=this.data[i++]>>14,wt=ft*gt+_t*et;gt=et*gt+((wt&16383)<<14)+a.data[c]+h,h=(gt>>28)+(wt>>14)+ft*_t,a.data[c++]=gt&268435455}return h}typeof navigator>"u"?(BigInteger$2.prototype.am=am3,dbits=28):navigator.appName=="Microsoft Internet Explorer"?(BigInteger$2.prototype.am=am2,dbits=30):navigator.appName!="Netscape"?(BigInteger$2.prototype.am=am1,dbits=26):(BigInteger$2.prototype.am=am3,dbits=28);BigInteger$2.prototype.DB=dbits;BigInteger$2.prototype.DM=(1<<dbits)-1;BigInteger$2.prototype.DV=1<<dbits;var BI_FP=52;BigInteger$2.prototype.FV=Math.pow(2,BI_FP);BigInteger$2.prototype.F1=BI_FP-dbits;BigInteger$2.prototype.F2=2*dbits-BI_FP;var BI_RM="0123456789abcdefghijklmnopqrstuvwxyz",BI_RC=new Array,rr,vv;rr=48;for(vv=0;vv<=9;++vv)BI_RC[rr++]=vv;rr=97;for(vv=10;vv<36;++vv)BI_RC[rr++]=vv;rr=65;for(vv=10;vv<36;++vv)BI_RC[rr++]=vv;function int2char(i){return BI_RM.charAt(i)}function intAt(i,e){var a=BI_RC[i.charCodeAt(e)];return a??-1}function bnpCopyTo(i){for(var e=this.t-1;e>=0;--e)i.data[e]=this.data[e];i.t=this.t,i.s=this.s}function bnpFromInt(i){this.t=1,this.s=i<0?-1:0,i>0?this.data[0]=i:i<-1?this.data[0]=i+this.DV:this.t=0}function nbv(i){var e=nbi();return e.fromInt(i),e}function bnpFromString(i,e){var a;if(e==16)a=4;else if(e==8)a=3;else if(e==256)a=8;else if(e==2)a=1;else if(e==32)a=5;else if(e==4)a=2;else{this.fromRadix(i,e);return}this.t=0,this.s=0;for(var c=i.length,h=!1,d=0;--c>=0;){var et=a==8?i[c]&255:intAt(i,c);if(et<0){i.charAt(c)=="-"&&(h=!0);continue}h=!1,d==0?this.data[this.t++]=et:d+a>this.DB?(this.data[this.t-1]|=(et&(1<<this.DB-d)-1)<<d,this.data[this.t++]=et>>this.DB-d):this.data[this.t-1]|=et<<d,d+=a,d>=this.DB&&(d-=this.DB)}a==8&&i[0]&128&&(this.s=-1,d>0&&(this.data[this.t-1]|=(1<<this.DB-d)-1<<d)),this.clamp(),h&&BigInteger$2.ZERO.subTo(this,this)}function bnpClamp(){for(var i=this.s&this.DM;this.t>0&&this.data[this.t-1]==i;)--this.t}function bnToString(i){if(this.s<0)return"-"+this.negate().toString(i);var e;if(i==16)e=4;else if(i==8)e=3;else if(i==2)e=1;else if(i==32)e=5;else if(i==4)e=2;else return this.toRadix(i);var a=(1<<e)-1,c,h=!1,d="",et=this.t,ft=this.DB-et*this.DB%e;if(et-- >0)for(ft<this.DB&&(c=this.data[et]>>ft)>0&&(h=!0,d=int2char(c));et>=0;)ft<e?(c=(this.data[et]&(1<<ft)-1)<<e-ft,c|=this.data[--et]>>(ft+=this.DB-e)):(c=this.data[et]>>(ft-=e)&a,ft<=0&&(ft+=this.DB,--et)),c>0&&(h=!0),h&&(d+=int2char(c));return h?d:"0"}function bnNegate(){var i=nbi();return BigInteger$2.ZERO.subTo(this,i),i}function bnAbs(){return this.s<0?this.negate():this}function bnCompareTo(i){var e=this.s-i.s;if(e!=0)return e;var a=this.t;if(e=a-i.t,e!=0)return this.s<0?-e:e;for(;--a>=0;)if((e=this.data[a]-i.data[a])!=0)return e;return 0}function nbits(i){var e=1,a;return(a=i>>>16)!=0&&(i=a,e+=16),(a=i>>8)!=0&&(i=a,e+=8),(a=i>>4)!=0&&(i=a,e+=4),(a=i>>2)!=0&&(i=a,e+=2),(a=i>>1)!=0&&(i=a,e+=1),e}function bnBitLength(){return this.t<=0?0:this.DB*(this.t-1)+nbits(this.data[this.t-1]^this.s&this.DM)}function bnpDLShiftTo(i,e){var a;for(a=this.t-1;a>=0;--a)e.data[a+i]=this.data[a];for(a=i-1;a>=0;--a)e.data[a]=0;e.t=this.t+i,e.s=this.s}function bnpDRShiftTo(i,e){for(var a=i;a<this.t;++a)e.data[a-i]=this.data[a];e.t=Math.max(this.t-i,0),e.s=this.s}function bnpLShiftTo(i,e){var a=i%this.DB,c=this.DB-a,h=(1<<c)-1,d=Math.floor(i/this.DB),et=this.s<<a&this.DM,ft;for(ft=this.t-1;ft>=0;--ft)e.data[ft+d+1]=this.data[ft]>>c|et,et=(this.data[ft]&h)<<a;for(ft=d-1;ft>=0;--ft)e.data[ft]=0;e.data[d]=et,e.t=this.t+d+1,e.s=this.s,e.clamp()}function bnpRShiftTo(i,e){e.s=this.s;var a=Math.floor(i/this.DB);if(a>=this.t){e.t=0;return}var c=i%this.DB,h=this.DB-c,d=(1<<c)-1;e.data[0]=this.data[a]>>c;for(var et=a+1;et<this.t;++et)e.data[et-a-1]|=(this.data[et]&d)<<h,e.data[et-a]=this.data[et]>>c;c>0&&(e.data[this.t-a-1]|=(this.s&d)<<h),e.t=this.t-a,e.clamp()}function bnpSubTo(i,e){for(var a=0,c=0,h=Math.min(i.t,this.t);a<h;)c+=this.data[a]-i.data[a],e.data[a++]=c&this.DM,c>>=this.DB;if(i.t<this.t){for(c-=i.s;a<this.t;)c+=this.data[a],e.data[a++]=c&this.DM,c>>=this.DB;c+=this.s}else{for(c+=this.s;a<i.t;)c-=i.data[a],e.data[a++]=c&this.DM,c>>=this.DB;c-=i.s}e.s=c<0?-1:0,c<-1?e.data[a++]=this.DV+c:c>0&&(e.data[a++]=c),e.t=a,e.clamp()}function bnpMultiplyTo(i,e){var a=this.abs(),c=i.abs(),h=a.t;for(e.t=h+c.t;--h>=0;)e.data[h]=0;for(h=0;h<c.t;++h)e.data[h+a.t]=a.am(0,c.data[h],e,h,0,a.t);e.s=0,e.clamp(),this.s!=i.s&&BigInteger$2.ZERO.subTo(e,e)}function bnpSquareTo(i){for(var e=this.abs(),a=i.t=2*e.t;--a>=0;)i.data[a]=0;for(a=0;a<e.t-1;++a){var c=e.am(a,e.data[a],i,2*a,0,1);(i.data[a+e.t]+=e.am(a+1,2*e.data[a],i,2*a+1,c,e.t-a-1))>=e.DV&&(i.data[a+e.t]-=e.DV,i.data[a+e.t+1]=1)}i.t>0&&(i.data[i.t-1]+=e.am(a,e.data[a],i,2*a,0,1)),i.s=0,i.clamp()}function bnpDivRemTo(i,e,a){var c=i.abs();if(!(c.t<=0)){var h=this.abs();if(h.t<c.t){e!=null&&e.fromInt(0),a!=null&&this.copyTo(a);return}a==null&&(a=nbi());var d=nbi(),et=this.s,ft=i.s,gt=this.DB-nbits(c.data[c.t-1]);gt>0?(c.lShiftTo(gt,d),h.lShiftTo(gt,a)):(c.copyTo(d),h.copyTo(a));var _t=d.t,wt=d.data[_t-1];if(wt!=0){var $t=wt*(1<<this.F1)+(_t>1?d.data[_t-2]>>this.F2:0),It=this.FV/$t,Rt=(1<<this.F1)/$t,Tt=1<<this.F2,At=a.t,kt=At-_t,xt=e??nbi();for(d.dlShiftTo(kt,xt),a.compareTo(xt)>=0&&(a.data[a.t++]=1,a.subTo(xt,a)),BigInteger$2.ONE.dlShiftTo(_t,xt),xt.subTo(d,d);d.t<_t;)d.data[d.t++]=0;for(;--kt>=0;){var Nt=a.data[--At]==wt?this.DM:Math.floor(a.data[At]*It+(a.data[At-1]+Tt)*Rt);if((a.data[At]+=d.am(0,Nt,a,kt,0,_t))<Nt)for(d.dlShiftTo(kt,xt),a.subTo(xt,a);a.data[At]<--Nt;)a.subTo(xt,a)}e!=null&&(a.drShiftTo(_t,e),et!=ft&&BigInteger$2.ZERO.subTo(e,e)),a.t=_t,a.clamp(),gt>0&&a.rShiftTo(gt,a),et<0&&BigInteger$2.ZERO.subTo(a,a)}}}function bnMod(i){var e=nbi();return this.abs().divRemTo(i,null,e),this.s<0&&e.compareTo(BigInteger$2.ZERO)>0&&i.subTo(e,e),e}function Classic(i){this.m=i}function cConvert(i){return i.s<0||i.compareTo(this.m)>=0?i.mod(this.m):i}function cRevert(i){return i}function cReduce(i){i.divRemTo(this.m,null,i)}function cMulTo(i,e,a){i.multiplyTo(e,a),this.reduce(a)}function cSqrTo(i,e){i.squareTo(e),this.reduce(e)}Classic.prototype.convert=cConvert;Classic.prototype.revert=cRevert;Classic.prototype.reduce=cReduce;Classic.prototype.mulTo=cMulTo;Classic.prototype.sqrTo=cSqrTo;function bnpInvDigit(){if(this.t<1)return 0;var i=this.data[0];if(!(i&1))return 0;var e=i&3;return e=e*(2-(i&15)*e)&15,e=e*(2-(i&255)*e)&255,e=e*(2-((i&65535)*e&65535))&65535,e=e*(2-i*e%this.DV)%this.DV,e>0?this.DV-e:-e}function Montgomery(i){this.m=i,this.mp=i.invDigit(),this.mpl=this.mp&32767,this.mph=this.mp>>15,this.um=(1<<i.DB-15)-1,this.mt2=2*i.t}function montConvert(i){var e=nbi();return i.abs().dlShiftTo(this.m.t,e),e.divRemTo(this.m,null,e),i.s<0&&e.compareTo(BigInteger$2.ZERO)>0&&this.m.subTo(e,e),e}function montRevert(i){var e=nbi();return i.copyTo(e),this.reduce(e),e}function montReduce(i){for(;i.t<=this.mt2;)i.data[i.t++]=0;for(var e=0;e<this.m.t;++e){var a=i.data[e]&32767,c=a*this.mpl+((a*this.mph+(i.data[e]>>15)*this.mpl&this.um)<<15)&i.DM;for(a=e+this.m.t,i.data[a]+=this.m.am(0,c,i,e,0,this.m.t);i.data[a]>=i.DV;)i.data[a]-=i.DV,i.data[++a]++}i.clamp(),i.drShiftTo(this.m.t,i),i.compareTo(this.m)>=0&&i.subTo(this.m,i)}function montSqrTo(i,e){i.squareTo(e),this.reduce(e)}function montMulTo(i,e,a){i.multiplyTo(e,a),this.reduce(a)}Montgomery.prototype.convert=montConvert;Montgomery.prototype.revert=montRevert;Montgomery.prototype.reduce=montReduce;Montgomery.prototype.mulTo=montMulTo;Montgomery.prototype.sqrTo=montSqrTo;function bnpIsEven(){return(this.t>0?this.data[0]&1:this.s)==0}function bnpExp(i,e){if(i>4294967295||i<1)return BigInteger$2.ONE;var a=nbi(),c=nbi(),h=e.convert(this),d=nbits(i)-1;for(h.copyTo(a);--d>=0;)if(e.sqrTo(a,c),(i&1<<d)>0)e.mulTo(c,h,a);else{var et=a;a=c,c=et}return e.revert(a)}function bnModPowInt(i,e){var a;return i<256||e.isEven()?a=new Classic(e):a=new Montgomery(e),this.exp(i,a)}BigInteger$2.prototype.copyTo=bnpCopyTo;BigInteger$2.prototype.fromInt=bnpFromInt;BigInteger$2.prototype.fromString=bnpFromString;BigInteger$2.prototype.clamp=bnpClamp;BigInteger$2.prototype.dlShiftTo=bnpDLShiftTo;BigInteger$2.prototype.drShiftTo=bnpDRShiftTo;BigInteger$2.prototype.lShiftTo=bnpLShiftTo;BigInteger$2.prototype.rShiftTo=bnpRShiftTo;BigInteger$2.prototype.subTo=bnpSubTo;BigInteger$2.prototype.multiplyTo=bnpMultiplyTo;BigInteger$2.prototype.squareTo=bnpSquareTo;BigInteger$2.prototype.divRemTo=bnpDivRemTo;BigInteger$2.prototype.invDigit=bnpInvDigit;BigInteger$2.prototype.isEven=bnpIsEven;BigInteger$2.prototype.exp=bnpExp;BigInteger$2.prototype.toString=bnToString;BigInteger$2.prototype.negate=bnNegate;BigInteger$2.prototype.abs=bnAbs;BigInteger$2.prototype.compareTo=bnCompareTo;BigInteger$2.prototype.bitLength=bnBitLength;BigInteger$2.prototype.mod=bnMod;BigInteger$2.prototype.modPowInt=bnModPowInt;BigInteger$2.ZERO=nbv(0);BigInteger$2.ONE=nbv(1);function bnClone(){var i=nbi();return this.copyTo(i),i}function bnIntValue(){if(this.s<0){if(this.t==1)return this.data[0]-this.DV;if(this.t==0)return-1}else{if(this.t==1)return this.data[0];if(this.t==0)return 0}return(this.data[1]&(1<<32-this.DB)-1)<<this.DB|this.data[0]}function bnByteValue(){return this.t==0?this.s:this.data[0]<<24>>24}function bnShortValue(){return this.t==0?this.s:this.data[0]<<16>>16}function bnpChunkSize(i){return Math.floor(Math.LN2*this.DB/Math.log(i))}function bnSigNum(){return this.s<0?-1:this.t<=0||this.t==1&&this.data[0]<=0?0:1}function bnpToRadix(i){if(i==null&&(i=10),this.signum()==0||i<2||i>36)return"0";var e=this.chunkSize(i),a=Math.pow(i,e),c=nbv(a),h=nbi(),d=nbi(),et="";for(this.divRemTo(c,h,d);h.signum()>0;)et=(a+d.intValue()).toString(i).substr(1)+et,h.divRemTo(c,h,d);return d.intValue().toString(i)+et}function bnpFromRadix(i,e){this.fromInt(0),e==null&&(e=10);for(var a=this.chunkSize(e),c=Math.pow(e,a),h=!1,d=0,et=0,ft=0;ft<i.length;++ft){var gt=intAt(i,ft);if(gt<0){i.charAt(ft)=="-"&&this.signum()==0&&(h=!0);continue}et=e*et+gt,++d>=a&&(this.dMultiply(c),this.dAddOffset(et,0),d=0,et=0)}d>0&&(this.dMultiply(Math.pow(e,d)),this.dAddOffset(et,0)),h&&BigInteger$2.ZERO.subTo(this,this)}function bnpFromNumber(i,e,a){if(typeof e=="number")if(i<2)this.fromInt(1);else for(this.fromNumber(i,a),this.testBit(i-1)||this.bitwiseTo(BigInteger$2.ONE.shiftLeft(i-1),op_or,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(e);)this.dAddOffset(2,0),this.bitLength()>i&&this.subTo(BigInteger$2.ONE.shiftLeft(i-1),this);else{var c=new Array,h=i&7;c.length=(i>>3)+1,e.nextBytes(c),h>0?c[0]&=(1<<h)-1:c[0]=0,this.fromString(c,256)}}function bnToByteArray(){var i=this.t,e=new Array;e[0]=this.s;var a=this.DB-i*this.DB%8,c,h=0;if(i-- >0)for(a<this.DB&&(c=this.data[i]>>a)!=(this.s&this.DM)>>a&&(e[h++]=c|this.s<<this.DB-a);i>=0;)a<8?(c=(this.data[i]&(1<<a)-1)<<8-a,c|=this.data[--i]>>(a+=this.DB-8)):(c=this.data[i]>>(a-=8)&255,a<=0&&(a+=this.DB,--i)),c&128&&(c|=-256),h==0&&(this.s&128)!=(c&128)&&++h,(h>0||c!=this.s)&&(e[h++]=c);return e}function bnEquals(i){return this.compareTo(i)==0}function bnMin(i){return this.compareTo(i)<0?this:i}function bnMax(i){return this.compareTo(i)>0?this:i}function bnpBitwiseTo(i,e,a){var c,h,d=Math.min(i.t,this.t);for(c=0;c<d;++c)a.data[c]=e(this.data[c],i.data[c]);if(i.t<this.t){for(h=i.s&this.DM,c=d;c<this.t;++c)a.data[c]=e(this.data[c],h);a.t=this.t}else{for(h=this.s&this.DM,c=d;c<i.t;++c)a.data[c]=e(h,i.data[c]);a.t=i.t}a.s=e(this.s,i.s),a.clamp()}function op_and(i,e){return i&e}function bnAnd(i){var e=nbi();return this.bitwiseTo(i,op_and,e),e}function op_or(i,e){return i|e}function bnOr(i){var e=nbi();return this.bitwiseTo(i,op_or,e),e}function op_xor(i,e){return i^e}function bnXor(i){var e=nbi();return this.bitwiseTo(i,op_xor,e),e}function op_andnot(i,e){return i&~e}function bnAndNot(i){var e=nbi();return this.bitwiseTo(i,op_andnot,e),e}function bnNot(){for(var i=nbi(),e=0;e<this.t;++e)i.data[e]=this.DM&~this.data[e];return i.t=this.t,i.s=~this.s,i}function bnShiftLeft(i){var e=nbi();return i<0?this.rShiftTo(-i,e):this.lShiftTo(i,e),e}function bnShiftRight(i){var e=nbi();return i<0?this.lShiftTo(-i,e):this.rShiftTo(i,e),e}function lbit(i){if(i==0)return-1;var e=0;return i&65535||(i>>=16,e+=16),i&255||(i>>=8,e+=8),i&15||(i>>=4,e+=4),i&3||(i>>=2,e+=2),i&1||++e,e}function bnGetLowestSetBit(){for(var i=0;i<this.t;++i)if(this.data[i]!=0)return i*this.DB+lbit(this.data[i]);return this.s<0?this.t*this.DB:-1}function cbit(i){for(var e=0;i!=0;)i&=i-1,++e;return e}function bnBitCount(){for(var i=0,e=this.s&this.DM,a=0;a<this.t;++a)i+=cbit(this.data[a]^e);return i}function bnTestBit(i){var e=Math.floor(i/this.DB);return e>=this.t?this.s!=0:(this.data[e]&1<<i%this.DB)!=0}function bnpChangeBit(i,e){var a=BigInteger$2.ONE.shiftLeft(i);return this.bitwiseTo(a,e,a),a}function bnSetBit(i){return this.changeBit(i,op_or)}function bnClearBit(i){return this.changeBit(i,op_andnot)}function bnFlipBit(i){return this.changeBit(i,op_xor)}function bnpAddTo(i,e){for(var a=0,c=0,h=Math.min(i.t,this.t);a<h;)c+=this.data[a]+i.data[a],e.data[a++]=c&this.DM,c>>=this.DB;if(i.t<this.t){for(c+=i.s;a<this.t;)c+=this.data[a],e.data[a++]=c&this.DM,c>>=this.DB;c+=this.s}else{for(c+=this.s;a<i.t;)c+=i.data[a],e.data[a++]=c&this.DM,c>>=this.DB;c+=i.s}e.s=c<0?-1:0,c>0?e.data[a++]=c:c<-1&&(e.data[a++]=this.DV+c),e.t=a,e.clamp()}function bnAdd(i){var e=nbi();return this.addTo(i,e),e}function bnSubtract(i){var e=nbi();return this.subTo(i,e),e}function bnMultiply(i){var e=nbi();return this.multiplyTo(i,e),e}function bnDivide(i){var e=nbi();return this.divRemTo(i,e,null),e}function bnRemainder(i){var e=nbi();return this.divRemTo(i,null,e),e}function bnDivideAndRemainder(i){var e=nbi(),a=nbi();return this.divRemTo(i,e,a),new Array(e,a)}function bnpDMultiply(i){this.data[this.t]=this.am(0,i-1,this,0,0,this.t),++this.t,this.clamp()}function bnpDAddOffset(i,e){if(i!=0){for(;this.t<=e;)this.data[this.t++]=0;for(this.data[e]+=i;this.data[e]>=this.DV;)this.data[e]-=this.DV,++e>=this.t&&(this.data[this.t++]=0),++this.data[e]}}function NullExp(){}function nNop(i){return i}function nMulTo(i,e,a){i.multiplyTo(e,a)}function nSqrTo(i,e){i.squareTo(e)}NullExp.prototype.convert=nNop;NullExp.prototype.revert=nNop;NullExp.prototype.mulTo=nMulTo;NullExp.prototype.sqrTo=nSqrTo;function bnPow(i){return this.exp(i,new NullExp)}function bnpMultiplyLowerTo(i,e,a){var c=Math.min(this.t+i.t,e);for(a.s=0,a.t=c;c>0;)a.data[--c]=0;var h;for(h=a.t-this.t;c<h;++c)a.data[c+this.t]=this.am(0,i.data[c],a,c,0,this.t);for(h=Math.min(i.t,e);c<h;++c)this.am(0,i.data[c],a,c,0,e-c);a.clamp()}function bnpMultiplyUpperTo(i,e,a){--e;var c=a.t=this.t+i.t-e;for(a.s=0;--c>=0;)a.data[c]=0;for(c=Math.max(e-this.t,0);c<i.t;++c)a.data[this.t+c-e]=this.am(e-c,i.data[c],a,0,0,this.t+c-e);a.clamp(),a.drShiftTo(1,a)}function Barrett(i){this.r2=nbi(),this.q3=nbi(),BigInteger$2.ONE.dlShiftTo(2*i.t,this.r2),this.mu=this.r2.divide(i),this.m=i}function barrettConvert(i){if(i.s<0||i.t>2*this.m.t)return i.mod(this.m);if(i.compareTo(this.m)<0)return i;var e=nbi();return i.copyTo(e),this.reduce(e),e}function barrettRevert(i){return i}function barrettReduce(i){for(i.drShiftTo(this.m.t-1,this.r2),i.t>this.m.t+1&&(i.t=this.m.t+1,i.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);i.compareTo(this.r2)<0;)i.dAddOffset(1,this.m.t+1);for(i.subTo(this.r2,i);i.compareTo(this.m)>=0;)i.subTo(this.m,i)}function barrettSqrTo(i,e){i.squareTo(e),this.reduce(e)}function barrettMulTo(i,e,a){i.multiplyTo(e,a),this.reduce(a)}Barrett.prototype.convert=barrettConvert;Barrett.prototype.revert=barrettRevert;Barrett.prototype.reduce=barrettReduce;Barrett.prototype.mulTo=barrettMulTo;Barrett.prototype.sqrTo=barrettSqrTo;function bnModPow(i,e){var a=i.bitLength(),c,h=nbv(1),d;if(a<=0)return h;a<18?c=1:a<48?c=3:a<144?c=4:a<768?c=5:c=6,a<8?d=new Classic(e):e.isEven()?d=new Barrett(e):d=new Montgomery(e);var et=new Array,ft=3,gt=c-1,_t=(1<<c)-1;if(et[1]=d.convert(this),c>1){var wt=nbi();for(d.sqrTo(et[1],wt);ft<=_t;)et[ft]=nbi(),d.mulTo(wt,et[ft-2],et[ft]),ft+=2}var $t=i.t-1,It,Rt=!0,Tt=nbi(),At;for(a=nbits(i.data[$t])-1;$t>=0;){for(a>=gt?It=i.data[$t]>>a-gt&_t:(It=(i.data[$t]&(1<<a+1)-1)<<gt-a,$t>0&&(It|=i.data[$t-1]>>this.DB+a-gt)),ft=c;!(It&1);)It>>=1,--ft;if((a-=ft)<0&&(a+=this.DB,--$t),Rt)et[It].copyTo(h),Rt=!1;else{for(;ft>1;)d.sqrTo(h,Tt),d.sqrTo(Tt,h),ft-=2;ft>0?d.sqrTo(h,Tt):(At=h,h=Tt,Tt=At),d.mulTo(Tt,et[It],h)}for(;$t>=0&&!(i.data[$t]&1<<a);)d.sqrTo(h,Tt),At=h,h=Tt,Tt=At,--a<0&&(a=this.DB-1,--$t)}return d.revert(h)}function bnGCD(i){var e=this.s<0?this.negate():this.clone(),a=i.s<0?i.negate():i.clone();if(e.compareTo(a)<0){var c=e;e=a,a=c}var h=e.getLowestSetBit(),d=a.getLowestSetBit();if(d<0)return e;for(h<d&&(d=h),d>0&&(e.rShiftTo(d,e),a.rShiftTo(d,a));e.signum()>0;)(h=e.getLowestSetBit())>0&&e.rShiftTo(h,e),(h=a.getLowestSetBit())>0&&a.rShiftTo(h,a),e.compareTo(a)>=0?(e.subTo(a,e),e.rShiftTo(1,e)):(a.subTo(e,a),a.rShiftTo(1,a));return d>0&&a.lShiftTo(d,a),a}function bnpModInt(i){if(i<=0)return 0;var e=this.DV%i,a=this.s<0?i-1:0;if(this.t>0)if(e==0)a=this.data[0]%i;else for(var c=this.t-1;c>=0;--c)a=(e*a+this.data[c])%i;return a}function bnModInverse(i){var e=i.isEven();if(this.isEven()&&e||i.signum()==0)return BigInteger$2.ZERO;for(var a=i.clone(),c=this.clone(),h=nbv(1),d=nbv(0),et=nbv(0),ft=nbv(1);a.signum()!=0;){for(;a.isEven();)a.rShiftTo(1,a),e?((!h.isEven()||!d.isEven())&&(h.addTo(this,h),d.subTo(i,d)),h.rShiftTo(1,h)):d.isEven()||d.subTo(i,d),d.rShiftTo(1,d);for(;c.isEven();)c.rShiftTo(1,c),e?((!et.isEven()||!ft.isEven())&&(et.addTo(this,et),ft.subTo(i,ft)),et.rShiftTo(1,et)):ft.isEven()||ft.subTo(i,ft),ft.rShiftTo(1,ft);a.compareTo(c)>=0?(a.subTo(c,a),e&&h.subTo(et,h),d.subTo(ft,d)):(c.subTo(a,c),e&&et.subTo(h,et),ft.subTo(d,ft))}if(c.compareTo(BigInteger$2.ONE)!=0)return BigInteger$2.ZERO;if(ft.compareTo(i)>=0)return ft.subtract(i);if(ft.signum()<0)ft.addTo(i,ft);else return ft;return ft.signum()<0?ft.add(i):ft}var lowprimes=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509],lplim=(1<<26)/lowprimes[lowprimes.length-1];function bnIsProbablePrime(i){var e,a=this.abs();if(a.t==1&&a.data[0]<=lowprimes[lowprimes.length-1]){for(e=0;e<lowprimes.length;++e)if(a.data[0]==lowprimes[e])return!0;return!1}if(a.isEven())return!1;for(e=1;e<lowprimes.length;){for(var c=lowprimes[e],h=e+1;h<lowprimes.length&&c<lplim;)c*=lowprimes[h++];for(c=a.modInt(c);e<h;)if(c%lowprimes[e++]==0)return!1}return a.millerRabin(i)}function bnpMillerRabin(i){var e=this.subtract(BigInteger$2.ONE),a=e.getLowestSetBit();if(a<=0)return!1;for(var c=e.shiftRight(a),h=bnGetPrng(),d,et=0;et<i;++et){do d=new BigInteger$2(this.bitLength(),h);while(d.compareTo(BigInteger$2.ONE)<=0||d.compareTo(e)>=0);var ft=d.modPow(c,this);if(ft.compareTo(BigInteger$2.ONE)!=0&&ft.compareTo(e)!=0){for(var gt=1;gt++<a&&ft.compareTo(e)!=0;)if(ft=ft.modPowInt(2,this),ft.compareTo(BigInteger$2.ONE)==0)return!1;if(ft.compareTo(e)!=0)return!1}}return!0}function bnGetPrng(){return{nextBytes:function(i){for(var e=0;e<i.length;++e)i[e]=Math.floor(Math.random()*256)}}}BigInteger$2.prototype.chunkSize=bnpChunkSize;BigInteger$2.prototype.toRadix=bnpToRadix;BigInteger$2.prototype.fromRadix=bnpFromRadix;BigInteger$2.prototype.fromNumber=bnpFromNumber;BigInteger$2.prototype.bitwiseTo=bnpBitwiseTo;BigInteger$2.prototype.changeBit=bnpChangeBit;BigInteger$2.prototype.addTo=bnpAddTo;BigInteger$2.prototype.dMultiply=bnpDMultiply;BigInteger$2.prototype.dAddOffset=bnpDAddOffset;BigInteger$2.prototype.multiplyLowerTo=bnpMultiplyLowerTo;BigInteger$2.prototype.multiplyUpperTo=bnpMultiplyUpperTo;BigInteger$2.prototype.modInt=bnpModInt;BigInteger$2.prototype.millerRabin=bnpMillerRabin;BigInteger$2.prototype.clone=bnClone;BigInteger$2.prototype.intValue=bnIntValue;BigInteger$2.prototype.byteValue=bnByteValue;BigInteger$2.prototype.shortValue=bnShortValue;BigInteger$2.prototype.signum=bnSigNum;BigInteger$2.prototype.toByteArray=bnToByteArray;BigInteger$2.prototype.equals=bnEquals;BigInteger$2.prototype.min=bnMin;BigInteger$2.prototype.max=bnMax;BigInteger$2.prototype.and=bnAnd;BigInteger$2.prototype.or=bnOr;BigInteger$2.prototype.xor=bnXor;BigInteger$2.prototype.andNot=bnAndNot;BigInteger$2.prototype.not=bnNot;BigInteger$2.prototype.shiftLeft=bnShiftLeft;BigInteger$2.prototype.shiftRight=bnShiftRight;BigInteger$2.prototype.getLowestSetBit=bnGetLowestSetBit;BigInteger$2.prototype.bitCount=bnBitCount;BigInteger$2.prototype.testBit=bnTestBit;BigInteger$2.prototype.setBit=bnSetBit;BigInteger$2.prototype.clearBit=bnClearBit;BigInteger$2.prototype.flipBit=bnFlipBit;BigInteger$2.prototype.add=bnAdd;BigInteger$2.prototype.subtract=bnSubtract;BigInteger$2.prototype.multiply=bnMultiply;BigInteger$2.prototype.divide=bnDivide;BigInteger$2.prototype.remainder=bnRemainder;BigInteger$2.prototype.divideAndRemainder=bnDivideAndRemainder;BigInteger$2.prototype.modPow=bnModPow;BigInteger$2.prototype.modInverse=bnModInverse;BigInteger$2.prototype.pow=bnPow;BigInteger$2.prototype.gcd=bnGCD;BigInteger$2.prototype.isProbablePrime=bnIsProbablePrime;var forge$5=forge$m,sha1$1=forge$5.sha1=forge$5.sha1||{};forge$5.md.sha1=forge$5.md.algorithms.sha1=sha1$1;sha1$1.create=function(){_initialized$1||_init$1();var i=null,e=forge$5.util.createBuffer(),a=new Array(80),c={algorithm:"sha1",blockLength:64,digestLength:20,messageLength:0,fullMessageLength:null,messageLengthSize:8};return c.start=function(){c.messageLength=0,c.fullMessageLength=c.messageLength64=[];for(var h=c.messageLengthSize/4,d=0;d<h;++d)c.fullMessageLength.push(0);return e=forge$5.util.createBuffer(),i={h0:1732584193,h1:4023233417,h2:2562383102,h3:271733878,h4:3285377520},c},c.start(),c.update=function(h,d){d==="utf8"&&(h=forge$5.util.encodeUtf8(h));var et=h.length;c.messageLength+=et,et=[et/4294967296>>>0,et>>>0];for(var ft=c.fullMessageLength.length-1;ft>=0;--ft)c.fullMessageLength[ft]+=et[1],et[1]=et[0]+(c.fullMessageLength[ft]/4294967296>>>0),c.fullMessageLength[ft]=c.fullMessageLength[ft]>>>0,et[0]=et[1]/4294967296>>>0;return e.putBytes(h),_update$1(i,a,e),(e.read>2048||e.length()===0)&&e.compact(),c},c.digest=function(){var h=forge$5.util.createBuffer();h.putBytes(e.bytes());var d=c.fullMessageLength[c.fullMessageLength.length-1]+c.messageLengthSize,et=d&c.blockLength-1;h.putBytes(_padding$1.substr(0,c.blockLength-et));for(var ft,gt,_t=c.fullMessageLength[0]*8,wt=0;wt<c.fullMessageLength.length-1;++wt)ft=c.fullMessageLength[wt+1]*8,gt=ft/4294967296>>>0,_t+=gt,h.putInt32(_t>>>0),_t=ft>>>0;h.putInt32(_t);var $t={h0:i.h0,h1:i.h1,h2:i.h2,h3:i.h3,h4:i.h4};_update$1($t,a,h);var It=forge$5.util.createBuffer();return It.putInt32($t.h0),It.putInt32($t.h1),It.putInt32($t.h2),It.putInt32($t.h3),It.putInt32($t.h4),It},c};var _padding$1=null,_initialized$1=!1;function _init$1(){_padding$1="",_padding$1+=forge$5.util.fillString("\0",64),_initialized$1=!0}function _update$1(i,e,a){for(var c,h,d,et,ft,gt,_t,wt,$t=a.length();$t>=64;){for(h=i.h0,d=i.h1,et=i.h2,ft=i.h3,gt=i.h4,wt=0;wt<16;++wt)c=a.getInt32(),e[wt]=c,_t=ft^d&(et^ft),c=(h<<5|h>>>27)+_t+gt+1518500249+c,gt=ft,ft=et,et=(d<<30|d>>>2)>>>0,d=h,h=c;for(;wt<20;++wt)c=e[wt-3]^e[wt-8]^e[wt-14]^e[wt-16],c=c<<1|c>>>31,e[wt]=c,_t=ft^d&(et^ft),c=(h<<5|h>>>27)+_t+gt+1518500249+c,gt=ft,ft=et,et=(d<<30|d>>>2)>>>0,d=h,h=c;for(;wt<32;++wt)c=e[wt-3]^e[wt-8]^e[wt-14]^e[wt-16],c=c<<1|c>>>31,e[wt]=c,_t=d^et^ft,c=(h<<5|h>>>27)+_t+gt+1859775393+c,gt=ft,ft=et,et=(d<<30|d>>>2)>>>0,d=h,h=c;for(;wt<40;++wt)c=e[wt-6]^e[wt-16]^e[wt-28]^e[wt-32],c=c<<2|c>>>30,e[wt]=c,_t=d^et^ft,c=(h<<5|h>>>27)+_t+gt+1859775393+c,gt=ft,ft=et,et=(d<<30|d>>>2)>>>0,d=h,h=c;for(;wt<60;++wt)c=e[wt-6]^e[wt-16]^e[wt-28]^e[wt-32],c=c<<2|c>>>30,e[wt]=c,_t=d&et|ft&(d^et),c=(h<<5|h>>>27)+_t+gt+2400959708+c,gt=ft,ft=et,et=(d<<30|d>>>2)>>>0,d=h,h=c;for(;wt<80;++wt)c=e[wt-6]^e[wt-16]^e[wt-28]^e[wt-32],c=c<<2|c>>>30,e[wt]=c,_t=d^et^ft,c=(h<<5|h>>>27)+_t+gt+3395469782+c,gt=ft,ft=et,et=(d<<30|d>>>2)>>>0,d=h,h=c;i.h0=i.h0+h|0,i.h1=i.h1+d|0,i.h2=i.h2+et|0,i.h3=i.h3+ft|0,i.h4=i.h4+gt|0,$t-=64}}var forge$4=forge$m,pkcs1=forge$4.pkcs1=forge$4.pkcs1||{};pkcs1.encode_rsa_oaep=function(i,e,a){var c,h,d,et;typeof a=="string"?(c=a,h=arguments[3]||void 0,d=arguments[4]||void 0):a&&(c=a.label||void 0,h=a.seed||void 0,d=a.md||void 0,a.mgf1&&a.mgf1.md&&(et=a.mgf1.md)),d?d.start():d=forge$4.md.sha1.create(),et||(et=d);var ft=Math.ceil(i.n.bitLength()/8),gt=ft-2*d.digestLength-2;if(e.length>gt){var _t=new Error("RSAES-OAEP input message length is too long.");throw _t.length=e.length,_t.maxLength=gt,_t}c||(c=""),d.update(c,"raw");for(var wt=d.digest(),$t="",It=gt-e.length,Rt=0;Rt<It;Rt++)$t+="\0";var Tt=wt.getBytes()+$t+""+e;if(!h)h=forge$4.random.getBytes(d.digestLength);else if(h.length!==d.digestLength){var _t=new Error("Invalid RSAES-OAEP seed. The seed length must match the digest length.");throw _t.seedLength=h.length,_t.digestLength=d.digestLength,_t}var At=rsa_mgf1(h,ft-d.digestLength-1,et),kt=forge$4.util.xorBytes(Tt,At,Tt.length),xt=rsa_mgf1(kt,d.digestLength,et),Nt=forge$4.util.xorBytes(h,xt,h.length);return"\0"+Nt+kt};pkcs1.decode_rsa_oaep=function(i,e,a){var c,h,d;typeof a=="string"?(c=a,h=arguments[3]||void 0):a&&(c=a.label||void 0,h=a.md||void 0,a.mgf1&&a.mgf1.md&&(d=a.mgf1.md));var et=Math.ceil(i.n.bitLength()/8);if(e.length!==et){var kt=new Error("RSAES-OAEP encoded message length is invalid.");throw kt.length=e.length,kt.expectedLength=et,kt}if(h===void 0?h=forge$4.md.sha1.create():h.start(),d||(d=h),et<2*h.digestLength+2)throw new Error("RSAES-OAEP key is too short for the hash function.");c||(c=""),h.update(c,"raw");for(var ft=h.digest().getBytes(),gt=e.charAt(0),_t=e.substring(1,h.digestLength+1),wt=e.substring(1+h.digestLength),$t=rsa_mgf1(wt,h.digestLength,d),It=forge$4.util.xorBytes(_t,$t,_t.length),Rt=rsa_mgf1(It,et-h.digestLength-1,d),Tt=forge$4.util.xorBytes(wt,Rt,wt.length),At=Tt.substring(0,h.digestLength),kt=gt!=="\0",xt=0;xt<h.digestLength;++xt)kt|=ft.charAt(xt)!==At.charAt(xt);for(var Nt=1,Ft=h.digestLength,jt=h.digestLength;jt<Tt.length;jt++){var Gt=Tt.charCodeAt(jt),Kt=Gt&1^1,Wt=Nt?65534:0;kt|=Gt&Wt,Nt=Nt&Kt,Ft+=Nt}if(kt||Tt.charCodeAt(Ft)!==1)throw new Error("Invalid RSAES-OAEP padding.");return Tt.substring(Ft+1)};function rsa_mgf1(i,e,a){a||(a=forge$4.md.sha1.create());for(var c="",h=Math.ceil(e/a.digestLength),d=0;d<h;++d){var et=String.fromCharCode(d>>24&255,d>>16&255,d>>8&255,d&255);a.start(),a.update(i+et),c+=a.digest().getBytes()}return c.substring(0,e)}var forge$3=forge$m;(function(){if(forge$3.prime){forge$3.prime;return}var i=forge$3.prime=forge$3.prime||{},e=forge$3.jsbn.BigInteger,a=[6,4,2,4,2,4,6,2],c=new e(null);c.fromInt(30);var h=function($t,It){return $t|It};i.generateProbablePrime=function($t,It,Rt){typeof It=="function"&&(Rt=It,It={}),It=It||{};var Tt=It.algorithm||"PRIMEINC";typeof Tt=="string"&&(Tt={name:Tt}),Tt.options=Tt.options||{};var At=It.prng||forge$3.random,kt={nextBytes:function(xt){for(var Nt=At.getBytesSync(xt.length),Ft=0;Ft<xt.length;++Ft)xt[Ft]=Nt.charCodeAt(Ft)}};if(Tt.name==="PRIMEINC")return d($t,kt,Tt.options,Rt);throw new Error("Invalid prime generation algorithm: "+Tt.name)};function d($t,It,Rt,Tt){return"workers"in Rt?gt($t,It,Rt,Tt):et($t,It,Rt,Tt)}function et($t,It,Rt,Tt){var At=_t($t,It),kt=0,xt=wt(At.bitLength());"millerRabinTests"in Rt&&(xt=Rt.millerRabinTests);var Nt=10;"maxBlockTime"in Rt&&(Nt=Rt.maxBlockTime),ft(At,$t,It,kt,xt,Nt,Tt)}function ft($t,It,Rt,Tt,At,kt,xt){var Nt=+new Date;do{if($t.bitLength()>It&&($t=_t(It,Rt)),$t.isProbablePrime(At))return xt(null,$t);$t.dAddOffset(a[Tt++%8],0)}while(kt<0||+new Date-Nt<kt);forge$3.util.setImmediate(function(){ft($t,It,Rt,Tt,At,kt,xt)})}function gt($t,It,Rt,Tt){if(typeof Worker>"u")return et($t,It,Rt,Tt);var At=_t($t,It),kt=Rt.workers,xt=Rt.workLoad||100,Nt=xt*30/8,Ft=Rt.workerScript||"forge/prime.worker.js";if(kt===-1)return forge$3.util.estimateCores(function(Gt,Kt){Gt&&(Kt=2),kt=Kt-1,jt()});jt();function jt(){kt=Math.max(1,kt);for(var Gt=[],Kt=0;Kt<kt;++Kt)Gt[Kt]=new Worker(Ft);for(var Kt=0;Kt<kt;++Kt)Gt[Kt].addEventListener("message",Zt);var Wt=!1;function Zt(cr){if(!Wt){var hr=cr.data;if(hr.found){for(var gr=0;gr<Gt.length;++gr)Gt[gr].terminate();return Wt=!0,Tt(null,new e(hr.prime,16))}At.bitLength()>$t&&(At=_t($t,It));var er=At.toString(16);cr.target.postMessage({hex:er,workLoad:xt}),At.dAddOffset(Nt,0)}}}}function _t($t,It){var Rt=new e($t,It),Tt=$t-1;return Rt.testBit(Tt)||Rt.bitwiseTo(e.ONE.shiftLeft(Tt),h,Rt),Rt.dAddOffset(31-Rt.mod(c).byteValue(),0),Rt}function wt($t){return $t<=100?27:$t<=150?18:$t<=200?15:$t<=250?12:$t<=300?9:$t<=350?8:$t<=400?7:$t<=500?6:$t<=600?5:$t<=800?4:$t<=1250?3:2}})();var forge$2=forge$m;if(typeof BigInteger$1>"u")var BigInteger$1=forge$2.jsbn.BigInteger;var _crypto=forge$2.util.isNodejs?require$$1:null,asn1$1=forge$2.asn1,util=forge$2.util;forge$2.pki=forge$2.pki||{};forge$2.pki.rsa=forge$2.rsa=forge$2.rsa||{};var pki$1=forge$2.pki,GCD_30_DELTA=[6,4,2,4,2,4,6,2],privateKeyValidator={name:"PrivateKeyInfo",tagClass:asn1$1.Class.UNIVERSAL,type:asn1$1.Type.SEQUENCE,constructed:!0,value:[{name:"PrivateKeyInfo.version",tagClass:asn1$1.Class.UNIVERSAL,type:asn1$1.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"PrivateKeyInfo.privateKeyAlgorithm",tagClass:asn1$1.Class.UNIVERSAL,type:asn1$1.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:asn1$1.Class.UNIVERSAL,type:asn1$1.Type.OID,constructed:!1,capture:"privateKeyOid"}]},{name:"PrivateKeyInfo",tagClass:asn1$1.Class.UNIVERSAL,type:asn1$1.Type.OCTETSTRING,constructed:!1,capture:"privateKey"}]},rsaPrivateKeyValidator={name:"RSAPrivateKey",tagClass:asn1$1.Class.UNIVERSAL,type:asn1$1.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPrivateKey.version",tagClass:asn1$1.Class.UNIVERSAL,type:asn1$1.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"RSAPrivateKey.modulus",tagClass:asn1$1.Class.UNIVERSAL,type:asn1$1.Type.INTEGER,constructed:!1,capture:"privateKeyModulus"},{name:"RSAPrivateKey.publicExponent",tagClass:asn1$1.Class.UNIVERSAL,type:asn1$1.Type.INTEGER,constructed:!1,capture:"privateKeyPublicExponent"},{name:"RSAPrivateKey.privateExponent",tagClass:asn1$1.Class.UNIVERSAL,type:asn1$1.Type.INTEGER,constructed:!1,capture:"privateKeyPrivateExponent"},{name:"RSAPrivateKey.prime1",tagClass:asn1$1.Class.UNIVERSAL,type:asn1$1.Type.INTEGER,constructed:!1,capture:"privateKeyPrime1"},{name:"RSAPrivateKey.prime2",tagClass:asn1$1.Class.UNIVERSAL,type:asn1$1.Type.INTEGER,constructed:!1,capture:"privateKeyPrime2"},{name:"RSAPrivateKey.exponent1",tagClass:asn1$1.Class.UNIVERSAL,type:asn1$1.Type.INTEGER,constructed:!1,capture:"privateKeyExponent1"},{name:"RSAPrivateKey.exponent2",tagClass:asn1$1.Class.UNIVERSAL,type:asn1$1.Type.INTEGER,constructed:!1,capture:"privateKeyExponent2"},{name:"RSAPrivateKey.coefficient",tagClass:asn1$1.Class.UNIVERSAL,type:asn1$1.Type.INTEGER,constructed:!1,capture:"privateKeyCoefficient"}]},rsaPublicKeyValidator={name:"RSAPublicKey",tagClass:asn1$1.Class.UNIVERSAL,type:asn1$1.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPublicKey.modulus",tagClass:asn1$1.Class.UNIVERSAL,type:asn1$1.Type.INTEGER,constructed:!1,capture:"publicKeyModulus"},{name:"RSAPublicKey.exponent",tagClass:asn1$1.Class.UNIVERSAL,type:asn1$1.Type.INTEGER,constructed:!1,capture:"publicKeyExponent"}]},publicKeyValidator=forge$2.pki.rsa.publicKeyValidator={name:"SubjectPublicKeyInfo",tagClass:asn1$1.Class.UNIVERSAL,type:asn1$1.Type.SEQUENCE,constructed:!0,captureAsn1:"subjectPublicKeyInfo",value:[{name:"SubjectPublicKeyInfo.AlgorithmIdentifier",tagClass:asn1$1.Class.UNIVERSAL,type:asn1$1.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:asn1$1.Class.UNIVERSAL,type:asn1$1.Type.OID,constructed:!1,capture:"publicKeyOid"}]},{name:"SubjectPublicKeyInfo.subjectPublicKey",tagClass:asn1$1.Class.UNIVERSAL,type:asn1$1.Type.BITSTRING,constructed:!1,value:[{name:"SubjectPublicKeyInfo.subjectPublicKey.RSAPublicKey",tagClass:asn1$1.Class.UNIVERSAL,type:asn1$1.Type.SEQUENCE,constructed:!0,optional:!0,captureAsn1:"rsaPublicKey"}]}]},digestInfoValidator={name:"DigestInfo",tagClass:asn1$1.Class.UNIVERSAL,type:asn1$1.Type.SEQUENCE,constructed:!0,value:[{name:"DigestInfo.DigestAlgorithm",tagClass:asn1$1.Class.UNIVERSAL,type:asn1$1.Type.SEQUENCE,constructed:!0,value:[{name:"DigestInfo.DigestAlgorithm.algorithmIdentifier",tagClass:asn1$1.Class.UNIVERSAL,type:asn1$1.Type.OID,constructed:!1,capture:"algorithmIdentifier"},{name:"DigestInfo.DigestAlgorithm.parameters",tagClass:asn1$1.Class.UNIVERSAL,type:asn1$1.Type.NULL,capture:"parameters",optional:!0,constructed:!1}]},{name:"DigestInfo.digest",tagClass:asn1$1.Class.UNIVERSAL,type:asn1$1.Type.OCTETSTRING,constructed:!1,capture:"digest"}]},emsaPkcs1v15encode=function(i){var e;if(i.algorithm in pki$1.oids)e=pki$1.oids[i.algorithm];else{var a=new Error("Unknown message digest algorithm.");throw a.algorithm=i.algorithm,a}var c=asn1$1.oidToDer(e).getBytes(),h=asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.SEQUENCE,!0,[]),d=asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.SEQUENCE,!0,[]);d.value.push(asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.OID,!1,c)),d.value.push(asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.NULL,!1,""));var et=asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.OCTETSTRING,!1,i.digest().getBytes());return h.value.push(d),h.value.push(et),asn1$1.toDer(h).getBytes()},_modPow=function(i,e,a){if(a)return i.modPow(e.e,e.n);if(!e.p||!e.q)return i.modPow(e.d,e.n);e.dP||(e.dP=e.d.mod(e.p.subtract(BigInteger$1.ONE))),e.dQ||(e.dQ=e.d.mod(e.q.subtract(BigInteger$1.ONE))),e.qInv||(e.qInv=e.q.modInverse(e.p));var c;do c=new BigInteger$1(forge$2.util.bytesToHex(forge$2.random.getBytes(e.n.bitLength()/8)),16);while(c.compareTo(e.n)>=0||!c.gcd(e.n).equals(BigInteger$1.ONE));i=i.multiply(c.modPow(e.e,e.n)).mod(e.n);for(var h=i.mod(e.p).modPow(e.dP,e.p),d=i.mod(e.q).modPow(e.dQ,e.q);h.compareTo(d)<0;)h=h.add(e.p);var et=h.subtract(d).multiply(e.qInv).mod(e.p).multiply(e.q).add(d);return et=et.multiply(c.modInverse(e.n)).mod(e.n),et};pki$1.rsa.encrypt=function(i,e,a){var c=a,h,d=Math.ceil(e.n.bitLength()/8);a!==!1&&a!==!0?(c=a===2,h=_encodePkcs1_v1_5(i,e,a)):(h=forge$2.util.createBuffer(),h.putBytes(i));for(var et=new BigInteger$1(h.toHex(),16),ft=_modPow(et,e,c),gt=ft.toString(16),_t=forge$2.util.createBuffer(),wt=d-Math.ceil(gt.length/2);wt>0;)_t.putByte(0),--wt;return _t.putBytes(forge$2.util.hexToBytes(gt)),_t.getBytes()};pki$1.rsa.decrypt=function(i,e,a,c){var h=Math.ceil(e.n.bitLength()/8);if(i.length!==h){var d=new Error("Encrypted message length is invalid.");throw d.length=i.length,d.expected=h,d}var et=new BigInteger$1(forge$2.util.createBuffer(i).toHex(),16);if(et.compareTo(e.n)>=0)throw new Error("Encrypted message is invalid.");for(var ft=_modPow(et,e,a),gt=ft.toString(16),_t=forge$2.util.createBuffer(),wt=h-Math.ceil(gt.length/2);wt>0;)_t.putByte(0),--wt;return _t.putBytes(forge$2.util.hexToBytes(gt)),c!==!1?_decodePkcs1_v1_5(_t.getBytes(),e,a):_t.getBytes()};pki$1.rsa.createKeyPairGenerationState=function(i,e,a){typeof i=="string"&&(i=parseInt(i,10)),i=i||2048,a=a||{};var c=a.prng||forge$2.random,h={nextBytes:function(ft){for(var gt=c.getBytesSync(ft.length),_t=0;_t<ft.length;++_t)ft[_t]=gt.charCodeAt(_t)}},d=a.algorithm||"PRIMEINC",et;if(d==="PRIMEINC")et={algorithm:d,state:0,bits:i,rng:h,eInt:e||65537,e:new BigInteger$1(null),p:null,q:null,qBits:i>>1,pBits:i-(i>>1),pqState:0,num:null,keys:null},et.e.fromInt(et.eInt);else throw new Error("Invalid key generation algorithm: "+d);return et};pki$1.rsa.stepKeyPairGenerationState=function(i,e){"algorithm"in i||(i.algorithm="PRIMEINC");var a=new BigInteger$1(null);a.fromInt(30);for(var c=0,h=function($t,It){return $t|It},d=+new Date,et,ft=0;i.keys===null&&(e<=0||ft<e);){if(i.state===0){var gt=i.p===null?i.pBits:i.qBits,_t=gt-1;i.pqState===0?(i.num=new BigInteger$1(gt,i.rng),i.num.testBit(_t)||i.num.bitwiseTo(BigInteger$1.ONE.shiftLeft(_t),h,i.num),i.num.dAddOffset(31-i.num.mod(a).byteValue(),0),c=0,++i.pqState):i.pqState===1?i.num.bitLength()>gt?i.pqState=0:i.num.isProbablePrime(_getMillerRabinTests(i.num.bitLength()))?++i.pqState:i.num.dAddOffset(GCD_30_DELTA[c++%8],0):i.pqState===2?i.pqState=i.num.subtract(BigInteger$1.ONE).gcd(i.e).compareTo(BigInteger$1.ONE)===0?3:0:i.pqState===3&&(i.pqState=0,i.p===null?i.p=i.num:i.q=i.num,i.p!==null&&i.q!==null&&++i.state,i.num=null)}else if(i.state===1)i.p.compareTo(i.q)<0&&(i.num=i.p,i.p=i.q,i.q=i.num),++i.state;else if(i.state===2)i.p1=i.p.subtract(BigInteger$1.ONE),i.q1=i.q.subtract(BigInteger$1.ONE),i.phi=i.p1.multiply(i.q1),++i.state;else if(i.state===3)i.phi.gcd(i.e).compareTo(BigInteger$1.ONE)===0?++i.state:(i.p=null,i.q=null,i.state=0);else if(i.state===4)i.n=i.p.multiply(i.q),i.n.bitLength()===i.bits?++i.state:(i.q=null,i.state=0);else if(i.state===5){var wt=i.e.modInverse(i.phi);i.keys={privateKey:pki$1.rsa.setPrivateKey(i.n,i.e,wt,i.p,i.q,wt.mod(i.p1),wt.mod(i.q1),i.q.modInverse(i.p)),publicKey:pki$1.rsa.setPublicKey(i.n,i.e)}}et=+new Date,ft+=et-d,d=et}return i.keys!==null};pki$1.rsa.generateKeyPair=function(i,e,a,c){if(arguments.length===1?typeof i=="object"?(a=i,i=void 0):typeof i=="function"&&(c=i,i=void 0):arguments.length===2?typeof i=="number"?typeof e=="function"?(c=e,e=void 0):typeof e!="number"&&(a=e,e=void 0):(a=i,c=e,i=void 0,e=void 0):arguments.length===3&&(typeof e=="number"?typeof a=="function"&&(c=a,a=void 0):(c=a,a=e,e=void 0)),a=a||{},i===void 0&&(i=a.bits||2048),e===void 0&&(e=a.e||65537),!forge$2.options.usePureJavaScript&&!a.prng&&i>=256&&i<=16384&&(e===65537||e===3)){if(c){if(_detectNodeCrypto("generateKeyPair"))return _crypto.generateKeyPair("rsa",{modulusLength:i,publicExponent:e,publicKeyEncoding:{type:"spki",format:"pem"},privateKeyEncoding:{type:"pkcs8",format:"pem"}},function(ft,gt,_t){if(ft)return c(ft);c(null,{privateKey:pki$1.privateKeyFromPem(_t),publicKey:pki$1.publicKeyFromPem(gt)})});if(_detectSubtleCrypto("generateKey")&&_detectSubtleCrypto("exportKey"))return util.globalScope.crypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:i,publicExponent:_intToUint8Array(e),hash:{name:"SHA-256"}},!0,["sign","verify"]).then(function(ft){return util.globalScope.crypto.subtle.exportKey("pkcs8",ft.privateKey)}).then(void 0,function(ft){c(ft)}).then(function(ft){if(ft){var gt=pki$1.privateKeyFromAsn1(asn1$1.fromDer(forge$2.util.createBuffer(ft)));c(null,{privateKey:gt,publicKey:pki$1.setRsaPublicKey(gt.n,gt.e)})}});if(_detectSubtleMsCrypto("generateKey")&&_detectSubtleMsCrypto("exportKey")){var h=util.globalScope.msCrypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:i,publicExponent:_intToUint8Array(e),hash:{name:"SHA-256"}},!0,["sign","verify"]);h.oncomplete=function(ft){var gt=ft.target.result,_t=util.globalScope.msCrypto.subtle.exportKey("pkcs8",gt.privateKey);_t.oncomplete=function(wt){var $t=wt.target.result,It=pki$1.privateKeyFromAsn1(asn1$1.fromDer(forge$2.util.createBuffer($t)));c(null,{privateKey:It,publicKey:pki$1.setRsaPublicKey(It.n,It.e)})},_t.onerror=function(wt){c(wt)}},h.onerror=function(ft){c(ft)};return}}else if(_detectNodeCrypto("generateKeyPairSync")){var d=_crypto.generateKeyPairSync("rsa",{modulusLength:i,publicExponent:e,publicKeyEncoding:{type:"spki",format:"pem"},privateKeyEncoding:{type:"pkcs8",format:"pem"}});return{privateKey:pki$1.privateKeyFromPem(d.privateKey),publicKey:pki$1.publicKeyFromPem(d.publicKey)}}}var et=pki$1.rsa.createKeyPairGenerationState(i,e,a);if(!c)return pki$1.rsa.stepKeyPairGenerationState(et,0),et.keys;_generateKeyPair(et,a,c)};pki$1.setRsaPublicKey=pki$1.rsa.setPublicKey=function(i,e){var a={n:i,e};return a.encrypt=function(c,h,d){if(typeof h=="string"?h=h.toUpperCase():h===void 0&&(h="RSAES-PKCS1-V1_5"),h==="RSAES-PKCS1-V1_5")h={encode:function(ft,gt,_t){return _encodePkcs1_v1_5(ft,gt,2).getBytes()}};else if(h==="RSA-OAEP"||h==="RSAES-OAEP")h={encode:function(ft,gt){return forge$2.pkcs1.encode_rsa_oaep(gt,ft,d)}};else if(["RAW","NONE","NULL",null].indexOf(h)!==-1)h={encode:function(ft){return ft}};else if(typeof h=="string")throw new Error('Unsupported encryption scheme: "'+h+'".');var et=h.encode(c,a,!0);return pki$1.rsa.encrypt(et,a,!0)},a.verify=function(c,h,d,et){typeof d=="string"?d=d.toUpperCase():d===void 0&&(d="RSASSA-PKCS1-V1_5"),et===void 0&&(et={_parseAllDigestBytes:!0}),"_parseAllDigestBytes"in et||(et._parseAllDigestBytes=!0),d==="RSASSA-PKCS1-V1_5"?d={verify:function(gt,_t){_t=_decodePkcs1_v1_5(_t,a,!0);var wt=asn1$1.fromDer(_t,{parseAllBytes:et._parseAllDigestBytes}),$t={},It=[];if(!asn1$1.validate(wt,digestInfoValidator,$t,It)){var Rt=new Error("ASN.1 object does not contain a valid RSASSA-PKCS1-v1_5 DigestInfo value.");throw Rt.errors=It,Rt}var Tt=asn1$1.derToOid($t.algorithmIdentifier);if(!(Tt===forge$2.oids.md2||Tt===forge$2.oids.md5||Tt===forge$2.oids.sha1||Tt===forge$2.oids.sha224||Tt===forge$2.oids.sha256||Tt===forge$2.oids.sha384||Tt===forge$2.oids.sha512||Tt===forge$2.oids["sha512-224"]||Tt===forge$2.oids["sha512-256"])){var Rt=new Error("Unknown RSASSA-PKCS1-v1_5 DigestAlgorithm identifier.");throw Rt.oid=Tt,Rt}if((Tt===forge$2.oids.md2||Tt===forge$2.oids.md5)&&!("parameters"in $t))throw new Error("ASN.1 object does not contain a valid RSASSA-PKCS1-v1_5 DigestInfo value. Missing algorithm identifer NULL parameters.");return gt===$t.digest}}:(d==="NONE"||d==="NULL"||d===null)&&(d={verify:function(gt,_t){return _t=_decodePkcs1_v1_5(_t,a,!0),gt===_t}});var ft=pki$1.rsa.decrypt(h,a,!0,!1);return d.verify(c,ft,a.n.bitLength())},a};pki$1.setRsaPrivateKey=pki$1.rsa.setPrivateKey=function(i,e,a,c,h,d,et,ft){var gt={n:i,e,d:a,p:c,q:h,dP:d,dQ:et,qInv:ft};return gt.decrypt=function(_t,wt,$t){typeof wt=="string"?wt=wt.toUpperCase():wt===void 0&&(wt="RSAES-PKCS1-V1_5");var It=pki$1.rsa.decrypt(_t,gt,!1,!1);if(wt==="RSAES-PKCS1-V1_5")wt={decode:_decodePkcs1_v1_5};else if(wt==="RSA-OAEP"||wt==="RSAES-OAEP")wt={decode:function(Rt,Tt){return forge$2.pkcs1.decode_rsa_oaep(Tt,Rt,$t)}};else if(["RAW","NONE","NULL",null].indexOf(wt)!==-1)wt={decode:function(Rt){return Rt}};else throw new Error('Unsupported encryption scheme: "'+wt+'".');return wt.decode(It,gt,!1)},gt.sign=function(_t,wt){var $t=!1;typeof wt=="string"&&(wt=wt.toUpperCase()),wt===void 0||wt==="RSASSA-PKCS1-V1_5"?(wt={encode:emsaPkcs1v15encode},$t=1):(wt==="NONE"||wt==="NULL"||wt===null)&&(wt={encode:function(){return _t}},$t=1);var It=wt.encode(_t,gt.n.bitLength());return pki$1.rsa.encrypt(It,gt,$t)},gt};pki$1.wrapRsaPrivateKey=function(i){return asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.SEQUENCE,!0,[asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.INTEGER,!1,asn1$1.integerToDer(0).getBytes()),asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.SEQUENCE,!0,[asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.OID,!1,asn1$1.oidToDer(pki$1.oids.rsaEncryption).getBytes()),asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.NULL,!1,"")]),asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.OCTETSTRING,!1,asn1$1.toDer(i).getBytes())])};pki$1.privateKeyFromAsn1=function(i){var e={},a=[];if(asn1$1.validate(i,privateKeyValidator,e,a)&&(i=asn1$1.fromDer(forge$2.util.createBuffer(e.privateKey))),e={},a=[],!asn1$1.validate(i,rsaPrivateKeyValidator,e,a)){var c=new Error("Cannot read private key. ASN.1 object does not contain an RSAPrivateKey.");throw c.errors=a,c}var h,d,et,ft,gt,_t,wt,$t;return h=forge$2.util.createBuffer(e.privateKeyModulus).toHex(),d=forge$2.util.createBuffer(e.privateKeyPublicExponent).toHex(),et=forge$2.util.createBuffer(e.privateKeyPrivateExponent).toHex(),ft=forge$2.util.createBuffer(e.privateKeyPrime1).toHex(),gt=forge$2.util.createBuffer(e.privateKeyPrime2).toHex(),_t=forge$2.util.createBuffer(e.privateKeyExponent1).toHex(),wt=forge$2.util.createBuffer(e.privateKeyExponent2).toHex(),$t=forge$2.util.createBuffer(e.privateKeyCoefficient).toHex(),pki$1.setRsaPrivateKey(new BigInteger$1(h,16),new BigInteger$1(d,16),new BigInteger$1(et,16),new BigInteger$1(ft,16),new BigInteger$1(gt,16),new BigInteger$1(_t,16),new BigInteger$1(wt,16),new BigInteger$1($t,16))};pki$1.privateKeyToAsn1=pki$1.privateKeyToRSAPrivateKey=function(i){return asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.SEQUENCE,!0,[asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.INTEGER,!1,asn1$1.integerToDer(0).getBytes()),asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.INTEGER,!1,_bnToBytes(i.n)),asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.INTEGER,!1,_bnToBytes(i.e)),asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.INTEGER,!1,_bnToBytes(i.d)),asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.INTEGER,!1,_bnToBytes(i.p)),asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.INTEGER,!1,_bnToBytes(i.q)),asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.INTEGER,!1,_bnToBytes(i.dP)),asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.INTEGER,!1,_bnToBytes(i.dQ)),asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.INTEGER,!1,_bnToBytes(i.qInv))])};pki$1.publicKeyFromAsn1=function(i){var e={},a=[];if(asn1$1.validate(i,publicKeyValidator,e,a)){var c=asn1$1.derToOid(e.publicKeyOid);if(c!==pki$1.oids.rsaEncryption){var h=new Error("Cannot read public key. Unknown OID.");throw h.oid=c,h}i=e.rsaPublicKey}if(a=[],!asn1$1.validate(i,rsaPublicKeyValidator,e,a)){var h=new Error("Cannot read public key. ASN.1 object does not contain an RSAPublicKey.");throw h.errors=a,h}var d=forge$2.util.createBuffer(e.publicKeyModulus).toHex(),et=forge$2.util.createBuffer(e.publicKeyExponent).toHex();return pki$1.setRsaPublicKey(new BigInteger$1(d,16),new BigInteger$1(et,16))};pki$1.publicKeyToAsn1=pki$1.publicKeyToSubjectPublicKeyInfo=function(i){return asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.SEQUENCE,!0,[asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.SEQUENCE,!0,[asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.OID,!1,asn1$1.oidToDer(pki$1.oids.rsaEncryption).getBytes()),asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.NULL,!1,"")]),asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.BITSTRING,!1,[pki$1.publicKeyToRSAPublicKey(i)])])};pki$1.publicKeyToRSAPublicKey=function(i){return asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.SEQUENCE,!0,[asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.INTEGER,!1,_bnToBytes(i.n)),asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.INTEGER,!1,_bnToBytes(i.e))])};function _encodePkcs1_v1_5(i,e,a){var c=forge$2.util.createBuffer(),h=Math.ceil(e.n.bitLength()/8);if(i.length>h-11){var d=new Error("Message is too long for PKCS#1 v1.5 padding.");throw d.length=i.length,d.max=h-11,d}c.putByte(0),c.putByte(a);var et=h-3-i.length,ft;if(a===0||a===1){ft=a===0?0:255;for(var gt=0;gt<et;++gt)c.putByte(ft)}else for(;et>0;){for(var _t=0,wt=forge$2.random.getBytes(et),gt=0;gt<et;++gt)ft=wt.charCodeAt(gt),ft===0?++_t:c.putByte(ft);et=_t}return c.putByte(0),c.putBytes(i),c}function _decodePkcs1_v1_5(i,e,a,c){var h=Math.ceil(e.n.bitLength()/8),d=forge$2.util.createBuffer(i),et=d.getByte(),ft=d.getByte();if(et!==0||a&&ft!==0&&ft!==1||!a&&ft!=2||a&&ft===0&&typeof c>"u")throw new Error("Encryption block is invalid.");var gt=0;if(ft===0){gt=h-3-c;for(var _t=0;_t<gt;++_t)if(d.getByte()!==0)throw new Error("Encryption block is invalid.")}else if(ft===1)for(gt=0;d.length()>1;){if(d.getByte()!==255){--d.read;break}++gt}else if(ft===2)for(gt=0;d.length()>1;){if(d.getByte()===0){--d.read;break}++gt}var wt=d.getByte();if(wt!==0||gt!==h-3-d.length())throw new Error("Encryption block is invalid.");return d.getBytes()}function _generateKeyPair(i,e,a){typeof e=="function"&&(a=e,e={}),e=e||{};var c={algorithm:{name:e.algorithm||"PRIMEINC",options:{workers:e.workers||2,workLoad:e.workLoad||100,workerScript:e.workerScript}}};"prng"in e&&(c.prng=e.prng),h();function h(){d(i.pBits,function(ft,gt){if(ft)return a(ft);if(i.p=gt,i.q!==null)return et(ft,i.q);d(i.qBits,et)})}function d(ft,gt){forge$2.prime.generateProbablePrime(ft,c,gt)}function et(ft,gt){if(ft)return a(ft);if(i.q=gt,i.p.compareTo(i.q)<0){var _t=i.p;i.p=i.q,i.q=_t}if(i.p.subtract(BigInteger$1.ONE).gcd(i.e).compareTo(BigInteger$1.ONE)!==0){i.p=null,h();return}if(i.q.subtract(BigInteger$1.ONE).gcd(i.e).compareTo(BigInteger$1.ONE)!==0){i.q=null,d(i.qBits,et);return}if(i.p1=i.p.subtract(BigInteger$1.ONE),i.q1=i.q.subtract(BigInteger$1.ONE),i.phi=i.p1.multiply(i.q1),i.phi.gcd(i.e).compareTo(BigInteger$1.ONE)!==0){i.p=i.q=null,h();return}if(i.n=i.p.multiply(i.q),i.n.bitLength()!==i.bits){i.q=null,d(i.qBits,et);return}var wt=i.e.modInverse(i.phi);i.keys={privateKey:pki$1.rsa.setPrivateKey(i.n,i.e,wt,i.p,i.q,wt.mod(i.p1),wt.mod(i.q1),i.q.modInverse(i.p)),publicKey:pki$1.rsa.setPublicKey(i.n,i.e)},a(null,i.keys)}}function _bnToBytes(i){var e=i.toString(16);e[0]>="8"&&(e="00"+e);var a=forge$2.util.hexToBytes(e);return a.length>1&&(a.charCodeAt(0)===0&&!(a.charCodeAt(1)&128)||a.charCodeAt(0)===255&&(a.charCodeAt(1)&128)===128)?a.substr(1):a}function _getMillerRabinTests(i){return i<=100?27:i<=150?18:i<=200?15:i<=250?12:i<=300?9:i<=350?8:i<=400?7:i<=500?6:i<=600?5:i<=800?4:i<=1250?3:2}function _detectNodeCrypto(i){return forge$2.util.isNodejs&&typeof _crypto[i]=="function"}function _detectSubtleCrypto(i){return typeof util.globalScope<"u"&&typeof util.globalScope.crypto=="object"&&typeof util.globalScope.crypto.subtle=="object"&&typeof util.globalScope.crypto.subtle[i]=="function"}function _detectSubtleMsCrypto(i){return typeof util.globalScope<"u"&&typeof util.globalScope.msCrypto=="object"&&typeof util.globalScope.msCrypto.subtle=="object"&&typeof util.globalScope.msCrypto.subtle[i]=="function"}function _intToUint8Array(i){for(var e=forge$2.util.hexToBytes(i.toString(16)),a=new Uint8Array(e.length),c=0;c<e.length;++c)a[c]=e.charCodeAt(c);return a}var forge$1=forge$m;if(typeof BigInteger>"u")var BigInteger=forge$1.jsbn.BigInteger;var asn1=forge$1.asn1,pki=forge$1.pki=forge$1.pki||{};pki.pbe=forge$1.pbe=forge$1.pbe||{};var oids=pki.oids,encryptedPrivateKeyValidator={name:"EncryptedPrivateKeyInfo",tagClass:asn1.Class.UNIVERSAL,type:asn1.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedPrivateKeyInfo.encryptionAlgorithm",tagClass:asn1.Class.UNIVERSAL,type:asn1.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:asn1.Class.UNIVERSAL,type:asn1.Type.OID,constructed:!1,capture:"encryptionOid"},{name:"AlgorithmIdentifier.parameters",tagClass:asn1.Class.UNIVERSAL,type:asn1.Type.SEQUENCE,constructed:!0,captureAsn1:"encryptionParams"}]},{name:"EncryptedPrivateKeyInfo.encryptedData",tagClass:asn1.Class.UNIVERSAL,type:asn1.Type.OCTETSTRING,constructed:!1,capture:"encryptedData"}]},PBES2AlgorithmsValidator={name:"PBES2Algorithms",tagClass:asn1.Class.UNIVERSAL,type:asn1.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc",tagClass:asn1.Class.UNIVERSAL,type:asn1.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc.oid",tagClass:asn1.Class.UNIVERSAL,type:asn1.Type.OID,constructed:!1,capture:"kdfOid"},{name:"PBES2Algorithms.params",tagClass:asn1.Class.UNIVERSAL,type:asn1.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.params.salt",tagClass:asn1.Class.UNIVERSAL,type:asn1.Type.OCTETSTRING,constructed:!1,capture:"kdfSalt"},{name:"PBES2Algorithms.params.iterationCount",tagClass:asn1.Class.UNIVERSAL,type:asn1.Type.INTEGER,constructed:!1,capture:"kdfIterationCount"},{name:"PBES2Algorithms.params.keyLength",tagClass:asn1.Class.UNIVERSAL,type:asn1.Type.INTEGER,constructed:!1,optional:!0,capture:"keyLength"},{name:"PBES2Algorithms.params.prf",tagClass:asn1.Class.UNIVERSAL,type:asn1.Type.SEQUENCE,constructed:!0,optional:!0,value:[{name:"PBES2Algorithms.params.prf.algorithm",tagClass:asn1.Class.UNIVERSAL,type:asn1.Type.OID,constructed:!1,capture:"prfOid"}]}]}]},{name:"PBES2Algorithms.encryptionScheme",tagClass:asn1.Class.UNIVERSAL,type:asn1.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.encryptionScheme.oid",tagClass:asn1.Class.UNIVERSAL,type:asn1.Type.OID,constructed:!1,capture:"encOid"},{name:"PBES2Algorithms.encryptionScheme.iv",tagClass:asn1.Class.UNIVERSAL,type:asn1.Type.OCTETSTRING,constructed:!1,capture:"encIv"}]}]},pkcs12PbeParamsValidator={name:"pkcs-12PbeParams",tagClass:asn1.Class.UNIVERSAL,type:asn1.Type.SEQUENCE,constructed:!0,value:[{name:"pkcs-12PbeParams.salt",tagClass:asn1.Class.UNIVERSAL,type:asn1.Type.OCTETSTRING,constructed:!1,capture:"salt"},{name:"pkcs-12PbeParams.iterations",tagClass:asn1.Class.UNIVERSAL,type:asn1.Type.INTEGER,constructed:!1,capture:"iterations"}]};pki.encryptPrivateKeyInfo=function(i,e,a){a=a||{},a.saltSize=a.saltSize||8,a.count=a.count||2048,a.algorithm=a.algorithm||"aes128",a.prfAlgorithm=a.prfAlgorithm||"sha1";var c=forge$1.random.getBytesSync(a.saltSize),h=a.count,d=asn1.integerToDer(h),et,ft,gt;if(a.algorithm.indexOf("aes")===0||a.algorithm==="des"){var _t,wt,$t;switch(a.algorithm){case"aes128":et=16,_t=16,wt=oids["aes128-CBC"],$t=forge$1.aes.createEncryptionCipher;break;case"aes192":et=24,_t=16,wt=oids["aes192-CBC"],$t=forge$1.aes.createEncryptionCipher;break;case"aes256":et=32,_t=16,wt=oids["aes256-CBC"],$t=forge$1.aes.createEncryptionCipher;break;case"des":et=8,_t=8,wt=oids.desCBC,$t=forge$1.des.createEncryptionCipher;break;default:var It=new Error("Cannot encrypt private key. Unknown encryption algorithm.");throw It.algorithm=a.algorithm,It}var Rt="hmacWith"+a.prfAlgorithm.toUpperCase(),Tt=prfAlgorithmToMessageDigest(Rt),At=forge$1.pkcs5.pbkdf2(e,c,h,et,Tt),kt=forge$1.random.getBytesSync(_t),xt=$t(At);xt.start(kt),xt.update(asn1.toDer(i)),xt.finish(),gt=xt.output.getBytes();var Nt=createPbkdf2Params(c,d,et,Rt);ft=asn1.create(asn1.Class.UNIVERSAL,asn1.Type.SEQUENCE,!0,[asn1.create(asn1.Class.UNIVERSAL,asn1.Type.OID,!1,asn1.oidToDer(oids.pkcs5PBES2).getBytes()),asn1.create(asn1.Class.UNIVERSAL,asn1.Type.SEQUENCE,!0,[asn1.create(asn1.Class.UNIVERSAL,asn1.Type.SEQUENCE,!0,[asn1.create(asn1.Class.UNIVERSAL,asn1.Type.OID,!1,asn1.oidToDer(oids.pkcs5PBKDF2).getBytes()),Nt]),asn1.create(asn1.Class.UNIVERSAL,asn1.Type.SEQUENCE,!0,[asn1.create(asn1.Class.UNIVERSAL,asn1.Type.OID,!1,asn1.oidToDer(wt).getBytes()),asn1.create(asn1.Class.UNIVERSAL,asn1.Type.OCTETSTRING,!1,kt)])])])}else if(a.algorithm==="3des"){et=24;var Ft=new forge$1.util.ByteBuffer(c),At=pki.pbe.generatePkcs12Key(e,Ft,1,h,et),kt=pki.pbe.generatePkcs12Key(e,Ft,2,h,et),xt=forge$1.des.createEncryptionCipher(At);xt.start(kt),xt.update(asn1.toDer(i)),xt.finish(),gt=xt.output.getBytes(),ft=asn1.create(asn1.Class.UNIVERSAL,asn1.Type.SEQUENCE,!0,[asn1.create(asn1.Class.UNIVERSAL,asn1.Type.OID,!1,asn1.oidToDer(oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]).getBytes()),asn1.create(asn1.Class.UNIVERSAL,asn1.Type.SEQUENCE,!0,[asn1.create(asn1.Class.UNIVERSAL,asn1.Type.OCTETSTRING,!1,c),asn1.create(asn1.Class.UNIVERSAL,asn1.Type.INTEGER,!1,d.getBytes())])])}else{var It=new Error("Cannot encrypt private key. Unknown encryption algorithm.");throw It.algorithm=a.algorithm,It}var jt=asn1.create(asn1.Class.UNIVERSAL,asn1.Type.SEQUENCE,!0,[ft,asn1.create(asn1.Class.UNIVERSAL,asn1.Type.OCTETSTRING,!1,gt)]);return jt};pki.decryptPrivateKeyInfo=function(i,e){var a=null,c={},h=[];if(!asn1.validate(i,encryptedPrivateKeyValidator,c,h)){var d=new Error("Cannot read encrypted private key. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw d.errors=h,d}var et=asn1.derToOid(c.encryptionOid),ft=pki.pbe.getCipher(et,c.encryptionParams,e),gt=forge$1.util.createBuffer(c.encryptedData);return ft.update(gt),ft.finish()&&(a=asn1.fromDer(ft.output)),a};pki.encryptedPrivateKeyToPem=function(i,e){var a={type:"ENCRYPTED PRIVATE KEY",body:asn1.toDer(i).getBytes()};return forge$1.pem.encode(a,{maxline:e})};pki.encryptedPrivateKeyFromPem=function(i){var e=forge$1.pem.decode(i)[0];if(e.type!=="ENCRYPTED PRIVATE KEY"){var a=new Error('Could not convert encrypted private key from PEM; PEM header type is "ENCRYPTED PRIVATE KEY".');throw a.headerType=e.type,a}if(e.procType&&e.procType.type==="ENCRYPTED")throw new Error("Could not convert encrypted private key from PEM; PEM is encrypted.");return asn1.fromDer(e.body)};pki.encryptRsaPrivateKey=function(i,e,a){if(a=a||{},!a.legacy){var c=pki.wrapRsaPrivateKey(pki.privateKeyToAsn1(i));return c=pki.encryptPrivateKeyInfo(c,e,a),pki.encryptedPrivateKeyToPem(c)}var h,d,et,ft;switch(a.algorithm){case"aes128":h="AES-128-CBC",et=16,d=forge$1.random.getBytesSync(16),ft=forge$1.aes.createEncryptionCipher;break;case"aes192":h="AES-192-CBC",et=24,d=forge$1.random.getBytesSync(16),ft=forge$1.aes.createEncryptionCipher;break;case"aes256":h="AES-256-CBC",et=32,d=forge$1.random.getBytesSync(16),ft=forge$1.aes.createEncryptionCipher;break;case"3des":h="DES-EDE3-CBC",et=24,d=forge$1.random.getBytesSync(8),ft=forge$1.des.createEncryptionCipher;break;case"des":h="DES-CBC",et=8,d=forge$1.random.getBytesSync(8),ft=forge$1.des.createEncryptionCipher;break;default:var gt=new Error('Could not encrypt RSA private key; unsupported encryption algorithm "'+a.algorithm+'".');throw gt.algorithm=a.algorithm,gt}var _t=forge$1.pbe.opensslDeriveBytes(e,d.substr(0,8),et),wt=ft(_t);wt.start(d),wt.update(asn1.toDer(pki.privateKeyToAsn1(i))),wt.finish();var $t={type:"RSA PRIVATE KEY",procType:{version:"4",type:"ENCRYPTED"},dekInfo:{algorithm:h,parameters:forge$1.util.bytesToHex(d).toUpperCase()},body:wt.output.getBytes()};return forge$1.pem.encode($t)};pki.decryptRsaPrivateKey=function(i,e){var a=null,c=forge$1.pem.decode(i)[0];if(c.type!=="ENCRYPTED PRIVATE KEY"&&c.type!=="PRIVATE KEY"&&c.type!=="RSA PRIVATE KEY"){var h=new Error('Could not convert private key from PEM; PEM header type is not "ENCRYPTED PRIVATE KEY", "PRIVATE KEY", or "RSA PRIVATE KEY".');throw h.headerType=h,h}if(c.procType&&c.procType.type==="ENCRYPTED"){var d,et;switch(c.dekInfo.algorithm){case"DES-CBC":d=8,et=forge$1.des.createDecryptionCipher;break;case"DES-EDE3-CBC":d=24,et=forge$1.des.createDecryptionCipher;break;case"AES-128-CBC":d=16,et=forge$1.aes.createDecryptionCipher;break;case"AES-192-CBC":d=24,et=forge$1.aes.createDecryptionCipher;break;case"AES-256-CBC":d=32,et=forge$1.aes.createDecryptionCipher;break;case"RC2-40-CBC":d=5,et=function($t){return forge$1.rc2.createDecryptionCipher($t,40)};break;case"RC2-64-CBC":d=8,et=function($t){return forge$1.rc2.createDecryptionCipher($t,64)};break;case"RC2-128-CBC":d=16,et=function($t){return forge$1.rc2.createDecryptionCipher($t,128)};break;default:var h=new Error('Could not decrypt private key; unsupported encryption algorithm "'+c.dekInfo.algorithm+'".');throw h.algorithm=c.dekInfo.algorithm,h}var ft=forge$1.util.hexToBytes(c.dekInfo.parameters),gt=forge$1.pbe.opensslDeriveBytes(e,ft.substr(0,8),d),_t=et(gt);if(_t.start(ft),_t.update(forge$1.util.createBuffer(c.body)),_t.finish())a=_t.output.getBytes();else return a}else a=c.body;return c.type==="ENCRYPTED PRIVATE KEY"?a=pki.decryptPrivateKeyInfo(asn1.fromDer(a),e):a=asn1.fromDer(a),a!==null&&(a=pki.privateKeyFromAsn1(a)),a};pki.pbe.generatePkcs12Key=function(i,e,a,c,h,d){var et,ft;if(typeof d>"u"||d===null){if(!("sha1"in forge$1.md))throw new Error('"sha1" hash algorithm unavailable.');d=forge$1.md.sha1.create()}var gt=d.digestLength,_t=d.blockLength,wt=new forge$1.util.ByteBuffer,$t=new forge$1.util.ByteBuffer;if(i!=null){for(ft=0;ft<i.length;ft++)$t.putInt16(i.charCodeAt(ft));$t.putInt16(0)}var It=$t.length(),Rt=e.length(),Tt=new forge$1.util.ByteBuffer;Tt.fillWithByte(a,_t);var At=_t*Math.ceil(Rt/_t),kt=new forge$1.util.ByteBuffer;for(ft=0;ft<At;ft++)kt.putByte(e.at(ft%Rt));var xt=_t*Math.ceil(It/_t),Nt=new forge$1.util.ByteBuffer;for(ft=0;ft<xt;ft++)Nt.putByte($t.at(ft%It));var Ft=kt;Ft.putBuffer(Nt);for(var jt=Math.ceil(h/gt),Gt=1;Gt<=jt;Gt++){var Kt=new forge$1.util.ByteBuffer;Kt.putBytes(Tt.bytes()),Kt.putBytes(Ft.bytes());for(var Wt=0;Wt<c;Wt++)d.start(),d.update(Kt.getBytes()),Kt=d.digest();var Zt=new forge$1.util.ByteBuffer;for(ft=0;ft<_t;ft++)Zt.putByte(Kt.at(ft%gt));var cr=Math.ceil(Rt/_t)+Math.ceil(It/_t),hr=new forge$1.util.ByteBuffer;for(et=0;et<cr;et++){var gr=new forge$1.util.ByteBuffer(Ft.getBytes(_t)),er=511;for(ft=Zt.length()-1;ft>=0;ft--)er=er>>8,er+=Zt.at(ft)+gr.at(ft),gr.setAt(ft,er&255);hr.putBuffer(gr)}Ft=hr,wt.putBuffer(Kt)}return wt.truncate(wt.length()-h),wt};pki.pbe.getCipher=function(i,e,a){switch(i){case pki.oids.pkcs5PBES2:return pki.pbe.getCipherForPBES2(i,e,a);case pki.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:case pki.oids["pbewithSHAAnd40BitRC2-CBC"]:return pki.pbe.getCipherForPKCS12PBE(i,e,a);default:var c=new Error("Cannot read encrypted PBE data block. Unsupported OID.");throw c.oid=i,c.supportedOids=["pkcs5PBES2","pbeWithSHAAnd3-KeyTripleDES-CBC","pbewithSHAAnd40BitRC2-CBC"],c}};pki.pbe.getCipherForPBES2=function(i,e,a){var c={},h=[];if(!asn1.validate(e,PBES2AlgorithmsValidator,c,h)){var d=new Error("Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw d.errors=h,d}if(i=asn1.derToOid(c.kdfOid),i!==pki.oids.pkcs5PBKDF2){var d=new Error("Cannot read encrypted private key. Unsupported key derivation function OID.");throw d.oid=i,d.supportedOids=["pkcs5PBKDF2"],d}if(i=asn1.derToOid(c.encOid),i!==pki.oids["aes128-CBC"]&&i!==pki.oids["aes192-CBC"]&&i!==pki.oids["aes256-CBC"]&&i!==pki.oids["des-EDE3-CBC"]&&i!==pki.oids.desCBC){var d=new Error("Cannot read encrypted private key. Unsupported encryption scheme OID.");throw d.oid=i,d.supportedOids=["aes128-CBC","aes192-CBC","aes256-CBC","des-EDE3-CBC","desCBC"],d}var et=c.kdfSalt,ft=forge$1.util.createBuffer(c.kdfIterationCount);ft=ft.getInt(ft.length()<<3);var gt,_t;switch(pki.oids[i]){case"aes128-CBC":gt=16,_t=forge$1.aes.createDecryptionCipher;break;case"aes192-CBC":gt=24,_t=forge$1.aes.createDecryptionCipher;break;case"aes256-CBC":gt=32,_t=forge$1.aes.createDecryptionCipher;break;case"des-EDE3-CBC":gt=24,_t=forge$1.des.createDecryptionCipher;break;case"desCBC":gt=8,_t=forge$1.des.createDecryptionCipher;break}var wt=prfOidToMessageDigest(c.prfOid),$t=forge$1.pkcs5.pbkdf2(a,et,ft,gt,wt),It=c.encIv,Rt=_t($t);return Rt.start(It),Rt};pki.pbe.getCipherForPKCS12PBE=function(i,e,a){var c={},h=[];if(!asn1.validate(e,pkcs12PbeParamsValidator,c,h)){var d=new Error("Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw d.errors=h,d}var et=forge$1.util.createBuffer(c.salt),ft=forge$1.util.createBuffer(c.iterations);ft=ft.getInt(ft.length()<<3);var gt,_t,wt;switch(i){case pki.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:gt=24,_t=8,wt=forge$1.des.startDecrypting;break;case pki.oids["pbewithSHAAnd40BitRC2-CBC"]:gt=5,_t=8,wt=function(At,kt){var xt=forge$1.rc2.createDecryptionCipher(At,40);return xt.start(kt,null),xt};break;default:var d=new Error("Cannot read PKCS #12 PBE data block. Unsupported OID.");throw d.oid=i,d}var $t=prfOidToMessageDigest(c.prfOid),It=pki.pbe.generatePkcs12Key(a,et,1,ft,gt,$t);$t.start();var Rt=pki.pbe.generatePkcs12Key(a,et,2,ft,_t,$t);return wt(It,Rt)};pki.pbe.opensslDeriveBytes=function(i,e,a,c){if(typeof c>"u"||c===null){if(!("md5"in forge$1.md))throw new Error('"md5" hash algorithm unavailable.');c=forge$1.md.md5.create()}e===null&&(e="");for(var h=[hash(c,i+e)],d=16,et=1;d<a;++et,d+=16)h.push(hash(c,h[et-1]+i+e));return h.join("").substr(0,a)};function hash(i,e){return i.start().update(e).digest().getBytes()}function prfOidToMessageDigest(i){var e;if(!i)e="hmacWithSHA1";else if(e=pki.oids[asn1.derToOid(i)],!e){var a=new Error("Unsupported PRF OID.");throw a.oid=i,a.supported=["hmacWithSHA1","hmacWithSHA224","hmacWithSHA256","hmacWithSHA384","hmacWithSHA512"],a}return prfAlgorithmToMessageDigest(e)}function prfAlgorithmToMessageDigest(i){var e=forge$1.md;switch(i){case"hmacWithSHA224":e=forge$1.md.sha512;case"hmacWithSHA1":case"hmacWithSHA256":case"hmacWithSHA384":case"hmacWithSHA512":i=i.substr(8).toLowerCase();break;default:var a=new Error("Unsupported PRF algorithm.");throw a.algorithm=i,a.supported=["hmacWithSHA1","hmacWithSHA224","hmacWithSHA256","hmacWithSHA384","hmacWithSHA512"],a}if(!e||!(i in e))throw new Error("Unknown hash algorithm: "+i);return e[i].create()}function createPbkdf2Params(i,e,a,c){var h=asn1.create(asn1.Class.UNIVERSAL,asn1.Type.SEQUENCE,!0,[asn1.create(asn1.Class.UNIVERSAL,asn1.Type.OCTETSTRING,!1,i),asn1.create(asn1.Class.UNIVERSAL,asn1.Type.INTEGER,!1,e.getBytes())]);return c!=="hmacWithSHA1"&&h.value.push(asn1.create(asn1.Class.UNIVERSAL,asn1.Type.INTEGER,!1,forge$1.util.hexToBytes(a.toString(16))),asn1.create(asn1.Class.UNIVERSAL,asn1.Type.SEQUENCE,!0,[asn1.create(asn1.Class.UNIVERSAL,asn1.Type.OID,!1,asn1.oidToDer(pki.oids[c]).getBytes()),asn1.create(asn1.Class.UNIVERSAL,asn1.Type.NULL,!1,"")])),h}let CodeError$3=class extends Error{constructor(a,c,h){super(a);qt(this,"code");qt(this,"props");this.code=c,this.name=(h==null?void 0:h.name)??"CodeError",this.props=h??{}}};class AggregateCodeError extends AggregateError{constructor(a,c,h,d){super(a,c);qt(this,"code");qt(this,"props");this.code=h,this.name=(d==null?void 0:d.name)??"AggregateCodeError",this.props=d??{}}}function coerce$5(i){if(i instanceof Uint8Array&&i.constructor.name==="Uint8Array")return i;if(i instanceof ArrayBuffer)return new Uint8Array(i);if(ArrayBuffer.isView(i))return new Uint8Array(i.buffer,i.byteOffset,i.byteLength);throw new Error("Unknown type, must be binary type")}function fromString$8(i){return new TextEncoder().encode(i)}function toString$c(i){return new TextDecoder().decode(i)}function base$6(i,e){if(i.length>=255)throw new TypeError("Alphabet too long");for(var a=new Uint8Array(256),c=0;c<a.length;c++)a[c]=255;for(var h=0;h<i.length;h++){var d=i.charAt(h),et=d.charCodeAt(0);if(a[et]!==255)throw new TypeError(d+" is ambiguous");a[et]=h}var ft=i.length,gt=i.charAt(0),_t=Math.log(ft)/Math.log(256),wt=Math.log(256)/Math.log(ft);function $t(Tt){if(Tt instanceof Uint8Array||(ArrayBuffer.isView(Tt)?Tt=new Uint8Array(Tt.buffer,Tt.byteOffset,Tt.byteLength):Array.isArray(Tt)&&(Tt=Uint8Array.from(Tt))),!(Tt instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(Tt.length===0)return"";for(var At=0,kt=0,xt=0,Nt=Tt.length;xt!==Nt&&Tt[xt]===0;)xt++,At++;for(var Ft=(Nt-xt)*wt+1>>>0,jt=new Uint8Array(Ft);xt!==Nt;){for(var Gt=Tt[xt],Kt=0,Wt=Ft-1;(Gt!==0||Kt<kt)&&Wt!==-1;Wt--,Kt++)Gt+=256*jt[Wt]>>>0,jt[Wt]=Gt%ft>>>0,Gt=Gt/ft>>>0;if(Gt!==0)throw new Error("Non-zero carry");kt=Kt,xt++}for(var Zt=Ft-kt;Zt!==Ft&&jt[Zt]===0;)Zt++;for(var cr=gt.repeat(At);Zt<Ft;++Zt)cr+=i.charAt(jt[Zt]);return cr}function It(Tt){if(typeof Tt!="string")throw new TypeError("Expected String");if(Tt.length===0)return new Uint8Array;var At=0;if(Tt[At]!==" "){for(var kt=0,xt=0;Tt[At]===gt;)kt++,At++;for(var Nt=(Tt.length-At)*_t+1>>>0,Ft=new Uint8Array(Nt);Tt[At];){var jt=a[Tt.charCodeAt(At)];if(jt===255)return;for(var Gt=0,Kt=Nt-1;(jt!==0||Gt<xt)&&Kt!==-1;Kt--,Gt++)jt+=ft*Ft[Kt]>>>0,Ft[Kt]=jt%256>>>0,jt=jt/256>>>0;if(jt!==0)throw new Error("Non-zero carry");xt=Gt,At++}if(Tt[At]!==" "){for(var Wt=Nt-xt;Wt!==Nt&&Ft[Wt]===0;)Wt++;for(var Zt=new Uint8Array(kt+(Nt-Wt)),cr=kt;Wt!==Nt;)Zt[cr++]=Ft[Wt++];return Zt}}}function Rt(Tt){var At=It(Tt);if(At)return At;throw new Error(`Non-${e} character`)}return{encode:$t,decodeUnsafe:It,decode:Rt}}var src$5=base$6,_brrp__multiformats_scope_baseX$5=src$5;let Encoder$7=class{constructor(e,a,c){qt(this,"name");qt(this,"prefix");qt(this,"baseEncode");this.name=e,this.prefix=a,this.baseEncode=c}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Decoder$7=class{constructor(e,a,c){qt(this,"name");qt(this,"prefix");qt(this,"baseDecode");qt(this,"prefixCodePoint");if(this.name=e,this.prefix=a,a.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=a.codePointAt(0),this.baseDecode=c}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return or$7(this,e)}},ComposedDecoder$5=class{constructor(e){qt(this,"decoders");this.decoders=e}or(e){return or$7(this,e)}decode(e){const a=e[0],c=this.decoders[a];if(c!=null)return c.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function or$7(i,e){return new ComposedDecoder$5({...i.decoders??{[i.prefix]:i},...e.decoders??{[e.prefix]:e}})}let Codec$5=class{constructor(e,a,c,h){qt(this,"name");qt(this,"prefix");qt(this,"baseEncode");qt(this,"baseDecode");qt(this,"encoder");qt(this,"decoder");this.name=e,this.prefix=a,this.baseEncode=c,this.baseDecode=h,this.encoder=new Encoder$7(e,a,c),this.decoder=new Decoder$7(e,a,h)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function from$7({name:i,prefix:e,encode:a,decode:c}){return new Codec$5(i,e,a,c)}function baseX$5({name:i,prefix:e,alphabet:a}){const{encode:c,decode:h}=_brrp__multiformats_scope_baseX$5(a,i);return from$7({prefix:e,name:i,encode:c,decode:d=>coerce$5(h(d))})}function decode$h(i,e,a,c){const h={};for(let wt=0;wt<e.length;++wt)h[e[wt]]=wt;let d=i.length;for(;i[d-1]==="=";)--d;const et=new Uint8Array(d*a/8|0);let ft=0,gt=0,_t=0;for(let wt=0;wt<d;++wt){const $t=h[i[wt]];if($t===void 0)throw new SyntaxError(`Non-${c} character`);gt=gt<<a|$t,ft+=a,ft>=8&&(ft-=8,et[_t++]=255&gt>>ft)}if(ft>=a||255&gt<<8-ft)throw new SyntaxError("Unexpected end of data");return et}function encode$j(i,e,a){const c=e[e.length-1]==="=",h=(1<<a)-1;let d="",et=0,ft=0;for(let gt=0;gt<i.length;++gt)for(ft=ft<<8|i[gt],et+=8;et>a;)et-=a,d+=e[h&ft>>et];if(et!==0&&(d+=e[h&ft<<a-et]),c)for(;d.length*a&7;)d+="=";return d}function rfc4648$5({name:i,prefix:e,bitsPerChar:a,alphabet:c}){return from$7({prefix:e,name:i,encode(h){return encode$j(h,c,a)},decode(h){return decode$h(h,c,a,i)}})}const base10$8=baseX$5({prefix:"9",name:"base10",alphabet:"0123456789"}),base10$9=Object.freeze(Object.defineProperty({__proto__:null,base10:base10$8},Symbol.toStringTag,{value:"Module"})),base16$8=rfc4648$5({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),base16upper$4=rfc4648$5({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),base16$9=Object.freeze(Object.defineProperty({__proto__:null,base16:base16$8,base16upper:base16upper$4},Symbol.toStringTag,{value:"Module"})),base2$8=rfc4648$5({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),base2$9=Object.freeze(Object.defineProperty({__proto__:null,base2:base2$8},Symbol.toStringTag,{value:"Module"})),alphabet$4=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),alphabetBytesToChars$4=alphabet$4.reduce((i,e,a)=>(i[a]=e,i),[]),alphabetCharsToBytes$4=alphabet$4.reduce((i,e,a)=>(i[e.codePointAt(0)]=a,i),[]);function encode$i(i){return i.reduce((e,a)=>(e+=alphabetBytesToChars$4[a],e),"")}function decode$g(i){const e=[];for(const a of i){const c=alphabetCharsToBytes$4[a.codePointAt(0)];if(c===void 0)throw new Error(`Non-base256emoji character: ${a}`);e.push(c)}return new Uint8Array(e)}const base256emoji$8=from$7({prefix:"🚀",name:"base256emoji",encode:encode$i,decode:decode$g}),base256emoji$9=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:base256emoji$8},Symbol.toStringTag,{value:"Module"})),base32$a=rfc4648$5({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),base32upper$4=rfc4648$5({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),base32pad$4=rfc4648$5({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),base32padupper$4=rfc4648$5({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),base32hex$4=rfc4648$5({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),base32hexupper$4=rfc4648$5({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),base32hexpad$4=rfc4648$5({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),base32hexpadupper$4=rfc4648$5({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),base32z$4=rfc4648$5({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),base32$b=Object.freeze(Object.defineProperty({__proto__:null,base32:base32$a,base32hex:base32hex$4,base32hexpad:base32hexpad$4,base32hexpadupper:base32hexpadupper$4,base32hexupper:base32hexupper$4,base32pad:base32pad$4,base32padupper:base32padupper$4,base32upper:base32upper$4,base32z:base32z$4},Symbol.toStringTag,{value:"Module"})),base36$8=baseX$5({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),base36upper$4=baseX$5({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),base36$9=Object.freeze(Object.defineProperty({__proto__:null,base36:base36$8,base36upper:base36upper$4},Symbol.toStringTag,{value:"Module"})),base58btc$5=baseX$5({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),base58flickr$4=baseX$5({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),base58$4=Object.freeze(Object.defineProperty({__proto__:null,base58btc:base58btc$5,base58flickr:base58flickr$4},Symbol.toStringTag,{value:"Module"})),base64$a=rfc4648$5({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),base64pad$4=rfc4648$5({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),base64url$5=rfc4648$5({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),base64urlpad$4=rfc4648$5({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),base64$b=Object.freeze(Object.defineProperty({__proto__:null,base64:base64$a,base64pad:base64pad$4,base64url:base64url$5,base64urlpad:base64urlpad$4},Symbol.toStringTag,{value:"Module"})),base8$8=rfc4648$5({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),base8$9=Object.freeze(Object.defineProperty({__proto__:null,base8:base8$8},Symbol.toStringTag,{value:"Module"})),identity$5=from$7({prefix:"\0",name:"identity",encode:i=>toString$c(i),decode:i=>fromString$8(i)}),identityBase$4=Object.freeze(Object.defineProperty({__proto__:null,identity:identity$5},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;var encode_1=encode$h,MSB$1=128,REST$1=127,MSBALL=~REST$1,INT=Math.pow(2,31);function encode$h(i,e,a){e=e||[],a=a||0;for(var c=a;i>=INT;)e[a++]=i&255|MSB$1,i/=128;for(;i&MSBALL;)e[a++]=i&255|MSB$1,i>>>=7;return e[a]=i|0,encode$h.bytes=a-c+1,e}var decode$f=read$2,MSB$1$1=128,REST$1$1=127;function read$2(i,c){var a=0,c=c||0,h=0,d=c,et,ft=i.length;do{if(d>=ft)throw read$2.bytes=0,new RangeError("Could not decode varint");et=i[d++],a+=h<28?(et&REST$1$1)<<h:(et&REST$1$1)*Math.pow(2,h),h+=7}while(et>=MSB$1$1);return read$2.bytes=d-c,a}var N1=Math.pow(2,7),N2=Math.pow(2,14),N3=Math.pow(2,21),N4=Math.pow(2,28),N5=Math.pow(2,35),N6=Math.pow(2,42),N7=Math.pow(2,49),N8=Math.pow(2,56),N9=Math.pow(2,63),length$1=function(i){return i<N1?1:i<N2?2:i<N3?3:i<N4?4:i<N5?5:i<N6?6:i<N7?7:i<N8?8:i<N9?9:10},varint={encode:encode_1,decode:decode$f,encodingLength:length$1},_brrp_varint=varint;function encodeTo(i,e,a=0){return _brrp_varint.encode(i,e,a),e}function encodingLength$2(i){return _brrp_varint.encodingLength(i)}function create$2(i,e){const a=e.byteLength,c=encodingLength$2(i),h=c+encodingLength$2(a),d=new Uint8Array(h+a);return encodeTo(i,d,0),encodeTo(a,d,c),d.set(e,h),new Digest(i,a,e,d)}class Digest{constructor(e,a,c,h){qt(this,"code");qt(this,"size");qt(this,"digest");qt(this,"bytes");this.code=e,this.size=a,this.digest=c,this.bytes=h}}const code=0,name$r="identity",encode$g=coerce$5;function digest(i){return create$2(code,encode$g(i))}const identity$4={code,name:name$r,encode:encode$g,digest};function from$6({name:i,code:e,encode:a}){return new Hasher(i,e,a)}class Hasher{constructor(e,a,c){qt(this,"name");qt(this,"code");qt(this,"encode");this.name=e,this.code=a,this.encode=c}digest(e){if(e instanceof Uint8Array){const a=this.encode(e);return a instanceof Uint8Array?create$2(this.code,a):a.then(c=>create$2(this.code,c))}else throw Error("Unknown type, must be binary type")}}function sha(i){return async e=>new Uint8Array(await crypto.subtle.digest(i,e))}const sha256=from$6({name:"sha2-256",code:18,encode:sha("SHA-256")}),bases$4={...identityBase$4,...base2$9,...base8$9,...base10$9,...base16$9,...base32$b,...base36$9,...base58$4,...base64$b,...base256emoji$9};function allocUnsafe$7(i=0){return new Uint8Array(i)}function createCodec$5(i,e,a,c){return{name:i,prefix:e,encoder:{name:i,prefix:e,encode:a},decoder:{decode:c}}}const string$6=createCodec$5("utf8","u",i=>"u"+new TextDecoder("utf8").decode(i),i=>new TextEncoder().encode(i.substring(1))),ascii$4=createCodec$5("ascii","a",i=>{let e="a";for(let a=0;a<i.length;a++)e+=String.fromCharCode(i[a]);return e},i=>{i=i.substring(1);const e=allocUnsafe$7(i.length);for(let a=0;a<i.length;a++)e[a]=i.charCodeAt(a);return e}),BASES$4={utf8:string$6,"utf-8":string$6,hex:bases$4.base16,latin1:ascii$4,ascii:ascii$4,binary:ascii$4,...bases$4};function fromString$7(i,e="utf8"){const a=BASES$4[e];if(a==null)throw new Error(`Unsupported encoding "${e}"`);return a.decoder.decode(`${a.prefix}${i}`)}function equals$2(i,e){if(i===e)return!0;if(i.byteLength!==e.byteLength)return!1;for(let a=0;a<i.byteLength;a++)if(i[a]!==e[a])return!1;return!0}function asUint8Array$1(i){return i}function concat$2(i,e){e==null&&(e=i.reduce((h,d)=>h+d.length,0));const a=allocUnsafe$7(e);let c=0;for(const h of i)a.set(h,c),c+=h.length;return a}function toString$b(i,e="utf8"){const a=BASES$4[e];if(a==null)throw new Error(`Unsupported encoding "${e}"`);return a.encoder.encode(i).substring(1)}function bigIntegerToUintBase64url$1(i,e){let a=Uint8Array.from(i.abs().toByteArray());if(a=a[0]===0?a.subarray(1):a,e!=null){if(a.length>e)throw new Error("byte array longer than desired length");a=concat$2([new Uint8Array(e-a.length),a])}return toString$b(a,"base64url")}function base64urlToBigInteger$1(i){const e=base64urlToBuffer$1(i);return new forge$n.jsbn.BigInteger(toString$b(e,"base16"),16)}function base64urlToBuffer$1(i,e){let a=fromString$7(i,"base64urlpad");if(e!=null){if(a.length>e)throw new Error("byte array longer than desired length");a=concat$2([new Uint8Array(e-a.length),a])}return a}function isPromise$2(i){return i==null?!1:typeof i.then=="function"&&typeof i.catch=="function"&&typeof i.finally=="function"}const U32_MASK64=BigInt(2**32-1),_32n=BigInt(32);function fromBig(i,e=!1){return e?{h:Number(i&U32_MASK64),l:Number(i>>_32n&U32_MASK64)}:{h:Number(i>>_32n&U32_MASK64)|0,l:Number(i&U32_MASK64)|0}}function split(i,e=!1){let a=new Uint32Array(i.length),c=new Uint32Array(i.length);for(let h=0;h<i.length;h++){const{h:d,l:et}=fromBig(i[h],e);[a[h],c[h]]=[d,et]}return[a,c]}const toBig=(i,e)=>BigInt(i>>>0)<<_32n|BigInt(e>>>0),shrSH=(i,e,a)=>i>>>a,shrSL=(i,e,a)=>i<<32-a|e>>>a,rotrSH=(i,e,a)=>i>>>a|e<<32-a,rotrSL=(i,e,a)=>i<<32-a|e>>>a,rotrBH=(i,e,a)=>i<<64-a|e>>>a-32,rotrBL=(i,e,a)=>i>>>a-32|e<<64-a,rotr32H=(i,e)=>e,rotr32L=(i,e)=>i,rotlSH=(i,e,a)=>i<<a|e>>>32-a,rotlSL=(i,e,a)=>e<<a|i>>>32-a,rotlBH=(i,e,a)=>e<<a-32|i>>>64-a,rotlBL=(i,e,a)=>i<<a-32|e>>>64-a;function add(i,e,a,c){const h=(e>>>0)+(c>>>0);return{h:i+a+(h/2**32|0)|0,l:h|0}}const add3L=(i,e,a)=>(i>>>0)+(e>>>0)+(a>>>0),add3H=(i,e,a,c)=>e+a+c+(i/2**32|0)|0,add4L=(i,e,a,c)=>(i>>>0)+(e>>>0)+(a>>>0)+(c>>>0),add4H=(i,e,a,c,h)=>e+a+c+h+(i/2**32|0)|0,add5L=(i,e,a,c,h)=>(i>>>0)+(e>>>0)+(a>>>0)+(c>>>0)+(h>>>0),add5H=(i,e,a,c,h,d)=>e+a+c+h+d+(i/2**32|0)|0,u64={fromBig,split,toBig,shrSH,shrSL,rotrSH,rotrSL,rotrBH,rotrBL,rotr32H,rotr32L,rotlSH,rotlSL,rotlBH,rotlBL,add,add3L,add3H,add4L,add4H,add5H,add5L},[SHA512_Kh,SHA512_Kl]=u64.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(i=>BigInt(i))),SHA512_W_H=new Uint32Array(80),SHA512_W_L=new Uint32Array(80);class SHA512 extends HashMD{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:a,Bh:c,Bl:h,Ch:d,Cl:et,Dh:ft,Dl:gt,Eh:_t,El:wt,Fh:$t,Fl:It,Gh:Rt,Gl:Tt,Hh:At,Hl:kt}=this;return[e,a,c,h,d,et,ft,gt,_t,wt,$t,It,Rt,Tt,At,kt]}set(e,a,c,h,d,et,ft,gt,_t,wt,$t,It,Rt,Tt,At,kt){this.Ah=e|0,this.Al=a|0,this.Bh=c|0,this.Bl=h|0,this.Ch=d|0,this.Cl=et|0,this.Dh=ft|0,this.Dl=gt|0,this.Eh=_t|0,this.El=wt|0,this.Fh=$t|0,this.Fl=It|0,this.Gh=Rt|0,this.Gl=Tt|0,this.Hh=At|0,this.Hl=kt|0}process(e,a){for(let Ft=0;Ft<16;Ft++,a+=4)SHA512_W_H[Ft]=e.getUint32(a),SHA512_W_L[Ft]=e.getUint32(a+=4);for(let Ft=16;Ft<80;Ft++){const jt=SHA512_W_H[Ft-15]|0,Gt=SHA512_W_L[Ft-15]|0,Kt=u64.rotrSH(jt,Gt,1)^u64.rotrSH(jt,Gt,8)^u64.shrSH(jt,Gt,7),Wt=u64.rotrSL(jt,Gt,1)^u64.rotrSL(jt,Gt,8)^u64.shrSL(jt,Gt,7),Zt=SHA512_W_H[Ft-2]|0,cr=SHA512_W_L[Ft-2]|0,hr=u64.rotrSH(Zt,cr,19)^u64.rotrBH(Zt,cr,61)^u64.shrSH(Zt,cr,6),gr=u64.rotrSL(Zt,cr,19)^u64.rotrBL(Zt,cr,61)^u64.shrSL(Zt,cr,6),er=u64.add4L(Wt,gr,SHA512_W_L[Ft-7],SHA512_W_L[Ft-16]),mr=u64.add4H(er,Kt,hr,SHA512_W_H[Ft-7],SHA512_W_H[Ft-16]);SHA512_W_H[Ft]=mr|0,SHA512_W_L[Ft]=er|0}let{Ah:c,Al:h,Bh:d,Bl:et,Ch:ft,Cl:gt,Dh:_t,Dl:wt,Eh:$t,El:It,Fh:Rt,Fl:Tt,Gh:At,Gl:kt,Hh:xt,Hl:Nt}=this;for(let Ft=0;Ft<80;Ft++){const jt=u64.rotrSH($t,It,14)^u64.rotrSH($t,It,18)^u64.rotrBH($t,It,41),Gt=u64.rotrSL($t,It,14)^u64.rotrSL($t,It,18)^u64.rotrBL($t,It,41),Kt=$t&Rt^~$t&At,Wt=It&Tt^~It&kt,Zt=u64.add5L(Nt,Gt,Wt,SHA512_Kl[Ft],SHA512_W_L[Ft]),cr=u64.add5H(Zt,xt,jt,Kt,SHA512_Kh[Ft],SHA512_W_H[Ft]),hr=Zt|0,gr=u64.rotrSH(c,h,28)^u64.rotrBH(c,h,34)^u64.rotrBH(c,h,39),er=u64.rotrSL(c,h,28)^u64.rotrBL(c,h,34)^u64.rotrBL(c,h,39),mr=c&d^c&ft^d&ft,Mr=h&et^h&gt^et&gt;xt=At|0,Nt=kt|0,At=Rt|0,kt=Tt|0,Rt=$t|0,Tt=It|0,{h:$t,l:It}=u64.add(_t|0,wt|0,cr|0,hr|0),_t=ft|0,wt=gt|0,ft=d|0,gt=et|0,d=c|0,et=h|0;const wr=u64.add3L(hr,er,Mr);c=u64.add3H(wr,cr,gr,mr),h=wr|0}({h:c,l:h}=u64.add(this.Ah|0,this.Al|0,c|0,h|0)),{h:d,l:et}=u64.add(this.Bh|0,this.Bl|0,d|0,et|0),{h:ft,l:gt}=u64.add(this.Ch|0,this.Cl|0,ft|0,gt|0),{h:_t,l:wt}=u64.add(this.Dh|0,this.Dl|0,_t|0,wt|0),{h:$t,l:It}=u64.add(this.Eh|0,this.El|0,$t|0,It|0),{h:Rt,l:Tt}=u64.add(this.Fh|0,this.Fl|0,Rt|0,Tt|0),{h:At,l:kt}=u64.add(this.Gh|0,this.Gl|0,At|0,kt|0),{h:xt,l:Nt}=u64.add(this.Hh|0,this.Hl|0,xt|0,Nt|0),this.set(c,h,d,et,ft,gt,_t,wt,$t,It,Rt,Tt,At,kt,xt,Nt)}roundClean(){SHA512_W_H.fill(0),SHA512_W_L.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const sha512$1=wrapConstructor(()=>new SHA512);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$1=BigInt(0),_1n$2=BigInt(1),_2n$1=BigInt(2),_8n=BigInt(8),VERIFY_DEFAULT={zip215:!0};function validateOpts$1(i){const e=validateBasic(i);return validateObject(i,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function twistedEdwards(i){const e=validateOpts$1(i),{Fp:a,n:c,prehash:h,hash:d,randomBytes:et,nByteLength:ft,h:gt}=e,_t=_2n$1<<BigInt(ft*8)-_1n$2,wt=a.create,$t=e.uvRatio||((fr,yr)=>{try{return{isValid:!0,value:a.sqrt(fr*a.inv(yr))}}catch{return{isValid:!1,value:_0n$1}}}),It=e.adjustScalarBytes||(fr=>fr),Rt=e.domain||((fr,yr,$r)=>{if(yr.length||$r)throw new Error("Contexts/pre-hash are not supported");return fr}),Tt=fr=>typeof fr=="bigint"&&_0n$1<fr,At=(fr,yr)=>Tt(fr)&&Tt(yr)&&fr<yr,kt=fr=>fr===_0n$1||At(fr,_t);function xt(fr,yr){if(At(fr,yr))return fr;throw new Error(`Expected valid scalar < ${yr}, got ${typeof fr} ${fr}`)}function Nt(fr){return fr===_0n$1?fr:xt(fr,c)}const Ft=new Map;function jt(fr){if(!(fr instanceof Gt))throw new Error("ExtendedPoint expected")}class Gt{constructor(yr,$r,Fr,dr){if(this.ex=yr,this.ey=$r,this.ez=Fr,this.et=dr,!kt(yr))throw new Error("x required");if(!kt($r))throw new Error("y required");if(!kt(Fr))throw new Error("z required");if(!kt(dr))throw new Error("t required")}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(yr){if(yr instanceof Gt)throw new Error("extended point not allowed");const{x:$r,y:Fr}=yr||{};if(!kt($r)||!kt(Fr))throw new Error("invalid affine point");return new Gt($r,Fr,_1n$2,wt($r*Fr))}static normalizeZ(yr){const $r=a.invertBatch(yr.map(Fr=>Fr.ez));return yr.map((Fr,dr)=>Fr.toAffine($r[dr])).map(Gt.fromAffine)}_setWindowSize(yr){this._WINDOW_SIZE=yr,Ft.delete(this)}assertValidity(){const{a:yr,d:$r}=e;if(this.is0())throw new Error("bad point: ZERO");const{ex:Fr,ey:dr,ez:Br,et:Hr}=this,Jr=wt(Fr*Fr),zr=wt(dr*dr),br=wt(Br*Br),_r=wt(br*br),Vr=wt(Jr*yr),lr=wt(br*wt(Vr+zr)),Cr=wt(_r+wt($r*wt(Jr*zr)));if(lr!==Cr)throw new Error("bad point: equation left != right (1)");const xr=wt(Fr*dr),Kr=wt(Br*Hr);if(xr!==Kr)throw new Error("bad point: equation left != right (2)")}equals(yr){jt(yr);const{ex:$r,ey:Fr,ez:dr}=this,{ex:Br,ey:Hr,ez:Jr}=yr,zr=wt($r*Jr),br=wt(Br*dr),_r=wt(Fr*Jr),Vr=wt(Hr*dr);return zr===br&&_r===Vr}is0(){return this.equals(Gt.ZERO)}negate(){return new Gt(wt(-this.ex),this.ey,this.ez,wt(-this.et))}double(){const{a:yr}=e,{ex:$r,ey:Fr,ez:dr}=this,Br=wt($r*$r),Hr=wt(Fr*Fr),Jr=wt(_2n$1*wt(dr*dr)),zr=wt(yr*Br),br=$r+Fr,_r=wt(wt(br*br)-Br-Hr),Vr=zr+Hr,lr=Vr-Jr,Cr=zr-Hr,xr=wt(_r*lr),Kr=wt(Vr*Cr),Gr=wt(_r*Cr),vr=wt(lr*Vr);return new Gt(xr,Kr,vr,Gr)}add(yr){jt(yr);const{a:$r,d:Fr}=e,{ex:dr,ey:Br,ez:Hr,et:Jr}=this,{ex:zr,ey:br,ez:_r,et:Vr}=yr;if($r===BigInt(-1)){const hn=wt((Br-dr)*(br+zr)),pn=wt((Br+dr)*(br-zr)),vn=wt(pn-hn);if(vn===_0n$1)return this.double();const Tn=wt(Hr*_2n$1*Vr),Ht=wt(Jr*_2n$1*_r),Vt=Ht+Tn,Xt=pn+hn,Er=Ht-Tn,Sr=wt(Vt*vn),pr=wt(Xt*Er),Rr=wt(Vt*Er),Qr=wt(vn*Xt);return new Gt(Sr,pr,Qr,Rr)}const lr=wt(dr*zr),Cr=wt(Br*br),xr=wt(Jr*Fr*Vr),Kr=wt(Hr*_r),Gr=wt((dr+Br)*(zr+br)-lr-Cr),vr=Kr-xr,Nr=Kr+xr,Pr=wt(Cr-$r*lr),en=wt(Gr*vr),Wr=wt(Nr*Pr),Or=wt(Gr*Pr),Xr=wt(vr*Nr);return new Gt(en,Wr,Xr,Or)}subtract(yr){return this.add(yr.negate())}wNAF(yr){return Zt.wNAFCached(this,Ft,yr,Gt.normalizeZ)}multiply(yr){const{p:$r,f:Fr}=this.wNAF(xt(yr,c));return Gt.normalizeZ([$r,Fr])[0]}multiplyUnsafe(yr){let $r=Nt(yr);return $r===_0n$1?Wt:this.equals(Wt)||$r===_1n$2?this:this.equals(Kt)?this.wNAF($r).p:Zt.unsafeLadder(this,$r)}isSmallOrder(){return this.multiplyUnsafe(gt).is0()}isTorsionFree(){return Zt.unsafeLadder(this,c).is0()}toAffine(yr){const{ex:$r,ey:Fr,ez:dr}=this,Br=this.is0();yr==null&&(yr=Br?_8n:a.inv(dr));const Hr=wt($r*yr),Jr=wt(Fr*yr),zr=wt(dr*yr);if(Br)return{x:_0n$1,y:_1n$2};if(zr!==_1n$2)throw new Error("invZ was invalid");return{x:Hr,y:Jr}}clearCofactor(){const{h:yr}=e;return yr===_1n$2?this:this.multiplyUnsafe(yr)}static fromHex(yr,$r=!1){const{d:Fr,a:dr}=e,Br=a.BYTES;yr=ensureBytes$2("pointHex",yr,Br);const Hr=yr.slice(),Jr=yr[Br-1];Hr[Br-1]=Jr&-129;const zr=bytesToNumberLE(Hr);zr===_0n$1||($r?xt(zr,_t):xt(zr,a.ORDER));const br=wt(zr*zr),_r=wt(br-_1n$2),Vr=wt(Fr*br-dr);let{isValid:lr,value:Cr}=$t(_r,Vr);if(!lr)throw new Error("Point.fromHex: invalid y coordinate");const xr=(Cr&_1n$2)===_1n$2,Kr=(Jr&128)!==0;if(!$r&&Cr===_0n$1&&Kr)throw new Error("Point.fromHex: x=0 and x_0=1");return Kr!==xr&&(Cr=wt(-Cr)),Gt.fromAffine({x:Cr,y:zr})}static fromPrivateKey(yr){return gr(yr).point}toRawBytes(){const{x:yr,y:$r}=this.toAffine(),Fr=numberToBytesLE($r,a.BYTES);return Fr[Fr.length-1]|=yr&_1n$2?128:0,Fr}toHex(){return bytesToHex$2(this.toRawBytes())}}Gt.BASE=new Gt(e.Gx,e.Gy,_1n$2,wt(e.Gx*e.Gy)),Gt.ZERO=new Gt(_0n$1,_1n$2,_1n$2,_0n$1);const{BASE:Kt,ZERO:Wt}=Gt,Zt=wNAF(Gt,ft*8);function cr(fr){return mod$1(fr,c)}function hr(fr){return cr(bytesToNumberLE(fr))}function gr(fr){const yr=ft;fr=ensureBytes$2("private key",fr,yr);const $r=ensureBytes$2("hashed private key",d(fr),2*yr),Fr=It($r.slice(0,yr)),dr=$r.slice(yr,2*yr),Br=hr(Fr),Hr=Kt.multiply(Br),Jr=Hr.toRawBytes();return{head:Fr,prefix:dr,scalar:Br,point:Hr,pointBytes:Jr}}function er(fr){return gr(fr).pointBytes}function mr(fr=new Uint8Array,...yr){const $r=concatBytes$1(...yr);return hr(d(Rt($r,ensureBytes$2("context",fr),!!h)))}function Mr(fr,yr,$r={}){fr=ensureBytes$2("message",fr),h&&(fr=h(fr));const{prefix:Fr,scalar:dr,pointBytes:Br}=gr(yr),Hr=mr($r.context,Fr,fr),Jr=Kt.multiply(Hr).toRawBytes(),zr=mr($r.context,Jr,Br,fr),br=cr(Hr+zr*dr);Nt(br);const _r=concatBytes$1(Jr,numberToBytesLE(br,a.BYTES));return ensureBytes$2("result",_r,ft*2)}const wr=VERIFY_DEFAULT;function Dr(fr,yr,$r,Fr=wr){const{context:dr,zip215:Br}=Fr,Hr=a.BYTES;fr=ensureBytes$2("signature",fr,2*Hr),yr=ensureBytes$2("message",yr),h&&(yr=h(yr));const Jr=bytesToNumberLE(fr.slice(Hr,2*Hr));let zr,br,_r;try{zr=Gt.fromHex($r,Br),br=Gt.fromHex(fr.slice(0,Hr),Br),_r=Kt.multiplyUnsafe(Jr)}catch{return!1}if(!Br&&zr.isSmallOrder())return!1;const Vr=mr(dr,br.toRawBytes(),zr.toRawBytes(),yr);return br.add(zr.multiplyUnsafe(Vr)).subtract(_r).clearCofactor().equals(Gt.ZERO)}return Kt._setWindowSize(8),{CURVE:e,getPublicKey:er,sign:Mr,verify:Dr,ExtendedPoint:Gt,utils:{getExtendedPublicKey:gr,randomPrivateKey:()=>et(a.BYTES),precompute(fr=8,yr=Gt.BASE){return yr._setWindowSize(fr),yr.multiply(BigInt(3)),yr}}}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n=BigInt(0),_1n$1=BigInt(1);function validateOpts(i){return validateObject(i,{a:"bigint"},{montgomeryBits:"isSafeInteger",nByteLength:"isSafeInteger",adjustScalarBytes:"function",domain:"function",powPminus2:"function",Gu:"bigint"}),Object.freeze({...i})}function montgomery(i){const e=validateOpts(i),{P:a}=e,c=Ft=>mod$1(Ft,a),h=e.montgomeryBits,d=Math.ceil(h/8),et=e.nByteLength,ft=e.adjustScalarBytes||(Ft=>Ft),gt=e.powPminus2||(Ft=>pow(Ft,a-BigInt(2),a));function _t(Ft,jt,Gt){const Kt=c(Ft*(jt-Gt));return jt=c(jt-Kt),Gt=c(Gt+Kt),[jt,Gt]}function wt(Ft){if(typeof Ft=="bigint"&&_0n<=Ft&&Ft<a)return Ft;throw new Error("Expected valid scalar 0 < scalar < CURVE.P")}const $t=(e.a-BigInt(2))/BigInt(4);function It(Ft,jt){const Gt=wt(Ft),Kt=wt(jt),Wt=Gt;let Zt=_1n$1,cr=_0n,hr=Gt,gr=_1n$1,er=_0n,mr;for(let wr=BigInt(h-1);wr>=_0n;wr--){const Dr=Kt>>wr&_1n$1;er^=Dr,mr=_t(er,Zt,hr),Zt=mr[0],hr=mr[1],mr=_t(er,cr,gr),cr=mr[0],gr=mr[1],er=Dr;const Tr=Zt+cr,fr=c(Tr*Tr),yr=Zt-cr,$r=c(yr*yr),Fr=fr-$r,dr=hr+gr,Br=hr-gr,Hr=c(Br*Tr),Jr=c(dr*yr),zr=Hr+Jr,br=Hr-Jr;hr=c(zr*zr),gr=c(Wt*c(br*br)),Zt=c(fr*$r),cr=c(Fr*(fr+c($t*Fr)))}mr=_t(er,Zt,hr),Zt=mr[0],hr=mr[1],mr=_t(er,cr,gr),cr=mr[0],gr=mr[1];const Mr=gt(cr);return c(Zt*Mr)}function Rt(Ft){return numberToBytesLE(c(Ft),d)}function Tt(Ft){const jt=ensureBytes$2("u coordinate",Ft,d);return et===32&&(jt[31]&=127),bytesToNumberLE(jt)}function At(Ft){const jt=ensureBytes$2("scalar",Ft),Gt=jt.length;if(Gt!==d&&Gt!==et)throw new Error(`Expected ${d} or ${et} bytes, got ${Gt}`);return bytesToNumberLE(ft(jt))}function kt(Ft,jt){const Gt=Tt(jt),Kt=At(Ft),Wt=It(Gt,Kt);if(Wt===_0n)throw new Error("Invalid private or public key received");return Rt(Wt)}const xt=Rt(e.Gu);function Nt(Ft){return kt(Ft,xt)}return{scalarMult:kt,scalarMultBase:Nt,getSharedSecret:(Ft,jt)=>kt(Ft,jt),getPublicKey:Ft=>Nt(Ft),utils:{randomPrivateKey:()=>e.randomBytes(e.nByteLength)},GuBytes:xt}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const ED25519_P=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),ED25519_SQRT_M1=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const _1n=BigInt(1),_2n=BigInt(2),_5n=BigInt(5),_10n=BigInt(10),_20n=BigInt(20),_40n=BigInt(40),_80n=BigInt(80);function ed25519_pow_2_252_3(i){const e=ED25519_P,c=i*i%e*i%e,h=pow2$1(c,_2n,e)*c%e,d=pow2$1(h,_1n,e)*i%e,et=pow2$1(d,_5n,e)*d%e,ft=pow2$1(et,_10n,e)*et%e,gt=pow2$1(ft,_20n,e)*ft%e,_t=pow2$1(gt,_40n,e)*gt%e,wt=pow2$1(_t,_80n,e)*_t%e,$t=pow2$1(wt,_80n,e)*_t%e,It=pow2$1($t,_10n,e)*et%e;return{pow_p_5_8:pow2$1(It,_2n,e)*i%e,b2:c}}function adjustScalarBytes(i){return i[0]&=248,i[31]&=127,i[31]|=64,i}function uvRatio(i,e){const a=ED25519_P,c=mod$1(e*e*e,a),h=mod$1(c*c*e,a),d=ed25519_pow_2_252_3(i*h).pow_p_5_8;let et=mod$1(i*c*d,a);const ft=mod$1(e*et*et,a),gt=et,_t=mod$1(et*ED25519_SQRT_M1,a),wt=ft===i,$t=ft===mod$1(-i,a),It=ft===mod$1(-i*ED25519_SQRT_M1,a);return wt&&(et=gt),($t||It)&&(et=_t),isNegativeLE(et,a)&&(et=mod$1(-et,a)),{isValid:wt||$t,value:et}}const Fp=Field(ED25519_P,void 0,!0),ed25519Defaults={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:BigInt(8),Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:sha512$1,randomBytes:randomBytes$2,adjustScalarBytes,uvRatio},ed25519=twistedEdwards(ed25519Defaults);function ed25519_domain(i,e,a){if(e.length>255)throw new Error("Context is too big");return concatBytes$2(utf8ToBytes$3("SigEd25519 no Ed25519 collisions"),new Uint8Array([a?1:0,e.length]),e,i)}({...ed25519Defaults});({...ed25519Defaults});const x25519=montgomery({P:ED25519_P,a:BigInt(486662),montgomeryBits:255,nByteLength:32,Gu:BigInt(9),powPminus2:i=>{const e=ED25519_P,{pow_p_5_8:a,b2:c}=ed25519_pow_2_252_3(i);return mod$1(pow2$1(a,BigInt(3),e)*c,e)},adjustScalarBytes,randomBytes:randomBytes$2}),ELL2_C1=(Fp.ORDER+BigInt(3))/BigInt(8);Fp.pow(_2n,ELL2_C1);Fp.sqrt(Fp.neg(Fp.ONE));(Fp.ORDER-BigInt(5))/BigInt(8);BigInt(486662);FpSqrtEven(Fp,Fp.neg(BigInt(486664)));BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235");BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578");BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838");BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952");BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff");const PUBLIC_KEY_BYTE_LENGTH$1=32,PRIVATE_KEY_BYTE_LENGTH$1=64,KEYS_BYTE_LENGTH$1=32;function generateKey$5(){const i=ed25519.utils.randomPrivateKey(),e=ed25519.getPublicKey(i);return{privateKey:concatKeys$1(i,e),publicKey:e}}function generateKeyFromSeed$1(i){if(i.length!==KEYS_BYTE_LENGTH$1)throw new TypeError('"seed" must be 32 bytes in length.');if(!(i instanceof Uint8Array))throw new TypeError('"seed" must be a node.js Buffer, or Uint8Array.');const e=i,a=ed25519.getPublicKey(e);return{privateKey:concatKeys$1(e,a),publicKey:a}}function hashAndSign$5(i,e){const a=i.subarray(0,KEYS_BYTE_LENGTH$1);return ed25519.sign(e instanceof Uint8Array?e:e.subarray(),a)}function hashAndVerify$5(i,e,a){return ed25519.verify(e,a instanceof Uint8Array?a:a.subarray(),i)}function concatKeys$1(i,e){const a=new Uint8Array(PRIVATE_KEY_BYTE_LENGTH$1);for(let c=0;c<KEYS_BYTE_LENGTH$1;c++)a[c]=i[c],a[KEYS_BYTE_LENGTH$1+c]=e[c];return a}const webcrypto$1={get(i=globalThis){const e=i.crypto;if(e==null||e.subtle==null)throw Object.assign(new Error("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p/blob/main/packages/crypto/README.md#web-crypto-api"),{code:"ERR_MISSING_WEB_CRYPTO"});return e}},derivedEmptyPasswordKey$1={alg:"A128GCM",ext:!0,k:"scm9jmO_4BJAgdwWGVulLg",key_ops:["encrypt","decrypt"],kty:"oct"};function create$1(i){const e=(i==null?void 0:i.algorithm)??"AES-GCM";let a=(i==null?void 0:i.keyLength)??16;const c=(i==null?void 0:i.nonceLength)??12,h=(i==null?void 0:i.digest)??"SHA-256",d=(i==null?void 0:i.saltLength)??16,et=(i==null?void 0:i.iterations)??32767,ft=webcrypto$1.get();a*=8;async function gt($t,It){const Rt=ft.getRandomValues(new Uint8Array(d)),Tt=ft.getRandomValues(new Uint8Array(c)),At={name:e,iv:Tt};typeof It=="string"&&(It=fromString$7(It));let kt;if(It.length===0){kt=await ft.subtle.importKey("jwk",derivedEmptyPasswordKey$1,{name:"AES-GCM"},!0,["encrypt"]);try{const Nt={name:"PBKDF2",salt:Rt,iterations:et,hash:{name:h}},Ft=await ft.subtle.importKey("raw",It,{name:"PBKDF2"},!1,["deriveKey"]);kt=await ft.subtle.deriveKey(Nt,Ft,{name:e,length:a},!0,["encrypt"])}catch{kt=await ft.subtle.importKey("jwk",derivedEmptyPasswordKey$1,{name:"AES-GCM"},!0,["encrypt"])}}else{const Nt={name:"PBKDF2",salt:Rt,iterations:et,hash:{name:h}},Ft=await ft.subtle.importKey("raw",It,{name:"PBKDF2"},!1,["deriveKey"]);kt=await ft.subtle.deriveKey(Nt,Ft,{name:e,length:a},!0,["encrypt"])}const xt=await ft.subtle.encrypt(At,kt,$t);return concat$2([Rt,At.iv,new Uint8Array(xt)])}async function _t($t,It){const Rt=$t.subarray(0,d),Tt=$t.subarray(d,d+c),At=$t.subarray(d+c),kt={name:e,iv:Tt};typeof It=="string"&&(It=fromString$7(It));let xt;if(It.length===0)try{const Ft={name:"PBKDF2",salt:Rt,iterations:et,hash:{name:h}},jt=await ft.subtle.importKey("raw",It,{name:"PBKDF2"},!1,["deriveKey"]);xt=await ft.subtle.deriveKey(Ft,jt,{name:e,length:a},!0,["decrypt"])}catch{xt=await ft.subtle.importKey("jwk",derivedEmptyPasswordKey$1,{name:"AES-GCM"},!0,["decrypt"])}else{const Ft={name:"PBKDF2",salt:Rt,iterations:et,hash:{name:h}},jt=await ft.subtle.importKey("raw",It,{name:"PBKDF2"},!1,["deriveKey"]);xt=await ft.subtle.deriveKey(Ft,jt,{name:e,length:a},!0,["decrypt"])}const Nt=await ft.subtle.decrypt(kt,xt,At);return new Uint8Array(Nt)}return{encrypt:gt,decrypt:_t}}async function exporter$1(i,e){const c=await create$1().encrypt(i,e);return base64$a.encode(c)}const f32=new Float32Array([-0]),f8b=new Uint8Array(f32.buffer);function writeFloatLE(i,e,a){f32[0]=i,e[a]=f8b[0],e[a+1]=f8b[1],e[a+2]=f8b[2],e[a+3]=f8b[3]}function readFloatLE(i,e){return f8b[0]=i[e],f8b[1]=i[e+1],f8b[2]=i[e+2],f8b[3]=i[e+3],f32[0]}const f64=new Float64Array([-0]),d8b=new Uint8Array(f64.buffer);function writeDoubleLE(i,e,a){f64[0]=i,e[a]=d8b[0],e[a+1]=d8b[1],e[a+2]=d8b[2],e[a+3]=d8b[3],e[a+4]=d8b[4],e[a+5]=d8b[5],e[a+6]=d8b[6],e[a+7]=d8b[7]}function readDoubleLE(i,e){return d8b[0]=i[e],d8b[1]=i[e+1],d8b[2]=i[e+2],d8b[3]=i[e+3],d8b[4]=i[e+4],d8b[5]=i[e+5],d8b[6]=i[e+6],d8b[7]=i[e+7],f64[0]}const MAX_SAFE_NUMBER_INTEGER=BigInt(Number.MAX_SAFE_INTEGER),MIN_SAFE_NUMBER_INTEGER=BigInt(Number.MIN_SAFE_INTEGER);class LongBits{constructor(e,a){qt(this,"lo");qt(this,"hi");this.lo=e|0,this.hi=a|0}toNumber(e=!1){if(!e&&this.hi>>>31>0){const a=~this.lo+1>>>0;let c=~this.hi>>>0;return a===0&&(c=c+1>>>0),-(a+c*4294967296)}return this.lo+this.hi*4294967296}toBigInt(e=!1){if(e)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31){const a=~this.lo+1>>>0;let c=~this.hi>>>0;return a===0&&(c=c+1>>>0),-(BigInt(a)+(BigInt(c)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toString(e=!1){return this.toBigInt(e).toString()}zzEncode(){const e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this}zzDecode(){const e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this}length(){const e=this.lo,a=(this.lo>>>28|this.hi<<4)>>>0,c=this.hi>>>24;return c===0?a===0?e<16384?e<128?1:2:e<2097152?3:4:a<16384?a<128?5:6:a<2097152?7:8:c<128?9:10}static fromBigInt(e){if(e===0n)return zero;if(e<MAX_SAFE_NUMBER_INTEGER&&e>MIN_SAFE_NUMBER_INTEGER)return this.fromNumber(Number(e));const a=e<0n;a&&(e=-e);let c=e>>32n,h=e-(c<<32n);return a&&(c=~c|0n,h=~h|0n,++h>TWO_32&&(h=0n,++c>TWO_32&&(c=0n))),new LongBits(Number(h),Number(c))}static fromNumber(e){if(e===0)return zero;const a=e<0;a&&(e=-e);let c=e>>>0,h=(e-c)/4294967296>>>0;return a&&(h=~h>>>0,c=~c>>>0,++c>4294967295&&(c=0,++h>4294967295&&(h=0))),new LongBits(c,h)}static from(e){return typeof e=="number"?LongBits.fromNumber(e):typeof e=="bigint"?LongBits.fromBigInt(e):typeof e=="string"?LongBits.fromBigInt(BigInt(e)):e.low!=null||e.high!=null?new LongBits(e.low>>>0,e.high>>>0):zero}}const zero=new LongBits(0,0);zero.toBigInt=function(){return 0n};zero.zzEncode=zero.zzDecode=function(){return this};zero.length=function(){return 1};const TWO_32=4294967296n;function length(i){let e=0,a=0;for(let c=0;c<i.length;++c)a=i.charCodeAt(c),a<128?e+=1:a<2048?e+=2:(a&64512)===55296&&(i.charCodeAt(c+1)&64512)===56320?(++c,e+=4):e+=3;return e}function read$1(i,e,a){if(a-e<1)return"";let h;const d=[];let et=0,ft;for(;e<a;)ft=i[e++],ft<128?d[et++]=ft:ft>191&&ft<224?d[et++]=(ft&31)<<6|i[e++]&63:ft>239&&ft<365?(ft=((ft&7)<<18|(i[e++]&63)<<12|(i[e++]&63)<<6|i[e++]&63)-65536,d[et++]=55296+(ft>>10),d[et++]=56320+(ft&1023)):d[et++]=(ft&15)<<12|(i[e++]&63)<<6|i[e++]&63,et>8191&&((h??(h=[])).push(String.fromCharCode.apply(String,d)),et=0);return h!=null?(et>0&&h.push(String.fromCharCode.apply(String,d.slice(0,et))),h.join("")):String.fromCharCode.apply(String,d.slice(0,et))}function write$2(i,e,a){const c=a;let h,d;for(let et=0;et<i.length;++et)h=i.charCodeAt(et),h<128?e[a++]=h:h<2048?(e[a++]=h>>6|192,e[a++]=h&63|128):(h&64512)===55296&&((d=i.charCodeAt(et+1))&64512)===56320?(h=65536+((h&1023)<<10)+(d&1023),++et,e[a++]=h>>18|240,e[a++]=h>>12&63|128,e[a++]=h>>6&63|128,e[a++]=h&63|128):(e[a++]=h>>12|224,e[a++]=h>>6&63|128,e[a++]=h&63|128);return a-c}function indexOutOfRange(i,e){return RangeError(`index out of range: ${i.pos} + ${e??1} > ${i.len}`)}function readFixed32End(i,e){return(i[e-4]|i[e-3]<<8|i[e-2]<<16|i[e-1]<<24)>>>0}class Uint8ArrayReader{constructor(e){qt(this,"buf");qt(this,"pos");qt(this,"len");qt(this,"_slice",Uint8Array.prototype.subarray);this.buf=e,this.pos=0,this.len=e.length}uint32(){let e=4294967295;if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,indexOutOfRange(this,10);return e}int32(){return this.uint32()|0}sint32(){const e=this.uint32();return e>>>1^-(e&1)|0}bool(){return this.uint32()!==0}fixed32(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32End(this.buf,this.pos+=4)}sfixed32(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32End(this.buf,this.pos+=4)|0}float(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);const e=readFloatLE(this.buf,this.pos);return this.pos+=4,e}double(){if(this.pos+8>this.len)throw indexOutOfRange(this,4);const e=readDoubleLE(this.buf,this.pos);return this.pos+=8,e}bytes(){const e=this.uint32(),a=this.pos,c=this.pos+e;if(c>this.len)throw indexOutOfRange(this,e);return this.pos+=e,a===c?new Uint8Array(0):this.buf.subarray(a,c)}string(){const e=this.bytes();return read$1(e,0,e.length)}skip(e){if(typeof e=="number"){if(this.pos+e>this.len)throw indexOutOfRange(this,e);this.pos+=e}else do if(this.pos>=this.len)throw indexOutOfRange(this);while(this.buf[this.pos++]&128);return this}skipType(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(e=this.uint32()&7)!==4;)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error(`invalid wire type ${e} at offset ${this.pos}`)}return this}readLongVarint(){const e=new LongBits(0,0);let a=0;if(this.len-this.pos>4){for(;a<4;++a)if(e.lo=(e.lo|(this.buf[this.pos]&127)<<a*7)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(this.buf[this.pos]&127)<<28)>>>0,e.hi=(e.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return e;a=0}else{for(;a<3;++a){if(this.pos>=this.len)throw indexOutOfRange(this);if(e.lo=(e.lo|(this.buf[this.pos]&127)<<a*7)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(this.buf[this.pos++]&127)<<a*7)>>>0,e}if(this.len-this.pos>4){for(;a<5;++a)if(e.hi=(e.hi|(this.buf[this.pos]&127)<<a*7+3)>>>0,this.buf[this.pos++]<128)return e}else for(;a<5;++a){if(this.pos>=this.len)throw indexOutOfRange(this);if(e.hi=(e.hi|(this.buf[this.pos]&127)<<a*7+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}readFixed64(){if(this.pos+8>this.len)throw indexOutOfRange(this,8);const e=readFixed32End(this.buf,this.pos+=4),a=readFixed32End(this.buf,this.pos+=4);return new LongBits(e,a)}int64(){return this.readLongVarint().toBigInt()}int64Number(){return this.readLongVarint().toNumber()}int64String(){return this.readLongVarint().toString()}uint64(){return this.readLongVarint().toBigInt(!0)}uint64Number(){const e=decodeUint8Array(this.buf,this.pos);return this.pos+=encodingLength$4(e),e}uint64String(){return this.readLongVarint().toString(!0)}sint64(){return this.readLongVarint().zzDecode().toBigInt()}sint64Number(){return this.readLongVarint().zzDecode().toNumber()}sint64String(){return this.readLongVarint().zzDecode().toString()}fixed64(){return this.readFixed64().toBigInt()}fixed64Number(){return this.readFixed64().toNumber()}fixed64String(){return this.readFixed64().toString()}sfixed64(){return this.readFixed64().toBigInt()}sfixed64Number(){return this.readFixed64().toNumber()}sfixed64String(){return this.readFixed64().toString()}}function createReader(i){return new Uint8ArrayReader(i instanceof Uint8Array?i:i.subarray())}function decodeMessage$1(i,e,a){const c=createReader(i);return e.decode(c,void 0,a)}function allocUnsafe$6(i=0){return new Uint8Array(i)}function coerce$4(i){if(i instanceof Uint8Array&&i.constructor.name==="Uint8Array")return i;if(i instanceof ArrayBuffer)return new Uint8Array(i);if(ArrayBuffer.isView(i))return new Uint8Array(i.buffer,i.byteOffset,i.byteLength);throw new Error("Unknown type, must be binary type")}function fromString$6(i){return new TextEncoder().encode(i)}function toString$a(i){return new TextDecoder().decode(i)}function base$5(i,e){if(i.length>=255)throw new TypeError("Alphabet too long");for(var a=new Uint8Array(256),c=0;c<a.length;c++)a[c]=255;for(var h=0;h<i.length;h++){var d=i.charAt(h),et=d.charCodeAt(0);if(a[et]!==255)throw new TypeError(d+" is ambiguous");a[et]=h}var ft=i.length,gt=i.charAt(0),_t=Math.log(ft)/Math.log(256),wt=Math.log(256)/Math.log(ft);function $t(Tt){if(Tt instanceof Uint8Array||(ArrayBuffer.isView(Tt)?Tt=new Uint8Array(Tt.buffer,Tt.byteOffset,Tt.byteLength):Array.isArray(Tt)&&(Tt=Uint8Array.from(Tt))),!(Tt instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(Tt.length===0)return"";for(var At=0,kt=0,xt=0,Nt=Tt.length;xt!==Nt&&Tt[xt]===0;)xt++,At++;for(var Ft=(Nt-xt)*wt+1>>>0,jt=new Uint8Array(Ft);xt!==Nt;){for(var Gt=Tt[xt],Kt=0,Wt=Ft-1;(Gt!==0||Kt<kt)&&Wt!==-1;Wt--,Kt++)Gt+=256*jt[Wt]>>>0,jt[Wt]=Gt%ft>>>0,Gt=Gt/ft>>>0;if(Gt!==0)throw new Error("Non-zero carry");kt=Kt,xt++}for(var Zt=Ft-kt;Zt!==Ft&&jt[Zt]===0;)Zt++;for(var cr=gt.repeat(At);Zt<Ft;++Zt)cr+=i.charAt(jt[Zt]);return cr}function It(Tt){if(typeof Tt!="string")throw new TypeError("Expected String");if(Tt.length===0)return new Uint8Array;var At=0;if(Tt[At]!==" "){for(var kt=0,xt=0;Tt[At]===gt;)kt++,At++;for(var Nt=(Tt.length-At)*_t+1>>>0,Ft=new Uint8Array(Nt);Tt[At];){var jt=a[Tt.charCodeAt(At)];if(jt===255)return;for(var Gt=0,Kt=Nt-1;(jt!==0||Gt<xt)&&Kt!==-1;Kt--,Gt++)jt+=ft*Ft[Kt]>>>0,Ft[Kt]=jt%256>>>0,jt=jt/256>>>0;if(jt!==0)throw new Error("Non-zero carry");xt=Gt,At++}if(Tt[At]!==" "){for(var Wt=Nt-xt;Wt!==Nt&&Ft[Wt]===0;)Wt++;for(var Zt=new Uint8Array(kt+(Nt-Wt)),cr=kt;Wt!==Nt;)Zt[cr++]=Ft[Wt++];return Zt}}}function Rt(Tt){var At=It(Tt);if(At)return At;throw new Error(`Non-${e} character`)}return{encode:$t,decodeUnsafe:It,decode:Rt}}var src$4=base$5,_brrp__multiformats_scope_baseX$4=src$4;let Encoder$6=class{constructor(e,a,c){qt(this,"name");qt(this,"prefix");qt(this,"baseEncode");this.name=e,this.prefix=a,this.baseEncode=c}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Decoder$6=class{constructor(e,a,c){qt(this,"name");qt(this,"prefix");qt(this,"baseDecode");qt(this,"prefixCodePoint");if(this.name=e,this.prefix=a,a.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=a.codePointAt(0),this.baseDecode=c}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return or$6(this,e)}},ComposedDecoder$4=class{constructor(e){qt(this,"decoders");this.decoders=e}or(e){return or$6(this,e)}decode(e){const a=e[0],c=this.decoders[a];if(c!=null)return c.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function or$6(i,e){return new ComposedDecoder$4({...i.decoders??{[i.prefix]:i},...e.decoders??{[e.prefix]:e}})}let Codec$4=class{constructor(e,a,c,h){qt(this,"name");qt(this,"prefix");qt(this,"baseEncode");qt(this,"baseDecode");qt(this,"encoder");qt(this,"decoder");this.name=e,this.prefix=a,this.baseEncode=c,this.baseDecode=h,this.encoder=new Encoder$6(e,a,c),this.decoder=new Decoder$6(e,a,h)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function from$5({name:i,prefix:e,encode:a,decode:c}){return new Codec$4(i,e,a,c)}function baseX$4({name:i,prefix:e,alphabet:a}){const{encode:c,decode:h}=_brrp__multiformats_scope_baseX$4(a,i);return from$5({prefix:e,name:i,encode:c,decode:d=>coerce$4(h(d))})}function decode$e(i,e,a,c){const h={};for(let wt=0;wt<e.length;++wt)h[e[wt]]=wt;let d=i.length;for(;i[d-1]==="=";)--d;const et=new Uint8Array(d*a/8|0);let ft=0,gt=0,_t=0;for(let wt=0;wt<d;++wt){const $t=h[i[wt]];if($t===void 0)throw new SyntaxError(`Non-${c} character`);gt=gt<<a|$t,ft+=a,ft>=8&&(ft-=8,et[_t++]=255&gt>>ft)}if(ft>=a||255&gt<<8-ft)throw new SyntaxError("Unexpected end of data");return et}function encode$f(i,e,a){const c=e[e.length-1]==="=",h=(1<<a)-1;let d="",et=0,ft=0;for(let gt=0;gt<i.length;++gt)for(ft=ft<<8|i[gt],et+=8;et>a;)et-=a,d+=e[h&ft>>et];if(et!==0&&(d+=e[h&ft<<a-et]),c)for(;d.length*a&7;)d+="=";return d}function rfc4648$4({name:i,prefix:e,bitsPerChar:a,alphabet:c}){return from$5({prefix:e,name:i,encode(h){return encode$f(h,c,a)},decode(h){return decode$e(h,c,a,i)}})}const base10$6=baseX$4({prefix:"9",name:"base10",alphabet:"0123456789"}),base10$7=Object.freeze(Object.defineProperty({__proto__:null,base10:base10$6},Symbol.toStringTag,{value:"Module"})),base16$6=rfc4648$4({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),base16upper$3=rfc4648$4({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),base16$7=Object.freeze(Object.defineProperty({__proto__:null,base16:base16$6,base16upper:base16upper$3},Symbol.toStringTag,{value:"Module"})),base2$6=rfc4648$4({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),base2$7=Object.freeze(Object.defineProperty({__proto__:null,base2:base2$6},Symbol.toStringTag,{value:"Module"})),alphabet$3=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),alphabetBytesToChars$3=alphabet$3.reduce((i,e,a)=>(i[a]=e,i),[]),alphabetCharsToBytes$3=alphabet$3.reduce((i,e,a)=>(i[e.codePointAt(0)]=a,i),[]);function encode$e(i){return i.reduce((e,a)=>(e+=alphabetBytesToChars$3[a],e),"")}function decode$d(i){const e=[];for(const a of i){const c=alphabetCharsToBytes$3[a.codePointAt(0)];if(c===void 0)throw new Error(`Non-base256emoji character: ${a}`);e.push(c)}return new Uint8Array(e)}const base256emoji$6=from$5({prefix:"🚀",name:"base256emoji",encode:encode$e,decode:decode$d}),base256emoji$7=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:base256emoji$6},Symbol.toStringTag,{value:"Module"})),base32$8=rfc4648$4({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),base32upper$3=rfc4648$4({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),base32pad$3=rfc4648$4({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),base32padupper$3=rfc4648$4({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),base32hex$3=rfc4648$4({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),base32hexupper$3=rfc4648$4({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),base32hexpad$3=rfc4648$4({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),base32hexpadupper$3=rfc4648$4({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),base32z$3=rfc4648$4({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),base32$9=Object.freeze(Object.defineProperty({__proto__:null,base32:base32$8,base32hex:base32hex$3,base32hexpad:base32hexpad$3,base32hexpadupper:base32hexpadupper$3,base32hexupper:base32hexupper$3,base32pad:base32pad$3,base32padupper:base32padupper$3,base32upper:base32upper$3,base32z:base32z$3},Symbol.toStringTag,{value:"Module"})),base36$6=baseX$4({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),base36upper$3=baseX$4({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),base36$7=Object.freeze(Object.defineProperty({__proto__:null,base36:base36$6,base36upper:base36upper$3},Symbol.toStringTag,{value:"Module"})),base58btc$4=baseX$4({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),base58flickr$3=baseX$4({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),base58$3=Object.freeze(Object.defineProperty({__proto__:null,base58btc:base58btc$4,base58flickr:base58flickr$3},Symbol.toStringTag,{value:"Module"})),base64$8=rfc4648$4({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),base64pad$3=rfc4648$4({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),base64url$4=rfc4648$4({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),base64urlpad$3=rfc4648$4({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),base64$9=Object.freeze(Object.defineProperty({__proto__:null,base64:base64$8,base64pad:base64pad$3,base64url:base64url$4,base64urlpad:base64urlpad$3},Symbol.toStringTag,{value:"Module"})),base8$6=rfc4648$4({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),base8$7=Object.freeze(Object.defineProperty({__proto__:null,base8:base8$6},Symbol.toStringTag,{value:"Module"})),identity$3=from$5({prefix:"\0",name:"identity",encode:i=>toString$a(i),decode:i=>fromString$6(i)}),identityBase$3=Object.freeze(Object.defineProperty({__proto__:null,identity:identity$3},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const bases$3={...identityBase$3,...base2$7,...base8$7,...base10$7,...base16$7,...base32$9,...base36$7,...base58$3,...base64$9,...base256emoji$7};function createCodec$4(i,e,a,c){return{name:i,prefix:e,encoder:{name:i,prefix:e,encode:a},decoder:{decode:c}}}const string$5=createCodec$4("utf8","u",i=>"u"+new TextDecoder("utf8").decode(i),i=>new TextEncoder().encode(i.substring(1))),ascii$3=createCodec$4("ascii","a",i=>{let e="a";for(let a=0;a<i.length;a++)e+=String.fromCharCode(i[a]);return e},i=>{i=i.substring(1);const e=allocUnsafe$6(i.length);for(let a=0;a<i.length;a++)e[a]=i.charCodeAt(a);return e}),BASES$3={utf8:string$5,"utf-8":string$5,hex:bases$3.base16,latin1:ascii$3,ascii:ascii$3,binary:ascii$3,...bases$3};function fromString$5(i,e="utf8"){const a=BASES$3[e];if(a==null)throw new Error(`Unsupported encoding "${e}"`);return a.decoder.decode(`${a.prefix}${i}`)}function pool(i){const e=i??8192,a=e>>>1;let c,h=e;return function(et){if(et<1||et>a)return allocUnsafe$6(et);h+et>e&&(c=allocUnsafe$6(e),h=0);const ft=c.subarray(h,h+=et);return h&7&&(h=(h|7)+1),ft}}class Op{constructor(e,a,c){qt(this,"fn");qt(this,"len");qt(this,"next");qt(this,"val");this.fn=e,this.len=a,this.next=void 0,this.val=c}}function noop$1(){}class State{constructor(e){qt(this,"head");qt(this,"tail");qt(this,"len");qt(this,"next");this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}}const bufferPool=pool();function alloc$2(i){return globalThis.Buffer!=null?allocUnsafe$6(i):bufferPool(i)}class Uint8ArrayWriter{constructor(){qt(this,"len");qt(this,"head");qt(this,"tail");qt(this,"states");this.len=0,this.head=new Op(noop$1,0,0),this.tail=this.head,this.states=null}_push(e,a,c){return this.tail=this.tail.next=new Op(e,a,c),this.len+=a,this}uint32(e){return this.len+=(this.tail=this.tail.next=new VarintOp((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this}int32(e){return e<0?this._push(writeVarint64,10,LongBits.fromNumber(e)):this.uint32(e)}sint32(e){return this.uint32((e<<1^e>>31)>>>0)}uint64(e){const a=LongBits.fromBigInt(e);return this._push(writeVarint64,a.length(),a)}uint64Number(e){return this._push(encodeUint8Array,encodingLength$4(e),e)}uint64String(e){return this.uint64(BigInt(e))}int64(e){return this.uint64(e)}int64Number(e){return this.uint64Number(e)}int64String(e){return this.uint64String(e)}sint64(e){const a=LongBits.fromBigInt(e).zzEncode();return this._push(writeVarint64,a.length(),a)}sint64Number(e){const a=LongBits.fromNumber(e).zzEncode();return this._push(writeVarint64,a.length(),a)}sint64String(e){return this.sint64(BigInt(e))}bool(e){return this._push(writeByte,1,e?1:0)}fixed32(e){return this._push(writeFixed32,4,e>>>0)}sfixed32(e){return this.fixed32(e)}fixed64(e){const a=LongBits.fromBigInt(e);return this._push(writeFixed32,4,a.lo)._push(writeFixed32,4,a.hi)}fixed64Number(e){const a=LongBits.fromNumber(e);return this._push(writeFixed32,4,a.lo)._push(writeFixed32,4,a.hi)}fixed64String(e){return this.fixed64(BigInt(e))}sfixed64(e){return this.fixed64(e)}sfixed64Number(e){return this.fixed64Number(e)}sfixed64String(e){return this.fixed64String(e)}float(e){return this._push(writeFloatLE,4,e)}double(e){return this._push(writeDoubleLE,8,e)}bytes(e){const a=e.length>>>0;return a===0?this._push(writeByte,1,0):this.uint32(a)._push(writeBytes,a,e)}string(e){const a=length(e);return a!==0?this.uint32(a)._push(write$2,a,e):this._push(writeByte,1,0)}fork(){return this.states=new State(this),this.head=this.tail=new Op(noop$1,0,0),this.len=0,this}reset(){return this.states!=null?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Op(noop$1,0,0),this.len=0),this}ldelim(){const e=this.head,a=this.tail,c=this.len;return this.reset().uint32(c),c!==0&&(this.tail.next=e.next,this.tail=a,this.len+=c),this}finish(){let e=this.head.next;const a=alloc$2(this.len);let c=0;for(;e!=null;)e.fn(e.val,a,c),c+=e.len,e=e.next;return a}}function writeByte(i,e,a){e[a]=i&255}function writeVarint32(i,e,a){for(;i>127;)e[a++]=i&127|128,i>>>=7;e[a]=i}class VarintOp extends Op{constructor(a,c){super(writeVarint32,a,c);qt(this,"next");this.next=void 0}}function writeVarint64(i,e,a){for(;i.hi!==0;)e[a++]=i.lo&127|128,i.lo=(i.lo>>>7|i.hi<<25)>>>0,i.hi>>>=7;for(;i.lo>127;)e[a++]=i.lo&127|128,i.lo=i.lo>>>7;e[a++]=i.lo}function writeFixed32(i,e,a){e[a]=i&255,e[a+1]=i>>>8&255,e[a+2]=i>>>16&255,e[a+3]=i>>>24}function writeBytes(i,e,a){e.set(i,a)}globalThis.Buffer!=null&&(Uint8ArrayWriter.prototype.bytes=function(i){const e=i.length>>>0;return this.uint32(e),e>0&&this._push(writeBytesBuffer,e,i),this},Uint8ArrayWriter.prototype.string=function(i){const e=globalThis.Buffer.byteLength(i);return this.uint32(e),e>0&&this._push(writeStringBuffer,e,i),this});function writeBytesBuffer(i,e,a){e.set(i,a)}function writeStringBuffer(i,e,a){i.length<40?write$2(i,e,a):e.utf8Write!=null?e.utf8Write(i,a):e.set(fromString$5(i),a)}function createWriter(){return new Uint8ArrayWriter}function encodeMessage(i,e){const a=createWriter();return e.encode(i,a,{lengthDelimited:!1}),a.finish()}var CODEC_TYPES;(function(i){i[i.VARINT=0]="VARINT",i[i.BIT64=1]="BIT64",i[i.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",i[i.START_GROUP=3]="START_GROUP",i[i.END_GROUP=4]="END_GROUP",i[i.BIT32=5]="BIT32"})(CODEC_TYPES||(CODEC_TYPES={}));function createCodec$3(i,e,a,c){return{name:i,type:e,encode:a,decode:c}}function enumeration(i){function e(h){if(i[h.toString()]==null)throw new Error("Invalid enum value");return i[h]}const a=function(d,et){const ft=e(d);et.int32(ft)},c=function(d){const et=d.int32();return e(et)};return createCodec$3("enum",CODEC_TYPES.VARINT,a,c)}function message(i,e){return createCodec$3("message",CODEC_TYPES.LENGTH_DELIMITED,i,e)}var KeyType$1;(function(i){i.RSA="RSA",i.Ed25519="Ed25519",i.Secp256k1="Secp256k1"})(KeyType$1||(KeyType$1={}));var __KeyTypeValues$1;(function(i){i[i.RSA=0]="RSA",i[i.Ed25519=1]="Ed25519",i[i.Secp256k1=2]="Secp256k1"})(__KeyTypeValues$1||(__KeyTypeValues$1={}));(function(i){i.codec=()=>enumeration(__KeyTypeValues$1)})(KeyType$1||(KeyType$1={}));var PublicKey$1;(function(i){let e;i.codec=()=>(e==null&&(e=message((a,c,h={})=>{h.lengthDelimited!==!1&&c.fork(),a.Type!=null&&(c.uint32(8),KeyType$1.codec().encode(a.Type,c)),a.Data!=null&&(c.uint32(18),c.bytes(a.Data)),h.lengthDelimited!==!1&&c.ldelim()},(a,c)=>{const h={},d=c==null?a.len:a.pos+c;for(;a.pos<d;){const et=a.uint32();switch(et>>>3){case 1:h.Type=KeyType$1.codec().decode(a);break;case 2:h.Data=a.bytes();break;default:a.skipType(et&7);break}}return h})),e),i.encode=a=>encodeMessage(a,i.codec()),i.decode=a=>decodeMessage$1(a,i.codec())})(PublicKey$1||(PublicKey$1={}));var PrivateKey$1;(function(i){let e;i.codec=()=>(e==null&&(e=message((a,c,h={})=>{h.lengthDelimited!==!1&&c.fork(),a.Type!=null&&(c.uint32(8),KeyType$1.codec().encode(a.Type,c)),a.Data!=null&&(c.uint32(18),c.bytes(a.Data)),h.lengthDelimited!==!1&&c.ldelim()},(a,c)=>{const h={},d=c==null?a.len:a.pos+c;for(;a.pos<d;){const et=a.uint32();switch(et>>>3){case 1:h.Type=KeyType$1.codec().decode(a);break;case 2:h.Data=a.bytes();break;default:a.skipType(et&7);break}}return h})),e),i.encode=a=>encodeMessage(a,i.codec()),i.decode=a=>decodeMessage$1(a,i.codec())})(PrivateKey$1||(PrivateKey$1={}));let Ed25519PublicKey$1=class{constructor(e){qt(this,"_key");this._key=ensureKey$1(e,PUBLIC_KEY_BYTE_LENGTH$1)}verify(e,a){return hashAndVerify$5(this._key,a,e)}marshal(){return this._key}get bytes(){return PublicKey$1.encode({Type:KeyType$1.Ed25519,Data:this.marshal()}).subarray()}equals(e){return equals$2(this.bytes,e.bytes)}hash(){const e=sha256.digest(this.bytes);return isPromise$2(e)?e.then(({bytes:a})=>a):e.bytes}},Ed25519PrivateKey$1=class{constructor(e,a){qt(this,"_key");qt(this,"_publicKey");this._key=ensureKey$1(e,PRIVATE_KEY_BYTE_LENGTH$1),this._publicKey=ensureKey$1(a,PUBLIC_KEY_BYTE_LENGTH$1)}sign(e){return hashAndSign$5(this._key,e)}get public(){return new Ed25519PublicKey$1(this._publicKey)}marshal(){return this._key}get bytes(){return PrivateKey$1.encode({Type:KeyType$1.Ed25519,Data:this.marshal()}).subarray()}equals(e){return equals$2(this.bytes,e.bytes)}async hash(){const e=sha256.digest(this.bytes);let a;return isPromise$2(e)?{bytes:a}=await e:a=e.bytes,a}async id(){const e=identity$4.digest(this.public.bytes);return base58btc$5.encode(e.bytes).substring(1)}async export(e,a="libp2p-key"){if(a==="libp2p-key")return exporter$1(this.bytes,e);throw new CodeError$3(`export format '${a}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}};function unmarshalEd25519PrivateKey$1(i){if(i.length>PRIVATE_KEY_BYTE_LENGTH$1){i=ensureKey$1(i,PRIVATE_KEY_BYTE_LENGTH$1+PUBLIC_KEY_BYTE_LENGTH$1);const c=i.subarray(0,PRIVATE_KEY_BYTE_LENGTH$1),h=i.subarray(PRIVATE_KEY_BYTE_LENGTH$1,i.length);return new Ed25519PrivateKey$1(c,h)}i=ensureKey$1(i,PRIVATE_KEY_BYTE_LENGTH$1);const e=i.subarray(0,PRIVATE_KEY_BYTE_LENGTH$1),a=i.subarray(PUBLIC_KEY_BYTE_LENGTH$1);return new Ed25519PrivateKey$1(e,a)}function unmarshalEd25519PublicKey$1(i){return i=ensureKey$1(i,PUBLIC_KEY_BYTE_LENGTH$1),new Ed25519PublicKey$1(i)}async function generateKeyPair$6(){const{privateKey:i,publicKey:e}=generateKey$5();return new Ed25519PrivateKey$1(i,e)}async function generateKeyPairFromSeed$1(i){const{privateKey:e,publicKey:a}=generateKeyFromSeed$1(i);return new Ed25519PrivateKey$1(e,a)}function ensureKey$1(i,e){if(i=Uint8Array.from(i??[]),i.length!==e)throw new CodeError$3(`Key must be a Uint8Array of length ${e}, got ${i.length}`,"ERR_INVALID_KEY_TYPE");return i}const Ed25519$1=Object.freeze(Object.defineProperty({__proto__:null,Ed25519PrivateKey:Ed25519PrivateKey$1,Ed25519PublicKey:Ed25519PublicKey$1,generateKeyPair:generateKeyPair$6,generateKeyPairFromSeed:generateKeyPairFromSeed$1,unmarshalEd25519PrivateKey:unmarshalEd25519PrivateKey$1,unmarshalEd25519PublicKey:unmarshalEd25519PublicKey$1},Symbol.toStringTag,{value:"Module"})),bits$1={"P-256":256,"P-384":384,"P-521":521},curveTypes$1=Object.keys(bits$1);curveTypes$1.join(" / ");var forge=forge$m,sha512=forge.sha512=forge.sha512||{};forge.md.sha512=forge.md.algorithms.sha512=sha512;var sha384=forge.sha384=forge.sha512.sha384=forge.sha512.sha384||{};sha384.create=function(){return sha512.create("SHA-384")};forge.md.sha384=forge.md.algorithms.sha384=sha384;forge.sha512.sha256=forge.sha512.sha256||{create:function(){return sha512.create("SHA-512/256")}};forge.md["sha512/256"]=forge.md.algorithms["sha512/256"]=forge.sha512.sha256;forge.sha512.sha224=forge.sha512.sha224||{create:function(){return sha512.create("SHA-512/224")}};forge.md["sha512/224"]=forge.md.algorithms["sha512/224"]=forge.sha512.sha224;sha512.create=function(i){if(_initialized||_init(),typeof i>"u"&&(i="SHA-512"),!(i in _states))throw new Error("Invalid SHA-512 algorithm: "+i);for(var e=_states[i],a=null,c=forge.util.createBuffer(),h=new Array(80),d=0;d<80;++d)h[d]=new Array(2);var et=64;switch(i){case"SHA-384":et=48;break;case"SHA-512/256":et=32;break;case"SHA-512/224":et=28;break}var ft={algorithm:i.replace("-","").toLowerCase(),blockLength:128,digestLength:et,messageLength:0,fullMessageLength:null,messageLengthSize:16};return ft.start=function(){ft.messageLength=0,ft.fullMessageLength=ft.messageLength128=[];for(var gt=ft.messageLengthSize/4,_t=0;_t<gt;++_t)ft.fullMessageLength.push(0);c=forge.util.createBuffer(),a=new Array(e.length);for(var _t=0;_t<e.length;++_t)a[_t]=e[_t].slice(0);return ft},ft.start(),ft.update=function(gt,_t){_t==="utf8"&&(gt=forge.util.encodeUtf8(gt));var wt=gt.length;ft.messageLength+=wt,wt=[wt/4294967296>>>0,wt>>>0];for(var $t=ft.fullMessageLength.length-1;$t>=0;--$t)ft.fullMessageLength[$t]+=wt[1],wt[1]=wt[0]+(ft.fullMessageLength[$t]/4294967296>>>0),ft.fullMessageLength[$t]=ft.fullMessageLength[$t]>>>0,wt[0]=wt[1]/4294967296>>>0;return c.putBytes(gt),_update(a,h,c),(c.read>2048||c.length()===0)&&c.compact(),ft},ft.digest=function(){var gt=forge.util.createBuffer();gt.putBytes(c.bytes());var _t=ft.fullMessageLength[ft.fullMessageLength.length-1]+ft.messageLengthSize,wt=_t&ft.blockLength-1;gt.putBytes(_padding.substr(0,ft.blockLength-wt));for(var $t,It,Rt=ft.fullMessageLength[0]*8,Tt=0;Tt<ft.fullMessageLength.length-1;++Tt)$t=ft.fullMessageLength[Tt+1]*8,It=$t/4294967296>>>0,Rt+=It,gt.putInt32(Rt>>>0),Rt=$t>>>0;gt.putInt32(Rt);for(var At=new Array(a.length),Tt=0;Tt<a.length;++Tt)At[Tt]=a[Tt].slice(0);_update(At,h,gt);var kt=forge.util.createBuffer(),xt;i==="SHA-512"?xt=At.length:i==="SHA-384"?xt=At.length-2:xt=At.length-4;for(var Tt=0;Tt<xt;++Tt)kt.putInt32(At[Tt][0]),(Tt!==xt-1||i!=="SHA-512/224")&&kt.putInt32(At[Tt][1]);return kt},ft};var _padding=null,_initialized=!1,_k=null,_states=null;function _init(){_padding="",_padding+=forge.util.fillString("\0",128),_k=[[1116352408,3609767458],[1899447441,602891725],[3049323471,3964484399],[3921009573,2173295548],[961987163,4081628472],[1508970993,3053834265],[2453635748,2937671579],[2870763221,3664609560],[3624381080,2734883394],[310598401,1164996542],[607225278,1323610764],[1426881987,3590304994],[1925078388,4068182383],[2162078206,991336113],[2614888103,633803317],[3248222580,3479774868],[3835390401,2666613458],[4022224774,944711139],[264347078,2341262773],[604807628,2007800933],[770255983,1495990901],[1249150122,1856431235],[1555081692,3175218132],[1996064986,2198950837],[2554220882,3999719339],[2821834349,766784016],[2952996808,2566594879],[3210313671,3203337956],[3336571891,1034457026],[3584528711,2466948901],[113926993,3758326383],[338241895,168717936],[666307205,1188179964],[773529912,1546045734],[1294757372,1522805485],[1396182291,2643833823],[1695183700,2343527390],[1986661051,1014477480],[2177026350,1206759142],[2456956037,344077627],[2730485921,1290863460],[2820302411,3158454273],[3259730800,3505952657],[3345764771,106217008],[3516065817,3606008344],[3600352804,1432725776],[4094571909,1467031594],[275423344,851169720],[430227734,3100823752],[506948616,1363258195],[659060556,3750685593],[883997877,3785050280],[958139571,3318307427],[1322822218,3812723403],[1537002063,2003034995],[1747873779,3602036899],[1955562222,1575990012],[2024104815,1125592928],[2227730452,2716904306],[2361852424,442776044],[2428436474,593698344],[2756734187,3733110249],[3204031479,2999351573],[3329325298,3815920427],[3391569614,3928383900],[3515267271,566280711],[3940187606,3454069534],[4118630271,4000239992],[116418474,1914138554],[174292421,2731055270],[289380356,3203993006],[460393269,320620315],[685471733,587496836],[852142971,1086792851],[1017036298,365543100],[1126000580,2618297676],[1288033470,3409855158],[1501505948,4234509866],[1607167915,987167468],[1816402316,1246189591]],_states={},_states["SHA-512"]=[[1779033703,4089235720],[3144134277,2227873595],[1013904242,4271175723],[2773480762,1595750129],[1359893119,2917565137],[2600822924,725511199],[528734635,4215389547],[1541459225,327033209]],_states["SHA-384"]=[[3418070365,3238371032],[1654270250,914150663],[2438529370,812702999],[355462360,4144912697],[1731405415,4290775857],[2394180231,1750603025],[3675008525,1694076839],[1203062813,3204075428]],_states["SHA-512/256"]=[[573645204,4230739756],[2673172387,3360449730],[596883563,1867755857],[2520282905,1497426621],[2519219938,2827943907],[3193839141,1401305490],[721525244,746961066],[246885852,2177182882]],_states["SHA-512/224"]=[[2352822216,424955298],[1944164710,2312950998],[502970286,855612546],[1738396948,1479516111],[258812777,2077511080],[2011393907,79989058],[1067287976,1780299464],[286451373,2446758561]],_initialized=!0}function _update(i,e,a){for(var c,h,d,et,ft,gt,_t,wt,$t,It,Rt,Tt,At,kt,xt,Nt,Ft,jt,Gt,Kt,Wt,Zt,cr,hr,gr,er,mr,Mr,wr,Dr,Tr,fr,yr,$r,Fr,dr=a.length();dr>=128;){for(wr=0;wr<16;++wr)e[wr][0]=a.getInt32()>>>0,e[wr][1]=a.getInt32()>>>0;for(;wr<80;++wr)fr=e[wr-2],Dr=fr[0],Tr=fr[1],c=((Dr>>>19|Tr<<13)^(Tr>>>29|Dr<<3)^Dr>>>6)>>>0,h=((Dr<<13|Tr>>>19)^(Tr<<3|Dr>>>29)^(Dr<<26|Tr>>>6))>>>0,$r=e[wr-15],Dr=$r[0],Tr=$r[1],d=((Dr>>>1|Tr<<31)^(Dr>>>8|Tr<<24)^Dr>>>7)>>>0,et=((Dr<<31|Tr>>>1)^(Dr<<24|Tr>>>8)^(Dr<<25|Tr>>>7))>>>0,yr=e[wr-7],Fr=e[wr-16],Tr=h+yr[1]+et+Fr[1],e[wr][0]=c+yr[0]+d+Fr[0]+(Tr/4294967296>>>0)>>>0,e[wr][1]=Tr>>>0;for(At=i[0][0],kt=i[0][1],xt=i[1][0],Nt=i[1][1],Ft=i[2][0],jt=i[2][1],Gt=i[3][0],Kt=i[3][1],Wt=i[4][0],Zt=i[4][1],cr=i[5][0],hr=i[5][1],gr=i[6][0],er=i[6][1],mr=i[7][0],Mr=i[7][1],wr=0;wr<80;++wr)_t=((Wt>>>14|Zt<<18)^(Wt>>>18|Zt<<14)^(Zt>>>9|Wt<<23))>>>0,wt=((Wt<<18|Zt>>>14)^(Wt<<14|Zt>>>18)^(Zt<<23|Wt>>>9))>>>0,$t=(gr^Wt&(cr^gr))>>>0,It=(er^Zt&(hr^er))>>>0,ft=((At>>>28|kt<<4)^(kt>>>2|At<<30)^(kt>>>7|At<<25))>>>0,gt=((At<<4|kt>>>28)^(kt<<30|At>>>2)^(kt<<25|At>>>7))>>>0,Rt=(At&xt|Ft&(At^xt))>>>0,Tt=(kt&Nt|jt&(kt^Nt))>>>0,Tr=Mr+wt+It+_k[wr][1]+e[wr][1],c=mr+_t+$t+_k[wr][0]+e[wr][0]+(Tr/4294967296>>>0)>>>0,h=Tr>>>0,Tr=gt+Tt,d=ft+Rt+(Tr/4294967296>>>0)>>>0,et=Tr>>>0,mr=gr,Mr=er,gr=cr,er=hr,cr=Wt,hr=Zt,Tr=Kt+h,Wt=Gt+c+(Tr/4294967296>>>0)>>>0,Zt=Tr>>>0,Gt=Ft,Kt=jt,Ft=xt,jt=Nt,xt=At,Nt=kt,Tr=h+et,At=c+d+(Tr/4294967296>>>0)>>>0,kt=Tr>>>0;Tr=i[0][1]+kt,i[0][0]=i[0][0]+At+(Tr/4294967296>>>0)>>>0,i[0][1]=Tr>>>0,Tr=i[1][1]+Nt,i[1][0]=i[1][0]+xt+(Tr/4294967296>>>0)>>>0,i[1][1]=Tr>>>0,Tr=i[2][1]+jt,i[2][0]=i[2][0]+Ft+(Tr/4294967296>>>0)>>>0,i[2][1]=Tr>>>0,Tr=i[3][1]+Kt,i[3][0]=i[3][0]+Gt+(Tr/4294967296>>>0)>>>0,i[3][1]=Tr>>>0,Tr=i[4][1]+Zt,i[4][0]=i[4][0]+Wt+(Tr/4294967296>>>0)>>>0,i[4][1]=Tr>>>0,Tr=i[5][1]+hr,i[5][0]=i[5][0]+cr+(Tr/4294967296>>>0)>>>0,i[5][1]=Tr>>>0,Tr=i[6][1]+er,i[6][0]=i[6][0]+gr+(Tr/4294967296>>>0)>>>0,i[6][1]=Tr>>>0,Tr=i[7][1]+Mr,i[7][0]=i[7][0]+mr+(Tr/4294967296>>>0)>>>0,i[7][1]=Tr>>>0,dr-=128}}function randomBytes$1(i){if(isNaN(i)||i<=0)throw new CodeError$3("random bytes length must be a Number bigger than 0","ERR_INVALID_LENGTH");return randomBytes$2(i)}function convert$1(i,e){return e.map(a=>base64urlToBigInteger$1(i[a]))}function jwk2priv$1(i){return forge$n.pki.setRsaPrivateKey(...convert$1(i,["n","e","d","p","q","dp","dq","qi"]))}function jwk2pub$1(i){return forge$n.pki.setRsaPublicKey(...convert$1(i,["n","e"]))}function pkcs1ToJwk$1(i){const e=forge$n.asn1.fromDer(toString$b(i,"ascii")),a=forge$n.pki.privateKeyFromAsn1(e);return{kty:"RSA",n:bigIntegerToUintBase64url$1(a.n),e:bigIntegerToUintBase64url$1(a.e),d:bigIntegerToUintBase64url$1(a.d),p:bigIntegerToUintBase64url$1(a.p),q:bigIntegerToUintBase64url$1(a.q),dp:bigIntegerToUintBase64url$1(a.dP),dq:bigIntegerToUintBase64url$1(a.dQ),qi:bigIntegerToUintBase64url$1(a.qInv),alg:"RS256"}}function jwkToPkcs1$1(i){if(i.n==null||i.e==null||i.d==null||i.p==null||i.q==null||i.dp==null||i.dq==null||i.qi==null)throw new CodeError$3("JWK was missing components","ERR_INVALID_PARAMETERS");const e=forge$n.pki.privateKeyToAsn1({n:base64urlToBigInteger$1(i.n),e:base64urlToBigInteger$1(i.e),d:base64urlToBigInteger$1(i.d),p:base64urlToBigInteger$1(i.p),q:base64urlToBigInteger$1(i.q),dP:base64urlToBigInteger$1(i.dp),dQ:base64urlToBigInteger$1(i.dq),qInv:base64urlToBigInteger$1(i.qi)});return fromString$7(forge$n.asn1.toDer(e).getBytes(),"ascii")}function pkixToJwk$1(i){const e=forge$n.asn1.fromDer(toString$b(i,"ascii")),a=forge$n.pki.publicKeyFromAsn1(e);return{kty:"RSA",n:bigIntegerToUintBase64url$1(a.n),e:bigIntegerToUintBase64url$1(a.e)}}function jwkToPkix$1(i){if(i.n==null||i.e==null)throw new CodeError$3("JWK was missing components","ERR_INVALID_PARAMETERS");const e=forge$n.pki.publicKeyToAsn1({n:base64urlToBigInteger$1(i.n),e:base64urlToBigInteger$1(i.e)});return fromString$7(forge$n.asn1.toDer(e).getBytes(),"ascii")}async function generateKey$4(i){const e=await webcrypto$1.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:i,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]),a=await exportKey$1(e);return{privateKey:a[0],publicKey:a[1]}}async function unmarshalPrivateKey$2(i){const a=[await webcrypto$1.get().subtle.importKey("jwk",i,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]),await derivePublicFromPrivate$1(i)],c=await exportKey$1({privateKey:a[0],publicKey:a[1]});return{privateKey:c[0],publicKey:c[1]}}async function hashAndSign$4(i,e){const a=await webcrypto$1.get().subtle.importKey("jwk",i,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]),c=await webcrypto$1.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},a,e instanceof Uint8Array?e:e.subarray());return new Uint8Array(c,0,c.byteLength)}async function hashAndVerify$4(i,e,a){const c=await webcrypto$1.get().subtle.importKey("jwk",i,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return webcrypto$1.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},c,e,a instanceof Uint8Array?a:a.subarray())}async function exportKey$1(i){if(i.privateKey==null||i.publicKey==null)throw new CodeError$3("Private and public key are required","ERR_INVALID_PARAMETERS");return Promise.all([webcrypto$1.get().subtle.exportKey("jwk",i.privateKey),webcrypto$1.get().subtle.exportKey("jwk",i.publicKey)])}async function derivePublicFromPrivate$1(i){return webcrypto$1.get().subtle.importKey("jwk",{kty:i.kty,n:i.n,e:i.e},{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"])}function convertKey$1(i,e,a,c){const h=e?jwk2pub$1(i):jwk2priv$1(i),d=toString$b(a instanceof Uint8Array?a:a.subarray(),"ascii"),et=c(d,h);return fromString$7(et,"ascii")}function encrypt$1(i,e){return convertKey$1(i,!0,e,(a,c)=>c.encrypt(a))}function decrypt$1(i,e){return convertKey$1(i,!1,e,(a,c)=>c.decrypt(a))}function keySize$1(i){if(i.kty!=="RSA")throw new CodeError$3("invalid key type","ERR_INVALID_KEY_TYPE");if(i.n==null)throw new CodeError$3("invalid key modulus","ERR_INVALID_KEY_MODULUS");return fromString$7(i.n,"base64url").length*8}const MAX_KEY_SIZE$1=8192;let RsaPublicKey$1=class{constructor(e){qt(this,"_key");this._key=e}verify(e,a){return hashAndVerify$4(this._key,a,e)}marshal(){return jwkToPkix$1(this._key)}get bytes(){return PublicKey$1.encode({Type:KeyType$1.RSA,Data:this.marshal()}).subarray()}encrypt(e){return encrypt$1(this._key,e)}equals(e){return equals$2(this.bytes,e.bytes)}hash(){const e=sha256.digest(this.bytes);return isPromise$2(e)?e.then(({bytes:a})=>a):e.bytes}},RsaPrivateKey$1=class{constructor(e,a){qt(this,"_key");qt(this,"_publicKey");this._key=e,this._publicKey=a}genSecret(){return randomBytes$1(16)}sign(e){return hashAndSign$4(this._key,e)}get public(){if(this._publicKey==null)throw new CodeError$3("public key not provided","ERR_PUBKEY_NOT_PROVIDED");return new RsaPublicKey$1(this._publicKey)}decrypt(e){return decrypt$1(this._key,e)}marshal(){return jwkToPkcs1$1(this._key)}get bytes(){return PrivateKey$1.encode({Type:KeyType$1.RSA,Data:this.marshal()}).subarray()}equals(e){return equals$2(this.bytes,e.bytes)}hash(){const e=sha256.digest(this.bytes);return isPromise$2(e)?e.then(({bytes:a})=>a):e.bytes}async id(){const e=await this.public.hash();return toString$b(e,"base58btc")}async export(e,a="pkcs-8"){if(a==="pkcs-8"){const c=new forge$n.util.ByteBuffer(this.marshal()),h=forge$n.asn1.fromDer(c),d=forge$n.pki.privateKeyFromAsn1(h),et={algorithm:"aes256",count:1e4,saltSize:128/8,prfAlgorithm:"sha512"};return forge$n.pki.encryptRsaPrivateKey(d,e,et)}else{if(a==="libp2p-key")return exporter$1(this.bytes,e);throw new CodeError$3(`export format '${a}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}}};async function unmarshalRsaPrivateKey$1(i){const e=pkcs1ToJwk$1(i);if(keySize$1(e)>MAX_KEY_SIZE$1)throw new CodeError$3("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const a=await unmarshalPrivateKey$2(e);return new RsaPrivateKey$1(a.privateKey,a.publicKey)}function unmarshalRsaPublicKey$1(i){const e=pkixToJwk$1(i);if(keySize$1(e)>MAX_KEY_SIZE$1)throw new CodeError$3("key size is too large","ERR_KEY_SIZE_TOO_LARGE");return new RsaPublicKey$1(e)}async function fromJwk$1(i){if(keySize$1(i)>MAX_KEY_SIZE$1)throw new CodeError$3("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const e=await unmarshalPrivateKey$2(i);return new RsaPrivateKey$1(e.privateKey,e.publicKey)}async function generateKeyPair$5(i){if(i>MAX_KEY_SIZE$1)throw new CodeError$3("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const e=await generateKey$4(i);return new RsaPrivateKey$1(e.privateKey,e.publicKey)}const RSA$1=Object.freeze(Object.defineProperty({__proto__:null,MAX_KEY_SIZE:MAX_KEY_SIZE$1,RsaPrivateKey:RsaPrivateKey$1,RsaPublicKey:RsaPublicKey$1,fromJwk:fromJwk$1,generateKeyPair:generateKeyPair$5,unmarshalRsaPrivateKey:unmarshalRsaPrivateKey$1,unmarshalRsaPublicKey:unmarshalRsaPublicKey$1},Symbol.toStringTag,{value:"Module"}));function generateKey$3(){return secp256k1.utils.randomPrivateKey()}function hashAndSign$3(i,e){const a=sha256.digest(e instanceof Uint8Array?e:e.subarray());if(isPromise$2(a))return a.then(({digest:c})=>secp256k1.sign(c,i).toDERRawBytes()).catch(c=>{throw new CodeError$3(String(c),"ERR_INVALID_INPUT")});try{return secp256k1.sign(a.digest,i).toDERRawBytes()}catch(c){throw new CodeError$3(String(c),"ERR_INVALID_INPUT")}}function hashAndVerify$3(i,e,a){const c=sha256.digest(a instanceof Uint8Array?a:a.subarray());if(isPromise$2(c))return c.then(({digest:h})=>secp256k1.verify(e,h,i)).catch(h=>{throw new CodeError$3(String(h),"ERR_INVALID_INPUT")});try{return secp256k1.verify(e,c.digest,i)}catch(h){throw new CodeError$3(String(h),"ERR_INVALID_INPUT")}}function compressPublicKey$1(i){return secp256k1.ProjectivePoint.fromHex(i).toRawBytes(!0)}function validatePrivateKey$1(i){try{secp256k1.getPublicKey(i,!0)}catch(e){throw new CodeError$3(String(e),"ERR_INVALID_PRIVATE_KEY")}}function validatePublicKey$1(i){try{secp256k1.ProjectivePoint.fromHex(i)}catch(e){throw new CodeError$3(String(e),"ERR_INVALID_PUBLIC_KEY")}}function computePublicKey$1(i){try{return secp256k1.getPublicKey(i,!0)}catch(e){throw new CodeError$3(String(e),"ERR_INVALID_PRIVATE_KEY")}}let Secp256k1PublicKey$1=class{constructor(e){qt(this,"_key");validatePublicKey$1(e),this._key=e}verify(e,a){return hashAndVerify$3(this._key,a,e)}marshal(){return compressPublicKey$1(this._key)}get bytes(){return PublicKey$1.encode({Type:KeyType$1.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return equals$2(this.bytes,e.bytes)}async hash(){const e=sha256.digest(this.bytes);let a;return isPromise$2(e)?{bytes:a}=await e:a=e.bytes,a}},Secp256k1PrivateKey$1=class{constructor(e,a){qt(this,"_key");qt(this,"_publicKey");this._key=e,this._publicKey=a??computePublicKey$1(e),validatePrivateKey$1(this._key),validatePublicKey$1(this._publicKey)}sign(e){return hashAndSign$3(this._key,e)}get public(){return new Secp256k1PublicKey$1(this._publicKey)}marshal(){return this._key}get bytes(){return PrivateKey$1.encode({Type:KeyType$1.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return equals$2(this.bytes,e.bytes)}hash(){const e=sha256.digest(this.bytes);return isPromise$2(e)?e.then(({bytes:a})=>a):e.bytes}async id(){const e=await this.public.hash();return toString$b(e,"base58btc")}async export(e,a="libp2p-key"){if(a==="libp2p-key")return exporter$1(this.bytes,e);throw new CodeError$3(`export format '${a}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}};function unmarshalSecp256k1PrivateKey$1(i){return new Secp256k1PrivateKey$1(i)}function unmarshalSecp256k1PublicKey$1(i){return new Secp256k1PublicKey$1(i)}async function generateKeyPair$4(){const i=generateKey$3();return new Secp256k1PrivateKey$1(i)}const Secp256k1$1=Object.freeze(Object.defineProperty({__proto__:null,Secp256k1PrivateKey:Secp256k1PrivateKey$1,Secp256k1PublicKey:Secp256k1PublicKey$1,generateKeyPair:generateKeyPair$4,unmarshalSecp256k1PrivateKey:unmarshalSecp256k1PrivateKey$1,unmarshalSecp256k1PublicKey:unmarshalSecp256k1PublicKey$1},Symbol.toStringTag,{value:"Module"})),supportedKeys$1={rsa:RSA$1,ed25519:Ed25519$1,secp256k1:Secp256k1$1};var Ns;let AbortError$8=(Ns=class extends Error{constructor(a="The operation was aborted"){super(a);qt(this,"code");qt(this,"type");this.code=Ns.code,this.type=Ns.type}},qt(Ns,"code","ABORT_ERR"),qt(Ns,"type","aborted"),Ns),CodeError$2=class extends Error{constructor(a,c,h){super(a);qt(this,"code");qt(this,"props");this.code=c,this.name=(h==null?void 0:h.name)??"CodeError",this.props=h??{}}};const No=class No extends Error{constructor(a="Unexpected Peer"){super(a);qt(this,"code");this.code=No.code}};qt(No,"code","ERR_UNEXPECTED_PEER");let UnexpectedPeerError=No;const Do=class Do extends Error{constructor(a="Invalid crypto exchange"){super(a);qt(this,"code");this.code=Do.code}};qt(Do,"code","ERR_INVALID_CRYPTO_EXCHANGE");let InvalidCryptoExchangeError=Do;function equals$1(i,e){if(i===e)return!0;if(i.byteLength!==e.byteLength)return!1;for(let a=0;a<i.byteLength;a++)if(i[a]!==e[a])return!1;return!0}const inspect=Symbol.for("nodejs.util.inspect.custom"),baseDecoder=Object.values(bases$5).map(i=>i.decoder).reduce((i,e)=>i.or(e),bases$5.identity.decoder),LIBP2P_KEY_CODE=114,MARSHALLED_ED225519_PUBLIC_KEY_LENGTH=36,MARSHALLED_SECP256K1_PUBLIC_KEY_LENGTH=37;var Tp;class PeerIdImpl{constructor(e){qt(this,"type");qt(this,"multihash");qt(this,"privateKey");qt(this,"publicKey");qt(this,"string");qt(this,Tp,!0);this.type=e.type,this.multihash=e.multihash,this.privateKey=e.privateKey,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}toString(){return this.string==null&&(this.string=base58btc$6.encode(this.multihash.bytes).slice(1)),this.string}toCID(){return CID.createV1(LIBP2P_KEY_CODE,this.multihash)}toBytes(){return this.multihash.bytes}toJSON(){return this.toString()}equals(e){var a;if(e instanceof Uint8Array)return equals$1(this.multihash.bytes,e);if(typeof e=="string")return peerIdFromString(e).equals(this);if(((a=e==null?void 0:e.multihash)==null?void 0:a.bytes)!=null)return equals$1(this.multihash.bytes,e.multihash.bytes);throw new Error("not valid Id")}[(Tp=symbol$4,inspect)](){return`PeerId(${this.toString()})`}}class RSAPeerIdImpl extends PeerIdImpl{constructor(a){super({...a,type:"RSA"});qt(this,"type","RSA");qt(this,"publicKey");this.publicKey=a.publicKey}}class Ed25519PeerIdImpl extends PeerIdImpl{constructor(a){super({...a,type:"Ed25519"});qt(this,"type","Ed25519");qt(this,"publicKey");this.publicKey=a.multihash.digest}}class Secp256k1PeerIdImpl extends PeerIdImpl{constructor(a){super({...a,type:"secp256k1"});qt(this,"type","secp256k1");qt(this,"publicKey");this.publicKey=a.multihash.digest}}function peerIdFromPeerId(i){if(i.type==="RSA")return new RSAPeerIdImpl(i);if(i.type==="Ed25519")return new Ed25519PeerIdImpl(i);if(i.type==="secp256k1")return new Secp256k1PeerIdImpl(i);throw new CodeError$2("Not a PeerId","ERR_INVALID_PARAMETERS")}function peerIdFromString(i,e){if(i.charAt(0)==="1"||i.charAt(0)==="Q"){const a=decode$i(base58btc$6.decode(`z${i}`));return i.startsWith("12D")?new Ed25519PeerIdImpl({multihash:a}):i.startsWith("16U")?new Secp256k1PeerIdImpl({multihash:a}):new RSAPeerIdImpl({multihash:a})}return peerIdFromBytes(baseDecoder.decode(i))}function peerIdFromBytes(i){try{const e=decode$i(i);if(e.code===identity$6.code){if(e.digest.length===MARSHALLED_ED225519_PUBLIC_KEY_LENGTH)return new Ed25519PeerIdImpl({multihash:e});if(e.digest.length===MARSHALLED_SECP256K1_PUBLIC_KEY_LENGTH)return new Secp256k1PeerIdImpl({multihash:e})}if(e.code===sha256$2.code)return new RSAPeerIdImpl({multihash:e})}catch{return peerIdFromCID(CID.decode(i))}throw new Error("Supplied PeerID CID is invalid")}function peerIdFromCID(i){if(i==null||i.multihash==null||i.version==null||i.version===1&&i.code!==LIBP2P_KEY_CODE)throw new Error("Supplied PeerID CID is invalid");const e=i.multihash;if(e.code===sha256$2.code)return new RSAPeerIdImpl({multihash:i.multihash});if(e.code===identity$6.code){if(e.digest.length===MARSHALLED_ED225519_PUBLIC_KEY_LENGTH)return new Ed25519PeerIdImpl({multihash:i.multihash});if(e.digest.length===MARSHALLED_SECP256K1_PUBLIC_KEY_LENGTH)return new Secp256k1PeerIdImpl({multihash:i.multihash})}throw new Error("Supplied PeerID CID is invalid")}async function peerIdFromKeys(i,e){return i.length===MARSHALLED_ED225519_PUBLIC_KEY_LENGTH?new Ed25519PeerIdImpl({multihash:create$3(identity$6.code,i),privateKey:e}):i.length===MARSHALLED_SECP256K1_PUBLIC_KEY_LENGTH?new Secp256k1PeerIdImpl({multihash:create$3(identity$6.code,i),privateKey:e}):new RSAPeerIdImpl({multihash:await sha256$2.digest(i),publicKey:i,privateKey:e})}function createPeerIdFromPublicKey(i){const e=new supportedKeys$1.secp256k1.Secp256k1PublicKey(i);return peerIdFromKeys(e.bytes,void 0)}function decodeMultiaddrs(i){const e=[];let a=0;for(;a<i.length;){const h=new DataView(i.buffer,a,MULTIADDR_LENGTH_SIZE).getUint16(0);a+=MULTIADDR_LENGTH_SIZE;const d=i.slice(a,a+h);a+=h,e.push(multiaddr(d))}return e}function encodeMultiaddrs(i){const e=i.reduce((d,et)=>d+MULTIADDR_LENGTH_SIZE+et.bytes.length,0),a=new Uint8Array(e),c=new DataView(a.buffer);let h=0;return i.forEach(d=>{if(d.getPeerId())throw new Error("`multiaddr` field MUST not contain peer id");c.setUint16(h,d.bytes.length),h+=MULTIADDR_LENGTH_SIZE,a.set(d.bytes,h),h+=d.bytes.length}),a}const decodeRelayShard=i=>{if(i=new Uint8Array(i),i.length<3)throw new Error("Insufficient data");const e=new DataView(i.buffer),a=e.getUint16(0),c=[];if(i.length===130)for(let h=0;h<1024;h++){const d=Math.floor(h/8)+2,et=7-h%8;e.getUint8(d)&1<<et&&c.push(h)}else{const h=e.getUint8(2);for(let d=0,et=3;d<h;d++,et+=2){if(et+1>=i.length)throw new Error("Unexpected end of data");c.push(e.getUint16(et))}}return{clusterId:a,shards:c}},encodeRelayShard=i=>{const{clusterId:e,shards:a}=i,c=a.length>=64?130:3+2*a.length,h=new ArrayBuffer(c),d=new DataView(h);if(d.setUint16(0,e),a.length>=64)for(const et of a){const ft=Math.floor(et/8)+2,gt=7-et%8;d.setUint8(ft,d.getUint8(ft)|1<<gt)}else{d.setUint8(2,a.length);for(let et=0,ft=3;et<a.length;et++,ft+=2)d.setUint16(ft,a[et])}return new Uint8Array(h)};function encodeWaku2(i){let e=0;return i.lightPush&&(e+=1),e=e<<1,i.filter&&(e+=1),e=e<<1,i.store&&(e+=1),e=e<<1,i.relay&&(e+=1),e}function decodeWaku2(i){const e={relay:!1,store:!1,filter:!1,lightPush:!1};return i%2&&(e.relay=!0),i=i>>1,i%2&&(e.store=!0),i=i>>1,i%2&&(e.filter=!0),i=i>>1,i%2&&(e.lightPush=!0),e}class RawEnr extends Map{constructor(a={},c=BigInt(1),h){super(Object.entries(a));qt(this,"seq");qt(this,"signature");this.seq=c,this.signature=h}set(a,c){return this.signature=void 0,this.seq++,super.set(a,c)}get id(){const a=this.get("id");if(!a)throw new Error("id not found.");return bytesToUtf8(a)}get publicKey(){switch(this.id){case"v4":return this.get("secp256k1");default:throw new Error(ERR_INVALID_ID)}}get rs(){const a=this.get("rs");if(a)return decodeRelayShard(a)}get rsv(){const a=this.get("rsv");if(a)return decodeRelayShard(a)}get ip(){return getStringValue(this,"ip","ip4")}set ip(a){setStringValue(this,"ip","ip4",a)}get tcp(){return getNumberAsStringValue(this,"tcp","tcp")}set tcp(a){setNumberAsStringValue(this,"tcp","tcp",a)}get udp(){return getNumberAsStringValue(this,"udp","udp")}set udp(a){setNumberAsStringValue(this,"udp","udp",a)}get ip6(){return getStringValue(this,"ip6","ip6")}set ip6(a){setStringValue(this,"ip6","ip6",a)}get tcp6(){return getNumberAsStringValue(this,"tcp6","tcp")}set tcp6(a){setNumberAsStringValue(this,"tcp6","tcp",a)}get udp6(){return getNumberAsStringValue(this,"udp6","udp")}set udp6(a){setNumberAsStringValue(this,"udp6","udp",a)}get multiaddrs(){const a=this.get("multiaddrs");if(a)return decodeMultiaddrs(a)}set multiaddrs(a){deleteUndefined(this,"multiaddrs",a,encodeMultiaddrs)}get waku2(){const a=this.get("waku2");if(a)return decodeWaku2(a[0])}set waku2(a){deleteUndefined(this,"waku2",a,c=>new Uint8Array([encodeWaku2(c)]))}}function getStringValue(i,e,a){const c=i.get(e);if(c)return convertToString(a,c)}function getNumberAsStringValue(i,e,a){const c=i.get(e);if(c)return Number(convertToString(a,c))}function setStringValue(i,e,a,c){deleteUndefined(i,e,c,convertToBytes.bind({},a))}function setNumberAsStringValue(i,e,a,c){setStringValue(i,e,a,c==null?void 0:c.toString(10))}function deleteUndefined(i,e,a,c){a!==void 0?i.set(e,c(a)):i.delete(e)}async function sign(i,e){return sign$1(keccak256(e),i,{der:!1})}function nodeId(i){const a=Point.fromHex(i).toRawBytes(!1);return bytesToHex$1(keccak256(a.slice(1)))}const log$z=new Logger$2("enr");var TransportProtocol;(function(i){i.TCP="tcp",i.UDP="udp"})(TransportProtocol||(TransportProtocol={}));var TransportProtocolPerIpVersion;(function(i){i.TCP4="tcp4",i.UDP4="udp4",i.TCP6="tcp6",i.UDP6="udp6"})(TransportProtocolPerIpVersion||(TransportProtocolPerIpVersion={}));const Oo=class Oo extends RawEnr{constructor(){super(...arguments);qt(this,"peerId");qt(this,"getLocationMultiaddr",locationMultiaddrFromEnrFields.bind({},this))}static async create(a={},c=BigInt(1),h){const d=new Oo(a,c,h);try{const et=d.publicKey;et&&(d.peerId=await createPeerIdFromPublicKey(et))}catch(et){log$z.error("Could not calculate peer id for ENR",et)}return d}get nodeId(){switch(this.id){case"v4":return this.publicKey?nodeId(this.publicKey):void 0;default:throw new Error(ERR_INVALID_ID)}}get shardInfo(){return this.rs&&this.rsv&&log$z.warn("ENR contains both `rs` and `rsv` fields."),this.rs||this.rsv}setLocationMultiaddr(a){const c=a.protoNames();if(c.length!==2&&c[1]!=="udp"&&c[1]!=="tcp")throw new Error("Invalid multiaddr");const h=a.tuples();if(!h[0][1]||!h[1][1])throw new Error("Invalid multiaddr");h[0][0]===4?(this.set("ip",h[0][1]),this.set(c[1],h[1][1])):(this.set("ip6",h[0][1]),this.set(c[1]+"6",h[1][1]))}getAllLocationMultiaddrs(){const a=[];for(const h of Object.values(TransportProtocolPerIpVersion)){const d=this.getLocationMultiaddr(h);d&&a.push(d)}const c=this.multiaddrs??[];return a.concat(c)}get peerInfo(){const a=this.peerId;if(a)return{id:a,multiaddrs:this.getAllLocationMultiaddrs(),protocols:[]}}getFullMultiaddr(a){if(this.peerId){const c=this.getLocationMultiaddr(a);if(c)return c.encapsulate(`/p2p/${this.peerId.toString()}`)}}getFullMultiaddrs(){if(this.peerId&&this.multiaddrs){const a=this.peerId;return this.multiaddrs.map(c=>c.encapsulate(`/p2p/${a.toString()}`))}return[]}verify(a,c){if(!this.get("id")||this.id!=="v4")throw new Error(ERR_INVALID_ID);if(!this.publicKey)throw new Error("Failed to verify ENR: No public key");return verifySignature(c,keccak256(a),this.publicKey)}async sign(a,c){switch(this.id){case"v4":this.signature=await sign(c,a);break;default:throw new Error(ERR_INVALID_ID)}return this.signature}};qt(Oo,"RECORD_PREFIX","enr:");let ENR=Oo;const version$6="logger/5.7.0";let _permanentCensorErrors=!1,_censorErrors=!1;const LogLevels={debug:1,default:2,info:2,warning:3,error:4,off:5};let _logLevel=LogLevels.default,_globalLogger=null;function _checkNormalize(){try{const i=[];if(["NFD","NFC","NFKD","NFKC"].forEach(e=>{try{if("test".normalize(e)!=="test")throw new Error("bad normalize")}catch{i.push(e)}}),i.length)throw new Error("missing "+i.join(", "));if("é".normalize("NFD")!=="é")throw new Error("broken implementation")}catch(i){return i.message}return null}const _normalizeError=_checkNormalize();var LogLevel$1;(function(i){i.DEBUG="DEBUG",i.INFO="INFO",i.WARNING="WARNING",i.ERROR="ERROR",i.OFF="OFF"})(LogLevel$1||(LogLevel$1={}));var ErrorCode;(function(i){i.UNKNOWN_ERROR="UNKNOWN_ERROR",i.NOT_IMPLEMENTED="NOT_IMPLEMENTED",i.UNSUPPORTED_OPERATION="UNSUPPORTED_OPERATION",i.NETWORK_ERROR="NETWORK_ERROR",i.SERVER_ERROR="SERVER_ERROR",i.TIMEOUT="TIMEOUT",i.BUFFER_OVERRUN="BUFFER_OVERRUN",i.NUMERIC_FAULT="NUMERIC_FAULT",i.MISSING_NEW="MISSING_NEW",i.INVALID_ARGUMENT="INVALID_ARGUMENT",i.MISSING_ARGUMENT="MISSING_ARGUMENT",i.UNEXPECTED_ARGUMENT="UNEXPECTED_ARGUMENT",i.CALL_EXCEPTION="CALL_EXCEPTION",i.INSUFFICIENT_FUNDS="INSUFFICIENT_FUNDS",i.NONCE_EXPIRED="NONCE_EXPIRED",i.REPLACEMENT_UNDERPRICED="REPLACEMENT_UNDERPRICED",i.UNPREDICTABLE_GAS_LIMIT="UNPREDICTABLE_GAS_LIMIT",i.TRANSACTION_REPLACED="TRANSACTION_REPLACED",i.ACTION_REJECTED="ACTION_REJECTED"})(ErrorCode||(ErrorCode={}));const HEX="0123456789abcdef";let Logger$1=class zn{constructor(e){Object.defineProperty(this,"version",{enumerable:!0,value:e,writable:!1})}_log(e,a){const c=e.toLowerCase();LogLevels[c]==null&&this.throwArgumentError("invalid log level name","logLevel",e),!(_logLevel>LogLevels[c])&&console.log.apply(console,a)}debug(...e){this._log(zn.levels.DEBUG,e)}info(...e){this._log(zn.levels.INFO,e)}warn(...e){this._log(zn.levels.WARNING,e)}makeError(e,a,c){if(_censorErrors)return this.makeError("censored error",a,{});a||(a=zn.errors.UNKNOWN_ERROR),c||(c={});const h=[];Object.keys(c).forEach(gt=>{const _t=c[gt];try{if(_t instanceof Uint8Array){let wt="";for(let $t=0;$t<_t.length;$t++)wt+=HEX[_t[$t]>>4],wt+=HEX[_t[$t]&15];h.push(gt+"=Uint8Array(0x"+wt+")")}else h.push(gt+"="+JSON.stringify(_t))}catch{h.push(gt+"="+JSON.stringify(c[gt].toString()))}}),h.push(`code=${a}`),h.push(`version=${this.version}`);const d=e;let et="";switch(a){case ErrorCode.NUMERIC_FAULT:{et="NUMERIC_FAULT";const gt=e;switch(gt){case"overflow":case"underflow":case"division-by-zero":et+="-"+gt;break;case"negative-power":case"negative-width":et+="-unsupported";break;case"unbound-bitwise-result":et+="-unbound-result";break}break}case ErrorCode.CALL_EXCEPTION:case ErrorCode.INSUFFICIENT_FUNDS:case ErrorCode.MISSING_NEW:case ErrorCode.NONCE_EXPIRED:case ErrorCode.REPLACEMENT_UNDERPRICED:case ErrorCode.TRANSACTION_REPLACED:case ErrorCode.UNPREDICTABLE_GAS_LIMIT:et=a;break}et&&(e+=" [ See: https://links.ethers.org/v5-errors-"+et+" ]"),h.length&&(e+=" ("+h.join(", ")+")");const ft=new Error(e);return ft.reason=d,ft.code=a,Object.keys(c).forEach(function(gt){ft[gt]=c[gt]}),ft}throwError(e,a,c){throw this.makeError(e,a,c)}throwArgumentError(e,a,c){return this.throwError(e,zn.errors.INVALID_ARGUMENT,{argument:a,value:c})}assert(e,a,c,h){e||this.throwError(a,c,h)}assertArgument(e,a,c,h){e||this.throwArgumentError(a,c,h)}checkNormalize(e){_normalizeError&&this.throwError("platform missing String.prototype.normalize",zn.errors.UNSUPPORTED_OPERATION,{operation:"String.prototype.normalize",form:_normalizeError})}checkSafeUint53(e,a){typeof e=="number"&&(a==null&&(a="value not safe"),(e<0||e>=9007199254740991)&&this.throwError(a,zn.errors.NUMERIC_FAULT,{operation:"checkSafeInteger",fault:"out-of-safe-range",value:e}),e%1&&this.throwError(a,zn.errors.NUMERIC_FAULT,{operation:"checkSafeInteger",fault:"non-integer",value:e}))}checkArgumentCount(e,a,c){c?c=": "+c:c="",e<a&&this.throwError("missing argument"+c,zn.errors.MISSING_ARGUMENT,{count:e,expectedCount:a}),e>a&&this.throwError("too many arguments"+c,zn.errors.UNEXPECTED_ARGUMENT,{count:e,expectedCount:a})}checkNew(e,a){(e===Object||e==null)&&this.throwError("missing new",zn.errors.MISSING_NEW,{name:a.name})}checkAbstract(e,a){e===a?this.throwError("cannot instantiate abstract class "+JSON.stringify(a.name)+" directly; use a sub-class",zn.errors.UNSUPPORTED_OPERATION,{name:e.name,operation:"new"}):(e===Object||e==null)&&this.throwError("missing new",zn.errors.MISSING_NEW,{name:a.name})}static globalLogger(){return _globalLogger||(_globalLogger=new zn(version$6)),_globalLogger}static setCensorship(e,a){if(!e&&a&&this.globalLogger().throwError("cannot permanently disable censorship",zn.errors.UNSUPPORTED_OPERATION,{operation:"setCensorship"}),_permanentCensorErrors){if(!e)return;this.globalLogger().throwError("error censorship permanent",zn.errors.UNSUPPORTED_OPERATION,{operation:"setCensorship"})}_censorErrors=!!e,_permanentCensorErrors=!!a}static setLogLevel(e){const a=LogLevels[e.toLowerCase()];if(a==null){zn.globalLogger().warn("invalid log level - "+e);return}_logLevel=a}static from(e){return new zn(e)}};Logger$1.errors=ErrorCode;Logger$1.levels=LogLevel$1;const version$5="bytes/5.7.0",logger$4=new Logger$1(version$5);function isHexable(i){return!!i.toHexString}function addSlice(i){return i.slice||(i.slice=function(){const e=Array.prototype.slice.call(arguments);return addSlice(new Uint8Array(Array.prototype.slice.apply(i,e)))}),i}function isBytesLike(i){return isHexString(i)&&!(i.length%2)||isBytes$2(i)}function isInteger(i){return typeof i=="number"&&i==i&&i%1===0}function isBytes$2(i){if(i==null)return!1;if(i.constructor===Uint8Array)return!0;if(typeof i=="string"||!isInteger(i.length)||i.length<0)return!1;for(let e=0;e<i.length;e++){const a=i[e];if(!isInteger(a)||a<0||a>=256)return!1}return!0}function arrayify(i,e){if(e||(e={}),typeof i=="number"){logger$4.checkSafeUint53(i,"invalid arrayify value");const a=[];for(;i;)a.unshift(i&255),i=parseInt(String(i/256));return a.length===0&&a.push(0),addSlice(new Uint8Array(a))}if(e.allowMissingPrefix&&typeof i=="string"&&i.substring(0,2)!=="0x"&&(i="0x"+i),isHexable(i)&&(i=i.toHexString()),isHexString(i)){let a=i.substring(2);a.length%2&&(e.hexPad==="left"?a="0"+a:e.hexPad==="right"?a+="0":logger$4.throwArgumentError("hex data is odd-length","value",i));const c=[];for(let h=0;h<a.length;h+=2)c.push(parseInt(a.substring(h,h+2),16));return addSlice(new Uint8Array(c))}return isBytes$2(i)?addSlice(new Uint8Array(i)):logger$4.throwArgumentError("invalid arrayify value","value",i)}function isHexString(i,e){return!(typeof i!="string"||!i.match(/^0x[0-9A-Fa-f]*$/)||e&&i.length!==2+2*e)}const HexCharacters="0123456789abcdef";function hexlify(i,e){if(e||(e={}),typeof i=="number"){logger$4.checkSafeUint53(i,"invalid hexlify value");let a="";for(;i;)a=HexCharacters[i&15]+a,i=Math.floor(i/16);return a.length?(a.length%2&&(a="0"+a),"0x"+a):"0x00"}if(typeof i=="bigint")return i=i.toString(16),i.length%2?"0x0"+i:"0x"+i;if(e.allowMissingPrefix&&typeof i=="string"&&i.substring(0,2)!=="0x"&&(i="0x"+i),isHexable(i))return i.toHexString();if(isHexString(i))return i.length%2&&(e.hexPad==="left"?i="0x0"+i.substring(2):e.hexPad==="right"?i+="0":logger$4.throwArgumentError("hex data is odd-length","value",i)),i.toLowerCase();if(isBytes$2(i)){let a="0x";for(let c=0;c<i.length;c++){let h=i[c];a+=HexCharacters[(h&240)>>4]+HexCharacters[h&15]}return a}return logger$4.throwArgumentError("invalid hexlify value","value",i)}const version$4="rlp/5.7.0",logger$3=new Logger$1(version$4);function arrayifyInteger(i){const e=[];for(;i;)e.unshift(i&255),i>>=8;return e}function unarrayifyInteger(i,e,a){let c=0;for(let h=0;h<a;h++)c=c*256+i[e+h];return c}function _encode(i){if(Array.isArray(i)){let c=[];if(i.forEach(function(d){c=c.concat(_encode(d))}),c.length<=55)return c.unshift(192+c.length),c;const h=arrayifyInteger(c.length);return h.unshift(247+h.length),h.concat(c)}isBytesLike(i)||logger$3.throwArgumentError("RLP object must be BytesLike","object",i);const e=Array.prototype.slice.call(arrayify(i));if(e.length===1&&e[0]<=127)return e;if(e.length<=55)return e.unshift(128+e.length),e;const a=arrayifyInteger(e.length);return a.unshift(183+a.length),a.concat(e)}function encode$d(i){return hexlify(_encode(i))}function _decodeChildren(i,e,a,c){const h=[];for(;a<e+1+c;){const d=_decode(i,a);h.push(d.result),a+=d.consumed,a>e+1+c&&logger$3.throwError("child data too short",Logger$1.errors.BUFFER_OVERRUN,{})}return{consumed:1+c,result:h}}function _decode(i,e){if(i.length===0&&logger$3.throwError("data too short",Logger$1.errors.BUFFER_OVERRUN,{}),i[e]>=248){const a=i[e]-247;e+1+a>i.length&&logger$3.throwError("data short segment too short",Logger$1.errors.BUFFER_OVERRUN,{});const c=unarrayifyInteger(i,e+1,a);return e+1+a+c>i.length&&logger$3.throwError("data long segment too short",Logger$1.errors.BUFFER_OVERRUN,{}),_decodeChildren(i,e,e+1+a,a+c)}else if(i[e]>=192){const a=i[e]-192;return e+1+a>i.length&&logger$3.throwError("data array too short",Logger$1.errors.BUFFER_OVERRUN,{}),_decodeChildren(i,e,e+1,a)}else if(i[e]>=184){const a=i[e]-183;e+1+a>i.length&&logger$3.throwError("data array too short",Logger$1.errors.BUFFER_OVERRUN,{});const c=unarrayifyInteger(i,e+1,a);e+1+a+c>i.length&&logger$3.throwError("data array too short",Logger$1.errors.BUFFER_OVERRUN,{});const h=hexlify(i.slice(e+1+a,e+1+a+c));return{consumed:1+a+c,result:h}}else if(i[e]>=128){const a=i[e]-128;e+1+a>i.length&&logger$3.throwError("data too short",Logger$1.errors.BUFFER_OVERRUN,{});const c=hexlify(i.slice(e+1,e+1+a));return{consumed:1+a,result:c}}return{consumed:1,result:hexlify(i[e])}}function decode$c(i){const e=arrayify(i),a=_decode(e,0);return a.consumed!==e.length&&logger$3.throwArgumentError("invalid rlp data","data",i),a.result}const log$y=new Logger$2("enr:decoder");class EnrDecoder{static fromString(e){if(!e.startsWith(ENR.RECORD_PREFIX))throw new Error(`"string encoded ENR must start with '${ENR.RECORD_PREFIX}'`);return EnrDecoder.fromRLP(fromString$7(e.slice(4),"base64url"))}static fromRLP(e){const a=decode$c(e).map(hexToBytes$1);return fromValues(a)}}async function fromValues(i){const{signature:e,seq:a,kvs:c}=checkValues(i),h={};for(let ft=0;ft<c.length;ft+=2)try{h[bytesToUtf8(c[ft])]=c[ft+1]}catch(gt){log$y.error("Failed to decode ENR key to UTF-8, skipping it",c[ft],gt)}const d=decodeSeq(a),et=await ENR.create(h,d,e);return checkSignature(a,c,et,e),et}function decodeSeq(i){return i.length?BigInt("0x"+bytesToHex$1(i)):BigInt(0)}function checkValues(i){if(!Array.isArray(i))throw new Error("Decoded ENR must be an array");if(i.length%2!==0)throw new Error("Decoded ENR must have an even number of elements");const[e,a,...c]=i;if(!e||Array.isArray(e))throw new Error("Decoded ENR invalid signature: must be a byte array");if(!a||Array.isArray(a))throw new Error("Decoded ENR invalid sequence number: must be a byte array");return{signature:e,seq:a,kvs:c}}function checkSignature(i,e,a,c){const h=hexToBytes$1(encode$d([i,...e]));if(!a.verify(h,c))throw new Error("Unable to verify ENR signature")}var RateLimitProof$4;(function(i){let e;i.codec=()=>(e==null&&(e=message((a,c,h={})=>{h.lengthDelimited!==!1&&c.fork(),a.proof!=null&&a.proof.byteLength>0&&(c.uint32(10),c.bytes(a.proof)),a.merkleRoot!=null&&a.merkleRoot.byteLength>0&&(c.uint32(18),c.bytes(a.merkleRoot)),a.epoch!=null&&a.epoch.byteLength>0&&(c.uint32(26),c.bytes(a.epoch)),a.shareX!=null&&a.shareX.byteLength>0&&(c.uint32(34),c.bytes(a.shareX)),a.shareY!=null&&a.shareY.byteLength>0&&(c.uint32(42),c.bytes(a.shareY)),a.nullifier!=null&&a.nullifier.byteLength>0&&(c.uint32(50),c.bytes(a.nullifier)),a.rlnIdentifier!=null&&a.rlnIdentifier.byteLength>0&&(c.uint32(58),c.bytes(a.rlnIdentifier)),h.lengthDelimited!==!1&&c.ldelim()},(a,c)=>{const h={proof:new Uint8Array(0),merkleRoot:new Uint8Array(0),epoch:new Uint8Array(0),shareX:new Uint8Array(0),shareY:new Uint8Array(0),nullifier:new Uint8Array(0),rlnIdentifier:new Uint8Array(0)},d=c==null?a.len:a.pos+c;for(;a.pos<d;){const et=a.uint32();switch(et>>>3){case 1:h.proof=a.bytes();break;case 2:h.merkleRoot=a.bytes();break;case 3:h.epoch=a.bytes();break;case 4:h.shareX=a.bytes();break;case 5:h.shareY=a.bytes();break;case 6:h.nullifier=a.bytes();break;case 7:h.rlnIdentifier=a.bytes();break;default:a.skipType(et&7);break}}return h})),e),i.encode=a=>encodeMessage(a,i.codec()),i.decode=a=>decodeMessage$1(a,i.codec())})(RateLimitProof$4||(RateLimitProof$4={}));var WakuMessage$4;(function(i){let e;i.codec=()=>(e==null&&(e=message((a,c,h={})=>{h.lengthDelimited!==!1&&c.fork(),a.payload!=null&&a.payload.byteLength>0&&(c.uint32(10),c.bytes(a.payload)),a.contentTopic!=null&&a.contentTopic!==""&&(c.uint32(18),c.string(a.contentTopic)),a.version!=null&&(c.uint32(24),c.uint32(a.version)),a.timestamp!=null&&(c.uint32(80),c.sint64(a.timestamp)),a.meta!=null&&(c.uint32(90),c.bytes(a.meta)),a.rateLimitProof!=null&&(c.uint32(170),RateLimitProof$4.codec().encode(a.rateLimitProof,c)),a.ephemeral!=null&&(c.uint32(248),c.bool(a.ephemeral)),h.lengthDelimited!==!1&&c.ldelim()},(a,c)=>{const h={payload:new Uint8Array(0),contentTopic:""},d=c==null?a.len:a.pos+c;for(;a.pos<d;){const et=a.uint32();switch(et>>>3){case 1:h.payload=a.bytes();break;case 2:h.contentTopic=a.string();break;case 3:h.version=a.uint32();break;case 10:h.timestamp=a.sint64();break;case 11:h.meta=a.bytes();break;case 21:h.rateLimitProof=RateLimitProof$4.codec().decode(a,a.uint32());break;case 31:h.ephemeral=a.bool();break;default:a.skipType(et&7);break}}return h})),e),i.encode=a=>encodeMessage(a,i.codec()),i.decode=a=>decodeMessage$1(a,i.codec())})(WakuMessage$4||(WakuMessage$4={}));var FilterRequest;(function(i){(function(a){let c;a.codec=()=>(c==null&&(c=message((h,d,et={})=>{et.lengthDelimited!==!1&&d.fork(),h.contentTopic!=null&&h.contentTopic!==""&&(d.uint32(10),d.string(h.contentTopic)),et.lengthDelimited!==!1&&d.ldelim()},(h,d)=>{const et={contentTopic:""},ft=d==null?h.len:h.pos+d;for(;h.pos<ft;){const gt=h.uint32();switch(gt>>>3){case 1:et.contentTopic=h.string();break;default:h.skipType(gt&7);break}}return et})),c),a.encode=h=>encodeMessage(h,a.codec()),a.decode=h=>decodeMessage$1(h,a.codec())})(i.ContentFilter||(i.ContentFilter={}));let e;i.codec=()=>(e==null&&(e=message((a,c,h={})=>{if(h.lengthDelimited!==!1&&c.fork(),a.subscribe!=null&&a.subscribe!==!1&&(c.uint32(8),c.bool(a.subscribe)),a.topic!=null&&a.topic!==""&&(c.uint32(18),c.string(a.topic)),a.contentFilters!=null)for(const d of a.contentFilters)c.uint32(26),i.ContentFilter.codec().encode(d,c);h.lengthDelimited!==!1&&c.ldelim()},(a,c)=>{const h={subscribe:!1,topic:"",contentFilters:[]},d=c==null?a.len:a.pos+c;for(;a.pos<d;){const et=a.uint32();switch(et>>>3){case 1:h.subscribe=a.bool();break;case 2:h.topic=a.string();break;case 3:h.contentFilters.push(i.ContentFilter.codec().decode(a,a.uint32()));break;default:a.skipType(et&7);break}}return h})),e),i.encode=a=>encodeMessage(a,i.codec()),i.decode=a=>decodeMessage$1(a,i.codec())})(FilterRequest||(FilterRequest={}));var MessagePush$1;(function(i){let e;i.codec=()=>(e==null&&(e=message((a,c,h={})=>{if(h.lengthDelimited!==!1&&c.fork(),a.messages!=null)for(const d of a.messages)c.uint32(10),WakuMessage$3.codec().encode(d,c);h.lengthDelimited!==!1&&c.ldelim()},(a,c)=>{const h={messages:[]},d=c==null?a.len:a.pos+c;for(;a.pos<d;){const et=a.uint32();switch(et>>>3){case 1:h.messages.push(WakuMessage$3.codec().decode(a,a.uint32()));break;default:a.skipType(et&7);break}}return h})),e),i.encode=a=>encodeMessage(a,i.codec()),i.decode=a=>decodeMessage$1(a,i.codec())})(MessagePush$1||(MessagePush$1={}));var FilterRpc;(function(i){let e;i.codec=()=>(e==null&&(e=message((a,c,h={})=>{h.lengthDelimited!==!1&&c.fork(),a.requestId!=null&&a.requestId!==""&&(c.uint32(10),c.string(a.requestId)),a.request!=null&&(c.uint32(18),FilterRequest.codec().encode(a.request,c)),a.push!=null&&(c.uint32(26),MessagePush$1.codec().encode(a.push,c)),h.lengthDelimited!==!1&&c.ldelim()},(a,c)=>{const h={requestId:""},d=c==null?a.len:a.pos+c;for(;a.pos<d;){const et=a.uint32();switch(et>>>3){case 1:h.requestId=a.string();break;case 2:h.request=FilterRequest.codec().decode(a,a.uint32());break;case 3:h.push=MessagePush$1.codec().decode(a,a.uint32());break;default:a.skipType(et&7);break}}return h})),e),i.encode=a=>encodeMessage(a,i.codec()),i.decode=a=>decodeMessage$1(a,i.codec())})(FilterRpc||(FilterRpc={}));var RateLimitProof$3;(function(i){let e;i.codec=()=>(e==null&&(e=message((a,c,h={})=>{h.lengthDelimited!==!1&&c.fork(),a.proof!=null&&a.proof.byteLength>0&&(c.uint32(10),c.bytes(a.proof)),a.merkleRoot!=null&&a.merkleRoot.byteLength>0&&(c.uint32(18),c.bytes(a.merkleRoot)),a.epoch!=null&&a.epoch.byteLength>0&&(c.uint32(26),c.bytes(a.epoch)),a.shareX!=null&&a.shareX.byteLength>0&&(c.uint32(34),c.bytes(a.shareX)),a.shareY!=null&&a.shareY.byteLength>0&&(c.uint32(42),c.bytes(a.shareY)),a.nullifier!=null&&a.nullifier.byteLength>0&&(c.uint32(50),c.bytes(a.nullifier)),a.rlnIdentifier!=null&&a.rlnIdentifier.byteLength>0&&(c.uint32(58),c.bytes(a.rlnIdentifier)),h.lengthDelimited!==!1&&c.ldelim()},(a,c)=>{const h={proof:new Uint8Array(0),merkleRoot:new Uint8Array(0),epoch:new Uint8Array(0),shareX:new Uint8Array(0),shareY:new Uint8Array(0),nullifier:new Uint8Array(0),rlnIdentifier:new Uint8Array(0)},d=c==null?a.len:a.pos+c;for(;a.pos<d;){const et=a.uint32();switch(et>>>3){case 1:h.proof=a.bytes();break;case 2:h.merkleRoot=a.bytes();break;case 3:h.epoch=a.bytes();break;case 4:h.shareX=a.bytes();break;case 5:h.shareY=a.bytes();break;case 6:h.nullifier=a.bytes();break;case 7:h.rlnIdentifier=a.bytes();break;default:a.skipType(et&7);break}}return h})),e),i.encode=a=>encodeMessage(a,i.codec()),i.decode=a=>decodeMessage$1(a,i.codec())})(RateLimitProof$3||(RateLimitProof$3={}));var WakuMessage$3;(function(i){let e;i.codec=()=>(e==null&&(e=message((a,c,h={})=>{h.lengthDelimited!==!1&&c.fork(),a.payload!=null&&a.payload.byteLength>0&&(c.uint32(10),c.bytes(a.payload)),a.contentTopic!=null&&a.contentTopic!==""&&(c.uint32(18),c.string(a.contentTopic)),a.version!=null&&(c.uint32(24),c.uint32(a.version)),a.timestamp!=null&&(c.uint32(80),c.sint64(a.timestamp)),a.meta!=null&&(c.uint32(90),c.bytes(a.meta)),a.rateLimitProof!=null&&(c.uint32(170),RateLimitProof$3.codec().encode(a.rateLimitProof,c)),a.ephemeral!=null&&(c.uint32(248),c.bool(a.ephemeral)),h.lengthDelimited!==!1&&c.ldelim()},(a,c)=>{const h={payload:new Uint8Array(0),contentTopic:""},d=c==null?a.len:a.pos+c;for(;a.pos<d;){const et=a.uint32();switch(et>>>3){case 1:h.payload=a.bytes();break;case 2:h.contentTopic=a.string();break;case 3:h.version=a.uint32();break;case 10:h.timestamp=a.sint64();break;case 11:h.meta=a.bytes();break;case 21:h.rateLimitProof=RateLimitProof$3.codec().decode(a,a.uint32());break;case 31:h.ephemeral=a.bool();break;default:a.skipType(et&7);break}}return h})),e),i.encode=a=>encodeMessage(a,i.codec()),i.decode=a=>decodeMessage$1(a,i.codec())})(WakuMessage$3||(WakuMessage$3={}));var TopicOnlyMessage$1;(function(i){let e;i.codec=()=>(e==null&&(e=message((a,c,h={})=>{h.lengthDelimited!==!1&&c.fork(),a.contentTopic!=null&&a.contentTopic!==""&&(c.uint32(18),c.string(a.contentTopic)),h.lengthDelimited!==!1&&c.ldelim()},(a,c)=>{const h={contentTopic:""},d=c==null?a.len:a.pos+c;for(;a.pos<d;){const et=a.uint32();switch(et>>>3){case 2:h.contentTopic=a.string();break;default:a.skipType(et&7);break}}return h})),e),i.encode=a=>encodeMessage(a,i.codec()),i.decode=a=>decodeMessage$1(a,i.codec())})(TopicOnlyMessage$1||(TopicOnlyMessage$1={}));var FilterSubscribeRequest;(function(i){let e;(function(h){h.SUBSCRIBER_PING="SUBSCRIBER_PING",h.SUBSCRIBE="SUBSCRIBE",h.UNSUBSCRIBE="UNSUBSCRIBE",h.UNSUBSCRIBE_ALL="UNSUBSCRIBE_ALL"})(e=i.FilterSubscribeType||(i.FilterSubscribeType={}));let a;(function(h){h[h.SUBSCRIBER_PING=0]="SUBSCRIBER_PING",h[h.SUBSCRIBE=1]="SUBSCRIBE",h[h.UNSUBSCRIBE=2]="UNSUBSCRIBE",h[h.UNSUBSCRIBE_ALL=3]="UNSUBSCRIBE_ALL"})(a||(a={})),function(h){h.codec=()=>enumeration(a)}(e=i.FilterSubscribeType||(i.FilterSubscribeType={}));let c;i.codec=()=>(c==null&&(c=message((h,d,et={})=>{if(et.lengthDelimited!==!1&&d.fork(),h.requestId!=null&&h.requestId!==""&&(d.uint32(10),d.string(h.requestId)),h.filterSubscribeType!=null&&a[h.filterSubscribeType]!==0&&(d.uint32(16),i.FilterSubscribeType.codec().encode(h.filterSubscribeType,d)),h.pubsubTopic!=null&&(d.uint32(82),d.string(h.pubsubTopic)),h.contentTopics!=null)for(const ft of h.contentTopics)d.uint32(90),d.string(ft);et.lengthDelimited!==!1&&d.ldelim()},(h,d)=>{const et={requestId:"",filterSubscribeType:e.SUBSCRIBER_PING,contentTopics:[]},ft=d==null?h.len:h.pos+d;for(;h.pos<ft;){const gt=h.uint32();switch(gt>>>3){case 1:et.requestId=h.string();break;case 2:et.filterSubscribeType=i.FilterSubscribeType.codec().decode(h);break;case 10:et.pubsubTopic=h.string();break;case 11:et.contentTopics.push(h.string());break;default:h.skipType(gt&7);break}}return et})),c),i.encode=h=>encodeMessage(h,i.codec()),i.decode=h=>decodeMessage$1(h,i.codec())})(FilterSubscribeRequest||(FilterSubscribeRequest={}));var FilterSubscribeResponse$1;(function(i){let e;i.codec=()=>(e==null&&(e=message((a,c,h={})=>{h.lengthDelimited!==!1&&c.fork(),a.requestId!=null&&a.requestId!==""&&(c.uint32(10),c.string(a.requestId)),a.statusCode!=null&&a.statusCode!==0&&(c.uint32(80),c.uint32(a.statusCode)),a.statusDesc!=null&&(c.uint32(90),c.string(a.statusDesc)),h.lengthDelimited!==!1&&c.ldelim()},(a,c)=>{const h={requestId:"",statusCode:0},d=c==null?a.len:a.pos+c;for(;a.pos<d;){const et=a.uint32();switch(et>>>3){case 1:h.requestId=a.string();break;case 10:h.statusCode=a.uint32();break;case 11:h.statusDesc=a.string();break;default:a.skipType(et&7);break}}return h})),e),i.encode=a=>encodeMessage(a,i.codec()),i.decode=a=>decodeMessage$1(a,i.codec())})(FilterSubscribeResponse$1||(FilterSubscribeResponse$1={}));var MessagePush;(function(i){let e;i.codec=()=>(e==null&&(e=message((a,c,h={})=>{h.lengthDelimited!==!1&&c.fork(),a.wakuMessage!=null&&(c.uint32(10),WakuMessage$2.codec().encode(a.wakuMessage,c)),a.pubsubTopic!=null&&(c.uint32(18),c.string(a.pubsubTopic)),h.lengthDelimited!==!1&&c.ldelim()},(a,c)=>{const h={},d=c==null?a.len:a.pos+c;for(;a.pos<d;){const et=a.uint32();switch(et>>>3){case 1:h.wakuMessage=WakuMessage$2.codec().decode(a,a.uint32());break;case 2:h.pubsubTopic=a.string();break;default:a.skipType(et&7);break}}return h})),e),i.encode=a=>encodeMessage(a,i.codec()),i.decode=a=>decodeMessage$1(a,i.codec())})(MessagePush||(MessagePush={}));var RateLimitProof$2;(function(i){let e;i.codec=()=>(e==null&&(e=message((a,c,h={})=>{h.lengthDelimited!==!1&&c.fork(),a.proof!=null&&a.proof.byteLength>0&&(c.uint32(10),c.bytes(a.proof)),a.merkleRoot!=null&&a.merkleRoot.byteLength>0&&(c.uint32(18),c.bytes(a.merkleRoot)),a.epoch!=null&&a.epoch.byteLength>0&&(c.uint32(26),c.bytes(a.epoch)),a.shareX!=null&&a.shareX.byteLength>0&&(c.uint32(34),c.bytes(a.shareX)),a.shareY!=null&&a.shareY.byteLength>0&&(c.uint32(42),c.bytes(a.shareY)),a.nullifier!=null&&a.nullifier.byteLength>0&&(c.uint32(50),c.bytes(a.nullifier)),a.rlnIdentifier!=null&&a.rlnIdentifier.byteLength>0&&(c.uint32(58),c.bytes(a.rlnIdentifier)),h.lengthDelimited!==!1&&c.ldelim()},(a,c)=>{const h={proof:new Uint8Array(0),merkleRoot:new Uint8Array(0),epoch:new Uint8Array(0),shareX:new Uint8Array(0),shareY:new Uint8Array(0),nullifier:new Uint8Array(0),rlnIdentifier:new Uint8Array(0)},d=c==null?a.len:a.pos+c;for(;a.pos<d;){const et=a.uint32();switch(et>>>3){case 1:h.proof=a.bytes();break;case 2:h.merkleRoot=a.bytes();break;case 3:h.epoch=a.bytes();break;case 4:h.shareX=a.bytes();break;case 5:h.shareY=a.bytes();break;case 6:h.nullifier=a.bytes();break;case 7:h.rlnIdentifier=a.bytes();break;default:a.skipType(et&7);break}}return h})),e),i.encode=a=>encodeMessage(a,i.codec()),i.decode=a=>decodeMessage$1(a,i.codec())})(RateLimitProof$2||(RateLimitProof$2={}));var WakuMessage$2;(function(i){let e;i.codec=()=>(e==null&&(e=message((a,c,h={})=>{h.lengthDelimited!==!1&&c.fork(),a.payload!=null&&a.payload.byteLength>0&&(c.uint32(10),c.bytes(a.payload)),a.contentTopic!=null&&a.contentTopic!==""&&(c.uint32(18),c.string(a.contentTopic)),a.version!=null&&(c.uint32(24),c.uint32(a.version)),a.timestamp!=null&&(c.uint32(80),c.sint64(a.timestamp)),a.meta!=null&&(c.uint32(90),c.bytes(a.meta)),a.rateLimitProof!=null&&(c.uint32(170),RateLimitProof$2.codec().encode(a.rateLimitProof,c)),a.ephemeral!=null&&(c.uint32(248),c.bool(a.ephemeral)),h.lengthDelimited!==!1&&c.ldelim()},(a,c)=>{const h={payload:new Uint8Array(0),contentTopic:""},d=c==null?a.len:a.pos+c;for(;a.pos<d;){const et=a.uint32();switch(et>>>3){case 1:h.payload=a.bytes();break;case 2:h.contentTopic=a.string();break;case 3:h.version=a.uint32();break;case 10:h.timestamp=a.sint64();break;case 11:h.meta=a.bytes();break;case 21:h.rateLimitProof=RateLimitProof$2.codec().decode(a,a.uint32());break;case 31:h.ephemeral=a.bool();break;default:a.skipType(et&7);break}}return h})),e),i.encode=a=>encodeMessage(a,i.codec()),i.decode=a=>decodeMessage$1(a,i.codec())})(WakuMessage$2||(WakuMessage$2={}));var PushRequest;(function(i){let e;i.codec=()=>(e==null&&(e=message((a,c,h={})=>{h.lengthDelimited!==!1&&c.fork(),a.pubsubTopic!=null&&a.pubsubTopic!==""&&(c.uint32(10),c.string(a.pubsubTopic)),a.message!=null&&(c.uint32(18),WakuMessage$1.codec().encode(a.message,c)),h.lengthDelimited!==!1&&c.ldelim()},(a,c)=>{const h={pubsubTopic:""},d=c==null?a.len:a.pos+c;for(;a.pos<d;){const et=a.uint32();switch(et>>>3){case 1:h.pubsubTopic=a.string();break;case 2:h.message=WakuMessage$1.codec().decode(a,a.uint32());break;default:a.skipType(et&7);break}}return h})),e),i.encode=a=>encodeMessage(a,i.codec()),i.decode=a=>decodeMessage$1(a,i.codec())})(PushRequest||(PushRequest={}));var PushResponse;(function(i){let e;i.codec=()=>(e==null&&(e=message((a,c,h={})=>{h.lengthDelimited!==!1&&c.fork(),a.isSuccess!=null&&a.isSuccess!==!1&&(c.uint32(8),c.bool(a.isSuccess)),a.info!=null&&(c.uint32(18),c.string(a.info)),h.lengthDelimited!==!1&&c.ldelim()},(a,c)=>{const h={isSuccess:!1},d=c==null?a.len:a.pos+c;for(;a.pos<d;){const et=a.uint32();switch(et>>>3){case 1:h.isSuccess=a.bool();break;case 2:h.info=a.string();break;default:a.skipType(et&7);break}}return h})),e),i.encode=a=>encodeMessage(a,i.codec()),i.decode=a=>decodeMessage$1(a,i.codec())})(PushResponse||(PushResponse={}));var PushRpc$1;(function(i){let e;i.codec=()=>(e==null&&(e=message((a,c,h={})=>{h.lengthDelimited!==!1&&c.fork(),a.requestId!=null&&a.requestId!==""&&(c.uint32(10),c.string(a.requestId)),a.request!=null&&(c.uint32(18),PushRequest.codec().encode(a.request,c)),a.response!=null&&(c.uint32(26),PushResponse.codec().encode(a.response,c)),h.lengthDelimited!==!1&&c.ldelim()},(a,c)=>{const h={requestId:""},d=c==null?a.len:a.pos+c;for(;a.pos<d;){const et=a.uint32();switch(et>>>3){case 1:h.requestId=a.string();break;case 2:h.request=PushRequest.codec().decode(a,a.uint32());break;case 3:h.response=PushResponse.codec().decode(a,a.uint32());break;default:a.skipType(et&7);break}}return h})),e),i.encode=a=>encodeMessage(a,i.codec()),i.decode=a=>decodeMessage$1(a,i.codec())})(PushRpc$1||(PushRpc$1={}));var RateLimitProof$1;(function(i){let e;i.codec=()=>(e==null&&(e=message((a,c,h={})=>{h.lengthDelimited!==!1&&c.fork(),a.proof!=null&&a.proof.byteLength>0&&(c.uint32(10),c.bytes(a.proof)),a.merkleRoot!=null&&a.merkleRoot.byteLength>0&&(c.uint32(18),c.bytes(a.merkleRoot)),a.epoch!=null&&a.epoch.byteLength>0&&(c.uint32(26),c.bytes(a.epoch)),a.shareX!=null&&a.shareX.byteLength>0&&(c.uint32(34),c.bytes(a.shareX)),a.shareY!=null&&a.shareY.byteLength>0&&(c.uint32(42),c.bytes(a.shareY)),a.nullifier!=null&&a.nullifier.byteLength>0&&(c.uint32(50),c.bytes(a.nullifier)),a.rlnIdentifier!=null&&a.rlnIdentifier.byteLength>0&&(c.uint32(58),c.bytes(a.rlnIdentifier)),h.lengthDelimited!==!1&&c.ldelim()},(a,c)=>{const h={proof:new Uint8Array(0),merkleRoot:new Uint8Array(0),epoch:new Uint8Array(0),shareX:new Uint8Array(0),shareY:new Uint8Array(0),nullifier:new Uint8Array(0),rlnIdentifier:new Uint8Array(0)},d=c==null?a.len:a.pos+c;for(;a.pos<d;){const et=a.uint32();switch(et>>>3){case 1:h.proof=a.bytes();break;case 2:h.merkleRoot=a.bytes();break;case 3:h.epoch=a.bytes();break;case 4:h.shareX=a.bytes();break;case 5:h.shareY=a.bytes();break;case 6:h.nullifier=a.bytes();break;case 7:h.rlnIdentifier=a.bytes();break;default:a.skipType(et&7);break}}return h})),e),i.encode=a=>encodeMessage(a,i.codec()),i.decode=a=>decodeMessage$1(a,i.codec())})(RateLimitProof$1||(RateLimitProof$1={}));var WakuMessage$1;(function(i){let e;i.codec=()=>(e==null&&(e=message((a,c,h={})=>{h.lengthDelimited!==!1&&c.fork(),a.payload!=null&&a.payload.byteLength>0&&(c.uint32(10),c.bytes(a.payload)),a.contentTopic!=null&&a.contentTopic!==""&&(c.uint32(18),c.string(a.contentTopic)),a.version!=null&&(c.uint32(24),c.uint32(a.version)),a.timestamp!=null&&(c.uint32(80),c.sint64(a.timestamp)),a.meta!=null&&(c.uint32(90),c.bytes(a.meta)),a.rateLimitProof!=null&&(c.uint32(170),RateLimitProof$1.codec().encode(a.rateLimitProof,c)),a.ephemeral!=null&&(c.uint32(248),c.bool(a.ephemeral)),h.lengthDelimited!==!1&&c.ldelim()},(a,c)=>{const h={payload:new Uint8Array(0),contentTopic:""},d=c==null?a.len:a.pos+c;for(;a.pos<d;){const et=a.uint32();switch(et>>>3){case 1:h.payload=a.bytes();break;case 2:h.contentTopic=a.string();break;case 3:h.version=a.uint32();break;case 10:h.timestamp=a.sint64();break;case 11:h.meta=a.bytes();break;case 21:h.rateLimitProof=RateLimitProof$1.codec().decode(a,a.uint32());break;case 31:h.ephemeral=a.bool();break;default:a.skipType(et&7);break}}return h})),e),i.encode=a=>encodeMessage(a,i.codec()),i.decode=a=>decodeMessage$1(a,i.codec())})(WakuMessage$1||(WakuMessage$1={}));var Index$1;(function(i){let e;i.codec=()=>(e==null&&(e=message((a,c,h={})=>{h.lengthDelimited!==!1&&c.fork(),a.digest!=null&&a.digest.byteLength>0&&(c.uint32(10),c.bytes(a.digest)),a.receiverTime!=null&&a.receiverTime!==0n&&(c.uint32(16),c.sint64(a.receiverTime)),a.senderTime!=null&&a.senderTime!==0n&&(c.uint32(24),c.sint64(a.senderTime)),a.pubsubTopic!=null&&a.pubsubTopic!==""&&(c.uint32(34),c.string(a.pubsubTopic)),h.lengthDelimited!==!1&&c.ldelim()},(a,c)=>{const h={digest:new Uint8Array(0),receiverTime:0n,senderTime:0n,pubsubTopic:""},d=c==null?a.len:a.pos+c;for(;a.pos<d;){const et=a.uint32();switch(et>>>3){case 1:h.digest=a.bytes();break;case 2:h.receiverTime=a.sint64();break;case 3:h.senderTime=a.sint64();break;case 4:h.pubsubTopic=a.string();break;default:a.skipType(et&7);break}}return h})),e),i.encode=a=>encodeMessage(a,i.codec()),i.decode=a=>decodeMessage$1(a,i.codec())})(Index$1||(Index$1={}));var PagingInfo;(function(i){(function(c){c.BACKWARD="BACKWARD",c.FORWARD="FORWARD"})(i.Direction||(i.Direction={}));let e;(function(c){c[c.BACKWARD=0]="BACKWARD",c[c.FORWARD=1]="FORWARD"})(e||(e={})),function(c){c.codec=()=>enumeration(e)}(i.Direction||(i.Direction={}));let a;i.codec=()=>(a==null&&(a=message((c,h,d={})=>{d.lengthDelimited!==!1&&h.fork(),c.pageSize!=null&&(h.uint32(8),h.uint64(c.pageSize)),c.cursor!=null&&(h.uint32(18),Index$1.codec().encode(c.cursor,h)),c.direction!=null&&(h.uint32(24),i.Direction.codec().encode(c.direction,h)),d.lengthDelimited!==!1&&h.ldelim()},(c,h)=>{const d={},et=h==null?c.len:c.pos+h;for(;c.pos<et;){const ft=c.uint32();switch(ft>>>3){case 1:d.pageSize=c.uint64();break;case 2:d.cursor=Index$1.codec().decode(c,c.uint32());break;case 3:d.direction=i.Direction.codec().decode(c);break;default:c.skipType(ft&7);break}}return d})),a),i.encode=c=>encodeMessage(c,i.codec()),i.decode=c=>decodeMessage$1(c,i.codec())})(PagingInfo||(PagingInfo={}));var ContentFilter;(function(i){let e;i.codec=()=>(e==null&&(e=message((a,c,h={})=>{h.lengthDelimited!==!1&&c.fork(),a.contentTopic!=null&&a.contentTopic!==""&&(c.uint32(10),c.string(a.contentTopic)),h.lengthDelimited!==!1&&c.ldelim()},(a,c)=>{const h={contentTopic:""},d=c==null?a.len:a.pos+c;for(;a.pos<d;){const et=a.uint32();switch(et>>>3){case 1:h.contentTopic=a.string();break;default:a.skipType(et&7);break}}return h})),e),i.encode=a=>encodeMessage(a,i.codec()),i.decode=a=>decodeMessage$1(a,i.codec())})(ContentFilter||(ContentFilter={}));var HistoryQuery;(function(i){let e;i.codec=()=>(e==null&&(e=message((a,c,h={})=>{if(h.lengthDelimited!==!1&&c.fork(),a.pubsubTopic!=null&&(c.uint32(18),c.string(a.pubsubTopic)),a.contentFilters!=null)for(const d of a.contentFilters)c.uint32(26),ContentFilter.codec().encode(d,c);a.pagingInfo!=null&&(c.uint32(34),PagingInfo.codec().encode(a.pagingInfo,c)),a.startTime!=null&&(c.uint32(40),c.sint64(a.startTime)),a.endTime!=null&&(c.uint32(48),c.sint64(a.endTime)),h.lengthDelimited!==!1&&c.ldelim()},(a,c)=>{const h={contentFilters:[]},d=c==null?a.len:a.pos+c;for(;a.pos<d;){const et=a.uint32();switch(et>>>3){case 2:h.pubsubTopic=a.string();break;case 3:h.contentFilters.push(ContentFilter.codec().decode(a,a.uint32()));break;case 4:h.pagingInfo=PagingInfo.codec().decode(a,a.uint32());break;case 5:h.startTime=a.sint64();break;case 6:h.endTime=a.sint64();break;default:a.skipType(et&7);break}}return h})),e),i.encode=a=>encodeMessage(a,i.codec()),i.decode=a=>decodeMessage$1(a,i.codec())})(HistoryQuery||(HistoryQuery={}));var HistoryResponse;(function(i){let e;(function(h){h.NONE="NONE",h.INVALID_CURSOR="INVALID_CURSOR"})(e=i.HistoryError||(i.HistoryError={}));let a;(function(h){h[h.NONE=0]="NONE",h[h.INVALID_CURSOR=1]="INVALID_CURSOR"})(a||(a={})),function(h){h.codec=()=>enumeration(a)}(e=i.HistoryError||(i.HistoryError={}));let c;i.codec=()=>(c==null&&(c=message((h,d,et={})=>{if(et.lengthDelimited!==!1&&d.fork(),h.messages!=null)for(const ft of h.messages)d.uint32(18),WakuMessage.codec().encode(ft,d);h.pagingInfo!=null&&(d.uint32(26),PagingInfo.codec().encode(h.pagingInfo,d)),h.error!=null&&a[h.error]!==0&&(d.uint32(32),i.HistoryError.codec().encode(h.error,d)),et.lengthDelimited!==!1&&d.ldelim()},(h,d)=>{const et={messages:[],error:e.NONE},ft=d==null?h.len:h.pos+d;for(;h.pos<ft;){const gt=h.uint32();switch(gt>>>3){case 2:et.messages.push(WakuMessage.codec().decode(h,h.uint32()));break;case 3:et.pagingInfo=PagingInfo.codec().decode(h,h.uint32());break;case 4:et.error=i.HistoryError.codec().decode(h);break;default:h.skipType(gt&7);break}}return et})),c),i.encode=h=>encodeMessage(h,i.codec()),i.decode=h=>decodeMessage$1(h,i.codec())})(HistoryResponse||(HistoryResponse={}));var HistoryRpc$1;(function(i){let e;i.codec=()=>(e==null&&(e=message((a,c,h={})=>{h.lengthDelimited!==!1&&c.fork(),a.requestId!=null&&a.requestId!==""&&(c.uint32(10),c.string(a.requestId)),a.query!=null&&(c.uint32(18),HistoryQuery.codec().encode(a.query,c)),a.response!=null&&(c.uint32(26),HistoryResponse.codec().encode(a.response,c)),h.lengthDelimited!==!1&&c.ldelim()},(a,c)=>{const h={requestId:""},d=c==null?a.len:a.pos+c;for(;a.pos<d;){const et=a.uint32();switch(et>>>3){case 1:h.requestId=a.string();break;case 2:h.query=HistoryQuery.codec().decode(a,a.uint32());break;case 3:h.response=HistoryResponse.codec().decode(a,a.uint32());break;default:a.skipType(et&7);break}}return h})),e),i.encode=a=>encodeMessage(a,i.codec()),i.decode=a=>decodeMessage$1(a,i.codec())})(HistoryRpc$1||(HistoryRpc$1={}));var RateLimitProof;(function(i){let e;i.codec=()=>(e==null&&(e=message((a,c,h={})=>{h.lengthDelimited!==!1&&c.fork(),a.proof!=null&&a.proof.byteLength>0&&(c.uint32(10),c.bytes(a.proof)),a.merkleRoot!=null&&a.merkleRoot.byteLength>0&&(c.uint32(18),c.bytes(a.merkleRoot)),a.epoch!=null&&a.epoch.byteLength>0&&(c.uint32(26),c.bytes(a.epoch)),a.shareX!=null&&a.shareX.byteLength>0&&(c.uint32(34),c.bytes(a.shareX)),a.shareY!=null&&a.shareY.byteLength>0&&(c.uint32(42),c.bytes(a.shareY)),a.nullifier!=null&&a.nullifier.byteLength>0&&(c.uint32(50),c.bytes(a.nullifier)),a.rlnIdentifier!=null&&a.rlnIdentifier.byteLength>0&&(c.uint32(58),c.bytes(a.rlnIdentifier)),h.lengthDelimited!==!1&&c.ldelim()},(a,c)=>{const h={proof:new Uint8Array(0),merkleRoot:new Uint8Array(0),epoch:new Uint8Array(0),shareX:new Uint8Array(0),shareY:new Uint8Array(0),nullifier:new Uint8Array(0),rlnIdentifier:new Uint8Array(0)},d=c==null?a.len:a.pos+c;for(;a.pos<d;){const et=a.uint32();switch(et>>>3){case 1:h.proof=a.bytes();break;case 2:h.merkleRoot=a.bytes();break;case 3:h.epoch=a.bytes();break;case 4:h.shareX=a.bytes();break;case 5:h.shareY=a.bytes();break;case 6:h.nullifier=a.bytes();break;case 7:h.rlnIdentifier=a.bytes();break;default:a.skipType(et&7);break}}return h})),e),i.encode=a=>encodeMessage(a,i.codec()),i.decode=a=>decodeMessage$1(a,i.codec())})(RateLimitProof||(RateLimitProof={}));var WakuMessage;(function(i){let e;i.codec=()=>(e==null&&(e=message((a,c,h={})=>{h.lengthDelimited!==!1&&c.fork(),a.payload!=null&&a.payload.byteLength>0&&(c.uint32(10),c.bytes(a.payload)),a.contentTopic!=null&&a.contentTopic!==""&&(c.uint32(18),c.string(a.contentTopic)),a.version!=null&&(c.uint32(24),c.uint32(a.version)),a.timestamp!=null&&(c.uint32(80),c.sint64(a.timestamp)),a.meta!=null&&(c.uint32(90),c.bytes(a.meta)),a.rateLimitProof!=null&&(c.uint32(170),RateLimitProof.codec().encode(a.rateLimitProof,c)),a.ephemeral!=null&&(c.uint32(248),c.bool(a.ephemeral)),h.lengthDelimited!==!1&&c.ldelim()},(a,c)=>{const h={payload:new Uint8Array(0),contentTopic:""},d=c==null?a.len:a.pos+c;for(;a.pos<d;){const et=a.uint32();switch(et>>>3){case 1:h.payload=a.bytes();break;case 2:h.contentTopic=a.string();break;case 3:h.version=a.uint32();break;case 10:h.timestamp=a.sint64();break;case 11:h.meta=a.bytes();break;case 21:h.rateLimitProof=RateLimitProof.codec().decode(a,a.uint32());break;case 31:h.ephemeral=a.bool();break;default:a.skipType(et&7);break}}return h})),e),i.encode=a=>encodeMessage(a,i.codec()),i.decode=a=>decodeMessage$1(a,i.codec())})(WakuMessage||(WakuMessage={}));var PeerInfo;(function(i){let e;i.codec=()=>(e==null&&(e=message((a,c,h={})=>{h.lengthDelimited!==!1&&c.fork(),a.enr!=null&&(c.uint32(10),c.bytes(a.enr)),h.lengthDelimited!==!1&&c.ldelim()},(a,c)=>{const h={},d=c==null?a.len:a.pos+c;for(;a.pos<d;){const et=a.uint32();switch(et>>>3){case 1:h.enr=a.bytes();break;default:a.skipType(et&7);break}}return h})),e),i.encode=a=>encodeMessage(a,i.codec()),i.decode=a=>decodeMessage$1(a,i.codec())})(PeerInfo||(PeerInfo={}));var PeerExchangeQuery;(function(i){let e;i.codec=()=>(e==null&&(e=message((a,c,h={})=>{h.lengthDelimited!==!1&&c.fork(),a.numPeers!=null&&(c.uint32(8),c.uint64(a.numPeers)),h.lengthDelimited!==!1&&c.ldelim()},(a,c)=>{const h={},d=c==null?a.len:a.pos+c;for(;a.pos<d;){const et=a.uint32();switch(et>>>3){case 1:h.numPeers=a.uint64();break;default:a.skipType(et&7);break}}return h})),e),i.encode=a=>encodeMessage(a,i.codec()),i.decode=a=>decodeMessage$1(a,i.codec())})(PeerExchangeQuery||(PeerExchangeQuery={}));var PeerExchangeResponse;(function(i){let e;i.codec=()=>(e==null&&(e=message((a,c,h={})=>{if(h.lengthDelimited!==!1&&c.fork(),a.peerInfos!=null)for(const d of a.peerInfos)c.uint32(10),PeerInfo.codec().encode(d,c);h.lengthDelimited!==!1&&c.ldelim()},(a,c)=>{const h={peerInfos:[]},d=c==null?a.len:a.pos+c;for(;a.pos<d;){const et=a.uint32();switch(et>>>3){case 1:h.peerInfos.push(PeerInfo.codec().decode(a,a.uint32()));break;default:a.skipType(et&7);break}}return h})),e),i.encode=a=>encodeMessage(a,i.codec()),i.decode=a=>decodeMessage$1(a,i.codec())})(PeerExchangeResponse||(PeerExchangeResponse={}));var PeerExchangeRPC$1;(function(i){let e;i.codec=()=>(e==null&&(e=message((a,c,h={})=>{h.lengthDelimited!==!1&&c.fork(),a.query!=null&&(c.uint32(10),PeerExchangeQuery.codec().encode(a.query,c)),a.response!=null&&(c.uint32(18),PeerExchangeResponse.codec().encode(a.response,c)),h.lengthDelimited!==!1&&c.ldelim()},(a,c)=>{const h={},d=c==null?a.len:a.pos+c;for(;a.pos<d;){const et=a.uint32();switch(et>>>3){case 1:h.query=PeerExchangeQuery.codec().decode(a,a.uint32());break;case 2:h.response=PeerExchangeResponse.codec().decode(a,a.uint32());break;default:a.skipType(et&7);break}}return h})),e),i.encode=a=>encodeMessage(a,i.codec()),i.decode=a=>decodeMessage$1(a,i.codec())})(PeerExchangeRPC$1||(PeerExchangeRPC$1={}));var WakuMetadataRequest;(function(i){let e;i.codec=()=>(e==null&&(e=message((a,c,h={})=>{if(h.lengthDelimited!==!1&&c.fork(),a.clusterId!=null&&(c.uint32(8),c.uint32(a.clusterId)),a.shards!=null)for(const d of a.shards)c.uint32(16),c.uint32(d);h.lengthDelimited!==!1&&c.ldelim()},(a,c)=>{const h={shards:[]},d=c==null?a.len:a.pos+c;for(;a.pos<d;){const et=a.uint32();switch(et>>>3){case 1:h.clusterId=a.uint32();break;case 2:h.shards.push(a.uint32());break;default:a.skipType(et&7);break}}return h})),e),i.encode=a=>encodeMessage(a,i.codec()),i.decode=a=>decodeMessage$1(a,i.codec())})(WakuMetadataRequest||(WakuMetadataRequest={}));var WakuMetadataResponse;(function(i){let e;i.codec=()=>(e==null&&(e=message((a,c,h={})=>{if(h.lengthDelimited!==!1&&c.fork(),a.clusterId!=null&&(c.uint32(8),c.uint32(a.clusterId)),a.shards!=null)for(const d of a.shards)c.uint32(16),c.uint32(d);h.lengthDelimited!==!1&&c.ldelim()},(a,c)=>{const h={shards:[]},d=c==null?a.len:a.pos+c;for(;a.pos<d;){const et=a.uint32();switch(et>>>3){case 1:h.clusterId=a.uint32();break;case 2:h.shards.push(a.uint32());break;default:a.skipType(et&7);break}}return h})),e),i.encode=a=>encodeMessage(a,i.codec()),i.decode=a=>decodeMessage$1(a,i.codec())})(WakuMetadataResponse||(WakuMetadataResponse={}));const log$x=new Logger$2("message:version-0"),OneMillion$1=BigInt(1e6),Version=0;class DecodedMessage{constructor(e,a){qt(this,"pubsubTopic");qt(this,"proto");this.pubsubTopic=e,this.proto=a}get ephemeral(){return!!this.proto.ephemeral}get payload(){return this.proto.payload}get contentTopic(){return this.proto.contentTopic}get _rawTimestamp(){return this.proto.timestamp}get timestamp(){try{if(this.proto.timestamp){const e=this.proto.timestamp/OneMillion$1;return new Date(Number(e))}return}catch{return}}get meta(){return this.proto.meta}get version(){return this.proto.version??0}get rateLimitProof(){return this.proto.rateLimitProof}}let Encoder$5=class{constructor(e,a=!1,c,h){qt(this,"contentTopic");qt(this,"ephemeral");qt(this,"pubsubTopic");qt(this,"metaSetter");if(this.contentTopic=e,this.ephemeral=a,this.pubsubTopic=c,this.metaSetter=h,!e||e==="")throw new Error("Content topic must be specified")}async toWire(e){return WakuMessage$4.encode(await this.toProtoObj(e))}async toProtoObj(e){const a=e.timestamp??new Date,c={payload:e.payload,version:Version,contentTopic:this.contentTopic,timestamp:BigInt(a.valueOf())*OneMillion$1,meta:void 0,rateLimitProof:e.rateLimitProof,ephemeral:this.ephemeral};if(this.metaSetter){const h=this.metaSetter(c);return{...c,meta:h}}return c}};function createEncoder({pubsubTopic:i,pubsubTopicShardInfo:e,contentTopic:a,ephemeral:c,metaSetter:h}){return new Encoder$5(a,c,determinePubsubTopic(a,i??e),h)}let Decoder$5=class{constructor(e,a){qt(this,"pubsubTopic");qt(this,"contentTopic");if(this.pubsubTopic=e,this.contentTopic=a,!a||a==="")throw new Error("Content topic must be specified")}fromWireToProtoObj(e){const a=WakuMessage$4.decode(e);return Promise.resolve({payload:a.payload,contentTopic:a.contentTopic,version:a.version??void 0,timestamp:a.timestamp??void 0,meta:a.meta??void 0,rateLimitProof:a.rateLimitProof??void 0,ephemeral:a.ephemeral??!1})}async fromProtoObj(e,a){return a.version??Version!==0?(log$x.error("Failed to decode due to incorrect version, expected:",Version,", actual:",a.version),Promise.resolve(void 0)):new DecodedMessage(e,a)}};function createDecoder(i,e){return new Decoder$5(determinePubsubTopic(i,e),i)}const RelayPingContentTopic="/relay-ping/1/ping/null",log$w=new Logger$2("keep-alive");class KeepAliveManager{constructor(e,a){qt(this,"pingKeepAliveTimers");qt(this,"relayKeepAliveTimers");qt(this,"options");qt(this,"relay");this.pingKeepAliveTimers=new Map,this.relayKeepAliveTimers=new Map,this.options=e,this.relay=a}start(e,a,c){this.stop(e);const{pingKeepAlive:h,relayKeepAlive:d}=this.options,et=e.toString();if(h!==0){const gt=setInterval(()=>{(async()=>{let _t;try{try{_t=await a.ping(e),log$w.info(`Ping succeeded (${et})`,_t)}catch{log$w.error(`Ping failed for peer (${et}).
                Next ping will be attempted in ${h} seconds.
              `);return}try{await c.patch(e,{metadata:{ping:utf8ToBytes$1(_t.toString())}})}catch(wt){log$w.error("Failed to update ping",wt)}}catch(wt){log$w.error(`Ping failed (${et})`,wt)}})()},h*1e3);this.pingKeepAliveTimers.set(et,gt)}const ft=this.relay;if(ft&&d!==0){const gt=this.scheduleRelayPings(ft,d,e.toString());this.relayKeepAliveTimers.set(e,gt)}}stop(e){var c;const a=e.toString();this.pingKeepAliveTimers.has(a)&&(clearInterval(this.pingKeepAliveTimers.get(a)),this.pingKeepAliveTimers.delete(a)),this.relayKeepAliveTimers.has(e)&&((c=this.relayKeepAliveTimers.get(e))==null||c.map(clearInterval),this.relayKeepAliveTimers.delete(e))}stopAll(){for(const e of[...Object.values(this.pingKeepAliveTimers),...Object.values(this.relayKeepAliveTimers)])clearInterval(e);this.pingKeepAliveTimers.clear(),this.relayKeepAliveTimers.clear()}connectionsExist(){return this.pingKeepAliveTimers.size>0||this.relayKeepAliveTimers.size>0}scheduleRelayPings(e,a,c){const h=[];for(const d of e.pubsubTopics){if(!e.getMeshPeers(d).includes(c))continue;const ft=createEncoder({pubsubTopicShardInfo:pubsubTopicToSingleShardInfo(d),contentTopic:RelayPingContentTopic,ephemeral:!0}),gt=setInterval(()=>{log$w.info("Sending Waku Relay ping message"),e.send(ft,{payload:new Uint8Array([1])}).catch(_t=>log$w.error("Failed to send relay ping",_t))},a*1e3);h.push(gt)}return h}}const log$v=new Logger$2("connection-manager"),DEFAULT_MAX_BOOTSTRAP_PEERS_ALLOWED=1,DEFAULT_MAX_DIAL_ATTEMPTS_FOR_PEER=3,DEFAULT_MAX_PARALLEL_DIALS=3,Bs=class Bs extends EventEmitter$2{constructor(a,c,h,d,et){super();qt(this,"configuredPubsubTopics");qt(this,"keepAliveManager");qt(this,"options");qt(this,"libp2p");qt(this,"dialAttemptsForPeer",new Map);qt(this,"dialErrorsForPeer",new Map);qt(this,"currentActiveParallelDialCount",0);qt(this,"pendingPeerDialQueue",[]);qt(this,"online",!1);qt(this,"onEventHandlers",{"peer:discovery":a=>{(async()=>{const{id:c}=a.detail;await this.dispatchDiscoveryEvent(c);try{await this.attemptDial(c)}catch(h){log$v.error(`Error dialing peer ${c.toString()} : ${h}`)}})()},"peer:connect":a=>{(async()=>{const c=a.detail;this.keepAliveManager.start(c,this.libp2p.services.ping,this.libp2p.peerStore),(await this.getTagNamesForPeer(c)).includes(Tags.BOOTSTRAP)?this.libp2p.getConnections().filter(et=>et.tags.includes(Tags.BOOTSTRAP)).length>this.options.maxBootstrapPeersAllowed?await this.dropConnection(c):this.dispatchEvent(new CustomEvent$1(EPeersByDiscoveryEvents.PEER_CONNECT_BOOTSTRAP,{detail:c})):this.dispatchEvent(new CustomEvent$1(EPeersByDiscoveryEvents.PEER_CONNECT_PEER_EXCHANGE,{detail:c})),this.toggleOnline()})()},"peer:disconnect":a=>{(async()=>(this.keepAliveManager.stop(a.detail),this.toggleOffline()))()}});this.configuredPubsubTopics=h,this.libp2p=a,this.configuredPubsubTopics=h,this.options={maxDialAttemptsForPeer:DEFAULT_MAX_DIAL_ATTEMPTS_FOR_PEER,maxBootstrapPeersAllowed:DEFAULT_MAX_BOOTSTRAP_PEERS_ALLOWED,maxParallelDials:DEFAULT_MAX_PARALLEL_DIALS,...et},this.keepAliveManager=new KeepAliveManager(c,d),this.run().then(()=>log$v.info("Connection Manager is now running")).catch(ft=>log$v.error("Unexpected error while running service",ft)),this.dialPeerStorePeers().catch(ft=>log$v.error("Unexpected error while dialing peer store peers",ft))}isConnected(){return this.online}toggleOnline(){this.online||(this.online=!0,this.dispatchEvent(new CustomEvent$1(EConnectionStateEvents.CONNECTION_STATUS,{detail:this.online})))}toggleOffline(){this.online&&this.libp2p.getConnections().length==0&&(this.online=!1,this.dispatchEvent(new CustomEvent$1(EConnectionStateEvents.CONNECTION_STATUS,{detail:this.online})))}static create(a,c,h,d,et,ft){let gt=Bs.instances.get(a);return gt||(gt=new Bs(c,h,d,et,ft),Bs.instances.set(a,gt)),gt}async getPeersByDiscovery(){const a=await this.libp2p.peerStore.all(),c=this.libp2p.getConnections().map(gt=>gt.remotePeer),h=[],d=[],et=[],ft=[];for(const gt of a){const _t=await this.getTagNamesForPeer(gt.id);_t.includes(Tags.BOOTSTRAP)?h.push(gt):_t.includes(Tags.PEER_EXCHANGE)&&d.push(gt)}for(const gt of c){const _t=await this.libp2p.peerStore.get(gt),wt=await this.getTagNamesForPeer(gt);wt.includes(Tags.BOOTSTRAP)?et.push(_t):wt.includes(Tags.PEER_EXCHANGE)&&ft.push(_t)}return{DISCOVERED:{[Tags.BOOTSTRAP]:h,[Tags.PEER_EXCHANGE]:d},CONNECTED:{[Tags.BOOTSTRAP]:et,[Tags.PEER_EXCHANGE]:ft}}}async dialPeerStorePeers(){const a=await this.libp2p.peerStore.all(),c=[];for(const h of a)this.libp2p.getConnections().find(d=>d.remotePeer===h.id)||c.push(this.attemptDial(h.id));try{await Promise.all(c)}catch(h){log$v.error("Unexpected error while dialing peer store peers",h)}}async run(){this.startPeerDiscoveryListener(),this.startPeerConnectionListener(),this.startPeerDisconnectionListener()}stop(){this.keepAliveManager.stopAll(),this.libp2p.removeEventListener("peer:connect",this.onEventHandlers["peer:connect"]),this.libp2p.removeEventListener("peer:disconnect",this.onEventHandlers["peer:disconnect"]),this.libp2p.removeEventListener("peer:discovery",this.onEventHandlers["peer:discovery"])}async dialPeer(a){this.currentActiveParallelDialCount+=1;let c=0;for(;c<this.options.maxDialAttemptsForPeer;)try{log$v.info(`Dialing peer ${a.toString()} on attempt ${c+1}`),await this.libp2p.dial(a);const h=await this.getTagNamesForPeer(a);this.libp2p.getConnections(a).forEach(d=>{d.tags=Array.from(new Set([...d.tags,...h]))}),this.dialAttemptsForPeer.set(a.toString(),-1);break}catch(h){h instanceof AggregateError?log$v.error(`Error dialing peer ${a.toString()} - ${h.errors}`):log$v.error(`Error dialing peer ${a.toString()} - ${h.message}`),this.dialErrorsForPeer.set(a.toString(),h),c++,this.dialAttemptsForPeer.set(a.toString(),c)}if(this.currentActiveParallelDialCount--,this.processDialQueue(),c===this.options.maxDialAttemptsForPeer)try{const h=this.dialErrorsForPeer.get(a.toString());if(h){let d;h instanceof AggregateError?h.errors?h.errors.length===0?log$v.warn("Errors array is empty for AggregateError"):d=JSON.stringify(h.errors[0]):log$v.warn("No errors array found for AggregateError"):d=h.message,log$v.info(`Deleting undialable peer ${a.toString()} from peer store. Reason: ${d}`)}this.dialErrorsForPeer.delete(a.toString()),await this.libp2p.peerStore.delete(a)}catch(h){throw new Error(`Error deleting undialable peer ${a.toString()} from peer store - ${h}`)}}async dropConnection(a){try{this.keepAliveManager.stop(a),await this.libp2p.hangUp(a),log$v.info(`Dropped connection with peer ${a.toString()}`)}catch(c){log$v.error(`Error dropping connection with peer ${a.toString()} - ${c}`)}}processDialQueue(){if(this.pendingPeerDialQueue.length>0&&this.currentActiveParallelDialCount<this.options.maxParallelDials){const a=this.pendingPeerDialQueue.shift();if(!a)return;this.attemptDial(a).catch(c=>{log$v.error(c)})}}startPeerDiscoveryListener(){this.libp2p.addEventListener("peer:discovery",this.onEventHandlers["peer:discovery"])}startPeerConnectionListener(){this.libp2p.addEventListener("peer:connect",this.onEventHandlers["peer:connect"])}startPeerDisconnectionListener(){this.libp2p.addEventListener("peer:disconnect",this.onEventHandlers["peer:disconnect"])}async attemptDial(a){if(await this.shouldDialPeer(a)){if(this.currentActiveParallelDialCount>=this.options.maxParallelDials){this.pendingPeerDialQueue.push(a);return}this.dialPeer(a).catch(c=>{log$v.error(`Error dialing peer ${a.toString()} : ${c}`)})}}async shouldDialPeer(a){if(this.libp2p.getConnections(a).length>0)return log$v.warn(`Already connected to peer ${a.toString()}. Not dialing.`),!1;if(!await this.isPeerTopicConfigured(a)){const h=await this.getPeerShardInfo(a,this.libp2p.peerStore);return log$v.warn(`Discovered peer ${a.toString()} with ShardInfo ${h} is not part of any of the configured pubsub topics (${this.configuredPubsubTopics}).
            Not dialing.`),!1}return await this.isPeerDialableBasedOnBootstrapStatus(a)?this.dialAttemptsForPeer.has(a.toString())?(log$v.warn(`Peer ${a.toString()} has already been attempted dial before, or already has a dial attempt in progress, skipping dial`),!1):!0:(log$v.warn(`Peer ${a.toString()} is not dialable based on bootstrap status. Not dialing.`),!1)}async isPeerDialableBasedOnBootstrapStatus(a){if((await this.getTagNamesForPeer(a)).some(d=>d===Tags.BOOTSTRAP)){if(this.libp2p.getConnections().filter(et=>et.tags.find(ft=>ft===Tags.BOOTSTRAP)).length<this.options.maxBootstrapPeersAllowed)return!0}else return!0;return!1}async dispatchDiscoveryEvent(a){const c=(await this.getTagNamesForPeer(a)).includes(Tags.BOOTSTRAP);this.dispatchEvent(new CustomEvent$1(c?EPeersByDiscoveryEvents.PEER_DISCOVERY_BOOTSTRAP:EPeersByDiscoveryEvents.PEER_DISCOVERY_PEER_EXCHANGE,{detail:a}))}async getTagNamesForPeer(a){try{const c=await this.libp2p.peerStore.get(a);return Array.from(c.tags.keys())}catch(c){return log$v.error(`Failed to get peer ${a}, error: ${c}`),[]}}async isPeerTopicConfigured(a){const c=await this.getPeerShardInfo(a,this.libp2p.peerStore);return c?shardInfoToPubsubTopics(c).some(et=>this.configuredPubsubTopics.includes(et)):!0}async getPeerShardInfo(a,c){const d=(await c.get(a)).metadata.get("shardInfo");if(d)return decodeRelayShard(d)}};qt(Bs,"instances",new Map);let ConnectionManager=Bs;const DefaultPingKeepAliveValueSecs=5*60,DefaultRelayKeepAliveValueSecs=5*60,DefaultUserAgent="js-waku",log$u=new Logger$2("waku");class WakuNode{constructor(e,a=[],c,h,d,et,ft,gt){qt(this,"libp2p");qt(this,"relay");qt(this,"store");qt(this,"filter");qt(this,"lightPush");qt(this,"connectionManager");qt(this,"pubsubTopics");h?this.pubsubTopics=shardInfoToPubsubTopics(h):this.pubsubTopics=a.length>0?a:[DefaultPubsubTopic],this.libp2p=c,d&&(this.store=d(c)),ft&&(this.filter=ft(c)),et&&(this.lightPush=et(c)),gt&&(this.relay=gt(c));const _t=e.pingKeepAlive||DefaultPingKeepAliveValueSecs,wt=this.relay?e.relayKeepAlive||DefaultRelayKeepAliveValueSecs:0,$t=this.libp2p.peerId.toString();this.connectionManager=ConnectionManager.create($t,c,{pingKeepAlive:_t,relayKeepAlive:wt},this.pubsubTopics,this.relay),log$u.info("Waku node created",$t,`relay: ${!!this.relay}, store: ${!!this.store}, light push: ${!!this.lightPush}, filter: ${!!this.filter}`)}async dial(e,a){const c=a??[],h=mapToPeerIdOrMultiaddr(e);typeof a>"u"&&(this.relay&&c.push(Protocols$1.Relay),this.store&&c.push(Protocols$1.Store),this.filter&&c.push(Protocols$1.Filter),this.lightPush&&c.push(Protocols$1.LightPush));const d=[];return c.includes(Protocols$1.Relay)&&(this.relay?this.relay.gossipSub.multicodecs.forEach(et=>d.push(et)):log$u.error("Relay codec not included in dial codec: protocol not mounted locally")),c.includes(Protocols$1.Store)&&(this.store?d.push(this.store.multicodec):log$u.error("Store codec not included in dial codec: protocol not mounted locally")),c.includes(Protocols$1.LightPush)&&(this.lightPush?d.push(this.lightPush.multicodec):log$u.error("Light Push codec not included in dial codec: protocol not mounted locally")),c.includes(Protocols$1.Filter)&&(this.filter?d.push(this.filter.multicodec):log$u.error("Filter codec not included in dial codec: protocol not mounted locally")),log$u.info(`Dialing to ${h.toString()} with protocols ${c}`),this.libp2p.dialProtocol(h,d)}async start(){await this.libp2p.start()}async stop(){this.connectionManager.stop(),await this.libp2p.stop()}isStarted(){return this.libp2p.isStarted()}isConnected(){return this.connectionManager.isConnected()}getLocalMultiaddrWithID(){const e=this.libp2p.getMultiaddrs().find(a=>a.toString().match(/127\.0\.0\.1/));if(!e||e.toString()==="")throw"Not listening on localhost";return e+"/p2p/"+this.libp2p.peerId.toString()}}function mapToPeerIdOrMultiaddr(i){return isPeerId(i)?i:multiaddr(i)}function isAsyncIterable$a(i){return i[Symbol.asyncIterator]!=null}function all$1(i){if(isAsyncIterable$a(i))return(async()=>{const a=[];for await(const c of i)a.push(c);return a})();const e=[];for(const a of i)e.push(a);return e}function alloc$1(i=0){return new Uint8Array(i)}function allocUnsafe$5(i=0){return new Uint8Array(i)}function asUint8Array(i){return i}function concat$1(i,e){e==null&&(e=i.reduce((h,d)=>h+d.length,0));const a=allocUnsafe$5(e);let c=0;for(const h of i)a.set(h,c),c+=h.length;return a}function equals(i,e){if(i===e)return!0;if(i.byteLength!==e.byteLength)return!1;for(let a=0;a<i.byteLength;a++)if(i[a]!==e[a])return!1;return!0}const symbol$2=Symbol.for("@achingbrain/uint8arraylist");function findBufAndOffset(i,e){if(e==null||e<0)throw new RangeError("index is out of bounds");let a=0;for(const c of i){const h=a+c.byteLength;if(e<h)return{buf:c,index:e-a};a=h}throw new RangeError("index is out of bounds")}function isUint8ArrayList(i){return!!(i!=null&&i[symbol$2])}var Cp;class Uint8ArrayList{constructor(...e){qt(this,"bufs");qt(this,"length");qt(this,Cp,!0);this.bufs=[],this.length=0,e.length>0&&this.appendAll(e)}*[(Cp=symbol$2,Symbol.iterator)](){yield*this.bufs}get byteLength(){return this.length}append(...e){this.appendAll(e)}appendAll(e){let a=0;for(const c of e)if(c instanceof Uint8Array)a+=c.byteLength,this.bufs.push(c);else if(isUint8ArrayList(c))a+=c.byteLength,this.bufs.push(...c.bufs);else throw new Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");this.length+=a}prepend(...e){this.prependAll(e)}prependAll(e){let a=0;for(const c of e.reverse())if(c instanceof Uint8Array)a+=c.byteLength,this.bufs.unshift(c);else if(isUint8ArrayList(c))a+=c.byteLength,this.bufs.unshift(...c.bufs);else throw new Error("Could not prepend value, must be an Uint8Array or a Uint8ArrayList");this.length+=a}get(e){const a=findBufAndOffset(this.bufs,e);return a.buf[a.index]}set(e,a){const c=findBufAndOffset(this.bufs,e);c.buf[c.index]=a}write(e,a=0){if(e instanceof Uint8Array)for(let c=0;c<e.length;c++)this.set(a+c,e[c]);else if(isUint8ArrayList(e))for(let c=0;c<e.length;c++)this.set(a+c,e.get(c));else throw new Error("Could not write value, must be an Uint8Array or a Uint8ArrayList")}consume(e){if(e=Math.trunc(e),!(Number.isNaN(e)||e<=0)){if(e===this.byteLength){this.bufs=[],this.length=0;return}for(;this.bufs.length>0;)if(e>=this.bufs[0].byteLength)e-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift();else{this.bufs[0]=this.bufs[0].subarray(e),this.length-=e;break}}}slice(e,a){const{bufs:c,length:h}=this._subList(e,a);return concat$1(c,h)}subarray(e,a){const{bufs:c,length:h}=this._subList(e,a);return c.length===1?c[0]:concat$1(c,h)}sublist(e,a){const{bufs:c,length:h}=this._subList(e,a),d=new Uint8ArrayList;return d.length=h,d.bufs=[...c],d}_subList(e,a){if(e=e??0,a=a??this.length,e<0&&(e=this.length+e),a<0&&(a=this.length+a),e<0||a>this.length)throw new RangeError("index is out of bounds");if(e===a)return{bufs:[],length:0};if(e===0&&a===this.length)return{bufs:this.bufs,length:this.length};const c=[];let h=0;for(let d=0;d<this.bufs.length;d++){const et=this.bufs[d],ft=h,gt=ft+et.byteLength;if(h=gt,e>=gt)continue;const _t=e>=ft&&e<gt,wt=a>ft&&a<=gt;if(_t&&wt){if(e===ft&&a===gt){c.push(et);break}const $t=e-ft;c.push(et.subarray($t,$t+(a-e)));break}if(_t){if(e===0){c.push(et);continue}c.push(et.subarray(e-ft));continue}if(wt){if(a===gt){c.push(et);break}c.push(et.subarray(0,a-ft));break}c.push(et)}return{bufs:c,length:a-e}}indexOf(e,a=0){if(!isUint8ArrayList(e)&&!(e instanceof Uint8Array))throw new TypeError('The "value" argument must be a Uint8ArrayList or Uint8Array');const c=e instanceof Uint8Array?e:e.subarray();if(a=Number(a??0),isNaN(a)&&(a=0),a<0&&(a=this.length+a),a<0&&(a=0),e.length===0)return a>this.length?this.length:a;const h=c.byteLength;if(h===0)throw new TypeError("search must be at least 1 byte long");const d=256,et=new Int32Array(d);for(let $t=0;$t<d;$t++)et[$t]=-1;for(let $t=0;$t<h;$t++)et[c[$t]]=$t;const ft=et,gt=this.byteLength-c.byteLength,_t=c.byteLength-1;let wt;for(let $t=a;$t<=gt;$t+=wt){wt=0;for(let It=_t;It>=0;It--){const Rt=this.get($t+It);if(c[It]!==Rt){wt=Math.max(1,It-ft[Rt]);break}}if(wt===0)return $t}return-1}getInt8(e){const a=this.subarray(e,e+1);return new DataView(a.buffer,a.byteOffset,a.byteLength).getInt8(0)}setInt8(e,a){const c=allocUnsafe$5(1);new DataView(c.buffer,c.byteOffset,c.byteLength).setInt8(0,a),this.write(c,e)}getInt16(e,a){const c=this.subarray(e,e+2);return new DataView(c.buffer,c.byteOffset,c.byteLength).getInt16(0,a)}setInt16(e,a,c){const h=alloc$1(2);new DataView(h.buffer,h.byteOffset,h.byteLength).setInt16(0,a,c),this.write(h,e)}getInt32(e,a){const c=this.subarray(e,e+4);return new DataView(c.buffer,c.byteOffset,c.byteLength).getInt32(0,a)}setInt32(e,a,c){const h=alloc$1(4);new DataView(h.buffer,h.byteOffset,h.byteLength).setInt32(0,a,c),this.write(h,e)}getBigInt64(e,a){const c=this.subarray(e,e+8);return new DataView(c.buffer,c.byteOffset,c.byteLength).getBigInt64(0,a)}setBigInt64(e,a,c){const h=alloc$1(8);new DataView(h.buffer,h.byteOffset,h.byteLength).setBigInt64(0,a,c),this.write(h,e)}getUint8(e){const a=this.subarray(e,e+1);return new DataView(a.buffer,a.byteOffset,a.byteLength).getUint8(0)}setUint8(e,a){const c=allocUnsafe$5(1);new DataView(c.buffer,c.byteOffset,c.byteLength).setUint8(0,a),this.write(c,e)}getUint16(e,a){const c=this.subarray(e,e+2);return new DataView(c.buffer,c.byteOffset,c.byteLength).getUint16(0,a)}setUint16(e,a,c){const h=alloc$1(2);new DataView(h.buffer,h.byteOffset,h.byteLength).setUint16(0,a,c),this.write(h,e)}getUint32(e,a){const c=this.subarray(e,e+4);return new DataView(c.buffer,c.byteOffset,c.byteLength).getUint32(0,a)}setUint32(e,a,c){const h=alloc$1(4);new DataView(h.buffer,h.byteOffset,h.byteLength).setUint32(0,a,c),this.write(h,e)}getBigUint64(e,a){const c=this.subarray(e,e+8);return new DataView(c.buffer,c.byteOffset,c.byteLength).getBigUint64(0,a)}setBigUint64(e,a,c){const h=alloc$1(8);new DataView(h.buffer,h.byteOffset,h.byteLength).setBigUint64(0,a,c),this.write(h,e)}getFloat32(e,a){const c=this.subarray(e,e+4);return new DataView(c.buffer,c.byteOffset,c.byteLength).getFloat32(0,a)}setFloat32(e,a,c){const h=alloc$1(4);new DataView(h.buffer,h.byteOffset,h.byteLength).setFloat32(0,a,c),this.write(h,e)}getFloat64(e,a){const c=this.subarray(e,e+8);return new DataView(c.buffer,c.byteOffset,c.byteLength).getFloat64(0,a)}setFloat64(e,a,c){const h=alloc$1(8);new DataView(h.buffer,h.byteOffset,h.byteLength).setFloat64(0,a,c),this.write(h,e)}equals(e){if(e==null||!(e instanceof Uint8ArrayList)||e.bufs.length!==this.bufs.length)return!1;for(let a=0;a<this.bufs.length;a++)if(!equals(this.bufs[a],e.bufs[a]))return!1;return!0}static fromUint8Arrays(e,a){const c=new Uint8ArrayList;return c.bufs=e,a==null&&(a=e.reduce((h,d)=>h+d.byteLength,0)),c.length=a,c}}function allocUnsafe$4(i=0){return new Uint8Array(i)}function isAsyncIterable$9(i){return i[Symbol.asyncIterator]!=null}const defaultEncoder=i=>{const e=encodingLength$4(i),a=allocUnsafe$4(e);return encode$o(i,a),defaultEncoder.bytes=e,a};defaultEncoder.bytes=0;function encode$c(i,e){e=e??{};const a=e.lengthEncoder??defaultEncoder;function*c(h){const d=a(h.byteLength);d instanceof Uint8Array?yield d:yield*d,h instanceof Uint8Array?yield h:yield*h}return isAsyncIterable$9(i)?async function*(){for await(const h of i)yield*c(h)}():function*(){for(const h of i)yield*c(h)}()}encode$c.single=(i,e)=>{e=e??{};const a=e.lengthEncoder??defaultEncoder;return new Uint8ArrayList(a(i.byteLength),i)};function assign(i,e){for(const a in e)Object.defineProperty(i,a,{value:e[a],enumerable:!0,configurable:!0});return i}function createError(i,e,a){if(!i||typeof i=="string")throw new TypeError("Please pass an Error to err-code");a||(a={}),typeof e=="object"&&(a=e,e=""),e&&(a.code=e);try{return assign(i,a)}catch{a.message=i.message,a.stack=i.stack;const h=function(){};return h.prototype=Object.create(Object.getPrototypeOf(i)),assign(new h,a)}}var errCode=createError;const errCode$1=getDefaultExportFromCjs(errCode),MAX_LENGTH_LENGTH=8,MAX_DATA_LENGTH=1024*1024*4;var ReadMode;(function(i){i[i.LENGTH=0]="LENGTH",i[i.DATA=1]="DATA"})(ReadMode||(ReadMode={}));const defaultDecoder=i=>{const e=decode$n(i);return defaultDecoder.bytes=encodingLength$4(e),e};defaultDecoder.bytes=0;function decode$b(i,e){const a=new Uint8ArrayList;let c=ReadMode.LENGTH,h=-1;const d=(e==null?void 0:e.lengthDecoder)??defaultDecoder,et=(e==null?void 0:e.maxLengthLength)??MAX_LENGTH_LENGTH,ft=(e==null?void 0:e.maxDataLength)??MAX_DATA_LENGTH;function*gt(){for(;a.byteLength>0;){if(c===ReadMode.LENGTH)try{if(h=d(a),h<0)throw errCode$1(new Error("invalid message length"),"ERR_INVALID_MSG_LENGTH");if(h>ft)throw errCode$1(new Error("message length too long"),"ERR_MSG_DATA_TOO_LONG");const _t=d.bytes;a.consume(_t),(e==null?void 0:e.onLength)!=null&&e.onLength(h),c=ReadMode.DATA}catch(_t){if(_t instanceof RangeError){if(a.byteLength>et)throw errCode$1(new Error("message length length too long"),"ERR_MSG_LENGTH_TOO_LONG");break}throw _t}if(c===ReadMode.DATA){if(a.byteLength<h)break;const _t=a.sublist(0,h);a.consume(h),(e==null?void 0:e.onData)!=null&&e.onData(_t),yield _t,c=ReadMode.LENGTH}}}return isAsyncIterable$9(i)?async function*(){for await(const _t of i)a.append(_t),yield*gt();if(a.byteLength>0)throw errCode$1(new Error("unexpected end of input"),"ERR_UNEXPECTED_EOF")}():function*(){for(const _t of i)a.append(_t),yield*gt();if(a.byteLength>0)throw errCode$1(new Error("unexpected end of input"),"ERR_UNEXPECTED_EOF")}()}decode$b.fromReader=(i,e)=>{let a=1;const c=async function*(){for(;;)try{const{done:d,value:et}=await i.next(a);if(d===!0)return;et!=null&&(yield et)}catch(d){if(d.code==="ERR_UNDER_READ")return{done:!0,value:null};throw d}finally{a=1}}();return decode$b(c,{...e??{},onLength:d=>{a=d}})};function pDefer(){const i={};return i.promise=new Promise((e,a)=>{i.resolve=e,i.reject=a}),i}class FixedFIFO{constructor(e){qt(this,"buffer");qt(this,"mask");qt(this,"top");qt(this,"btm");qt(this,"next");if(!(e>0)||e-1&e)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];if(e!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return this.buffer[this.btm]===void 0}}class FIFO{constructor(e={}){qt(this,"size");qt(this,"hwm");qt(this,"head");qt(this,"tail");this.hwm=e.splitLimit??16,this.head=new FixedFIFO(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return(e==null?void 0:e.byteLength)!=null?e.byteLength:1}push(e){if((e==null?void 0:e.value)!=null&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){const a=this.head;this.head=a.next=new FixedFIFO(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(e===void 0&&this.tail.next!=null){const a=this.tail.next;this.tail.next=null,this.tail=a,e=this.tail.shift()}return(e==null?void 0:e.value)!=null&&(this.size-=this.calculateSize(e.value)),e}isEmpty(){return this.head.isEmpty()}}let AbortError$7=class extends Error{constructor(a,c){super(a??"The operation was aborted");qt(this,"type");qt(this,"code");this.type="aborted",this.code=c??"ABORT_ERR"}};function pushable$1(i={}){return _pushable(a=>{const c=a.shift();if(c==null)return{done:!0};if(c.error!=null)throw c.error;return{done:c.done===!0,value:c.value}},i)}function pushableV(i={}){return _pushable(a=>{let c;const h=[];for(;!a.isEmpty()&&(c=a.shift(),c!=null);){if(c.error!=null)throw c.error;c.done===!1&&h.push(c.value)}return c==null?{done:!0}:{done:c.done===!0,value:h}},i)}function _pushable(i,e){e=e??{};let a=e.onEnd,c=new FIFO,h,d,et,ft=pDefer();const gt=async()=>{try{return c.isEmpty()?et?{done:!0}:await new Promise((kt,xt)=>{d=Nt=>{d=null,c.push(Nt);try{kt(i(c))}catch(Ft){xt(Ft)}return h}}):i(c)}finally{c.isEmpty()&&queueMicrotask(()=>{ft.resolve(),ft=pDefer()})}},_t=kt=>d!=null?d(kt):(c.push(kt),h),wt=kt=>(c=new FIFO,d!=null?d({error:kt}):(c.push({error:kt}),h)),$t=kt=>{if(et)return h;if((e==null?void 0:e.objectMode)!==!0&&(kt==null?void 0:kt.byteLength)==null)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return _t({done:!1,value:kt})},It=kt=>et?h:(et=!0,kt!=null?wt(kt):_t({done:!0})),Rt=()=>(c=new FIFO,It(),{done:!0}),Tt=kt=>(It(kt),{done:!0});if(h={[Symbol.asyncIterator](){return this},next:gt,return:Rt,throw:Tt,push:$t,end:It,get readableLength(){return c.size},onEmpty:async kt=>{const xt=kt==null?void 0:kt.signal;if(xt==null||xt.throwIfAborted(),c.isEmpty())return;let Nt,Ft;xt!=null&&(Nt=new Promise((jt,Gt)=>{Ft=()=>{Gt(new AbortError$7)},xt.addEventListener("abort",Ft)}));try{await Promise.race([ft.promise,Nt])}finally{Ft!=null&&xt!=null&&(xt==null||xt.removeEventListener("abort",Ft))}}},a==null)return h;const At=h;return h={[Symbol.asyncIterator](){return this},next(){return At.next()},throw(kt){return At.throw(kt),a!=null&&(a(kt),a=void 0),{done:!0}},return(){return At.return(),a!=null&&(a(),a=void 0),{done:!0}},push:$t,end(kt){return At.end(kt),a!=null&&(a(kt),a=void 0),h},get readableLength(){return At.readableLength},onEmpty:kt=>At.onEmpty(kt)},h}function isAsyncIterable$8(i){return i[Symbol.asyncIterator]!=null}function merge$1(...i){const e=[];for(const a of i)isAsyncIterable$8(a)||e.push(a);return e.length===i.length?function*(){for(const a of e)yield*a}():async function*(){const a=pushable$1({objectMode:!0});Promise.resolve().then(async()=>{try{await Promise.all(i.map(async c=>{for await(const h of c)a.push(h)})),a.end()}catch(c){a.end(c)}}),yield*a}()}function pipe(i,...e){if(i==null)throw new Error("Empty pipeline");if(isDuplex(i)){const c=i;i=()=>c.source}else if(isIterable(i)||isAsyncIterable$7(i)){const c=i;i=()=>c}const a=[i,...e];if(a.length>1&&isDuplex(a[a.length-1])&&(a[a.length-1]=a[a.length-1].sink),a.length>2)for(let c=1;c<a.length-1;c++)isDuplex(a[c])&&(a[c]=duplexPipelineFn(a[c]));return rawPipe(...a)}const rawPipe=(...i)=>{let e;for(;i.length>0;)e=i.shift()(e);return e},isAsyncIterable$7=i=>(i==null?void 0:i[Symbol.asyncIterator])!=null,isIterable=i=>(i==null?void 0:i[Symbol.iterator])!=null,isDuplex=i=>i==null?!1:i.sink!=null&&i.source!=null,duplexPipelineFn=i=>e=>{const a=i.sink(e);if((a==null?void 0:a.then)!=null){const c=pushable$1({objectMode:!0});a.then(()=>{c.end()},et=>{c.end(et)});let h;const d=i.source;if(isAsyncIterable$7(d))h=async function*(){yield*d,c.end()};else if(isIterable(d))h=function*(){yield*d,c.end()};else throw new Error("Unknown duplex source type - must be Iterable or AsyncIterable");return merge$1(c,h())}return i.source};function selectRandomPeer(i){if(i.length===0)return;const e=Math.round(Math.random()*(i.length-1));return i[e]}async function selectLowestLatencyPeer(i,e){if(e.length===0)return;const c=(await Promise.all(e.map(async h=>{const d=(await i.get(h.id)).metadata.get("ping");if(!d)return{peer:h,ping:1/0};const et=Number(bytesToUtf8(d))??1/0;return{peer:h,ping:et}}))).sort((h,d)=>h.ping-d.ping)[0];if(c)return c.ping!==1/0?c.peer:void 0}async function getPeersForProtocol(i,e){const a=[];return await i.forEach(c=>{for(let h=0;h<e.length;h++)if(c.protocols.includes(e[h])){a.push(c);break}}),a}async function getConnectedPeersForProtocol(i,e,a){const h=i.filter(et=>et.status==="open").map(async et=>{const ft=await e.get(et.remotePeer);return ft.protocols.some(_t=>a.includes(_t))?ft:null});return(await Promise.all(h)).filter(et=>et!==null)}async function selectPeerForProtocol(i,e,a){let c;if(a){if(c=await i.get(a),!c)throw new Error(`Failed to retrieve connection details for provided peer in peer store: ${a.toString()}`)}else{const d=await getPeersForProtocol(i,e);if(c=await selectLowestLatencyPeer(i,d),!c&&(c=selectRandomPeer(d),!c))throw new Error(`Failed to find known peer that registers protocols: ${e}`)}let h;for(const d of e)c.protocols.includes(d)&&(h=d);if(!h)throw new Error(`Peer does not register required protocols (${c.id.toString()}): ${e}`);return{peer:c,protocol:h}}function selectConnection(i){if(!i.length)return;if(i.length===1)return i[0];let e;return i.forEach(a=>{a.status==="open"&&(e?a.timeline.open>e.timeline.open&&(e=a):e=a)}),e}async function filterPeers$1(i,e,a){const c=i.filter(et=>et.tags.has(Tags.BOOTSTRAP)).slice(0,a),h=i.filter(et=>!et.tags.has(Tags.BOOTSTRAP));if(e===0)return[...c,...h];const d=[...c];for(;d.length<e&&h.length>0;){const et=Math.floor(Math.random()*h.length),ft=h.splice(et,1)[0];d.push(ft)}return d}let StreamManager$1=class{constructor(e,a,c){qt(this,"multicodec");qt(this,"getConnections");qt(this,"addEventListener");qt(this,"streamPool");qt(this,"log");qt(this,"handlePeerUpdateStreamPool",e=>{const a=e.detail.peer;a.protocols.includes(this.multicodec)&&(this.log.info(`Preemptively opening a stream to ${a.id.toString()}`),this.prepareNewStream(a))});this.multicodec=e,this.getConnections=a,this.addEventListener=c,this.log=new Logger$2(`stream-manager:${e}`),this.addEventListener("peer:update",this.handlePeerUpdateStreamPool.bind(this)),this.getStream=this.getStream.bind(this),this.streamPool=new Map}async getStream(e){const a=e.id.toString(),c=this.streamPool.get(a);if(!c)return this.newStream(e);this.streamPool.delete(a),this.prepareNewStream(e);const h=await c;return!h||h.status==="closed"?this.newStream(e):h}async newStream(e){const a=this.getConnections(e.id),c=selectConnection(a);if(!c)throw new Error("Failed to get a connection to the peer");return c.newStream(this.multicodec)}prepareNewStream(e){const a=this.newStream(e).catch(()=>{this.log.error(`Failed to prepare a new stream for ${e.id.toString()}`)});this.streamPool.set(e.id.toString(),a)}},BaseProtocol$1=class{constructor(e,a){qt(this,"multicodec");qt(this,"components");qt(this,"addLibp2pEventListener");qt(this,"removeLibp2pEventListener");qt(this,"streamManager");this.multicodec=e,this.components=a,this.addLibp2pEventListener=a.events.addEventListener.bind(a.events),this.removeLibp2pEventListener=a.events.removeEventListener.bind(a.events),this.streamManager=new StreamManager$1(e,a.connectionManager.getConnections.bind(a.connectionManager),this.addLibp2pEventListener)}async getStream(e){return this.streamManager.getStream(e)}get peerStore(){return this.components.peerStore}async peers(){return getPeersForProtocol(this.peerStore,[this.multicodec])}async getPeer(e){const{peer:a}=await selectPeerForProtocol(this.peerStore,[this.multicodec],e);return a}async getPeers({numPeers:e,maxBootstrapPeers:a}={maxBootstrapPeers:1,numPeers:0}){const c=await getConnectedPeersForProtocol(this.components.connectionManager.getConnections(),this.peerStore,[this.multicodec]);return filterPeers$1(c,e,a)}initializePubsubTopic(e){return(e==null?void 0:e.pubsubTopics)??(e!=null&&e.shardInfo?shardInfoToPubsubTopics(e.shardInfo):[DefaultPubsubTopic])}},getRandomValues;const rnds8=new Uint8Array(16);function rng(){if(!getRandomValues&&(getRandomValues=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!getRandomValues))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return getRandomValues(rnds8)}const byteToHex=[];for(let i=0;i<256;++i)byteToHex.push((i+256).toString(16).slice(1));function unsafeStringify(i,e=0){return byteToHex[i[e+0]]+byteToHex[i[e+1]]+byteToHex[i[e+2]]+byteToHex[i[e+3]]+"-"+byteToHex[i[e+4]]+byteToHex[i[e+5]]+"-"+byteToHex[i[e+6]]+byteToHex[i[e+7]]+"-"+byteToHex[i[e+8]]+byteToHex[i[e+9]]+"-"+byteToHex[i[e+10]]+byteToHex[i[e+11]]+byteToHex[i[e+12]]+byteToHex[i[e+13]]+byteToHex[i[e+14]]+byteToHex[i[e+15]]}const randomUUID=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),native={randomUUID};function v4$2(i,e,a){if(native.randomUUID&&!e&&!i)return native.randomUUID();i=i||{};const c=i.random||(i.rng||rng)();if(c[6]=c[6]&15|64,c[8]=c[8]&63|128,e){a=a||0;for(let h=0;h<16;++h)e[a+h]=c[h];return e}return unsafeStringify(c)}class FilterPushRpc{constructor(e){qt(this,"proto");this.proto=e}static decode(e){const a=MessagePush.decode(e);return new FilterPushRpc(a)}encode(){return MessagePush.encode(this.proto)}get wakuMessage(){return this.proto.wakuMessage}get pubsubTopic(){return this.proto.pubsubTopic}}class FilterSubscribeRpc{constructor(e){qt(this,"proto");this.proto=e}static createSubscribeRequest(e,a){return new FilterSubscribeRpc({requestId:v4$2(),filterSubscribeType:FilterSubscribeRequest.FilterSubscribeType.SUBSCRIBE,pubsubTopic:e,contentTopics:a})}static createUnsubscribeRequest(e,a){return new FilterSubscribeRpc({requestId:v4$2(),filterSubscribeType:FilterSubscribeRequest.FilterSubscribeType.UNSUBSCRIBE,pubsubTopic:e,contentTopics:a})}static createUnsubscribeAllRequest(e){return new FilterSubscribeRpc({requestId:v4$2(),filterSubscribeType:FilterSubscribeRequest.FilterSubscribeType.UNSUBSCRIBE_ALL,pubsubTopic:e,contentTopics:[]})}static createSubscriberPingRequest(){return new FilterSubscribeRpc({requestId:v4$2(),filterSubscribeType:FilterSubscribeRequest.FilterSubscribeType.SUBSCRIBER_PING,pubsubTopic:"",contentTopics:[]})}static decode(e){const a=FilterSubscribeRequest.decode(e);return new FilterSubscribeRpc(a)}encode(){return FilterSubscribeRequest.encode(this.proto)}get filterSubscribeType(){return this.proto.filterSubscribeType}get requestId(){return this.proto.requestId}get pubsubTopic(){return this.proto.pubsubTopic}get contentTopics(){return this.proto.contentTopics}}class FilterSubscribeResponse{constructor(e){qt(this,"proto");this.proto=e}static decode(e){const a=FilterSubscribeResponse$1.decode(e);return new FilterSubscribeResponse(a)}encode(){return FilterSubscribeResponse$1.encode(this.proto)}get statusCode(){return this.proto.statusCode}get statusDesc(){return this.proto.statusDesc}get requestId(){return this.proto.requestId}}const log$t=new Logger$2("filter:v2"),FilterCodecs={SUBSCRIBE:"/vac/waku/filter-subscribe/2.0.0-beta1",PUSH:"/vac/waku/filter-push/2.0.0-beta1"};class Subscription{constructor(e,a,c){qt(this,"peer");qt(this,"pubsubTopic");qt(this,"newStream");qt(this,"subscriptionCallbacks");this.peer=a,this.pubsubTopic=e,this.newStream=c,this.subscriptionCallbacks=new Map}async subscribe(e,a){const c=Array.isArray(e)?e:[e];c.forEach(gt=>{if(gt.pubsubTopic!==this.pubsubTopic)throw new Error(`Pubsub topic not configured: decoder is configured for pubsub topic ${gt.pubsubTopic} but this subscription is for pubsub topic ${this.pubsubTopic}. Please create a new Subscription for the different pubsub topic.`)});const h=groupByContentTopic(c),d=Array.from(h.keys()),et=await this.newStream(this.peer),ft=FilterSubscribeRpc.createSubscribeRequest(this.pubsubTopic,d);try{const gt=await pipe([ft.encode()],encode$c,et,decode$b,async It=>await all$1(It));if(!gt||!gt.length)throw Error(`No response received for request ${ft.requestId}: ${gt}`);const{statusCode:_t,requestId:wt,statusDesc:$t}=FilterSubscribeResponse.decode(gt[0].slice());if(_t<200||_t>=300)throw new Error(`Filter subscribe request ${wt} failed with status code ${_t}: ${$t}`);log$t.info("Subscribed to peer ",this.peer.id.toString(),"for content topics",d)}catch(gt){throw new Error("Error subscribing to peer: "+this.peer.id.toString()+" for content topics: "+d+": "+gt)}h.forEach((gt,_t)=>{const wt={decoders:gt,callback:a};this.subscriptionCallbacks.set(_t,wt)})}async unsubscribe(e){const a=await this.newStream(this.peer),c=FilterSubscribeRpc.createUnsubscribeRequest(this.pubsubTopic,e);try{await pipe([c.encode()],encode$c,a.sink)}catch(h){throw new Error("Error subscribing: "+h)}e.forEach(h=>{this.subscriptionCallbacks.delete(h)})}async ping(){const e=await this.newStream(this.peer),a=FilterSubscribeRpc.createSubscriberPingRequest();try{const c=await pipe([a.encode()],encode$c,e,decode$b,async ft=>await all$1(ft));if(!c||!c.length)throw Error(`No response received for request ${a.requestId}: ${c}`);const{statusCode:h,requestId:d,statusDesc:et}=FilterSubscribeResponse.decode(c[0].slice());if(h<200||h>=300)throw new Error(`Filter ping request ${d} failed with status code ${h}: ${et}`);log$t.info("Ping successful")}catch(c){throw log$t.error("Error pinging: ",c),new Error("Error pinging: "+c)}}async unsubscribeAll(){const e=await this.newStream(this.peer),a=FilterSubscribeRpc.createUnsubscribeAllRequest(this.pubsubTopic);try{const c=await pipe([a.encode()],encode$c,e,decode$b,async ft=>await all$1(ft));if(!c||!c.length)throw Error(`No response received for request ${a.requestId}: ${c}`);const{statusCode:h,requestId:d,statusDesc:et}=FilterSubscribeResponse.decode(c[0].slice());if(h<200||h>=300)throw new Error(`Filter unsubscribe all request ${d} failed with status code ${h}: ${et}`);this.subscriptionCallbacks.clear(),log$t.info("Unsubscribed from all content topics")}catch(c){throw new Error("Error unsubscribing from all content topics: "+c)}}async processMessage(e){const a=e.contentTopic,c=this.subscriptionCallbacks.get(a);if(!c){log$t.error("No subscription callback available for ",a);return}await pushMessage(c,this.pubsubTopic,e)}}class Filter extends BaseProtocol$1{constructor(a,c){super(FilterCodecs.SUBSCRIBE,a.components);qt(this,"pubsubTopics",[]);qt(this,"activeSubscriptions",new Map);qt(this,"NUM_PEERS_PROTOCOL",1);this.pubsubTopics=this.initializePubsubTopic(c),a.handle(FilterCodecs.PUSH,this.onRequest.bind(this)).catch(h=>{log$t.error("Failed to register ",FilterCodecs.PUSH,h)}),this.activeSubscriptions=new Map}getActiveSubscription(a,c){return this.activeSubscriptions.get(`${a}_${c}`)}setActiveSubscription(a,c,h){return this.activeSubscriptions.set(`${a}_${c}`,h),h}async createSubscription(a=DefaultPubsubTopic){const c=typeof a=="string"?a:singleShardInfoToPubsubTopic(a);ensurePubsubTopicIsConfigured(c,this.pubsubTopics);const h=(await this.getPeers({maxBootstrapPeers:1,numPeers:this.NUM_PEERS_PROTOCOL}))[0];return this.getActiveSubscription(c,h.id.toString())??this.setActiveSubscription(c,h.id.toString(),new Subscription(c,h,this.getStream.bind(this,h)))}toSubscriptionIterator(a){return toAsyncIterator(this,a)}async subscribe(a,c){const h=await this.createSubscription();await h.subscribe(a,c);const d=Array.from(groupByContentTopic(Array.isArray(a)?a:[a]).keys());return async()=>{await h.unsubscribe(d)}}onRequest(a){try{pipe(a.stream,decode$b,async c=>{for await(const h of c){const d=FilterPushRpc.decode(h.slice()),{pubsubTopic:et,wakuMessage:ft}=d;if(!ft){log$t.error("Received empty message");return}if(!et){log$t.error("Pubsub topic missing from push message");return}const gt=a.connection.remotePeer.toString(),_t=this.getActiveSubscription(et,gt);if(!_t){log$t.error(`No subscription locally registered for topic ${et}`);return}await _t.processMessage(ft)}}).then(()=>{log$t.info("Receiving pipe closed.")},c=>{log$t.error("Error with receiving pipe",c)})}catch(c){log$t.error("Error decoding message",c)}}}function wakuFilter(i={}){return e=>new Filter(e,i)}async function pushMessage(i,e,a){const{decoders:c,callback:h}=i,{contentTopic:d}=a;if(!d){log$t.warn("Message has no content topic, skipping");return}try{const et=c.map(gt=>gt.fromProtoObj(e,a).then(_t=>_t||Promise.reject("Decoding failed"))),ft=await Promise.any(et);await h(ft)}catch(et){log$t.error("Error decoding message",et)}}class PushRpc{constructor(e){qt(this,"proto");this.proto=e}static createRequest(e,a){return new PushRpc({requestId:v4$2(),request:{message:e,pubsubTopic:a},response:void 0})}static decode(e){const a=PushRpc$1.decode(e);return new PushRpc(a)}encode(){return PushRpc$1.encode(this.proto)}get query(){return this.proto.request}get response(){return this.proto.response}}const log$s=new Logger$2("light-push"),LightPushCodec="/vac/waku/lightpush/2.0.0-beta1";class LightPush extends BaseProtocol$1{constructor(a,c){super(LightPushCodec,a.components);qt(this,"pubsubTopics");qt(this,"NUM_PEERS_PROTOCOL",1);this.pubsubTopics=this.initializePubsubTopic(c)}async preparePushMessage(a,c,h){try{if(!c.payload||c.payload.length===0)return log$s.error("Failed to send waku light push: payload is empty"),{query:null,error:SendError.EMPTY_PAYLOAD};if(!await isMessageSizeUnderCap(a,c))return log$s.error("Failed to send waku light push: message is bigger than 1MB"),{query:null,error:SendError.SIZE_TOO_BIG};const d=await a.toProtoObj(c);return d?{query:PushRpc.createRequest(d,h),error:null}:(log$s.error("Failed to encode to protoMessage, aborting push"),{query:null,error:SendError.ENCODE_FAILED})}catch(d){return log$s.error("Failed to prepare push message",d),{query:null,error:SendError.GENERIC_FAIL}}}async send(a,c){const{pubsubTopic:h}=a;ensurePubsubTopicIsConfigured(h,this.pubsubTopics);const d=[],{query:et,error:ft}=await this.preparePushMessage(a,c,h);if(ft||!et)return{recipients:d,errors:[ft]};const gt=await this.getPeers({maxBootstrapPeers:1,numPeers:this.NUM_PEERS_PROTOCOL});if(!gt.length)return{recipients:d,errors:[SendError.NO_PEER_AVAILABLE]};const _t=gt.map(async It=>{let Rt;try{Rt=await this.getStream(It)}catch(xt){return log$s.error(`Failed to get a stream for remote peer${It.id.toString()}`,xt),{recipients:d,error:SendError.REMOTE_PEER_FAULT}}let Tt;try{Tt=await pipe([et.encode()],encode$c,Rt,decode$b,async xt=>await all$1(xt))}catch(xt){return log$s.error("Failed to send waku light push request",xt),{recipients:d,error:SendError.GENERIC_FAIL}}const At=new Uint8ArrayList;Tt.forEach(xt=>{At.append(xt)});let kt;try{kt=PushRpc.decode(At).response}catch(xt){return log$s.error("Failed to decode push reply",xt),{recipients:d,error:SendError.DECODE_FAILED}}return kt?kt.isSuccess?(d.some(xt=>xt.equals(It.id))||d.push(It.id),{recipients:d}):(log$s.error("Remote peer rejected the message: ",kt.info),{recipients:d,error:SendError.REMOTE_PEER_REJECTED}):(log$s.error("Remote peer fault: No response in PushRPC"),{recipients:d,error:SendError.REMOTE_PEER_FAULT})}),$t=(await Promise.allSettled(_t)).filter(It=>It.status==="fulfilled").map(It=>It.value.error).filter(It=>It!==void 0);return{recipients:d,errors:$t}}}function wakuLightPush(i={}){return e=>new LightPush(e,i)}const EmptyMessage={payload:new Uint8Array,contentTopic:"",version:void 0,timestamp:void 0,meta:void 0,rateLimitProof:void 0,ephemeral:void 0};function toProtoMessage(i){return{...EmptyMessage,...i}}const OneMillion=BigInt(1e6);var PageDirection;(function(i){i.BACKWARD="backward",i.FORWARD="forward"})(PageDirection||(PageDirection={}));class HistoryRpc{constructor(e){qt(this,"proto");this.proto=e}get query(){return this.proto.query}get response(){return this.proto.response}static createQuery(e){const a=e.contentTopics.map(ft=>({contentTopic:ft})),c=directionToProto(e.pageDirection),h={pageSize:BigInt(e.pageSize),cursor:e.cursor,direction:c};let d,et;return e.startTime&&(d=BigInt(e.startTime.valueOf())*OneMillion),e.endTime&&(et=BigInt(e.endTime.valueOf())*OneMillion),new HistoryRpc({requestId:v4$2(),query:{pubsubTopic:e.pubsubTopic,contentFilters:a,pagingInfo:h,startTime:d,endTime:et},response:void 0})}decode(e){const a=HistoryRpc$1.decode(e);return new HistoryRpc(a)}encode(){return HistoryRpc$1.encode(this.proto)}}function directionToProto(i){switch(i){case PageDirection.BACKWARD:return PagingInfo.Direction.BACKWARD;case PageDirection.FORWARD:return PagingInfo.Direction.FORWARD;default:return PagingInfo.Direction.BACKWARD}}var HistoryError=HistoryResponse.HistoryError;const log$r=new Logger$2("store"),StoreCodec="/vac/waku/store/2.0.0-beta4",DefaultPageSize=10;class Store extends BaseProtocol$1{constructor(a,c){super(StoreCodec,a.components);qt(this,"pubsubTopics");qt(this,"NUM_PEERS_PROTOCOL",1);qt(this,"queryOrderedCallback",this.queryWithOrderedCallback);this.pubsubTopics=this.initializePubsubTopic(c)}async processMessages(a,c,h){let d=!1,ft=(await Promise.all(a)).filter(isDefined);return this.shouldReverseOrder(h)&&(ft=ft.reverse()),await Promise.all(ft.map(async gt=>{gt&&!d&&(d=!!await c(gt))})),d}shouldReverseOrder(a){return typeof(a==null?void 0:a.pageDirection)>"u"||(a==null?void 0:a.pageDirection)===PageDirection.BACKWARD}async queryWithOrderedCallback(a,c,h){for await(const d of this.queryGenerator(a,h))if(await this.processMessages(d,c,h))break}async queryWithPromiseCallback(a,c,h){let d=!1;for await(const et of this.queryGenerator(a,h)){const ft=et.map(async gt=>{d||(d=!!await c(gt))});if(await Promise.all(ft),d)break}}async*queryGenerator(a,c){var It,Rt;if(a.length===0)throw new Error("No decoders provided");let h,d;c!=null&&c.timeFilter&&(h=c.timeFilter.startTime,d=c.timeFilter.endTime);const et=Array.from(new Set(a.map(Tt=>Tt.pubsubTopic)));if(et.length>1)throw new Error("API does not support querying multiple pubsub topics at once");const ft=et[0];if(ensurePubsubTopicIsConfigured(ft,this.pubsubTopics),(It=c==null?void 0:c.cursor)!=null&&It.pubsubTopic&&c.cursor.pubsubTopic!==ft)throw new Error(`Cursor pubsub topic (${(Rt=c==null?void 0:c.cursor)==null?void 0:Rt.pubsubTopic}) does not match decoder pubsub topic (${ft})`);const gt=new Map;a.forEach(Tt=>{if(gt.has(Tt.contentTopic))throw new Error("API does not support different decoder per content topic");gt.set(Tt.contentTopic,Tt)});const _t=a.filter(Tt=>Tt.pubsubTopic===ft).map(Tt=>Tt.contentTopic);if(_t.length===0)throw new Error("No decoders found for topic "+ft);const wt=Object.assign({pubsubTopic:ft,pageDirection:PageDirection.BACKWARD,pageSize:DefaultPageSize},c,{contentTopics:_t,startTime:h,endTime:d}),$t=(await this.getPeers({numPeers:this.NUM_PEERS_PROTOCOL,maxBootstrapPeers:1}))[0];for await(const Tt of paginate(this.getStream.bind(this,$t),wt,gt,c==null?void 0:c.cursor))yield Tt}}async function*paginate(i,e,a,c){var d,et,ft,gt;if(e.contentTopics.toString()!==Array.from(a.keys()).toString())throw new Error("Internal error, the decoders should match the query's content topics");let h=c;for(;;){e.cursor=h;const _t=HistoryRpc.createQuery(e);log$r.info("Querying store peer",`for (${e.pubsubTopic})`,e.contentTopics);const wt=await i(),$t=await pipe([_t.encode()],encode$c,wt,decode$b,async Nt=>await all$1(Nt)),It=new Uint8ArrayList;$t.forEach(Nt=>{It.append(Nt)});const Rt=_t.decode(It);if(!Rt.response){log$r.warn("Stopping pagination due to store `response` field missing");break}const Tt=Rt.response;if(Tt.error&&Tt.error!==HistoryError.NONE)throw"History response contains an Error: "+Tt.error;if(!Tt.messages||!Tt.messages.length){log$r.warn("Stopping pagination due to store `response.messages` field missing or empty");break}log$r.error(`${Tt.messages.length} messages retrieved from store`),yield Tt.messages.map(Nt=>{const Ft=Nt.contentTopic;if(typeof Ft<"u"){const jt=a.get(Ft);if(jt)return jt.fromProtoObj(e.pubsubTopic,toProtoMessage(Nt))}return Promise.resolve(void 0)});const At=(d=Tt.pagingInfo)==null?void 0:d.cursor;if(typeof At>"u"){log$r.warn("Stopping pagination due to `response.pagingInfo.cursor` missing from store response");break}h=At;const kt=(et=Tt.pagingInfo)==null?void 0:et.pageSize,xt=(gt=(ft=_t.query)==null?void 0:ft.pagingInfo)==null?void 0:gt.pageSize;if(kt&&xt&&kt<xt)break}}function wakuStore(i={}){return e=>new Store(e,i)}let TimeoutError$2=class extends Error{constructor(e){super(e),this.name="TimeoutError"}},AbortError$6=class extends Error{constructor(e){super(),this.name="AbortError",this.message=e}};const getDOMException$1=i=>globalThis.DOMException===void 0?new AbortError$6(i):new DOMException(i),getAbortedReason$1=i=>{const e=i.reason===void 0?getDOMException$1("This operation was aborted."):i.reason;return e instanceof Error?e:getDOMException$1(e)};function pTimeout$1(i,e){const{milliseconds:a,fallback:c,message:h,customTimers:d={setTimeout,clearTimeout}}=e;let et;const gt=new Promise((_t,wt)=>{if(typeof a!="number"||Math.sign(a)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${a}\``);if(e.signal){const{signal:It}=e;It.aborted&&wt(getAbortedReason$1(It)),It.addEventListener("abort",()=>{wt(getAbortedReason$1(It))})}if(a===Number.POSITIVE_INFINITY){i.then(_t,wt);return}const $t=new TimeoutError$2;et=d.setTimeout.call(void 0,()=>{if(c){try{_t(c())}catch(It){wt(It)}return}typeof i.cancel=="function"&&i.cancel(),h===!1?_t():h instanceof Error?wt(h):($t.message=h??`Promise timed out after ${a} milliseconds`,wt($t))},a),(async()=>{try{_t(await i)}catch(It){wt(It)}})()}).finally(()=>{gt.clear()});return gt.clear=()=>{d.clearTimeout.call(void 0,et),et=void 0},gt}const normalizeEmitter=i=>{const e=i.addEventListener||i.on||i.addListener,a=i.removeEventListener||i.off||i.removeListener;if(!e||!a)throw new TypeError("Emitter is not compatible");return{addListener:e.bind(i),removeListener:a.bind(i)}};function pEventMultiple(i,e,a){let c;const h=new Promise((d,et)=>{var Rt;if(a={rejectionEvents:["error"],multiArgs:!1,resolveImmediately:!1,...a},!(a.count>=0&&(a.count===Number.POSITIVE_INFINITY||Number.isInteger(a.count))))throw new TypeError("The `count` option should be at least 0 or more");(Rt=a.signal)==null||Rt.throwIfAborted();const ft=[e].flat(),gt=[],{addListener:_t,removeListener:wt}=normalizeEmitter(i),$t=(...Tt)=>{const At=a.multiArgs?Tt:Tt[0];a.filter&&!a.filter(At)||(gt.push(At),a.count===gt.length&&(c(),d(gt)))},It=Tt=>{c(),et(Tt)};c=()=>{for(const Tt of ft)wt(Tt,$t);for(const Tt of a.rejectionEvents)wt(Tt,It)};for(const Tt of ft)_t(Tt,$t);for(const Tt of a.rejectionEvents)_t(Tt,It);a.signal&&a.signal.addEventListener("abort",()=>{It(a.signal.reason)},{once:!0}),a.resolveImmediately&&d(gt)});if(h.cancel=c,typeof a.timeout=="number"){const d=pTimeout$1(h,{milliseconds:a.timeout});return d.cancel=c,d}return h}function pEvent(i,e,a){typeof a=="function"&&(a={filter:a}),a={...a,count:1,resolveImmediately:!1};const c=pEventMultiple(i,e,a),h=c.then(d=>d[0]);return h.cancel=c.cancel,h}const log$q=new Logger$2("wait-for-remote-peer");async function waitForRemotePeer(i,e,a){if(e=e??getEnabledProtocols(i),!i.isStarted())return Promise.reject("Waku node is not started");const c=[];if(e.includes(Protocols$1.Relay)){if(!i.relay)throw new Error("Cannot wait for Relay peer: protocol not mounted");c.push(waitForGossipSubPeerInMesh(i.relay))}if(e.includes(Protocols$1.Store)){if(!i.store)throw new Error("Cannot wait for Store peer: protocol not mounted");c.push(waitForConnectedPeer(i.store))}if(e.includes(Protocols$1.LightPush)){if(!i.lightPush)throw new Error("Cannot wait for LightPush peer: protocol not mounted");c.push(waitForConnectedPeer(i.lightPush))}if(e.includes(Protocols$1.Filter)){if(!i.filter)throw new Error("Cannot wait for Filter peer: protocol not mounted");c.push(waitForConnectedPeer(i.filter))}a?await rejectOnTimeout(Promise.all(c),a,"Timed out waiting for a remote peer."):await Promise.all(c)}async function waitForConnectedPeer(i){const e=i.multicodec,a=await i.peers();if(a.length){log$q.info(`${e} peer found: `,a[0].id.toString());return}await new Promise(c=>{const h=d=>{var et,ft;(ft=(et=d.detail)==null?void 0:et.protocols)!=null&&ft.includes(e)&&(i.removeLibp2pEventListener("peer:identify",h),c())};i.addLibp2pEventListener("peer:identify",h)})}async function waitForGossipSubPeerInMesh(i){let e=i.getMeshPeers();const a=i.pubsubTopics;for(const c of a)for(;e.length==0;)await pEvent(i.gossipSub,"gossipsub:heartbeat"),e=i.getMeshPeers(c)}const awaitTimeout=(i,e)=>new Promise((a,c)=>setTimeout(()=>c(e),i));async function rejectOnTimeout(i,e,a){await Promise.race([i,awaitTimeout(e,a)])}function getEnabledProtocols(i){const e=[];return i.relay&&e.push(Protocols$1.Relay),i.filter&&e.push(Protocols$1.Filter),i.store&&e.push(Protocols$1.Store),i.lightPush&&e.push(Protocols$1.LightPush),e}const log$p=new Logger$2("metadata"),MetadataCodec="/vac/waku/metadata/1.0.0";class Metadata extends BaseProtocol$1{constructor(a,c){super(MetadataCodec,c.components);qt(this,"shardInfo");qt(this,"libp2pComponents");this.libp2pComponents=c,this.shardInfo=a,c.registrar.handle(MetadataCodec,h=>{this.onRequest(h)})}async onRequest(a){try{const{stream:c,connection:h}=a,d=WakuMetadataResponse.encode(this.shardInfo),et=await pipe([d],encode$c,c,decode$b,async gt=>await all$1(gt)),ft=this.decodeMetadataResponse(et);await this.libp2pComponents.peerStore.merge(h.remotePeer,{metadata:{shardInfo:encodeRelayShard(ft)}})}catch(c){log$p.error("Error handling metadata request",c)}}async query(a){const c=WakuMetadataRequest.encode(this.shardInfo),h=await this.getPeer(a),d=await this.getStream(h),et=await pipe([c],encode$c,d,decode$b,async gt=>await all$1(gt));return this.decodeMetadataResponse(et)}decodeMetadataResponse(a){const c=new Uint8ArrayList;a.forEach(d=>{c.append(d)});const h=WakuMetadataResponse.decode(c);return h||log$p.error("Error decoding metadata response"),h}}function wakuMetadata(i){return e=>new Metadata(i,e)}let AbortError$5=class extends Error{constructor(a,c){super(a??"The operation was aborted");qt(this,"type");qt(this,"code");this.type="aborted",this.name="AbortError",this.code=c??"ABORT_ERR"}};async function raceSignal(i,e,a){if(e==null)return i;if(e.aborted)return Promise.reject(new AbortError$5(a==null?void 0:a.errorMessage,a==null?void 0:a.errorCode));let c;const h=new AbortError$5(a==null?void 0:a.errorMessage,a==null?void 0:a.errorCode);try{return await Promise.race([i,new Promise((d,et)=>{c=()=>{et(h)},e.addEventListener("abort",c)})])}finally{c!=null&&e.removeEventListener("abort",c)}}class QueuelessPushable{constructor(){qt(this,"readNext");qt(this,"haveNext");qt(this,"ended");qt(this,"nextResult");this.ended=!1,this.readNext=pDefer(),this.haveNext=pDefer()}[Symbol.asyncIterator](){return this}async next(){if(this.nextResult==null&&await this.haveNext.promise,this.nextResult==null)throw new Error("HaveNext promise resolved but nextResult was undefined");const e=this.nextResult;return this.nextResult=void 0,this.readNext.resolve(),this.readNext=pDefer(),e}async throw(e){return this.ended=!0,e!=null&&this.haveNext.reject(e),{done:!0,value:void 0}}async return(){const e={done:!0,value:void 0};return await this._push(void 0),e}async push(e,a){await this._push(e,a)}async end(e,a){e!=null?await this.throw(e):await this._push(void 0,a)}async _push(e,a){if(e!=null&&this.ended)throw new Error("Cannot push value onto an ended pushable");if(this.nextResult!=null&&(await this.readNext.promise,this.nextResult!=null))throw new Error("NeedNext promise resolved but nextResult was not consumed");e!=null?this.nextResult={done:!1,value:e}:(this.ended=!0,this.nextResult={done:!0,value:void 0}),this.haveNext.resolve(),this.haveNext=pDefer(),await raceSignal(this.readNext.promise,a==null?void 0:a.signal,a)}}function pushable(){return new QueuelessPushable}let CodeError$1=class extends Error{constructor(a,c){super(a);qt(this,"code");this.code=c}},AbortError$4=class extends CodeError$1{constructor(a){super(a,"ABORT_ERR");qt(this,"type");this.type="aborted"}};function byteStream(i,e){const a=pushable();i.sink(a).catch(async et=>{await a.end(et)}),i.sink=async et=>{for await(const ft of et)await a.push(ft);await a.end()};let c=i.source;i.source[Symbol.iterator]!=null?c=i.source[Symbol.iterator]():i.source[Symbol.asyncIterator]!=null&&(c=i.source[Symbol.asyncIterator]());const h=new Uint8ArrayList;return{read:async(et,ft)=>{var wt,$t;(wt=ft==null?void 0:ft.signal)==null||wt.throwIfAborted();let gt;const _t=new Promise((It,Rt)=>{var Tt;gt=()=>{Rt(new AbortError$4("Read aborted"))},(Tt=ft==null?void 0:ft.signal)==null||Tt.addEventListener("abort",gt)});try{if(et==null){const{done:Rt,value:Tt}=await Promise.race([c.next(),_t]);return Rt===!0?new Uint8ArrayList:Tt}for(;h.byteLength<et;){const{value:Rt,done:Tt}=await Promise.race([c.next(),_t]);if(Tt===!0)throw new CodeError$1("unexpected end of input","ERR_UNEXPECTED_EOF");h.append(Rt)}const It=h.sublist(0,et);return h.consume(et),It}finally{gt!=null&&(($t=ft==null?void 0:ft.signal)==null||$t.removeEventListener("abort",gt))}},write:async(et,ft)=>{var gt;(gt=ft==null?void 0:ft.signal)==null||gt.throwIfAborted(),et instanceof Uint8Array?await a.push(et,ft):await a.push(et.subarray(),ft)},unwrap:()=>{if(h.byteLength>0){const et=i.source;i.source=async function*(){(e==null?void 0:e.yieldBytes)===!1?yield h:yield*h,yield*et}()}return i}}}class CodeError extends Error{constructor(a,c){super(a);qt(this,"code");this.code=c}}function lpStream(i,e={}){const a=byteStream(i,e);e.maxDataLength!=null&&e.maxLengthLength==null&&(e.maxLengthLength=encodingLength$4(e.maxDataLength));const c=(e==null?void 0:e.lengthDecoder)??decode$n,h=(e==null?void 0:e.lengthEncoder)??encode$o;return{read:async et=>{let ft=-1;const gt=new Uint8ArrayList;for(;;){gt.append(await a.read(1,et));try{ft=c(gt)}catch(_t){if(_t instanceof RangeError)continue;throw _t}if((e==null?void 0:e.maxLengthLength)!=null&&gt.byteLength>e.maxLengthLength)throw new CodeError("message length length too long","ERR_MSG_LENGTH_TOO_LONG");if(ft>-1)break}if((e==null?void 0:e.maxDataLength)!=null&&ft>e.maxDataLength)throw new CodeError("message length too long","ERR_MSG_DATA_TOO_LONG");return a.read(ft,et)},write:async(et,ft)=>{await a.write(new Uint8ArrayList(h(et.byteLength),et),ft)},writeV:async(et,ft)=>{const gt=new Uint8ArrayList(...et.flatMap(_t=>[h(_t.byteLength),_t]));await a.write(gt,ft)},unwrap:()=>a.unwrap()}}function pair(){const i=pDefer();let e=!1;return{sink:async a=>{if(e)throw new Error("already piped");e=!0,i.resolve(a)},source:async function*(){yield*await i.promise}()}}function duplexPair(){const i=pair(),e=pair();return[{source:i.source,sink:e.sink},{source:e.source,sink:i.sink}]}const NOISE_MSG_MAX_LENGTH_BYTES=65535,NOISE_MSG_MAX_LENGTH_BYTES_WITHOUT_TAG=NOISE_MSG_MAX_LENGTH_BYTES-16;var El,Sl;const DUMP_SESSION_KEYS=!!((Sl=(El=globalThis.process)==null?void 0:El.env)!=null&&Sl.DUMP_SESSION_KEYS);/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */const u32=i=>new Uint32Array(i.buffer,i.byteOffset,Math.floor(i.byteLength/4));function isBytes$1(i){return i instanceof Uint8Array||i!=null&&typeof i=="object"&&i.constructor.name==="Uint8Array"}const createView=i=>new DataView(i.buffer,i.byteOffset,i.byteLength),isLE=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!isLE)throw new Error("Non little-endian hardware is not supported");function utf8ToBytes(i){if(typeof i!="string")throw new Error(`utf8ToBytes expected string, got ${typeof i}`);return new Uint8Array(new TextEncoder().encode(i))}function toBytes(i){if(typeof i=="string")i=utf8ToBytes(i);else if(isBytes$1(i))i=i.slice();else throw new Error(`expected Uint8Array, got ${typeof i}`);return i}const isPlainObject=i=>Object.prototype.toString.call(i)==="[object Object]"&&i.constructor===Object;function checkOpts(i,e){if(e!==void 0&&(typeof e!="object"||!isPlainObject(e)))throw new Error("options must be object or undefined");return Object.assign(i,e)}function ensureBytes(i,e){if(!isBytes$1(i))throw new Error("Uint8Array expected");if(typeof e=="number"&&i.length!==e)throw new Error(`Uint8Array length ${e} expected`)}function equalBytes(i,e){if(i.length!==e.length)return!1;let a=0;for(let c=0;c<i.length;c++)a|=i[c]^e[c];return a===0}const wrapCipher=(i,e)=>(Object.assign(e,i),e);function setBigUint64(i,e,a,c){if(typeof i.setBigUint64=="function")return i.setBigUint64(e,a,c);const h=BigInt(32),d=BigInt(4294967295),et=Number(a>>h&d),ft=Number(a&d),gt=c?4:0,_t=c?0:4;i.setUint32(e+gt,et,c),i.setUint32(e+_t,ft,c)}function number$1(i){if(!Number.isSafeInteger(i)||i<0)throw new Error(`wrong positive integer: ${i}`)}function bool(i){if(typeof i!="boolean")throw new Error(`boolean expected, not ${i}`)}function isBytes(i){return i!=null&&typeof i=="object"&&(i instanceof Uint8Array||i.constructor.name==="Uint8Array")}function bytes(i,...e){if(!isBytes(i))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(i.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${i.length}`)}function exists(i,e=!0){if(i.destroyed)throw new Error("Hash instance has been destroyed");if(e&&i.finished)throw new Error("Hash#digest() has already been called")}function output(i,e){bytes(i);const a=e.outputLen;if(i.length<a)throw new Error(`digestInto() expects output buffer of length at least ${a}`)}const u8to16=(i,e)=>i[e++]&255|(i[e++]&255)<<8;class Poly1305{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=toBytes(e),ensureBytes(e,32);const a=u8to16(e,0),c=u8to16(e,2),h=u8to16(e,4),d=u8to16(e,6),et=u8to16(e,8),ft=u8to16(e,10),gt=u8to16(e,12),_t=u8to16(e,14);this.r[0]=a&8191,this.r[1]=(a>>>13|c<<3)&8191,this.r[2]=(c>>>10|h<<6)&7939,this.r[3]=(h>>>7|d<<9)&8191,this.r[4]=(d>>>4|et<<12)&255,this.r[5]=et>>>1&8190,this.r[6]=(et>>>14|ft<<2)&8191,this.r[7]=(ft>>>11|gt<<5)&8065,this.r[8]=(gt>>>8|_t<<8)&8191,this.r[9]=_t>>>5&127;for(let wt=0;wt<8;wt++)this.pad[wt]=u8to16(e,16+2*wt)}process(e,a,c=!1){const h=c?0:2048,{h:d,r:et}=this,ft=et[0],gt=et[1],_t=et[2],wt=et[3],$t=et[4],It=et[5],Rt=et[6],Tt=et[7],At=et[8],kt=et[9],xt=u8to16(e,a+0),Nt=u8to16(e,a+2),Ft=u8to16(e,a+4),jt=u8to16(e,a+6),Gt=u8to16(e,a+8),Kt=u8to16(e,a+10),Wt=u8to16(e,a+12),Zt=u8to16(e,a+14);let cr=d[0]+(xt&8191),hr=d[1]+((xt>>>13|Nt<<3)&8191),gr=d[2]+((Nt>>>10|Ft<<6)&8191),er=d[3]+((Ft>>>7|jt<<9)&8191),mr=d[4]+((jt>>>4|Gt<<12)&8191),Mr=d[5]+(Gt>>>1&8191),wr=d[6]+((Gt>>>14|Kt<<2)&8191),Dr=d[7]+((Kt>>>11|Wt<<5)&8191),Tr=d[8]+((Wt>>>8|Zt<<8)&8191),fr=d[9]+(Zt>>>5|h),yr=0,$r=yr+cr*ft+hr*(5*kt)+gr*(5*At)+er*(5*Tt)+mr*(5*Rt);yr=$r>>>13,$r&=8191,$r+=Mr*(5*It)+wr*(5*$t)+Dr*(5*wt)+Tr*(5*_t)+fr*(5*gt),yr+=$r>>>13,$r&=8191;let Fr=yr+cr*gt+hr*ft+gr*(5*kt)+er*(5*At)+mr*(5*Tt);yr=Fr>>>13,Fr&=8191,Fr+=Mr*(5*Rt)+wr*(5*It)+Dr*(5*$t)+Tr*(5*wt)+fr*(5*_t),yr+=Fr>>>13,Fr&=8191;let dr=yr+cr*_t+hr*gt+gr*ft+er*(5*kt)+mr*(5*At);yr=dr>>>13,dr&=8191,dr+=Mr*(5*Tt)+wr*(5*Rt)+Dr*(5*It)+Tr*(5*$t)+fr*(5*wt),yr+=dr>>>13,dr&=8191;let Br=yr+cr*wt+hr*_t+gr*gt+er*ft+mr*(5*kt);yr=Br>>>13,Br&=8191,Br+=Mr*(5*At)+wr*(5*Tt)+Dr*(5*Rt)+Tr*(5*It)+fr*(5*$t),yr+=Br>>>13,Br&=8191;let Hr=yr+cr*$t+hr*wt+gr*_t+er*gt+mr*ft;yr=Hr>>>13,Hr&=8191,Hr+=Mr*(5*kt)+wr*(5*At)+Dr*(5*Tt)+Tr*(5*Rt)+fr*(5*It),yr+=Hr>>>13,Hr&=8191;let Jr=yr+cr*It+hr*$t+gr*wt+er*_t+mr*gt;yr=Jr>>>13,Jr&=8191,Jr+=Mr*ft+wr*(5*kt)+Dr*(5*At)+Tr*(5*Tt)+fr*(5*Rt),yr+=Jr>>>13,Jr&=8191;let zr=yr+cr*Rt+hr*It+gr*$t+er*wt+mr*_t;yr=zr>>>13,zr&=8191,zr+=Mr*gt+wr*ft+Dr*(5*kt)+Tr*(5*At)+fr*(5*Tt),yr+=zr>>>13,zr&=8191;let br=yr+cr*Tt+hr*Rt+gr*It+er*$t+mr*wt;yr=br>>>13,br&=8191,br+=Mr*_t+wr*gt+Dr*ft+Tr*(5*kt)+fr*(5*At),yr+=br>>>13,br&=8191;let _r=yr+cr*At+hr*Tt+gr*Rt+er*It+mr*$t;yr=_r>>>13,_r&=8191,_r+=Mr*wt+wr*_t+Dr*gt+Tr*ft+fr*(5*kt),yr+=_r>>>13,_r&=8191;let Vr=yr+cr*kt+hr*At+gr*Tt+er*Rt+mr*It;yr=Vr>>>13,Vr&=8191,Vr+=Mr*$t+wr*wt+Dr*_t+Tr*gt+fr*ft,yr+=Vr>>>13,Vr&=8191,yr=(yr<<2)+yr|0,yr=yr+$r|0,$r=yr&8191,yr=yr>>>13,Fr+=yr,d[0]=$r,d[1]=Fr,d[2]=dr,d[3]=Br,d[4]=Hr,d[5]=Jr,d[6]=zr,d[7]=br,d[8]=_r,d[9]=Vr}finalize(){const{h:e,pad:a}=this,c=new Uint16Array(10);let h=e[1]>>>13;e[1]&=8191;for(let ft=2;ft<10;ft++)e[ft]+=h,h=e[ft]>>>13,e[ft]&=8191;e[0]+=h*5,h=e[0]>>>13,e[0]&=8191,e[1]+=h,h=e[1]>>>13,e[1]&=8191,e[2]+=h,c[0]=e[0]+5,h=c[0]>>>13,c[0]&=8191;for(let ft=1;ft<10;ft++)c[ft]=e[ft]+h,h=c[ft]>>>13,c[ft]&=8191;c[9]-=8192;let d=(h^1)-1;for(let ft=0;ft<10;ft++)c[ft]&=d;d=~d;for(let ft=0;ft<10;ft++)e[ft]=e[ft]&d|c[ft];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let et=e[0]+a[0];e[0]=et&65535;for(let ft=1;ft<8;ft++)et=(e[ft]+a[ft]|0)+(et>>>16)|0,e[ft]=et&65535}update(e){exists(this);const{buffer:a,blockLen:c}=this;e=toBytes(e);const h=e.length;for(let d=0;d<h;){const et=Math.min(c-this.pos,h-d);if(et===c){for(;c<=h-d;d+=c)this.process(e,d);continue}a.set(e.subarray(d,d+et),this.pos),this.pos+=et,d+=et,this.pos===c&&(this.process(a,0,!1),this.pos=0)}return this}destroy(){this.h.fill(0),this.r.fill(0),this.buffer.fill(0),this.pad.fill(0)}digestInto(e){exists(this),output(e,this),this.finished=!0;const{buffer:a,h:c}=this;let{pos:h}=this;if(h){for(a[h++]=1;h<16;h++)a[h]=0;this.process(a,0,!0)}this.finalize();let d=0;for(let et=0;et<8;et++)e[d++]=c[et]>>>0,e[d++]=c[et]>>>8;return e}digest(){const{buffer:e,outputLen:a}=this;this.digestInto(e);const c=e.slice(0,a);return this.destroy(),c}}function wrapConstructorWithKey(i){const e=(c,h)=>i(h).update(toBytes(c)).digest(),a=i(new Uint8Array(32));return e.outputLen=a.outputLen,e.blockLen=a.blockLen,e.create=c=>i(c),e}const poly1305=wrapConstructorWithKey(i=>new Poly1305(i)),sigma16=utf8ToBytes("expand 16-byte k"),sigma32=utf8ToBytes("expand 32-byte k"),sigma16_32=u32(sigma16),sigma32_32=u32(sigma32);function rotl(i,e){return i<<e|i>>>32-e}function isAligned32(i){return i.byteOffset%4===0}const BLOCK_LEN=64,BLOCK_LEN32=16,MAX_COUNTER=2**32-1,U32_EMPTY=new Uint32Array;function runCipher(i,e,a,c,h,d,et,ft){const gt=h.length,_t=new Uint8Array(BLOCK_LEN),wt=u32(_t),$t=isAligned32(h)&&isAligned32(d),It=$t?u32(h):U32_EMPTY,Rt=$t?u32(d):U32_EMPTY;for(let Tt=0;Tt<gt;et++){if(i(e,a,c,wt,et,ft),et>=MAX_COUNTER)throw new Error("arx: counter overflow");const At=Math.min(BLOCK_LEN,gt-Tt);if($t&&At===BLOCK_LEN){const kt=Tt/4;if(Tt%4!==0)throw new Error("arx: invalid block position");for(let xt=0,Nt;xt<BLOCK_LEN32;xt++)Nt=kt+xt,Rt[Nt]=It[Nt]^wt[xt];Tt+=BLOCK_LEN;continue}for(let kt=0,xt;kt<At;kt++)xt=Tt+kt,d[xt]=h[xt]^_t[kt];Tt+=At}}function createCipher(i,e){const{allowShortKeys:a,extendNonceFn:c,counterLength:h,counterRight:d,rounds:et}=checkOpts({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof i!="function")throw new Error("core must be a function");return number$1(h),number$1(et),bool(d),bool(a),(ft,gt,_t,wt,$t=0)=>{bytes(ft),bytes(gt),bytes(_t);const It=_t.length;if(wt||(wt=new Uint8Array(It)),bytes(wt),number$1($t),$t<0||$t>=MAX_COUNTER)throw new Error("arx: counter overflow");if(wt.length<It)throw new Error(`arx: output (${wt.length}) is shorter than data (${It})`);const Rt=[];let Tt=ft.length,At,kt;if(Tt===32)At=ft.slice(),Rt.push(At),kt=sigma32_32;else if(Tt===16&&a)At=new Uint8Array(32),At.set(ft),At.set(ft,16),kt=sigma16_32,Rt.push(At);else throw new Error(`arx: invalid 32-byte key, got length=${Tt}`);isAligned32(gt)||(gt=gt.slice(),Rt.push(gt));const xt=u32(At);if(c){if(gt.length!==24)throw new Error("arx: extended nonce must be 24 bytes");c(kt,xt,u32(gt.subarray(0,16)),xt),gt=gt.subarray(16)}const Nt=16-h;if(Nt!==gt.length)throw new Error(`arx: nonce must be ${Nt} or 16 bytes`);if(Nt!==12){const jt=new Uint8Array(12);jt.set(gt,d?0:12-gt.length),gt=jt,Rt.push(gt)}const Ft=u32(gt);for(runCipher(i,kt,xt,Ft,_t,wt,$t,et);Rt.length>0;)Rt.pop().fill(0);return wt}}function chachaCore(i,e,a,c,h,d=20){let et=i[0],ft=i[1],gt=i[2],_t=i[3],wt=e[0],$t=e[1],It=e[2],Rt=e[3],Tt=e[4],At=e[5],kt=e[6],xt=e[7],Nt=h,Ft=a[0],jt=a[1],Gt=a[2],Kt=et,Wt=ft,Zt=gt,cr=_t,hr=wt,gr=$t,er=It,mr=Rt,Mr=Tt,wr=At,Dr=kt,Tr=xt,fr=Nt,yr=Ft,$r=jt,Fr=Gt;for(let Br=0;Br<d;Br+=2)Kt=Kt+hr|0,fr=rotl(fr^Kt,16),Mr=Mr+fr|0,hr=rotl(hr^Mr,12),Kt=Kt+hr|0,fr=rotl(fr^Kt,8),Mr=Mr+fr|0,hr=rotl(hr^Mr,7),Wt=Wt+gr|0,yr=rotl(yr^Wt,16),wr=wr+yr|0,gr=rotl(gr^wr,12),Wt=Wt+gr|0,yr=rotl(yr^Wt,8),wr=wr+yr|0,gr=rotl(gr^wr,7),Zt=Zt+er|0,$r=rotl($r^Zt,16),Dr=Dr+$r|0,er=rotl(er^Dr,12),Zt=Zt+er|0,$r=rotl($r^Zt,8),Dr=Dr+$r|0,er=rotl(er^Dr,7),cr=cr+mr|0,Fr=rotl(Fr^cr,16),Tr=Tr+Fr|0,mr=rotl(mr^Tr,12),cr=cr+mr|0,Fr=rotl(Fr^cr,8),Tr=Tr+Fr|0,mr=rotl(mr^Tr,7),Kt=Kt+gr|0,Fr=rotl(Fr^Kt,16),Dr=Dr+Fr|0,gr=rotl(gr^Dr,12),Kt=Kt+gr|0,Fr=rotl(Fr^Kt,8),Dr=Dr+Fr|0,gr=rotl(gr^Dr,7),Wt=Wt+er|0,fr=rotl(fr^Wt,16),Tr=Tr+fr|0,er=rotl(er^Tr,12),Wt=Wt+er|0,fr=rotl(fr^Wt,8),Tr=Tr+fr|0,er=rotl(er^Tr,7),Zt=Zt+mr|0,yr=rotl(yr^Zt,16),Mr=Mr+yr|0,mr=rotl(mr^Mr,12),Zt=Zt+mr|0,yr=rotl(yr^Zt,8),Mr=Mr+yr|0,mr=rotl(mr^Mr,7),cr=cr+hr|0,$r=rotl($r^cr,16),wr=wr+$r|0,hr=rotl(hr^wr,12),cr=cr+hr|0,$r=rotl($r^cr,8),wr=wr+$r|0,hr=rotl(hr^wr,7);let dr=0;c[dr++]=et+Kt|0,c[dr++]=ft+Wt|0,c[dr++]=gt+Zt|0,c[dr++]=_t+cr|0,c[dr++]=wt+hr|0,c[dr++]=$t+gr|0,c[dr++]=It+er|0,c[dr++]=Rt+mr|0,c[dr++]=Tt+Mr|0,c[dr++]=At+wr|0,c[dr++]=kt+Dr|0,c[dr++]=xt+Tr|0,c[dr++]=Nt+fr|0,c[dr++]=Ft+yr|0,c[dr++]=jt+$r|0,c[dr++]=Gt+Fr|0}const chacha20=createCipher(chachaCore,{counterRight:!1,counterLength:4,allowShortKeys:!1}),ZEROS16=new Uint8Array(16),updatePadded=(i,e)=>{i.update(e);const a=e.length%16;a&&i.update(ZEROS16.subarray(a))},ZEROS32=new Uint8Array(32);function computeTag(i,e,a,c,h){const d=i(e,a,ZEROS32),et=poly1305.create(d);h&&updatePadded(et,h),updatePadded(et,c);const ft=new Uint8Array(16),gt=createView(ft);setBigUint64(gt,0,BigInt(h?h.length:0),!0),setBigUint64(gt,8,BigInt(c.length),!0),et.update(ft);const _t=et.digest();return d.fill(0),_t}const _poly1305_aead=i=>(e,a,c)=>(ensureBytes(e,32),ensureBytes(a),{encrypt:(d,et)=>{const ft=d.length,gt=ft+16;et?ensureBytes(et,gt):et=new Uint8Array(gt),i(e,a,d,et,1);const _t=computeTag(i,e,a,et.subarray(0,-16),c);return et.set(_t,ft),et},decrypt:(d,et)=>{const ft=d.length,gt=ft-16;if(ft<16)throw new Error("encrypted data must be at least 16 bytes");et?ensureBytes(et,gt):et=new Uint8Array(gt);const _t=d.subarray(0,-16),wt=d.subarray(-16),$t=computeTag(i,e,a,_t,c);if(!equalBytes(wt,$t))throw new Error("invalid tag");return i(e,a,_t,et,1),et}}),chacha20poly1305=wrapCipher({blockSize:64,nonceLength:12,tagLength:16},_poly1305_aead(chacha20));function extract(i,e,a){return hash$1(i),a===void 0&&(a=new Uint8Array(i.outputLen)),hmac$1(i,toBytes$2(a),toBytes$2(e))}const HKDF_COUNTER=new Uint8Array([0]),EMPTY_BUFFER=new Uint8Array;function expand(i,e,a,c=32){if(hash$1(i),number$2(c),c>255*i.outputLen)throw new Error("Length should be <= 255*HashLen");const h=Math.ceil(c/i.outputLen);a===void 0&&(a=EMPTY_BUFFER);const d=new Uint8Array(h*i.outputLen),et=hmac$1.create(i,e),ft=et._cloneInto(),gt=new Uint8Array(et.outputLen);for(let _t=0;_t<h;_t++)HKDF_COUNTER[0]=_t+1,ft.update(_t===0?EMPTY_BUFFER:gt).update(a).update(HKDF_COUNTER).digestInto(gt),d.set(gt,i.outputLen*_t),et._cloneInto(ft);return et.destroy(),ft.destroy(),gt.fill(0),HKDF_COUNTER.fill(0),d.slice(0,c)}const pureJsCrypto={hashSHA256(i){return sha256$3(i)},getHKDF(i,e){const a=extract(sha256$3,e,i),h=expand(sha256$3,a,void 0,96),d=h.subarray(0,32),et=h.subarray(32,64),ft=h.subarray(64,96);return[d,et,ft]},generateX25519KeyPair(){const i=x25519.utils.randomPrivateKey();return{publicKey:x25519.getPublicKey(i),privateKey:i}},generateX25519KeyPairFromSeed(i){return{publicKey:x25519.getPublicKey(i),privateKey:i}},generateX25519SharedKey(i,e){return x25519.getSharedSecret(i,e)},chaCha20Poly1305Encrypt(i,e,a,c){return chacha20poly1305(c,e,a).encrypt(i)},chaCha20Poly1305Decrypt(i,e,a,c,h){return chacha20poly1305(c,e,a).decrypt(i,h)}},defaultCrypto=pureJsCrypto;function concat(i,e){e==null&&(e=i.reduce((h,d)=>h+d.length,0));const a=allocUnsafe$8(e);let c=0;for(const h of i)a.set(h,c),c+=h.length;return asUint8Array$2(a)}const uint16BEEncode=i=>{const e=allocUnsafe$8(2);return new DataView(e.buffer,e.byteOffset,e.byteLength).setUint16(0,i,!1),e};uint16BEEncode.bytes=2;const uint16BEDecode=i=>{if(i.length<2)throw RangeError("Could not decode int16BE");return i instanceof Uint8Array?new DataView(i.buffer,i.byteOffset,i.byteLength).getUint16(0,!1):i.getUint16(0)};uint16BEDecode.bytes=2;function encode0(i){return concat([i.ne,i.ciphertext],i.ne.length+i.ciphertext.length)}function encode1(i){return concat([i.ne,i.ns,i.ciphertext],i.ne.length+i.ns.length+i.ciphertext.length)}function encode2(i){return concat([i.ns,i.ciphertext],i.ns.length+i.ciphertext.length)}function decode0(i){if(i.length<32)throw new Error("Cannot decode stage 0 MessageBuffer: length less than 32 bytes.");return{ne:i.subarray(0,32),ciphertext:i.subarray(32,i.length),ns:alloc$3(0)}}function decode1(i){if(i.length<80)throw new Error("Cannot decode stage 1 MessageBuffer: length less than 80 bytes.");return{ne:i.subarray(0,32),ns:i.subarray(32,80),ciphertext:i.subarray(80,i.length)}}function decode2(i){if(i.length<48)throw new Error("Cannot decode stage 2 MessageBuffer: length less than 48 bytes.");return{ne:alloc$3(0),ns:i.subarray(0,48),ciphertext:i.subarray(48,i.length)}}const CHACHA_TAG_LENGTH=16;function encryptStream(i,e){return async function*(a){for await(const c of a)for(let h=0;h<c.length;h+=NOISE_MSG_MAX_LENGTH_BYTES_WITHOUT_TAG){let d=h+NOISE_MSG_MAX_LENGTH_BYTES_WITHOUT_TAG;d>c.length&&(d=c.length);const et=i.encrypt(c.subarray(h,d),i.session);e==null||e.encryptedPackets.increment(),yield concat([uint16BEEncode(et.byteLength),et],2+et.byteLength)}}}function decryptStream(i,e){return async function*(a){for await(const c of a)for(let h=0;h<c.length;h+=NOISE_MSG_MAX_LENGTH_BYTES){let d=h+NOISE_MSG_MAX_LENGTH_BYTES;if(d>c.length&&(d=c.length),d-CHACHA_TAG_LENGTH<h)throw new Error("Invalid chunk");const et=c.subarray(h,d),ft=c.subarray(h,d-CHACHA_TAG_LENGTH),{plaintext:gt,valid:_t}=i.decrypt(et,i.session,ft);if(!_t)throw e==null||e.decryptErrors.increment(),new Error("Failed to validate decrypted chunk");e==null||e.decryptedPackets.increment(),yield gt}}}const PUBLIC_KEY_BYTE_LENGTH=32,PRIVATE_KEY_BYTE_LENGTH=64,KEYS_BYTE_LENGTH=32;async function generateKey$2(){const i=ed25519.utils.randomPrivateKey(),e=ed25519.getPublicKey(i);return{privateKey:concatKeys(i,e),publicKey:e}}async function generateKeyFromSeed(i){if(i.length!==KEYS_BYTE_LENGTH)throw new TypeError('"seed" must be 32 bytes in length.');if(!(i instanceof Uint8Array))throw new TypeError('"seed" must be a node.js Buffer, or Uint8Array.');const e=i,a=ed25519.getPublicKey(e);return{privateKey:concatKeys(e,a),publicKey:a}}async function hashAndSign$2(i,e){const a=i.subarray(0,KEYS_BYTE_LENGTH);return ed25519.sign(e,a)}async function hashAndVerify$2(i,e,a){return ed25519.verify(e,a,i)}function concatKeys(i,e){const a=new Uint8Array(PRIVATE_KEY_BYTE_LENGTH);for(let c=0;c<KEYS_BYTE_LENGTH;c++)a[c]=i[c],a[KEYS_BYTE_LENGTH+c]=e[c];return a}const webcrypto={get(i=globalThis){const e=i.crypto;if(e==null||e.subtle==null)throw Object.assign(new Error("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p-crypto/blob/master/README.md#web-crypto-api"),{code:"ERR_MISSING_WEB_CRYPTO"});return e}},derivedEmptyPasswordKey={alg:"A128GCM",ext:!0,k:"scm9jmO_4BJAgdwWGVulLg",key_ops:["encrypt","decrypt"],kty:"oct"};function create(i){const e=(i==null?void 0:i.algorithm)??"AES-GCM";let a=(i==null?void 0:i.keyLength)??16;const c=(i==null?void 0:i.nonceLength)??12,h=(i==null?void 0:i.digest)??"SHA-256",d=(i==null?void 0:i.saltLength)??16,et=(i==null?void 0:i.iterations)??32767,ft=webcrypto.get();a*=8;async function gt($t,It){const Rt=ft.getRandomValues(new Uint8Array(d)),Tt=ft.getRandomValues(new Uint8Array(c)),At={name:e,iv:Tt};typeof It=="string"&&(It=fromString$9(It));let kt;if(It.length===0){kt=await ft.subtle.importKey("jwk",derivedEmptyPasswordKey,{name:"AES-GCM"},!0,["encrypt"]);try{const Nt={name:"PBKDF2",salt:Rt,iterations:et,hash:{name:h}},Ft=await ft.subtle.importKey("raw",It,{name:"PBKDF2"},!1,["deriveKey"]);kt=await ft.subtle.deriveKey(Nt,Ft,{name:e,length:a},!0,["encrypt"])}catch{kt=await ft.subtle.importKey("jwk",derivedEmptyPasswordKey,{name:"AES-GCM"},!0,["encrypt"])}}else{const Nt={name:"PBKDF2",salt:Rt,iterations:et,hash:{name:h}},Ft=await ft.subtle.importKey("raw",It,{name:"PBKDF2"},!1,["deriveKey"]);kt=await ft.subtle.deriveKey(Nt,Ft,{name:e,length:a},!0,["encrypt"])}const xt=await ft.subtle.encrypt(At,kt,$t);return concat([Rt,At.iv,new Uint8Array(xt)])}async function _t($t,It){const Rt=$t.subarray(0,d),Tt=$t.subarray(d,d+c),At=$t.subarray(d+c),kt={name:e,iv:Tt};typeof It=="string"&&(It=fromString$9(It));let xt;if(It.length===0)try{const Ft={name:"PBKDF2",salt:Rt,iterations:et,hash:{name:h}},jt=await ft.subtle.importKey("raw",It,{name:"PBKDF2"},!1,["deriveKey"]);xt=await ft.subtle.deriveKey(Ft,jt,{name:e,length:a},!0,["decrypt"])}catch{xt=await ft.subtle.importKey("jwk",derivedEmptyPasswordKey,{name:"AES-GCM"},!0,["decrypt"])}else{const Ft={name:"PBKDF2",salt:Rt,iterations:et,hash:{name:h}},jt=await ft.subtle.importKey("raw",It,{name:"PBKDF2"},!1,["deriveKey"]);xt=await ft.subtle.deriveKey(Ft,jt,{name:e,length:a},!0,["decrypt"])}const Nt=await ft.subtle.decrypt(kt,xt,At);return new Uint8Array(Nt)}return{encrypt:gt,decrypt:_t}}async function exporter(i,e){const c=await create().encrypt(i,e);return base64$c.encode(c)}var KeyType;(function(i){i.RSA="RSA",i.Ed25519="Ed25519",i.Secp256k1="Secp256k1"})(KeyType||(KeyType={}));var __KeyTypeValues;(function(i){i[i.RSA=0]="RSA",i[i.Ed25519=1]="Ed25519",i[i.Secp256k1=2]="Secp256k1"})(__KeyTypeValues||(__KeyTypeValues={}));(function(i){i.codec=()=>enumeration(__KeyTypeValues)})(KeyType||(KeyType={}));var PublicKey;(function(i){let e;i.codec=()=>(e==null&&(e=message((a,c,h={})=>{h.lengthDelimited!==!1&&c.fork(),a.Type!=null&&(c.uint32(8),KeyType.codec().encode(a.Type,c)),a.Data!=null&&(c.uint32(18),c.bytes(a.Data)),h.lengthDelimited!==!1&&c.ldelim()},(a,c)=>{const h={},d=c==null?a.len:a.pos+c;for(;a.pos<d;){const et=a.uint32();switch(et>>>3){case 1:h.Type=KeyType.codec().decode(a);break;case 2:h.Data=a.bytes();break;default:a.skipType(et&7);break}}return h})),e),i.encode=a=>encodeMessage(a,i.codec()),i.decode=a=>decodeMessage$1(a,i.codec())})(PublicKey||(PublicKey={}));var PrivateKey;(function(i){let e;i.codec=()=>(e==null&&(e=message((a,c,h={})=>{h.lengthDelimited!==!1&&c.fork(),a.Type!=null&&(c.uint32(8),KeyType.codec().encode(a.Type,c)),a.Data!=null&&(c.uint32(18),c.bytes(a.Data)),h.lengthDelimited!==!1&&c.ldelim()},(a,c)=>{const h={},d=c==null?a.len:a.pos+c;for(;a.pos<d;){const et=a.uint32();switch(et>>>3){case 1:h.Type=KeyType.codec().decode(a);break;case 2:h.Data=a.bytes();break;default:a.skipType(et&7);break}}return h})),e),i.encode=a=>encodeMessage(a,i.codec()),i.decode=a=>decodeMessage$1(a,i.codec())})(PrivateKey||(PrivateKey={}));class Ed25519PublicKey{constructor(e){qt(this,"_key");this._key=ensureKey(e,PUBLIC_KEY_BYTE_LENGTH)}async verify(e,a){return hashAndVerify$2(this._key,a,e)}marshal(){return this._key}get bytes(){return PublicKey.encode({Type:KeyType.Ed25519,Data:this.marshal()}).subarray()}equals(e){return equals$1(this.bytes,e.bytes)}async hash(){const{bytes:e}=await sha256$2.digest(this.bytes);return e}}class Ed25519PrivateKey{constructor(e,a){qt(this,"_key");qt(this,"_publicKey");this._key=ensureKey(e,PRIVATE_KEY_BYTE_LENGTH),this._publicKey=ensureKey(a,PUBLIC_KEY_BYTE_LENGTH)}async sign(e){return hashAndSign$2(this._key,e)}get public(){return new Ed25519PublicKey(this._publicKey)}marshal(){return this._key}get bytes(){return PrivateKey.encode({Type:KeyType.Ed25519,Data:this.marshal()}).subarray()}equals(e){return equals$1(this.bytes,e.bytes)}async hash(){const{bytes:e}=await sha256$2.digest(this.bytes);return e}async id(){const e=identity$6.digest(this.public.bytes);return base58btc$6.encode(e.bytes).substring(1)}async export(e,a="libp2p-key"){if(a==="libp2p-key")return exporter(this.bytes,e);throw new CodeError$2(`export format '${a}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}}function unmarshalEd25519PrivateKey(i){if(i.length>PRIVATE_KEY_BYTE_LENGTH){i=ensureKey(i,PRIVATE_KEY_BYTE_LENGTH+PUBLIC_KEY_BYTE_LENGTH);const c=i.subarray(0,PRIVATE_KEY_BYTE_LENGTH),h=i.subarray(PRIVATE_KEY_BYTE_LENGTH,i.length);return new Ed25519PrivateKey(c,h)}i=ensureKey(i,PRIVATE_KEY_BYTE_LENGTH);const e=i.subarray(0,PRIVATE_KEY_BYTE_LENGTH),a=i.subarray(PUBLIC_KEY_BYTE_LENGTH);return new Ed25519PrivateKey(e,a)}function unmarshalEd25519PublicKey(i){return i=ensureKey(i,PUBLIC_KEY_BYTE_LENGTH),new Ed25519PublicKey(i)}async function generateKeyPair$3(){const{privateKey:i,publicKey:e}=await generateKey$2();return new Ed25519PrivateKey(i,e)}async function generateKeyPairFromSeed(i){const{privateKey:e,publicKey:a}=await generateKeyFromSeed(i);return new Ed25519PrivateKey(e,a)}function ensureKey(i,e){if(i=Uint8Array.from(i??[]),i.length!==e)throw new CodeError$2(`Key must be a Uint8Array of length ${e}, got ${i.length}`,"ERR_INVALID_KEY_TYPE");return i}const Ed25519=Object.freeze(Object.defineProperty({__proto__:null,Ed25519PrivateKey,Ed25519PublicKey,generateKeyPair:generateKeyPair$3,generateKeyPairFromSeed,unmarshalEd25519PrivateKey,unmarshalEd25519PublicKey},Symbol.toStringTag,{value:"Module"}));function bigIntegerToUintBase64url(i,e){let a=Uint8Array.from(i.abs().toByteArray());if(a=a[0]===0?a.subarray(1):a,e!=null){if(a.length>e)throw new Error("byte array longer than desired length");a=concat([new Uint8Array(e-a.length),a])}return toString$d(a,"base64url")}function base64urlToBigInteger(i){const e=base64urlToBuffer(i);return new forge$n.jsbn.BigInteger(toString$d(e,"base16"),16)}function base64urlToBuffer(i,e){let a=fromString$9(i,"base64urlpad");if(e!=null){if(a.length>e)throw new Error("byte array longer than desired length");a=concat([new Uint8Array(e-a.length),a])}return a}const bits={"P-256":256,"P-384":384,"P-521":521},curveTypes=Object.keys(bits);curveTypes.join(" / ");async function importer(i,e){const a=base64$c.decode(i);return create().decrypt(a,e)}function randomBytes(i){if(isNaN(i)||i<=0)throw new CodeError$2("random bytes length must be a Number bigger than 0","ERR_INVALID_LENGTH");return randomBytes$2(i)}function convert(i,e){return e.map(a=>base64urlToBigInteger(i[a]))}function jwk2priv(i){return forge$n.pki.setRsaPrivateKey(...convert(i,["n","e","d","p","q","dp","dq","qi"]))}function jwk2pub(i){return forge$n.pki.setRsaPublicKey(...convert(i,["n","e"]))}function pkcs1ToJwk(i){const e=forge$n.asn1.fromDer(toString$d(i,"ascii")),a=forge$n.pki.privateKeyFromAsn1(e);return{kty:"RSA",n:bigIntegerToUintBase64url(a.n),e:bigIntegerToUintBase64url(a.e),d:bigIntegerToUintBase64url(a.d),p:bigIntegerToUintBase64url(a.p),q:bigIntegerToUintBase64url(a.q),dp:bigIntegerToUintBase64url(a.dP),dq:bigIntegerToUintBase64url(a.dQ),qi:bigIntegerToUintBase64url(a.qInv),alg:"RS256"}}function jwkToPkcs1(i){if(i.n==null||i.e==null||i.d==null||i.p==null||i.q==null||i.dp==null||i.dq==null||i.qi==null)throw new CodeError$2("JWK was missing components","ERR_INVALID_PARAMETERS");const e=forge$n.pki.privateKeyToAsn1({n:base64urlToBigInteger(i.n),e:base64urlToBigInteger(i.e),d:base64urlToBigInteger(i.d),p:base64urlToBigInteger(i.p),q:base64urlToBigInteger(i.q),dP:base64urlToBigInteger(i.dp),dQ:base64urlToBigInteger(i.dq),qInv:base64urlToBigInteger(i.qi)});return fromString$9(forge$n.asn1.toDer(e).getBytes(),"ascii")}function pkixToJwk(i){const e=forge$n.asn1.fromDer(toString$d(i,"ascii")),a=forge$n.pki.publicKeyFromAsn1(e);return{kty:"RSA",n:bigIntegerToUintBase64url(a.n),e:bigIntegerToUintBase64url(a.e)}}function jwkToPkix(i){if(i.n==null||i.e==null)throw new CodeError$2("JWK was missing components","ERR_INVALID_PARAMETERS");const e=forge$n.pki.publicKeyToAsn1({n:base64urlToBigInteger(i.n),e:base64urlToBigInteger(i.e)});return fromString$9(forge$n.asn1.toDer(e).getBytes(),"ascii")}async function generateKey$1(i){const e=await webcrypto.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:i,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]),a=await exportKey(e);return{privateKey:a[0],publicKey:a[1]}}async function unmarshalPrivateKey$1(i){const a=[await webcrypto.get().subtle.importKey("jwk",i,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]),await derivePublicFromPrivate(i)],c=await exportKey({privateKey:a[0],publicKey:a[1]});return{privateKey:c[0],publicKey:c[1]}}async function hashAndSign$1(i,e){const a=await webcrypto.get().subtle.importKey("jwk",i,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]),c=await webcrypto.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},a,Uint8Array.from(e));return new Uint8Array(c,0,c.byteLength)}async function hashAndVerify$1(i,e,a){const c=await webcrypto.get().subtle.importKey("jwk",i,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return webcrypto.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},c,e,a)}async function exportKey(i){if(i.privateKey==null||i.publicKey==null)throw new CodeError$2("Private and public key are required","ERR_INVALID_PARAMETERS");return Promise.all([webcrypto.get().subtle.exportKey("jwk",i.privateKey),webcrypto.get().subtle.exportKey("jwk",i.publicKey)])}async function derivePublicFromPrivate(i){return webcrypto.get().subtle.importKey("jwk",{kty:i.kty,n:i.n,e:i.e},{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"])}function convertKey(i,e,a,c){const h=e?jwk2pub(i):jwk2priv(i),d=toString$d(Uint8Array.from(a),"ascii"),et=c(d,h);return fromString$9(et,"ascii")}function encrypt(i,e){return convertKey(i,!0,e,(a,c)=>c.encrypt(a))}function decrypt(i,e){return convertKey(i,!1,e,(a,c)=>c.decrypt(a))}function keySize(i){if(i.kty!=="RSA")throw new CodeError$2("invalid key type","ERR_INVALID_KEY_TYPE");if(i.n==null)throw new CodeError$2("invalid key modulus","ERR_INVALID_KEY_MODULUS");return fromString$9(i.n,"base64url").length*8}const MAX_KEY_SIZE=8192;class RsaPublicKey{constructor(e){qt(this,"_key");this._key=e}async verify(e,a){return hashAndVerify$1(this._key,a,e)}marshal(){return jwkToPkix(this._key)}get bytes(){return PublicKey.encode({Type:KeyType.RSA,Data:this.marshal()}).subarray()}encrypt(e){return encrypt(this._key,e)}equals(e){return equals$1(this.bytes,e.bytes)}async hash(){const{bytes:e}=await sha256$2.digest(this.bytes);return e}}class RsaPrivateKey{constructor(e,a){qt(this,"_key");qt(this,"_publicKey");this._key=e,this._publicKey=a}genSecret(){return randomBytes(16)}async sign(e){return hashAndSign$1(this._key,e)}get public(){if(this._publicKey==null)throw new CodeError$2("public key not provided","ERR_PUBKEY_NOT_PROVIDED");return new RsaPublicKey(this._publicKey)}decrypt(e){return decrypt(this._key,e)}marshal(){return jwkToPkcs1(this._key)}get bytes(){return PrivateKey.encode({Type:KeyType.RSA,Data:this.marshal()}).subarray()}equals(e){return equals$1(this.bytes,e.bytes)}async hash(){const{bytes:e}=await sha256$2.digest(this.bytes);return e}async id(){const e=await this.public.hash();return toString$d(e,"base58btc")}async export(e,a="pkcs-8"){if(a==="pkcs-8"){const c=new forge$n.util.ByteBuffer(this.marshal()),h=forge$n.asn1.fromDer(c),d=forge$n.pki.privateKeyFromAsn1(h),et={algorithm:"aes256",count:1e4,saltSize:128/8,prfAlgorithm:"sha512"};return forge$n.pki.encryptRsaPrivateKey(d,e,et)}else{if(a==="libp2p-key")return exporter(this.bytes,e);throw new CodeError$2(`export format '${a}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}}}async function unmarshalRsaPrivateKey(i){const e=pkcs1ToJwk(i);if(keySize(e)>MAX_KEY_SIZE)throw new CodeError$2("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const a=await unmarshalPrivateKey$1(e);return new RsaPrivateKey(a.privateKey,a.publicKey)}function unmarshalRsaPublicKey(i){const e=pkixToJwk(i);if(keySize(e)>MAX_KEY_SIZE)throw new CodeError$2("key size is too large","ERR_KEY_SIZE_TOO_LARGE");return new RsaPublicKey(e)}async function fromJwk(i){if(keySize(i)>MAX_KEY_SIZE)throw new CodeError$2("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const e=await unmarshalPrivateKey$1(i);return new RsaPrivateKey(e.privateKey,e.publicKey)}async function generateKeyPair$2(i){if(i>MAX_KEY_SIZE)throw new CodeError$2("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const e=await generateKey$1(i);return new RsaPrivateKey(e.privateKey,e.publicKey)}const RSA=Object.freeze(Object.defineProperty({__proto__:null,MAX_KEY_SIZE,RsaPrivateKey,RsaPublicKey,fromJwk,generateKeyPair:generateKeyPair$2,unmarshalRsaPrivateKey,unmarshalRsaPublicKey},Symbol.toStringTag,{value:"Module"}));function generateKey(){return secp256k1.utils.randomPrivateKey()}async function hashAndSign(i,e){const{digest:a}=await sha256$2.digest(e);try{return secp256k1.sign(a,i).toDERRawBytes()}catch(c){throw new CodeError$2(String(c),"ERR_INVALID_INPUT")}}async function hashAndVerify(i,e,a){try{const{digest:c}=await sha256$2.digest(a);return secp256k1.verify(e,c,i)}catch(c){throw new CodeError$2(String(c),"ERR_INVALID_INPUT")}}function compressPublicKey(i){return secp256k1.ProjectivePoint.fromHex(i).toRawBytes(!0)}function validatePrivateKey(i){try{secp256k1.getPublicKey(i,!0)}catch(e){throw new CodeError$2(String(e),"ERR_INVALID_PRIVATE_KEY")}}function validatePublicKey(i){try{secp256k1.ProjectivePoint.fromHex(i)}catch(e){throw new CodeError$2(String(e),"ERR_INVALID_PUBLIC_KEY")}}function computePublicKey(i){try{return secp256k1.getPublicKey(i,!0)}catch(e){throw new CodeError$2(String(e),"ERR_INVALID_PRIVATE_KEY")}}class Secp256k1PublicKey{constructor(e){qt(this,"_key");validatePublicKey(e),this._key=e}async verify(e,a){return hashAndVerify(this._key,a,e)}marshal(){return compressPublicKey(this._key)}get bytes(){return PublicKey.encode({Type:KeyType.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return equals$1(this.bytes,e.bytes)}async hash(){const{bytes:e}=await sha256$2.digest(this.bytes);return e}}class Secp256k1PrivateKey{constructor(e,a){qt(this,"_key");qt(this,"_publicKey");this._key=e,this._publicKey=a??computePublicKey(e),validatePrivateKey(this._key),validatePublicKey(this._publicKey)}async sign(e){return hashAndSign(this._key,e)}get public(){return new Secp256k1PublicKey(this._publicKey)}marshal(){return this._key}get bytes(){return PrivateKey.encode({Type:KeyType.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return equals$1(this.bytes,e.bytes)}async hash(){const{bytes:e}=await sha256$2.digest(this.bytes);return e}async id(){const e=await this.public.hash();return toString$d(e,"base58btc")}async export(e,a="libp2p-key"){if(a==="libp2p-key")return exporter(this.bytes,e);throw new CodeError$2(`export format '${a}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}}function unmarshalSecp256k1PrivateKey(i){return new Secp256k1PrivateKey(i)}function unmarshalSecp256k1PublicKey(i){return new Secp256k1PublicKey(i)}async function generateKeyPair$1(){const i=generateKey();return new Secp256k1PrivateKey(i)}const Secp256k1=Object.freeze(Object.defineProperty({__proto__:null,Secp256k1PrivateKey,Secp256k1PublicKey,generateKeyPair:generateKeyPair$1,unmarshalSecp256k1PrivateKey,unmarshalSecp256k1PublicKey},Symbol.toStringTag,{value:"Module"})),supportedKeys={rsa:RSA,ed25519:Ed25519,secp256k1:Secp256k1};function unsupportedKey(i){const e=Object.keys(supportedKeys).join(" / ");return new CodeError$2(`invalid or unsupported key type ${i}. Must be ${e}`,"ERR_UNSUPPORTED_KEY_TYPE")}function typeToKey(i){if(i=i.toLowerCase(),i==="rsa"||i==="ed25519"||i==="secp256k1")return supportedKeys[i];throw unsupportedKey(i)}async function generateKeyPair(i,e){return typeToKey(i).generateKeyPair(e??2048)}function unmarshalPublicKey(i){const e=PublicKey.decode(i),a=e.Data??new Uint8Array;switch(e.Type){case KeyType.RSA:return supportedKeys.rsa.unmarshalRsaPublicKey(a);case KeyType.Ed25519:return supportedKeys.ed25519.unmarshalEd25519PublicKey(a);case KeyType.Secp256k1:return supportedKeys.secp256k1.unmarshalSecp256k1PublicKey(a);default:throw unsupportedKey(e.Type??"unknown")}}function marshalPublicKey(i,e){return e=(e??"rsa").toLowerCase(),typeToKey(e),i.bytes}async function unmarshalPrivateKey(i){const e=PrivateKey.decode(i),a=e.Data??new Uint8Array;switch(e.Type){case KeyType.RSA:return supportedKeys.rsa.unmarshalRsaPrivateKey(a);case KeyType.Ed25519:return supportedKeys.ed25519.unmarshalEd25519PrivateKey(a);case KeyType.Secp256k1:return supportedKeys.secp256k1.unmarshalSecp256k1PrivateKey(a);default:throw unsupportedKey(e.Type??"RSA")}}function marshalPrivateKey(i,e){return e=(e??"rsa").toLowerCase(),typeToKey(e),i.bytes}async function importKey(i,e){try{const h=await importer(i,e);return await unmarshalPrivateKey(h)}catch{}const a=forge$n.pki.decryptRsaPrivateKey(i,e);if(a===null)throw new CodeError$2("Cannot read the key, most likely the password is wrong or not a RSA key","ERR_CANNOT_DECRYPT_PEM");let c=forge$n.asn1.toDer(forge$n.pki.privateKeyToAsn1(a));return c=fromString$9(c.getBytes(),"ascii"),supportedKeys.rsa.unmarshalRsaPrivateKey(c)}var NoiseExtensions;(function(i){let e;i.codec=()=>(e==null&&(e=message((a,c,h={})=>{if(h.lengthDelimited!==!1&&c.fork(),a.webtransportCerthashes!=null)for(const d of a.webtransportCerthashes)c.uint32(10),c.bytes(d);h.lengthDelimited!==!1&&c.ldelim()},(a,c)=>{const h={webtransportCerthashes:[]},d=c==null?a.len:a.pos+c;for(;a.pos<d;){const et=a.uint32();switch(et>>>3){case 1:{h.webtransportCerthashes.push(a.bytes());break}default:{a.skipType(et&7);break}}}return h})),e),i.encode=a=>encodeMessage(a,i.codec()),i.decode=a=>decodeMessage$1(a,i.codec())})(NoiseExtensions||(NoiseExtensions={}));var NoiseHandshakePayload;(function(i){let e;i.codec=()=>(e==null&&(e=message((a,c,h={})=>{h.lengthDelimited!==!1&&c.fork(),a.identityKey!=null&&a.identityKey.byteLength>0&&(c.uint32(10),c.bytes(a.identityKey)),a.identitySig!=null&&a.identitySig.byteLength>0&&(c.uint32(18),c.bytes(a.identitySig)),a.extensions!=null&&(c.uint32(34),NoiseExtensions.codec().encode(a.extensions,c)),h.lengthDelimited!==!1&&c.ldelim()},(a,c)=>{const h={identityKey:alloc$3(0),identitySig:alloc$3(0)},d=c==null?a.len:a.pos+c;for(;a.pos<d;){const et=a.uint32();switch(et>>>3){case 1:{h.identityKey=a.bytes();break}case 2:{h.identitySig=a.bytes();break}case 4:{h.extensions=NoiseExtensions.codec().decode(a,a.uint32());break}default:{a.skipType(et&7);break}}}return h})),e),i.encode=a=>encodeMessage(a,i.codec()),i.decode=a=>decodeMessage$1(a,i.codec())})(NoiseHandshakePayload||(NoiseHandshakePayload={}));async function getPayload(i,e,a){const c=await signPayload(i,getHandshakePayload(e));if(i.publicKey==null)throw new Error("PublicKey was missing from local PeerId");return createHandshakePayload(i.publicKey,c,a)}function createHandshakePayload(i,e,a){return NoiseHandshakePayload.encode({identityKey:i,identitySig:e,extensions:a??{webtransportCerthashes:[]}}).subarray()}async function signPayload(i,e){if(i.privateKey==null)throw new Error("PrivateKey was missing from PeerId");return(await unmarshalPrivateKey(i.privateKey)).sign(e)}async function getPeerIdFromPayload(i){return peerIdFromKeys(i.identityKey)}function decodePayload(i){return NoiseHandshakePayload.decode(i)}function getHandshakePayload(i){const e=fromString$9("noise-libp2p-static-key:");return concat([e,i],e.length+i.length)}async function verifySignedPayload(i,e,a){const c=await peerIdFromKeys(e.identityKey);if(!c.equals(a))throw new Error(`Payload identity key ${c.toString()} does not match expected remote peer ${a.toString()}`);const h=getHandshakePayload(i);if(c.publicKey==null)throw new Error("PublicKey was missing from PeerId");if(e.identitySig==null)throw new Error("Signature was missing from message");if(!await unmarshalPublicKey(c.publicKey).verify(h,e.identitySig))throw new Error("Static key doesn't match to peer that signed payload!");return c}function isValidPublicKey(i){return!(!(i instanceof Uint8Array)||i.length!==32)}debug.formatters.b=i=>i==null?"undefined":base58btc$6.baseEncode(i);debug.formatters.t=i=>i==null?"undefined":base32$c.baseEncode(i);debug.formatters.m=i=>i==null?"undefined":base64$c.baseEncode(i);debug.formatters.p=i=>i==null?"undefined":i.toString();debug.formatters.c=i=>i==null?"undefined":i.toString();debug.formatters.k=i=>i==null?"undefined":i.toString();debug.formatters.a=i=>i==null?"undefined":i.toString();function createDisabledLogger(i){const e=()=>{};return e.enabled=!1,e.color="",e.diff=0,e.log=()=>{},e.namespace=i,e.destroy=()=>!0,e.extend=()=>e,e}function defaultLogger(){return{forComponent(i){return logger$2(i)}}}function logger$2(i){let e=createDisabledLogger(`${i}:trace`);return debug.enabled(`${i}:trace`)&&debug.names.map(a=>a.toString()).find(a=>a.includes(":trace"))!=null&&(e=debug(`${i}:trace`)),Object.assign(debug(i),{error:debug(`${i}:error`),trace:e})}const log$o=logger$2("libp2p:noise");let keyLogger;DUMP_SESSION_KEYS?keyLogger=log$o:keyLogger=Object.assign(()=>{},{enabled:!1,trace:()=>{},error:()=>{}});function logLocalStaticKeys(i){keyLogger(`LOCAL_STATIC_PUBLIC_KEY ${toString$d(i.publicKey,"hex")}`),keyLogger(`LOCAL_STATIC_PRIVATE_KEY ${toString$d(i.privateKey,"hex")}`)}function logLocalEphemeralKeys(i){i?(keyLogger(`LOCAL_PUBLIC_EPHEMERAL_KEY ${toString$d(i.publicKey,"hex")}`),keyLogger(`LOCAL_PRIVATE_EPHEMERAL_KEY ${toString$d(i.privateKey,"hex")}`)):keyLogger("Missing local ephemeral keys.")}function logRemoteStaticKey(i){keyLogger(`REMOTE_STATIC_PUBLIC_KEY ${toString$d(i,"hex")}`)}function logRemoteEphemeralKey(i){keyLogger(`REMOTE_EPHEMERAL_PUBLIC_KEY ${toString$d(i,"hex")}`)}function logCipherState(i){i.cs1&&i.cs2?(keyLogger(`CIPHER_STATE_1 ${i.cs1.n.getUint64()} ${toString$d(i.cs1.k,"hex")}`),keyLogger(`CIPHER_STATE_2 ${i.cs2.n.getUint64()} ${toString$d(i.cs2.k,"hex")}`)):keyLogger("Missing cipher state.")}const MIN_NONCE=0,MAX_NONCE=4294967295,ERR_MAX_NONCE="Cipherstate has reached maximum n, a new handshake must be performed";class Nonce{constructor(e=MIN_NONCE){qt(this,"n");qt(this,"bytes");qt(this,"view");this.n=e,this.bytes=alloc$3(12),this.view=new DataView(this.bytes.buffer,this.bytes.byteOffset,this.bytes.byteLength),this.view.setUint32(4,e,!0)}increment(){this.n++,this.view.setUint32(4,this.n,!0)}getBytes(){return this.bytes}getUint64(){return this.n}assertValue(){if(this.n>MAX_NONCE)throw new Error(ERR_MAX_NONCE)}}class AbstractHandshake{constructor(e){qt(this,"crypto");this.crypto=e}encryptWithAd(e,a,c){const h=this.encrypt(e.k,e.n,a,c);return e.n.increment(),h}decryptWithAd(e,a,c,h){const{plaintext:d,valid:et}=this.decrypt(e.k,e.n,a,c,h);return et&&e.n.increment(),{plaintext:d,valid:et}}hasKey(e){return!this.isEmptyKey(e.k)}createEmptyKey(){return alloc$3(32)}isEmptyKey(e){const a=this.createEmptyKey();return equals$1(a,e)}encrypt(e,a,c,h){return a.assertValue(),this.crypto.chaCha20Poly1305Encrypt(h,a.getBytes(),c,e)}encryptAndHash(e,a){let c;return this.hasKey(e.cs)?c=this.encryptWithAd(e.cs,e.h,a):c=a,this.mixHash(e,c),c}decrypt(e,a,c,h,d){a.assertValue();const et=this.crypto.chaCha20Poly1305Decrypt(h,a.getBytes(),c,e,d);return et?{plaintext:et,valid:!0}:{plaintext:alloc$3(0),valid:!1}}decryptAndHash(e,a){let c,h=!0;return this.hasKey(e.cs)?{plaintext:c,valid:h}=this.decryptWithAd(e.cs,e.h,a):c=a,this.mixHash(e,a),{plaintext:c,valid:h}}dh(e,a){try{const c=this.crypto.generateX25519SharedKey(e,a);return c.length===32?c:c.subarray(0,32)}catch(c){const h=c;return log$o.error(h),alloc$3(32)}}mixHash(e,a){e.h=this.getHash(e.h,a)}getHash(e,a){return this.crypto.hashSHA256(concat([e,a],e.length+a.length))}mixKey(e,a){const[c,h]=this.crypto.getHKDF(e.ck,a);e.cs=this.initializeKey(h),e.ck=c}initializeKey(e){return{k:e,n:new Nonce}}initializeSymmetric(e){const a=fromString$9(e,"utf-8"),c=this.hashProtocolName(a),h=c,d=this.createEmptyKey();return{cs:this.initializeKey(d),ck:h,h:c}}hashProtocolName(e){if(e.length<=32){const a=alloc$3(32);return a.set(e),a}else return this.getHash(e,alloc$3(0))}split(e){const[a,c]=this.crypto.getHKDF(e.ck,alloc$3(0)),h=this.initializeKey(a),d=this.initializeKey(c);return{cs1:h,cs2:d}}writeMessageRegular(e,a){const c=this.encryptWithAd(e,alloc$3(0),a),h=this.createEmptyKey(),d=alloc$3(0);return{ne:h,ns:d,ciphertext:c}}readMessageRegular(e,a){return this.decryptWithAd(e,alloc$3(0),a.ciphertext)}}class XX extends AbstractHandshake{initializeInitiator(e,a,c,h){const et=this.initializeSymmetric("Noise_XX_25519_ChaChaPoly_SHA256");this.mixHash(et,e);const ft=alloc$3(32);return{ss:et,s:a,rs:c,psk:h,re:ft}}initializeResponder(e,a,c,h){const et=this.initializeSymmetric("Noise_XX_25519_ChaChaPoly_SHA256");this.mixHash(et,e);const ft=alloc$3(32);return{ss:et,s:a,rs:c,psk:h,re:ft}}writeMessageA(e,a,c){const h=alloc$3(0);c!==void 0?e.e=c:e.e=this.crypto.generateX25519KeyPair();const d=e.e.publicKey;this.mixHash(e.ss,d);const et=this.encryptAndHash(e.ss,a);return{ne:d,ns:h,ciphertext:et}}writeMessageB(e,a){e.e=this.crypto.generateX25519KeyPair();const c=e.e.publicKey;this.mixHash(e.ss,c),this.mixKey(e.ss,this.dh(e.e.privateKey,e.re));const h=e.s.publicKey,d=this.encryptAndHash(e.ss,h);this.mixKey(e.ss,this.dh(e.s.privateKey,e.re));const et=this.encryptAndHash(e.ss,a);return{ne:c,ns:d,ciphertext:et}}writeMessageC(e,a){const c=e.s.publicKey,h=this.encryptAndHash(e.ss,c);this.mixKey(e.ss,this.dh(e.s.privateKey,e.re));const d=this.encryptAndHash(e.ss,a),ft={ne:this.createEmptyKey(),ns:h,ciphertext:d},{cs1:gt,cs2:_t}=this.split(e.ss);return{h:e.ss.h,messageBuffer:ft,cs1:gt,cs2:_t}}readMessageA(e,a){return isValidPublicKey(a.ne)&&(e.re=a.ne),this.mixHash(e.ss,e.re),this.decryptAndHash(e.ss,a.ciphertext)}readMessageB(e,a){if(isValidPublicKey(a.ne)&&(e.re=a.ne),this.mixHash(e.ss,e.re),!e.e)throw new Error("Handshake state `e` param is missing.");this.mixKey(e.ss,this.dh(e.e.privateKey,e.re));const{plaintext:c,valid:h}=this.decryptAndHash(e.ss,a.ns);h&&isValidPublicKey(c)&&(e.rs=c),this.mixKey(e.ss,this.dh(e.e.privateKey,e.rs));const{plaintext:d,valid:et}=this.decryptAndHash(e.ss,a.ciphertext);return{plaintext:d,valid:h&&et}}readMessageC(e,a){const{plaintext:c,valid:h}=this.decryptAndHash(e.ss,a.ns);if(h&&isValidPublicKey(c)&&(e.rs=c),!e.e)throw new Error("Handshake state `e` param is missing.");this.mixKey(e.ss,this.dh(e.e.privateKey,e.rs));const{plaintext:d,valid:et}=this.decryptAndHash(e.ss,a.ciphertext),{cs1:ft,cs2:gt}=this.split(e.ss);return{h:e.ss.h,plaintext:d,valid:h&&et,cs1:ft,cs2:gt}}initSession(e,a,c){const h=this.createEmptyKey(),d=alloc$3(32);let et;return e?et=this.initializeInitiator(a,c,d,h):et=this.initializeResponder(a,c,d,h),{hs:et,i:e,mc:0}}sendMessage(e,a,c){let h;if(e.mc===0)h=this.writeMessageA(e.hs,a,c);else if(e.mc===1)h=this.writeMessageB(e.hs,a);else if(e.mc===2){const{h:d,messageBuffer:et,cs1:ft,cs2:gt}=this.writeMessageC(e.hs,a);h=et,e.h=d,e.cs1=ft,e.cs2=gt}else if(e.mc>2)if(e.i){if(!e.cs1)throw new Error("CS1 (cipher state) is not defined");h=this.writeMessageRegular(e.cs1,a)}else{if(!e.cs2)throw new Error("CS2 (cipher state) is not defined");h=this.writeMessageRegular(e.cs2,a)}else throw new Error("Session invalid.");return e.mc++,h}recvMessage(e,a){let c=alloc$3(0),h=!1;if(e.mc===0)({plaintext:c,valid:h}=this.readMessageA(e.hs,a));else if(e.mc===1)({plaintext:c,valid:h}=this.readMessageB(e.hs,a));else if(e.mc===2){const{h:d,plaintext:et,valid:ft,cs1:gt,cs2:_t}=this.readMessageC(e.hs,a);c=et,h=ft,e.h=d,e.cs1=gt,e.cs2=_t}return e.mc++,{plaintext:c,valid:h}}}class XXHandshake{constructor(e,a,c,h,d,et,ft,gt){qt(this,"isInitiator");qt(this,"session");qt(this,"remotePeer");qt(this,"remoteExtensions",{webtransportCerthashes:[]});qt(this,"payload");qt(this,"connection");qt(this,"xx");qt(this,"staticKeypair");qt(this,"prologue");this.isInitiator=e,this.payload=a,this.prologue=c,this.staticKeypair=d,this.connection=et,ft&&(this.remotePeer=ft),this.xx=gt??new XX(h),this.session=this.xx.initSession(this.isInitiator,this.prologue,this.staticKeypair)}async propose(){if(logLocalStaticKeys(this.session.hs.s),this.isInitiator){log$o.trace("Stage 0 - Initiator starting to send first message.");const e=this.xx.sendMessage(this.session,alloc$3(0));await this.connection.write(encode0(e)),log$o.trace("Stage 0 - Initiator finished sending first message."),logLocalEphemeralKeys(this.session.hs.e)}else{log$o.trace("Stage 0 - Responder waiting to receive first message...");const e=decode0((await this.connection.read()).subarray()),{valid:a}=this.xx.recvMessage(this.session,e);if(!a)throw new InvalidCryptoExchangeError("xx handshake stage 0 validation fail");log$o.trace("Stage 0 - Responder received first message."),logRemoteEphemeralKey(this.session.hs.re)}}async exchange(){if(this.isInitiator){log$o.trace("Stage 1 - Initiator waiting to receive first message from responder...");const e=decode1((await this.connection.read()).subarray()),{plaintext:a,valid:c}=this.xx.recvMessage(this.session,e);if(!c)throw new InvalidCryptoExchangeError("xx handshake stage 1 validation fail");log$o.trace("Stage 1 - Initiator received the message."),logRemoteEphemeralKey(this.session.hs.re),logRemoteStaticKey(this.session.hs.rs),log$o.trace("Initiator going to check remote's signature...");try{const h=decodePayload(a);this.remotePeer=this.remotePeer||await getPeerIdFromPayload(h),await verifySignedPayload(this.session.hs.rs,h,this.remotePeer),this.setRemoteNoiseExtension(h.extensions)}catch(h){const d=h;throw new UnexpectedPeerError(`Error occurred while verifying signed payload: ${d.message}`)}log$o.trace("All good with the signature!")}else{log$o.trace("Stage 1 - Responder sending out first message with signed payload and static key.");const e=this.xx.sendMessage(this.session,this.payload);await this.connection.write(encode1(e)),log$o.trace("Stage 1 - Responder sent the second handshake message with signed payload."),logLocalEphemeralKeys(this.session.hs.e)}}async finish(){if(this.isInitiator){log$o.trace("Stage 2 - Initiator sending third handshake message.");const e=this.xx.sendMessage(this.session,this.payload);await this.connection.write(encode2(e)),log$o.trace("Stage 2 - Initiator sent message with signed payload.")}else{log$o.trace("Stage 2 - Responder waiting for third handshake message...");const e=decode2((await this.connection.read()).subarray()),{plaintext:a,valid:c}=this.xx.recvMessage(this.session,e);if(!c)throw new InvalidCryptoExchangeError("xx handshake stage 2 validation fail");log$o.trace("Stage 2 - Responder received the message, finished handshake.");try{const h=decodePayload(a);this.remotePeer=this.remotePeer||await getPeerIdFromPayload(h),await verifySignedPayload(this.session.hs.rs,h,this.remotePeer),this.setRemoteNoiseExtension(h.extensions)}catch(h){const d=h;throw new UnexpectedPeerError(`Error occurred while verifying signed payload: ${d.message}`)}}logCipherState(this.session)}encrypt(e,a){const c=this.getCS(a);return this.xx.encryptWithAd(c,alloc$3(0),e)}decrypt(e,a,c){const h=this.getCS(a,!1);return this.xx.decryptWithAd(h,alloc$3(0),e,c)}getRemoteStaticKey(){return this.session.hs.rs}getCS(e,a=!0){if(!e.cs1||!e.cs2)throw new InvalidCryptoExchangeError("Handshake not completed properly, cipher state does not exist.");return this.isInitiator?a?e.cs1:e.cs2:a?e.cs2:e.cs1}setRemoteNoiseExtension(e){e&&(this.remoteExtensions=e)}}function registerMetrics(i){return{xxHandshakeSuccesses:i.registerCounter("libp2p_noise_xxhandshake_successes_total",{help:"Total count of noise xxHandshakes successes_"}),xxHandshakeErrors:i.registerCounter("libp2p_noise_xxhandshake_error_total",{help:"Total count of noise xxHandshakes errors"}),encryptedPackets:i.registerCounter("libp2p_noise_encrypted_packets_total",{help:"Total count of noise encrypted packets successfully"}),decryptedPackets:i.registerCounter("libp2p_noise_decrypted_packets_total",{help:"Total count of noise decrypted packets"}),decryptErrors:i.registerCounter("libp2p_noise_decrypt_errors_total",{help:"Total count of noise decrypt errors"})}}class Noise{constructor(e={}){qt(this,"protocol","/noise");qt(this,"crypto");qt(this,"prologue");qt(this,"staticKeys");qt(this,"extensions");qt(this,"metrics");const{staticNoiseKey:a,extensions:c,crypto:h,prologueBytes:d,metrics:et}=e;this.crypto=h??defaultCrypto,this.extensions=c,this.metrics=et?registerMetrics(et):void 0,a?this.staticKeys=this.crypto.generateX25519KeyPairFromSeed(a):this.staticKeys=this.crypto.generateX25519KeyPair(),this.prologue=d??alloc$3(0)}async secureOutbound(e,a,c){const h=lpStream(a,{lengthEncoder:uint16BEEncode,lengthDecoder:uint16BEDecode,maxDataLength:NOISE_MSG_MAX_LENGTH_BYTES}),d=await this.performHandshake({connection:h,isInitiator:!0,localPeer:e,remotePeer:c});return{conn:await this.createSecureConnection(h,d),remoteExtensions:d.remoteExtensions,remotePeer:d.remotePeer}}async secureInbound(e,a,c){const h=lpStream(a,{lengthEncoder:uint16BEEncode,lengthDecoder:uint16BEDecode,maxDataLength:NOISE_MSG_MAX_LENGTH_BYTES}),d=await this.performHandshake({connection:h,isInitiator:!1,localPeer:e,remotePeer:c});return{conn:await this.createSecureConnection(h,d),remotePeer:d.remotePeer,remoteExtensions:d.remoteExtensions}}async performHandshake(e){const a=await getPayload(e.localPeer,this.staticKeys.publicKey,this.extensions);return this.performXXHandshake(e,a)}async performXXHandshake(e,a){var ft,gt;const{isInitiator:c,remotePeer:h,connection:d}=e,et=new XXHandshake(c,a,this.prologue,this.crypto,this.staticKeys,d,h);try{await et.propose(),await et.exchange(),await et.finish(),(ft=this.metrics)==null||ft.xxHandshakeSuccesses.increment()}catch(_t){if((gt=this.metrics)==null||gt.xxHandshakeErrors.increment(),_t instanceof Error)throw _t.message=`Error occurred during XX handshake: ${_t.message}`,_t}return et}async createSecureConnection(e,a){const[c,h]=duplexPair(),d=e.unwrap();return await pipe(c,encryptStream(a,this.metrics),d,et=>decode$b(et,{lengthDecoder:uint16BEDecode}),decryptStream(a,this.metrics),c),h}}function noise(i={}){return()=>new Noise(i)}let AbortError$3=class extends Error{constructor(e,a){super(e??"The operation was aborted"),this.type="aborted",this.code=a??"ABORT_ERR"}};function getIterator(i){if(i!=null){if(typeof i[Symbol.iterator]=="function")return i[Symbol.iterator]();if(typeof i[Symbol.asyncIterator]=="function")return i[Symbol.asyncIterator]();if(typeof i.next=="function")return i}throw new Error("argument is not an iterator or iterable")}function abortableSource(i,e,a){const c=a??{},h=getIterator(i);async function*d(){let et;const ft=()=>{et!=null&&et()};for(e.addEventListener("abort",ft);;){let gt;try{if(e.aborted){const{abortMessage:wt,abortCode:$t}=c;throw new AbortError$3(wt,$t)}const _t=new Promise((wt,$t)=>{et=()=>{const{abortMessage:It,abortCode:Rt}=c;$t(new AbortError$3(It,Rt))}});gt=await Promise.race([_t,h.next()]),et=null}catch(_t){e.removeEventListener("abort",ft);const wt=_t.type==="aborted"&&e.aborted;if(wt&&c.onAbort!=null&&c.onAbort(i),typeof h.return=="function")try{const $t=h.return();$t instanceof Promise&&$t.catch(It=>{c.onReturnError!=null&&c.onReturnError(It)})}catch($t){c.onReturnError!=null&&c.onReturnError($t)}if(wt&&c.returnOnAbort===!0)return;throw _t}if(gt.done===!0)break;yield gt.value}e.removeEventListener("abort",ft)}return d()}var RateLimiterAbstract_1=class{constructor(e={}){this.points=e.points,this.duration=e.duration,this.blockDuration=e.blockDuration,this.execEvenly=e.execEvenly,this.execEvenlyMinDelayMs=e.execEvenlyMinDelayMs,this.keyPrefix=e.keyPrefix}get points(){return this._points}set points(e){this._points=e>=0?e:4}get duration(){return this._duration}set duration(e){this._duration=typeof e>"u"?1:e}get msDuration(){return this.duration*1e3}get blockDuration(){return this._blockDuration}set blockDuration(e){this._blockDuration=typeof e>"u"?0:e}get msBlockDuration(){return this.blockDuration*1e3}get execEvenly(){return this._execEvenly}set execEvenly(e){this._execEvenly=typeof e>"u"?!1:!!e}get execEvenlyMinDelayMs(){return this._execEvenlyMinDelayMs}set execEvenlyMinDelayMs(e){this._execEvenlyMinDelayMs=typeof e>"u"?Math.ceil(this.msDuration/this.points):e}get keyPrefix(){return this._keyPrefix}set keyPrefix(e){if(typeof e>"u"&&(e="rlflx"),typeof e!="string")throw new Error("keyPrefix must be string");this._keyPrefix=e}_getKeySecDuration(e={}){return e&&e.customDuration>=0?e.customDuration:this.duration}getKey(e){return this.keyPrefix.length>0?`${this.keyPrefix}:${e}`:e}parseKey(e){return e.substring(this.keyPrefix.length)}consume(){throw new Error("You have to implement the method 'consume'!")}penalty(){throw new Error("You have to implement the method 'penalty'!")}reward(){throw new Error("You have to implement the method 'reward'!")}get(){throw new Error("You have to implement the method 'get'!")}set(){throw new Error("You have to implement the method 'set'!")}block(){throw new Error("You have to implement the method 'block'!")}delete(){throw new Error("You have to implement the method 'delete'!")}},BlockedKeys_1$1=class{constructor(){this._keys={},this._addedKeysAmount=0}collectExpired(){const e=Date.now();Object.keys(this._keys).forEach(a=>{this._keys[a]<=e&&delete this._keys[a]}),this._addedKeysAmount=Object.keys(this._keys).length}add(e,a){this.addMs(e,a*1e3)}addMs(e,a){this._keys[e]=Date.now()+a,this._addedKeysAmount++,this._addedKeysAmount>999&&this.collectExpired()}msBeforeExpire(e){const a=this._keys[e];if(a&&a>=Date.now()){this.collectExpired();const c=Date.now();return a>=c?a-c:0}return 0}delete(e){e?delete this._keys[e]:Object.keys(this._keys).forEach(a=>{delete this._keys[a]})}};const BlockedKeys$1=BlockedKeys_1$1;var BlockedKeys_1=BlockedKeys$1,RateLimiterRes_1=class{constructor(e,a,c,h){this.remainingPoints=typeof e>"u"?0:e,this.msBeforeNext=typeof a>"u"?0:a,this.consumedPoints=typeof c>"u"?0:c,this.isFirstInDuration=typeof h>"u"?!1:h}get msBeforeNext(){return this._msBeforeNext}set msBeforeNext(e){return this._msBeforeNext=e,this}get remainingPoints(){return this._remainingPoints}set remainingPoints(e){return this._remainingPoints=e,this}get consumedPoints(){return this._consumedPoints}set consumedPoints(e){return this._consumedPoints=e,this}get isFirstInDuration(){return this._isFirstInDuration}set isFirstInDuration(e){this._isFirstInDuration=!!e}_getDecoratedProperties(){return{remainingPoints:this.remainingPoints,msBeforeNext:this.msBeforeNext,consumedPoints:this.consumedPoints,isFirstInDuration:this.isFirstInDuration}}[Symbol.for("nodejs.util.inspect.custom")](){return this._getDecoratedProperties()}toString(){return JSON.stringify(this._getDecoratedProperties())}toJSON(){return this._getDecoratedProperties()}};const RateLimiterAbstract$3=RateLimiterAbstract_1,BlockedKeys=BlockedKeys_1,RateLimiterRes$b=RateLimiterRes_1;var RateLimiterStoreAbstract_1=class extends RateLimiterAbstract$3{constructor(e={}){super(e),this.inMemoryBlockOnConsumed=e.inMemoryBlockOnConsumed,this.inMemoryBlockDuration=e.inMemoryBlockDuration,this.insuranceLimiter=e.insuranceLimiter,this._inMemoryBlockedKeys=new BlockedKeys}get client(){return this._client}set client(e){if(typeof e>"u")throw new Error("storeClient is not set");this._client=e}_afterConsume(e,a,c,h,d,et={}){const ft=this._getRateLimiterRes(c,h,d);if(this.inMemoryBlockOnConsumed>0&&!(this.inMemoryBlockDuration>0)&&ft.consumedPoints>=this.inMemoryBlockOnConsumed)return this._inMemoryBlockedKeys.addMs(c,ft.msBeforeNext),ft.consumedPoints>this.points?a(ft):e(ft);if(ft.consumedPoints>this.points){let gt=Promise.resolve();this.blockDuration>0&&ft.consumedPoints<=this.points+h&&(ft.msBeforeNext=this.msBlockDuration,gt=this._block(c,ft.consumedPoints,this.msBlockDuration,et)),this.inMemoryBlockOnConsumed>0&&ft.consumedPoints>=this.inMemoryBlockOnConsumed&&(this._inMemoryBlockedKeys.add(c,this.inMemoryBlockDuration),ft.msBeforeNext=this.msInMemoryBlockDuration),gt.then(()=>{a(ft)}).catch(_t=>{a(_t)})}else if(this.execEvenly&&ft.msBeforeNext>0&&!ft.isFirstInDuration){let gt=Math.ceil(ft.msBeforeNext/(ft.remainingPoints+2));gt<this.execEvenlyMinDelayMs&&(gt=ft.consumedPoints*this.execEvenlyMinDelayMs),setTimeout(e,gt,ft)}else e(ft)}_handleError(e,a,c,h,d,et=!1,ft={}){this.insuranceLimiter instanceof RateLimiterAbstract$3?this.insuranceLimiter[a](d,et,ft).then(gt=>{c(gt)}).catch(gt=>{h(gt)}):h(e)}getInMemoryBlockMsBeforeExpire(e){return this.inMemoryBlockOnConsumed>0?this._inMemoryBlockedKeys.msBeforeExpire(e):0}get inMemoryBlockOnConsumed(){return this._inMemoryBlockOnConsumed}set inMemoryBlockOnConsumed(e){if(this._inMemoryBlockOnConsumed=e?parseInt(e):0,this.inMemoryBlockOnConsumed>0&&this.points>this.inMemoryBlockOnConsumed)throw new Error('inMemoryBlockOnConsumed option must be greater or equal "points" option')}get inMemoryBlockDuration(){return this._inMemoryBlockDuration}set inMemoryBlockDuration(e){if(this._inMemoryBlockDuration=e?parseInt(e):0,this.inMemoryBlockDuration>0&&this.inMemoryBlockOnConsumed===0)throw new Error("inMemoryBlockOnConsumed option must be set up")}get msInMemoryBlockDuration(){return this._inMemoryBlockDuration*1e3}get insuranceLimiter(){return this._insuranceLimiter}set insuranceLimiter(e){if(typeof e<"u"&&!(e instanceof RateLimiterAbstract$3))throw new Error("insuranceLimiter must be instance of RateLimiterAbstract");this._insuranceLimiter=e,this._insuranceLimiter&&(this._insuranceLimiter.blockDuration=this.blockDuration,this._insuranceLimiter.execEvenly=this.execEvenly)}block(e,a,c={}){const h=a*1e3;return this._block(this.getKey(e),this.points+1,h,c)}set(e,a,c,h={}){const d=(c>=0?c:this.duration)*1e3;return this._block(this.getKey(e),a,d,h)}consume(e,a=1,c={}){return new Promise((h,d)=>{const et=this.getKey(e),ft=this.getInMemoryBlockMsBeforeExpire(et);if(ft>0)return d(new RateLimiterRes$b(0,ft));this._upsert(et,a,this._getKeySecDuration(c)*1e3,!1,c).then(gt=>{this._afterConsume(h,d,et,a,gt)}).catch(gt=>{this._handleError(gt,"consume",h,d,e,a,c)})})}penalty(e,a=1,c={}){const h=this.getKey(e);return new Promise((d,et)=>{this._upsert(h,a,this._getKeySecDuration(c)*1e3,!1,c).then(ft=>{d(this._getRateLimiterRes(h,a,ft))}).catch(ft=>{this._handleError(ft,"penalty",d,et,e,a,c)})})}reward(e,a=1,c={}){const h=this.getKey(e);return new Promise((d,et)=>{this._upsert(h,-a,this._getKeySecDuration(c)*1e3,!1,c).then(ft=>{d(this._getRateLimiterRes(h,-a,ft))}).catch(ft=>{this._handleError(ft,"reward",d,et,e,a,c)})})}get(e,a={}){const c=this.getKey(e);return new Promise((h,d)=>{this._get(c,a).then(et=>{h(et===null||typeof et>"u"?null:this._getRateLimiterRes(c,0,et))}).catch(et=>{this._handleError(et,"get",h,d,e,a)})})}delete(e,a={}){const c=this.getKey(e);return new Promise((h,d)=>{this._delete(c,a).then(et=>{this._inMemoryBlockedKeys.delete(c),h(et)}).catch(et=>{this._handleError(et,"delete",h,d,e,a)})})}deleteInMemoryBlockedAll(){this._inMemoryBlockedKeys.delete()}_getRateLimiterRes(e,a,c){throw new Error("You have to implement the method '_getRateLimiterRes'!")}_block(e,a,c,h={}){return new Promise((d,et)=>{this._upsert(e,a,c,!0,h).then(()=>{d(new RateLimiterRes$b(0,c>0?c:-1,a))}).catch(ft=>{this._handleError(ft,"block",d,et,this.parseKey(e),c/1e3,h)})})}_get(e,a={}){throw new Error("You have to implement the method '_get'!")}_delete(e,a={}){throw new Error("You have to implement the method '_delete'!")}_upsert(e,a,c,h=!1,d={}){throw new Error("You have to implement the method '_upsert'!")}};const RateLimiterStoreAbstract$4=RateLimiterStoreAbstract_1,RateLimiterRes$a=RateLimiterRes_1,incrTtlLuaScript="redis.call('set', KEYS[1], 0, 'EX', ARGV[2], 'NX') local consumed = redis.call('incrby', KEYS[1], ARGV[1]) local ttl = redis.call('pttl', KEYS[1]) if ttl == -1 then   redis.call('expire', KEYS[1], ARGV[2])   ttl = 1000 * ARGV[2] end return {consumed, ttl} ";let RateLimiterRedis$1=class extends RateLimiterStoreAbstract$4{constructor(e){super(e),this.client=e.storeClient,this._rejectIfRedisNotReady=!!e.rejectIfRedisNotReady,this.useRedisPackage=e.useRedisPackage||this.client.constructor.name==="Commander"||!1,this.useRedis3AndLowerPackage=e.useRedis3AndLowerPackage,typeof this.client.defineCommand=="function"&&this.client.defineCommand("rlflxIncr",{numberOfKeys:1,lua:incrTtlLuaScript})}_isRedisReady(){return this._rejectIfRedisNotReady?!(this.client.status&&this.client.status!=="ready"||typeof this.client.isReady=="function"&&!this.client.isReady()):!0}_getRateLimiterRes(e,a,c){let[h,d]=c;Array.isArray(h)&&([,h]=h,[,d]=d);const et=new RateLimiterRes$a;return et.consumedPoints=parseInt(h),et.isFirstInDuration=et.consumedPoints===a,et.remainingPoints=Math.max(this.points-et.consumedPoints,0),et.msBeforeNext=d,et}async _upsert(e,a,c,h=!1){if(!this._isRedisReady())throw new Error("Redis connection is not ready");const d=Math.floor(c/1e3),et=this.client.multi();return h?(d>0?!this.useRedisPackage&&!this.useRedis3AndLowerPackage?et.set(e,a,"EX",d):et.set(e,a,{EX:d}):et.set(e,a),!this.useRedisPackage&&!this.useRedis3AndLowerPackage?et.pttl(e).exec(!0):et.pTTL(e).exec(!0)):d>0?!this.useRedisPackage&&!this.useRedis3AndLowerPackage?this.client.rlflxIncr([e].concat([String(a),String(d)])):this.useRedis3AndLowerPackage?new Promise((ft,gt)=>{const _t=function(wt,$t){return wt?gt(wt):ft($t)};typeof this.client.rlflxIncr=="function"?this.client.rlflxIncr(e,a,d,_t):this.client.eval(incrTtlLuaScript,1,e,a,d,_t)}):this.client.eval(incrTtlLuaScript,{keys:[e],arguments:[String(a),String(d)]}):!this.useRedisPackage&&!this.useRedis3AndLowerPackage?et.incrby(e,a).pttl(e).exec(!0):et.incrBy(e,a).pTTL(e).exec(!0)}async _get(e){if(!this._isRedisReady())throw new Error("Redis connection is not ready");return!this.useRedisPackage&&!this.useRedis3AndLowerPackage?this.client.multi().get(e).pttl(e).exec().then(a=>{const[[,c]]=a;return c===null?null:a}):this.client.multi().get(e).pTTL(e).exec(!0).then(a=>{const[c]=a;return c===null?null:a})}_delete(e){return this.client.del(e).then(a=>a>0)}};var RateLimiterRedis_1=RateLimiterRedis$1;const RateLimiterStoreAbstract$3=RateLimiterStoreAbstract_1,RateLimiterRes$9=RateLimiterRes_1;function getDriverVersion(i){try{const e=i.client?i.client:i,{version:a}=e.topology.s.options.metadata.driver,c=a.split(".").map(h=>parseInt(h));return{major:c[0],feature:c[1],patch:c[2]}}catch{return{major:0,feature:0,patch:0}}}let RateLimiterMongo$1=class _f extends RateLimiterStoreAbstract$3{constructor(e){super(e),this.dbName=e.dbName,this.tableName=e.tableName,this.indexKeyPrefix=e.indexKeyPrefix,e.mongo?this.client=e.mongo:this.client=e.storeClient,typeof this.client.then=="function"?this.client.then(a=>{this.client=a,this._initCollection(),this._driverVersion=getDriverVersion(this.client)}):(this._initCollection(),this._driverVersion=getDriverVersion(this.client))}get dbName(){return this._dbName}set dbName(e){this._dbName=typeof e>"u"?_f.getDbName():e}static getDbName(){return"node-rate-limiter-flexible"}get tableName(){return this._tableName}set tableName(e){this._tableName=typeof e>"u"?this.keyPrefix:e}get client(){return this._client}set client(e){if(typeof e>"u")throw new Error("mongo is not set");this._client=e}get indexKeyPrefix(){return this._indexKeyPrefix}set indexKeyPrefix(e){this._indexKeyPrefix=e||{}}_initCollection(){const a=(typeof this.client.db=="function"?this.client.db(this.dbName):this.client).collection(this.tableName);a.createIndex({expire:-1},{expireAfterSeconds:0}),a.createIndex(Object.assign({},this.indexKeyPrefix,{key:1}),{unique:!0}),this._collection=a}_getRateLimiterRes(e,a,c){const h=new RateLimiterRes$9;let d;return typeof c.value>"u"?d=c:d=c.value,h.isFirstInDuration=d.points===a,h.consumedPoints=d.points,h.remainingPoints=Math.max(this.points-h.consumedPoints,0),h.msBeforeNext=d.expire!==null?Math.max(new Date(d.expire).getTime()-Date.now(),0):-1,h}_upsert(e,a,c,h=!1,d={}){if(!this._collection)return Promise.reject(Error("Mongo connection is not established"));const et=d.attrs||{};let ft,gt;h?(ft={key:e},ft=Object.assign(ft,et),gt={$set:{key:e,points:a,expire:c>0?new Date(Date.now()+c):null}},gt.$set=Object.assign(gt.$set,et)):(ft={$or:[{expire:{$gt:new Date}},{expire:{$eq:null}}],key:e},ft=Object.assign(ft,et),gt={$setOnInsert:{key:e,expire:c>0?new Date(Date.now()+c):null},$inc:{points:a}},gt.$setOnInsert=Object.assign(gt.$setOnInsert,et));const _t={upsert:!0};return this._driverVersion.major>=4||this._driverVersion.major===3&&this._driverVersion.feature>=7||this._driverVersion.feature>=6&&this._driverVersion.patch>=7?_t.returnDocument="after":_t.returnOriginal=!1,new Promise((wt,$t)=>{this._collection.findOneAndUpdate(ft,gt,_t).then(It=>{wt(It)}).catch(It=>{if(It&&It.code===11e3){const Rt=Object.assign({$or:[{expire:{$lte:new Date}},{expire:{$eq:null}}],key:e},et),Tt={$set:Object.assign({key:e,points:a,expire:c>0?new Date(Date.now()+c):null},et)};this._collection.findOneAndUpdate(Rt,Tt,_t).then(At=>{wt(At)}).catch(At=>{At&&At.code===11e3?this._upsert(e,a,c,h).then(kt=>wt(kt)).catch(kt=>$t(kt)):$t(At)})}else $t(It)})})}_get(e,a={}){if(!this._collection)return Promise.reject(Error("Mongo connection is not established"));const c=a.attrs||{},h=Object.assign({key:e,$or:[{expire:{$gt:new Date}},{expire:{$eq:null}}]},c);return this._collection.findOne(h)}_delete(e,a={}){if(!this._collection)return Promise.reject(Error("Mongo connection is not established"));const c=a.attrs||{},h=Object.assign({key:e},c);return this._collection.deleteOne(h).then(d=>d.deletedCount>0)}};var RateLimiterMongo_1=RateLimiterMongo$1;const RateLimiterStoreAbstract$2=RateLimiterStoreAbstract_1,RateLimiterRes$8=RateLimiterRes_1;let RateLimiterMySQL$1=class extends RateLimiterStoreAbstract$2{constructor(e,a=null){super(e),this.client=e.storeClient,this.clientType=e.storeType,this.dbName=e.dbName,this.tableName=e.tableName,this.clearExpiredByTimeout=e.clearExpiredByTimeout,this.tableCreated=e.tableCreated,this.tableCreated?(this.clearExpiredByTimeout&&this._clearExpiredHourAgo(),typeof a=="function"&&a()):this._createDbAndTable().then(()=>{this.tableCreated=!0,this.clearExpiredByTimeout&&this._clearExpiredHourAgo(),typeof a=="function"&&a()}).catch(c=>{if(typeof a=="function")a(c);else throw c})}clearExpired(e){return new Promise(a=>{this._getConnection().then(c=>{c.query("DELETE FROM ??.?? WHERE expire < ?",[this.dbName,this.tableName,e],()=>{this._releaseConnection(c),a()})}).catch(()=>{a()})})}_clearExpiredHourAgo(){this._clearExpiredTimeoutId&&clearTimeout(this._clearExpiredTimeoutId),this._clearExpiredTimeoutId=setTimeout(()=>{this.clearExpired(Date.now()-36e5).then(()=>{this._clearExpiredHourAgo()})},3e5),this._clearExpiredTimeoutId.unref()}_getConnection(){switch(this.clientType){case"pool":return new Promise((e,a)=>{this.client.getConnection((c,h)=>{if(c)return a(c);e(h)})});case"sequelize":return this.client.connectionManager.getConnection();case"knex":return this.client.client.acquireConnection();default:return Promise.resolve(this.client)}}_releaseConnection(e){switch(this.clientType){case"pool":return e.release();case"sequelize":return this.client.connectionManager.releaseConnection(e);case"knex":return this.client.client.releaseConnection(e);default:return!0}}_createDbAndTable(){return new Promise((e,a)=>{this._getConnection().then(c=>{c.query(`CREATE DATABASE IF NOT EXISTS \`${this.dbName}\`;`,h=>{if(h)return this._releaseConnection(c),a(h);c.query(this._getCreateTableStmt(),d=>{if(d)return this._releaseConnection(c),a(d);this._releaseConnection(c),e()})})}).catch(c=>{a(c)})})}_getCreateTableStmt(){return`CREATE TABLE IF NOT EXISTS \`${this.dbName}\`.\`${this.tableName}\` (\`key\` VARCHAR(255) CHARACTER SET utf8 NOT NULL,\`points\` INT(9) NOT NULL default 0,\`expire\` BIGINT UNSIGNED,PRIMARY KEY (\`key\`)) ENGINE = INNODB;`}get clientType(){return this._clientType}set clientType(e){if(typeof e>"u")if(this.client.constructor.name==="Connection")e="connection";else if(this.client.constructor.name==="Pool")e="pool";else if(this.client.constructor.name==="Sequelize")e="sequelize";else throw new Error("storeType is not defined");this._clientType=e.toLowerCase()}get dbName(){return this._dbName}set dbName(e){this._dbName=typeof e>"u"?"rtlmtrflx":e}get tableName(){return this._tableName}set tableName(e){this._tableName=typeof e>"u"?this.keyPrefix:e}get tableCreated(){return this._tableCreated}set tableCreated(e){this._tableCreated=typeof e>"u"?!1:!!e}get clearExpiredByTimeout(){return this._clearExpiredByTimeout}set clearExpiredByTimeout(e){this._clearExpiredByTimeout=typeof e>"u"?!0:!!e}_getRateLimiterRes(e,a,c){const h=new RateLimiterRes$8,[d]=c;return h.isFirstInDuration=a===d.points,h.consumedPoints=h.isFirstInDuration?a:d.points,h.remainingPoints=Math.max(this.points-h.consumedPoints,0),h.msBeforeNext=d.expire?Math.max(d.expire-Date.now(),0):-1,h}_upsertTransaction(e,a,c,h,d){return new Promise((et,ft)=>{e.query("BEGIN",gt=>{if(gt)return e.rollback(),ft(gt);const _t=Date.now(),wt=h>0?_t+h:null;let $t,It;d?($t=`INSERT INTO ??.?? VALUES (?, ?, ?)
          ON DUPLICATE KEY UPDATE 
            points = ?, 
            expire = ?;`,It=[this.dbName,this.tableName,a,c,wt,c,wt]):($t=`INSERT INTO ??.?? VALUES (?, ?, ?)
          ON DUPLICATE KEY UPDATE 
            points = IF(expire <= ?, ?, points + (?)), 
            expire = IF(expire <= ?, ?, expire);`,It=[this.dbName,this.tableName,a,c,wt,_t,c,c,_t,wt]),e.query($t,It,Rt=>{if(Rt)return e.rollback(),ft(Rt);e.query("SELECT points, expire FROM ??.?? WHERE `key` = ?;",[this.dbName,this.tableName,a],(Tt,At)=>{if(Tt)return e.rollback(),ft(Tt);e.query("COMMIT",kt=>{if(kt)return e.rollback(),ft(kt);et(At)})})})})})}_upsert(e,a,c,h=!1){return this.tableCreated?new Promise((d,et)=>{this._getConnection().then(ft=>{this._upsertTransaction(ft,e,a,c,h).then(gt=>{d(gt),this._releaseConnection(ft)}).catch(gt=>{et(gt),this._releaseConnection(ft)})}).catch(ft=>{et(ft)})}):Promise.reject(Error("Table is not created yet"))}_get(e){return this.tableCreated?new Promise((a,c)=>{this._getConnection().then(h=>{h.query("SELECT points, expire FROM ??.?? WHERE `key` = ? AND (`expire` > ? OR `expire` IS NULL)",[this.dbName,this.tableName,e,Date.now()],(d,et)=>{d?c(d):et.length===0?a(null):a(et),this._releaseConnection(h)})}).catch(h=>{c(h)})}):Promise.reject(Error("Table is not created yet"))}_delete(e){return this.tableCreated?new Promise((a,c)=>{this._getConnection().then(h=>{h.query("DELETE FROM ??.?? WHERE `key` = ?",[this.dbName,this.tableName,e],(d,et)=>{d?c(d):a(et.affectedRows>0),this._releaseConnection(h)})}).catch(h=>{c(h)})}):Promise.reject(Error("Table is not created yet"))}};var RateLimiterMySQL_1=RateLimiterMySQL$1;const RateLimiterStoreAbstract$1=RateLimiterStoreAbstract_1,RateLimiterRes$7=RateLimiterRes_1;let RateLimiterPostgres$1=class extends RateLimiterStoreAbstract$1{constructor(e,a=null){super(e),this.client=e.storeClient,this.clientType=e.storeType,this.tableName=e.tableName,this.schemaName=e.schemaName,this.clearExpiredByTimeout=e.clearExpiredByTimeout,this.tableCreated=e.tableCreated,this.tableCreated?(this.clearExpiredByTimeout&&this._clearExpiredHourAgo(),typeof a=="function"&&a()):this._createTable().then(()=>{this.tableCreated=!0,this.clearExpiredByTimeout&&this._clearExpiredHourAgo(),typeof a=="function"&&a()}).catch(c=>{if(typeof a=="function")a(c);else throw c})}_getTableIdentifier(){return this.schemaName?`"${this.schemaName}"."${this.tableName}"`:`"${this.tableName}"`}clearExpired(e){return new Promise(a=>{const c={name:"rlflx-clear-expired",text:`DELETE FROM ${this._getTableIdentifier()} WHERE expire < $1`,values:[e]};this._query(c).then(()=>{a()}).catch(()=>{a()})})}_clearExpiredHourAgo(){this._clearExpiredTimeoutId&&clearTimeout(this._clearExpiredTimeoutId),this._clearExpiredTimeoutId=setTimeout(()=>{this.clearExpired(Date.now()-36e5).then(()=>{this._clearExpiredHourAgo()})},3e5),this._clearExpiredTimeoutId.unref()}_getConnection(){switch(this.clientType){case"pool":return Promise.resolve(this.client);case"sequelize":return this.client.connectionManager.getConnection();case"knex":return this.client.client.acquireConnection();case"typeorm":return Promise.resolve(this.client.driver.master);default:return Promise.resolve(this.client)}}_releaseConnection(e){switch(this.clientType){case"pool":return!0;case"sequelize":return this.client.connectionManager.releaseConnection(e);case"knex":return this.client.client.releaseConnection(e);case"typeorm":return!0;default:return!0}}_createTable(){return new Promise((e,a)=>{this._query({text:this._getCreateTableStmt()}).then(()=>{e()}).catch(c=>{c.code==="23505"?e():a(c)})})}_getCreateTableStmt(){return`CREATE TABLE IF NOT EXISTS ${this._getTableIdentifier()} (
      key varchar(255) PRIMARY KEY,
      points integer NOT NULL DEFAULT 0,
      expire bigint
    );`}get clientType(){return this._clientType}set clientType(e){const a=this.client.constructor.name;if(typeof e>"u")if(a==="Client")e="client";else if(a==="Pool"||a==="BoundPool")e="pool";else if(a==="Sequelize")e="sequelize";else throw new Error("storeType is not defined");this._clientType=e.toLowerCase()}get tableName(){return this._tableName}set tableName(e){this._tableName=typeof e>"u"?this.keyPrefix:e}get schemaName(){return this._schemaName}set schemaName(e){this._schemaName=e}get tableCreated(){return this._tableCreated}set tableCreated(e){this._tableCreated=typeof e>"u"?!1:!!e}get clearExpiredByTimeout(){return this._clearExpiredByTimeout}set clearExpiredByTimeout(e){this._clearExpiredByTimeout=typeof e>"u"?!0:!!e}_getRateLimiterRes(e,a,c){const h=new RateLimiterRes$7,d=c.rows[0];return h.isFirstInDuration=a===d.points,h.consumedPoints=h.isFirstInDuration?a:d.points,h.remainingPoints=Math.max(this.points-h.consumedPoints,0),h.msBeforeNext=d.expire?Math.max(d.expire-Date.now(),0):-1,h}_query(e){const c={name:`${this.tableName.toLowerCase()}:${e.name}`,text:e.text,values:e.values};return new Promise((h,d)=>{this._getConnection().then(et=>{et.query(c).then(ft=>{h(ft),this._releaseConnection(et)}).catch(ft=>{d(ft),this._releaseConnection(et)})}).catch(et=>{d(et)})})}_upsert(e,a,c,h=!1){if(!this.tableCreated)return Promise.reject(Error("Table is not created yet"));const d=c>0?Date.now()+c:null,et=h?" $3 ":` CASE
             WHEN ${this._getTableIdentifier()}.expire <= $4 THEN $3
             ELSE ${this._getTableIdentifier()}.expire
            END `;return this._query({name:h?"rlflx-upsert-force":"rlflx-upsert",text:`
            INSERT INTO ${this._getTableIdentifier()} VALUES ($1, $2, $3)
              ON CONFLICT(key) DO UPDATE SET
                points = CASE
                          WHEN (${this._getTableIdentifier()}.expire <= $4 OR 1=${h?1:0}) THEN $2
                          ELSE ${this._getTableIdentifier()}.points + ($2)
                         END,
                expire = ${et}
            RETURNING points, expire;`,values:[e,a,d,Date.now()]})}_get(e){return this.tableCreated?new Promise((a,c)=>{this._query({name:"rlflx-get",text:`
            SELECT points, expire FROM ${this._getTableIdentifier()} WHERE key = $1 AND (expire > $2 OR expire IS NULL);`,values:[e,Date.now()]}).then(h=>{h.rowCount===0&&(h=null),a(h)}).catch(h=>{c(h)})}):Promise.reject(Error("Table is not created yet"))}_delete(e){return this.tableCreated?this._query({name:"rlflx-delete",text:`DELETE FROM ${this._getTableIdentifier()} WHERE key = $1`,values:[e]}).then(a=>a.rowCount>0):Promise.reject(Error("Table is not created yet"))}};var RateLimiterPostgres_1=RateLimiterPostgres$1,Record_1=class{constructor(e,a,c=null){this.value=e,this.expiresAt=a,this.timeoutId=c}get value(){return this._value}set value(e){this._value=parseInt(e)}get expiresAt(){return this._expiresAt}set expiresAt(e){!(e instanceof Date)&&Number.isInteger(e)&&(e=new Date(e)),this._expiresAt=e}get timeoutId(){return this._timeoutId}set timeoutId(e){this._timeoutId=e}};const Record=Record_1,RateLimiterRes$6=RateLimiterRes_1;var MemoryStorage_1=class{constructor(){this._storage={}}incrby(e,a,c){if(this._storage[e]){const h=this._storage[e].expiresAt?this._storage[e].expiresAt.getTime()-new Date().getTime():-1;return!this._storage[e].expiresAt||h>0?(this._storage[e].value=this._storage[e].value+a,new RateLimiterRes$6(0,h,this._storage[e].value,!1)):this.set(e,a,c)}return this.set(e,a,c)}set(e,a,c){const h=c*1e3;return this._storage[e]&&this._storage[e].timeoutId&&clearTimeout(this._storage[e].timeoutId),this._storage[e]=new Record(a,h>0?new Date(Date.now()+h):null),h>0&&(this._storage[e].timeoutId=setTimeout(()=>{delete this._storage[e]},h),this._storage[e].timeoutId.unref&&this._storage[e].timeoutId.unref()),new RateLimiterRes$6(0,h===0?-1:h,this._storage[e].value,!0)}get(e){if(this._storage[e]){const a=this._storage[e].expiresAt?this._storage[e].expiresAt.getTime()-new Date().getTime():-1;return new RateLimiterRes$6(0,a,this._storage[e].value,!1)}return null}delete(e){return this._storage[e]?(this._storage[e].timeoutId&&clearTimeout(this._storage[e].timeoutId),delete this._storage[e],!0):!1}};const RateLimiterAbstract$2=RateLimiterAbstract_1,MemoryStorage$1=MemoryStorage_1,RateLimiterRes$5=RateLimiterRes_1;let RateLimiterMemory$2=class extends RateLimiterAbstract$2{constructor(e={}){super(e),this._memoryStorage=new MemoryStorage$1}consume(e,a=1,c={}){return new Promise((h,d)=>{const et=this.getKey(e),ft=this._getKeySecDuration(c);let gt=this._memoryStorage.incrby(et,a,ft);if(gt.remainingPoints=Math.max(this.points-gt.consumedPoints,0),gt.consumedPoints>this.points)this.blockDuration>0&&gt.consumedPoints<=this.points+a&&(gt=this._memoryStorage.set(et,gt.consumedPoints,this.blockDuration)),d(gt);else if(this.execEvenly&&gt.msBeforeNext>0&&!gt.isFirstInDuration){let _t=Math.ceil(gt.msBeforeNext/(gt.remainingPoints+2));_t<this.execEvenlyMinDelayMs&&(_t=gt.consumedPoints*this.execEvenlyMinDelayMs),setTimeout(h,_t,gt)}else h(gt)})}penalty(e,a=1,c={}){const h=this.getKey(e);return new Promise(d=>{const et=this._getKeySecDuration(c),ft=this._memoryStorage.incrby(h,a,et);ft.remainingPoints=Math.max(this.points-ft.consumedPoints,0),d(ft)})}reward(e,a=1,c={}){const h=this.getKey(e);return new Promise(d=>{const et=this._getKeySecDuration(c),ft=this._memoryStorage.incrby(h,-a,et);ft.remainingPoints=Math.max(this.points-ft.consumedPoints,0),d(ft)})}block(e,a){const c=a*1e3,h=this.points+1;return this._memoryStorage.set(this.getKey(e),h,a),Promise.resolve(new RateLimiterRes$5(0,c===0?-1:c,h))}set(e,a,c){const h=(c>=0?c:this.duration)*1e3;return this._memoryStorage.set(this.getKey(e),a,c),Promise.resolve(new RateLimiterRes$5(0,h===0?-1:h,a))}get(e){const a=this._memoryStorage.get(this.getKey(e));return a!==null&&(a.remainingPoints=Math.max(this.points-a.consumedPoints,0)),Promise.resolve(a)}delete(e){return Promise.resolve(this._memoryStorage.delete(this.getKey(e)))}};var RateLimiterMemory_1=RateLimiterMemory$2;const cluster=require$$1,crypto$1=require$$1,RateLimiterAbstract$1=RateLimiterAbstract_1,RateLimiterMemory$1=RateLimiterMemory_1,RateLimiterRes$4=RateLimiterRes_1,channel="rate_limiter_flexible";let masterInstance=null;const masterSendToWorker=function(i,e,a,c){let h;c===null||c===!0||c===!1?h=c:h={remainingPoints:c.remainingPoints,msBeforeNext:c.msBeforeNext,consumedPoints:c.consumedPoints,isFirstInDuration:c.isFirstInDuration},i.send({channel,keyPrefix:e.keyPrefix,promiseId:e.promiseId,type:a,data:h})},workerWaitInit=function(i){setTimeout(()=>{this._initiated?process.send(i):typeof this._promises[i.promiseId]<"u"&&workerWaitInit.call(this,i)},30)},workerSendToMaster=function(i,e,a,c,h){const d={channel,keyPrefix:this.keyPrefix,func:i,promiseId:e,data:{key:a,arg:c,opts:h}};this._initiated?process.send(d):workerWaitInit.call(this,d)},masterProcessMsg=function(i,e){if(!e||e.channel!==channel||typeof this._rateLimiters[e.keyPrefix]>"u")return!1;let a;switch(e.func){case"consume":a=this._rateLimiters[e.keyPrefix].consume(e.data.key,e.data.arg,e.data.opts);break;case"penalty":a=this._rateLimiters[e.keyPrefix].penalty(e.data.key,e.data.arg,e.data.opts);break;case"reward":a=this._rateLimiters[e.keyPrefix].reward(e.data.key,e.data.arg,e.data.opts);break;case"block":a=this._rateLimiters[e.keyPrefix].block(e.data.key,e.data.arg,e.data.opts);break;case"get":a=this._rateLimiters[e.keyPrefix].get(e.data.key,e.data.opts);break;case"delete":a=this._rateLimiters[e.keyPrefix].delete(e.data.key,e.data.opts);break;default:return!1}a&&a.then(c=>{masterSendToWorker(i,e,"resolve",c)}).catch(c=>{masterSendToWorker(i,e,"reject",c)})},workerProcessMsg=function(i){if(!i||i.channel!==channel||i.keyPrefix!==this.keyPrefix)return!1;if(this._promises[i.promiseId]){clearTimeout(this._promises[i.promiseId].timeoutId);let e;switch(i.data===null||i.data===!0||i.data===!1?e=i.data:e=new RateLimiterRes$4(i.data.remainingPoints,i.data.msBeforeNext,i.data.consumedPoints,i.data.isFirstInDuration),i.type){case"resolve":this._promises[i.promiseId].resolve(e);break;case"reject":this._promises[i.promiseId].reject(e);break;default:throw new Error(`RateLimiterCluster: no such message type '${i.type}'`)}delete this._promises[i.promiseId]}},getOpts=function(){return{points:this.points,duration:this.duration,blockDuration:this.blockDuration,execEvenly:this.execEvenly,execEvenlyMinDelayMs:this.execEvenlyMinDelayMs,keyPrefix:this.keyPrefix}},savePromise=function(i,e){const a=process.hrtime();let c=a[0].toString()+a[1].toString();return typeof this._promises[c]<"u"&&(c+=crypto$1.randomBytes(12).toString("base64")),this._promises[c]={resolve:i,reject:e,timeoutId:setTimeout(()=>{delete this._promises[c],e(new Error("RateLimiterCluster timeout: no answer from master in time"))},this.timeoutMs)},c};let RateLimiterClusterMaster$1=class{constructor(){if(masterInstance)return masterInstance;this._rateLimiters={},cluster.setMaxListeners(0),cluster.on("message",(e,a)=>{a&&a.channel===channel&&a.type==="init"?(typeof this._rateLimiters[a.opts.keyPrefix]>"u"&&(this._rateLimiters[a.opts.keyPrefix]=new RateLimiterMemory$1(a.opts)),e.send({channel,type:"init",keyPrefix:a.opts.keyPrefix})):masterProcessMsg.call(this,e,a)}),masterInstance=this}},RateLimiterClusterMasterPM2$1=class{constructor(e){if(masterInstance)return masterInstance;this._rateLimiters={},e.launchBus((a,c)=>{c.on("process:msg",h=>{const d=h.raw;if(d&&d.channel===channel&&d.type==="init")typeof this._rateLimiters[d.opts.keyPrefix]>"u"&&(this._rateLimiters[d.opts.keyPrefix]=new RateLimiterMemory$1(d.opts)),e.sendDataToProcessId(h.process.pm_id,{data:{},topic:channel,channel,type:"init",keyPrefix:d.opts.keyPrefix},(et,ft)=>{et&&console.log(et,ft)});else{const et={send:ft=>{const gt=ft;gt.topic=channel,typeof gt.data>"u"&&(gt.data={}),e.sendDataToProcessId(h.process.pm_id,gt,(_t,wt)=>{_t&&console.log(_t,wt)})}};masterProcessMsg.call(this,et,d)}})}),masterInstance=this}};class RateLimiterClusterWorker extends RateLimiterAbstract$1{get timeoutMs(){return this._timeoutMs}set timeoutMs(e){this._timeoutMs=typeof e>"u"?5e3:Math.abs(parseInt(e))}constructor(e={}){super(e),process.setMaxListeners(0),this.timeoutMs=e.timeoutMs,this._initiated=!1,process.on("message",a=>{a&&a.channel===channel&&a.type==="init"&&a.keyPrefix===this.keyPrefix?this._initiated=!0:workerProcessMsg.call(this,a)}),process.send({channel,type:"init",opts:getOpts.call(this)}),this._promises={}}consume(e,a=1,c={}){return new Promise((h,d)=>{const et=savePromise.call(this,h,d);workerSendToMaster.call(this,"consume",et,e,a,c)})}penalty(e,a=1,c={}){return new Promise((h,d)=>{const et=savePromise.call(this,h,d);workerSendToMaster.call(this,"penalty",et,e,a,c)})}reward(e,a=1,c={}){return new Promise((h,d)=>{const et=savePromise.call(this,h,d);workerSendToMaster.call(this,"reward",et,e,a,c)})}block(e,a,c={}){return new Promise((h,d)=>{const et=savePromise.call(this,h,d);workerSendToMaster.call(this,"block",et,e,a,c)})}get(e,a={}){return new Promise((c,h)=>{const d=savePromise.call(this,c,h);workerSendToMaster.call(this,"get",d,e,a)})}delete(e,a={}){return new Promise((c,h)=>{const d=savePromise.call(this,c,h);workerSendToMaster.call(this,"delete",d,e,a)})}}var RateLimiterCluster$1={RateLimiterClusterMaster:RateLimiterClusterMaster$1,RateLimiterClusterMasterPM2:RateLimiterClusterMasterPM2$1,RateLimiterCluster:RateLimiterClusterWorker};const RateLimiterStoreAbstract=RateLimiterStoreAbstract_1,RateLimiterRes$3=RateLimiterRes_1;let RateLimiterMemcache$1=class extends RateLimiterStoreAbstract{constructor(e){super(e),this.client=e.storeClient}_getRateLimiterRes(e,a,c){const h=new RateLimiterRes$3;return h.consumedPoints=parseInt(c.consumedPoints),h.isFirstInDuration=c.consumedPoints===a,h.remainingPoints=Math.max(this.points-h.consumedPoints,0),h.msBeforeNext=c.msBeforeNext,h}_upsert(e,a,c,h=!1,d={}){return new Promise((et,ft)=>{const gt=Date.now(),_t=Math.floor(c/1e3);h?this.client.set(e,a,_t,wt=>{wt?ft(wt):this.client.set(`${e}_expire`,_t>0?gt+_t*1e3:-1,_t,()=>{const $t={consumedPoints:a,msBeforeNext:_t>0?_t*1e3:-1};et($t)})}):this.client.incr(e,a,(wt,$t)=>{wt||$t===!1?this.client.add(e,a,_t,(It,Rt)=>{if(It||!Rt)if(typeof d.attemptNumber>"u"||d.attemptNumber<3){const Tt=Object.assign({},d);Tt.attemptNumber=Tt.attemptNumber?Tt.attemptNumber+1:1,this._upsert(e,a,c,h,Tt).then(At=>et(At)).catch(At=>ft(At))}else ft(new Error("Can not add key"));else this.client.add(`${e}_expire`,_t>0?gt+_t*1e3:-1,_t,()=>{const Tt={consumedPoints:a,msBeforeNext:_t>0?_t*1e3:-1};et(Tt)})}):this.client.get(`${e}_expire`,(It,Rt)=>{if(It)ft(It);else{const Tt=Rt===!1?0:Rt,At={consumedPoints:$t,msBeforeNext:Tt>=0?Math.max(Tt-gt,0):-1};et(At)}})})})}_get(e){return new Promise((a,c)=>{const h=Date.now();this.client.get(e,(d,et)=>{et?this.client.get(`${e}_expire`,(ft,gt)=>{if(ft)c(ft);else{const _t=gt===!1?0:gt,wt={consumedPoints:et,msBeforeNext:_t>=0?Math.max(_t-h,0):-1};a(wt)}}):a(null)})})}_delete(e){return new Promise((a,c)=>{this.client.del(e,(h,d)=>{h?c(h):d===!1?a(d):this.client.del(`${e}_expire`,et=>{et?c(et):a(d)})})})}};var RateLimiterMemcache_1=RateLimiterMemcache$1;const RateLimiterRes$2=RateLimiterRes_1;var RLWrapperBlackAndWhite_1=class{constructor(e={}){this.limiter=e.limiter,this.blackList=e.blackList,this.whiteList=e.whiteList,this.isBlackListed=e.isBlackListed,this.isWhiteListed=e.isWhiteListed,this.runActionAnyway=e.runActionAnyway}get limiter(){return this._limiter}set limiter(e){if(typeof e>"u")throw new Error("limiter is not set");this._limiter=e}get runActionAnyway(){return this._runActionAnyway}set runActionAnyway(e){this._runActionAnyway=typeof e>"u"?!1:e}get blackList(){return this._blackList}set blackList(e){this._blackList=Array.isArray(e)?e:[]}get isBlackListed(){return this._isBlackListed}set isBlackListed(e){if(typeof e>"u"&&(e=()=>!1),typeof e!="function")throw new Error("isBlackListed must be function");this._isBlackListed=e}get whiteList(){return this._whiteList}set whiteList(e){this._whiteList=Array.isArray(e)?e:[]}get isWhiteListed(){return this._isWhiteListed}set isWhiteListed(e){if(typeof e>"u"&&(e=()=>!1),typeof e!="function")throw new Error("isWhiteListed must be function");this._isWhiteListed=e}isBlackListedSomewhere(e){return this.blackList.indexOf(e)>=0||this.isBlackListed(e)}isWhiteListedSomewhere(e){return this.whiteList.indexOf(e)>=0||this.isWhiteListed(e)}getBlackRes(){return new RateLimiterRes$2(0,Number.MAX_SAFE_INTEGER,0,!1)}getWhiteRes(){return new RateLimiterRes$2(Number.MAX_SAFE_INTEGER,0,0,!1)}rejectBlack(){return Promise.reject(this.getBlackRes())}resolveBlack(){return Promise.resolve(this.getBlackRes())}resolveWhite(){return Promise.resolve(this.getWhiteRes())}consume(e,a=1){let c;return this.isWhiteListedSomewhere(e)?c=this.resolveWhite():this.isBlackListedSomewhere(e)&&(c=this.rejectBlack()),typeof c>"u"?this.limiter.consume(e,a):(this.runActionAnyway&&this.limiter.consume(e,a).catch(()=>{}),c)}block(e,a){let c;return this.isWhiteListedSomewhere(e)?c=this.resolveWhite():this.isBlackListedSomewhere(e)&&(c=this.resolveBlack()),typeof c>"u"?this.limiter.block(e,a):(this.runActionAnyway&&this.limiter.block(e,a).catch(()=>{}),c)}penalty(e,a){let c;return this.isWhiteListedSomewhere(e)?c=this.resolveWhite():this.isBlackListedSomewhere(e)&&(c=this.resolveBlack()),typeof c>"u"?this.limiter.penalty(e,a):(this.runActionAnyway&&this.limiter.penalty(e,a).catch(()=>{}),c)}reward(e,a){let c;return this.isWhiteListedSomewhere(e)?c=this.resolveWhite():this.isBlackListedSomewhere(e)&&(c=this.resolveBlack()),typeof c>"u"?this.limiter.reward(e,a):(this.runActionAnyway&&this.limiter.reward(e,a).catch(()=>{}),c)}get(e){let a;return this.isWhiteListedSomewhere(e)?a=this.resolveWhite():this.isBlackListedSomewhere(e)&&(a=this.resolveBlack()),typeof a>"u"||this.runActionAnyway?this.limiter.get(e):a}delete(e){return this.limiter.delete(e)}};const RateLimiterAbstract=RateLimiterAbstract_1;var RateLimiterUnion_1=class{constructor(...e){if(e.length<1)throw new Error("RateLimiterUnion: at least one limiter have to be passed");e.forEach(a=>{if(!(a instanceof RateLimiterAbstract))throw new Error("RateLimiterUnion: all limiters have to be instance of RateLimiterAbstract")}),this._limiters=e}consume(e,a=1){return new Promise((c,h)=>{const d=[];this._limiters.forEach(et=>{d.push(et.consume(e,a).catch(ft=>({rejected:!0,rej:ft})))}),Promise.all(d).then(et=>{const ft={};let gt=!1;et.forEach(_t=>{_t.rejected===!0&&(gt=!0)});for(let _t=0;_t<et.length;_t++)gt&&et[_t].rejected===!0?ft[this._limiters[_t].keyPrefix]=et[_t].rej:gt||(ft[this._limiters[_t].keyPrefix]=et[_t]);gt?h(ft):c(ft)})})}},RateLimiterQueueError_1=class extends Error{constructor(e,a){super(),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.name="CustomError",this.message=e,a&&(this.extra=a)}};const RateLimiterQueueError=RateLimiterQueueError_1,MAX_QUEUE_SIZE=4294967295,KEY_DEFAULT="limiter";var RateLimiterQueue_1=class{constructor(e,a={maxQueueSize:MAX_QUEUE_SIZE}){this._queueLimiters={KEY_DEFAULT:new RateLimiterQueueInternal(e,a)},this._limiterFlexible=e,this._maxQueueSize=a.maxQueueSize}getTokensRemaining(e=KEY_DEFAULT){return this._queueLimiters[e]?this._queueLimiters[e].getTokensRemaining():Promise.resolve(this._limiterFlexible.points)}removeTokens(e,a=KEY_DEFAULT){return this._queueLimiters[a]||(this._queueLimiters[a]=new RateLimiterQueueInternal(this._limiterFlexible,{key:a,maxQueueSize:this._maxQueueSize})),this._queueLimiters[a].removeTokens(e)}};class RateLimiterQueueInternal{constructor(e,a={maxQueueSize:MAX_QUEUE_SIZE,key:KEY_DEFAULT}){this._key=a.key,this._waitTimeout=null,this._queue=[],this._limiterFlexible=e,this._maxQueueSize=a.maxQueueSize}getTokensRemaining(){return this._limiterFlexible.get(this._key).then(e=>e!==null?e.remainingPoints:this._limiterFlexible.points)}removeTokens(e){const a=this;return new Promise((c,h)=>{if(e>a._limiterFlexible.points){h(new RateLimiterQueueError(`Requested tokens ${e} exceeds maximum ${a._limiterFlexible.points} tokens per interval`));return}a._queue.length>0?a._queueRequest.call(a,c,h,e):a._limiterFlexible.consume(a._key,e).then(d=>{c(d.remainingPoints)}).catch(d=>{d instanceof Error?h(d):(a._queueRequest.call(a,c,h,e),a._waitTimeout===null&&(a._waitTimeout=setTimeout(a._processFIFO.bind(a),d.msBeforeNext)))})})}_queueRequest(e,a,c){const h=this;h._queue.length<h._maxQueueSize?h._queue.push({resolve:e,reject:a,tokens:c}):a(new RateLimiterQueueError(`Number of requests reached it's maximum ${h._maxQueueSize}`))}_processFIFO(){const e=this;if(e._waitTimeout!==null&&(clearTimeout(e._waitTimeout),e._waitTimeout=null),e._queue.length===0)return;const a=e._queue.shift();e._limiterFlexible.consume(e._key,a.tokens).then(c=>{a.resolve(c.remainingPoints),e._processFIFO.call(e)}).catch(c=>{c instanceof Error?(a.reject(c),e._processFIFO.call(e)):(e._queue.unshift(a),e._waitTimeout===null&&(e._waitTimeout=setTimeout(e._processFIFO.bind(e),c.msBeforeNext)))})}}const RateLimiterRes$1=RateLimiterRes_1;var BurstyRateLimiter_1=class{constructor(e,a){this._rateLimiter=e,this._burstLimiter=a}_combineRes(e,a){return e?new RateLimiterRes$1(e.remainingPoints,Math.min(e.msBeforeNext,a?a.msBeforeNext:0),e.consumedPoints,e.isFirstInDuration):null}consume(e,a=1,c={}){return this._rateLimiter.consume(e,a,c).catch(h=>h instanceof RateLimiterRes$1?this._burstLimiter.consume(e,a,c).then(d=>Promise.resolve(this._combineRes(h,d))).catch(d=>d instanceof RateLimiterRes$1?Promise.reject(this._combineRes(h,d)):Promise.reject(d)):Promise.reject(h))}get(e){return Promise.all([this._rateLimiter.get(e),this._burstLimiter.get(e)]).then(([a,c])=>this._combineRes(a,c))}get points(){return this._rateLimiter.points}};const RateLimiterRedis=RateLimiterRedis_1,RateLimiterMongo=RateLimiterMongo_1,RateLimiterMySQL=RateLimiterMySQL_1,RateLimiterPostgres=RateLimiterPostgres_1,{RateLimiterClusterMaster,RateLimiterClusterMasterPM2,RateLimiterCluster}=RateLimiterCluster$1,RateLimiterMemory=RateLimiterMemory_1,RateLimiterMemcache=RateLimiterMemcache_1,RLWrapperBlackAndWhite=RLWrapperBlackAndWhite_1,RateLimiterUnion=RateLimiterUnion_1,RateLimiterQueue=RateLimiterQueue_1,BurstyRateLimiter=BurstyRateLimiter_1,RateLimiterRes=RateLimiterRes_1;var rateLimiterFlexible={RateLimiterRedis,RateLimiterMongo,RateLimiterMySQL,RateLimiterPostgres,RateLimiterMemory,RateLimiterMemcache,RateLimiterClusterMaster,RateLimiterClusterMasterPM2,RateLimiterCluster,RLWrapperBlackAndWhite,RateLimiterUnion,RateLimiterQueue,BurstyRateLimiter,RateLimiterRes},MessageTypes;(function(i){i[i.NEW_STREAM=0]="NEW_STREAM",i[i.MESSAGE_RECEIVER=1]="MESSAGE_RECEIVER",i[i.MESSAGE_INITIATOR=2]="MESSAGE_INITIATOR",i[i.CLOSE_RECEIVER=3]="CLOSE_RECEIVER",i[i.CLOSE_INITIATOR=4]="CLOSE_INITIATOR",i[i.RESET_RECEIVER=5]="RESET_RECEIVER",i[i.RESET_INITIATOR=6]="RESET_INITIATOR"})(MessageTypes||(MessageTypes={}));const MessageTypeNames=Object.freeze({0:"NEW_STREAM",1:"MESSAGE_RECEIVER",2:"MESSAGE_INITIATOR",3:"CLOSE_RECEIVER",4:"CLOSE_INITIATOR",5:"RESET_RECEIVER",6:"RESET_INITIATOR"}),InitiatorMessageTypes=Object.freeze({NEW_STREAM:MessageTypes.NEW_STREAM,MESSAGE:MessageTypes.MESSAGE_INITIATOR,CLOSE:MessageTypes.CLOSE_INITIATOR,RESET:MessageTypes.RESET_INITIATOR}),ReceiverMessageTypes=Object.freeze({MESSAGE:MessageTypes.MESSAGE_RECEIVER,CLOSE:MessageTypes.CLOSE_RECEIVER,RESET:MessageTypes.RESET_RECEIVER}),MAX_MSG_SIZE=1<<20,MAX_MSG_QUEUE_SIZE=4<<20;let Decoder$4=class{constructor(e=MAX_MSG_SIZE,a=MAX_MSG_QUEUE_SIZE){qt(this,"_buffer");qt(this,"_headerInfo");qt(this,"_maxMessageSize");qt(this,"_maxUnprocessedMessageQueueSize");this._buffer=new Uint8ArrayList,this._headerInfo=null,this._maxMessageSize=e,this._maxUnprocessedMessageQueueSize=a}write(e){if(e==null||e.length===0)return[];if(this._buffer.append(e),this._buffer.byteLength>this._maxUnprocessedMessageQueueSize)throw Object.assign(new Error("unprocessed message queue size too large!"),{code:"ERR_MSG_QUEUE_TOO_BIG"});const a=[];for(;this._buffer.length!==0;){if(this._headerInfo==null)try{this._headerInfo=this._decodeHeader(this._buffer)}catch(_t){if(_t.code==="ERR_MSG_TOO_BIG")throw _t;break}const{id:c,type:h,length:d,offset:et}=this._headerInfo;if(this._buffer.length-et<d)break;const gt={id:c,type:h};(h===MessageTypes.NEW_STREAM||h===MessageTypes.MESSAGE_INITIATOR||h===MessageTypes.MESSAGE_RECEIVER)&&(gt.data=this._buffer.sublist(et,et+d)),a.push(gt),this._buffer.consume(et+d),this._headerInfo=null}return a}_decodeHeader(e){const{value:a,offset:c}=readVarInt(e),{value:h,offset:d}=readVarInt(e,c),et=a&7;if(MessageTypeNames[et]==null)throw new Error(`Invalid type received: ${et}`);if(h>this._maxMessageSize)throw Object.assign(new Error("message size too large!"),{code:"ERR_MSG_TOO_BIG"});return{id:a>>3,type:et,offset:c+d,length:h}}};const MSB=128,REST=127;function readVarInt(i,e=0){let a=0,c=0,h=e,d;const et=i.length;do{if(h>=et||c>49)throw e=0,new RangeError("Could not decode varint");d=i.get(h++),a+=c<28?(d&REST)<<c:(d&REST)*Math.pow(2,c),c+=7}while(d>=MSB);return e=h-e,{value:a,offset:e}}function isAsyncIterable$6(i){return i[Symbol.asyncIterator]!=null}const DEFAULT_BATCH_SIZE=1024*1024,DEFAULT_SERIALIZE=(i,e)=>{e.append(i)};function batchedBytes(i,e){return isAsyncIterable$6(i)?async function*(){let a=new Uint8ArrayList,c=!1,h=pDefer(),d=Number((e==null?void 0:e.size)??DEFAULT_BATCH_SIZE);if((isNaN(d)||d===0||d<0)&&(d=DEFAULT_BATCH_SIZE),d!==Math.round(d))throw new Error("Batch size must be an integer");const et=(e==null?void 0:e.yieldAfter)??0,ft=(e==null?void 0:e.serialize)??DEFAULT_SERIALIZE;for(Promise.resolve().then(async()=>{try{let gt;for await(const _t of i){if(ft(_t,a),a.byteLength>=d){clearTimeout(gt),h.resolve();continue}gt=setTimeout(()=>{h.resolve()},et)}clearTimeout(gt),h.resolve()}catch(gt){h.reject(gt)}finally{c=!0}});!c;)if(await h.promise,h=pDefer(),a.byteLength>0){const gt=a;a=new Uint8ArrayList,yield gt.subarray()}}():function*(){const a=new Uint8ArrayList;let c=Number((e==null?void 0:e.size)??DEFAULT_BATCH_SIZE);if((isNaN(c)||c===0||c<0)&&(c=DEFAULT_BATCH_SIZE),c!==Math.round(c))throw new Error("Batch size must be an integer");const h=(e==null?void 0:e.serialize)??DEFAULT_SERIALIZE;for(const d of i)h(d,a),a.byteLength>=c&&(yield a.subarray(0,c),a.consume(c));a.byteLength>0&&(yield a.subarray())}()}function allocUnsafe$3(i){return new Uint8Array(i)}const POOL_SIZE=10*1024;let Encoder$4=class{constructor(){qt(this,"_pool");qt(this,"_poolOffset");this._pool=allocUnsafe$3(POOL_SIZE),this._poolOffset=0}write(e,a){const c=this._pool;let h=this._poolOffset;encode$o(e.id<<3|e.type,c,h),h+=encodingLength$4(e.id<<3|e.type),(e.type===MessageTypes.NEW_STREAM||e.type===MessageTypes.MESSAGE_INITIATOR||e.type===MessageTypes.MESSAGE_RECEIVER)&&e.data!=null?(encode$o(e.data.length,c,h),h+=encodingLength$4(e.data.length)):(encode$o(0,c,h),h+=encodingLength$4(0));const d=c.subarray(this._poolOffset,h);POOL_SIZE-h<100?(this._pool=allocUnsafe$3(POOL_SIZE),this._poolOffset=0):this._poolOffset=h,a.append(d),(e.type===MessageTypes.NEW_STREAM||e.type===MessageTypes.MESSAGE_INITIATOR||e.type===MessageTypes.MESSAGE_RECEIVER)&&e.data!=null&&a.append(e.data)}};const encoder=new Encoder$4;async function*encode$b(i,e=0){if(e==null||e===0){for await(const a of i){const c=new Uint8ArrayList;for(const h of a)encoder.write(h,c);yield c.subarray()}return}yield*batchedBytes(i,{size:e,serialize:(a,c)=>{for(const h of a)encoder.write(h,c)}})}const ERR_STREAM_RESET="ERR_STREAM_RESET",ERR_SINK_INVALID_STATE="ERR_SINK_INVALID_STATE",DEFAULT_SEND_CLOSE_WRITE_TIMEOUT=5e3;function isPromise$1(i){return i!=null&&typeof i.then=="function"}class AbstractStream{constructor(e){qt(this,"id");qt(this,"direction");qt(this,"timeline");qt(this,"protocol");qt(this,"metadata");qt(this,"source");qt(this,"status");qt(this,"readStatus");qt(this,"writeStatus");qt(this,"sinkController");qt(this,"sinkEnd");qt(this,"endErr");qt(this,"streamSource");qt(this,"onEnd");qt(this,"onCloseRead");qt(this,"onCloseWrite");qt(this,"onReset");qt(this,"onAbort");qt(this,"sendCloseWriteTimeout");qt(this,"log");this.sinkController=new AbortController,this.sinkEnd=pDefer(),this.log=e.log,this.status="open",this.readStatus="ready",this.writeStatus="ready",this.id=e.id,this.metadata=e.metadata??{},this.direction=e.direction,this.timeline={open:Date.now()},this.sendCloseWriteTimeout=e.sendCloseWriteTimeout??DEFAULT_SEND_CLOSE_WRITE_TIMEOUT,this.onEnd=e.onEnd,this.onCloseRead=e==null?void 0:e.onCloseRead,this.onCloseWrite=e==null?void 0:e.onCloseWrite,this.onReset=e==null?void 0:e.onReset,this.onAbort=e==null?void 0:e.onAbort,this.source=this.streamSource=pushable$1({onEnd:a=>{a!=null?this.log.trace("source ended with error",a):this.log.trace("source ended"),this.onSourceEnd(a)}}),this.sink=this.sink.bind(this)}async sink(e){if(this.writeStatus!=="ready")throw new CodeError$2(`writable end state is "${this.writeStatus}" not "ready"`,ERR_SINK_INVALID_STATE);try{this.writeStatus="writing";const a={signal:this.sinkController.signal};if(this.direction==="outbound"){const c=this.sendNewStream(a);isPromise$1(c)&&await c}e=abortableSource(e,this.sinkController.signal,{returnOnAbort:!0}),this.log.trace("sink reading from source");for await(let c of e){c=c instanceof Uint8Array?new Uint8ArrayList(c):c;const h=this.sendData(c,a);isPromise$1(h)&&await h}this.log.trace('sink finished reading from source, write status is "%s"',this.writeStatus),this.writeStatus==="writing"&&(this.writeStatus="closing",this.log.trace("send close write to remote"),await this.sendCloseWrite({signal:AbortSignal.timeout(this.sendCloseWriteTimeout)}),this.writeStatus="closed"),this.onSinkEnd()}catch(a){throw this.log.trace("sink ended with error, calling abort with error",a),this.abort(a),a}finally{this.log.trace("resolve sink end"),this.sinkEnd.resolve()}}onSourceEnd(e){var a;this.timeline.closeRead==null&&(this.timeline.closeRead=Date.now(),this.readStatus="closed",e!=null&&this.endErr==null&&(this.endErr=e),(a=this.onCloseRead)==null||a.call(this),this.timeline.closeWrite!=null?(this.log.trace("source and sink ended"),this.timeline.close=Date.now(),this.status!=="aborted"&&this.status!=="reset"&&(this.status="closed"),this.onEnd!=null&&this.onEnd(this.endErr)):this.log.trace("source ended, waiting for sink to end"))}onSinkEnd(e){var a;this.timeline.closeWrite==null&&(this.timeline.closeWrite=Date.now(),this.writeStatus="closed",e!=null&&this.endErr==null&&(this.endErr=e),(a=this.onCloseWrite)==null||a.call(this),this.timeline.closeRead!=null?(this.log.trace("sink and source ended"),this.timeline.close=Date.now(),this.status!=="aborted"&&this.status!=="reset"&&(this.status="closed"),this.onEnd!=null&&this.onEnd(this.endErr)):this.log.trace("sink ended, waiting for source to end"))}async close(e){this.log.trace("closing gracefully"),this.status="closing",await Promise.all([this.closeRead(e),this.closeWrite(e)]),this.status="closed",this.log.trace("closed gracefully")}async closeRead(e={}){if(this.readStatus==="closing"||this.readStatus==="closed")return;this.log.trace('closing readable end of stream with starting read status "%s"',this.readStatus);const a=this.readStatus;this.readStatus="closing",this.status!=="reset"&&this.status!=="aborted"&&this.timeline.closeRead==null&&(this.log.trace("send close read to remote"),await this.sendCloseRead(e)),a==="ready"&&(this.log.trace("ending internal source queue"),this.streamSource.end()),this.log.trace("closed readable end of stream")}async closeWrite(e={}){this.writeStatus==="closing"||this.writeStatus==="closed"||(this.log.trace('closing writable end of stream with starting write status "%s"',this.writeStatus),this.writeStatus==="ready"&&(this.log.trace("sink was never sunk, sink an empty array"),await raceSignal(this.sink([]),e.signal)),this.writeStatus==="writing"&&await new Promise((a,c)=>{queueMicrotask(()=>{this.log.trace("aborting source passed to .sink"),this.sinkController.abort(),raceSignal(this.sinkEnd.promise,e.signal).then(a,c)})}),this.writeStatus="closed",this.log.trace("closed writable end of stream"))}abort(e){var c;if(this.status==="closed"||this.status==="aborted"||this.status==="reset")return;this.log("abort with error",e),this.log("try to send reset to remote");const a=this.sendReset();isPromise$1(a)&&a.catch(h=>{this.log.error("error sending reset message",h)}),this.status="aborted",this.timeline.abort=Date.now(),this._closeSinkAndSource(e),(c=this.onAbort)==null||c.call(this,e)}reset(){var a;if(this.status==="closed"||this.status==="aborted"||this.status==="reset")return;const e=new CodeError$2("stream reset",ERR_STREAM_RESET);this.status="reset",this.timeline.reset=Date.now(),this._closeSinkAndSource(e),(a=this.onReset)==null||a.call(this)}_closeSinkAndSource(e){this._closeSink(e),this._closeSource(e)}_closeSink(e){this.writeStatus==="writing"&&(this.log.trace("end sink source"),this.sinkController.abort()),this.onSinkEnd(e)}_closeSource(e){this.readStatus!=="closing"&&this.readStatus!=="closed"&&(this.log.trace("ending source with %d bytes to be read by consumer",this.streamSource.readableLength),this.readStatus="closing",this.streamSource.end(e))}remoteCloseWrite(){if(this.readStatus==="closing"||this.readStatus==="closed"){this.log("received remote close write but local source is already closed");return}this.log.trace("remote close write"),this._closeSource()}remoteCloseRead(){if(this.writeStatus==="closing"||this.writeStatus==="closed"){this.log("received remote close read but local sink is already closed");return}this.log.trace("remote close read"),this._closeSink()}destroy(){if(this.status==="closed"||this.status==="aborted"||this.status==="reset"){this.log("received destroy but we are already closed");return}this.log.trace("stream destroyed"),this._closeSinkAndSource()}sourcePush(e){this.streamSource.push(e)}sourceReadableLength(){return this.streamSource.readableLength}}class MplexStream extends AbstractStream{constructor(a){super(a);qt(this,"name");qt(this,"streamId");qt(this,"send");qt(this,"types");qt(this,"maxDataSize");this.types=a.direction==="outbound"?InitiatorMessageTypes:ReceiverMessageTypes,this.send=a.send,this.name=a.name,this.streamId=a.streamId,this.maxDataSize=a.maxDataSize}async sendNewStream(){await this.send({id:this.streamId,type:InitiatorMessageTypes.NEW_STREAM,data:new Uint8ArrayList(fromString$9(this.name))})}async sendData(a){for(a=a.sublist();a.byteLength>0;){const c=Math.min(a.byteLength,this.maxDataSize);await this.send({id:this.streamId,type:this.types.MESSAGE,data:a.sublist(0,c)}),a.consume(c)}}async sendReset(){await this.send({id:this.streamId,type:this.types.RESET})}async sendCloseWrite(){await this.send({id:this.streamId,type:this.types.CLOSE})}async sendCloseRead(){}}function createStream(i){const{id:e,name:a,send:c,onEnd:h,type:d="initiator",maxMsgSize:et=MAX_MSG_SIZE}=i;return new MplexStream({id:d==="initiator"?`i${e}`:`r${e}`,streamId:e,name:`${a??e}`,direction:d==="initiator"?"outbound":"inbound",maxDataSize:et,onEnd:h,send:c,log:logger$2(`libp2p:mplex:stream:${d}:${e}`)})}const log$n=logger$2("libp2p:mplex"),MAX_STREAMS_INBOUND_STREAMS_PER_CONNECTION=1024,MAX_STREAMS_OUTBOUND_STREAMS_PER_CONNECTION=1024,MAX_STREAM_BUFFER_SIZE=1024*1024*4,DISCONNECT_THRESHOLD=5,CLOSE_TIMEOUT$2=500;function printMessage(i){const e={...i,type:`${MessageTypeNames[i.type]} (${i.type})`};return i.type===MessageTypes.NEW_STREAM&&(e.data=toString$d(i.data instanceof Uint8Array?i.data:i.data.subarray())),(i.type===MessageTypes.MESSAGE_INITIATOR||i.type===MessageTypes.MESSAGE_RECEIVER)&&(e.data=toString$d(i.data instanceof Uint8Array?i.data:i.data.subarray(),"base16")),e}class MplexStreamMuxer{constructor(e){qt(this,"protocol","/mplex/6.7.0");qt(this,"sink");qt(this,"source");qt(this,"_streamId");qt(this,"_streams");qt(this,"_init");qt(this,"_source");qt(this,"closeController");qt(this,"rateLimiter");qt(this,"closeTimeout");e=e??{},this._streamId=0,this._streams={initiators:new Map,receivers:new Map},this._init=e,this.closeTimeout=e.closeTimeout??CLOSE_TIMEOUT$2,this.sink=this._createSink(),this._source=pushableV({objectMode:!0,onEnd:()=>{for(const a of this._streams.initiators.values())a.destroy();for(const a of this._streams.receivers.values())a.destroy()}}),this.source=pipe(this._source,a=>encode$b(a,this._init.minSendBytes)),this.closeController=new AbortController,this.rateLimiter=new rateLimiterFlexible.RateLimiterMemory({points:e.disconnectThreshold??DISCONNECT_THRESHOLD,duration:1})}get streams(){const e=[];for(const a of this._streams.initiators.values())e.push(a);for(const a of this._streams.receivers.values())e.push(a);return e}newStream(e){if(this.closeController.signal.aborted)throw new Error("Muxer already closed");const a=this._streamId++;e=e==null?a.toString():e.toString();const c=this._streams.initiators;return this._newStream({id:a,name:e,type:"initiator",registry:c})}async close(e){if(this.closeController.signal.aborted)return;const a=(e==null?void 0:e.signal)??AbortSignal.timeout(this.closeTimeout);try{await Promise.all(this.streams.map(async c=>c.close({signal:a}))),this._source.end(),await this._source.onEmpty({signal:a}),this.closeController.abort()}catch(c){this.abort(c)}}abort(e){this.closeController.signal.aborted||(this.streams.forEach(a=>{a.abort(e)}),this.closeController.abort(e))}_newReceiverStream(e){const{id:a,name:c}=e,h=this._streams.receivers;return this._newStream({id:a,name:c,type:"receiver",registry:h})}_newStream(e){const{id:a,name:c,type:h,registry:d}=e;if(log$n("new %s stream %s",h,a),h==="initiator"&&this._streams.initiators.size===(this._init.maxOutboundStreams??MAX_STREAMS_OUTBOUND_STREAMS_PER_CONNECTION))throw new CodeError$2("Too many outbound streams open","ERR_TOO_MANY_OUTBOUND_STREAMS");if(d.has(a))throw new Error(`${h} stream ${a} already exists!`);const gt=createStream({id:a,name:c,send:async _t=>{log$n.enabled&&log$n.trace("%s stream %s send",h,a,printMessage(_t)),this._source.push(_t)},type:h,onEnd:()=>{log$n("%s stream with id %s and protocol %s ended",h,a,gt.protocol),d.delete(a),this._init.onStreamEnd!=null&&this._init.onStreamEnd(gt)},maxMsgSize:this._init.maxMsgSize});return d.set(a,gt),gt}_createSink(){return async a=>{try{a=abortableSource(a,this.closeController.signal,{returnOnAbort:!0});const c=new Decoder$4(this._init.maxMsgSize,this._init.maxUnprocessedMessageQueueSize);for await(const h of a)for(const d of c.write(h))await this._handleIncoming(d);this._source.end()}catch(c){log$n("error in sink",c),this._source.end(c)}}}async _handleIncoming(e){const{id:a,type:c}=e;if(log$n.enabled&&log$n.trace("incoming message",printMessage(e)),e.type===MessageTypes.NEW_STREAM){if(this._streams.receivers.size===(this._init.maxInboundStreams??MAX_STREAMS_INBOUND_STREAMS_PER_CONNECTION)){log$n("too many inbound streams open"),this._source.push({id:a,type:MessageTypes.RESET_RECEIVER});try{await this.rateLimiter.consume("new-stream",1)}catch{log$n("rate limit hit when opening too many new streams over the inbound stream limit - closing remote connection"),this.abort(new Error("Too many open streams"));return}return}const ft=this._newReceiverStream({id:a,name:toString$d(e.data instanceof Uint8Array?e.data:e.data.subarray())});this._init.onIncomingStream!=null&&this._init.onIncomingStream(ft);return}const d=((c&1)===1?this._streams.initiators:this._streams.receivers).get(a);if(d==null){log$n("missing stream %s for message type %s",a,MessageTypeNames[c]);try{await this.rateLimiter.consume("missing-stream",1)}catch{log$n("rate limit hit when receiving messages for streams that do not exist - closing remote connection"),this.abort(new Error("Too many messages for missing streams"));return}return}const et=this._init.maxStreamBufferSize??MAX_STREAM_BUFFER_SIZE;try{switch(c){case MessageTypes.MESSAGE_INITIATOR:case MessageTypes.MESSAGE_RECEIVER:if(d.sourceReadableLength()>et)throw this._source.push({id:e.id,type:c===MessageTypes.MESSAGE_INITIATOR?MessageTypes.RESET_RECEIVER:MessageTypes.RESET_INITIATOR}),new CodeError$2("Input buffer full - increase Mplex maxBufferSize to accommodate slow consumers","ERR_STREAM_INPUT_BUFFER_FULL");d.sourcePush(e.data);break;case MessageTypes.CLOSE_INITIATOR:case MessageTypes.CLOSE_RECEIVER:d.remoteCloseWrite();break;case MessageTypes.RESET_INITIATOR:case MessageTypes.RESET_RECEIVER:d.reset();break;default:log$n("unknown message type %s",c)}}catch(ft){log$n.error("error while processing message",ft),d.abort(ft)}}}class Mplex{constructor(e={}){qt(this,"protocol","/mplex/6.7.0");qt(this,"_init");this._init=e}createStreamMuxer(e={}){return new MplexStreamMuxer({...e,...this._init})}}function mplex(i={}){return()=>new Mplex(i)}const symbol$1=Symbol.for("@libp2p/transport");var FaultTolerance;(function(i){i[i.FATAL_ALL=0]="FATAL_ALL",i[i.NO_FATAL=1]="NO_FATAL"})(FaultTolerance||(FaultTolerance={}));function extractSNI(i){let e;try{e=getProtocol("sni").code}catch{return null}for(const[a,c]of i)if(a===e&&c!==void 0)return c;return null}function hasTLS(i){return i.some(([e,a])=>e===getProtocol("tls").code)}function interpretNext(i,e,a){const c=interpreters[getProtocol(i).name];if(c===void 0)throw new Error(`Can't interpret protocol ${getProtocol(i).name}`);const h=c(e,a);return i===getProtocol("ip6").code?`[${h}]`:h}const interpreters={ip4:(i,e)=>i,ip6:(i,e)=>e.length===0?i:`[${i}]`,tcp:(i,e)=>{const a=e.pop();if(a===void 0)throw new Error("Unexpected end of multiaddr");return`tcp://${interpretNext(a[0],a[1]??"",e)}:${i}`},udp:(i,e)=>{const a=e.pop();if(a===void 0)throw new Error("Unexpected end of multiaddr");return`udp://${interpretNext(a[0],a[1]??"",e)}:${i}`},dnsaddr:(i,e)=>i,dns4:(i,e)=>i,dns6:(i,e)=>i,dns:(i,e)=>i,ipfs:(i,e)=>{const a=e.pop();if(a===void 0)throw new Error("Unexpected end of multiaddr");return`${interpretNext(a[0],a[1]??"",e)}/ipfs/${i}`},p2p:(i,e)=>{const a=e.pop();if(a===void 0)throw new Error("Unexpected end of multiaddr");return`${interpretNext(a[0],a[1]??"",e)}/p2p/${i}`},http:(i,e)=>{const a=hasTLS(e),c=extractSNI(e);if(a&&c!==null)return`https://${c}`;const h=a?"https://":"http://",d=e.pop();if(d===void 0)throw new Error("Unexpected end of multiaddr");let et=interpretNext(d[0],d[1]??"",e);return et=et.replace("tcp://",""),`${h}${et}`},tls:(i,e)=>{const a=e.pop();if(a===void 0)throw new Error("Unexpected end of multiaddr");return interpretNext(a[0],a[1]??"",e)},sni:(i,e)=>{const a=e.pop();if(a===void 0)throw new Error("Unexpected end of multiaddr");return interpretNext(a[0],a[1]??"",e)},https:(i,e)=>{const a=e.pop();if(a===void 0)throw new Error("Unexpected end of multiaddr");let c=interpretNext(a[0],a[1]??"",e);return c=c.replace("tcp://",""),`https://${c}`},ws:(i,e)=>{const a=hasTLS(e),c=extractSNI(e);if(a&&c!==null)return`wss://${c}`;const h=a?"wss://":"ws://",d=e.pop();if(d===void 0)throw new Error("Unexpected end of multiaddr");let et=interpretNext(d[0],d[1]??"",e);return et=et.replace("tcp://",""),`${h}${et}`},wss:(i,e)=>{const a=e.pop();if(a===void 0)throw new Error("Unexpected end of multiaddr");let c=interpretNext(a[0],a[1]??"",e);return c=c.replace("tcp://",""),`wss://${c}`},"p2p-websocket-star":(i,e)=>{const a=e.pop();if(a===void 0)throw new Error("Unexpected end of multiaddr");return`${interpretNext(a[0],a[1]??"",e)}/p2p-websocket-star`},"p2p-webrtc-star":(i,e)=>{const a=e.pop();if(a===void 0)throw new Error("Unexpected end of multiaddr");return`${interpretNext(a[0],a[1]??"",e)}/p2p-webrtc-star`},"p2p-webrtc-direct":(i,e)=>{const a=e.pop();if(a===void 0)throw new Error("Unexpected end of multiaddr");return`${interpretNext(a[0],a[1]??"",e)}/p2p-webrtc-direct`}};function multiaddrToUri(i,e){const c=multiaddr(i).stringTuples(),h=c.pop();if(h===void 0)throw new Error("Unexpected end of multiaddr");const d=getProtocol(h[0]),et=interpreters[d.name];if(et==null)throw new Error(`No interpreter found for ${d.name}`);let ft=et(h[1]??"",c);return(e==null?void 0:e.assumeHttp)!==!1&&h[0]===getProtocol("tcp").code&&(ft=ft.replace("tcp://","http://"),(h[1]==="443"||h[1]==="80")&&(h[1]==="443"&&(ft=ft.replace("http://","https://")),ft=ft.substring(0,ft.lastIndexOf(":")))),ft}const ready=async i=>{if(i.readyState>=2)throw new Error("socket closed");i.readyState!==1&&await new Promise((e,a)=>{function c(){i.removeEventListener("open",h),i.removeEventListener("error",d)}function h(){c(),e()}function d(et){c(),a(et.error??new Error(`connect ECONNREFUSED ${i.url}`))}i.addEventListener("open",h),i.addEventListener("error",d)})},sink=(i,e)=>(e=e??{},e.closeOnEnd=e.closeOnEnd!==!1,async c=>{for await(const h of c){try{await ready(i)}catch(d){if(d.message==="socket closed")break;throw d}if(i.readyState===i.CLOSING||i.readyState===i.CLOSED)break;i.send(h)}e.closeOnEnd!=null&&i.readyState<=1&&await new Promise((h,d)=>{i.addEventListener("close",et=>{if(et.wasClean||et.code===1006)h();else{const ft=Object.assign(new Error("ws error"),{event:et});d(ft)}}),setTimeout(()=>{i.close()})})});var dom={},eventIterator={};Object.defineProperty(eventIterator,"__esModule",{value:!0});let EventQueue$1=class{constructor(){this.pullQueue=[],this.pushQueue=[],this.eventHandlers={},this.isPaused=!1,this.isStopped=!1}push(e){if(this.isStopped)return;const a={value:e,done:!1};if(this.pullQueue.length){const c=this.pullQueue.shift();c&&c.resolve(a)}else this.pushQueue.push(Promise.resolve(a)),this.highWaterMark!==void 0&&this.pushQueue.length>=this.highWaterMark&&!this.isPaused&&(this.isPaused=!0,this.eventHandlers.highWater?this.eventHandlers.highWater():console&&console.warn(`EventIterator queue reached ${this.pushQueue.length} items`))}stop(){if(!this.isStopped){this.isStopped=!0,this.remove();for(const e of this.pullQueue)e.resolve({value:void 0,done:!0});this.pullQueue.length=0}}fail(e){if(!this.isStopped)if(this.isStopped=!0,this.remove(),this.pullQueue.length){for(const a of this.pullQueue)a.reject(e);this.pullQueue.length=0}else{const a=Promise.reject(e);a.catch(()=>{}),this.pushQueue.push(a)}}remove(){Promise.resolve().then(()=>{this.removeCallback&&this.removeCallback()})}[Symbol.asyncIterator](){return{next:e=>{const a=this.pushQueue.shift();return a?(this.lowWaterMark!==void 0&&this.pushQueue.length<=this.lowWaterMark&&this.isPaused&&(this.isPaused=!1,this.eventHandlers.lowWater&&this.eventHandlers.lowWater()),a):this.isStopped?Promise.resolve({value:void 0,done:!0}):new Promise((c,h)=>{this.pullQueue.push({resolve:c,reject:h})})},return:()=>(this.isStopped=!0,this.pushQueue.length=0,this.remove(),Promise.resolve({value:void 0,done:!0}))}}},EventIterator$1=class{constructor(e,{highWaterMark:a=100,lowWaterMark:c=1}={}){const h=new EventQueue$1;h.highWaterMark=a,h.lowWaterMark=c,h.removeCallback=e({push:d=>h.push(d),stop:()=>h.stop(),fail:d=>h.fail(d),on:(d,et)=>{h.eventHandlers[d]=et}})||(()=>{}),this[Symbol.asyncIterator]=()=>h[Symbol.asyncIterator](),Object.freeze(this)}};eventIterator.EventIterator=EventIterator$1;eventIterator.default=EventIterator$1;Object.defineProperty(dom,"__esModule",{value:!0});const event_iterator_1=eventIterator;var EventIterator=dom.EventIterator=event_iterator_1.EventIterator;function subscribe(i,e,a){return new event_iterator_1.EventIterator(({push:c})=>(this.addEventListener(i,c,e),()=>this.removeEventListener(i,c,e)),a)}dom.subscribe=subscribe;dom.default=event_iterator_1.EventIterator;function coerce$3(i){if(i instanceof Uint8Array&&i.constructor.name==="Uint8Array")return i;if(i instanceof ArrayBuffer)return new Uint8Array(i);if(ArrayBuffer.isView(i))return new Uint8Array(i.buffer,i.byteOffset,i.byteLength);throw new Error("Unknown type, must be binary type")}function fromString$4(i){return new TextEncoder().encode(i)}function toString$9(i){return new TextDecoder().decode(i)}function base$4(i,e){if(i.length>=255)throw new TypeError("Alphabet too long");for(var a=new Uint8Array(256),c=0;c<a.length;c++)a[c]=255;for(var h=0;h<i.length;h++){var d=i.charAt(h),et=d.charCodeAt(0);if(a[et]!==255)throw new TypeError(d+" is ambiguous");a[et]=h}var ft=i.length,gt=i.charAt(0),_t=Math.log(ft)/Math.log(256),wt=Math.log(256)/Math.log(ft);function $t(Tt){if(Tt instanceof Uint8Array||(ArrayBuffer.isView(Tt)?Tt=new Uint8Array(Tt.buffer,Tt.byteOffset,Tt.byteLength):Array.isArray(Tt)&&(Tt=Uint8Array.from(Tt))),!(Tt instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(Tt.length===0)return"";for(var At=0,kt=0,xt=0,Nt=Tt.length;xt!==Nt&&Tt[xt]===0;)xt++,At++;for(var Ft=(Nt-xt)*wt+1>>>0,jt=new Uint8Array(Ft);xt!==Nt;){for(var Gt=Tt[xt],Kt=0,Wt=Ft-1;(Gt!==0||Kt<kt)&&Wt!==-1;Wt--,Kt++)Gt+=256*jt[Wt]>>>0,jt[Wt]=Gt%ft>>>0,Gt=Gt/ft>>>0;if(Gt!==0)throw new Error("Non-zero carry");kt=Kt,xt++}for(var Zt=Ft-kt;Zt!==Ft&&jt[Zt]===0;)Zt++;for(var cr=gt.repeat(At);Zt<Ft;++Zt)cr+=i.charAt(jt[Zt]);return cr}function It(Tt){if(typeof Tt!="string")throw new TypeError("Expected String");if(Tt.length===0)return new Uint8Array;var At=0;if(Tt[At]!==" "){for(var kt=0,xt=0;Tt[At]===gt;)kt++,At++;for(var Nt=(Tt.length-At)*_t+1>>>0,Ft=new Uint8Array(Nt);Tt[At];){var jt=a[Tt.charCodeAt(At)];if(jt===255)return;for(var Gt=0,Kt=Nt-1;(jt!==0||Gt<xt)&&Kt!==-1;Kt--,Gt++)jt+=ft*Ft[Kt]>>>0,Ft[Kt]=jt%256>>>0,jt=jt/256>>>0;if(jt!==0)throw new Error("Non-zero carry");xt=Gt,At++}if(Tt[At]!==" "){for(var Wt=Nt-xt;Wt!==Nt&&Ft[Wt]===0;)Wt++;for(var Zt=new Uint8Array(kt+(Nt-Wt)),cr=kt;Wt!==Nt;)Zt[cr++]=Ft[Wt++];return Zt}}}function Rt(Tt){var At=It(Tt);if(At)return At;throw new Error(`Non-${e} character`)}return{encode:$t,decodeUnsafe:It,decode:Rt}}var src$3=base$4,_brrp__multiformats_scope_baseX$3=src$3;let Encoder$3=class{constructor(e,a,c){qt(this,"name");qt(this,"prefix");qt(this,"baseEncode");this.name=e,this.prefix=a,this.baseEncode=c}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Decoder$3=class{constructor(e,a,c){qt(this,"name");qt(this,"prefix");qt(this,"baseDecode");qt(this,"prefixCodePoint");if(this.name=e,this.prefix=a,a.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=a.codePointAt(0),this.baseDecode=c}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return or$5(this,e)}},ComposedDecoder$3=class{constructor(e){qt(this,"decoders");this.decoders=e}or(e){return or$5(this,e)}decode(e){const a=e[0],c=this.decoders[a];if(c!=null)return c.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function or$5(i,e){return new ComposedDecoder$3({...i.decoders??{[i.prefix]:i},...e.decoders??{[e.prefix]:e}})}let Codec$3=class{constructor(e,a,c,h){qt(this,"name");qt(this,"prefix");qt(this,"baseEncode");qt(this,"baseDecode");qt(this,"encoder");qt(this,"decoder");this.name=e,this.prefix=a,this.baseEncode=c,this.baseDecode=h,this.encoder=new Encoder$3(e,a,c),this.decoder=new Decoder$3(e,a,h)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function from$4({name:i,prefix:e,encode:a,decode:c}){return new Codec$3(i,e,a,c)}function baseX$3({name:i,prefix:e,alphabet:a}){const{encode:c,decode:h}=_brrp__multiformats_scope_baseX$3(a,i);return from$4({prefix:e,name:i,encode:c,decode:d=>coerce$3(h(d))})}function decode$a(i,e,a,c){const h={};for(let wt=0;wt<e.length;++wt)h[e[wt]]=wt;let d=i.length;for(;i[d-1]==="=";)--d;const et=new Uint8Array(d*a/8|0);let ft=0,gt=0,_t=0;for(let wt=0;wt<d;++wt){const $t=h[i[wt]];if($t===void 0)throw new SyntaxError(`Non-${c} character`);gt=gt<<a|$t,ft+=a,ft>=8&&(ft-=8,et[_t++]=255&gt>>ft)}if(ft>=a||255&gt<<8-ft)throw new SyntaxError("Unexpected end of data");return et}function encode$a(i,e,a){const c=e[e.length-1]==="=",h=(1<<a)-1;let d="",et=0,ft=0;for(let gt=0;gt<i.length;++gt)for(ft=ft<<8|i[gt],et+=8;et>a;)et-=a,d+=e[h&ft>>et];if(et!==0&&(d+=e[h&ft<<a-et]),c)for(;d.length*a&7;)d+="=";return d}function rfc4648$3({name:i,prefix:e,bitsPerChar:a,alphabet:c}){return from$4({prefix:e,name:i,encode(h){return encode$a(h,c,a)},decode(h){return decode$a(h,c,a,i)}})}const base10$4=baseX$3({prefix:"9",name:"base10",alphabet:"0123456789"}),base10$5=Object.freeze(Object.defineProperty({__proto__:null,base10:base10$4},Symbol.toStringTag,{value:"Module"})),base16$4=rfc4648$3({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),base16upper$2=rfc4648$3({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),base16$5=Object.freeze(Object.defineProperty({__proto__:null,base16:base16$4,base16upper:base16upper$2},Symbol.toStringTag,{value:"Module"})),base2$4=rfc4648$3({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),base2$5=Object.freeze(Object.defineProperty({__proto__:null,base2:base2$4},Symbol.toStringTag,{value:"Module"})),alphabet$2=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),alphabetBytesToChars$2=alphabet$2.reduce((i,e,a)=>(i[a]=e,i),[]),alphabetCharsToBytes$2=alphabet$2.reduce((i,e,a)=>(i[e.codePointAt(0)]=a,i),[]);function encode$9(i){return i.reduce((e,a)=>(e+=alphabetBytesToChars$2[a],e),"")}function decode$9(i){const e=[];for(const a of i){const c=alphabetCharsToBytes$2[a.codePointAt(0)];if(c===void 0)throw new Error(`Non-base256emoji character: ${a}`);e.push(c)}return new Uint8Array(e)}const base256emoji$4=from$4({prefix:"🚀",name:"base256emoji",encode:encode$9,decode:decode$9}),base256emoji$5=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:base256emoji$4},Symbol.toStringTag,{value:"Module"})),base32$6=rfc4648$3({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),base32upper$2=rfc4648$3({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),base32pad$2=rfc4648$3({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),base32padupper$2=rfc4648$3({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),base32hex$2=rfc4648$3({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),base32hexupper$2=rfc4648$3({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),base32hexpad$2=rfc4648$3({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),base32hexpadupper$2=rfc4648$3({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),base32z$2=rfc4648$3({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),base32$7=Object.freeze(Object.defineProperty({__proto__:null,base32:base32$6,base32hex:base32hex$2,base32hexpad:base32hexpad$2,base32hexpadupper:base32hexpadupper$2,base32hexupper:base32hexupper$2,base32pad:base32pad$2,base32padupper:base32padupper$2,base32upper:base32upper$2,base32z:base32z$2},Symbol.toStringTag,{value:"Module"})),base36$4=baseX$3({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),base36upper$2=baseX$3({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),base36$5=Object.freeze(Object.defineProperty({__proto__:null,base36:base36$4,base36upper:base36upper$2},Symbol.toStringTag,{value:"Module"})),base58btc$3=baseX$3({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),base58flickr$2=baseX$3({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),base58$2=Object.freeze(Object.defineProperty({__proto__:null,base58btc:base58btc$3,base58flickr:base58flickr$2},Symbol.toStringTag,{value:"Module"})),base64$6=rfc4648$3({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),base64pad$2=rfc4648$3({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),base64url$3=rfc4648$3({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),base64urlpad$2=rfc4648$3({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),base64$7=Object.freeze(Object.defineProperty({__proto__:null,base64:base64$6,base64pad:base64pad$2,base64url:base64url$3,base64urlpad:base64urlpad$2},Symbol.toStringTag,{value:"Module"})),base8$4=rfc4648$3({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),base8$5=Object.freeze(Object.defineProperty({__proto__:null,base8:base8$4},Symbol.toStringTag,{value:"Module"})),identity$2=from$4({prefix:"\0",name:"identity",encode:i=>toString$9(i),decode:i=>fromString$4(i)}),identityBase$2=Object.freeze(Object.defineProperty({__proto__:null,identity:identity$2},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const bases$2={...identityBase$2,...base2$5,...base8$5,...base10$5,...base16$5,...base32$7,...base36$5,...base58$2,...base64$7,...base256emoji$5};function allocUnsafe$2(i=0){return new Uint8Array(i)}function createCodec$2(i,e,a,c){return{name:i,prefix:e,encoder:{name:i,prefix:e,encode:a},decoder:{decode:c}}}const string$4=createCodec$2("utf8","u",i=>"u"+new TextDecoder("utf8").decode(i),i=>new TextEncoder().encode(i.substring(1))),ascii$2=createCodec$2("ascii","a",i=>{let e="a";for(let a=0;a<i.length;a++)e+=String.fromCharCode(i[a]);return e},i=>{i=i.substring(1);const e=allocUnsafe$2(i.length);for(let a=0;a<i.length;a++)e[a]=i.charCodeAt(a);return e}),BASES$2={utf8:string$4,"utf-8":string$4,hex:bases$2.base16,latin1:ascii$2,ascii:ascii$2,binary:ascii$2,...bases$2};function fromString$3(i,e="utf8"){const a=BASES$2[e];if(a==null)throw new Error(`Unsupported encoding "${e}"`);return a.decoder.decode(`${a.prefix}${i}`)}function isArrayBuffer(i){var e;return i instanceof ArrayBuffer||((e=i==null?void 0:i.constructor)==null?void 0:e.name)==="ArrayBuffer"&&typeof(i==null?void 0:i.byteLength)=="number"}const source=i=>{i.binaryType="arraybuffer";const e=async()=>{await new Promise((d,et)=>{if(c){d();return}if(h!=null){et(h);return}const ft=wt=>{i.removeEventListener("open",gt),i.removeEventListener("error",_t),wt()},gt=()=>{ft(d)},_t=wt=>{ft(()=>{et(wt.error??new Error(`connect ECONNREFUSED ${i.url}`))})};i.addEventListener("open",gt),i.addEventListener("error",_t)})},a=async function*(){const d=new EventIterator(({push:et,stop:ft,fail:gt})=>{const _t=$t=>{let It=null;typeof $t.data=="string"&&(It=fromString$3($t.data)),isArrayBuffer($t.data)&&(It=new Uint8Array($t.data)),$t.data instanceof Uint8Array&&(It=$t.data),It!=null&&et(It)},wt=$t=>{gt($t.error??new Error("Socket error"))};return i.addEventListener("message",_t),i.addEventListener("error",wt),i.addEventListener("close",ft),()=>{i.removeEventListener("message",_t),i.removeEventListener("error",wt),i.removeEventListener("close",ft)}},{highWaterMark:1/0});await e();for await(const et of d)yield isArrayBuffer(et)?new Uint8Array(et):et}();let c=i.readyState===1,h;return i.addEventListener("open",()=>{c=!0,h=null}),i.addEventListener("close",()=>{c=!1,h=null}),i.addEventListener("error",d=>{c||(h=d.error??new Error(`connect ECONNREFUSED ${i.url}`))}),Object.assign(a,{connected:e})},duplex=(i,e)=>{e=e??{};const a=source(i);let c=e.remoteAddress,h=e.remotePort;if(i.url!=null)try{const et=new URL(i.url);c=et.hostname,h=parseInt(et.port,10)}catch{}if(c==null||h==null)throw new Error("Remote connection did not have address and/or port");return{sink:sink(i,e),source:a,connected:async()=>{await a.connected()},close:async()=>{(i.readyState===i.CONNECTING||i.readyState===i.OPEN)&&await new Promise(et=>{i.addEventListener("close",()=>{et()}),i.close()})},destroy:()=>{i.terminate!=null?i.terminate():i.close()},remoteAddress:c,remotePort:h,socket:i}},WebSocket$1=WebSocket,map$2={"http:":"ws:","https:":"wss:"},defaultProtocol="ws:",wsurl=(i,e)=>{if(i.startsWith("//")&&(i=`${(e==null?void 0:e.protocol)??defaultProtocol}${i}`),i.startsWith("/")&&e!=null){const c=e.protocol??defaultProtocol,h=e.host,d=e.port!=null&&(h==null?void 0:h.endsWith(`:${e.port}`))!==!0?`:${e.port}`:"";i=`${c}//${h}${d}${i}`}const a=new URL(i);for(const[c,h]of Object.entries(map$2))a.protocol===c&&(a.protocol=h);return a};function connect(i,e){const a=typeof window>"u"?void 0:window.location;e=e??{};const c=wsurl(i,a),h=new WebSocket$1(c.toString(),e.websocket);return duplex(h,e)}function isElectron$1(){return!!(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron||typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent.indexOf("Electron")>=0)}var isElectron_1=isElectron$1;const detectElectron=getDefaultExportFromCjs(isElectron_1),isEnvWithDom=typeof window=="object"&&typeof document=="object"&&document.nodeType===9,isElectron=detectElectron(),isBrowser=isEnvWithDom&&!isElectron,isElectronMain=isElectron&&!isEnvWithDom,isElectronRenderer=isElectron&&isEnvWithDom,isNode=typeof globalThis.process<"u"&&typeof globalThis.process.release<"u"&&globalThis.process.release.name==="node"&&!isElectron,isWebWorker=typeof importScripts=="function"&&typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,isReactNative$1=typeof navigator<"u"&&navigator.product==="ReactNative",DNS4=base$3("dns4"),DNS6=base$3("dns6"),DNSADDR=base$3("dnsaddr"),DNS$1=or$4(base$3("dns"),DNSADDR,DNS4,DNS6),IP=or$4(base$3("ip4"),base$3("ip6")),TCP=or$4(and$1(IP,base$3("tcp")),and$1(DNS$1,base$3("tcp"))),_WebSockets$1=or$4(and$1(TCP,base$3("ws")),and$1(DNS$1,base$3("ws"))),WebSockets$1=or$4(and$1(_WebSockets$1,base$3("p2p")),_WebSockets$1),_WebSocketsSecure$1=or$4(and$1(TCP,base$3("wss")),and$1(DNS$1,base$3("wss")),and$1(TCP,base$3("tls"),base$3("ws")),and$1(DNS$1,base$3("tls"),base$3("ws"))),WebSocketsSecure=or$4(and$1(_WebSocketsSecure$1,base$3("p2p")),_WebSocketsSecure$1);function makeMatchesFunction(i){function e(a){let c;try{c=multiaddr(a)}catch{return!1}const h=i(c.protoNames());return h===null?!1:h===!0||h===!1?h:h.length===0}return e}function and$1(...i){function e(a){if(a.length<i.length)return null;let c=a;return i.some(h=>(c=typeof h=="function"?h().partialMatch(a):h.partialMatch(a),Array.isArray(c)&&(a=c),c===null)),c}return{toString:function(){return"{ "+i.join(" ")+" }"},input:i,matches:makeMatchesFunction(e),partialMatch:e}}function or$4(...i){function e(c){let h=null;return i.some(d=>{const et=typeof d=="function"?d().partialMatch(c):d.partialMatch(c);return et!=null?(h=et,!0):!1}),h}return{toString:function(){return"{ "+i.join(" ")+" }"},input:i,matches:makeMatchesFunction(e),partialMatch:e}}function base$3(i){const e=i;function a(h){let d;try{d=multiaddr(h)}catch{return!1}const et=d.protoNames();return et.length===1&&et[0]===e}function c(h){return h.length===0?null:h[0]===e?h.slice(1):null}return{toString:function(){return e},matches:a,partialMatch:c}}const CODE_P2P=421,CODE_CIRCUIT=290,CLOSE_TIMEOUT$1=500;function all(i){return i.filter(e=>{if(e.protoCodes().includes(CODE_CIRCUIT))return!1;const a=e.decapsulateCode(CODE_P2P);return WebSockets$1.matches(a)||WebSocketsSecure.matches(a)})}function wss(i){return i.filter(e=>{if(e.protoCodes().includes(CODE_CIRCUIT))return!1;const a=e.decapsulateCode(CODE_P2P);return WebSocketsSecure.matches(a)})}function createListener(){throw new Error("WebSocket Servers can not be created in the browser!")}const log$m=logger$2("libp2p:websockets:socket");function socketToMaConn(i,e,a){a=a??{};const c={async sink(h){(a==null?void 0:a.signal)!=null&&(h=abortableSource(h,a.signal));try{await i.sink(h)}catch(d){d.type!=="aborted"&&log$m.error(d)}},source:a.signal!=null?abortableSource(i.source,a.signal):i.source,remoteAddr:e,timeline:{open:Date.now()},async close(h={}){var ft,gt;const d=Date.now();if(h.signal==null){const _t=AbortSignal.timeout(CLOSE_TIMEOUT$1);h={...h,signal:_t}}const et=()=>{const{host:_t,port:wt}=c.remoteAddr.toOptions();log$m("timeout closing stream to %s:%s after %dms, destroying it manually",_t,wt,Date.now()-d),this.abort(new CodeError$2("Socket close timeout","ERR_SOCKET_CLOSE_TIMEOUT"))};(ft=h.signal)==null||ft.addEventListener("abort",et);try{await i.close()}catch(_t){log$m.error("error closing WebSocket gracefully",_t),this.abort(_t)}finally{(gt=h.signal)==null||gt.removeEventListener("abort",et),c.timeline.close=Date.now()}},abort(h){const{host:d,port:et}=c.remoteAddr.toOptions();log$m("timeout closing stream to %s:%s due to error",d,et,h),i.destroy(),c.timeline.close=Date.now()}};return i.socket.addEventListener("close",()=>{c.timeline.close==null&&(c.timeline.close=Date.now())},{once:!0}),c}const log$l=logger$2("libp2p:websockets");var xp,Pp;class WebSockets{constructor(e){qt(this,"init");qt(this,xp,"@libp2p/websockets");qt(this,Pp,!0);this.init=e}async dial(e,a){log$l("dialing %s",e),a=a??{};const c=await this._connect(e,a),h=socketToMaConn(c,e);log$l("new outbound connection %s",h.remoteAddr);const d=await a.upgrader.upgradeOutbound(h);return log$l("outbound connection %s upgraded",h.remoteAddr),d}async _connect(e,a){var gt,_t;if(((gt=a==null?void 0:a.signal)==null?void 0:gt.aborted)===!0)throw new AbortError$8;const c=e.toOptions();log$l("dialing %s:%s",c.host,c.port);const h=pDefer(),d=connect(multiaddrToUri(e),this.init);if(d.socket.addEventListener("error",()=>{const wt=new CodeError$2(`Could not connect to ${e.toString()}`,"ERR_CONNECTION_FAILED");log$l.error("connection error:",wt),h.reject(wt)}),a.signal==null)return await Promise.race([d.connected(),h.promise]),log$l("connected %s",e),d;let et;const ft=new Promise((wt,$t)=>{var It,Rt;if(et=()=>{$t(new AbortError$8),d.close().catch(Tt=>{log$l.error("error closing raw socket",Tt)})},((It=a==null?void 0:a.signal)==null?void 0:It.aborted)===!0){et();return}(Rt=a==null?void 0:a.signal)==null||Rt.addEventListener("abort",et)});try{await Promise.race([ft,h.promise,d.connected()])}finally{et!=null&&((_t=a==null?void 0:a.signal)==null||_t.removeEventListener("abort",et))}return log$l("connected %s",e),d}createListener(e){return createListener({...this.init,...e})}filter(e){var a,c;return e=Array.isArray(e)?e:[e],((a=this.init)==null?void 0:a.filter)!=null?(c=this.init)==null?void 0:c.filter(e):isBrowser||isWebWorker?wss(e):all(e)}}xp=Symbol.toStringTag,Pp=symbol$1;function webSockets(i={}){return()=>new WebSockets(i)}function setMaxListeners$1(){}var hs;class TypedEventEmitter extends EventTarget{constructor(){super(...arguments);gn(this,hs,new Map)}listenerCount(a){const c=ur(this,hs).get(a);return c==null?0:c.length}addEventListener(a,c,h){super.addEventListener(a,c,h);let d=ur(this,hs).get(a);d==null&&(d=[],ur(this,hs).set(a,d)),d.push({callback:c,once:(h!==!0&&h!==!1&&(h==null?void 0:h.once))??!1})}removeEventListener(a,c,h){super.removeEventListener(a.toString(),c??null,h);let d=ur(this,hs).get(a);d!=null&&(d=d.filter(({callback:et})=>et!==c),ur(this,hs).set(a,d))}dispatchEvent(a){const c=super.dispatchEvent(a);let h=ur(this,hs).get(a.type);return h==null||(h=h.filter(({once:d})=>!d),ur(this,hs).set(a.type,h)),c}safeDispatchEvent(a,c){return this.dispatchEvent(new CustomEvent(a,c))}}hs=new WeakMap;class CustomEventPolyfill extends Event{constructor(a,c){super(a,c);qt(this,"detail");this.detail=c==null?void 0:c.detail}}const CustomEvent=globalThis.CustomEvent??CustomEventPolyfill,setMaxListeners=(i,...e)=>{try{[...e]}catch{}},peerDiscovery=Symbol.for("@libp2p/peer-discovery"),enrTree={TEST:"enrtree://AO47IDOLBKH72HIZZOXQP6NMRESAN7CHYWIBNXDXWRJRZWLODKII6@test.wakuv2.nodes.status.im",PROD:"enrtree://ANEDLO25QVUGJOUTQFRYKWX6P4Z4GKVESBMHML7DZ6YK4LGS5FC5O@prod.wakuv2.nodes.status.im"},DEFAULT_BOOTSTRAP_TAG_NAME="bootstrap",DEFAULT_BOOTSTRAP_TAG_VALUE=50,DEFAULT_BOOTSTRAP_TAG_TTL=1e8,DEFAULT_NODE_REQUIREMENTS$1={store:2,filter:1,lightPush:1},v4Regex$1=/^(\d{1,3}\.){3,3}\d{1,3}$/,v4Size=4,v6Regex$1=/^(::)?(((\d{1,3}\.){3}(\d{1,3}){1})?([0-9a-f]){0,4}:{0,2}){1,8}(::)?$/i,v6Size=16,v4$1={name:"v4",size:v4Size,isFormat:i=>v4Regex$1.test(i),encode(i,e,a){a=~~a,e=e||new Uint8Array(a+v4Size);const c=i.length;let h=0;for(let d=0;d<c;){const et=i.charCodeAt(d++);et===46?(e[a++]=h,h=0):h=h*10+(et-48)}return e[a]=h,e},decode(i,e){return e=~~e,`${i[e++]}.${i[e++]}.${i[e++]}.${i[e]}`}},v6$1={name:"v6",size:v6Size,isFormat:i=>i.length>0&&v6Regex$1.test(i),encode(i,e,a){a=~~a;let c=a+v6Size,h=-1,d=0,et=0,ft=!0,gt=!1;e=e||new Uint8Array(a+v6Size);for(let _t=0;_t<i.length;_t++){let wt=i.charCodeAt(_t);wt===58?(ft?h!==-1?(a<c&&(e[a]=0),a<c-1&&(e[a+1]=0),a+=2):a<c&&(h=a):(gt===!0?(a<c&&(e[a]=et),a++):(a<c&&(e[a]=d>>8),a<c-1&&(e[a+1]=d&255),a+=2),d=0,et=0),ft=!0,gt=!1):wt===46?(a<c&&(e[a]=et),a++,et=0,d=0,ft=!1,gt=!0):(ft=!1,wt>=97?wt-=87:wt>=65?wt-=55:(wt-=48,et=et*10+wt),d=(d<<4)+wt)}if(ft===!1)gt===!0?(a<c&&(e[a]=et),a++):(a<c&&(e[a]=d>>8),a<c-1&&(e[a+1]=d&255),a+=2);else if(h===0)a<c&&(e[a]=0),a<c-1&&(e[a+1]=0),a+=2;else if(h!==-1){a+=2;for(let _t=Math.min(a-1,c-1);_t>=h+2;_t--)e[_t]=e[_t-2];e[h]=0,e[h+1]=0,h=a}if(h!==a&&h!==-1)for(a>c-2&&(a=c-2);c>h;)e[--c]=a<c&&a>h?e[--a]:0;else for(;a<c;)e[a++]=0;return e},decode(i,e){e=~~e;let a="";for(let c=0;c<v6Size;c+=2)c!==0&&(a+=":"),a+=(i[e+c]<<8|i[e+c+1]).toString(16);return a.replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}};function sizeOf(i){if(v4$1.isFormat(i))return v4$1.size;if(v6$1.isFormat(i))return v6$1.size;throw Error(`Invalid ip address: ${i}`)}function familyOf(i){return sizeOf(i)===v4$1.size?1:2}function encode$8(i,e,a){a=~~a;const c=sizeOf(i);return typeof e=="function"&&(e=e(a+c)),c===v4$1.size?v4$1.encode(i,e,a):v6$1.encode(i,e,a)}function decode$8(i,e,a){if(e=~~e,a=a||i.length-e,a===v4$1.size)return v4$1.decode(i,e,a);if(a===v6$1.size)return v6$1.decode(i,e,a);throw Error(`Invalid buffer size needs to be ${v4$1.size} for v4 or ${v6$1.size} for v6.`)}function toString$8(i){switch(i){case 1:return"A";case 10:return"NULL";case 28:return"AAAA";case 18:return"AFSDB";case 42:return"APL";case 257:return"CAA";case 60:return"CDNSKEY";case 59:return"CDS";case 37:return"CERT";case 5:return"CNAME";case 49:return"DHCID";case 32769:return"DLV";case 39:return"DNAME";case 48:return"DNSKEY";case 43:return"DS";case 55:return"HIP";case 13:return"HINFO";case 45:return"IPSECKEY";case 25:return"KEY";case 36:return"KX";case 29:return"LOC";case 15:return"MX";case 35:return"NAPTR";case 2:return"NS";case 47:return"NSEC";case 50:return"NSEC3";case 51:return"NSEC3PARAM";case 12:return"PTR";case 46:return"RRSIG";case 17:return"RP";case 24:return"SIG";case 6:return"SOA";case 99:return"SPF";case 33:return"SRV";case 44:return"SSHFP";case 32768:return"TA";case 249:return"TKEY";case 52:return"TLSA";case 250:return"TSIG";case 16:return"TXT";case 252:return"AXFR";case 251:return"IXFR";case 41:return"OPT";case 255:return"ANY"}return"UNKNOWN_"+i}function toType(i){switch(i.toUpperCase()){case"A":return 1;case"NULL":return 10;case"AAAA":return 28;case"AFSDB":return 18;case"APL":return 42;case"CAA":return 257;case"CDNSKEY":return 60;case"CDS":return 59;case"CERT":return 37;case"CNAME":return 5;case"DHCID":return 49;case"DLV":return 32769;case"DNAME":return 39;case"DNSKEY":return 48;case"DS":return 43;case"HIP":return 55;case"HINFO":return 13;case"IPSECKEY":return 45;case"KEY":return 25;case"KX":return 36;case"LOC":return 29;case"MX":return 15;case"NAPTR":return 35;case"NS":return 2;case"NSEC":return 47;case"NSEC3":return 50;case"NSEC3PARAM":return 51;case"PTR":return 12;case"RRSIG":return 46;case"RP":return 17;case"SIG":return 24;case"SOA":return 6;case"SPF":return 99;case"SRV":return 33;case"SSHFP":return 44;case"TA":return 32768;case"TKEY":return 249;case"TLSA":return 52;case"TSIG":return 250;case"TXT":return 16;case"AXFR":return 252;case"IXFR":return 251;case"OPT":return 41;case"ANY":return 255;case"*":return 255}return i.toUpperCase().startsWith("UNKNOWN_")?parseInt(i.slice(8)):0}function toString$7(i){switch(i){case 0:return"NOERROR";case 1:return"FORMERR";case 2:return"SERVFAIL";case 3:return"NXDOMAIN";case 4:return"NOTIMP";case 5:return"REFUSED";case 6:return"YXDOMAIN";case 7:return"YXRRSET";case 8:return"NXRRSET";case 9:return"NOTAUTH";case 10:return"NOTZONE";case 11:return"RCODE_11";case 12:return"RCODE_12";case 13:return"RCODE_13";case 14:return"RCODE_14";case 15:return"RCODE_15"}return"RCODE_"+i}function toString$6(i){switch(i){case 0:return"QUERY";case 1:return"IQUERY";case 2:return"STATUS";case 3:return"OPCODE_3";case 4:return"NOTIFY";case 5:return"UPDATE";case 6:return"OPCODE_6";case 7:return"OPCODE_7";case 8:return"OPCODE_8";case 9:return"OPCODE_9";case 10:return"OPCODE_10";case 11:return"OPCODE_11";case 12:return"OPCODE_12";case 13:return"OPCODE_13";case 14:return"OPCODE_14";case 15:return"OPCODE_15"}return"OPCODE_"+i}function toString$5(i){switch(i){case 1:return"IN";case 2:return"CS";case 3:return"CH";case 4:return"HS";case 255:return"ANY"}return"UNKNOWN_"+i}function toClass(i){switch(i.toUpperCase()){case"IN":return 1;case"CS":return 2;case"CH":return 3;case"HS":return 4;case"ANY":return 255}return 0}function toString$4(i){switch(i){case 1:return"LLQ";case 2:return"UL";case 3:return"NSID";case 5:return"DAU";case 6:return"DHU";case 7:return"N3U";case 8:return"CLIENT_SUBNET";case 9:return"EXPIRE";case 10:return"COOKIE";case 11:return"TCP_KEEPALIVE";case 12:return"PADDING";case 13:return"CHAIN";case 14:return"KEY_TAG";case 26946:return"DEVICEID"}return i<0?null:`OPTION_${i}`}function toCode(i){if(typeof i=="number")return i;if(!i)return-1;switch(i.toUpperCase()){case"OPTION_0":return 0;case"LLQ":return 1;case"UL":return 2;case"NSID":return 3;case"OPTION_4":return 4;case"DAU":return 5;case"DHU":return 6;case"N3U":return 7;case"CLIENT_SUBNET":return 8;case"EXPIRE":return 9;case"COOKIE":return 10;case"TCP_KEEPALIVE":return 11;case"PADDING":return 12;case"CHAIN":return 13;case"KEY_TAG":return 14;case"DEVICEID":return 26946;case"OPTION_65535":return 65535}const e=i.match(/_(\d+)$/);return e?parseInt(e[1],10):-1}const SURROGATE_A=55296,SURROGATE_B=56320;function encodingLength$1(i){let e=0;const a=i.length;for(let c=0;c<a;c+=1){const h=i.charCodeAt(c);if(h<=127)e+=1;else if(h<=2047)e+=2;else if((h&63488)!==SURROGATE_A)e+=3;else{const d=c+1;d===a||h>=SURROGATE_B||(i.charCodeAt(d)&64512)!==SURROGATE_B?e+=3:(c=d,e+=4)}}return e}function encode$7(i,e,a){const c=i.length;a==null&&(a=0),e===void 0&&(e=new Uint8Array(encodingLength$1(i)+a));let h=a;for(let d=0;d<c;d+=1){let et=i.charCodeAt(d);if(et<=127)e[h++]=et;else if(et<=2047)e[h++]=192|(et&1984)>>6,e[h++]=128|et&63;else if((et&63488)!==SURROGATE_A)e[h++]=224|(et&61440)>>12,e[h++]=128|(et&4032)>>6,e[h++]=128|et&63;else{const ft=d+1;if(ft===c||et>=SURROGATE_B)e[h++]=239,e[h++]=191,e[h++]=189;else{const gt=i.charCodeAt(ft);(gt&64512)!==SURROGATE_B?(e[h++]=239,e[h++]=191,e[h++]=189):(d=ft,et=65536|(et&1023)<<10|gt&1023,e[h++]=240|(et&1835008)>>18,e[h++]=128|(et&258048)>>12,e[h++]=128|(et&4032)>>6,e[h++]=128|et&63)}}}return encode$7.bytes=h-a,e}encode$7.bytes=0;function decode$7(i,e,a){let c="";e==null&&(e=0),a==null&&(a=i.length);for(let h=e;h<a;){const d=i[h++];let et;if(d<=128)et=d;else if(d>191&&d<224)et=(d&31)<<6|i[h++]&63;else if(d>239&&d<365){et=((d&7)<<18|(i[h++]&63)<<12|(i[h++]&63)<<6|i[h++]&63)-65536;const ft=SURROGATE_A|et>>10&1023;c+=String.fromCharCode(ft),et=SURROGATE_B|et&1023}else et=(d&15)<<12|(i[h++]&63)<<6|i[h++]&63;c+=String.fromCharCode(et)}return decode$7.bytes=a-e,c}decode$7.bytes=0;const isU8Arr=i=>i instanceof Uint8Array;function bytelength(i){return typeof i=="string"?encodingLength$1(i):i.byteLength}function from$3(i){return i instanceof Uint8Array?i:Array.isArray(i)?new Uint8Array(i):encode$7(i)}function write$1(i,e,a){if(typeof e!="string")throw new Error("unknown input type");return encode$7(e,i,a),encode$7.bytes}const P_24=Math.pow(2,24),P_16=Math.pow(2,16),P_8=Math.pow(2,8),readUInt32BE=(i,e)=>i[e]*P_24+i[e+1]*P_16+i[e+2]*P_8+i[e+3],readUInt16BE=(i,e)=>i[e]<<8|i[e+1],writeUInt32BE=(i,e,a)=>(e=+e,i[a+3]=e,e=e>>>8,i[a+2]=e,e=e>>>8,i[a+1]=e,e=e>>>8,i[a]=e,a+4),writeUInt16BE=(i,e,a)=>(i[a]=e>>8,i[a+1]=e&255,a+2);function copy(i,e,a,c,h){return a<0&&(c-=a,a=0),c<0&&(c=0),h<0?new Uint8Array(0):a>=e.length||c>=h?0:_copyActual(i,e,a,c,h)}function _copyActual(i,e,a,c,h){h-c>e.length-a&&(h=c+e.length-a);let d=h-c;const et=i.length-c;return d>et&&(d=et),(c!==0||h<i.length)&&(i=new Uint8Array(i.buffer,i.byteOffset+c,d)),e.set(i,a),d}const QUERY_FLAG=0,RESPONSE_FLAG=32768,FLUSH_MASK=32768,NOT_FLUSH_MASK=~FLUSH_MASK,QU_MASK=32768,NOT_QU_MASK=~QU_MASK;function codec({bytes:i=0,encode:e,decode:a,encodingLength:c}){return e.bytes=i,a.bytes=i,{encode:e,decode:a,encodingLength:c||(()=>i)}}const name$q=codec({encode(i,e,a){e||(e=new Uint8Array(name$q.encodingLength(i))),a||(a=0);const c=a,h=i.replace(/^\.|\.$/gm,"");if(h.length){const d=h.split(".");for(let et=0;et<d.length;et++){const ft=write$1(e,d[et],a+1);e[a]=ft,a+=ft+1}}return e[a++]=0,name$q.encode.bytes=a-c,e},decode(i,e){e||(e=0);const a=[];let c=e,h=0,d=0,et=!1;for(;;){if(e>=i.length)throw new Error("Cannot decode name (buffer overflow)");const ft=i[e++];if(d+=et?0:1,ft===0)break;if(ft&192)if((ft&192)===192){if(e+1>i.length)throw new Error("Cannot decode name (buffer overflow)");const gt=readUInt16BE(i,e-1)-49152;if(gt>=c)throw new Error("Cannot decode name (bad pointer)");e=gt,c=gt,d+=et?0:1,et=!0}else throw new Error("Cannot decode name (bad label)");else{if(e+ft>i.length)throw new Error("Cannot decode name (buffer overflow)");if(h+=ft+1,h>254)throw new Error("Cannot decode name (name too long)");a.push(decode$7(i,e,e+ft)),e+=ft,d+=et?0:ft}}return name$q.decode.bytes=d,a.length===0?".":a.join(".")},encodingLength(i){return i==="."||i===".."?1:bytelength(i.replace(/^\.|\.$/gm,""))+2}}),string$3=codec({encode(i,e,a){e||(e=new Uint8Array(string$3.encodingLength(i))),a||(a=0);const c=write$1(e,i,a+1);return e[a]=c,string$3.encode.bytes=c+1,e},decode(i,e){e||(e=0);const a=i[e],c=decode$7(i,e+1,e+1+a);return string$3.decode.bytes=a+1,c},encodingLength(i){return bytelength(i)+1}}),header=codec({bytes:12,encode(i,e,a){e||(e=new Uint8Array(header.encodingLength(i))),a||(a=0);const c=(i.flags||0)&32767,h=i.type==="response"?RESPONSE_FLAG:QUERY_FLAG;return writeUInt16BE(e,i.id||0,a),writeUInt16BE(e,c|h,a+2),writeUInt16BE(e,i.questions.length,a+4),writeUInt16BE(e,i.answers.length,a+6),writeUInt16BE(e,i.authorities.length,a+8),writeUInt16BE(e,i.additionals.length,a+10),e},decode(i,e){if(e||(e=0),i.length<12)throw new Error("Header must be 12 bytes");const a=readUInt16BE(i,e+2);return{id:readUInt16BE(i,e),type:a&RESPONSE_FLAG?"response":"query",flags:a&32767,flag_qr:(a>>15&1)===1,opcode:toString$6(a>>11&15),flag_aa:(a>>10&1)===1,flag_tc:(a>>9&1)===1,flag_rd:(a>>8&1)===1,flag_ra:(a>>7&1)===1,flag_z:(a>>6&1)===1,flag_ad:(a>>5&1)===1,flag_cd:(a>>4&1)===1,rcode:toString$7(a&15),questions:new Array(readUInt16BE(i,e+4)),answers:new Array(readUInt16BE(i,e+6)),authorities:new Array(readUInt16BE(i,e+8)),additionals:new Array(readUInt16BE(i,e+10))}},encodingLength(){return 12}}),runknown=codec({encode(i,e,a){e||(e=new Uint8Array(runknown.encodingLength(i))),a||(a=0);const c=i.length;return writeUInt16BE(e,c,a),copy(i,e,a+2,0,c),runknown.encode.bytes=c+2,e},decode(i,e){e||(e=0);const a=readUInt16BE(i,e),c=i.slice(e+2,e+2+a);return runknown.decode.bytes=a+2,c},encodingLength(i){return i.length+2}}),rns=codec({encode(i,e,a){return e||(e=new Uint8Array(rns.encodingLength(i))),a||(a=0),name$q.encode(i,e,a+2),writeUInt16BE(e,name$q.encode.bytes,a),rns.encode.bytes=name$q.encode.bytes+2,e},decode(i,e){e||(e=0);const a=readUInt16BE(i,e),c=name$q.decode(i,e+2);return rns.decode.bytes=a+2,c},encodingLength(i){return name$q.encodingLength(i)+2}}),rsoa=codec({encode(i,e,a){e||(e=new Uint8Array(rsoa.encodingLength(i))),a||(a=0);const c=a;return a+=2,name$q.encode(i.mname,e,a),a+=name$q.encode.bytes,name$q.encode(i.rname,e,a),a+=name$q.encode.bytes,writeUInt32BE(e,i.serial||0,a),a+=4,writeUInt32BE(e,i.refresh||0,a),a+=4,writeUInt32BE(e,i.retry||0,a),a+=4,writeUInt32BE(e,i.expire||0,a),a+=4,writeUInt32BE(e,i.minimum||0,a),a+=4,writeUInt16BE(e,a-c-2,c),rsoa.encode.bytes=a-c,e},decode(i,e){e||(e=0);const a=e,c={};return e+=2,c.mname=name$q.decode(i,e),e+=name$q.decode.bytes,c.rname=name$q.decode(i,e),e+=name$q.decode.bytes,c.serial=readUInt32BE(i,e),e+=4,c.refresh=readUInt32BE(i,e),e+=4,c.retry=readUInt32BE(i,e),e+=4,c.expire=readUInt32BE(i,e),e+=4,c.minimum=readUInt32BE(i,e),e+=4,rsoa.decode.bytes=e-a,c},encodingLength(i){return 22+name$q.encodingLength(i.mname)+name$q.encodingLength(i.rname)}}),rtxt=codec({encode(i,e,a){Array.isArray(i)||(i=[i]);for(let h=0;h<i.length;h++)if(typeof i[h]=="string"&&(i[h]=from$3(i[h])),!isU8Arr(i[h]))throw new Error("Must be a Buffer");e||(e=new Uint8Array(rtxt.encodingLength(i))),a||(a=0);const c=a;return a+=2,i.forEach(function(h){e[a++]=h.length,copy(h,e,a,0,h.length),a+=h.length}),writeUInt16BE(e,a-c-2,c),rtxt.encode.bytes=a-c,e},decode(i,e){e||(e=0);const a=e;let c=readUInt16BE(i,e);e+=2;const h=[];for(;c>0;){const d=i[e++];if(--c,c<d)throw new Error("Buffer overflow");h.push(i.slice(e,e+d)),e+=d,c-=d}return rtxt.decode.bytes=e-a,h},encodingLength(i){Array.isArray(i)||(i=[i]);let e=2;return i.forEach(function(a){typeof a=="string"?e+=bytelength(a)+1:e+=a.length+1}),e}}),rnull=codec({encode(i,e,a){e||(e=new Uint8Array(rnull.encodingLength(i))),a||(a=0),typeof i=="string"&&(i=from$3(i)),i||(i=new Uint8Array(0));const c=a;a+=2;const h=i.length;return copy(i,e,a,0,h),a+=h,writeUInt16BE(e,a-c-2,c),rnull.encode.bytes=a-c,e},decode(i,e){e||(e=0);const a=e,c=readUInt16BE(i,e);e+=2;const h=i.slice(e,e+c);return e+=c,rnull.decode.bytes=e-a,h},encodingLength(i){return i?(isU8Arr(i)?i.length:bytelength(i))+2:2}}),rhinfo=codec({encode(i,e,a){e||(e=new Uint8Array(rhinfo.encodingLength(i))),a||(a=0);const c=a;return a+=2,string$3.encode(i.cpu,e,a),a+=string$3.encode.bytes,string$3.encode(i.os,e,a),a+=string$3.encode.bytes,writeUInt16BE(e,a-c-2,c),rhinfo.encode.bytes=a-c,e},decode(i,e){e||(e=0);const a=e,c={};return e+=2,c.cpu=string$3.decode(i,e),e+=string$3.decode.bytes,c.os=string$3.decode(i,e),e+=string$3.decode.bytes,rhinfo.decode.bytes=e-a,c},encodingLength(i){return string$3.encodingLength(i.cpu)+string$3.encodingLength(i.os)+2}}),rptr=codec({encode(i,e,a){return e||(e=new Uint8Array(rptr.encodingLength(i))),a||(a=0),name$q.encode(i,e,a+2),writeUInt16BE(e,name$q.encode.bytes,a),rptr.encode.bytes=name$q.encode.bytes+2,e},decode(i,e){e||(e=0);const a=name$q.decode(i,e+2);return rptr.decode.bytes=name$q.decode.bytes+2,a},encodingLength(i){return name$q.encodingLength(i)+2}}),rsrv=codec({encode(i,e,a){e||(e=new Uint8Array(rsrv.encodingLength(i))),a||(a=0),writeUInt16BE(e,i.priority||0,a+2),writeUInt16BE(e,i.weight||0,a+4),writeUInt16BE(e,i.port||0,a+6),name$q.encode(i.target,e,a+8);const c=name$q.encode.bytes+6;return writeUInt16BE(e,c,a),rsrv.encode.bytes=c+2,e},decode(i,e){e||(e=0);const a=readUInt16BE(i,e),c={};return c.priority=readUInt16BE(i,e+2),c.weight=readUInt16BE(i,e+4),c.port=readUInt16BE(i,e+6),c.target=name$q.decode(i,e+8),rsrv.decode.bytes=a+2,c},encodingLength(i){return 8+name$q.encodingLength(i.target)}}),rcaa=codec({encode(i,e,a){const c=rcaa.encodingLength(i);return e||(e=new Uint8Array(rcaa.encodingLength(i))),a||(a=0),i.issuerCritical&&(i.flags=rcaa.ISSUER_CRITICAL),writeUInt16BE(e,c-2,a),a+=2,e[a]=i.flags||0,a+=1,string$3.encode(i.tag,e,a),a+=string$3.encode.bytes,write$1(e,i.value,a),a+=bytelength(i.value),rcaa.encode.bytes=c,e},decode(i,e){e||(e=0);const a=readUInt16BE(i,e);e+=2;const c=e,h={};return h.flags=i[e],e+=1,h.tag=string$3.decode(i,e),e+=string$3.decode.bytes,h.value=decode$7(i,e,c+a),h.issuerCritical=!!(h.flags&rcaa.ISSUER_CRITICAL),rcaa.decode.bytes=a+2,h},encodingLength(i){return string$3.encodingLength(i.tag)+string$3.encodingLength(i.value)+2}});rcaa.ISSUER_CRITICAL=128;const rmx=codec({encode(i,e,a){e||(e=new Uint8Array(rmx.encodingLength(i))),a||(a=0);const c=a;return a+=2,writeUInt16BE(e,i.preference||0,a),a+=2,name$q.encode(i.exchange,e,a),a+=name$q.encode.bytes,writeUInt16BE(e,a-c-2,c),rmx.encode.bytes=a-c,e},decode(i,e){e||(e=0);const a=e,c={};return e+=2,c.preference=readUInt16BE(i,e),e+=2,c.exchange=name$q.decode(i,e),e+=name$q.decode.bytes,rmx.decode.bytes=e-a,c},encodingLength(i){return 4+name$q.encodingLength(i.exchange)}}),ra=codec({encode(i,e,a){return e||(e=new Uint8Array(ra.encodingLength(i))),a||(a=0),writeUInt16BE(e,4,a),a+=2,v4$1.encode(i,e,a),e},decode(i,e){return e||(e=0),e+=2,v4$1.decode(i,e)},bytes:6}),raaaa=codec({encode(i,e,a){return e||(e=new Uint8Array(raaaa.encodingLength(i))),a||(a=0),writeUInt16BE(e,16,a),a+=2,v6$1.encode(i,e,a),raaaa.encode.bytes=18,e},decode(i,e){e||(e=0),e+=2;const a=v6$1.decode(i,e);return raaaa.decode.bytes=18,a},bytes:18}),alloc=i=>new Uint8Array(i),roption=codec({encode(i,e,a){e||(e=new Uint8Array(roption.encodingLength(i))),a||(a=0);const c=a,h=toCode(i.code);if(writeUInt16BE(e,h,a),a+=2,i.data)writeUInt16BE(e,i.data.length,a),a+=2,copy(i.data,e,a),a+=i.data.length;else switch(h){case 8:{const d=i.sourcePrefixLength||0,et=i.family||familyOf(i.ip),ft=encode$8(i.ip,alloc),gt=Math.ceil(d/8);writeUInt16BE(e,gt+4,a),a+=2,writeUInt16BE(e,et,a),a+=2,e[a++]=d,e[a++]=i.scopePrefixLength||0,copy(ft,e,a,0,gt),a+=gt}break;case 11:i.timeout?(writeUInt16BE(e,2,a),a+=2,writeUInt16BE(e,i.timeout,a),a+=2):(writeUInt16BE(e,0,a),a+=2);break;case 12:{const d=i.length||0;writeUInt16BE(e,d,a),a+=2,e.fill(0,a,a+d),a+=d}break;case 14:{const d=i.tags.length*2;writeUInt16BE(e,d,a),a+=2;for(const et of i.tags)writeUInt16BE(e,et,a),a+=2}break;default:throw new Error(`Unknown roption code: ${i.code}`)}return roption.encode.bytes=a-c,e},decode(i,e){e||(e=0);const a={};a.code=readUInt16BE(i,e),a.type=toString$4(a.code),e+=2;const c=readUInt16BE(i,e);switch(e+=2,a.data=i.slice(e,e+c),a.code){case 8:a.family=readUInt16BE(i,e),e+=2,a.sourcePrefixLength=i[e++],a.scopePrefixLength=i[e++];{const h=new Uint8Array(a.family===1?4:16);copy(i,h,0,e,e+c-4),a.ip=decode$8(h)}break;case 11:c>0&&(a.timeout=readUInt16BE(i,e),e+=2);break;case 14:a.tags=[];for(let h=0;h<c;h+=2)a.tags.push(readUInt16BE(i,e)),e+=2}return roption.decode.bytes=c+4,a},encodingLength(i){if(i.data)return i.data.length+4;switch(toCode(i.code)){case 8:{const a=i.sourcePrefixLength||0;return Math.ceil(a/8)+8}case 11:return typeof i.timeout=="number"?6:4;case 12:return i.length+4;case 14:return 4+i.tags.length*2}throw new Error(`Unknown roption code: ${i.code}`)}}),ropt=codec({encode(i,e,a){e||(e=new Uint8Array(ropt.encodingLength(i))),a||(a=0);const c=a,h=encodingLengthList(i,roption);return writeUInt16BE(e,h,a),a=encodeList(i,roption,e,a+2),ropt.encode.bytes=a-c,e},decode(i,e){e||(e=0);const a=e,c=[];let h=readUInt16BE(i,e);e+=2;let d=0;for(;h>0;)c[d++]=roption.decode(i,e),e+=roption.decode.bytes,h-=roption.decode.bytes;return ropt.decode.bytes=e-a,c},encodingLength(i){return 2+encodingLengthList(i||[],roption)}}),rdnskey=codec({encode(i,e,a){e||(e=new Uint8Array(rdnskey.encodingLength(i))),a||(a=0);const c=a,h=i.key;if(!isU8Arr(h))throw new Error("Key must be a Buffer");return a+=2,writeUInt16BE(e,i.flags,a),a+=2,e[a]=rdnskey.PROTOCOL_DNSSEC,a+=1,e[a]=i.algorithm,a+=1,copy(h,e,a,0,h.length),a+=h.length,rdnskey.encode.bytes=a-c,writeUInt16BE(e,rdnskey.encode.bytes-2,c),e},decode(i,e){e||(e=0);const a=e,c={},h=readUInt16BE(i,e);if(e+=2,c.flags=readUInt16BE(i,e),e+=2,i[e]!==rdnskey.PROTOCOL_DNSSEC)throw new Error("Protocol must be 3");return e+=1,c.algorithm=i[e],e+=1,c.key=i.slice(e,a+h+2),e+=c.key.length,rdnskey.decode.bytes=e-a,c},encodingLength(i){return 6+bytelength(i.key)}});rdnskey.PROTOCOL_DNSSEC=3;rdnskey.ZONE_KEY=128;rdnskey.SECURE_ENTRYPOINT=32768;const rrrsig=codec({encode(i,e,a){e||(e=new Uint8Array(rrrsig.encodingLength(i))),a||(a=0);const c=a,h=i.signature;if(!isU8Arr(h))throw new Error("Signature must be a Buffer");return a+=2,writeUInt16BE(e,toType(i.typeCovered),a),a+=2,e[a]=i.algorithm,a+=1,e[a]=i.labels,a+=1,writeUInt32BE(e,i.originalTTL,a),a+=4,writeUInt32BE(e,i.expiration,a),a+=4,writeUInt32BE(e,i.inception,a),a+=4,writeUInt16BE(e,i.keyTag,a),a+=2,name$q.encode(i.signersName,e,a),a+=name$q.encode.bytes,copy(h,e,a,0,h.length),a+=h.length,rrrsig.encode.bytes=a-c,writeUInt16BE(e,rrrsig.encode.bytes-2,c),e},decode(i,e){e||(e=0);const a=e,c={},h=readUInt16BE(i,e);return e+=2,c.typeCovered=toString$8(readUInt16BE(i,e)),e+=2,c.algorithm=i[e],e+=1,c.labels=i[e],e+=1,c.originalTTL=readUInt32BE(i,e),e+=4,c.expiration=readUInt32BE(i,e),e+=4,c.inception=readUInt32BE(i,e),e+=4,c.keyTag=readUInt16BE(i,e),e+=2,c.signersName=name$q.decode(i,e),e+=name$q.decode.bytes,c.signature=i.slice(e,a+h+2),e+=c.signature.length,rrrsig.decode.bytes=e-a,c},encodingLength(i){return 20+name$q.encodingLength(i.signersName)+bytelength(i.signature)}}),rrp=codec({encode(i,e,a){e||(e=new Uint8Array(rrp.encodingLength(i))),a||(a=0);const c=a;return a+=2,name$q.encode(i.mbox||".",e,a),a+=name$q.encode.bytes,name$q.encode(i.txt||".",e,a),a+=name$q.encode.bytes,rrp.encode.bytes=a-c,writeUInt16BE(e,rrp.encode.bytes-2,c),e},decode(i,e){e||(e=0);const a=e,c={};return e+=2,c.mbox=name$q.decode(i,e)||".",e+=name$q.decode.bytes,c.txt=name$q.decode(i,e)||".",e+=name$q.decode.bytes,rrp.decode.bytes=e-a,c},encodingLength(i){return 2+name$q.encodingLength(i.mbox||".")+name$q.encodingLength(i.txt||".")}}),typebitmap=codec({encode(i,e,a){e||(e=new Uint8Array(typebitmap.encodingLength(i))),a||(a=0);const c=a,h=[];for(let d=0;d<i.length;d++){const et=toType(i[d]);h[et>>8]===void 0&&(h[et>>8]=[]),h[et>>8][et>>3&31]|=1<<7-(et&7)}for(let d=0;d<h.length;d++)if(h[d]!==void 0){const et=from$3(h[d]);e[a]=d,a+=1,e[a]=et.length,a+=1,copy(et,e,a,0,et.length),a+=et.length}return typebitmap.encode.bytes=a-c,e},decode(i,e,a){e||(e=0);const c=e,h=[];for(;e-c<a;){const d=i[e];e+=1;const et=i[e];e+=1;for(let ft=0;ft<et;ft++){const gt=i[e+ft];for(let _t=0;_t<8;_t++)if(gt&1<<7-_t){const wt=toString$8(d<<8|ft<<3|_t);h.push(wt)}}e+=et}return typebitmap.decode.bytes=e-c,h},encodingLength(i){const e=[];for(let c=0;c<i.length;c++){const h=toType(i[c]);e[h>>8]=Math.max(e[h>>8]||0,h&255)}let a=0;for(let c=0;c<e.length;c++)e[c]!==void 0&&(a+=2+Math.ceil((e[c]+1)/8));return a}}),rnsec=codec({encode(i,e,a){e||(e=new Uint8Array(rnsec.encodingLength(i))),a||(a=0);const c=a;return a+=2,name$q.encode(i.nextDomain,e,a),a+=name$q.encode.bytes,typebitmap.encode(i.rrtypes,e,a),a+=typebitmap.encode.bytes,rnsec.encode.bytes=a-c,writeUInt16BE(e,rnsec.encode.bytes-2,c),e},decode(i,e){e||(e=0);const a=e,c={},h=readUInt16BE(i,e);return e+=2,c.nextDomain=name$q.decode(i,e),e+=name$q.decode.bytes,c.rrtypes=typebitmap.decode(i,e,h-(e-a)),e+=typebitmap.decode.bytes,rnsec.decode.bytes=e-a,c},encodingLength(i){return 2+name$q.encodingLength(i.nextDomain)+typebitmap.encodingLength(i.rrtypes)}}),rnsec3=codec({encode(i,e,a){e||(e=new Uint8Array(rnsec3.encodingLength(i))),a||(a=0);const c=a,h=i.salt;if(!isU8Arr(h))throw new Error("salt must be a Buffer");const d=i.nextDomain;if(!isU8Arr(d))throw new Error("nextDomain must be a Buffer");return a+=2,e[a]=i.algorithm,a+=1,e[a]=i.flags,a+=1,writeUInt16BE(e,i.iterations,a),a+=2,e[a]=h.length,a+=1,copy(h,e,a,0,h.length),a+=h.length,e[a]=d.length,a+=1,copy(d,e,a,0,d.length),a+=d.length,typebitmap.encode(i.rrtypes,e,a),a+=typebitmap.encode.bytes,rnsec3.encode.bytes=a-c,writeUInt16BE(e,rnsec3.encode.bytes-2,c),e},decode(i,e){e||(e=0);const a=e,c={},h=readUInt16BE(i,e);e+=2,c.algorithm=i[e],e+=1,c.flags=i[e],e+=1,c.iterations=readUInt16BE(i,e),e+=2;const d=i[e];e+=1,c.salt=i.slice(e,e+d),e+=d;const et=i[e];return e+=1,c.nextDomain=i.slice(e,e+et),e+=et,c.rrtypes=typebitmap.decode(i,e,h-(e-a)),e+=typebitmap.decode.bytes,rnsec3.decode.bytes=e-a,c},encodingLength(i){return 8+i.salt.length+i.nextDomain.length+typebitmap.encodingLength(i.rrtypes)}}),rds=codec({encode(i,e,a){e||(e=new Uint8Array(rds.encodingLength(i))),a||(a=0);const c=a,h=i.digest;if(!isU8Arr(h))throw new Error("Digest must be a Buffer");return a+=2,writeUInt16BE(e,i.keyTag,a),a+=2,e[a]=i.algorithm,a+=1,e[a]=i.digestType,a+=1,copy(h,e,a,0,h.length),a+=h.length,rds.encode.bytes=a-c,writeUInt16BE(e,rds.encode.bytes-2,c),e},decode(i,e){e||(e=0);const a=e,c={},h=readUInt16BE(i,e);return e+=2,c.keyTag=readUInt16BE(i,e),e+=2,c.algorithm=i[e],e+=1,c.digestType=i[e],e+=1,c.digest=i.slice(e,a+h+2),e+=c.digest.length,rds.decode.bytes=e-a,c},encodingLength(i){return 6+bytelength(i.digest)}});function renc(i){switch(i.toUpperCase()){case"A":return ra;case"PTR":return rptr;case"CNAME":return rptr;case"DNAME":return rptr;case"TXT":return rtxt;case"NULL":return rnull;case"AAAA":return raaaa;case"SRV":return rsrv;case"HINFO":return rhinfo;case"CAA":return rcaa;case"NS":return rns;case"SOA":return rsoa;case"MX":return rmx;case"OPT":return ropt;case"DNSKEY":return rdnskey;case"RRSIG":return rrrsig;case"RP":return rrp;case"NSEC":return rnsec;case"NSEC3":return rnsec3;case"DS":return rds}return runknown}const answer=codec({encode(i,e,a){e||(e=new Uint8Array(answer.encodingLength(i))),a||(a=0);const c=a;if(name$q.encode(i.name,e,a),a+=name$q.encode.bytes,writeUInt16BE(e,toType(i.type),a),i.type.toUpperCase()==="OPT"){if(i.name!==".")throw new Error("OPT name must be root.");writeUInt16BE(e,i.udpPayloadSize||4096,a+2),e[a+4]=i.extendedRcode||0,e[a+5]=i.ednsVersion||0,writeUInt16BE(e,i.flags||0,a+6),a+=8,ropt.encode(i.options||[],e,a),a+=ropt.encode.bytes}else{let h=toClass(i.class===void 0?"IN":i.class);i.flush&&(h|=FLUSH_MASK),writeUInt16BE(e,h,a+2),writeUInt32BE(e,i.ttl||0,a+4),a+=8;const d=renc(i.type);d.encode(i.data,e,a),a+=d.encode.bytes}return answer.encode.bytes=a-c,e},decode(i,e){e||(e=0);const a={},c=e;if(a.name=name$q.decode(i,e),e+=name$q.decode.bytes,a.type=toString$8(readUInt16BE(i,e)),a.type==="OPT")a.udpPayloadSize=readUInt16BE(i,e+2),a.extendedRcode=i[e+4],a.ednsVersion=i[e+5],a.flags=readUInt16BE(i,e+6),a.flag_do=(a.flags>>15&1)===1,a.options=ropt.decode(i,e+8),e+=8+ropt.decode.bytes;else{const h=readUInt16BE(i,e+2);a.ttl=readUInt32BE(i,e+4),a.class=toString$5(h&NOT_FLUSH_MASK),a.flush=!!(h&FLUSH_MASK);const d=renc(a.type);a.data=d.decode(i,e+8),e+=8+d.decode.bytes}return answer.decode.bytes=e-c,a},encodingLength(i){const e=i.data!==null&&i.data!==void 0?i.data:i.options;return name$q.encodingLength(i.name)+8+renc(i.type).encodingLength(e)}}),question=codec({encode(i,e,a){e||(e=new Uint8Array(question.encodingLength(i))),a||(a=0);const c=a;return name$q.encode(i.name,e,a),a+=name$q.encode.bytes,writeUInt16BE(e,toType(i.type),a),a+=2,writeUInt16BE(e,toClass(i.class===void 0?"IN":i.class),a),a+=2,question.encode.bytes=a-c,i},decode(i,e){e||(e=0);const a=e,c={};return c.name=name$q.decode(i,e),e+=name$q.decode.bytes,c.type=toString$8(readUInt16BE(i,e)),e+=2,c.class=toString$5(readUInt16BE(i,e)),e+=2,!!(c.class&QU_MASK)&&(c.class&=NOT_QU_MASK),question.decode.bytes=e-a,c},encodingLength(i){return name$q.encodingLength(i.name)+4}}),RECURSION_DESIRED=256,packet={encode:function(i,e,a){const c=!e;c&&(e=new Uint8Array(encodingLength(i))),a||(a=0);const h=a;return i.questions||(i.questions=[]),i.answers||(i.answers=[]),i.authorities||(i.authorities=[]),i.additionals||(i.additionals=[]),header.encode(i,e,a),a+=header.encode.bytes,a=encodeList(i.questions,question,e,a),a=encodeList(i.answers,answer,e,a),a=encodeList(i.authorities,answer,e,a),a=encodeList(i.additionals,answer,e,a),packet.encode.bytes=a-h,c&&encode$6.bytes!==e.length?e.slice(0,encode$6.bytes):e},decode:function(i,e){e||(e=0);const a=e,c=header.decode(i,e);return e+=header.decode.bytes,e=decodeList(c.questions,question,i,e),e=decodeList(c.answers,answer,i,e),e=decodeList(c.authorities,answer,i,e),e=decodeList(c.additionals,answer,i,e),packet.decode.bytes=e-a,c},encodingLength:function(i){return header.encodingLength(i)+encodingLengthList(i.questions||[],question)+encodingLengthList(i.answers||[],answer)+encodingLengthList(i.authorities||[],answer)+encodingLengthList(i.additionals||[],answer)}};packet.encode.bytes=0;packet.decode.bytes=0;const encode$6=packet.encode,decode$6=packet.decode,encodingLength=packet.encodingLength;function encodingLengthList(i,e){let a=0;for(let c=0;c<i.length;c++)a+=e.encodingLength(i[c]);return a}function encodeList(i,e,a,c){for(let h=0;h<i.length;h++)e.encode(i[h],a,c),c+=e.encode.bytes;return c}function decodeList(i,e,a,c){for(let h=0;h<i.length;h++)i[h]=e.decode(a,c),c+=e.decode.bytes;return c}const PREFERS_PADDING=1,PREFERS_NO_PADDING=2;function make(i,e,a,c){if(e.length!==64)throw new Error(`Charset needs to be 64 characters long! (${e.length})`);const h=new Uint8Array(256),d=new Uint8Array(64);for(let gt=0;gt<64;gt+=1){const _t=e.charCodeAt(gt);if(_t>255)throw new Error(`Character #${gt} in charset [code=${_t}, char=${e.charAt(gt)}] is too high! (max=255)`);if(h[_t]!==0)throw new Error(`Character [code=${_t}, char=${e.charAt(gt)}] is more than once in the charset!`);h[_t]=gt,d[gt]=_t}const et=a.charCodeAt(0),ft={name:i,encodingLength(gt){const _t=gt.length,wt=_t*.75|0;return gt.charCodeAt(_t-1)===et?gt.charCodeAt(_t-2)===et?wt-2:wt-1:wt},encode(gt,_t,wt){_t==null&&(_t=new Uint8Array(ft.encodingLength(gt))),wt==null&&(wt=0);let $t=gt.length;gt.charCodeAt($t-1)===et&&(gt.charCodeAt($t-2)===et?$t-=2:$t-=1);const It=$t%4,Rt=$t-It;let Tt=wt,At=0;for(;At<Rt;){const kt=h[gt.charCodeAt(At)]<<18|h[gt.charCodeAt(At+1)]<<12|h[gt.charCodeAt(At+2)]<<6|h[gt.charCodeAt(At+3)];_t[Tt++]=kt>>16,_t[Tt++]=kt>>8,_t[Tt++]=kt,At+=4}if(It===3){const kt=h[gt.charCodeAt(At)]<<10|h[gt.charCodeAt(At+1)]<<4|h[gt.charCodeAt(At+2)]>>2;_t[Tt++]=kt>>8,_t[Tt++]=kt}else It===2&&(_t[Tt++]=h[gt.charCodeAt(At)]<<2|h[gt.charCodeAt(At+1)]>>4);return ft.encode.bytes=Tt-wt,_t},decode(gt,_t,wt){_t==null&&(_t=0),wt==null&&(wt=gt.length);const $t=wt-_t,It=$t%3,Rt=_t+$t-It,Tt=[];for(let At=_t;At<Rt;At+=3){const kt=gt[At]<<16|gt[At+1]<<8|gt[At+2];Tt.push(d[kt>>18&63],d[kt>>12&63],d[kt>>6&63],d[kt&63])}if(It===2){const At=(gt[wt-2]<<8)+gt[wt-1];Tt.push(d[At>>10],d[At>>4&63],d[At<<2&63]),c===PREFERS_PADDING&&Tt.push(et)}else if(It===1){const At=gt[wt-1];Tt.push(d[At>>2],d[At<<4&63]),c===PREFERS_PADDING&&Tt.push(et,et)}return ft.decode.bytes=$t,String.fromCharCode.apply(String,Tt)}};return ft}make("base64","ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/","=",PREFERS_PADDING);const base64URL=make("base64-url","ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_","=",PREFERS_NO_PADDING);let AbortError$2=typeof global<"u"?global.AbortError:typeof window<"u"?window.AbortError:null;AbortError$2||(AbortError$2=class extends Error{constructor(e="Request aborted."){super(e)}});AbortError$2.prototype.name="AbortError";AbortError$2.prototype.code="ABORT_ERR";const URL$1=typeof globalThis<"u"&&globalThis.URL||require("url").URL;class HTTPStatusError extends Error{constructor(e,a,c){super("status="+a+" while requesting "+e+" ["+c+"]"),this.uri=e,this.status=a,this.method=c}toJSON(){return{code:this.code,uri:this.uri,status:this.status,method:this.method,endpoint:this.endpoint}}}HTTPStatusError.prototype.name="HTTPStatusError";HTTPStatusError.prototype.code="HTTP_STATUS";class ResponseError extends Error{constructor(e,a){super(e),this.cause=a}toJSON(){return{message:this.message,endpoint:this.endpoint,code:this.code,cause:reduceError(this.cause)}}}ResponseError.prototype.name="ResponseError";ResponseError.prototype.code="RESPONSE_ERR";let TimeoutError$1=class extends Error{constructor(e){super("Timeout (t="+e+")."),this.timeout=e}toJSON(){return{code:this.code,endpoint:this.endpoint,timeout:this.timeout}}};TimeoutError$1.prototype.name="TimeoutError";TimeoutError$1.prototype.code="ETIMEOUT";const v4Regex=/^((\d{1,3}\.){3,3}\d{1,3})(:(\d{2,5}))?$/,v6Regex=/^((::)?(((\d{1,3}\.){3}(\d{1,3}){1})?([0-9a-f]){0,4}:{0,2}){1,8}(::)?)(:(\d{2,5}))?$/i;function reduceError(i){if(typeof i=="string")return{message:i};try{const a=JSON.stringify(i);if(a!=="{}")return JSON.parse(a)}catch{}const e={message:String(i.message||i)};return i.code!==void 0&&(e.code=String(i.code)),e}const baseParts=/^(([a-z0-9]+:)\/\/)?([^/[\s:]+|\[[^\]]+\])?(:([^/\s]+))?(\/[^\s]*)?(.*)$/,httpFlags=/\[(post|get|((ipv4|ipv6|name)=([^\]]+)))\]/ig,updFlags=/\[(((pk|name)=([^\]]+)))\]/ig;function parseEndpoint(i){const e=baseParts.exec(i),a=e[2]||"https:",c=e[3],h=e[5],d=e[6],et=e[7];if(a==="https:"||a==="http:"){const ft=parseFlags(et,httpFlags);return{name:ft.name,protocol:a,ipv4:ft.ipv4,ipv6:ft.ipv6,host:c,port:h,path:d,method:ft.post?"POST":"GET"}}if(a==="udp:"||a==="udp4:"||a==="udp6:"){const ft=parseFlags(et,updFlags),gt=/^\[(.*)\]$/.exec(c);if(gt&&a==="udp4:")throw new Error(`Endpoint parsing error: Cannot use ipv6 host with udp4: (endpoint=${i})`);if(!gt&&a==="udp6:")throw new Error(`Endpoint parsing error: Incorrectly formatted host for udp6: (endpoint=${i})`);return gt?new UDP6Endpoint({protocol:"udp6:",ipv6:gt[1],port:h,pk:ft.pk,name:ft.name}):new UDP4Endpoint({protocol:"udp4:",ipv4:c,port:h,pk:ft.pk,name:ft.name})}throw new InvalidProtocolError(a,i)}function parseFlags(i,e){e.lastIndex=0;const a={};for(;;){const c=e.exec(i);if(!c)break;c[2]?a[c[3].toLowerCase()]=c[4]:a[c[1].toLowerCase()]=!0}return a}class InvalidProtocolError extends Error{constructor(e,a){super(`Invalid Endpoint: unsupported protocol "${e}" for endpoint: ${a}, supported protocols: ${supportedProtocols.join(", ")}`),this.protocol=e,this.endpoint=a}toJSON(){return{code:this.code,endpoint:this.endpoint,timeout:this.timeout}}}InvalidProtocolError.prototype.name="InvalidProtocolError";InvalidProtocolError.prototype.code="EPROTOCOL";const supportedProtocols=["http:","https:","udp4:","udp6:"];class BaseEndpoint{constructor(e,a){this.name=e.name||null,this.protocol=e.protocol;const c=typeof e.port=="string"?e.port=parseInt(e.port,10):e.port;if(c==null)this.port=a?this.protocol==="https:"?443:80:e.pk?443:53;else{if(typeof c!="number"&&!isNaN(c))throw new Error(`Invalid Endpoint: port "${e.port}" needs to be a number: ${JSON.stringify(e)}`);this.port=c}}toJSON(){return this.toString()}}class UDPEndpoint extends BaseEndpoint{constructor(e){super(e,!1),this.pk=e.pk||null}toString(){const e=this.port!==(this.pk?443:53)?`:${this.port}`:"",a=this.pk?` [pk=${this.pk}]`:"",c=this.name?` [name=${this.name}]`:"";return`udp://${this.ipv4||`[${this.ipv6}]`}${e}${a}${c}`}}class UDP4Endpoint extends UDPEndpoint{constructor(e){if(super(Object.assign({protocol:"udp4:"},e)),!e.ipv4||typeof e.ipv4!="string")throw new Error(`Invalid Endpoint: .ipv4 "${e.ipv4}" needs to be set: ${JSON.stringify(e)}`);this.ipv4=e.ipv4}}class UDP6Endpoint extends UDPEndpoint{constructor(e){if(super(Object.assign({protocol:"udp6:"},e)),!e.ipv6||typeof e.ipv6!="string")throw new Error(`Invalid Endpoint: .ipv6 "${e.ipv6}" needs to be set: ${JSON.stringify(e)}`);this.ipv6=e.ipv6}}function safeHost(i){return v6Regex.test(i)&&!v4Regex.test(i)?`[${i}]`:i}class HTTPEndpoint extends BaseEndpoint{constructor(e){if(super(Object.assign({protocol:"https:"},e),!0),e.host||(e.ipv4&&(e.host=e.ipv4),e.ipv6&&(e.host=`[${e.ipv6}]`)),!e.host||typeof e.host!="string")throw new Error(`Invalid Endpoint: host "${e.path}" needs to be set: ${JSON.stringify(e)}`);if(this.host=e.host,this.path=e.path||"/dns-query",this.method=/^post$/i.test(e.method)?"POST":"GET",this.ipv4=e.ipv4,this.ipv6=e.ipv6,!this.ipv6){const c=v6Regex.exec(this.host);c&&(this.ipv6=c[1])}this.ipv4||v4Regex.test(this.host)&&(this.ipv4=this.host);const a=`${this.protocol}//${safeHost(this.host)}:${this.port}${this.path}`;try{this.url=new URL$1(a)}catch(c){throw new Error(c.message+` [${a}]`)}}toString(){const e=this.protocol==="https:"?"":"http://",a=this.port!==(this.protocol==="https:"?443:80)?`:${this.port}`:"",c=this.method!=="GET"?" [post]":"",h=this.path==="/dns-query"?"":this.path,d=this.name?` [name=${this.name}]`:"",et=this.ipv4&&this.ipv4!==this.host?` [ipv4=${this.ipv4}]`:"",ft=this.ipv6&&this.ipv6!==this.host?` [ipv6=${this.ipv6}]`:"";return`${e}${safeHost(this.host)}${a}${h}${c}${et}${ft}${d}`}}function toEndpoint(i){let e;if(typeof i=="string")e=parseEndpoint(i);else{if(typeof i!="object"||i===null||Array.isArray(i))throw new Error(`Can not convert ${i} to an endpoint`);if(i instanceof BaseEndpoint)return i;e=i}(e.protocol===null||e.protocol===void 0)&&(e.protocol="https:");const a=e.protocol;if(a==="udp4:")return new UDP4Endpoint(e);if(a==="udp6:")return new UDP6Endpoint(e);if(a==="https:"||a==="http:")return new HTTPEndpoint(e);throw new InvalidProtocolError(a,JSON.stringify(e))}const contentType="application/dns-message";function noop(){}function queryDns(){throw new Error('Only "doh" endpoints are supported in the browser')}async function loadJSON(i,e,a,c){const h=e?e.localStoragePrefix+e.name:null;if(h)try{const ft=JSON.parse(localStorage.getItem(h));if(ft&&ft.time>e.maxTime)return ft}catch{}const{data:d}=await requestRaw(i,"GET",null,a,c),et={time:Date.now(),data:JSON.parse(decode$7(d))};if(h)try{localStorage.setItem(h,JSON.stringify(et))}catch{et.time=null}return et}function requestRaw(i,e,a,c,h){return new Promise((d,et)=>{const ft=new URL$1(i);e==="GET"&&a&&(ft.search="?dns="+base64URL.decode(a));const gt=ft.toString(),_t=new XMLHttpRequest;_t.open(e,gt,!0),_t.setRequestHeader("Accept",contentType),e==="POST"&&_t.setRequestHeader("Content-Type",contentType),_t.responseType="arraybuffer",_t.timeout=c,_t.ontimeout=wt,_t.onreadystatechange=It,_t.onerror=Tt,_t.onload=$t,e==="POST"?_t.send(a):_t.send(),h&&h.addEventListener("abort",At);function wt(){Rt(new TimeoutError$1(c));try{_t.abort()}catch{}}function $t(){if(_t.status!==200)Rt(new HTTPStatusError(gt,_t.status,e));else{let kt;if(typeof _t.response=="string")kt=encode$7(_t.response);else if(_t.response instanceof Uint8Array)kt=_t.response;else if(Array.isArray(_t.response)||_t.response instanceof ArrayBuffer)kt=new Uint8Array(_t.response);else throw new Error("Unprocessable response "+_t.response);Rt(null,kt)}}function It(){if(_t.readyState>1&&_t.status!==200&&_t.status!==0){Rt(new HTTPStatusError(gt,_t.status,e));try{_t.abort()}catch{}}}let Rt=function(kt,xt){Rt=noop,h&&h.removeEventListener("abort",At),d(kt?{error:kt,response:_t}:{data:xt,response:_t})};function Tt(){Rt(_t.status===200?new Error("Inexplicable XHR Error"):new HTTPStatusError(gt,_t.status,e))}function At(){Rt(new AbortError$2);try{_t.abort()}catch{}}})}function request(i,e,a,c,h){return requestRaw(i,e,a,c,h)}function processResolvers$1(i){return i.filter(e=>e.cors||e.endpoint.cors)}const resolvers={data:[{name:"adfree.usableprivacy.net",endpoint:{protocol:"https:",host:"adfree.usableprivacy.net"},description:`Public updns DoH service with advertising, tracker and malware filters.
Hosted in Europe by @usableprivacy, details see: https://docs.usableprivacy.com`,country:"Germany",location:{lat:51.2993,long:9.491},filter:!0},{name:"adguard-dns-doh",endpoint:{protocol:"https:",host:"dns.adguard.com",ipv4:"94.140.15.15"},description:"Remove ads and protect your computer from malware (over DoH)",country:"France",location:{lat:48.8582,long:2.3387},filter:!0},{name:"adguard-dns-family-doh",endpoint:{protocol:"https:",host:"dns-family.adguard.com",ipv4:"94.140.15.16"},description:"Adguard DNS with safesearch and adult content blocking (over DoH)",country:"France",location:{lat:48.8582,long:2.3387},filter:!0},{name:"adguard-dns-unfiltered-doh",endpoint:{protocol:"https:",host:"dns-unfiltered.adguard.com",ipv4:"94.140.14.140"},description:"AdGuard public DNS servers without filters (over DoH)",country:"France",location:{lat:48.8582,long:2.3387}},{name:"ahadns-doh-chi",endpoint:{protocol:"https:",host:"doh.chi.ahadns.net",cors:!0},description:`A zero logging DNS with support for DNS-over-HTTPS (DoH) & DNS-over-TLS (DoT). Blocks ads, malware, trackers, viruses, ransomware, telemetry and more. No persistent logs. DNSSEC. Hosted in Chicago, USA. By https://ahadns.com/
Server statistics can be seen at: https://statistics.ahadns.com/?server=chi`,country:"United States",location:{lat:41.8483,long:-87.6517},filter:!0,cors:!0},{name:"ahadns-doh-in",endpoint:{protocol:"https:",host:"doh.in.ahadns.net",cors:!0},description:`A zero logging DNS with support for DNS-over-HTTPS (DoH) & DNS-over-TLS (DoT). Blocks ads, malware, trackers, viruses, ransomware, telemetry and more. No persistent logs. DNSSEC. Hosted in Mumbai, India. By https://ahadns.com/
Server statistics can be seen at: https://statistics.ahadns.com/?server=in`,country:"India",location:{lat:19.0748,long:72.8856},filter:!0,cors:!0},{name:"ahadns-doh-la",endpoint:{protocol:"https:",host:"doh.la.ahadns.net",cors:!0},description:`A zero logging DNS with support for DNS-over-HTTPS (DoH) & DNS-over-TLS (DoT). Blocks ads, malware, trackers, viruses, ransomware, telemetry and more. No persistent logs. DNSSEC. Hosted in Los Angeles, USA. By https://ahadns.com/
Server statistics can be seen at: https://statistics.ahadns.com/?server=la`,country:"United States",location:{lat:34.0549,long:-118.2578},filter:!0,cors:!0},{name:"ahadns-doh-nl",endpoint:{protocol:"https:",host:"doh.nl.ahadns.net",cors:!0},description:`A zero logging DNS with support for DNS-over-HTTPS (DoH) & DNS-over-TLS (DoT). Blocks ads, malware, trackers, viruses, ransomware, telemetry and more. No persistent logs. DNSSEC. Hosted in Amsterdam, Netherlands. By https://ahadns.com/
Server statistics can be seen at: https://statistics.ahadns.com/?server=nl`,country:"Netherlands",location:{lat:52.3824,long:4.8995},filter:!0,cors:!0},{name:"ahadns-doh-ny",endpoint:{protocol:"https:",host:"doh.ny.ahadns.net",cors:!0},description:`A zero logging DNS with support for DNS-over-HTTPS (DoH) & DNS-over-TLS (DoT). Blocks ads, malware, trackers, viruses, ransomware, telemetry and more. No persistent logs. DNSSEC. Hosted in New York. By https://ahadns.com/
Server statistics can be seen at: https://statistics.ahadns.com/?server=ny`,country:"United States",location:{lat:40.7308,long:-73.9975},filter:!0,cors:!0},{name:"ahadns-doh-pl",endpoint:{protocol:"https:",host:"doh.pl.ahadns.net",cors:!0},description:`A zero logging DNS with support for DNS-over-HTTPS (DoH) & DNS-over-TLS (DoT). Blocks ads, malware, trackers, viruses, ransomware, telemetry and more. No persistent logs. DNSSEC. Hosted in Poland. By https://ahadns.com/
Server statistics can be seen at: https://statistics.ahadns.com/?server=pl`,country:"Netherlands",location:{lat:52.3824,long:4.8995},filter:!0,cors:!0},{name:"alidns-doh",endpoint:{protocol:"https:",host:"dns.alidns.com",ipv4:"223.5.5.5",cors:!0},description:`A public DNS resolver that supports DoH/DoT in mainland China, provided by Alibaba-Cloud.
Warning: GFW filtering rules are applied by that resolver.
Homepage: https://alidns.com/`,country:"China",location:{lat:34.7725,long:113.7266},filter:!0,log:!0,cors:!0},{name:"ams-ads-doh-nl",endpoint:{protocol:"https:",host:"dnsnl-noads.alekberg.net"},description:"Resolver in Amsterdam. DoH protocol. Non-logging. Blocks ads, malware and trackers. DNSSEC enabled.",country:"Romania",location:{lat:45.9968,long:24.997},filter:!0},{name:"ams-doh-nl",endpoint:{protocol:"https:",host:"dnsnl.alekberg.net"},description:"Resolver in Amsterdam. DoH protocol. Non-logging, non-filtering, DNSSEC.",country:"Romania",location:{lat:45.9968,long:24.997}},{name:"att",endpoint:{protocol:"https:",host:"dohtrial.att.net"},description:"AT&T test DoH server.",log:!0},{name:"bcn-ads-doh",endpoint:{protocol:"https:",host:"dnses-noads.alekberg.net"},description:"Resolver in Spain. DoH protocol. Non-logging, remove ads and malware, DNSSEC.",country:"Spain",location:{lat:41.3891,long:2.1611},filter:!0},{name:"bcn-doh",endpoint:{protocol:"https:",host:"dnses.alekberg.net"},description:"Resolver in Spain. DoH protocol. Non-logging, non-filtering, DNSSEC.",country:"Spain",location:{lat:41.3891,long:2.1611}},{name:"brahma-world",endpoint:{protocol:"https:",host:"dns.brahma.world"},description:`DNS-over-HTTPS server. Non Logging, filters ads, trackers and malware. DNSSEC ready, QNAME Minimization, No EDNS Client-Subnet.
Hosted in Stockholm, Sweden. (https://dns.brahma.world)`,country:"United States",location:{lat:37.751,long:-97.822},filter:!0},{name:"cisco-doh",endpoint:{protocol:"https:",host:"doh.opendns.com",ipv4:"146.112.41.2"},description:`Remove your DNS blind spot (DoH protocol)
Warning: modifies your queries to include a copy of your network
address when forwarding them to a selection of companies and organizations.`,country:"United States",location:{lat:37.751,long:-97.822},filter:!0,log:!0},{name:"cloudflare",endpoint:{protocol:"https:",host:"dns.cloudflare.com",ipv4:"1.0.0.1",cors:!0},description:"Cloudflare DNS (anycast) - aka 1.1.1.1 / 1.0.0.1",country:"Australia",location:{lat:-33.494,long:143.2104},cors:!0},{name:"cloudflare-family",endpoint:{protocol:"https:",host:"family.cloudflare-dns.com",ipv4:"1.0.0.3",cors:!0},description:"Cloudflare DNS (anycast) with malware protection and parental control - aka 1.1.1.3 / 1.0.0.3",country:"Australia",location:{lat:-33.494,long:143.2104},filter:!0,cors:!0},{name:"cloudflare-ipv6",endpoint:{protocol:"https:",host:"1dot1dot1dot1.cloudflare-dns.com",cors:!0},description:"Cloudflare DNS over IPv6 (anycast)",country:"United States",location:{lat:37.751,long:-97.822},cors:!0},{name:"cloudflare-security",endpoint:{protocol:"https:",host:"security.cloudflare-dns.com",ipv4:"1.0.0.2",cors:!0},description:"Cloudflare DNS (anycast) with malware blocking - aka 1.1.1.2 / 1.0.0.2",country:"Australia",location:{lat:-33.494,long:143.2104},filter:!0,cors:!0},{name:"controld-block-malware",endpoint:{protocol:"https:",host:"freedns.controld.com",path:"/p1"},description:`ControlD Free DNS. Take CONTROL of your Internet. Block unwanted content, bypass geo-restrictions and be more productive. DoH protocol and No logging. - https://controld.com/free-dns
This DNS blocks Malware domains.`,country:"Canada",location:{lat:43.6319,long:-79.3716},filter:!0},{name:"controld-block-malware-ad",endpoint:{protocol:"https:",host:"freedns.controld.com",path:"/p2"},description:`ControlD Free DNS. Take CONTROL of your Internet. Block unwanted content, bypass geo-restrictions and be more productive. DoH protocol and No logging. - https://controld.com/free-dns
This DNS blocks Malware, Ads & Tracking domains.`,country:"Canada",location:{lat:43.6319,long:-79.3716},filter:!0},{name:"controld-block-malware-ad-social",endpoint:{protocol:"https:",host:"freedns.controld.com",path:"/p3"},description:`ControlD Free DNS. Take CONTROL of your Internet. Block unwanted content, bypass geo-restrictions and be more productive. DoH protocol and No logging. - https://controld.com/free-dns
This DNS blocks Malware, Ads & Tracking and Social Networks domains.`,country:"Canada",location:{lat:43.6319,long:-79.3716},filter:!0},{name:"controld-family-friendly",endpoint:{protocol:"https:",host:"freedns.controld.com",path:"/family"},description:`ControlD Free DNS. Take CONTROL of your Internet. Block unwanted content, bypass geo-restrictions and be more productive. DoH protocol and No logging. - https://controld.com/free-dns
This DNS blocks Malware, Ads & Tracking, Adult Content and Drugs domains.`,country:"Canada",location:{lat:43.6319,long:-79.3716},filter:!0},{name:"controld-uncensored",endpoint:{protocol:"https:",host:"freedns.controld.com",path:"/uncensored"},description:`ControlD Free DNS. Take CONTROL of your Internet. Block unwanted content, bypass geo-restrictions and be more productive. DoH protocol and No logging. - https://controld.com/free-dns
This DNS unblocks censored domains from various countries.`,country:"Canada",location:{lat:43.6319,long:-79.3716}},{name:"controld-unfiltered",endpoint:{protocol:"https:",host:"freedns.controld.com",path:"/p0"},description:`ControlD Free DNS. Take CONTROL of your Internet. Block unwanted content, bypass geo-restrictions and be more productive. DoH protocol and No logging. - https://controld.com/free-dns
This is a Unfiltered DNS, no DNS record blocking or manipulation here, if you want to block Malware, Ads & Tracking or Social Network domains, use the other ControlD DNS configs.`,country:"Canada",location:{lat:43.6319,long:-79.3716}},{name:"dns.digitale-gesellschaft.ch",endpoint:{protocol:"https:",host:"dns.digitale-gesellschaft.ch"},description:`Public DoH resolver operated by the Digital Society (https://www.digitale-gesellschaft.ch).
Hosted in Zurich, Switzerland.
Non-logging, non-filtering, supports DNSSEC.`,country:"Switzerland",location:{lat:47.1449,long:8.1551}},{name:"dns.ryan-palmer",endpoint:{protocol:"https:",host:"dns1.ryan-palmer.com"},description:"Non-logging, non-filtering, DNSSEC DoH Server. Hosted in the UK.",country:"United Kingdom",location:{lat:51.5164,long:-.093}},{name:"dns.sb",endpoint:{protocol:"https:",host:"doh.sb",ipv4:"185.222.222.222",cors:!0},description:`DNSSEC-enabled DoH server by https://xtom.com/
https://dns.sb/doh/`,country:"Unknown",location:{lat:47,long:8},cors:!0},{name:"dns.therifleman.name",endpoint:{protocol:"https:",host:"dns.therifleman.name"},description:`DNS-over-HTTPS DNS forwarder from Mumbai, India. Blocks web and Android trackers and ads.
IP addresses are not logged, but queries are logged for 24 hours for debugging.
Report issues, send suggestions @ joker349 at protonmail.com.
Also supports DoT (for android) @ dns.therifleman.name and plain DNS @ 172.104.206.174`,country:"United States",location:{lat:37.751,long:-97.822},filter:!0},{name:"dnsforfamily-doh",endpoint:{protocol:"https:",host:"dns-doh.dnsforfamily.com"},description:`(DoH Protocol) (Now supports DNSSEC). Block adult websites, gambling websites, malwares and advertisements.
It also enforces safe search in: Google, YouTube, Bing, DuckDuckGo and Yandex.
Social websites like Facebook and Instagram are not blocked. No DNS queries are logged.
As of 26-May-2022 5.9 million websites are blocked and new websites are added to blacklist daily.
Completely free, no ads or any commercial motive. Operating for 4 years now.
Provided by: https://dnsforfamily.com`,country:"Finland",location:{lat:60.1758,long:24.9349},filter:!0},{name:"dnsforfamily-doh-no-safe-search",endpoint:{protocol:"https:",host:"dns-doh-no-safe-search.dnsforfamily.com"},description:`(DoH Protocol) (Now supports DNSSEC) Block adult websites, gambling websites, malwares and advertisements.
Unlike other dnsforfamily servers, this one does not enforces safe search. So Google, YouTube, Bing, DuckDuckGo and Yandex are completely accessible without any restriction.
Social websites like Facebook and Instagram are not blocked. No DNS queries are logged.
As of 26-May-2022 5.9 million websites are blocked and new websites are added to blacklist daily.
Completely free, no ads or any commercial motive. Operating for 4 years now.
Warning: This server is incompatible with anonymization.
Provided by: https://dnsforfamily.com`,country:"Finland",location:{lat:60.1758,long:24.9349},filter:!0},{name:"dnsforge.de",endpoint:{protocol:"https:",host:"dnsforge.de",cors:!0},description:`Public DoH resolver running with Pihole for Adblocking (https://dnsforge.de).
Non-logging, AD-filtering, supports DNSSEC. Hosted in Germany.`,country:"Germany",location:{lat:52.2998,long:9.447},filter:!0,cors:!0},{name:"dnshome-doh",endpoint:{protocol:"https:",host:"dns.dnshome.de"},description:"https://www.dnshome.de/ public resolver in Germany"},{name:"dnspod-doh",endpoint:{protocol:"https:",host:"doh.pub",cors:!0},description:`A public DNS resolver in mainland China provided by DNSPod (Tencent Cloud).
https://www.dnspod.cn/Products/Public.DNS?lang=en`,filter:!0,log:!0,cors:!0},{name:"dnswarden-asia-adblock-dohv4",endpoint:{protocol:"https:",host:"doh.asia.dnswarden.com",path:"/adblock"},description:"Hosted in Singapore. For more information look [here](https://github.com/bhanupratapys/dnswarden) or [here](https://dnswarden.com).",country:"Singapore",location:{lat:1.2929,long:103.8547},filter:!0},{name:"dnswarden-asia-adultfilter-dohv4",endpoint:{protocol:"https:",host:"doh.asia.dnswarden.com",path:"/adultfilter"},description:"Hosted in Singapore. For more information look [here](https://github.com/bhanupratapys/dnswarden) or [here](https://dnswarden.com).",country:"Singapore",location:{lat:1.2929,long:103.8547},filter:!0},{name:"dnswarden-asia-uncensor-dohv4",endpoint:{protocol:"https:",host:"doh.asia.dnswarden.com",path:"/uncensored"},description:"Hosted in Singapore. For more information look [here](https://github.com/bhanupratapys/dnswarden) or [here](https://dnswarden.com).",country:"Singapore",location:{lat:1.2929,long:103.8547}},{name:"dnswarden-eu-adblock-dohv4",endpoint:{protocol:"https:",host:"doh.eu.dnswarden.com"},description:"Hosted in Germany. For more information look [here](https://github.com/bhanupratapys/dnswarden) or [here](https://dnswarden.com).",country:"Germany",location:{lat:50.1103,long:8.7147},filter:!0},{name:"dnswarden-us-adblock-dohv4",endpoint:{protocol:"https:",host:"doh.us.dnswarden.com"},description:"Hosted in USA (Dallas) . For more information look [here](https://github.com/bhanupratapys/dnswarden) or [here](https://dnswarden.com).",country:"United States",location:{lat:32.7889,long:-96.8021},filter:!0},{name:"doh-ch-blahdns",endpoint:{protocol:"https:",host:"doh-ch.blahdns.com",cors:!0},description:"Blocks ad and Tracking, no Logging, DNSSEC, Hosted in Switzerland. By https://blahdns.com/",country:"Netherlands",location:{lat:52.3824,long:4.8995},filter:!0,cors:!0},{name:"doh-cleanbrowsing-adult",endpoint:{protocol:"https:",host:"doh.cleanbrowsing.org",path:"/doh/adult-filter/",cors:!0},description:`Blocks access to all adult, pornographic and explicit sites. It does
not block proxy or VPNs, nor mixed-content sites. Sites like Reddit
are allowed. Google and Bing are set to the Safe Mode.
By https://cleanbrowsing.org/`,filter:!0,cors:!0},{name:"doh-cleanbrowsing-family",endpoint:{protocol:"https:",host:"doh.cleanbrowsing.org",path:"/doh/family-filter/",cors:!0},description:`Blocks access to all adult, pornographic and explicit sites. It also
blocks proxy and VPN domains that are used to bypass the filters.
Mixed content sites (like Reddit) are also blocked. Google, Bing and
Youtube are set to the Safe Mode.
By https://cleanbrowsing.org/`,filter:!0,cors:!0},{name:"doh-cleanbrowsing-security",endpoint:{protocol:"https:",host:"doh.cleanbrowsing.org",path:"/doh/security-filter/",cors:!0},description:`Block access to phishing, malware and malicious domains. It does not block adult content.
By https://cleanbrowsing.org/`,filter:!0,cors:!0},{name:"doh-crypto-sx",endpoint:{protocol:"https:",host:"doh.crypto.sx",cors:!0},description:`DNS-over-HTTPS server. Anycast, no logs, no censorship, DNSSEC.
Backend hosted by Scaleway, globally cached via Cloudflare.
Maintained by Frank Denis.`,country:"United States",location:{lat:37.751,long:-97.822},cors:!0},{name:"doh-crypto-sx-ipv6",endpoint:{protocol:"https:",host:"doh-ipv6.crypto.sx",cors:!0},description:`DNS-over-HTTPS server accessible over IPv6. Anycast, no logs, no censorship, DNSSEC.
Backend hosted by Scaleway, globally cached via Cloudflare.
Maintained by Frank Denis.`,country:"United States",location:{lat:37.751,long:-97.822},cors:!0},{name:"doh-de-blahdns",endpoint:{protocol:"https:",host:"doh-de.blahdns.com",cors:!0},description:"Blocks ad and Tracking, no Logging, DNSSEC, Hosted in Germany. By https://blahdns.com/",country:"Germany",location:{lat:51.2993,long:9.491},filter:!0,cors:!0},{name:"doh-fi-blahdns",endpoint:{protocol:"https:",host:"doh-fi.blahdns.com",cors:!0},description:"Blocks ad and Tracking, no Logging, DNSSEC, Hosted in Finland. By https://blahdns.com/",country:"Finland",location:{lat:60.1758,long:24.9349},filter:!0,cors:!0},{name:"doh-ibksturm",endpoint:{protocol:"https:",host:"ibksturm.synology.me"},description:`DoH & DoT Server, No Logging, No Filters, DNSSEC
Running privately by ibksturm in Thurgau, Switzerland`},{name:"doh-jp-blahdns",endpoint:{protocol:"https:",host:"doh-jp.blahdns.com",cors:!0},description:"Blocks ad and Tracking, no Logging, DNSSEC, Hosted in Japan. By https://blahdns.com/",country:"Japan",location:{lat:35.6882,long:139.7532},filter:!0,cors:!0},{name:"doh.ffmuc.net",endpoint:{protocol:"https:",host:"doh.ffmuc.net"},description:`An open (non-logging, non-filtering, non-censoring) DoH resolver operated by Freifunk Munich with nodes in DE.
https://ffmuc.net/`,country:"Germany",location:{lat:51.2993,long:9.491}},{name:"doh.tiarap.org",endpoint:{protocol:"https:",host:"doh.tiarap.org"},description:`Non-Logging DNS-over-HTTPS server, cached via Cloudflare.
Filters out ads, trackers and malware, NO ECS, supports DNSSEC.`,country:"United States",location:{lat:37.751,long:-97.822},filter:!0},{name:"google",endpoint:{protocol:"https:",host:"dns.google",ipv4:"8.8.8.8",cors:!0},description:"Google DNS (anycast)",country:"United States",location:{lat:37.751,long:-97.822},log:!0,cors:!0},{name:"hdns",endpoint:{protocol:"https:",host:"query.hdns.io",cors:!0},description:`HDNS is a public DNS resolver that supports Handshake domains.
https://www.hdns.io`,country:"United States",location:{lat:37.7771,long:-122.406},cors:!0},{name:"he",endpoint:{protocol:"https:",host:"ordns.he.net"},description:`Hurricane Electric DoH server (anycast)
Unknown logging policy.`,country:"United States",location:{lat:37.751,long:-97.822},log:!0},{name:"id-gmail-doh",endpoint:{protocol:"https:",host:"doh.tiar.app"},description:`Non-Logging DNS-over-HTTPS server located in Singapore.
Filters out ads, trackers and malware, supports DNSSEC, provided by id-gmail.`,country:"Singapore",location:{lat:1.2929,long:103.8547},filter:!0},{name:"iij",endpoint:{protocol:"https:",host:"public.dns.iij.jp"},description:`DoH server operated by Internet Initiative Japan in Tokyo.
https://www.iij.ad.jp/`,country:"Japan",location:{lat:35.69,long:139.69},log:!0},{name:"iqdns-doh",endpoint:{protocol:"https:",host:"a.passcloud.xyz"},description:`Non-logging DoH service runned by V2EX.com user johnsonwil.
Returns "no such domain" for anti-Chinese government websites. Supports DNSSEC.
For more information: https://www.v2ex.com/t/785666`,filter:!0},{name:"jp.tiar.app-doh",endpoint:{protocol:"https:",host:"jp.tiar.app"},description:`Non-Logging, Non-Filtering DNS-over-HTTPS server in Japan.
No ECS, Support DNSSEC`,country:"Japan",location:{lat:35.6882,long:139.7532}},{name:"jp.tiarap.org",endpoint:{protocol:"https:",host:"jp.tiarap.org"},description:`DNS-over-HTTPS Server. Non-Logging, Non-Filtering, No ECS, Support DNSSEC.
Cached via Cloudflare.`},{name:"libredns",endpoint:{protocol:"https:",host:"doh.libredns.gr"},description:`DoH server in Germany. No logging, but no DNS padding and no DNSSEC support.
https://libredns.gr/`,country:"Germany",location:{lat:51.2993,long:9.491}},{name:"nextdns",endpoint:{protocol:"https:",host:"anycsast.dns.nextdns.io"},description:`NextDNS is a cloud-based private DNS service that gives you full control
over what is allowed and what is blocked on the Internet.
DNSSEC, Anycast, Non-logging, NoFilters
https://www.nextdns.io/`,country:"Netherlands",location:{lat:52.3891,long:4.6563}},{name:"nextdns-ultralow",endpoint:{protocol:"https:",host:"dns.nextdns.io",path:"/dnscrypt-proxy"},description:`NextDNS is a cloud-based private DNS service that gives you full control
over what is allowed and what is blocked on the Internet.
https://www.nextdns.io/
To select the server location, the "-ultralow" variant relies on bootstrap servers
instead of anycast.`},{name:"njalla-doh",endpoint:{protocol:"https:",host:"dns.njal.la",cors:!0},description:`Non-logging DoH server in Sweden operated by Njalla.
https://dns.njal.la/`,country:"Sweden",location:{lat:59.3247,long:18.056},cors:!0},{name:"odoh-cloudflare",endpoint:{protocol:"https:",host:"odoh.cloudflare-dns.com",cors:!0},description:`Cloudflare ODoH server.
https://cloudflare.com`,cors:!0},{name:"odoh-crypto-sx",endpoint:{protocol:"https:",host:"odoh.crypto.sx",cors:!0},description:`ODoH target server. Anycast, no logs.
Backend hosted by Scaleway. Maintained by Frank Denis.`,cors:!0},{name:"odoh-id-gmail",endpoint:{protocol:"https:",host:"doh.tiar.app",path:"/odoh"},description:`ODoH target server. Based in Singapore, no logs.
Filter ads, trackers and malware.`,filter:!0},{name:"odoh-jp.tiar.app",endpoint:{protocol:"https:",host:"jp.tiar.app",path:"/odoh"},description:"ODoH target server. no logs."},{name:"odoh-jp.tiarap.org",endpoint:{protocol:"https:",host:"jp.tiarap.org",path:"/odoh"},description:"ODoH target server via Cloudflare, no logs."},{name:"odoh-resolver4.dns.openinternet.io",endpoint:{protocol:"https:",host:"resolver4.dns.openinternet.io"},description:`ODoH target server. no logs, no filter, DNSSEC.
Running on dedicated hardware colocated at Sonic.net in Santa Rosa, CA in the United States.
Uses Sonic's recusrive DNS servers as upstream resolvers (but is not affiliated with Sonic
in any way). Provided by https://openinternet.io`},{name:"odoh-tiarap.org",endpoint:{protocol:"https:",host:"doh.tiarap.org",path:"/odoh"},description:`ODoH target server via Cloudflare, no logs.
Filter ads, trackers and malware.`,filter:!0},{name:"publicarray-au2-doh",endpoint:{protocol:"https:",host:"doh-2.seby.io",cors:!0},description:`DNSSEC • OpenNIC • Non-logging • Uncensored - hosted on ovh.com.au
Maintained by publicarray - https://dns.seby.io`,country:"Australia",location:{lat:-33.8591,long:151.2002},cors:!0},{name:"puredns-doh",endpoint:{protocol:"https:",host:"puredns.org",ipv4:"146.190.6.13",cors:!0},description:`Public uncensored DNS resolver in Singapore - https://puredns.org
** Only available in Indonesia and Singapore **`,country:"United States",location:{lat:37.751,long:-97.822},cors:!0},{name:"quad101",endpoint:{protocol:"https:",host:"dns.twnic.tw",cors:!0},description:`DNSSEC-aware public resolver by the Taiwan Network Information Center (TWNIC)
https://101.101.101.101/index_en.html`,cors:!0},{name:"quad9-doh-ip4-port443-filter-ecs-pri",endpoint:{protocol:"https:",host:"dns11.quad9.net",ipv4:"149.112.112.11"},description:"Quad9 (anycast) dnssec/no-log/filter/ecs 9.9.9.11 - 149.112.112.11",country:"United States",location:{lat:37.751,long:-97.822},filter:!0},{name:"quad9-doh-ip4-port443-filter-pri",endpoint:{protocol:"https:",host:"dns.quad9.net",ipv4:"149.112.112.112"},description:"Quad9 (anycast) dnssec/no-log/filter 9.9.9.9 - 149.112.112.9 - 149.112.112.112",country:"United States",location:{lat:37.751,long:-97.822},filter:!0},{name:"quad9-doh-ip4-port443-nofilter-ecs-pri",endpoint:{protocol:"https:",host:"dns12.quad9.net",ipv4:"9.9.9.12"},description:"Quad9 (anycast) no-dnssec/no-log/no-filter/ecs 9.9.9.12 - 149.112.112.12",country:"United States",location:{lat:37.751,long:-97.822}},{name:"quad9-doh-ip4-port443-nofilter-pri",endpoint:{protocol:"https:",host:"dns10.quad9.net",ipv4:"149.112.112.10"},description:"Quad9 (anycast) no-dnssec/no-log/no-filter 9.9.9.10 - 149.112.112.10",country:"United States",location:{lat:37.751,long:-97.822}},{name:"quad9-doh-ip6-port5053-filter-pri",endpoint:{protocol:"https:",host:"dns9.quad9.net"},description:"Quad9 (anycast) dnssec/no-log/filter 2620:fe::fe - 2620:fe::9 - 2620:fe::fe:9",country:"United States",location:{lat:37.751,long:-97.822},filter:!0},{name:"safesurfer-doh",endpoint:{protocol:"https:",host:"doh.safesurfer.io"},description:`Family safety focused blocklist for over 2 million adult sites, as well as phishing and malware and more.
Free to use, paid for customizing blocking for more categories+sites and viewing usage at my.safesurfer.io. Logs taken for viewing
usage, data never sold - https://safesurfer.io`,filter:!0,log:!0},{name:"sth-ads-doh-se",endpoint:{protocol:"https:",host:"dnsse-noads.alekberg.net"},description:"Resolver in Stockholm, Sweden. DoH server. Non-logging, remove ads and malware, DNSSEC.",country:"Bulgaria",location:{lat:42.696,long:23.332},filter:!0},{name:"sth-doh-se",endpoint:{protocol:"https:",host:"dnsse.alekberg.net"},description:"Resolver in Stockholm, Sweden. DoH server. Non-logging, non-filtering, DNSSEC.",country:"Bulgaria",location:{lat:42.696,long:23.332}},{name:"switch",endpoint:{protocol:"https:",host:"dns.switch.ch"},description:`Public DoH service provided by SWITCH in Switzerland
https://www.switch.ch
Provides protection against malware, but does not block ads.`,filter:!0},{name:"uncensoreddns-dk-ipv4",endpoint:{protocol:"https:",host:"unicast.uncensoreddns.org"},description:`Also known as censurfridns.
DoH, no logs, no filter, DNSSEC, unicast hosted in Denmark - https://blog.uncensoreddns.org`,country:"Denmark",location:{lat:55.7123,long:12.0564}},{name:"uncensoreddns-ipv4",endpoint:{protocol:"https:",host:"anycast.uncensoreddns.org"},description:`Also known as censurfridns.
DoH, no logs, no filter, DNSSEC, anycast - https://blog.uncensoreddns.org`,country:"Denmark",location:{lat:55.7123,long:12.0564}},{name:"v.dnscrypt.uk-doh-ipv4",endpoint:{protocol:"https:",host:"v.dnscrypt.uk"},description:`DoH, no logs, uncensored, DNSSEC. Hosted in London UK on Digital Ocean
https://www.dnscrypt.uk`,country:"United Kingdom",location:{lat:51.4964,long:-.1224}}],time:1654187067783};function processResolvers(i){const e=i.time===null||i.time===void 0?Date.now():i.time,a=processResolvers$1(i.data.map(h=>(h.endpoint=toEndpoint(Object.assign({name:h.name},h.endpoint)),h))),c=a.map(h=>h.endpoint);return{data:{resolvers:a,resolverByName:a.reduce((h,d)=>(h[d.name]=d,h),{}),endpoints:c,endpointByName:c.reduce((h,d)=>(h[d.name]=d,h),{})},time:e}}const backup=processResolvers(resolvers);function toMultiQuery(i){const e=Object.assign({type:"query"},i);return delete e.question,e.questions=[],i.question&&e.questions.push(i.question),e}function queryOne(i,e,a,c){return c&&c.aborted?Promise.reject(new AbortError$2):i.protocol==="udp4:"||i.protocol==="udp6:"?queryDns():queryDoh(i,e,a,c)}function queryDoh(i,e,a,c){return request(i.url,i.method,encode$6(Object.assign({flags:RECURSION_DESIRED},e)),a,c).then(function(h){const d=h.data,et=h.response;let ft=h.error;if(ft===void 0)if(d.length===0)ft=new ResponseError("Empty.");else try{const gt=decode$6(d);return gt.response=et,gt}catch(gt){ft=new ResponseError("Invalid packet (cause="+gt.message+")",gt)}throw Object.assign(ft,{response:et})})}const UPDATE_URL=new URL$1("https://martinheidegger.github.io/dns-query/resolvers.json");function isNameString(i){return/^@/.test(i)}class Wellknown{constructor(e){this.opts=Object.assign({timeout:5e3,update:!0,updateURL:UPDATE_URL,persist:!1,localStoragePrefix:"dnsquery_",maxAge:3e5},e),this._dataP=null}_data(e,a){return!e&&this._dataP!==null?this._dataP.then(c=>c.time<Date.now()-this.opts.maxAge?this._data(!0,c):c):(this._dataP=this.opts.update?loadJSON(this.opts.updateURL,this.opts.persist?{name:"resolvers.json",localStoragePrefix:this.opts.localStoragePrefix,maxTime:Date.now()-this.opts.maxAge}:null,this.opts.timeout).then(c=>processResolvers({data:c.data.resolvers,time:c.time})).catch(()=>a||backup):Promise.resolve(backup),this._dataP)}data(){return this._data(!1).then(e=>e.data)}endpoints(e){if(e==null)return this.data().then(a=>a.endpoints);if(e==="doh"&&(e=filterDoh),e==="dns"&&(e=filterDns),typeof e=="function")return this.data().then(a=>a.endpoints.filter(e));if(typeof e=="string"||typeof e[Symbol.iterator]!="function")return Promise.reject(new Error(`Endpoints (${e}) needs to be iterable (array).`));if(e=Array.from(e).filter(Boolean),e.findIndex(isNameString)===-1)try{return Promise.resolve(e.map(toEndpoint))}catch(a){return Promise.reject(a)}return this.data().then(a=>e.map(c=>{if(isNameString(c)){const h=a.endpointByName[c.substring(1)];if(!h)throw new Error(`Endpoint ${c} is not known.`);return h}return toEndpoint(c)}))}}const wellknown=new Wellknown;function isPromise(i){return i===null||typeof i!="object"?!1:typeof i.then=="function"}function toPromise(i){return isPromise(i)?i:Promise.resolve(i)}function query(i,e){return e=Object.assign({retries:5,timeout:3e4},e),i.question?toPromise(e.endpoints).then(a=>{if(!Array.isArray(a)||a.length===0)throw new Error("No endpoints defined to lookup dns records.");return queryN(a.map(toEndpoint),toMultiQuery(i),e)}).then(a=>(a.question=a.questions[0],delete a.questions,a)):Promise.reject(new Error("To request data you need to specify a .question!"))}function queryN(i,e,a){const c=i.length===1?i[0]:i[Math.floor(Math.random()*i.length)%i.length];return queryOne(c,e,a.timeout,a.signal).then(h=>(h.endpoint=c.toString(),h),h=>{if(h.name==="AbortError"||a.retries===0)throw h.endpoint=c.toString(),h;return a.retries>0&&(a.retries-=1),queryN(i,e,a)})}function filterDoh(i){return i.protocol==="https:"||i.protocol==="http:"}function filterDns(i){return i.protocol==="udp4:"||i.protocol==="udp6:"}const log$k=new Logger$2("dns-over-https");class DnsOverHttps{constructor(e,a=3){qt(this,"endpoints");qt(this,"retries");this.endpoints=e,this.retries=a}static async create(e,a){const c=e??await wellknown.endpoints("doh");return new DnsOverHttps(c,a)}async resolveTXT(e){let a;try{a=(await query({question:{type:"TXT",name:e}},{endpoints:this.endpoints,retries:this.retries})).answers}catch(d){throw log$k.error("query failed: ",d),new Error("DNS query failed")}if(!a)throw new Error(`Could not resolve ${e}`);const c=a.map(d=>d.data),h=[];return c.forEach(d=>{typeof d=="string"?h.push(d):Array.isArray(d)?d.forEach(et=>{typeof et=="string"?h.push(et):h.push(bytesToUtf8(et))}):h.push(bytesToUtf8(d))}),h}}var base32$5={exports:{}};/*
 * [hi-base32]{@link https://github.com/emn178/hi-base32}
 *
 * @version 0.5.0
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2015-2018
 * @license MIT
 */(function(i){(function(){var e=typeof window=="object"?window:{},a=!e.HI_BASE32_NO_NODE_JS&&typeof process=="object"&&process.versions&&process.versions.node;a&&(e=commonjsGlobal);var c=!e.HI_BASE32_NO_COMMON_JS&&!0&&i.exports,h="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567".split(""),d={A:0,B:1,C:2,D:3,E:4,F:5,G:6,H:7,I:8,J:9,K:10,L:11,M:12,N:13,O:14,P:15,Q:16,R:17,S:18,T:19,U:20,V:21,W:22,X:23,Y:24,Z:25,2:26,3:27,4:28,5:29,6:30,7:31},et=[0,0,0,0,0,0,0,0],ft=function(kt,xt){xt.length>10&&(xt="..."+xt.substr(-10));var Nt=new Error("Decoded data is not valid UTF-8. Maybe try base32.decode.asBytes()? Partial data after reading "+kt+" bytes: "+xt+" <-");throw Nt.position=kt,Nt},gt=function(kt){for(var xt="",Nt=kt.length,Ft=0,jt=0,Gt,Kt;Ft<Nt;){if(Gt=kt[Ft++],Gt<=127){xt+=String.fromCharCode(Gt);continue}else Gt>191&&Gt<=223?(Kt=Gt&31,jt=1):Gt<=239?(Kt=Gt&15,jt=2):Gt<=247?(Kt=Gt&7,jt=3):ft(Ft,xt);for(var Wt=0;Wt<jt;++Wt)Gt=kt[Ft++],(Gt<128||Gt>191)&&ft(Ft,xt),Kt<<=6,Kt+=Gt&63;Kt>=55296&&Kt<=57343&&ft(Ft,xt),Kt>1114111&&ft(Ft,xt),Kt<=65535?xt+=String.fromCharCode(Kt):(Kt-=65536,xt+=String.fromCharCode((Kt>>10)+55296),xt+=String.fromCharCode((Kt&1023)+56320))}return xt},_t=function(kt){if(kt==="")return[];if(!/^[A-Z2-7=]+$/.test(kt))throw new Error("Invalid base32 characters");kt=kt.replace(/=/g,"");for(var xt,Nt,Ft,jt,Gt,Kt,Wt,Zt,cr=[],hr=0,gr=kt.length,er=0,mr=gr>>3<<3;er<mr;)xt=d[kt.charAt(er++)],Nt=d[kt.charAt(er++)],Ft=d[kt.charAt(er++)],jt=d[kt.charAt(er++)],Gt=d[kt.charAt(er++)],Kt=d[kt.charAt(er++)],Wt=d[kt.charAt(er++)],Zt=d[kt.charAt(er++)],cr[hr++]=(xt<<3|Nt>>>2)&255,cr[hr++]=(Nt<<6|Ft<<1|jt>>>4)&255,cr[hr++]=(jt<<4|Gt>>>1)&255,cr[hr++]=(Gt<<7|Kt<<2|Wt>>>3)&255,cr[hr++]=(Wt<<5|Zt)&255;var Mr=gr-mr;return Mr===2?(xt=d[kt.charAt(er++)],Nt=d[kt.charAt(er++)],cr[hr++]=(xt<<3|Nt>>>2)&255):Mr===4?(xt=d[kt.charAt(er++)],Nt=d[kt.charAt(er++)],Ft=d[kt.charAt(er++)],jt=d[kt.charAt(er++)],cr[hr++]=(xt<<3|Nt>>>2)&255,cr[hr++]=(Nt<<6|Ft<<1|jt>>>4)&255):Mr===5?(xt=d[kt.charAt(er++)],Nt=d[kt.charAt(er++)],Ft=d[kt.charAt(er++)],jt=d[kt.charAt(er++)],Gt=d[kt.charAt(er++)],cr[hr++]=(xt<<3|Nt>>>2)&255,cr[hr++]=(Nt<<6|Ft<<1|jt>>>4)&255,cr[hr++]=(jt<<4|Gt>>>1)&255):Mr===7&&(xt=d[kt.charAt(er++)],Nt=d[kt.charAt(er++)],Ft=d[kt.charAt(er++)],jt=d[kt.charAt(er++)],Gt=d[kt.charAt(er++)],Kt=d[kt.charAt(er++)],Wt=d[kt.charAt(er++)],cr[hr++]=(xt<<3|Nt>>>2)&255,cr[hr++]=(Nt<<6|Ft<<1|jt>>>4)&255,cr[hr++]=(jt<<4|Gt>>>1)&255,cr[hr++]=(Gt<<7|Kt<<2|Wt>>>3)&255),cr},wt=function(kt){for(var xt,Nt,Ft,jt,Gt,Kt="",Wt=kt.length,Zt=0,cr=parseInt(Wt/5)*5;Zt<cr;)xt=kt.charCodeAt(Zt++),Nt=kt.charCodeAt(Zt++),Ft=kt.charCodeAt(Zt++),jt=kt.charCodeAt(Zt++),Gt=kt.charCodeAt(Zt++),Kt+=h[xt>>>3]+h[(xt<<2|Nt>>>6)&31]+h[Nt>>>1&31]+h[(Nt<<4|Ft>>>4)&31]+h[(Ft<<1|jt>>>7)&31]+h[jt>>>2&31]+h[(jt<<3|Gt>>>5)&31]+h[Gt&31];var hr=Wt-cr;return hr===1?(xt=kt.charCodeAt(Zt),Kt+=h[xt>>>3]+h[xt<<2&31]+"======"):hr===2?(xt=kt.charCodeAt(Zt++),Nt=kt.charCodeAt(Zt),Kt+=h[xt>>>3]+h[(xt<<2|Nt>>>6)&31]+h[Nt>>>1&31]+h[Nt<<4&31]+"===="):hr===3?(xt=kt.charCodeAt(Zt++),Nt=kt.charCodeAt(Zt++),Ft=kt.charCodeAt(Zt),Kt+=h[xt>>>3]+h[(xt<<2|Nt>>>6)&31]+h[Nt>>>1&31]+h[(Nt<<4|Ft>>>4)&31]+h[Ft<<1&31]+"==="):hr===4&&(xt=kt.charCodeAt(Zt++),Nt=kt.charCodeAt(Zt++),Ft=kt.charCodeAt(Zt++),jt=kt.charCodeAt(Zt),Kt+=h[xt>>>3]+h[(xt<<2|Nt>>>6)&31]+h[Nt>>>1&31]+h[(Nt<<4|Ft>>>4)&31]+h[(Ft<<1|jt>>>7)&31]+h[jt>>>2&31]+h[jt<<3&31]+"="),Kt},$t=function(kt){var xt,Nt,Ft,jt,Gt,Kt,Wt=!1,Zt="",cr=0,hr,gr=0,er=kt.length;if(kt==="")return Zt;do{for(et[0]=et[5],et[1]=et[6],et[2]=et[7],hr=gr;cr<er&&hr<5;++cr)Kt=kt.charCodeAt(cr),Kt<128?et[hr++]=Kt:Kt<2048?(et[hr++]=192|Kt>>6,et[hr++]=128|Kt&63):Kt<55296||Kt>=57344?(et[hr++]=224|Kt>>12,et[hr++]=128|Kt>>6&63,et[hr++]=128|Kt&63):(Kt=65536+((Kt&1023)<<10|kt.charCodeAt(++cr)&1023),et[hr++]=240|Kt>>18,et[hr++]=128|Kt>>12&63,et[hr++]=128|Kt>>6&63,et[hr++]=128|Kt&63);gr=hr-5,cr===er&&++cr,cr>er&&hr<6&&(Wt=!0),xt=et[0],hr>4?(Nt=et[1],Ft=et[2],jt=et[3],Gt=et[4],Zt+=h[xt>>>3]+h[(xt<<2|Nt>>>6)&31]+h[Nt>>>1&31]+h[(Nt<<4|Ft>>>4)&31]+h[(Ft<<1|jt>>>7)&31]+h[jt>>>2&31]+h[(jt<<3|Gt>>>5)&31]+h[Gt&31]):hr===1?Zt+=h[xt>>>3]+h[xt<<2&31]+"======":hr===2?(Nt=et[1],Zt+=h[xt>>>3]+h[(xt<<2|Nt>>>6)&31]+h[Nt>>>1&31]+h[Nt<<4&31]+"===="):hr===3?(Nt=et[1],Ft=et[2],Zt+=h[xt>>>3]+h[(xt<<2|Nt>>>6)&31]+h[Nt>>>1&31]+h[(Nt<<4|Ft>>>4)&31]+h[Ft<<1&31]+"==="):(Nt=et[1],Ft=et[2],jt=et[3],Zt+=h[xt>>>3]+h[(xt<<2|Nt>>>6)&31]+h[Nt>>>1&31]+h[(Nt<<4|Ft>>>4)&31]+h[(Ft<<1|jt>>>7)&31]+h[jt>>>2&31]+h[jt<<3&31]+"=")}while(!Wt);return Zt},It=function(kt){for(var xt,Nt,Ft,jt,Gt,Kt="",Wt=kt.length,Zt=0,cr=parseInt(Wt/5)*5;Zt<cr;)xt=kt[Zt++],Nt=kt[Zt++],Ft=kt[Zt++],jt=kt[Zt++],Gt=kt[Zt++],Kt+=h[xt>>>3]+h[(xt<<2|Nt>>>6)&31]+h[Nt>>>1&31]+h[(Nt<<4|Ft>>>4)&31]+h[(Ft<<1|jt>>>7)&31]+h[jt>>>2&31]+h[(jt<<3|Gt>>>5)&31]+h[Gt&31];var hr=Wt-cr;return hr===1?(xt=kt[Zt],Kt+=h[xt>>>3]+h[xt<<2&31]+"======"):hr===2?(xt=kt[Zt++],Nt=kt[Zt],Kt+=h[xt>>>3]+h[(xt<<2|Nt>>>6)&31]+h[Nt>>>1&31]+h[Nt<<4&31]+"===="):hr===3?(xt=kt[Zt++],Nt=kt[Zt++],Ft=kt[Zt],Kt+=h[xt>>>3]+h[(xt<<2|Nt>>>6)&31]+h[Nt>>>1&31]+h[(Nt<<4|Ft>>>4)&31]+h[Ft<<1&31]+"==="):hr===4&&(xt=kt[Zt++],Nt=kt[Zt++],Ft=kt[Zt++],jt=kt[Zt],Kt+=h[xt>>>3]+h[(xt<<2|Nt>>>6)&31]+h[Nt>>>1&31]+h[(Nt<<4|Ft>>>4)&31]+h[(Ft<<1|jt>>>7)&31]+h[jt>>>2&31]+h[jt<<3&31]+"="),Kt},Rt=function(kt,xt){var Nt=typeof kt!="string";return Nt&&kt.constructor===ArrayBuffer&&(kt=new Uint8Array(kt)),Nt?It(kt):xt?wt(kt):$t(kt)},Tt=function(kt,xt){if(!xt)return gt(_t(kt));if(kt==="")return"";if(!/^[A-Z2-7=]+$/.test(kt))throw new Error("Invalid base32 characters");var Nt,Ft,jt,Gt,Kt,Wt,Zt,cr,hr="",gr=kt.indexOf("=");gr===-1&&(gr=kt.length);for(var er=0,mr=gr>>3<<3;er<mr;)Nt=d[kt.charAt(er++)],Ft=d[kt.charAt(er++)],jt=d[kt.charAt(er++)],Gt=d[kt.charAt(er++)],Kt=d[kt.charAt(er++)],Wt=d[kt.charAt(er++)],Zt=d[kt.charAt(er++)],cr=d[kt.charAt(er++)],hr+=String.fromCharCode((Nt<<3|Ft>>>2)&255)+String.fromCharCode((Ft<<6|jt<<1|Gt>>>4)&255)+String.fromCharCode((Gt<<4|Kt>>>1)&255)+String.fromCharCode((Kt<<7|Wt<<2|Zt>>>3)&255)+String.fromCharCode((Zt<<5|cr)&255);var Mr=gr-mr;return Mr===2?(Nt=d[kt.charAt(er++)],Ft=d[kt.charAt(er++)],hr+=String.fromCharCode((Nt<<3|Ft>>>2)&255)):Mr===4?(Nt=d[kt.charAt(er++)],Ft=d[kt.charAt(er++)],jt=d[kt.charAt(er++)],Gt=d[kt.charAt(er++)],hr+=String.fromCharCode((Nt<<3|Ft>>>2)&255)+String.fromCharCode((Ft<<6|jt<<1|Gt>>>4)&255)):Mr===5?(Nt=d[kt.charAt(er++)],Ft=d[kt.charAt(er++)],jt=d[kt.charAt(er++)],Gt=d[kt.charAt(er++)],Kt=d[kt.charAt(er++)],hr+=String.fromCharCode((Nt<<3|Ft>>>2)&255)+String.fromCharCode((Ft<<6|jt<<1|Gt>>>4)&255)+String.fromCharCode((Gt<<4|Kt>>>1)&255)):Mr===7&&(Nt=d[kt.charAt(er++)],Ft=d[kt.charAt(er++)],jt=d[kt.charAt(er++)],Gt=d[kt.charAt(er++)],Kt=d[kt.charAt(er++)],Wt=d[kt.charAt(er++)],Zt=d[kt.charAt(er++)],hr+=String.fromCharCode((Nt<<3|Ft>>>2)&255)+String.fromCharCode((Ft<<6|jt<<1|Gt>>>4)&255)+String.fromCharCode((Gt<<4|Kt>>>1)&255)+String.fromCharCode((Kt<<7|Wt<<2|Zt>>>3)&255)),hr},At={encode:Rt,decode:Tt};Tt.asBytes=_t,c?i.exports=At:e.base32=At})()})(base32$5);var base32Exports=base32$5.exports;const base32$4=getDefaultExportFromCjs(base32Exports),Os=class Os{static parseAndVerifyRoot(e,a){if(!e.startsWith(this.ROOT_PREFIX))throw new Error(`ENRTree root entry must start with '${this.ROOT_PREFIX}'`);const c=Os.parseRootValues(e),h=base32$4.decode.asBytes(a),d=e.split(" sig")[0],et=utf8ToBytes$1(d),ft=fromString$9(c.signature,"base64url").slice(0,64);if(!verifySignature(ft,keccak256(et),new Uint8Array(h)))throw new Error("Unable to verify ENRTree root signature");return c.eRoot}static parseRootValues(e){const a=e.match(/^enrtree-root:v1 e=([^ ]+) l=([^ ]+) seq=(\d+) sig=([^ ]+)$/);if(!Array.isArray(a))throw new Error("Could not parse ENRTree root entry");a.shift();const[c,h,d,et]=a;if(!c)throw new Error("Could not parse 'e' value from ENRTree root entry");if(!h)throw new Error("Could not parse 'l' value from ENRTree root entry");if(!d)throw new Error("Could not parse 'seq' value from ENRTree root entry");if(!et)throw new Error("Could not parse 'sig' value from ENRTree root entry");return{eRoot:c,lRoot:h,seq:Number(d),signature:et}}static parseTree(e){if(!e.startsWith(this.TREE_PREFIX))throw new Error(`ENRTree tree entry must start with '${this.TREE_PREFIX}'`);const a=e.match(/^enrtree:\/\/([^@]+)@(.+)$/);if(!Array.isArray(a))throw new Error("Could not parse ENRTree tree entry");a.shift();const[c,h]=a;if(!c)throw new Error("Could not parse public key from ENRTree tree entry");if(!h)throw new Error("Could not parse domain from ENRTree tree entry");return{publicKey:c,domain:h}}static parseBranch(e){if(!e.startsWith(this.BRANCH_PREFIX))throw new Error(`ENRTree branch entry must start with '${this.BRANCH_PREFIX}'`);return e.split(this.BRANCH_PREFIX)[1].split(",")}};qt(Os,"RECORD_PREFIX",ENR.RECORD_PREFIX),qt(Os,"TREE_PREFIX","enrtree:"),qt(Os,"BRANCH_PREFIX","enrtree-branch:"),qt(Os,"ROOT_PREFIX","enrtree-root:");let ENRTree=Os;const log$j=new Logger$2("discovery:fetch_nodes");async function fetchNodesUntilCapabilitiesFulfilled(i,e,a){const c={relay:i.relay??0,store:i.store??0,filter:i.filter??0,lightPush:i.lightPush??0},h=c.relay+c.store+c.filter+c.lightPush,d={relay:0,store:0,filter:0,lightPush:0};let et=0;const ft=[];for(;!isSatisfied(c,d)&&et<h+e;){const gt=await a();gt&&isNewPeer(gt,ft)&&(gt.waku2&&helpsSatisfyCapabilities(gt.waku2,c,d)&&(addCapabilities(gt.waku2,d),ft.push(gt)),log$j.info(`got new peer candidate from DNS address=${gt.nodeId}@${gt.ip}`)),et++}return ft}async function*yieldNodesUntilCapabilitiesFulfilled(i,e,a){const c={relay:i.relay??0,store:i.store??0,filter:i.filter??0,lightPush:i.lightPush??0},h=c.relay+c.store+c.filter+c.lightPush,d={relay:0,store:0,filter:0,lightPush:0};let et=0;const ft=new Set;for(;!isSatisfied(c,d)&&et<h+e;){const gt=await a();gt&&gt.nodeId&&!ft.has(gt.nodeId)&&(ft.add(gt.nodeId),gt.waku2&&helpsSatisfyCapabilities(gt.waku2,c,d)&&(addCapabilities(gt.waku2,d),yield gt),log$j.info(`got new peer candidate from DNS address=${gt.nodeId}@${gt.ip}`)),et++}}function isSatisfied(i,e){return e.relay>=i.relay&&e.store>=i.store&&e.filter>=i.filter&&e.lightPush>=i.lightPush}function isNewPeer(i,e){if(!i.nodeId)return!1;for(const a of e)if(i.nodeId===a.nodeId)return!1;return!0}function addCapabilities(i,e){i.relay&&(e.relay+=1),i.store&&(e.store+=1),i.filter&&(e.filter+=1),i.lightPush&&(e.lightPush+=1)}function helpsSatisfyCapabilities(i,e,a){if(isSatisfied(e,a))throw"Internal Error: Waku2 wanted capabilities are already fulfilled";const c=missingCapabilities(e,a);return c.relay&&i.relay||c.store&&i.store||c.filter&&i.filter||c.lightPush&&i.lightPush}function missingCapabilities(i,e){return{relay:e.relay<i.relay,store:e.store<i.store,filter:e.filter<i.filter,lightPush:e.lightPush<i.lightPush}}const log$i=new Logger$2("discovery:dns");class DnsNodeDiscovery{constructor(e){qt(this,"dns");qt(this,"_DNSTreeCache");qt(this,"_errorTolerance",10);this._DNSTreeCache={},this.dns=e}static async dnsOverHttp(e){return e||(e=await DnsOverHttps.create()),new DnsNodeDiscovery(e)}async getPeers(e,a){const c=Math.floor(Math.random()*e.length),{publicKey:h,domain:d}=ENRTree.parseTree(e[c]),et={domain:d,publicKey:h,visits:{}},ft=await fetchNodesUntilCapabilitiesFulfilled(a,this._errorTolerance,()=>this._search(d,et));return log$i.info("retrieved peers: ",ft.map(gt=>{var _t,wt;return{id:(_t=gt.peerId)==null?void 0:_t.toString(),multiaddrs:(wt=gt.multiaddrs)==null?void 0:wt.map($t=>$t.toString())}})),ft}async*getNextPeer(e,a){const c=Math.floor(Math.random()*e.length),{publicKey:h,domain:d}=ENRTree.parseTree(e[c]),et={domain:d,publicKey:h,visits:{}};for await(const ft of yieldNodesUntilCapabilitiesFulfilled(a,this._errorTolerance,()=>this._search(d,et)))yield ft}async _search(e,a){try{const c=await this._getTXTRecord(e,a);a.visits[e]=!0;let h,d;const et=getEntryType(c);try{switch(et){case ENRTree.ROOT_PREFIX:return h=ENRTree.parseAndVerifyRoot(c,a.publicKey),await this._search(h,a);case ENRTree.BRANCH_PREFIX:return d=ENRTree.parseBranch(c),h=selectRandomPath(d,a),await this._search(h,a);case ENRTree.RECORD_PREFIX:return EnrDecoder.fromString(c);default:return null}}catch(ft){return log$i.error(`Failed to search DNS tree ${et} at subdomain ${e}: ${ft}`),null}}catch(c){return log$i.error(`Failed to retrieve TXT record at subdomain ${e}: ${c}`),null}}async _getTXTRecord(e,a){if(this._DNSTreeCache[e])return this._DNSTreeCache[e];const c=e!==a.domain?`${e}.${a.domain}`:a.domain,h=await this.dns.resolveTXT(c);if(!h.length)throw new Error("Received empty result array while fetching TXT record");if(!h[0].length)throw new Error("Received empty TXT record");const d=h.join("");return this._DNSTreeCache[e]=d,d}}function getEntryType(i){return i.startsWith(ENRTree.ROOT_PREFIX)?ENRTree.ROOT_PREFIX:i.startsWith(ENRTree.BRANCH_PREFIX)?ENRTree.BRANCH_PREFIX:i.startsWith(ENRTree.RECORD_PREFIX)?ENRTree.RECORD_PREFIX:""}function selectRandomPath(i,e){const a={};for(const[h,d]of i.entries())e.visits[d]&&(a[h]=!0);if(Object.keys(a).length===i.length)throw new Error("Unresolvable circular path detected");let c;do c=Math.floor(Math.random()*i.length);while(a[c]);return i[c]}const log$h=new Logger$2("peer-discovery-dns");class PeerDiscoveryDns extends TypedEventEmitter{constructor(a,c){super();qt(this,"nextPeer");qt(this,"_started");qt(this,"_components");qt(this,"_options");this._started=!1,this._components=a,this._options=c;const{enrUrls:h}=c;log$h.info("Use following EIP-1459 ENR Tree URLs: ",h)}async start(){if(log$h.info("Starting peer discovery via dns"),this._started=!0,this.nextPeer===void 0){let{enrUrls:a}=this._options;Array.isArray(a)||(a=[a]);const{wantedNodeCapabilityCount:c}=this._options,h=await DnsNodeDiscovery.dnsOverHttp();this.nextPeer=h.getNextPeer.bind(h,a,c)}for await(const a of this.nextPeer()){if(!this._started)return;const{peerInfo:c,shardInfo:h}=a;if(!c)continue;const d={[DEFAULT_BOOTSTRAP_TAG_NAME]:{value:this._options.tagValue??DEFAULT_BOOTSTRAP_TAG_VALUE,ttl:this._options.tagTTL??DEFAULT_BOOTSTRAP_TAG_TTL}};let et=!1;await this._components.peerStore.has(c.id)?(await this._components.peerStore.get(c.id)).tags.has(DEFAULT_BOOTSTRAP_TAG_NAME)||(et=!0,await this._components.peerStore.merge(c.id,{tags:d})):(et=!0,await this._components.peerStore.save(c.id,{tags:d,...h&&{metadata:{shardInfo:encodeRelayShard(h)}}})),et&&this.dispatchEvent(new CustomEvent("peer",{detail:c}))}}stop(){this._started=!1}get[peerDiscovery](){return!0}get[Symbol.toStringTag](){return"@waku/bootstrap"}}function wakuDnsDiscovery(i,e=DEFAULT_NODE_REQUIREMENTS$1){return a=>new PeerDiscoveryDns(a,{enrUrls:i,wantedNodeCapabilityCount:e})}async function filterPeers(i,e,a){const c=i.filter(et=>et.tags.has(Tags.BOOTSTRAP)).slice(0,a),h=i.filter(et=>!et.tags.has(Tags.BOOTSTRAP));if(e===0)return[...c,...h];const d=[...c];for(;d.length<e&&h.length>0;){const et=Math.floor(Math.random()*h.length),ft=h.splice(et,1)[0];d.push(ft)}return d}class StreamManager{constructor(e,a,c){qt(this,"multicodec");qt(this,"getConnections");qt(this,"addEventListener");qt(this,"streamPool");qt(this,"log");qt(this,"handlePeerUpdateStreamPool",e=>{const a=e.detail.peer;a.protocols.includes(this.multicodec)&&(this.log.info(`Preemptively opening a stream to ${a.id.toString()}`),this.prepareNewStream(a))});this.multicodec=e,this.getConnections=a,this.addEventListener=c,this.log=new Logger$2(`stream-manager:${e}`),this.addEventListener("peer:update",this.handlePeerUpdateStreamPool.bind(this)),this.getStream=this.getStream.bind(this),this.streamPool=new Map}async getStream(e){const a=e.id.toString(),c=this.streamPool.get(a);if(!c)return this.newStream(e);this.streamPool.delete(a),this.prepareNewStream(e);const h=await c;return!h||h.status==="closed"?this.newStream(e):h}async newStream(e){const a=this.getConnections(e.id),c=selectConnection(a);if(!c)throw new Error("Failed to get a connection to the peer");return c.newStream(this.multicodec)}prepareNewStream(e){const a=this.newStream(e).catch(()=>{this.log.error(`Failed to prepare a new stream for ${e.id.toString()}`)});this.streamPool.set(e.id.toString(),a)}}class BaseProtocol{constructor(e,a){qt(this,"multicodec");qt(this,"components");qt(this,"addLibp2pEventListener");qt(this,"removeLibp2pEventListener");qt(this,"streamManager");this.multicodec=e,this.components=a,this.addLibp2pEventListener=a.events.addEventListener.bind(a.events),this.removeLibp2pEventListener=a.events.removeEventListener.bind(a.events),this.streamManager=new StreamManager(e,a.connectionManager.getConnections.bind(a.connectionManager),this.addLibp2pEventListener)}async getStream(e){return this.streamManager.getStream(e)}get peerStore(){return this.components.peerStore}async peers(){return getPeersForProtocol(this.peerStore,[this.multicodec])}async getPeer(e){const{peer:a}=await selectPeerForProtocol(this.peerStore,[this.multicodec],e);return a}async getPeers({numPeers:e,maxBootstrapPeers:a}={maxBootstrapPeers:1,numPeers:0}){const c=await getConnectedPeersForProtocol(this.components.connectionManager.getConnections(),this.peerStore,[this.multicodec]);return filterPeers(c,e,a)}initializePubsubTopic(e){return(e==null?void 0:e.pubsubTopics)??(e!=null&&e.shardInfo?shardInfoToPubsubTopics(e.shardInfo):[DefaultPubsubTopic])}}class PeerExchangeRPC{constructor(e){qt(this,"proto");this.proto=e}static createRequest(e){const{numPeers:a}=e;return new PeerExchangeRPC({query:{numPeers:a},response:void 0})}encode(){return PeerExchangeRPC$1.encode(this.proto)}static decode(e){const a=PeerExchangeRPC$1.decode(e);return new PeerExchangeRPC(a)}get query(){return this.proto.query}get response(){return this.proto.response}}const PeerExchangeCodec="/vac/waku/peer-exchange/2.0.0-alpha1",log$g=new Logger$2("peer-exchange");class WakuPeerExchange extends BaseProtocol{constructor(e){super(PeerExchangeCodec,e)}async query(e){const{numPeers:a}=e,c=PeerExchangeRPC.createRequest({numPeers:BigInt(a)}),h=await this.getPeer(e.peerId),d=await this.getStream(h),et=await pipe([c.encode()],encode$c,d,decode$b,async ft=>await all$1(ft));try{const ft=new Uint8ArrayList;et.forEach(_t=>{ft.append(_t)});const{response:gt}=PeerExchangeRPC.decode(ft);if(!gt){log$g.error("PeerExchangeRPC message did not contains a `response` field");return}return Promise.all(gt.peerInfos.map(_t=>_t.enr).filter(isDefined).map(async _t=>({ENR:await EnrDecoder.fromRLP(_t)})))}catch(ft){log$g.error("Failed to decode push reply",ft);return}}}const log$f=new Logger$2("peer-exchange-discovery"),DEFAULT_PEER_EXCHANGE_REQUEST_NODES=10,DEFAULT_PEER_EXCHANGE_QUERY_INTERVAL_MS=10*1e3,DEFAULT_MAX_RETRIES=3,DEFAULT_PEER_EXCHANGE_TAG_NAME=Tags.PEER_EXCHANGE,DEFAULT_PEER_EXCHANGE_TAG_VALUE=50,DEFAULT_PEER_EXCHANGE_TAG_TTL=1e8;class PeerExchangeDiscovery extends TypedEventEmitter{constructor(a,c={}){super();qt(this,"components");qt(this,"peerExchange");qt(this,"options");qt(this,"isStarted");qt(this,"queryingPeers",new Set);qt(this,"queryAttempts",new Map);qt(this,"handleDiscoveredPeer",a=>{const{protocols:c,peerId:h}=a.detail;!c.includes(PeerExchangeCodec)||this.queryingPeers.has(h.toString())||(this.queryingPeers.add(h.toString()),this.startRecurringQueries(h).catch(d=>log$f.error(`Error querying peer ${d}`)))});qt(this,"startRecurringQueries",async a=>{const c=a.toString(),{queryInterval:h=DEFAULT_PEER_EXCHANGE_QUERY_INTERVAL_MS,maxRetries:d=DEFAULT_MAX_RETRIES}=this.options;log$f.info(`Querying peer: ${c} (attempt ${this.queryAttempts.get(c)??1})`),await this.query(a);const et=this.queryAttempts.get(c)??1;if(et>d){this.abortQueriesForPeer(c);return}setTimeout(()=>{this.queryAttempts.set(c,et+1),this.startRecurringQueries(a).catch(ft=>{log$f.error(`Error in startRecurringQueries: ${ft}`)})},h*et)});this.components=a,this.peerExchange=new WakuPeerExchange(a),this.options=c,this.isStarted=!1}start(){this.isStarted||(log$f.info("Starting peer exchange node discovery, discovering peers"),this.components.events.addEventListener("peer:identify",this.handleDiscoveredPeer))}stop(){this.isStarted&&(log$f.info("Stopping peer exchange node discovery"),this.isStarted=!1,this.queryingPeers.clear(),this.components.events.removeEventListener("peer:identify",this.handleDiscoveredPeer))}get[peerDiscovery](){return!0}get[Symbol.toStringTag](){return"@waku/peer-exchange"}async query(a){const c=await this.peerExchange.query({numPeers:DEFAULT_PEER_EXCHANGE_REQUEST_NODES,peerId:a});if(!c){log$f.error("Peer exchange query failed, no peer info returned");return}for(const h of c){const{ENR:d}=h;if(!d){log$f.warn("No ENR in peerInfo object, skipping");continue}const{peerId:et,peerInfo:ft,shardInfo:gt}=d;!et||!ft||await this.components.peerStore.has(et)||(await this.components.peerStore.save(et,{tags:{[DEFAULT_PEER_EXCHANGE_TAG_NAME]:{value:this.options.tagValue??DEFAULT_PEER_EXCHANGE_TAG_VALUE,ttl:this.options.tagTTL??DEFAULT_PEER_EXCHANGE_TAG_TTL}},...gt&&{metadata:{shardInfo:encodeRelayShard(gt)}}}),log$f.info(`Discovered peer: ${et.toString()}`),this.dispatchEvent(new CustomEvent("peer",{detail:{id:et,protocols:[],multiaddrs:ft.multiaddrs}})))}}abortQueriesForPeer(a){log$f.info(`Aborting queries for peer: ${a}`),this.queryingPeers.delete(a),this.queryAttempts.delete(a)}}function wakuPeerExchangeDiscovery(){return i=>new PeerExchangeDiscovery(i)}const StrictSign="StrictSign",StrictNoSign="StrictNoSign";var TopicValidatorResult;(function(i){i.Accept="accept",i.Ignore="ignore",i.Reject="reject"})(TopicValidatorResult||(TopicValidatorResult={}));const second=1e3,minute=60*second,FloodsubID="/floodsub/1.0.0",GossipsubIDv10="/meshsub/1.0.0",GossipsubIDv11="/meshsub/1.1.0",GossipsubD=6,GossipsubDlo=4,GossipsubDhi=12,GossipsubDscore=4,GossipsubDout=2,GossipsubHistoryLength=5,GossipsubHistoryGossip=3,GossipsubDlazy=6,GossipsubGossipFactor=.25,GossipsubGossipRetransmission=3,GossipsubHeartbeatInitialDelay=100,GossipsubHeartbeatInterval=second,GossipsubFanoutTTL=minute,GossipsubPrunePeers=16,GossipsubPruneBackoff=minute,GossipsubUnsubscribeBackoff=10*second,GossipsubPruneBackoffTicks=15,GossipsubDirectConnectTicks=300,GossipsubDirectConnectInitialDelay=second,GossipsubOpportunisticGraftTicks=60,GossipsubOpportunisticGraftPeers=2,GossipsubGraftFloodThreshold=10*second,GossipsubMaxIHaveLength=5e3,GossipsubMaxIHaveMessages=10,GossipsubIWantFollowupTime=3*second,GossipsubSeenTTL=2*minute,TimeCacheDuration=120*1e3,ERR_TOPIC_VALIDATOR_REJECT="ERR_TOPIC_VALIDATOR_REJECT",ERR_TOPIC_VALIDATOR_IGNORE="ERR_TOPIC_VALIDATOR_IGNORE",ACCEPT_FROM_WHITELIST_THRESHOLD_SCORE=0,ACCEPT_FROM_WHITELIST_MAX_MESSAGES=128,ACCEPT_FROM_WHITELIST_DURATION_MS=1e3,DEFAULT_METRIC_MESH_MESSAGE_DELIVERIES_WINDOWS=1e3,BACKOFF_SLACK=1;var indexMinimal={},minimal$1={},aspromise,hasRequiredAspromise;function requireAspromise(){if(hasRequiredAspromise)return aspromise;hasRequiredAspromise=1,aspromise=i;function i(e,a){for(var c=new Array(arguments.length-1),h=0,d=2,et=!0;d<arguments.length;)c[h++]=arguments[d++];return new Promise(function(gt,_t){c[h]=function($t){if(et)if(et=!1,$t)_t($t);else{for(var It=new Array(arguments.length-1),Rt=0;Rt<It.length;)It[Rt++]=arguments[Rt];gt.apply(null,It)}};try{e.apply(a||null,c)}catch(wt){et&&(et=!1,_t(wt))}})}return aspromise}var base64$5={},hasRequiredBase64;function requireBase64(){return hasRequiredBase64||(hasRequiredBase64=1,function(i){var e=i;e.length=function(ft){var gt=ft.length;if(!gt)return 0;for(var _t=0;--gt%4>1&&ft.charAt(gt)==="=";)++_t;return Math.ceil(ft.length*3)/4-_t};for(var a=new Array(64),c=new Array(123),h=0;h<64;)c[a[h]=h<26?h+65:h<52?h+71:h<62?h-4:h-59|43]=h++;e.encode=function(ft,gt,_t){for(var wt=null,$t=[],It=0,Rt=0,Tt;gt<_t;){var At=ft[gt++];switch(Rt){case 0:$t[It++]=a[At>>2],Tt=(At&3)<<4,Rt=1;break;case 1:$t[It++]=a[Tt|At>>4],Tt=(At&15)<<2,Rt=2;break;case 2:$t[It++]=a[Tt|At>>6],$t[It++]=a[At&63],Rt=0;break}It>8191&&((wt||(wt=[])).push(String.fromCharCode.apply(String,$t)),It=0)}return Rt&&($t[It++]=a[Tt],$t[It++]=61,Rt===1&&($t[It++]=61)),wt?(It&&wt.push(String.fromCharCode.apply(String,$t.slice(0,It))),wt.join("")):String.fromCharCode.apply(String,$t.slice(0,It))};var d="invalid encoding";e.decode=function(ft,gt,_t){for(var wt=_t,$t=0,It,Rt=0;Rt<ft.length;){var Tt=ft.charCodeAt(Rt++);if(Tt===61&&$t>1)break;if((Tt=c[Tt])===void 0)throw Error(d);switch($t){case 0:It=Tt,$t=1;break;case 1:gt[_t++]=It<<2|(Tt&48)>>4,It=Tt,$t=2;break;case 2:gt[_t++]=(It&15)<<4|(Tt&60)>>2,It=Tt,$t=3;break;case 3:gt[_t++]=(It&3)<<6|Tt,$t=0;break}}if($t===1)throw Error(d);return _t-wt},e.test=function(ft){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(ft)}}(base64$5)),base64$5}var eventemitter,hasRequiredEventemitter;function requireEventemitter(){if(hasRequiredEventemitter)return eventemitter;hasRequiredEventemitter=1,eventemitter=i;function i(){this._listeners={}}return i.prototype.on=function(a,c,h){return(this._listeners[a]||(this._listeners[a]=[])).push({fn:c,ctx:h||this}),this},i.prototype.off=function(a,c){if(a===void 0)this._listeners={};else if(c===void 0)this._listeners[a]=[];else for(var h=this._listeners[a],d=0;d<h.length;)h[d].fn===c?h.splice(d,1):++d;return this},i.prototype.emit=function(a){var c=this._listeners[a];if(c){for(var h=[],d=1;d<arguments.length;)h.push(arguments[d++]);for(d=0;d<c.length;)c[d].fn.apply(c[d++].ctx,h)}return this},eventemitter}var float,hasRequiredFloat;function requireFloat(){if(hasRequiredFloat)return float;hasRequiredFloat=1,float=i(i);function i(d){return typeof Float32Array<"u"?function(){var et=new Float32Array([-0]),ft=new Uint8Array(et.buffer),gt=ft[3]===128;function _t(Rt,Tt,At){et[0]=Rt,Tt[At]=ft[0],Tt[At+1]=ft[1],Tt[At+2]=ft[2],Tt[At+3]=ft[3]}function wt(Rt,Tt,At){et[0]=Rt,Tt[At]=ft[3],Tt[At+1]=ft[2],Tt[At+2]=ft[1],Tt[At+3]=ft[0]}d.writeFloatLE=gt?_t:wt,d.writeFloatBE=gt?wt:_t;function $t(Rt,Tt){return ft[0]=Rt[Tt],ft[1]=Rt[Tt+1],ft[2]=Rt[Tt+2],ft[3]=Rt[Tt+3],et[0]}function It(Rt,Tt){return ft[3]=Rt[Tt],ft[2]=Rt[Tt+1],ft[1]=Rt[Tt+2],ft[0]=Rt[Tt+3],et[0]}d.readFloatLE=gt?$t:It,d.readFloatBE=gt?It:$t}():function(){function et(gt,_t,wt,$t){var It=_t<0?1:0;if(It&&(_t=-_t),_t===0)gt(1/_t>0?0:2147483648,wt,$t);else if(isNaN(_t))gt(2143289344,wt,$t);else if(_t>34028234663852886e22)gt((It<<31|2139095040)>>>0,wt,$t);else if(_t<11754943508222875e-54)gt((It<<31|Math.round(_t/1401298464324817e-60))>>>0,wt,$t);else{var Rt=Math.floor(Math.log(_t)/Math.LN2),Tt=Math.round(_t*Math.pow(2,-Rt)*8388608)&8388607;gt((It<<31|Rt+127<<23|Tt)>>>0,wt,$t)}}d.writeFloatLE=et.bind(null,e),d.writeFloatBE=et.bind(null,a);function ft(gt,_t,wt){var $t=gt(_t,wt),It=($t>>31)*2+1,Rt=$t>>>23&255,Tt=$t&8388607;return Rt===255?Tt?NaN:It*(1/0):Rt===0?It*1401298464324817e-60*Tt:It*Math.pow(2,Rt-150)*(Tt+8388608)}d.readFloatLE=ft.bind(null,c),d.readFloatBE=ft.bind(null,h)}(),typeof Float64Array<"u"?function(){var et=new Float64Array([-0]),ft=new Uint8Array(et.buffer),gt=ft[7]===128;function _t(Rt,Tt,At){et[0]=Rt,Tt[At]=ft[0],Tt[At+1]=ft[1],Tt[At+2]=ft[2],Tt[At+3]=ft[3],Tt[At+4]=ft[4],Tt[At+5]=ft[5],Tt[At+6]=ft[6],Tt[At+7]=ft[7]}function wt(Rt,Tt,At){et[0]=Rt,Tt[At]=ft[7],Tt[At+1]=ft[6],Tt[At+2]=ft[5],Tt[At+3]=ft[4],Tt[At+4]=ft[3],Tt[At+5]=ft[2],Tt[At+6]=ft[1],Tt[At+7]=ft[0]}d.writeDoubleLE=gt?_t:wt,d.writeDoubleBE=gt?wt:_t;function $t(Rt,Tt){return ft[0]=Rt[Tt],ft[1]=Rt[Tt+1],ft[2]=Rt[Tt+2],ft[3]=Rt[Tt+3],ft[4]=Rt[Tt+4],ft[5]=Rt[Tt+5],ft[6]=Rt[Tt+6],ft[7]=Rt[Tt+7],et[0]}function It(Rt,Tt){return ft[7]=Rt[Tt],ft[6]=Rt[Tt+1],ft[5]=Rt[Tt+2],ft[4]=Rt[Tt+3],ft[3]=Rt[Tt+4],ft[2]=Rt[Tt+5],ft[1]=Rt[Tt+6],ft[0]=Rt[Tt+7],et[0]}d.readDoubleLE=gt?$t:It,d.readDoubleBE=gt?It:$t}():function(){function et(gt,_t,wt,$t,It,Rt){var Tt=$t<0?1:0;if(Tt&&($t=-$t),$t===0)gt(0,It,Rt+_t),gt(1/$t>0?0:2147483648,It,Rt+wt);else if(isNaN($t))gt(0,It,Rt+_t),gt(2146959360,It,Rt+wt);else if($t>17976931348623157e292)gt(0,It,Rt+_t),gt((Tt<<31|2146435072)>>>0,It,Rt+wt);else{var At;if($t<22250738585072014e-324)At=$t/5e-324,gt(At>>>0,It,Rt+_t),gt((Tt<<31|At/4294967296)>>>0,It,Rt+wt);else{var kt=Math.floor(Math.log($t)/Math.LN2);kt===1024&&(kt=1023),At=$t*Math.pow(2,-kt),gt(At*4503599627370496>>>0,It,Rt+_t),gt((Tt<<31|kt+1023<<20|At*1048576&1048575)>>>0,It,Rt+wt)}}}d.writeDoubleLE=et.bind(null,e,0,4),d.writeDoubleBE=et.bind(null,a,4,0);function ft(gt,_t,wt,$t,It){var Rt=gt($t,It+_t),Tt=gt($t,It+wt),At=(Tt>>31)*2+1,kt=Tt>>>20&2047,xt=4294967296*(Tt&1048575)+Rt;return kt===2047?xt?NaN:At*(1/0):kt===0?At*5e-324*xt:At*Math.pow(2,kt-1075)*(xt+4503599627370496)}d.readDoubleLE=ft.bind(null,c,0,4),d.readDoubleBE=ft.bind(null,h,4,0)}(),d}function e(d,et,ft){et[ft]=d&255,et[ft+1]=d>>>8&255,et[ft+2]=d>>>16&255,et[ft+3]=d>>>24}function a(d,et,ft){et[ft]=d>>>24,et[ft+1]=d>>>16&255,et[ft+2]=d>>>8&255,et[ft+3]=d&255}function c(d,et){return(d[et]|d[et+1]<<8|d[et+2]<<16|d[et+3]<<24)>>>0}function h(d,et){return(d[et]<<24|d[et+1]<<16|d[et+2]<<8|d[et+3])>>>0}return float}var inquire_1,hasRequiredInquire;function requireInquire(){if(hasRequiredInquire)return inquire_1;hasRequiredInquire=1,inquire_1=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(i){}return null}return inquire_1}var utf8={},hasRequiredUtf8;function requireUtf8(){return hasRequiredUtf8||(hasRequiredUtf8=1,function(i){var e=i;e.length=function(c){for(var h=0,d=0,et=0;et<c.length;++et)d=c.charCodeAt(et),d<128?h+=1:d<2048?h+=2:(d&64512)===55296&&(c.charCodeAt(et+1)&64512)===56320?(++et,h+=4):h+=3;return h},e.read=function(c,h,d){var et=d-h;if(et<1)return"";for(var ft=null,gt=[],_t=0,wt;h<d;)wt=c[h++],wt<128?gt[_t++]=wt:wt>191&&wt<224?gt[_t++]=(wt&31)<<6|c[h++]&63:wt>239&&wt<365?(wt=((wt&7)<<18|(c[h++]&63)<<12|(c[h++]&63)<<6|c[h++]&63)-65536,gt[_t++]=55296+(wt>>10),gt[_t++]=56320+(wt&1023)):gt[_t++]=(wt&15)<<12|(c[h++]&63)<<6|c[h++]&63,_t>8191&&((ft||(ft=[])).push(String.fromCharCode.apply(String,gt)),_t=0);return ft?(_t&&ft.push(String.fromCharCode.apply(String,gt.slice(0,_t))),ft.join("")):String.fromCharCode.apply(String,gt.slice(0,_t))},e.write=function(c,h,d){for(var et=d,ft,gt,_t=0;_t<c.length;++_t)ft=c.charCodeAt(_t),ft<128?h[d++]=ft:ft<2048?(h[d++]=ft>>6|192,h[d++]=ft&63|128):(ft&64512)===55296&&((gt=c.charCodeAt(_t+1))&64512)===56320?(ft=65536+((ft&1023)<<10)+(gt&1023),++_t,h[d++]=ft>>18|240,h[d++]=ft>>12&63|128,h[d++]=ft>>6&63|128,h[d++]=ft&63|128):(h[d++]=ft>>12|224,h[d++]=ft>>6&63|128,h[d++]=ft&63|128);return d-et}}(utf8)),utf8}var pool_1,hasRequiredPool;function requirePool(){if(hasRequiredPool)return pool_1;hasRequiredPool=1,pool_1=i;function i(e,a,c){var h=c||8192,d=h>>>1,et=null,ft=h;return function(_t){if(_t<1||_t>d)return e(_t);ft+_t>h&&(et=e(h),ft=0);var wt=a.call(et,ft,ft+=_t);return ft&7&&(ft=(ft|7)+1),wt}}return pool_1}var longbits,hasRequiredLongbits;function requireLongbits(){if(hasRequiredLongbits)return longbits;hasRequiredLongbits=1,longbits=e;var i=requireMinimal$1();function e(d,et){this.lo=d>>>0,this.hi=et>>>0}var a=e.zero=new e(0,0);a.toNumber=function(){return 0},a.zzEncode=a.zzDecode=function(){return this},a.length=function(){return 1};var c=e.zeroHash="\0\0\0\0\0\0\0\0";e.fromNumber=function(et){if(et===0)return a;var ft=et<0;ft&&(et=-et);var gt=et>>>0,_t=(et-gt)/4294967296>>>0;return ft&&(_t=~_t>>>0,gt=~gt>>>0,++gt>4294967295&&(gt=0,++_t>4294967295&&(_t=0))),new e(gt,_t)},e.from=function(et){if(typeof et=="number")return e.fromNumber(et);if(i.isString(et))if(i.Long)et=i.Long.fromString(et);else return e.fromNumber(parseInt(et,10));return et.low||et.high?new e(et.low>>>0,et.high>>>0):a},e.prototype.toNumber=function(et){if(!et&&this.hi>>>31){var ft=~this.lo+1>>>0,gt=~this.hi>>>0;return ft||(gt=gt+1>>>0),-(ft+gt*4294967296)}return this.lo+this.hi*4294967296},e.prototype.toLong=function(et){return i.Long?new i.Long(this.lo|0,this.hi|0,!!et):{low:this.lo|0,high:this.hi|0,unsigned:!!et}};var h=String.prototype.charCodeAt;return e.fromHash=function(et){return et===c?a:new e((h.call(et,0)|h.call(et,1)<<8|h.call(et,2)<<16|h.call(et,3)<<24)>>>0,(h.call(et,4)|h.call(et,5)<<8|h.call(et,6)<<16|h.call(et,7)<<24)>>>0)},e.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},e.prototype.zzEncode=function(){var et=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^et)>>>0,this.lo=(this.lo<<1^et)>>>0,this},e.prototype.zzDecode=function(){var et=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^et)>>>0,this.hi=(this.hi>>>1^et)>>>0,this},e.prototype.length=function(){var et=this.lo,ft=(this.lo>>>28|this.hi<<4)>>>0,gt=this.hi>>>24;return gt===0?ft===0?et<16384?et<128?1:2:et<2097152?3:4:ft<16384?ft<128?5:6:ft<2097152?7:8:gt<128?9:10},longbits}var hasRequiredMinimal$1;function requireMinimal$1(){return hasRequiredMinimal$1||(hasRequiredMinimal$1=1,function(i){var e=i;e.asPromise=requireAspromise(),e.base64=requireBase64(),e.EventEmitter=requireEventemitter(),e.float=requireFloat(),e.inquire=requireInquire(),e.utf8=requireUtf8(),e.pool=requirePool(),e.LongBits=requireLongbits(),e.isNode=!!(typeof commonjsGlobal<"u"&&commonjsGlobal&&commonjsGlobal.process&&commonjsGlobal.process.versions&&commonjsGlobal.process.versions.node),e.global=e.isNode&&commonjsGlobal||typeof window<"u"&&window||typeof self<"u"&&self||commonjsGlobal,e.emptyArray=Object.freeze?Object.freeze([]):[],e.emptyObject=Object.freeze?Object.freeze({}):{},e.isInteger=Number.isInteger||function(d){return typeof d=="number"&&isFinite(d)&&Math.floor(d)===d},e.isString=function(d){return typeof d=="string"||d instanceof String},e.isObject=function(d){return d&&typeof d=="object"},e.isset=e.isSet=function(d,et){var ft=d[et];return ft!=null&&d.hasOwnProperty(et)?typeof ft!="object"||(Array.isArray(ft)?ft.length:Object.keys(ft).length)>0:!1},e.Buffer=function(){try{var h=e.inquire("buffer").Buffer;return h.prototype.utf8Write?h:null}catch{return null}}(),e._Buffer_from=null,e._Buffer_allocUnsafe=null,e.newBuffer=function(d){return typeof d=="number"?e.Buffer?e._Buffer_allocUnsafe(d):new e.Array(d):e.Buffer?e._Buffer_from(d):typeof Uint8Array>"u"?d:new Uint8Array(d)},e.Array=typeof Uint8Array<"u"?Uint8Array:Array,e.Long=e.global.dcodeIO&&e.global.dcodeIO.Long||e.global.Long||e.inquire("long"),e.key2Re=/^true|false|0|1$/,e.key32Re=/^-?(?:0|[1-9][0-9]*)$/,e.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,e.longToHash=function(d){return d?e.LongBits.from(d).toHash():e.LongBits.zeroHash},e.longFromHash=function(d,et){var ft=e.LongBits.fromHash(d);return e.Long?e.Long.fromBits(ft.lo,ft.hi,et):ft.toNumber(!!et)};function a(h,d,et){for(var ft=Object.keys(d),gt=0;gt<ft.length;++gt)(h[ft[gt]]===void 0||!et)&&(h[ft[gt]]=d[ft[gt]]);return h}e.merge=a,e.lcFirst=function(d){return d.charAt(0).toLowerCase()+d.substring(1)};function c(h){function d(et,ft){if(!(this instanceof d))return new d(et,ft);Object.defineProperty(this,"message",{get:function(){return et}}),Error.captureStackTrace?Error.captureStackTrace(this,d):Object.defineProperty(this,"stack",{value:new Error().stack||""}),ft&&a(this,ft)}return d.prototype=Object.create(Error.prototype,{constructor:{value:d,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return h},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),d}e.newError=c,e.ProtocolError=c("ProtocolError"),e.oneOfGetter=function(d){for(var et={},ft=0;ft<d.length;++ft)et[d[ft]]=1;return function(){for(var gt=Object.keys(this),_t=gt.length-1;_t>-1;--_t)if(et[gt[_t]]===1&&this[gt[_t]]!==void 0&&this[gt[_t]]!==null)return gt[_t]}},e.oneOfSetter=function(d){return function(et){for(var ft=0;ft<d.length;++ft)d[ft]!==et&&delete this[d[ft]]}},e.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},e._configure=function(){var h=e.Buffer;if(!h){e._Buffer_from=e._Buffer_allocUnsafe=null;return}e._Buffer_from=h.from!==Uint8Array.from&&h.from||function(et,ft){return new h(et,ft)},e._Buffer_allocUnsafe=h.allocUnsafe||function(et){return new h(et)}}}(minimal$1)),minimal$1}var writer,hasRequiredWriter;function requireWriter(){if(hasRequiredWriter)return writer;hasRequiredWriter=1,writer=gt;var i=requireMinimal$1(),e,a=i.LongBits,c=i.base64,h=i.utf8;function d(kt,xt,Nt){this.fn=kt,this.len=xt,this.next=void 0,this.val=Nt}function et(){}function ft(kt){this.head=kt.head,this.tail=kt.tail,this.len=kt.len,this.next=kt.states}function gt(){this.len=0,this.head=new d(et,0,0),this.tail=this.head,this.states=null}var _t=function(){return i.Buffer?function(){return(gt.create=function(){return new e})()}:function(){return new gt}};gt.create=_t(),gt.alloc=function(xt){return new i.Array(xt)},i.Array!==Array&&(gt.alloc=i.pool(gt.alloc,i.Array.prototype.subarray)),gt.prototype._push=function(xt,Nt,Ft){return this.tail=this.tail.next=new d(xt,Nt,Ft),this.len+=Nt,this};function wt(kt,xt,Nt){xt[Nt]=kt&255}function $t(kt,xt,Nt){for(;kt>127;)xt[Nt++]=kt&127|128,kt>>>=7;xt[Nt]=kt}function It(kt,xt){this.len=kt,this.next=void 0,this.val=xt}It.prototype=Object.create(d.prototype),It.prototype.fn=$t,gt.prototype.uint32=function(xt){return this.len+=(this.tail=this.tail.next=new It((xt=xt>>>0)<128?1:xt<16384?2:xt<2097152?3:xt<268435456?4:5,xt)).len,this},gt.prototype.int32=function(xt){return xt<0?this._push(Rt,10,a.fromNumber(xt)):this.uint32(xt)},gt.prototype.sint32=function(xt){return this.uint32((xt<<1^xt>>31)>>>0)};function Rt(kt,xt,Nt){for(;kt.hi;)xt[Nt++]=kt.lo&127|128,kt.lo=(kt.lo>>>7|kt.hi<<25)>>>0,kt.hi>>>=7;for(;kt.lo>127;)xt[Nt++]=kt.lo&127|128,kt.lo=kt.lo>>>7;xt[Nt++]=kt.lo}gt.prototype.uint64=function(xt){var Nt=a.from(xt);return this._push(Rt,Nt.length(),Nt)},gt.prototype.int64=gt.prototype.uint64,gt.prototype.sint64=function(xt){var Nt=a.from(xt).zzEncode();return this._push(Rt,Nt.length(),Nt)},gt.prototype.bool=function(xt){return this._push(wt,1,xt?1:0)};function Tt(kt,xt,Nt){xt[Nt]=kt&255,xt[Nt+1]=kt>>>8&255,xt[Nt+2]=kt>>>16&255,xt[Nt+3]=kt>>>24}gt.prototype.fixed32=function(xt){return this._push(Tt,4,xt>>>0)},gt.prototype.sfixed32=gt.prototype.fixed32,gt.prototype.fixed64=function(xt){var Nt=a.from(xt);return this._push(Tt,4,Nt.lo)._push(Tt,4,Nt.hi)},gt.prototype.sfixed64=gt.prototype.fixed64,gt.prototype.float=function(xt){return this._push(i.float.writeFloatLE,4,xt)},gt.prototype.double=function(xt){return this._push(i.float.writeDoubleLE,8,xt)};var At=i.Array.prototype.set?function(xt,Nt,Ft){Nt.set(xt,Ft)}:function(xt,Nt,Ft){for(var jt=0;jt<xt.length;++jt)Nt[Ft+jt]=xt[jt]};return gt.prototype.bytes=function(xt){var Nt=xt.length>>>0;if(!Nt)return this._push(wt,1,0);if(i.isString(xt)){var Ft=gt.alloc(Nt=c.length(xt));c.decode(xt,Ft,0),xt=Ft}return this.uint32(Nt)._push(At,Nt,xt)},gt.prototype.string=function(xt){var Nt=h.length(xt);return Nt?this.uint32(Nt)._push(h.write,Nt,xt):this._push(wt,1,0)},gt.prototype.fork=function(){return this.states=new ft(this),this.head=this.tail=new d(et,0,0),this.len=0,this},gt.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new d(et,0,0),this.len=0),this},gt.prototype.ldelim=function(){var xt=this.head,Nt=this.tail,Ft=this.len;return this.reset().uint32(Ft),Ft&&(this.tail.next=xt.next,this.tail=Nt,this.len+=Ft),this},gt.prototype.finish=function(){for(var xt=this.head.next,Nt=this.constructor.alloc(this.len),Ft=0;xt;)xt.fn(xt.val,Nt,Ft),Ft+=xt.len,xt=xt.next;return Nt},gt._configure=function(kt){e=kt,gt.create=_t(),e._configure()},writer}var writer_buffer,hasRequiredWriter_buffer;function requireWriter_buffer(){if(hasRequiredWriter_buffer)return writer_buffer;hasRequiredWriter_buffer=1,writer_buffer=a;var i=requireWriter();(a.prototype=Object.create(i.prototype)).constructor=a;var e=requireMinimal$1();function a(){i.call(this)}a._configure=function(){a.alloc=e._Buffer_allocUnsafe,a.writeBytesBuffer=e.Buffer&&e.Buffer.prototype instanceof Uint8Array&&e.Buffer.prototype.set.name==="set"?function(d,et,ft){et.set(d,ft)}:function(d,et,ft){if(d.copy)d.copy(et,ft,0,d.length);else for(var gt=0;gt<d.length;)et[ft++]=d[gt++]}},a.prototype.bytes=function(d){e.isString(d)&&(d=e._Buffer_from(d,"base64"));var et=d.length>>>0;return this.uint32(et),et&&this._push(a.writeBytesBuffer,et,d),this};function c(h,d,et){h.length<40?e.utf8.write(h,d,et):d.utf8Write?d.utf8Write(h,et):d.write(h,et)}return a.prototype.string=function(d){var et=e.Buffer.byteLength(d);return this.uint32(et),et&&this._push(c,et,d),this},a._configure(),writer_buffer}var reader$1,hasRequiredReader;function requireReader(){if(hasRequiredReader)return reader$1;hasRequiredReader=1,reader$1=d;var i=requireMinimal$1(),e,a=i.LongBits,c=i.utf8;function h($t,It){return RangeError("index out of range: "+$t.pos+" + "+(It||1)+" > "+$t.len)}function d($t){this.buf=$t,this.pos=0,this.len=$t.length}var et=typeof Uint8Array<"u"?function(It){if(It instanceof Uint8Array||Array.isArray(It))return new d(It);throw Error("illegal buffer")}:function(It){if(Array.isArray(It))return new d(It);throw Error("illegal buffer")},ft=function(){return i.Buffer?function(Rt){return(d.create=function(At){return i.Buffer.isBuffer(At)?new e(At):et(At)})(Rt)}:et};d.create=ft(),d.prototype._slice=i.Array.prototype.subarray||i.Array.prototype.slice,d.prototype.uint32=function(){var It=4294967295;return function(){if(It=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(It=(It|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(It=(It|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(It=(It|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(It=(It|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return It;if((this.pos+=5)>this.len)throw this.pos=this.len,h(this,10);return It}}(),d.prototype.int32=function(){return this.uint32()|0},d.prototype.sint32=function(){var It=this.uint32();return It>>>1^-(It&1)|0};function gt(){var $t=new a(0,0),It=0;if(this.len-this.pos>4){for(;It<4;++It)if($t.lo=($t.lo|(this.buf[this.pos]&127)<<It*7)>>>0,this.buf[this.pos++]<128)return $t;if($t.lo=($t.lo|(this.buf[this.pos]&127)<<28)>>>0,$t.hi=($t.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return $t;It=0}else{for(;It<3;++It){if(this.pos>=this.len)throw h(this);if($t.lo=($t.lo|(this.buf[this.pos]&127)<<It*7)>>>0,this.buf[this.pos++]<128)return $t}return $t.lo=($t.lo|(this.buf[this.pos++]&127)<<It*7)>>>0,$t}if(this.len-this.pos>4){for(;It<5;++It)if($t.hi=($t.hi|(this.buf[this.pos]&127)<<It*7+3)>>>0,this.buf[this.pos++]<128)return $t}else for(;It<5;++It){if(this.pos>=this.len)throw h(this);if($t.hi=($t.hi|(this.buf[this.pos]&127)<<It*7+3)>>>0,this.buf[this.pos++]<128)return $t}throw Error("invalid varint encoding")}d.prototype.bool=function(){return this.uint32()!==0};function _t($t,It){return($t[It-4]|$t[It-3]<<8|$t[It-2]<<16|$t[It-1]<<24)>>>0}d.prototype.fixed32=function(){if(this.pos+4>this.len)throw h(this,4);return _t(this.buf,this.pos+=4)},d.prototype.sfixed32=function(){if(this.pos+4>this.len)throw h(this,4);return _t(this.buf,this.pos+=4)|0};function wt(){if(this.pos+8>this.len)throw h(this,8);return new a(_t(this.buf,this.pos+=4),_t(this.buf,this.pos+=4))}return d.prototype.float=function(){if(this.pos+4>this.len)throw h(this,4);var It=i.float.readFloatLE(this.buf,this.pos);return this.pos+=4,It},d.prototype.double=function(){if(this.pos+8>this.len)throw h(this,4);var It=i.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,It},d.prototype.bytes=function(){var It=this.uint32(),Rt=this.pos,Tt=this.pos+It;if(Tt>this.len)throw h(this,It);if(this.pos+=It,Array.isArray(this.buf))return this.buf.slice(Rt,Tt);if(Rt===Tt){var At=i.Buffer;return At?At.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,Rt,Tt)},d.prototype.string=function(){var It=this.bytes();return c.read(It,0,It.length)},d.prototype.skip=function(It){if(typeof It=="number"){if(this.pos+It>this.len)throw h(this,It);this.pos+=It}else do if(this.pos>=this.len)throw h(this);while(this.buf[this.pos++]&128);return this},d.prototype.skipType=function($t){switch($t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;($t=this.uint32()&7)!==4;)this.skipType($t);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+$t+" at offset "+this.pos)}return this},d._configure=function($t){e=$t,d.create=ft(),e._configure();var It=i.Long?"toLong":"toNumber";i.merge(d.prototype,{int64:function(){return gt.call(this)[It](!1)},uint64:function(){return gt.call(this)[It](!0)},sint64:function(){return gt.call(this).zzDecode()[It](!1)},fixed64:function(){return wt.call(this)[It](!0)},sfixed64:function(){return wt.call(this)[It](!1)}})},reader$1}var reader_buffer,hasRequiredReader_buffer;function requireReader_buffer(){if(hasRequiredReader_buffer)return reader_buffer;hasRequiredReader_buffer=1,reader_buffer=a;var i=requireReader();(a.prototype=Object.create(i.prototype)).constructor=a;var e=requireMinimal$1();function a(c){i.call(this,c)}return a._configure=function(){e.Buffer&&(a.prototype._slice=e.Buffer.prototype.slice)},a.prototype.string=function(){var h=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+h,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+h,this.len))},a._configure(),reader_buffer}var rpc$1={},service,hasRequiredService;function requireService(){if(hasRequiredService)return service;hasRequiredService=1,service=e;var i=requireMinimal$1();(e.prototype=Object.create(i.EventEmitter.prototype)).constructor=e;function e(a,c,h){if(typeof a!="function")throw TypeError("rpcImpl must be a function");i.EventEmitter.call(this),this.rpcImpl=a,this.requestDelimited=!!c,this.responseDelimited=!!h}return e.prototype.rpcCall=function a(c,h,d,et,ft){if(!et)throw TypeError("request must be specified");var gt=this;if(!ft)return i.asPromise(a,gt,c,h,d,et);if(!gt.rpcImpl){setTimeout(function(){ft(Error("already ended"))},0);return}try{return gt.rpcImpl(c,h[gt.requestDelimited?"encodeDelimited":"encode"](et).finish(),function(wt,$t){if(wt)return gt.emit("error",wt,c),ft(wt);if($t===null){gt.end(!0);return}if(!($t instanceof d))try{$t=d[gt.responseDelimited?"decodeDelimited":"decode"]($t)}catch(It){return gt.emit("error",It,c),ft(It)}return gt.emit("data",$t,c),ft(null,$t)})}catch(_t){gt.emit("error",_t,c),setTimeout(function(){ft(_t)},0);return}},e.prototype.end=function(c){return this.rpcImpl&&(c||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this},service}var hasRequiredRpc;function requireRpc(){return hasRequiredRpc||(hasRequiredRpc=1,function(i){var e=i;e.Service=requireService()}(rpc$1)),rpc$1}var roots,hasRequiredRoots;function requireRoots(){return hasRequiredRoots||(hasRequiredRoots=1,roots={}),roots}var hasRequiredIndexMinimal;function requireIndexMinimal(){return hasRequiredIndexMinimal||(hasRequiredIndexMinimal=1,function(i){var e=i;e.build="minimal",e.Writer=requireWriter(),e.BufferWriter=requireWriter_buffer(),e.Reader=requireReader(),e.BufferReader=requireReader_buffer(),e.util=requireMinimal$1(),e.rpc=requireRpc(),e.roots=requireRoots(),e.configure=a;function a(){e.util._configure(),e.Writer._configure(e.BufferWriter),e.Reader._configure(e.BufferReader)}a()}(indexMinimal)),indexMinimal}var minimal,hasRequiredMinimal;function requireMinimal(){return hasRequiredMinimal||(hasRequiredMinimal=1,minimal=requireIndexMinimal()),minimal}var minimalExports=requireMinimal();const protobuf=getDefaultExportFromCjs(minimalExports),defaultDecodeRpcLimits={maxSubscriptions:1/0,maxMessages:1/0,maxIhaveMessageIDs:1/0,maxIwantMessageIDs:1/0,maxControlMessages:1/0,maxPeerInfos:1/0};function decodeRpc(i,e){e={...e};const a=protobuf.Reader.create(i),c=i.length,h=c===void 0?a.len:a.pos+c,d={};for(;a.pos<h;){const et=a.uint32();switch(et>>>3){case 1:d.subscriptions!=null&&d.subscriptions.length>0||(d.subscriptions=[]),d.subscriptions.length<e.maxSubscriptions?d.subscriptions.push(decodeSubOpts(a,a.uint32())):a.skipType(et&7);break;case 2:d.messages!=null&&d.messages.length>0||(d.messages=[]),d.messages.length<e.maxMessages?d.messages.push(decodeMessage(a,a.uint32())):a.skipType(et&7);break;case 3:d.control=decodeControlMessage(a,a.uint32(),e);break;default:a.skipType(et&7);break}}return d}function decodeSubOpts(i,e){const a=e===void 0?i.len:i.pos+e,c={};for(;i.pos<a;){const h=i.uint32();switch(h>>>3){case 1:c.subscribe=i.bool();break;case 2:c.topic=i.string();break;default:i.skipType(h&7);break}}return c}function decodeMessage(i,e){const a=e===void 0?i.len:i.pos+e,c={};for(;i.pos<a;){const h=i.uint32();switch(h>>>3){case 1:c.from=i.bytes();break;case 2:c.data=i.bytes();break;case 3:c.seqno=i.bytes();break;case 4:c.topic=i.string();break;case 5:c.signature=i.bytes();break;case 6:c.key=i.bytes();break;default:i.skipType(h&7);break}}if(!c.topic)throw Error("missing required 'topic'");return c}function decodeControlMessage(i,e,a){const c=e===void 0?i.len:i.pos+e,h={};for(;i.pos<c;){const d=i.uint32();switch(d>>>3){case 1:h.ihave!=null&&h.ihave.length>0||(h.ihave=[]),h.ihave.length<a.maxControlMessages?h.ihave.push(decodeControlIHave(i,i.uint32(),a)):i.skipType(d&7);break;case 2:h.iwant!=null&&h.iwant.length>0||(h.iwant=[]),h.iwant.length<a.maxControlMessages?h.iwant.push(decodeControlIWant(i,i.uint32(),a)):i.skipType(d&7);break;case 3:h.graft!=null&&h.graft.length>0||(h.graft=[]),h.graft.length<a.maxControlMessages?h.graft.push(decodeControlGraft(i,i.uint32())):i.skipType(d&7);break;case 4:h.prune!=null&&h.prune.length>0||(h.prune=[]),h.prune.length<a.maxControlMessages?h.prune.push(decodeControlPrune(i,i.uint32(),a)):i.skipType(d&7);break;default:i.skipType(d&7);break}}return h}function decodeControlIHave(i,e,a){const c=e===void 0?i.len:i.pos+e,h={};for(;i.pos<c;){const d=i.uint32();switch(d>>>3){case 1:h.topicID=i.string();break;case 2:h.messageIDs!=null&&h.messageIDs.length>0||(h.messageIDs=[]),a.maxIhaveMessageIDs-- >0?h.messageIDs.push(i.bytes()):i.skipType(d&7);break;default:i.skipType(d&7);break}}return h}function decodeControlIWant(i,e,a){const c=e===void 0?i.len:i.pos+e,h={};for(;i.pos<c;){const d=i.uint32();switch(d>>>3){case 1:h.messageIDs!=null&&h.messageIDs.length>0||(h.messageIDs=[]),a.maxIwantMessageIDs-- >0?h.messageIDs.push(i.bytes()):i.skipType(d&7);break;default:i.skipType(d&7);break}}return h}function decodeControlGraft(i,e){const a=e===void 0?i.len:i.pos+e,c={};for(;i.pos<a;){const h=i.uint32();switch(h>>>3){case 1:c.topicID=i.string();break;default:i.skipType(h&7);break}}return c}function decodeControlPrune(i,e,a){const c=e===void 0?i.len:i.pos+e,h={};for(;i.pos<c;){const d=i.uint32();switch(d>>>3){case 1:h.topicID=i.string();break;case 2:h.peers!=null&&h.peers.length>0||(h.peers=[]),a.maxPeerInfos-- >0?h.peers.push(decodePeerInfo(i,i.uint32())):i.skipType(d&7);break;case 3:h.backoff=i.uint64();break;default:i.skipType(d&7);break}}return h}function decodePeerInfo(i,e){const a=e===void 0?i.len:i.pos+e,c={};for(;i.pos<a;){const h=i.uint32();switch(h>>>3){case 1:c.peerID=i.bytes();break;case 2:c.signedPeerRecord=i.bytes();break;default:i.skipType(h&7);break}}return c}function commonjsRequire(i){throw new Error('Could not dynamically require "'+i+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var rpc={exports:{}};(function(i){(function(e,a){typeof commonjsRequire=="function"&&i&&i.exports&&(i.exports=a(requireMinimal()))})(commonjsGlobal,function(e){var a=e.Reader,c=e.Writer,h=e.util,d=e.roots.default||(e.roots.default={});return d.RPC=function(){function et(gt){if(this.subscriptions=[],this.messages=[],gt)for(var _t=Object.keys(gt),wt=0;wt<_t.length;++wt)gt[_t[wt]]!=null&&(this[_t[wt]]=gt[_t[wt]])}et.prototype.subscriptions=h.emptyArray,et.prototype.messages=h.emptyArray,et.prototype.control=null;var ft;return Object.defineProperty(et.prototype,"_control",{get:h.oneOfGetter(ft=["control"]),set:h.oneOfSetter(ft)}),et.encode=function(_t,wt){if(wt||(wt=c.create()),_t.subscriptions!=null&&_t.subscriptions.length)for(var $t=0;$t<_t.subscriptions.length;++$t)d.RPC.SubOpts.encode(_t.subscriptions[$t],wt.uint32(10).fork()).ldelim();if(_t.messages!=null&&_t.messages.length)for(var $t=0;$t<_t.messages.length;++$t)d.RPC.Message.encode(_t.messages[$t],wt.uint32(18).fork()).ldelim();return _t.control!=null&&Object.hasOwnProperty.call(_t,"control")&&d.RPC.ControlMessage.encode(_t.control,wt.uint32(26).fork()).ldelim(),wt},et.decode=function(_t,wt){_t instanceof a||(_t=a.create(_t));for(var $t=wt===void 0?_t.len:_t.pos+wt,It=new d.RPC;_t.pos<$t;){var Rt=_t.uint32();switch(Rt>>>3){case 1:It.subscriptions&&It.subscriptions.length||(It.subscriptions=[]),It.subscriptions.push(d.RPC.SubOpts.decode(_t,_t.uint32()));break;case 2:It.messages&&It.messages.length||(It.messages=[]),It.messages.push(d.RPC.Message.decode(_t,_t.uint32()));break;case 3:It.control=d.RPC.ControlMessage.decode(_t,_t.uint32());break;default:_t.skipType(Rt&7);break}}return It},et.fromObject=function(_t){if(_t instanceof d.RPC)return _t;var wt=new d.RPC;if(_t.subscriptions){if(!Array.isArray(_t.subscriptions))throw TypeError(".RPC.subscriptions: array expected");wt.subscriptions=[];for(var $t=0;$t<_t.subscriptions.length;++$t){if(typeof _t.subscriptions[$t]!="object")throw TypeError(".RPC.subscriptions: object expected");wt.subscriptions[$t]=d.RPC.SubOpts.fromObject(_t.subscriptions[$t])}}if(_t.messages){if(!Array.isArray(_t.messages))throw TypeError(".RPC.messages: array expected");wt.messages=[];for(var $t=0;$t<_t.messages.length;++$t){if(typeof _t.messages[$t]!="object")throw TypeError(".RPC.messages: object expected");wt.messages[$t]=d.RPC.Message.fromObject(_t.messages[$t])}}if(_t.control!=null){if(typeof _t.control!="object")throw TypeError(".RPC.control: object expected");wt.control=d.RPC.ControlMessage.fromObject(_t.control)}return wt},et.toObject=function(_t,wt){wt||(wt={});var $t={};if((wt.arrays||wt.defaults)&&($t.subscriptions=[],$t.messages=[]),_t.subscriptions&&_t.subscriptions.length){$t.subscriptions=[];for(var It=0;It<_t.subscriptions.length;++It)$t.subscriptions[It]=d.RPC.SubOpts.toObject(_t.subscriptions[It],wt)}if(_t.messages&&_t.messages.length){$t.messages=[];for(var It=0;It<_t.messages.length;++It)$t.messages[It]=d.RPC.Message.toObject(_t.messages[It],wt)}return _t.control!=null&&_t.hasOwnProperty("control")&&($t.control=d.RPC.ControlMessage.toObject(_t.control,wt),wt.oneofs&&($t._control="control")),$t},et.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},et.SubOpts=function(){function gt(wt){if(wt)for(var $t=Object.keys(wt),It=0;It<$t.length;++It)wt[$t[It]]!=null&&(this[$t[It]]=wt[$t[It]])}gt.prototype.subscribe=null,gt.prototype.topic=null;var _t;return Object.defineProperty(gt.prototype,"_subscribe",{get:h.oneOfGetter(_t=["subscribe"]),set:h.oneOfSetter(_t)}),Object.defineProperty(gt.prototype,"_topic",{get:h.oneOfGetter(_t=["topic"]),set:h.oneOfSetter(_t)}),gt.encode=function($t,It){return It||(It=c.create()),$t.subscribe!=null&&Object.hasOwnProperty.call($t,"subscribe")&&It.uint32(8).bool($t.subscribe),$t.topic!=null&&Object.hasOwnProperty.call($t,"topic")&&It.uint32(18).string($t.topic),It},gt.decode=function($t,It){$t instanceof a||($t=a.create($t));for(var Rt=It===void 0?$t.len:$t.pos+It,Tt=new d.RPC.SubOpts;$t.pos<Rt;){var At=$t.uint32();switch(At>>>3){case 1:Tt.subscribe=$t.bool();break;case 2:Tt.topic=$t.string();break;default:$t.skipType(At&7);break}}return Tt},gt.fromObject=function($t){if($t instanceof d.RPC.SubOpts)return $t;var It=new d.RPC.SubOpts;return $t.subscribe!=null&&(It.subscribe=!!$t.subscribe),$t.topic!=null&&(It.topic=String($t.topic)),It},gt.toObject=function($t,It){It||(It={});var Rt={};return $t.subscribe!=null&&$t.hasOwnProperty("subscribe")&&(Rt.subscribe=$t.subscribe,It.oneofs&&(Rt._subscribe="subscribe")),$t.topic!=null&&$t.hasOwnProperty("topic")&&(Rt.topic=$t.topic,It.oneofs&&(Rt._topic="topic")),Rt},gt.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},gt}(),et.Message=function(){function gt(wt){if(wt)for(var $t=Object.keys(wt),It=0;It<$t.length;++It)wt[$t[It]]!=null&&(this[$t[It]]=wt[$t[It]])}gt.prototype.from=null,gt.prototype.data=null,gt.prototype.seqno=null,gt.prototype.topic="",gt.prototype.signature=null,gt.prototype.key=null;var _t;return Object.defineProperty(gt.prototype,"_from",{get:h.oneOfGetter(_t=["from"]),set:h.oneOfSetter(_t)}),Object.defineProperty(gt.prototype,"_data",{get:h.oneOfGetter(_t=["data"]),set:h.oneOfSetter(_t)}),Object.defineProperty(gt.prototype,"_seqno",{get:h.oneOfGetter(_t=["seqno"]),set:h.oneOfSetter(_t)}),Object.defineProperty(gt.prototype,"_signature",{get:h.oneOfGetter(_t=["signature"]),set:h.oneOfSetter(_t)}),Object.defineProperty(gt.prototype,"_key",{get:h.oneOfGetter(_t=["key"]),set:h.oneOfSetter(_t)}),gt.encode=function($t,It){return It||(It=c.create()),$t.from!=null&&Object.hasOwnProperty.call($t,"from")&&It.uint32(10).bytes($t.from),$t.data!=null&&Object.hasOwnProperty.call($t,"data")&&It.uint32(18).bytes($t.data),$t.seqno!=null&&Object.hasOwnProperty.call($t,"seqno")&&It.uint32(26).bytes($t.seqno),It.uint32(34).string($t.topic),$t.signature!=null&&Object.hasOwnProperty.call($t,"signature")&&It.uint32(42).bytes($t.signature),$t.key!=null&&Object.hasOwnProperty.call($t,"key")&&It.uint32(50).bytes($t.key),It},gt.decode=function($t,It){$t instanceof a||($t=a.create($t));for(var Rt=It===void 0?$t.len:$t.pos+It,Tt=new d.RPC.Message;$t.pos<Rt;){var At=$t.uint32();switch(At>>>3){case 1:Tt.from=$t.bytes();break;case 2:Tt.data=$t.bytes();break;case 3:Tt.seqno=$t.bytes();break;case 4:Tt.topic=$t.string();break;case 5:Tt.signature=$t.bytes();break;case 6:Tt.key=$t.bytes();break;default:$t.skipType(At&7);break}}if(!Tt.hasOwnProperty("topic"))throw h.ProtocolError("missing required 'topic'",{instance:Tt});return Tt},gt.fromObject=function($t){if($t instanceof d.RPC.Message)return $t;var It=new d.RPC.Message;return $t.from!=null&&(typeof $t.from=="string"?h.base64.decode($t.from,It.from=h.newBuffer(h.base64.length($t.from)),0):$t.from.length&&(It.from=$t.from)),$t.data!=null&&(typeof $t.data=="string"?h.base64.decode($t.data,It.data=h.newBuffer(h.base64.length($t.data)),0):$t.data.length&&(It.data=$t.data)),$t.seqno!=null&&(typeof $t.seqno=="string"?h.base64.decode($t.seqno,It.seqno=h.newBuffer(h.base64.length($t.seqno)),0):$t.seqno.length&&(It.seqno=$t.seqno)),$t.topic!=null&&(It.topic=String($t.topic)),$t.signature!=null&&(typeof $t.signature=="string"?h.base64.decode($t.signature,It.signature=h.newBuffer(h.base64.length($t.signature)),0):$t.signature.length&&(It.signature=$t.signature)),$t.key!=null&&(typeof $t.key=="string"?h.base64.decode($t.key,It.key=h.newBuffer(h.base64.length($t.key)),0):$t.key.length&&(It.key=$t.key)),It},gt.toObject=function($t,It){It||(It={});var Rt={};return It.defaults&&(Rt.topic=""),$t.from!=null&&$t.hasOwnProperty("from")&&(Rt.from=It.bytes===String?h.base64.encode($t.from,0,$t.from.length):It.bytes===Array?Array.prototype.slice.call($t.from):$t.from,It.oneofs&&(Rt._from="from")),$t.data!=null&&$t.hasOwnProperty("data")&&(Rt.data=It.bytes===String?h.base64.encode($t.data,0,$t.data.length):It.bytes===Array?Array.prototype.slice.call($t.data):$t.data,It.oneofs&&(Rt._data="data")),$t.seqno!=null&&$t.hasOwnProperty("seqno")&&(Rt.seqno=It.bytes===String?h.base64.encode($t.seqno,0,$t.seqno.length):It.bytes===Array?Array.prototype.slice.call($t.seqno):$t.seqno,It.oneofs&&(Rt._seqno="seqno")),$t.topic!=null&&$t.hasOwnProperty("topic")&&(Rt.topic=$t.topic),$t.signature!=null&&$t.hasOwnProperty("signature")&&(Rt.signature=It.bytes===String?h.base64.encode($t.signature,0,$t.signature.length):It.bytes===Array?Array.prototype.slice.call($t.signature):$t.signature,It.oneofs&&(Rt._signature="signature")),$t.key!=null&&$t.hasOwnProperty("key")&&(Rt.key=It.bytes===String?h.base64.encode($t.key,0,$t.key.length):It.bytes===Array?Array.prototype.slice.call($t.key):$t.key,It.oneofs&&(Rt._key="key")),Rt},gt.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},gt}(),et.ControlMessage=function(){function gt(_t){if(this.ihave=[],this.iwant=[],this.graft=[],this.prune=[],_t)for(var wt=Object.keys(_t),$t=0;$t<wt.length;++$t)_t[wt[$t]]!=null&&(this[wt[$t]]=_t[wt[$t]])}return gt.prototype.ihave=h.emptyArray,gt.prototype.iwant=h.emptyArray,gt.prototype.graft=h.emptyArray,gt.prototype.prune=h.emptyArray,gt.encode=function(wt,$t){if($t||($t=c.create()),wt.ihave!=null&&wt.ihave.length)for(var It=0;It<wt.ihave.length;++It)d.RPC.ControlIHave.encode(wt.ihave[It],$t.uint32(10).fork()).ldelim();if(wt.iwant!=null&&wt.iwant.length)for(var It=0;It<wt.iwant.length;++It)d.RPC.ControlIWant.encode(wt.iwant[It],$t.uint32(18).fork()).ldelim();if(wt.graft!=null&&wt.graft.length)for(var It=0;It<wt.graft.length;++It)d.RPC.ControlGraft.encode(wt.graft[It],$t.uint32(26).fork()).ldelim();if(wt.prune!=null&&wt.prune.length)for(var It=0;It<wt.prune.length;++It)d.RPC.ControlPrune.encode(wt.prune[It],$t.uint32(34).fork()).ldelim();return $t},gt.decode=function(wt,$t){wt instanceof a||(wt=a.create(wt));for(var It=$t===void 0?wt.len:wt.pos+$t,Rt=new d.RPC.ControlMessage;wt.pos<It;){var Tt=wt.uint32();switch(Tt>>>3){case 1:Rt.ihave&&Rt.ihave.length||(Rt.ihave=[]),Rt.ihave.push(d.RPC.ControlIHave.decode(wt,wt.uint32()));break;case 2:Rt.iwant&&Rt.iwant.length||(Rt.iwant=[]),Rt.iwant.push(d.RPC.ControlIWant.decode(wt,wt.uint32()));break;case 3:Rt.graft&&Rt.graft.length||(Rt.graft=[]),Rt.graft.push(d.RPC.ControlGraft.decode(wt,wt.uint32()));break;case 4:Rt.prune&&Rt.prune.length||(Rt.prune=[]),Rt.prune.push(d.RPC.ControlPrune.decode(wt,wt.uint32()));break;default:wt.skipType(Tt&7);break}}return Rt},gt.fromObject=function(wt){if(wt instanceof d.RPC.ControlMessage)return wt;var $t=new d.RPC.ControlMessage;if(wt.ihave){if(!Array.isArray(wt.ihave))throw TypeError(".RPC.ControlMessage.ihave: array expected");$t.ihave=[];for(var It=0;It<wt.ihave.length;++It){if(typeof wt.ihave[It]!="object")throw TypeError(".RPC.ControlMessage.ihave: object expected");$t.ihave[It]=d.RPC.ControlIHave.fromObject(wt.ihave[It])}}if(wt.iwant){if(!Array.isArray(wt.iwant))throw TypeError(".RPC.ControlMessage.iwant: array expected");$t.iwant=[];for(var It=0;It<wt.iwant.length;++It){if(typeof wt.iwant[It]!="object")throw TypeError(".RPC.ControlMessage.iwant: object expected");$t.iwant[It]=d.RPC.ControlIWant.fromObject(wt.iwant[It])}}if(wt.graft){if(!Array.isArray(wt.graft))throw TypeError(".RPC.ControlMessage.graft: array expected");$t.graft=[];for(var It=0;It<wt.graft.length;++It){if(typeof wt.graft[It]!="object")throw TypeError(".RPC.ControlMessage.graft: object expected");$t.graft[It]=d.RPC.ControlGraft.fromObject(wt.graft[It])}}if(wt.prune){if(!Array.isArray(wt.prune))throw TypeError(".RPC.ControlMessage.prune: array expected");$t.prune=[];for(var It=0;It<wt.prune.length;++It){if(typeof wt.prune[It]!="object")throw TypeError(".RPC.ControlMessage.prune: object expected");$t.prune[It]=d.RPC.ControlPrune.fromObject(wt.prune[It])}}return $t},gt.toObject=function(wt,$t){$t||($t={});var It={};if(($t.arrays||$t.defaults)&&(It.ihave=[],It.iwant=[],It.graft=[],It.prune=[]),wt.ihave&&wt.ihave.length){It.ihave=[];for(var Rt=0;Rt<wt.ihave.length;++Rt)It.ihave[Rt]=d.RPC.ControlIHave.toObject(wt.ihave[Rt],$t)}if(wt.iwant&&wt.iwant.length){It.iwant=[];for(var Rt=0;Rt<wt.iwant.length;++Rt)It.iwant[Rt]=d.RPC.ControlIWant.toObject(wt.iwant[Rt],$t)}if(wt.graft&&wt.graft.length){It.graft=[];for(var Rt=0;Rt<wt.graft.length;++Rt)It.graft[Rt]=d.RPC.ControlGraft.toObject(wt.graft[Rt],$t)}if(wt.prune&&wt.prune.length){It.prune=[];for(var Rt=0;Rt<wt.prune.length;++Rt)It.prune[Rt]=d.RPC.ControlPrune.toObject(wt.prune[Rt],$t)}return It},gt.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},gt}(),et.ControlIHave=function(){function gt(wt){if(this.messageIDs=[],wt)for(var $t=Object.keys(wt),It=0;It<$t.length;++It)wt[$t[It]]!=null&&(this[$t[It]]=wt[$t[It]])}gt.prototype.topicID=null,gt.prototype.messageIDs=h.emptyArray;var _t;return Object.defineProperty(gt.prototype,"_topicID",{get:h.oneOfGetter(_t=["topicID"]),set:h.oneOfSetter(_t)}),gt.encode=function($t,It){if(It||(It=c.create()),$t.topicID!=null&&Object.hasOwnProperty.call($t,"topicID")&&It.uint32(10).string($t.topicID),$t.messageIDs!=null&&$t.messageIDs.length)for(var Rt=0;Rt<$t.messageIDs.length;++Rt)It.uint32(18).bytes($t.messageIDs[Rt]);return It},gt.decode=function($t,It){$t instanceof a||($t=a.create($t));for(var Rt=It===void 0?$t.len:$t.pos+It,Tt=new d.RPC.ControlIHave;$t.pos<Rt;){var At=$t.uint32();switch(At>>>3){case 1:Tt.topicID=$t.string();break;case 2:Tt.messageIDs&&Tt.messageIDs.length||(Tt.messageIDs=[]),Tt.messageIDs.push($t.bytes());break;default:$t.skipType(At&7);break}}return Tt},gt.fromObject=function($t){if($t instanceof d.RPC.ControlIHave)return $t;var It=new d.RPC.ControlIHave;if($t.topicID!=null&&(It.topicID=String($t.topicID)),$t.messageIDs){if(!Array.isArray($t.messageIDs))throw TypeError(".RPC.ControlIHave.messageIDs: array expected");It.messageIDs=[];for(var Rt=0;Rt<$t.messageIDs.length;++Rt)typeof $t.messageIDs[Rt]=="string"?h.base64.decode($t.messageIDs[Rt],It.messageIDs[Rt]=h.newBuffer(h.base64.length($t.messageIDs[Rt])),0):$t.messageIDs[Rt].length&&(It.messageIDs[Rt]=$t.messageIDs[Rt])}return It},gt.toObject=function($t,It){It||(It={});var Rt={};if((It.arrays||It.defaults)&&(Rt.messageIDs=[]),$t.topicID!=null&&$t.hasOwnProperty("topicID")&&(Rt.topicID=$t.topicID,It.oneofs&&(Rt._topicID="topicID")),$t.messageIDs&&$t.messageIDs.length){Rt.messageIDs=[];for(var Tt=0;Tt<$t.messageIDs.length;++Tt)Rt.messageIDs[Tt]=It.bytes===String?h.base64.encode($t.messageIDs[Tt],0,$t.messageIDs[Tt].length):It.bytes===Array?Array.prototype.slice.call($t.messageIDs[Tt]):$t.messageIDs[Tt]}return Rt},gt.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},gt}(),et.ControlIWant=function(){function gt(_t){if(this.messageIDs=[],_t)for(var wt=Object.keys(_t),$t=0;$t<wt.length;++$t)_t[wt[$t]]!=null&&(this[wt[$t]]=_t[wt[$t]])}return gt.prototype.messageIDs=h.emptyArray,gt.encode=function(wt,$t){if($t||($t=c.create()),wt.messageIDs!=null&&wt.messageIDs.length)for(var It=0;It<wt.messageIDs.length;++It)$t.uint32(10).bytes(wt.messageIDs[It]);return $t},gt.decode=function(wt,$t){wt instanceof a||(wt=a.create(wt));for(var It=$t===void 0?wt.len:wt.pos+$t,Rt=new d.RPC.ControlIWant;wt.pos<It;){var Tt=wt.uint32();switch(Tt>>>3){case 1:Rt.messageIDs&&Rt.messageIDs.length||(Rt.messageIDs=[]),Rt.messageIDs.push(wt.bytes());break;default:wt.skipType(Tt&7);break}}return Rt},gt.fromObject=function(wt){if(wt instanceof d.RPC.ControlIWant)return wt;var $t=new d.RPC.ControlIWant;if(wt.messageIDs){if(!Array.isArray(wt.messageIDs))throw TypeError(".RPC.ControlIWant.messageIDs: array expected");$t.messageIDs=[];for(var It=0;It<wt.messageIDs.length;++It)typeof wt.messageIDs[It]=="string"?h.base64.decode(wt.messageIDs[It],$t.messageIDs[It]=h.newBuffer(h.base64.length(wt.messageIDs[It])),0):wt.messageIDs[It].length&&($t.messageIDs[It]=wt.messageIDs[It])}return $t},gt.toObject=function(wt,$t){$t||($t={});var It={};if(($t.arrays||$t.defaults)&&(It.messageIDs=[]),wt.messageIDs&&wt.messageIDs.length){It.messageIDs=[];for(var Rt=0;Rt<wt.messageIDs.length;++Rt)It.messageIDs[Rt]=$t.bytes===String?h.base64.encode(wt.messageIDs[Rt],0,wt.messageIDs[Rt].length):$t.bytes===Array?Array.prototype.slice.call(wt.messageIDs[Rt]):wt.messageIDs[Rt]}return It},gt.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},gt}(),et.ControlGraft=function(){function gt(wt){if(wt)for(var $t=Object.keys(wt),It=0;It<$t.length;++It)wt[$t[It]]!=null&&(this[$t[It]]=wt[$t[It]])}gt.prototype.topicID=null;var _t;return Object.defineProperty(gt.prototype,"_topicID",{get:h.oneOfGetter(_t=["topicID"]),set:h.oneOfSetter(_t)}),gt.encode=function($t,It){return It||(It=c.create()),$t.topicID!=null&&Object.hasOwnProperty.call($t,"topicID")&&It.uint32(10).string($t.topicID),It},gt.decode=function($t,It){$t instanceof a||($t=a.create($t));for(var Rt=It===void 0?$t.len:$t.pos+It,Tt=new d.RPC.ControlGraft;$t.pos<Rt;){var At=$t.uint32();switch(At>>>3){case 1:Tt.topicID=$t.string();break;default:$t.skipType(At&7);break}}return Tt},gt.fromObject=function($t){if($t instanceof d.RPC.ControlGraft)return $t;var It=new d.RPC.ControlGraft;return $t.topicID!=null&&(It.topicID=String($t.topicID)),It},gt.toObject=function($t,It){It||(It={});var Rt={};return $t.topicID!=null&&$t.hasOwnProperty("topicID")&&(Rt.topicID=$t.topicID,It.oneofs&&(Rt._topicID="topicID")),Rt},gt.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},gt}(),et.ControlPrune=function(){function gt(wt){if(this.peers=[],wt)for(var $t=Object.keys(wt),It=0;It<$t.length;++It)wt[$t[It]]!=null&&(this[$t[It]]=wt[$t[It]])}gt.prototype.topicID=null,gt.prototype.peers=h.emptyArray,gt.prototype.backoff=null;var _t;return Object.defineProperty(gt.prototype,"_topicID",{get:h.oneOfGetter(_t=["topicID"]),set:h.oneOfSetter(_t)}),Object.defineProperty(gt.prototype,"_backoff",{get:h.oneOfGetter(_t=["backoff"]),set:h.oneOfSetter(_t)}),gt.encode=function($t,It){if(It||(It=c.create()),$t.topicID!=null&&Object.hasOwnProperty.call($t,"topicID")&&It.uint32(10).string($t.topicID),$t.peers!=null&&$t.peers.length)for(var Rt=0;Rt<$t.peers.length;++Rt)d.RPC.PeerInfo.encode($t.peers[Rt],It.uint32(18).fork()).ldelim();return $t.backoff!=null&&Object.hasOwnProperty.call($t,"backoff")&&It.uint32(24).uint64($t.backoff),It},gt.decode=function($t,It){$t instanceof a||($t=a.create($t));for(var Rt=It===void 0?$t.len:$t.pos+It,Tt=new d.RPC.ControlPrune;$t.pos<Rt;){var At=$t.uint32();switch(At>>>3){case 1:Tt.topicID=$t.string();break;case 2:Tt.peers&&Tt.peers.length||(Tt.peers=[]),Tt.peers.push(d.RPC.PeerInfo.decode($t,$t.uint32()));break;case 3:Tt.backoff=$t.uint64();break;default:$t.skipType(At&7);break}}return Tt},gt.fromObject=function($t){if($t instanceof d.RPC.ControlPrune)return $t;var It=new d.RPC.ControlPrune;if($t.topicID!=null&&(It.topicID=String($t.topicID)),$t.peers){if(!Array.isArray($t.peers))throw TypeError(".RPC.ControlPrune.peers: array expected");It.peers=[];for(var Rt=0;Rt<$t.peers.length;++Rt){if(typeof $t.peers[Rt]!="object")throw TypeError(".RPC.ControlPrune.peers: object expected");It.peers[Rt]=d.RPC.PeerInfo.fromObject($t.peers[Rt])}}return $t.backoff!=null&&(h.Long?(It.backoff=h.Long.fromValue($t.backoff)).unsigned=!0:typeof $t.backoff=="string"?It.backoff=parseInt($t.backoff,10):typeof $t.backoff=="number"?It.backoff=$t.backoff:typeof $t.backoff=="object"&&(It.backoff=new h.LongBits($t.backoff.low>>>0,$t.backoff.high>>>0).toNumber(!0))),It},gt.toObject=function($t,It){It||(It={});var Rt={};if((It.arrays||It.defaults)&&(Rt.peers=[]),$t.topicID!=null&&$t.hasOwnProperty("topicID")&&(Rt.topicID=$t.topicID,It.oneofs&&(Rt._topicID="topicID")),$t.peers&&$t.peers.length){Rt.peers=[];for(var Tt=0;Tt<$t.peers.length;++Tt)Rt.peers[Tt]=d.RPC.PeerInfo.toObject($t.peers[Tt],It)}return $t.backoff!=null&&$t.hasOwnProperty("backoff")&&(typeof $t.backoff=="number"?Rt.backoff=It.longs===String?String($t.backoff):$t.backoff:Rt.backoff=It.longs===String?h.Long.prototype.toString.call($t.backoff):It.longs===Number?new h.LongBits($t.backoff.low>>>0,$t.backoff.high>>>0).toNumber(!0):$t.backoff,It.oneofs&&(Rt._backoff="backoff")),Rt},gt.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},gt}(),et.PeerInfo=function(){function gt(wt){if(wt)for(var $t=Object.keys(wt),It=0;It<$t.length;++It)wt[$t[It]]!=null&&(this[$t[It]]=wt[$t[It]])}gt.prototype.peerID=null,gt.prototype.signedPeerRecord=null;var _t;return Object.defineProperty(gt.prototype,"_peerID",{get:h.oneOfGetter(_t=["peerID"]),set:h.oneOfSetter(_t)}),Object.defineProperty(gt.prototype,"_signedPeerRecord",{get:h.oneOfGetter(_t=["signedPeerRecord"]),set:h.oneOfSetter(_t)}),gt.encode=function($t,It){return It||(It=c.create()),$t.peerID!=null&&Object.hasOwnProperty.call($t,"peerID")&&It.uint32(10).bytes($t.peerID),$t.signedPeerRecord!=null&&Object.hasOwnProperty.call($t,"signedPeerRecord")&&It.uint32(18).bytes($t.signedPeerRecord),It},gt.decode=function($t,It){$t instanceof a||($t=a.create($t));for(var Rt=It===void 0?$t.len:$t.pos+It,Tt=new d.RPC.PeerInfo;$t.pos<Rt;){var At=$t.uint32();switch(At>>>3){case 1:Tt.peerID=$t.bytes();break;case 2:Tt.signedPeerRecord=$t.bytes();break;default:$t.skipType(At&7);break}}return Tt},gt.fromObject=function($t){if($t instanceof d.RPC.PeerInfo)return $t;var It=new d.RPC.PeerInfo;return $t.peerID!=null&&(typeof $t.peerID=="string"?h.base64.decode($t.peerID,It.peerID=h.newBuffer(h.base64.length($t.peerID)),0):$t.peerID.length&&(It.peerID=$t.peerID)),$t.signedPeerRecord!=null&&(typeof $t.signedPeerRecord=="string"?h.base64.decode($t.signedPeerRecord,It.signedPeerRecord=h.newBuffer(h.base64.length($t.signedPeerRecord)),0):$t.signedPeerRecord.length&&(It.signedPeerRecord=$t.signedPeerRecord)),It},gt.toObject=function($t,It){It||(It={});var Rt={};return $t.peerID!=null&&$t.hasOwnProperty("peerID")&&(Rt.peerID=It.bytes===String?h.base64.encode($t.peerID,0,$t.peerID.length):It.bytes===Array?Array.prototype.slice.call($t.peerID):$t.peerID,It.oneofs&&(Rt._peerID="peerID")),$t.signedPeerRecord!=null&&$t.hasOwnProperty("signedPeerRecord")&&(Rt.signedPeerRecord=It.bytes===String?h.base64.encode($t.signedPeerRecord,0,$t.signedPeerRecord.length):It.bytes===Array?Array.prototype.slice.call($t.signedPeerRecord):$t.signedPeerRecord,It.oneofs&&(Rt._signedPeerRecord="signedPeerRecord")),Rt},gt.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},gt}(),et}(),d})})(rpc);var rpcExports=rpc.exports;const cjs$2=getDefaultExportFromCjs(rpcExports),{RPC}=cjs$2;class MessageCache{constructor(e,a,c){qt(this,"gossip");qt(this,"msgs",new Map);qt(this,"msgIdToStrFn");qt(this,"history",[]);qt(this,"notValidatedCount",0);this.gossip=e,this.msgIdToStrFn=c;for(let h=0;h<a;h++)this.history[h]=[]}get size(){return this.msgs.size}put(e,a,c=!1){const{msgIdStr:h}=e;return this.msgs.has(h)?!1:(this.msgs.set(h,{message:a,validated:c,originatingPeers:new Set,iwantCounts:new Map}),this.history[0].push({...e,topic:a.topic}),c||this.notValidatedCount++,!0)}observeDuplicate(e,a){const c=this.msgs.get(e);c!=null&&!c.validated&&c.originatingPeers.add(a)}get(e){var a;return(a=this.msgs.get(this.msgIdToStrFn(e)))==null?void 0:a.message}getWithIWantCount(e,a){const c=this.msgs.get(e);if(c==null)return null;const h=(c.iwantCounts.get(a)??0)+1;return c.iwantCounts.set(a,h),{msg:c.message,count:h}}getGossipIDs(e){const a=new Map;for(let c=0;c<this.gossip;c++)this.history[c].forEach(h=>{const d=this.msgs.get(h.msgIdStr);if(((d==null?void 0:d.validated)??!1)&&e.has(h.topic)){let et=a.get(h.topic);et==null&&(et=[],a.set(h.topic,et)),et.push(h.msgId)}});return a}validate(e){const a=this.msgs.get(e);if(a==null)return null;a.validated||this.notValidatedCount--;const{message:c,originatingPeers:h}=a;return a.validated=!0,a.originatingPeers=new Set,{message:c,originatingPeers:h}}shift(){this.history[this.history.length-1].forEach(a=>{const c=this.msgs.get(a.msgIdStr);c!=null&&(this.msgs.delete(a.msgIdStr),c.validated||this.notValidatedCount--)}),this.history.pop(),this.history.unshift([])}remove(e){const a=this.msgs.get(e);return a==null?null:(this.msgs.delete(e),a)}}var SignaturePolicy;(function(i){i.StrictSign="StrictSign",i.StrictNoSign="StrictNoSign"})(SignaturePolicy||(SignaturePolicy={}));var PublishConfigType;(function(i){i[i.Signing=0]="Signing",i[i.Anonymous=1]="Anonymous"})(PublishConfigType||(PublishConfigType={}));var RejectReason;(function(i){i.Error="error",i.Ignore="ignore",i.Reject="reject",i.Blacklisted="blacklisted"})(RejectReason||(RejectReason={}));var ValidateError;(function(i){i.InvalidSignature="invalid_signature",i.InvalidSeqno="invalid_seqno",i.InvalidPeerId="invalid_peerid",i.SignaturePresent="signature_present",i.SeqnoPresent="seqno_present",i.FromPresent="from_present",i.TransformFailed="transform_failed"})(ValidateError||(ValidateError={}));var MessageStatus;(function(i){i.duplicate="duplicate",i.invalid="invalid",i.valid="valid"})(MessageStatus||(MessageStatus={}));function rejectReasonFromAcceptance(i){switch(i){case TopicValidatorResult.Ignore:return RejectReason.Ignore;case TopicValidatorResult.Reject:return RejectReason.Reject;default:throw new Error("Unreachable")}}var MessageSource;(function(i){i.forward="forward",i.publish="publish"})(MessageSource||(MessageSource={}));var InclusionReason;(function(i){i.Fanout="fanout",i.Random="random",i.Subscribed="subscribed",i.Outbound="outbound",i.NotEnough="not_enough",i.Opportunistic="opportunistic"})(InclusionReason||(InclusionReason={}));var ChurnReason;(function(i){i.Dc="disconnected",i.BadScore="bad_score",i.Prune="prune",i.Excess="excess"})(ChurnReason||(ChurnReason={}));var ScorePenalty;(function(i){i.GraftBackoff="graft_backoff",i.BrokenPromise="broken_promise",i.MessageDeficit="message_deficit",i.IPColocation="IP_colocation"})(ScorePenalty||(ScorePenalty={}));var IHaveIgnoreReason;(function(i){i.LowScore="low_score",i.MaxIhave="max_ihave",i.MaxIasked="max_iasked"})(IHaveIgnoreReason||(IHaveIgnoreReason={}));var ScoreThreshold;(function(i){i.graylist="graylist",i.publish="publish",i.gossip="gossip",i.mesh="mesh"})(ScoreThreshold||(ScoreThreshold={}));function getMetrics(i,e,a){return{protocolsEnabled:i.gauge({name:"gossipsub_protocol",help:"Status of enabled protocols",labelNames:["protocol"]}),topicSubscriptionStatus:i.gauge({name:"gossipsub_topic_subscription_status",help:"Status of our subscription to this topic",labelNames:["topicStr"]}),topicPeersCount:i.gauge({name:"gossipsub_topic_peer_count",help:"Number of peers subscribed to each topic",labelNames:["topicStr"]}),meshPeerCounts:i.gauge({name:"gossipsub_mesh_peer_count",help:"Number of peers in our mesh",labelNames:["topicStr"]}),meshPeerInclusionEventsFanout:i.gauge({name:"gossipsub_mesh_peer_inclusion_events_fanout_total",help:"Number of times we include peers in a topic mesh for fanout reasons",labelNames:["topic"]}),meshPeerInclusionEventsRandom:i.gauge({name:"gossipsub_mesh_peer_inclusion_events_random_total",help:"Number of times we include peers in a topic mesh for random reasons",labelNames:["topic"]}),meshPeerInclusionEventsSubscribed:i.gauge({name:"gossipsub_mesh_peer_inclusion_events_subscribed_total",help:"Number of times we include peers in a topic mesh for subscribed reasons",labelNames:["topic"]}),meshPeerInclusionEventsOutbound:i.gauge({name:"gossipsub_mesh_peer_inclusion_events_outbound_total",help:"Number of times we include peers in a topic mesh for outbound reasons",labelNames:["topic"]}),meshPeerInclusionEventsNotEnough:i.gauge({name:"gossipsub_mesh_peer_inclusion_events_not_enough_total",help:"Number of times we include peers in a topic mesh for not_enough reasons",labelNames:["topic"]}),meshPeerInclusionEventsOpportunistic:i.gauge({name:"gossipsub_mesh_peer_inclusion_events_opportunistic_total",help:"Number of times we include peers in a topic mesh for opportunistic reasons",labelNames:["topic"]}),meshPeerInclusionEventsUnknown:i.gauge({name:"gossipsub_mesh_peer_inclusion_events_unknown_total",help:"Number of times we include peers in a topic mesh for unknown reasons",labelNames:["topic"]}),meshPeerChurnEventsDisconnected:i.gauge({name:"gossipsub_peer_churn_events_disconnected_total",help:"Number of times we remove peers in a topic mesh for disconnected reasons",labelNames:["topic"]}),meshPeerChurnEventsBadScore:i.gauge({name:"gossipsub_peer_churn_events_bad_score_total",help:"Number of times we remove peers in a topic mesh for bad_score reasons",labelNames:["topic"]}),meshPeerChurnEventsPrune:i.gauge({name:"gossipsub_peer_churn_events_prune_total",help:"Number of times we remove peers in a topic mesh for prune reasons",labelNames:["topic"]}),meshPeerChurnEventsExcess:i.gauge({name:"gossipsub_peer_churn_events_excess_total",help:"Number of times we remove peers in a topic mesh for excess reasons",labelNames:["topic"]}),meshPeerChurnEventsUnknown:i.gauge({name:"gossipsub_peer_churn_events_unknown_total",help:"Number of times we remove peers in a topic mesh for unknown reasons",labelNames:["topic"]}),peersPerProtocol:i.gauge({name:"gossipsub_peers_per_protocol_count",help:"Peers connected for each topic",labelNames:["protocol"]}),heartbeatDuration:i.histogram({name:"gossipsub_heartbeat_duration_seconds",help:"The time it takes to complete one iteration of the heartbeat",buckets:[.01,.1,1]}),heartbeatSkipped:i.gauge({name:"gossipsub_heartbeat_skipped",help:"Heartbeat run took longer than heartbeat interval so next is skipped"}),acceptedMessagesTotal:i.gauge({name:"gossipsub_accepted_messages_total",help:"Total accepted messages for each topic",labelNames:["topic"]}),ignoredMessagesTotal:i.gauge({name:"gossipsub_ignored_messages_total",help:"Total ignored messages for each topic",labelNames:["topic"]}),rejectedMessagesTotal:i.gauge({name:"gossipsub_rejected_messages_total",help:"Total rejected messages for each topic",labelNames:["topic"]}),unknownValidationResultsTotal:i.gauge({name:"gossipsub_unknown_validation_results_total",help:"Total unknown validation results for each topic",labelNames:["topic"]}),asyncValidationMcacheHit:i.gauge({name:"gossipsub_async_validation_mcache_hit_total",help:"Async validation result reported by the user layer",labelNames:["hit"]}),asyncValidationDelayFromFirstSeenSec:i.histogram({name:"gossipsub_async_validation_delay_from_first_seen",help:"Async validation report delay from first seen in second",labelNames:["topic"],buckets:[.01,.03,.1,.3,1,3,10]}),asyncValidationUnknownFirstSeen:i.gauge({name:"gossipsub_async_validation_unknown_first_seen_count_total",help:"Async validation report unknown first seen value for message"}),peerReadStreamError:i.gauge({name:"gossipsub_peer_read_stream_err_count_total",help:"Peer read stream error"}),rpcRecvBytes:i.gauge({name:"gossipsub_rpc_recv_bytes_total",help:"RPC recv"}),rpcRecvCount:i.gauge({name:"gossipsub_rpc_recv_count_total",help:"RPC recv"}),rpcRecvSubscription:i.gauge({name:"gossipsub_rpc_recv_subscription_total",help:"RPC recv"}),rpcRecvMessage:i.gauge({name:"gossipsub_rpc_recv_message_total",help:"RPC recv"}),rpcRecvControl:i.gauge({name:"gossipsub_rpc_recv_control_total",help:"RPC recv"}),rpcRecvIHave:i.gauge({name:"gossipsub_rpc_recv_ihave_total",help:"RPC recv"}),rpcRecvIWant:i.gauge({name:"gossipsub_rpc_recv_iwant_total",help:"RPC recv"}),rpcRecvGraft:i.gauge({name:"gossipsub_rpc_recv_graft_total",help:"RPC recv"}),rpcRecvPrune:i.gauge({name:"gossipsub_rpc_recv_prune_total",help:"RPC recv"}),rpcDataError:i.gauge({name:"gossipsub_rpc_data_err_count_total",help:"RPC data error"}),rpcRecvError:i.gauge({name:"gossipsub_rpc_recv_err_count_total",help:"RPC recv error"}),rpcRecvNotAccepted:i.gauge({name:"gossipsub_rpc_rcv_not_accepted_total",help:"Total count of RPC dropped because acceptFrom() == false"}),rpcSentBytes:i.gauge({name:"gossipsub_rpc_sent_bytes_total",help:"RPC sent"}),rpcSentCount:i.gauge({name:"gossipsub_rpc_sent_count_total",help:"RPC sent"}),rpcSentSubscription:i.gauge({name:"gossipsub_rpc_sent_subscription_total",help:"RPC sent"}),rpcSentMessage:i.gauge({name:"gossipsub_rpc_sent_message_total",help:"RPC sent"}),rpcSentControl:i.gauge({name:"gossipsub_rpc_sent_control_total",help:"RPC sent"}),rpcSentIHave:i.gauge({name:"gossipsub_rpc_sent_ihave_total",help:"RPC sent"}),rpcSentIWant:i.gauge({name:"gossipsub_rpc_sent_iwant_total",help:"RPC sent"}),rpcSentGraft:i.gauge({name:"gossipsub_rpc_sent_graft_total",help:"RPC sent"}),rpcSentPrune:i.gauge({name:"gossipsub_rpc_sent_prune_total",help:"RPC sent"}),msgPublishCount:i.gauge({name:"gossipsub_msg_publish_count_total",help:"Total count of msg published by topic",labelNames:["topic"]}),msgPublishPeersByTopic:i.gauge({name:"gossipsub_msg_publish_peers_total",help:"Total count of peers that we publish a msg to",labelNames:["topic"]}),directPeersPublishedTotal:i.gauge({name:"gossipsub_direct_peers_published_total",help:"Total direct peers that we publish a msg to",labelNames:["topic"]}),floodsubPeersPublishedTotal:i.gauge({name:"gossipsub_floodsub_peers_published_total",help:"Total floodsub peers that we publish a msg to",labelNames:["topic"]}),meshPeersPublishedTotal:i.gauge({name:"gossipsub_mesh_peers_published_total",help:"Total mesh peers that we publish a msg to",labelNames:["topic"]}),fanoutPeersPublishedTotal:i.gauge({name:"gossipsub_fanout_peers_published_total",help:"Total fanout peers that we publish a msg to",labelNames:["topic"]}),msgPublishBytes:i.gauge({name:"gossipsub_msg_publish_bytes_total",help:"Total count of msg publish data.length bytes",labelNames:["topic"]}),msgPublishTime:i.histogram({name:"gossipsub_msg_publish_seconds",help:"Total time in seconds to publish a message",buckets:[.001,.002,.005,.01,.1,.5,1],labelNames:["topic"]}),msgForwardCount:i.gauge({name:"gossipsub_msg_forward_count_total",help:"Total count of msg forwarded by topic",labelNames:["topic"]}),msgForwardPeers:i.gauge({name:"gossipsub_msg_forward_peers_total",help:"Total count of peers that we forward a msg to",labelNames:["topic"]}),msgReceivedPreValidation:i.gauge({name:"gossipsub_msg_received_prevalidation_total",help:"Total count of recv msgs before any validation",labelNames:["topic"]}),msgReceivedError:i.gauge({name:"gossipsub_msg_received_error_total",help:"Total count of recv msgs error",labelNames:["topic"]}),prevalidationInvalidTotal:i.gauge({name:"gossipsub_pre_validation_invalid_total",help:"Total count of invalid messages received",labelNames:["topic"]}),prevalidationValidTotal:i.gauge({name:"gossipsub_pre_validation_valid_total",help:"Total count of valid messages received",labelNames:["topic"]}),prevalidationDuplicateTotal:i.gauge({name:"gossipsub_pre_validation_duplicate_total",help:"Total count of duplicate messages received",labelNames:["topic"]}),prevalidationUnknownTotal:i.gauge({name:"gossipsub_pre_validation_unknown_status_total",help:"Total count of unknown_status messages received",labelNames:["topic"]}),msgReceivedInvalid:i.gauge({name:"gossipsub_msg_received_invalid_total",help:"Tracks specific reason of invalid",labelNames:["error"]}),msgReceivedInvalidByTopic:i.gauge({name:"gossipsub_msg_received_invalid_by_topic_total",help:"Tracks specific invalid message by topic",labelNames:["topic"]}),duplicateMsgDeliveryDelay:i.histogram({name:"gossisub_duplicate_msg_delivery_delay_seconds",help:"Time since the 1st duplicated message validated",labelNames:["topic"],buckets:[.25*a.maxMeshMessageDeliveriesWindowSec,.5*a.maxMeshMessageDeliveriesWindowSec,Number(a.maxMeshMessageDeliveriesWindowSec),2*a.maxMeshMessageDeliveriesWindowSec,4*a.maxMeshMessageDeliveriesWindowSec]}),duplicateMsgLateDelivery:i.gauge({name:"gossisub_duplicate_msg_late_delivery_total",help:"Total count of late duplicate message delivery by topic, which triggers P3 penalty",labelNames:["topic"]}),duplicateMsgIgnored:i.gauge({name:"gossisub_ignored_published_duplicate_msgs_total",help:"Total count of published duplicate message ignored by topic",labelNames:["topic"]}),scoreFnCalls:i.gauge({name:"gossipsub_score_fn_calls_total",help:"Total times score() is called"}),scoreFnRuns:i.gauge({name:"gossipsub_score_fn_runs_total",help:"Total times score() call actually computed computeScore(), no cache"}),scoreCachedDelta:i.histogram({name:"gossipsub_score_cache_delta",help:"Delta of score between cached values that expired",buckets:[10,100,1e3]}),peersByScoreThreshold:i.gauge({name:"gossipsub_peers_by_score_threshold_count",help:"Current count of peers by score threshold",labelNames:["threshold"]}),score:i.avgMinMax({name:"gossipsub_score",help:"Avg min max of gossip scores"}),scoreWeights:i.avgMinMax({name:"gossipsub_score_weights",help:"Separate score weights",labelNames:["topic","p"]}),scorePerMesh:i.avgMinMax({name:"gossipsub_score_per_mesh",help:"Histogram of the scores for each mesh topic",labelNames:["topic"]}),scoringPenalties:i.gauge({name:"gossipsub_scoring_penalties_total",help:"A counter of the kind of penalties being applied to peers",labelNames:["penalty"]}),behaviourPenalty:i.histogram({name:"gossipsub_peer_stat_behaviour_penalty",help:"Current peer stat behaviour_penalty at each scrape",buckets:[.25*a.behaviourPenaltyThreshold,.5*a.behaviourPenaltyThreshold,Number(a.behaviourPenaltyThreshold),2*a.behaviourPenaltyThreshold,4*a.behaviourPenaltyThreshold]}),ihaveRcvIgnored:i.gauge({name:"gossipsub_ihave_rcv_ignored_total",help:"Total received IHAVE messages that we ignore for some reason",labelNames:["reason"]}),ihaveRcvMsgids:i.gauge({name:"gossipsub_ihave_rcv_msgids_total",help:"Total received IHAVE messages by topic",labelNames:["topic"]}),ihaveRcvNotSeenMsgids:i.gauge({name:"gossipsub_ihave_rcv_not_seen_msgids_total",help:"Total messages per topic we do not have, not actual requests",labelNames:["topic"]}),iwantRcvMsgids:i.gauge({name:"gossipsub_iwant_rcv_msgids_total",help:"Total received IWANT messages by topic",labelNames:["topic"]}),iwantRcvDonthaveMsgids:i.gauge({name:"gossipsub_iwant_rcv_dont_have_msgids_total",help:"Total requested messageIDs that we do not have"}),iwantPromiseStarted:i.gauge({name:"gossipsub_iwant_promise_sent_total",help:"Total count of started IWANT promises"}),iwantPromiseResolved:i.gauge({name:"gossipsub_iwant_promise_resolved_total",help:"Total count of resolved IWANT promises"}),iwantPromiseResolvedFromDuplicate:i.gauge({name:"gossipsub_iwant_promise_resolved_from_duplicate_total",help:"Total count of resolved IWANT promises from duplicate messages"}),iwantPromiseResolvedPeers:i.gauge({name:"gossipsub_iwant_promise_resolved_peers",help:"Total count of peers we have asked IWANT promises that are resolved"}),iwantPromiseBroken:i.gauge({name:"gossipsub_iwant_promise_broken",help:"Total count of broken IWANT promises"}),iwantMessagePruned:i.gauge({name:"gossipsub_iwant_message_pruned",help:"Total count of pruned IWANT messages"}),iwantPromiseDeliveryTime:i.histogram({name:"gossipsub_iwant_promise_delivery_seconds",help:"Histogram of delivery time of resolved IWANT promises",buckets:[.5*a.gossipPromiseExpireSec,Number(a.gossipPromiseExpireSec),2*a.gossipPromiseExpireSec,4*a.gossipPromiseExpireSec]}),iwantPromiseUntracked:i.gauge({name:"gossip_iwant_promise_untracked",help:"Total count of untracked IWANT promise"}),connectedPeersBackoffSec:i.histogram({name:"gossipsub_connected_peers_backoff_seconds",help:"Backoff time in seconds",buckets:[1,2,4,10,20,60,120]}),cacheSize:i.gauge({name:"gossipsub_cache_size",help:"Unbounded cache sizes",labelNames:["cache"]}),mcacheSize:i.gauge({name:"gossipsub_mcache_size",help:"Current mcache msg count"}),mcacheNotValidatedCount:i.gauge({name:"gossipsub_mcache_not_validated_count",help:"Current mcache msg count not validated"}),fastMsgIdCacheCollision:i.gauge({name:"gossipsub_fastmsgid_cache_collision_total",help:"Total count of key collisions on fastmsgid cache put"}),newConnectionCount:i.gauge({name:"gossipsub_new_connection_total",help:"Total new connection by status",labelNames:["status"]}),topicStrToLabel:e,toTopic(c){return this.topicStrToLabel.get(c)??c},onJoin(c){this.topicSubscriptionStatus.set({topicStr:c},1),this.meshPeerCounts.set({topicStr:c},0)},onLeave(c){this.topicSubscriptionStatus.set({topicStr:c},0),this.meshPeerCounts.set({topicStr:c},0)},onAddToMesh(c,h,d){const et=this.toTopic(c);switch(h){case InclusionReason.Fanout:this.meshPeerInclusionEventsFanout.inc({topic:et},d);break;case InclusionReason.Random:this.meshPeerInclusionEventsRandom.inc({topic:et},d);break;case InclusionReason.Subscribed:this.meshPeerInclusionEventsSubscribed.inc({topic:et},d);break;case InclusionReason.Outbound:this.meshPeerInclusionEventsOutbound.inc({topic:et},d);break;case InclusionReason.NotEnough:this.meshPeerInclusionEventsNotEnough.inc({topic:et},d);break;case InclusionReason.Opportunistic:this.meshPeerInclusionEventsOpportunistic.inc({topic:et},d);break;default:this.meshPeerInclusionEventsUnknown.inc({topic:et},d);break}},onRemoveFromMesh(c,h,d){const et=this.toTopic(c);switch(h){case ChurnReason.Dc:this.meshPeerChurnEventsDisconnected.inc({topic:et},d);break;case ChurnReason.BadScore:this.meshPeerChurnEventsBadScore.inc({topic:et},d);break;case ChurnReason.Prune:this.meshPeerChurnEventsPrune.inc({topic:et},d);break;case ChurnReason.Excess:this.meshPeerChurnEventsExcess.inc({topic:et},d);break;default:this.meshPeerChurnEventsUnknown.inc({topic:et},d);break}},onReportValidation(c,h,d){if(this.asyncValidationMcacheHit.inc({hit:c!=null?"hit":"miss"}),c!=null){const et=this.toTopic(c.message.topic);switch(h){case TopicValidatorResult.Accept:this.acceptedMessagesTotal.inc({topic:et});break;case TopicValidatorResult.Ignore:this.ignoredMessagesTotal.inc({topic:et});break;case TopicValidatorResult.Reject:this.rejectedMessagesTotal.inc({topic:et});break;default:this.unknownValidationResultsTotal.inc({topic:et});break}}d!=null?this.asyncValidationDelayFromFirstSeenSec.observe((Date.now()-d)/1e3):this.asyncValidationUnknownFirstSeen.inc()},onScorePenalty(c){this.scoringPenalties.inc({penalty:c},1)},onIhaveRcv(c,h,d){const et=this.toTopic(c);this.ihaveRcvMsgids.inc({topic:et},h),this.ihaveRcvNotSeenMsgids.inc({topic:et},d)},onIwantRcv(c,h){for(const[d,et]of c){const ft=this.toTopic(d);this.iwantRcvMsgids.inc({topic:ft},et)}this.iwantRcvDonthaveMsgids.inc(h)},onForwardMsg(c,h){const d=this.toTopic(c);this.msgForwardCount.inc({topic:d},1),this.msgForwardPeers.inc({topic:d},h)},onPublishMsg(c,h,d,et,ft){const gt=this.toTopic(c);this.msgPublishCount.inc({topic:gt},1),this.msgPublishBytes.inc({topic:gt},d*et),this.msgPublishPeersByTopic.inc({topic:gt},d),this.directPeersPublishedTotal.inc({topic:gt},h.direct),this.floodsubPeersPublishedTotal.inc({topic:gt},h.floodsub),this.meshPeersPublishedTotal.inc({topic:gt},h.mesh),this.fanoutPeersPublishedTotal.inc({topic:gt},h.fanout),this.msgPublishTime.observe({topic:gt},ft/1e3)},onMsgRecvPreValidation(c){const h=this.toTopic(c);this.msgReceivedPreValidation.inc({topic:h},1)},onMsgRecvError(c){const h=this.toTopic(c);this.msgReceivedError.inc({topic:h},1)},onPrevalidationResult(c,h){const d=this.toTopic(c);switch(h){case MessageStatus.duplicate:this.prevalidationDuplicateTotal.inc({topic:d});break;case MessageStatus.invalid:this.prevalidationInvalidTotal.inc({topic:d});break;case MessageStatus.valid:this.prevalidationValidTotal.inc({topic:d});break;default:this.prevalidationUnknownTotal.inc({topic:d});break}},onMsgRecvInvalid(c,h){const d=this.toTopic(c),et=h.reason===RejectReason.Error?h.error:h.reason;this.msgReceivedInvalid.inc({error:et},1),this.msgReceivedInvalidByTopic.inc({topic:d},1)},onDuplicateMsgDelivery(c,h,d){if(this.duplicateMsgDeliveryDelay.observe(h/1e3),d){const et=this.toTopic(c);this.duplicateMsgLateDelivery.inc({topic:et},1)}},onPublishDuplicateMsg(c){const h=this.toTopic(c);this.duplicateMsgIgnored.inc({topic:h},1)},onPeerReadStreamError(){this.peerReadStreamError.inc(1)},onRpcRecvError(){this.rpcRecvError.inc(1)},onRpcDataError(){this.rpcDataError.inc(1)},onRpcRecv(c,h){this.rpcRecvBytes.inc(h),this.rpcRecvCount.inc(1),c.subscriptions!=null&&this.rpcRecvSubscription.inc(c.subscriptions.length),c.messages!=null&&this.rpcRecvMessage.inc(c.messages.length),c.control!=null&&(this.rpcRecvControl.inc(1),c.control.ihave!=null&&this.rpcRecvIHave.inc(c.control.ihave.length),c.control.iwant!=null&&this.rpcRecvIWant.inc(c.control.iwant.length),c.control.graft!=null&&this.rpcRecvGraft.inc(c.control.graft.length),c.control.prune!=null&&this.rpcRecvPrune.inc(c.control.prune.length))},onRpcSent(c,h){var d,et,ft,gt;if(this.rpcSentBytes.inc(h),this.rpcSentCount.inc(1),c.subscriptions!=null&&this.rpcSentSubscription.inc(c.subscriptions.length),c.messages!=null&&this.rpcSentMessage.inc(c.messages.length),c.control!=null){const _t=((d=c.control.ihave)==null?void 0:d.length)??0,wt=((et=c.control.iwant)==null?void 0:et.length)??0,$t=((ft=c.control.graft)==null?void 0:ft.length)??0,It=((gt=c.control.prune)==null?void 0:gt.length)??0;_t>0&&this.rpcSentIHave.inc(_t),wt>0&&this.rpcSentIWant.inc(wt),$t>0&&this.rpcSentGraft.inc($t),It>0&&this.rpcSentPrune.inc(It),(_t>0||wt>0||$t>0||It>0)&&this.rpcSentControl.inc(1)}},registerScores(c,h){let d=0,et=0,ft=0,gt=0;for(const _t of c)_t>=h.graylistThreshold&&d++,_t>=h.publishThreshold&&et++,_t>=h.gossipThreshold&&ft++,_t>=0&&gt++;this.peersByScoreThreshold.set({threshold:ScoreThreshold.graylist},d),this.peersByScoreThreshold.set({threshold:ScoreThreshold.publish},et),this.peersByScoreThreshold.set({threshold:ScoreThreshold.gossip},ft),this.peersByScoreThreshold.set({threshold:ScoreThreshold.mesh},gt),this.score.set(c)},registerScoreWeights(c){for(const[h,d]of c.byTopic)this.scoreWeights.set({topic:h,p:"p1"},d.p1w),this.scoreWeights.set({topic:h,p:"p2"},d.p2w),this.scoreWeights.set({topic:h,p:"p3"},d.p3w),this.scoreWeights.set({topic:h,p:"p3b"},d.p3bw),this.scoreWeights.set({topic:h,p:"p4"},d.p4w);this.scoreWeights.set({p:"p5"},c.p5w),this.scoreWeights.set({p:"p6"},c.p6w),this.scoreWeights.set({p:"p7"},c.p7w)},registerScorePerMesh(c,h){const d=new Map;c.forEach((et,ft)=>{const gt=this.topicStrToLabel.get(ft)??"unknown";let _t=d.get(gt);_t==null&&(_t=new Set,d.set(gt,_t)),et.forEach(wt=>_t==null?void 0:_t.add(wt))});for(const[et,ft]of d){const gt=[];ft.forEach(_t=>{gt.push(h.get(_t)??0)}),this.scorePerMesh.set({topic:et},gt)}}}}const ERR_INVALID_PEER_SCORE_PARAMS="ERR_INVALID_PEER_SCORE_PARAMS",defaultPeerScoreParams={topics:{},topicScoreCap:10,appSpecificScore:()=>0,appSpecificWeight:10,IPColocationFactorWeight:-5,IPColocationFactorThreshold:10,IPColocationFactorWhitelist:new Set,behaviourPenaltyWeight:-10,behaviourPenaltyThreshold:0,behaviourPenaltyDecay:.2,decayInterval:1e3,decayToZero:.1,retainScore:3600*1e3},defaultTopicScoreParams={topicWeight:.5,timeInMeshWeight:1,timeInMeshQuantum:1,timeInMeshCap:3600,firstMessageDeliveriesWeight:1,firstMessageDeliveriesDecay:.5,firstMessageDeliveriesCap:2e3,meshMessageDeliveriesWeight:-1,meshMessageDeliveriesDecay:.5,meshMessageDeliveriesCap:100,meshMessageDeliveriesThreshold:20,meshMessageDeliveriesWindow:10,meshMessageDeliveriesActivation:5e3,meshFailurePenaltyWeight:-1,meshFailurePenaltyDecay:.5,invalidMessageDeliveriesWeight:-1,invalidMessageDeliveriesDecay:.3};function createPeerScoreParams(i={}){return{...defaultPeerScoreParams,...i,topics:i.topics!=null?Object.entries(i.topics).reduce((e,[a,c])=>(e[a]=createTopicScoreParams(c),e),{}):{}}}function createTopicScoreParams(i={}){return{...defaultTopicScoreParams,...i}}function validatePeerScoreParams(i){for(const[e,a]of Object.entries(i.topics))try{validateTopicScoreParams(a)}catch(c){throw new CodeError$2(`invalid score parameters for topic ${e}: ${c.message}`,ERR_INVALID_PEER_SCORE_PARAMS)}if(i.topicScoreCap<0)throw new CodeError$2("invalid topic score cap; must be positive (or 0 for no cap)",ERR_INVALID_PEER_SCORE_PARAMS);if(i.appSpecificScore===null||i.appSpecificScore===void 0)throw new CodeError$2("missing application specific score function",ERR_INVALID_PEER_SCORE_PARAMS);if(i.IPColocationFactorWeight>0)throw new CodeError$2("invalid IPColocationFactorWeight; must be negative (or 0 to disable)",ERR_INVALID_PEER_SCORE_PARAMS);if(i.IPColocationFactorWeight!==0&&i.IPColocationFactorThreshold<1)throw new CodeError$2("invalid IPColocationFactorThreshold; must be at least 1",ERR_INVALID_PEER_SCORE_PARAMS);if(i.behaviourPenaltyWeight>0)throw new CodeError$2("invalid BehaviourPenaltyWeight; must be negative (or 0 to disable)",ERR_INVALID_PEER_SCORE_PARAMS);if(i.behaviourPenaltyWeight!==0&&(i.behaviourPenaltyDecay<=0||i.behaviourPenaltyDecay>=1))throw new CodeError$2("invalid BehaviourPenaltyDecay; must be between 0 and 1",ERR_INVALID_PEER_SCORE_PARAMS);if(i.decayInterval<1e3)throw new CodeError$2("invalid DecayInterval; must be at least 1s",ERR_INVALID_PEER_SCORE_PARAMS);if(i.decayToZero<=0||i.decayToZero>=1)throw new CodeError$2("invalid DecayToZero; must be between 0 and 1",ERR_INVALID_PEER_SCORE_PARAMS)}function validateTopicScoreParams(i){if(i.topicWeight<0)throw new CodeError$2("invalid topic weight; must be >= 0",ERR_INVALID_PEER_SCORE_PARAMS);if(i.timeInMeshQuantum===0)throw new CodeError$2("invalid TimeInMeshQuantum; must be non zero",ERR_INVALID_PEER_SCORE_PARAMS);if(i.timeInMeshWeight<0)throw new CodeError$2("invalid TimeInMeshWeight; must be positive (or 0 to disable)",ERR_INVALID_PEER_SCORE_PARAMS);if(i.timeInMeshWeight!==0&&i.timeInMeshQuantum<=0)throw new CodeError$2("invalid TimeInMeshQuantum; must be positive",ERR_INVALID_PEER_SCORE_PARAMS);if(i.timeInMeshWeight!==0&&i.timeInMeshCap<=0)throw new CodeError$2("invalid TimeInMeshCap; must be positive",ERR_INVALID_PEER_SCORE_PARAMS);if(i.firstMessageDeliveriesWeight<0)throw new CodeError$2("invallid FirstMessageDeliveriesWeight; must be positive (or 0 to disable)",ERR_INVALID_PEER_SCORE_PARAMS);if(i.firstMessageDeliveriesWeight!==0&&(i.firstMessageDeliveriesDecay<=0||i.firstMessageDeliveriesDecay>=1))throw new CodeError$2("invalid FirstMessageDeliveriesDecay; must be between 0 and 1",ERR_INVALID_PEER_SCORE_PARAMS);if(i.firstMessageDeliveriesWeight!==0&&i.firstMessageDeliveriesCap<=0)throw new CodeError$2("invalid FirstMessageDeliveriesCap; must be positive",ERR_INVALID_PEER_SCORE_PARAMS);if(i.meshMessageDeliveriesWeight>0)throw new CodeError$2("invalid MeshMessageDeliveriesWeight; must be negative (or 0 to disable)",ERR_INVALID_PEER_SCORE_PARAMS);if(i.meshMessageDeliveriesWeight!==0&&(i.meshMessageDeliveriesDecay<=0||i.meshMessageDeliveriesDecay>=1))throw new CodeError$2("invalid MeshMessageDeliveriesDecay; must be between 0 and 1",ERR_INVALID_PEER_SCORE_PARAMS);if(i.meshMessageDeliveriesWeight!==0&&i.meshMessageDeliveriesCap<=0)throw new CodeError$2("invalid MeshMessageDeliveriesCap; must be positive",ERR_INVALID_PEER_SCORE_PARAMS);if(i.meshMessageDeliveriesWeight!==0&&i.meshMessageDeliveriesThreshold<=0)throw new CodeError$2("invalid MeshMessageDeliveriesThreshold; must be positive",ERR_INVALID_PEER_SCORE_PARAMS);if(i.meshMessageDeliveriesWindow<0)throw new CodeError$2("invalid MeshMessageDeliveriesWindow; must be non-negative",ERR_INVALID_PEER_SCORE_PARAMS);if(i.meshMessageDeliveriesWeight!==0&&i.meshMessageDeliveriesActivation<1e3)throw new CodeError$2("invalid MeshMessageDeliveriesActivation; must be at least 1s",ERR_INVALID_PEER_SCORE_PARAMS);if(i.meshFailurePenaltyWeight>0)throw new CodeError$2("invalid MeshFailurePenaltyWeight; must be negative (or 0 to disable)",ERR_INVALID_PEER_SCORE_PARAMS);if(i.meshFailurePenaltyWeight!==0&&(i.meshFailurePenaltyDecay<=0||i.meshFailurePenaltyDecay>=1))throw new CodeError$2("invalid MeshFailurePenaltyDecay; must be between 0 and 1",ERR_INVALID_PEER_SCORE_PARAMS);if(i.invalidMessageDeliveriesWeight>0)throw new CodeError$2("invalid InvalidMessageDeliveriesWeight; must be negative (or 0 to disable)",ERR_INVALID_PEER_SCORE_PARAMS);if(i.invalidMessageDeliveriesDecay<=0||i.invalidMessageDeliveriesDecay>=1)throw new CodeError$2("invalid InvalidMessageDeliveriesDecay; must be between 0 and 1",ERR_INVALID_PEER_SCORE_PARAMS)}const defaultPeerScoreThresholds={gossipThreshold:-10,publishThreshold:-50,graylistThreshold:-80,acceptPXThreshold:10,opportunisticGraftThreshold:20};function createPeerScoreThresholds(i={}){return{...defaultPeerScoreThresholds,...i}}function removeItemsFromSet(i,e,a=()=>!0){const c=new Set;if(e<=0)return c;for(const h of i){if(c.size>=e)break;a(h)&&(c.add(h),i.delete(h))}return c}function removeFirstNItemsFromSet(i,e){return removeItemsFromSet(i,e,()=>!0)}class MapDef extends Map{constructor(a){super();qt(this,"getDefault");this.getDefault=a}getOrDefault(a){let c=super.get(a);return c===void 0&&(c=this.getDefault(),this.set(a,c)),c}}function computeScore(i,e,a,c){let h=0;Object.entries(e.topics).forEach(([et,ft])=>{const gt=a.topics[et];if(gt===void 0)return;let _t=0;if(ft.inMesh){let Rt=ft.meshTime/gt.timeInMeshQuantum;Rt>gt.timeInMeshCap&&(Rt=gt.timeInMeshCap),_t+=Rt*gt.timeInMeshWeight}let wt=ft.firstMessageDeliveries;if(wt>gt.firstMessageDeliveriesCap&&(wt=gt.firstMessageDeliveriesCap),_t+=wt*gt.firstMessageDeliveriesWeight,ft.meshMessageDeliveriesActive&&ft.meshMessageDeliveries<gt.meshMessageDeliveriesThreshold){const Rt=gt.meshMessageDeliveriesThreshold-ft.meshMessageDeliveries,Tt=Rt*Rt;_t+=Tt*gt.meshMessageDeliveriesWeight}const $t=ft.meshFailurePenalty;_t+=$t*gt.meshFailurePenaltyWeight;const It=ft.invalidMessageDeliveries*ft.invalidMessageDeliveries;_t+=It*gt.invalidMessageDeliveriesWeight,h+=_t*gt.topicWeight}),a.topicScoreCap>0&&h>a.topicScoreCap&&(h=a.topicScoreCap);const d=a.appSpecificScore(i);if(h+=d*a.appSpecificWeight,e.knownIPs.forEach(et=>{if(a.IPColocationFactorWhitelist.has(et))return;const ft=c.get(et),gt=ft!=null?ft.size:0;if(gt>a.IPColocationFactorThreshold){const _t=gt-a.IPColocationFactorThreshold,wt=_t*_t;h+=wt*a.IPColocationFactorWeight}}),e.behaviourPenalty>a.behaviourPenaltyThreshold){const et=e.behaviourPenalty-a.behaviourPenaltyThreshold,ft=et*et;h+=ft*a.behaviourPenaltyWeight}return h}function Denque(i,a){var a=a||{};this._capacity=a.capacity,this._head=0,this._tail=0,Array.isArray(i)?this._fromArray(i):(this._capacityMask=3,this._list=new Array(4))}Denque.prototype.peekAt=function i(e){var a=e;if(a===(a|0)){var c=this.size();if(!(a>=c||a<-c))return a<0&&(a+=c),a=this._head+a&this._capacityMask,this._list[a]}};Denque.prototype.get=function i(e){return this.peekAt(e)};Denque.prototype.peek=function i(){if(this._head!==this._tail)return this._list[this._head]};Denque.prototype.peekFront=function i(){return this.peek()};Denque.prototype.peekBack=function i(){return this.peekAt(-1)};Object.defineProperty(Denque.prototype,"length",{get:function i(){return this.size()}});Denque.prototype.size=function i(){return this._head===this._tail?0:this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)};Denque.prototype.unshift=function i(e){if(arguments.length===0)return this.size();var a=this._list.length;return this._head=this._head-1+a&this._capacityMask,this._list[this._head]=e,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.pop(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)};Denque.prototype.shift=function i(){var e=this._head;if(e!==this._tail){var a=this._list[e];return this._list[e]=void 0,this._head=e+1&this._capacityMask,e<2&&this._tail>1e4&&this._tail<=this._list.length>>>2&&this._shrinkArray(),a}};Denque.prototype.push=function i(e){if(arguments.length===0)return this.size();var a=this._tail;return this._list[a]=e,this._tail=a+1&this._capacityMask,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.shift(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)};Denque.prototype.pop=function i(){var e=this._tail;if(e!==this._head){var a=this._list.length;this._tail=e-1+a&this._capacityMask;var c=this._list[this._tail];return this._list[this._tail]=void 0,this._head<2&&e>1e4&&e<=a>>>2&&this._shrinkArray(),c}};Denque.prototype.removeOne=function i(e){var a=e;if(a===(a|0)&&this._head!==this._tail){var c=this.size(),h=this._list.length;if(!(a>=c||a<-c)){a<0&&(a+=c),a=this._head+a&this._capacityMask;var d=this._list[a],et;if(e<c/2){for(et=e;et>0;et--)this._list[a]=this._list[a=a-1+h&this._capacityMask];this._list[a]=void 0,this._head=this._head+1+h&this._capacityMask}else{for(et=c-1-e;et>0;et--)this._list[a]=this._list[a=a+1+h&this._capacityMask];this._list[a]=void 0,this._tail=this._tail-1+h&this._capacityMask}return d}}};Denque.prototype.remove=function i(e,a){var c=e,h,d=a;if(c===(c|0)&&this._head!==this._tail){var et=this.size(),ft=this._list.length;if(!(c>=et||c<-et||a<1)){if(c<0&&(c+=et),a===1||!a)return h=new Array(1),h[0]=this.removeOne(c),h;if(c===0&&c+a>=et)return h=this.toArray(),this.clear(),h;c+a>et&&(a=et-c);var gt;for(h=new Array(a),gt=0;gt<a;gt++)h[gt]=this._list[this._head+c+gt&this._capacityMask];if(c=this._head+c&this._capacityMask,e+a===et){for(this._tail=this._tail-a+ft&this._capacityMask,gt=a;gt>0;gt--)this._list[c=c+1+ft&this._capacityMask]=void 0;return h}if(e===0){for(this._head=this._head+a+ft&this._capacityMask,gt=a-1;gt>0;gt--)this._list[c=c+1+ft&this._capacityMask]=void 0;return h}if(c<et/2){for(this._head=this._head+e+a+ft&this._capacityMask,gt=e;gt>0;gt--)this.unshift(this._list[c=c-1+ft&this._capacityMask]);for(c=this._head-1+ft&this._capacityMask;d>0;)this._list[c=c-1+ft&this._capacityMask]=void 0,d--;e<0&&(this._tail=c)}else{for(this._tail=c,c=c+a+ft&this._capacityMask,gt=et-(a+e);gt>0;gt--)this.push(this._list[c++]);for(c=this._tail;d>0;)this._list[c=c+1+ft&this._capacityMask]=void 0,d--}return this._head<2&&this._tail>1e4&&this._tail<=ft>>>2&&this._shrinkArray(),h}}};Denque.prototype.splice=function i(e,a){var c=e;if(c===(c|0)){var h=this.size();if(c<0&&(c+=h),!(c>h))if(arguments.length>2){var d,et,ft,gt=arguments.length,_t=this._list.length,wt=2;if(!h||c<h/2){for(et=new Array(c),d=0;d<c;d++)et[d]=this._list[this._head+d&this._capacityMask];for(a===0?(ft=[],c>0&&(this._head=this._head+c+_t&this._capacityMask)):(ft=this.remove(c,a),this._head=this._head+c+_t&this._capacityMask);gt>wt;)this.unshift(arguments[--gt]);for(d=c;d>0;d--)this.unshift(et[d-1])}else{et=new Array(h-(c+a));var $t=et.length;for(d=0;d<$t;d++)et[d]=this._list[this._head+c+a+d&this._capacityMask];for(a===0?(ft=[],c!=h&&(this._tail=this._head+c+_t&this._capacityMask)):(ft=this.remove(c,a),this._tail=this._tail-$t+_t&this._capacityMask);wt<gt;)this.push(arguments[wt++]);for(d=0;d<$t;d++)this.push(et[d])}return ft}else return this.remove(c,a)}};Denque.prototype.clear=function i(){this._list=new Array(this._list.length),this._head=0,this._tail=0};Denque.prototype.isEmpty=function i(){return this._head===this._tail};Denque.prototype.toArray=function i(){return this._copyArray(!1)};Denque.prototype._fromArray=function i(e){var a=e.length,c=this._nextPowerOf2(a);this._list=new Array(c),this._capacityMask=c-1,this._tail=a;for(var h=0;h<a;h++)this._list[h]=e[h]};Denque.prototype._copyArray=function i(e,a){var c=this._list,h=c.length,d=this.length;if(a=a|d,a==d&&this._head<this._tail)return this._list.slice(this._head,this._tail);var et=new Array(a),ft=0,gt;if(e||this._head>this._tail){for(gt=this._head;gt<h;gt++)et[ft++]=c[gt];for(gt=0;gt<this._tail;gt++)et[ft++]=c[gt]}else for(gt=this._head;gt<this._tail;gt++)et[ft++]=c[gt];return et};Denque.prototype._growArray=function i(){if(this._head!=0){var e=this._copyArray(!0,this._list.length<<1);this._tail=this._list.length,this._head=0,this._list=e}else this._tail=this._list.length,this._list.length<<=1;this._capacityMask=this._capacityMask<<1|1};Denque.prototype._shrinkArray=function i(){this._list.length>>>=1,this._capacityMask>>>=1};Denque.prototype._nextPowerOf2=function i(e){var a=Math.log(e)/Math.log(2),c=1<<a+1;return Math.max(c,4)};var denque=Denque;const Denque$1=getDefaultExportFromCjs(denque);var DeliveryRecordStatus;(function(i){i[i.unknown=0]="unknown",i[i.valid=1]="valid",i[i.invalid=2]="invalid",i[i.ignored=3]="ignored"})(DeliveryRecordStatus||(DeliveryRecordStatus={}));class MessageDeliveries{constructor(){qt(this,"records");qt(this,"queue");this.records=new Map,this.queue=new Denque$1}getRecord(e){return this.records.get(e)}ensureRecord(e){let a=this.records.get(e);if(a!=null)return a;a={status:DeliveryRecordStatus.unknown,firstSeenTsMs:Date.now(),validated:0,peers:new Set},this.records.set(e,a);const c={msgId:e,expire:Date.now()+TimeCacheDuration};return this.queue.push(c),a}gc(){const e=Date.now();let a=this.queue.peekFront();for(;a!=null&&a.expire<e;)this.records.delete(a.msgId),this.queue.shift(),a=this.queue.peekFront()}clear(){this.records.clear(),this.queue.clear()}}const log$e=logger$2("libp2p:gossipsub:score");class PeerScore{constructor(e,a,c){qt(this,"params");qt(this,"metrics");qt(this,"peerStats",new Map);qt(this,"peerIPs",new MapDef(()=>new Set));qt(this,"scoreCache",new Map);qt(this,"deliveryRecords",new MessageDeliveries);qt(this,"_backgroundInterval");qt(this,"scoreCacheValidityMs");qt(this,"computeScore");this.params=e,this.metrics=a,validatePeerScoreParams(e),this.scoreCacheValidityMs=c.scoreCacheValidityMs,this.computeScore=c.computeScore??computeScore}get size(){return this.peerStats.size}start(){if(this._backgroundInterval!=null){log$e("Peer score already running");return}this._backgroundInterval=setInterval(()=>{this.background()},this.params.decayInterval),log$e("started")}stop(){if(this._backgroundInterval==null){log$e("Peer score already stopped");return}clearInterval(this._backgroundInterval),delete this._backgroundInterval,this.peerIPs.clear(),this.peerStats.clear(),this.deliveryRecords.clear(),log$e("stopped")}background(){this.refreshScores(),this.deliveryRecords.gc()}dumpPeerScoreStats(){return Object.fromEntries(Array.from(this.peerStats.entries()).map(([e,a])=>[e,a]))}messageFirstSeenTimestampMs(e){const a=this.deliveryRecords.getRecord(e);return a!=null?a.firstSeenTsMs:null}refreshScores(){const e=Date.now(),a=this.params.decayToZero;this.peerStats.forEach((c,h)=>{if(!c.connected){e>c.expire&&(this.removeIPsForPeer(h,c.knownIPs),this.peerStats.delete(h),this.scoreCache.delete(h));return}Object.entries(c.topics).forEach(([d,et])=>{const ft=this.params.topics[d];ft!==void 0&&(et.firstMessageDeliveries*=ft.firstMessageDeliveriesDecay,et.firstMessageDeliveries<a&&(et.firstMessageDeliveries=0),et.meshMessageDeliveries*=ft.meshMessageDeliveriesDecay,et.meshMessageDeliveries<a&&(et.meshMessageDeliveries=0),et.meshFailurePenalty*=ft.meshFailurePenaltyDecay,et.meshFailurePenalty<a&&(et.meshFailurePenalty=0),et.invalidMessageDeliveries*=ft.invalidMessageDeliveriesDecay,et.invalidMessageDeliveries<a&&(et.invalidMessageDeliveries=0),et.inMesh&&(et.meshTime=e-et.graftTime,et.meshTime>ft.meshMessageDeliveriesActivation&&(et.meshMessageDeliveriesActive=!0)))}),c.behaviourPenalty*=this.params.behaviourPenaltyDecay,c.behaviourPenalty<a&&(c.behaviourPenalty=0)})}score(e){var ft,gt,_t;(ft=this.metrics)==null||ft.scoreFnCalls.inc();const a=this.peerStats.get(e);if(a==null)return 0;const c=Date.now(),h=this.scoreCache.get(e);if(h!=null&&h.cacheUntil>c)return h.score;(gt=this.metrics)==null||gt.scoreFnRuns.inc();const d=this.computeScore(e,a,this.params,this.peerIPs),et=c+this.scoreCacheValidityMs;return h!=null?((_t=this.metrics)==null||_t.scoreCachedDelta.observe(Math.abs(d-h.score)),h.score=d,h.cacheUntil=et):this.scoreCache.set(e,{score:d,cacheUntil:et}),d}addPenalty(e,a,c){var d;const h=this.peerStats.get(e);h!=null&&(h.behaviourPenalty+=a,(d=this.metrics)==null||d.onScorePenalty(c))}addPeer(e){const a={connected:!0,expire:0,topics:{},knownIPs:new Set,behaviourPenalty:0};this.peerStats.set(e,a)}addIP(e,a){const c=this.peerStats.get(e);c!=null&&c.knownIPs.add(a),this.peerIPs.getOrDefault(a).add(e)}removeIP(e,a){const c=this.peerStats.get(e);c!=null&&c.knownIPs.delete(a);const h=this.peerIPs.get(a);h!=null&&(h.delete(e),h.size===0&&this.peerIPs.delete(a))}removePeer(e){const a=this.peerStats.get(e);if(a!=null){if(this.score(e)>0){this.removeIPsForPeer(e,a.knownIPs),this.peerStats.delete(e);return}Object.entries(a.topics).forEach(([c,h])=>{h.firstMessageDeliveries=0;const d=this.params.topics[c].meshMessageDeliveriesThreshold;if(h.inMesh&&h.meshMessageDeliveriesActive&&h.meshMessageDeliveries<d){const et=d-h.meshMessageDeliveries;h.meshFailurePenalty+=et*et}h.inMesh=!1,h.meshMessageDeliveriesActive=!1}),a.connected=!1,a.expire=Date.now()+this.params.retainScore}}graft(e,a){const c=this.peerStats.get(e);if(c!=null){const h=this.getPtopicStats(c,a);h!=null&&(h.inMesh=!0,h.graftTime=Date.now(),h.meshTime=0,h.meshMessageDeliveriesActive=!1)}}prune(e,a){const c=this.peerStats.get(e);if(c!=null){const h=this.getPtopicStats(c,a);if(h!=null){const d=this.params.topics[a].meshMessageDeliveriesThreshold;if(h.meshMessageDeliveriesActive&&h.meshMessageDeliveries<d){const et=d-h.meshMessageDeliveries;h.meshFailurePenalty+=et*et}h.meshMessageDeliveriesActive=!1,h.inMesh=!1}}}validateMessage(e){this.deliveryRecords.ensureRecord(e)}deliverMessage(e,a,c){this.markFirstMessageDelivery(e,c);const h=this.deliveryRecords.ensureRecord(a),d=Date.now();if(h.status!==DeliveryRecordStatus.unknown){log$e("unexpected delivery: message from %s was first seen %s ago and has delivery status %s",e,d-h.firstSeenTsMs,DeliveryRecordStatus[h.status]);return}h.status=DeliveryRecordStatus.valid,h.validated=d,h.peers.forEach(et=>{et!==e.toString()&&this.markDuplicateMessageDelivery(et,c)})}rejectInvalidMessage(e,a){this.markInvalidMessageDelivery(e,a)}rejectMessage(e,a,c,h){switch(h){case RejectReason.Error:this.markInvalidMessageDelivery(e,c);return;case RejectReason.Blacklisted:return}const d=this.deliveryRecords.ensureRecord(a);if(d.status!==DeliveryRecordStatus.unknown){log$e("unexpected rejection: message from %s was first seen %s ago and has delivery status %d",e,Date.now()-d.firstSeenTsMs,DeliveryRecordStatus[d.status]);return}if(h===RejectReason.Ignore){d.status=DeliveryRecordStatus.ignored,d.peers.clear();return}d.status=DeliveryRecordStatus.invalid,this.markInvalidMessageDelivery(e,c),d.peers.forEach(et=>{this.markInvalidMessageDelivery(et,c)}),d.peers.clear()}duplicateMessage(e,a,c){const h=this.deliveryRecords.ensureRecord(a);if(!h.peers.has(e))switch(h.status){case DeliveryRecordStatus.unknown:h.peers.add(e);break;case DeliveryRecordStatus.valid:h.peers.add(e),this.markDuplicateMessageDelivery(e,c,h.validated);break;case DeliveryRecordStatus.invalid:this.markInvalidMessageDelivery(e,c);break;case DeliveryRecordStatus.ignored:break}}markInvalidMessageDelivery(e,a){const c=this.peerStats.get(e);if(c!=null){const h=this.getPtopicStats(c,a);h!=null&&(h.invalidMessageDeliveries+=1)}}markFirstMessageDelivery(e,a){const c=this.peerStats.get(e);if(c!=null){const h=this.getPtopicStats(c,a);if(h!=null){let d=this.params.topics[a].firstMessageDeliveriesCap;h.firstMessageDeliveries=Math.min(d,h.firstMessageDeliveries+1),h.inMesh&&(d=this.params.topics[a].meshMessageDeliveriesCap,h.meshMessageDeliveries=Math.min(d,h.meshMessageDeliveries+1))}}}markDuplicateMessageDelivery(e,a,c){var d;const h=this.peerStats.get(e);if(h!=null){const et=c!==void 0?Date.now():0,ft=this.getPtopicStats(h,a);if(ft!=null&&ft.inMesh){const gt=this.params.topics[a];if(c!==void 0){const wt=et-c,$t=wt>gt.meshMessageDeliveriesWindow;if((d=this.metrics)==null||d.onDuplicateMsgDelivery(a,wt,$t),$t)return}const _t=gt.meshMessageDeliveriesCap;ft.meshMessageDeliveries=Math.min(_t,ft.meshMessageDeliveries+1)}}}removeIPsForPeer(e,a){for(const c of a){const h=this.peerIPs.get(c);h!=null&&(h.delete(e),h.size===0&&this.peerIPs.delete(c))}}getPtopicStats(e,a){let c=e.topics[a];return c!==void 0?c:this.params.topics[a]!==void 0?(c={inMesh:!1,graftTime:0,meshTime:0,firstMessageDeliveries:0,meshMessageDeliveries:0,meshMessageDeliveriesActive:!1,meshFailurePenalty:0,invalidMessageDeliveries:0},e.topics[a]=c,c):null}}function computeScoreWeights(i,e,a,c,h){let d=0;const et=new Map;if(Object.entries(e.topics).forEach(([It,Rt])=>{const Tt=h.get(It)??"unknown",At=a.topics[It];if(At===void 0)return;let kt=et.get(Tt);kt==null&&(kt={p1w:0,p2w:0,p3w:0,p3bw:0,p4w:0},et.set(Tt,kt));let xt=0,Nt=0,Ft=0,jt=0,Gt=0;if(Rt.inMesh){const cr=Math.max(Rt.meshTime/At.timeInMeshQuantum,At.timeInMeshCap);xt+=cr*At.timeInMeshWeight}let Kt=Rt.firstMessageDeliveries;if(Kt>At.firstMessageDeliveriesCap&&(Kt=At.firstMessageDeliveriesCap),Nt+=Kt*At.firstMessageDeliveriesWeight,Rt.meshMessageDeliveriesActive&&Rt.meshMessageDeliveries<At.meshMessageDeliveriesThreshold){const cr=At.meshMessageDeliveriesThreshold-Rt.meshMessageDeliveries,hr=cr*cr;Ft+=hr*At.meshMessageDeliveriesWeight}const Wt=Rt.meshFailurePenalty;jt+=Wt*At.meshFailurePenaltyWeight;const Zt=Rt.invalidMessageDeliveries*Rt.invalidMessageDeliveries;Gt+=Zt*At.invalidMessageDeliveriesWeight,d+=(xt+Nt+Ft+jt+Gt)*At.topicWeight,kt.p1w+=xt,kt.p2w+=Nt,kt.p3w+=Ft,kt.p3bw+=jt,kt.p4w+=Gt}),a.topicScoreCap>0&&d>a.topicScoreCap){d=a.topicScoreCap;const It=a.topicScoreCap/d;for(const Rt of et.values())Rt.p1w*=It,Rt.p2w*=It,Rt.p3w*=It,Rt.p3bw*=It,Rt.p4w*=It}let ft=0,gt=0,_t=0;const wt=a.appSpecificScore(i);ft+=wt*a.appSpecificWeight,e.knownIPs.forEach(It=>{if(a.IPColocationFactorWhitelist.has(It))return;const Rt=c.get(It),Tt=Rt!=null?Rt.size:0;if(Tt>a.IPColocationFactorThreshold){const At=Tt-a.IPColocationFactorThreshold,kt=At*At;gt+=kt*a.IPColocationFactorWeight}});const $t=e.behaviourPenalty*e.behaviourPenalty;return _t+=$t*a.behaviourPenaltyWeight,d+=ft+gt+_t,{byTopic:et,p5w:ft,p6w:gt,p7w:_t,score:d}}function computeAllPeersScoreWeights(i,e,a,c,h){const d={byTopic:new Map,p5w:[],p6w:[],p7w:[],score:[]};for(const et of i){const ft=e.get(et);if(ft!=null){const gt=computeScoreWeights(et,ft,a,c,h);for(const[_t,wt]of gt.byTopic){let $t=d.byTopic.get(_t);$t==null&&($t={p1w:[],p2w:[],p3w:[],p3bw:[],p4w:[]},d.byTopic.set(_t,$t)),$t.p1w.push(wt.p1w),$t.p2w.push(wt.p2w),$t.p3w.push(wt.p3w),$t.p3bw.push(wt.p3bw),$t.p4w.push(wt.p4w)}d.p5w.push(gt.p5w),d.p6w.push(gt.p6w),d.p7w.push(gt.p7w),d.score.push(gt.score)}else d.p5w.push(0),d.p6w.push(0),d.p7w.push(0),d.score.push(0)}return d}class OutboundStream{constructor(e,a,c){qt(this,"rawStream");qt(this,"pushable");qt(this,"closeController");qt(this,"maxBufferSize");this.rawStream=e,this.pushable=pushable$1({objectMode:!1}),this.closeController=new AbortController,this.maxBufferSize=c.maxBufferSize??1/0,pipe(abortableSource(this.pushable,this.closeController.signal,{returnOnAbort:!0}),h=>encode$c(h),this.rawStream).catch(a)}get protocol(){return this.rawStream.protocol}push(e){if(this.pushable.readableLength>this.maxBufferSize)throw Error(`OutboundStream buffer full, size > ${this.maxBufferSize}`);this.pushable.push(e)}async close(){this.closeController.abort(),await this.pushable.return(),await this.rawStream.close()}}class InboundStream{constructor(e,a={}){qt(this,"source");qt(this,"rawStream");qt(this,"closeController");this.rawStream=e,this.closeController=new AbortController,this.source=abortableSource(pipe(this.rawStream,c=>decode$b(c,a)),this.closeController.signal,{returnOnAbort:!0})}async close(){this.closeController.abort(),await this.rawStream.close()}}class IWantTracer{constructor(e,a,c){qt(this,"gossipsubIWantFollowupMs");qt(this,"msgIdToStrFn");qt(this,"metrics");qt(this,"promises",new Map);qt(this,"requestMsByMsg",new Map);qt(this,"requestMsByMsgExpire");this.gossipsubIWantFollowupMs=e,this.msgIdToStrFn=a,this.metrics=c,this.requestMsByMsgExpire=10*e}get size(){return this.promises.size}get requestMsByMsgSize(){return this.requestMsByMsg.size}addPromise(e,a){const c=Math.floor(Math.random()*a.length),h=a[c],d=this.msgIdToStrFn(h);let et=this.promises.get(d);et==null&&(et=new Map,this.promises.set(d,et));const ft=Date.now();et.has(e)||(et.set(e,ft+this.gossipsubIWantFollowupMs),this.metrics!=null&&(this.metrics.iwantPromiseStarted.inc(1),this.requestMsByMsg.has(d)||this.requestMsByMsg.set(d,ft)))}getBrokenPromises(){var h;const e=Date.now(),a=new Map;let c=0;return this.promises.forEach((d,et)=>{d.forEach((ft,gt)=>{ft<e&&(a.set(gt,(a.get(gt)??0)+1),d.delete(gt),c++)}),d.size===0&&this.promises.delete(et)}),(h=this.metrics)==null||h.iwantPromiseBroken.inc(c),a}deliverMessage(e,a=!1){this.trackMessage(e);const c=this.promises.get(e);c!=null&&(this.promises.delete(e),this.metrics!=null&&(this.metrics.iwantPromiseResolved.inc(1),a&&this.metrics.iwantPromiseResolvedFromDuplicate.inc(1),this.metrics.iwantPromiseResolvedPeers.inc(c.size)))}rejectMessage(e,a){switch(this.trackMessage(e),a){case RejectReason.Error:return}this.promises.delete(e)}clear(){this.promises.clear()}prune(){var c;const e=Date.now()-this.requestMsByMsgExpire;let a=0;for(const[h,d]of this.requestMsByMsg.entries())if(d<e)this.requestMsByMsg.delete(h),a++;else break;(c=this.metrics)==null||c.iwantMessagePruned.inc(a)}trackMessage(e){if(this.metrics!=null){const a=this.requestMsByMsg.get(e);a!==void 0&&(this.metrics.iwantPromiseDeliveryTime.observe((Date.now()-a)/1e3),this.requestMsByMsg.delete(e))}}}const hashName={sha1:"sha1","sha2-256":"sha256","sha2-512":"sha512"};function pbkdf2(i,e,a,c,h){if(h!=="sha1"&&h!=="sha2-256"&&h!=="sha2-512"){const ft=Object.keys(hashName).join(" / ");throw new CodeError$2(`Hash '${h}' is unknown or not supported. Must be ${ft}`,"ERR_UNSUPPORTED_HASH_TYPE")}const d=hashName[h],et=forgePbkdf2(i,e,a,c,d);return forgeUtil.encode64(et,null)}const SignPrefix=fromString$9("libp2p-pubsub:");async function buildRawMessage(i,e,a,c){switch(i.type){case PublishConfigType.Signing:{const h={from:i.author.toBytes(),data:c,seqno:randomBytes(8),topic:e,signature:void 0,key:void 0},d=concat([SignPrefix,RPC.Message.encode(h).finish()]);h.signature=await i.privateKey.sign(d),h.key=i.key;const et={type:"signed",from:i.author,data:a,sequenceNumber:BigInt(`0x${toString$d(h.seqno,"base16")}`),topic:e,signature:h.signature,key:h.key};return{raw:h,msg:et}}case PublishConfigType.Anonymous:return{raw:{from:void 0,data:c,seqno:void 0,topic:e,signature:void 0,key:void 0},msg:{type:"unsigned",data:a,topic:e}};default:throw new Error("Unreachable")}}async function validateToRawMessage(i,e){switch(i){case StrictNoSign:return e.signature!=null?{valid:!1,error:ValidateError.SignaturePresent}:e.seqno!=null?{valid:!1,error:ValidateError.SeqnoPresent}:e.key!=null?{valid:!1,error:ValidateError.FromPresent}:{valid:!0,message:{type:"unsigned",topic:e.topic,data:e.data??new Uint8Array(0)}};case StrictSign:{if(e.seqno==null)return{valid:!1,error:ValidateError.InvalidSeqno};if(e.seqno.length!==8)return{valid:!1,error:ValidateError.InvalidSeqno};if(e.signature==null)return{valid:!1,error:ValidateError.InvalidSignature};if(e.from==null)return{valid:!1,error:ValidateError.InvalidPeerId};let a;try{a=peerIdFromBytes(e.from)}catch{return{valid:!1,error:ValidateError.InvalidPeerId}}let c;if(e.key!=null){if(c=unmarshalPublicKey(e.key),a.publicKey!==void 0&&!equals$1(c.bytes,a.publicKey))return{valid:!1,error:ValidateError.InvalidPeerId}}else{if(a.publicKey==null)return{valid:!1,error:ValidateError.InvalidPeerId};c=unmarshalPublicKey(a.publicKey)}const h={from:e.from,data:e.data,seqno:e.seqno,topic:e.topic,signature:void 0,key:void 0},d=concat([SignPrefix,RPC.Message.encode(h).finish()]);return await c.verify(d,e.signature)?{valid:!0,message:{type:"signed",from:a,data:e.data??new Uint8Array(0),sequenceNumber:BigInt(`0x${toString$d(e.seqno,"base16")}`),topic:e.topic,signature:e.signature,key:e.key??marshalPublicKey(c)}}:{valid:!1,error:ValidateError.InvalidSignature}}default:throw new Error("Unreachable")}}function shuffle(i){if(i.length<=1)return i;const e=()=>Math.floor(Math.random()*Math.floor(i.length));for(let a=0;a<i.length;a++){const c=e(),h=i[a];i[a]=i[c],i[c]=h}return i}function messageIdToString(i){return toString$d(i,"base64")}async function getPublishConfigFromPeerId(i,e){switch(i){case StrictSign:{if(e==null)throw Error("Must provide PeerId");if(e.privateKey==null)throw Error("Cannot sign message, no private key present");if(e.publicKey==null)throw Error("Cannot sign message, no public key present");const a=await unmarshalPrivateKey(e.privateKey);return{type:PublishConfigType.Signing,author:e,key:e.publicKey,privateKey:a}}case StrictNoSign:return{type:PublishConfigType.Anonymous};default:throw new Error(`Unknown signature policy "${i}"`)}}const msgId=(i,e)=>{const a=fromString$9(e.toString(16).padStart(16,"0"),"base16"),c=new Uint8Array(i.length+a.length);return c.set(i,0),c.set(a,i.length),c};function msgIdFnStrictSign(i){if(i.type!=="signed")throw new Error("expected signed message type");if(i.sequenceNumber==null)throw Error("missing seqno field");return msgId(i.from.toBytes(),i.sequenceNumber)}async function msgIdFnStrictNoSign(i){return sha256$2.encode(i.data)}var Protocol;(function(i){i[i.ip4=4]="ip4",i[i.ip6=41]="ip6"})(Protocol||(Protocol={}));function multiaddrToIPStr(i){for(const e of i.tuples())switch(e[0]){case Protocol.ip4:case Protocol.ip6:return convertToString(e[0],e[1])}return null}class SimpleTimeCache{constructor(e){qt(this,"entries",new Map);qt(this,"validityMs");this.validityMs=e.validityMs}get size(){return this.entries.size}put(e,a){return this.entries.has(e)?!0:(this.entries.set(e,{value:a,validUntilMs:Date.now()+this.validityMs}),!1)}prune(){const e=Date.now();for(const[a,c]of this.entries.entries())if(c.validUntilMs<e)this.entries.delete(a);else break}has(e){return this.entries.has(e)}get(e){const a=this.entries.get(e);return a!=null&&a.validUntilMs>=Date.now()?a.value:void 0}clear(){this.entries.clear()}}var GossipStatusCode;(function(i){i[i.started=0]="started",i[i.stopped=1]="stopped"})(GossipStatusCode||(GossipStatusCode={}));class GossipSub extends TypedEventEmitter{constructor(a,c={}){super();qt(this,"globalSignaturePolicy");qt(this,"multicodecs",[GossipsubIDv11,GossipsubIDv10]);qt(this,"publishConfig");qt(this,"dataTransform");qt(this,"peers",new Set);qt(this,"streamsInbound",new Map);qt(this,"streamsOutbound",new Map);qt(this,"outboundInflightQueue",pushable$1({objectMode:!0}));qt(this,"direct",new Set);qt(this,"floodsubPeers",new Set);qt(this,"seenCache");qt(this,"acceptFromWhitelist",new Map);qt(this,"topics",new Map);qt(this,"subscriptions",new Set);qt(this,"mesh",new Map);qt(this,"fanout",new Map);qt(this,"fanoutLastpub",new Map);qt(this,"gossip",new Map);qt(this,"control",new Map);qt(this,"peerhave",new Map);qt(this,"iasked",new Map);qt(this,"backoff",new Map);qt(this,"outbound",new Map);qt(this,"msgIdFn");qt(this,"fastMsgIdFn");qt(this,"msgIdToStrFn");qt(this,"fastMsgIdCache");qt(this,"publishedMessageIds");qt(this,"mcache");qt(this,"score");qt(this,"topicValidators",new Map);qt(this,"log");qt(this,"heartbeatTicks",0);qt(this,"gossipTracer");qt(this,"components");qt(this,"directPeerInitial",null);qt(this,"opts");qt(this,"decodeRpcLimits");qt(this,"metrics");qt(this,"status",{code:GossipStatusCode.stopped});qt(this,"maxInboundStreams");qt(this,"maxOutboundStreams");qt(this,"allowedTopics");qt(this,"heartbeatTimer",null);qt(this,"runHeartbeat",()=>{var c;const a=(c=this.metrics)==null?void 0:c.heartbeatDuration.startTimer();this.heartbeat().catch(h=>{this.log("Error running heartbeat",h)}).finally(()=>{var h;if(a!=null&&a(),this.status.code===GossipStatusCode.started){clearTimeout(this.status.heartbeatTimeout);let d=this.opts.heartbeatInterval-(Date.now()-this.status.hearbeatStartMs)%this.opts.heartbeatInterval;d<this.opts.heartbeatInterval*.25&&(d+=this.opts.heartbeatInterval,(h=this.metrics)==null||h.heartbeatSkipped.inc()),this.status.heartbeatTimeout=setTimeout(this.runHeartbeat,d)}})});const h={fallbackToFloodsub:!0,floodPublish:!0,doPX:!1,directPeers:[],D:GossipsubD,Dlo:GossipsubDlo,Dhi:GossipsubDhi,Dscore:GossipsubDscore,Dout:GossipsubDout,Dlazy:GossipsubDlazy,heartbeatInterval:GossipsubHeartbeatInterval,fanoutTTL:GossipsubFanoutTTL,mcacheLength:GossipsubHistoryLength,mcacheGossip:GossipsubHistoryGossip,seenTTL:GossipsubSeenTTL,gossipsubIWantFollowupMs:GossipsubIWantFollowupTime,prunePeers:GossipsubPrunePeers,pruneBackoff:GossipsubPruneBackoff,unsubcribeBackoff:GossipsubUnsubscribeBackoff,graftFloodThreshold:GossipsubGraftFloodThreshold,opportunisticGraftPeers:GossipsubOpportunisticGraftPeers,opportunisticGraftTicks:GossipsubOpportunisticGraftTicks,directConnectTicks:GossipsubDirectConnectTicks,...c,scoreParams:createPeerScoreParams(c.scoreParams),scoreThresholds:createPeerScoreThresholds(c.scoreThresholds)};if(this.components=a,this.decodeRpcLimits=h.decodeRpcLimits??defaultDecodeRpcLimits,this.globalSignaturePolicy=h.globalSignaturePolicy??StrictSign,h.fallbackToFloodsub&&this.multicodecs.push(FloodsubID),this.log=logger$2(h.debugName??"libp2p:gossipsub"),this.opts=h,this.direct=new Set(h.directPeers.map(d=>d.id.toString())),this.seenCache=new SimpleTimeCache({validityMs:h.seenTTL}),this.publishedMessageIds=new SimpleTimeCache({validityMs:h.seenTTL}),c.msgIdFn!=null)this.msgIdFn=c.msgIdFn;else switch(this.globalSignaturePolicy){case StrictSign:this.msgIdFn=msgIdFnStrictSign;break;case StrictNoSign:this.msgIdFn=msgIdFnStrictNoSign;break;default:throw new Error(`Invalid globalSignaturePolicy: ${this.globalSignaturePolicy}`)}if(c.fastMsgIdFn!=null&&(this.fastMsgIdFn=c.fastMsgIdFn,this.fastMsgIdCache=new SimpleTimeCache({validityMs:h.seenTTL})),this.msgIdToStrFn=c.msgIdToStrFn??messageIdToString,this.mcache=c.messageCache??new MessageCache(h.mcacheGossip,h.mcacheLength,this.msgIdToStrFn),c.dataTransform!=null&&(this.dataTransform=c.dataTransform),c.metricsRegister!=null){if(c.metricsTopicStrToLabel==null)throw Error("Must set metricsTopicStrToLabel with metrics");const d=Math.max(...Object.values(h.scoreParams.topics).map(ft=>ft.meshMessageDeliveriesWindow),DEFAULT_METRIC_MESH_MESSAGE_DELIVERIES_WINDOWS),et=getMetrics(c.metricsRegister,c.metricsTopicStrToLabel,{gossipPromiseExpireSec:this.opts.gossipsubIWantFollowupMs/1e3,behaviourPenaltyThreshold:h.scoreParams.behaviourPenaltyThreshold,maxMeshMessageDeliveriesWindowSec:d/1e3});et.mcacheSize.addCollect(()=>{this.onScrapeMetrics(et)});for(const ft of this.multicodecs)et.protocolsEnabled.set({protocol:ft},1);this.metrics=et}else this.metrics=null;this.gossipTracer=new IWantTracer(this.opts.gossipsubIWantFollowupMs,this.msgIdToStrFn,this.metrics),this.score=new PeerScore(this.opts.scoreParams,this.metrics,{scoreCacheValidityMs:h.heartbeatInterval}),this.maxInboundStreams=c.maxInboundStreams,this.maxOutboundStreams=c.maxOutboundStreams,this.allowedTopics=h.allowedTopics!=null?new Set(h.allowedTopics):null}getPeers(){return[...this.peers.keys()].map(a=>peerIdFromString(a))}isStarted(){return this.status.code===GossipStatusCode.started}async start(){if(this.isStarted())return;this.log("starting"),this.publishConfig=await getPublishConfigFromPeerId(this.globalSignaturePolicy,this.components.peerId),this.outboundInflightQueue=pushable$1({objectMode:!0}),pipe(this.outboundInflightQueue,async et=>{for await(const{peerId:ft,connection:gt}of et)await this.createOutboundStream(ft,gt)}).catch(et=>{this.log.error("outbound inflight queue error",et)}),await Promise.all(this.opts.directPeers.map(async et=>{await this.components.peerStore.merge(et.id,{multiaddrs:et.addrs})}));const a=this.components.registrar;await Promise.all(this.multicodecs.map(async et=>a.handle(et,this.onIncomingStream.bind(this),{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams})));const c={onConnect:this.onPeerConnected.bind(this),onDisconnect:this.onPeerDisconnected.bind(this)},h=await Promise.all(this.multicodecs.map(async et=>a.register(et,c))),d=setTimeout(this.runHeartbeat,GossipsubHeartbeatInitialDelay);this.status={code:GossipStatusCode.started,registrarTopologyIds:h,heartbeatTimeout:d,hearbeatStartMs:Date.now()+GossipsubHeartbeatInitialDelay},this.score.start(),this.directPeerInitial=setTimeout(()=>{Promise.resolve().then(async()=>{await Promise.all(Array.from(this.direct).map(async et=>this.connect(et)))}).catch(et=>{this.log(et)})},GossipsubDirectConnectInitialDelay),this.log("started")}async stop(){if(this.log("stopping"),this.status.code!==GossipStatusCode.started)return;const{registrarTopologyIds:a}=this.status;this.status={code:GossipStatusCode.stopped};const c=this.components.registrar;await Promise.all(this.multicodecs.map(async d=>c.unhandle(d))),a.forEach(d=>{c.unregister(d)}),this.outboundInflightQueue.end();const h=[];for(const d of this.streamsOutbound.values())h.push(d.close());this.streamsOutbound.clear();for(const d of this.streamsInbound.values())h.push(d.close());this.streamsInbound.clear(),await Promise.all(h),this.peers.clear(),this.subscriptions.clear(),this.heartbeatTimer!=null&&(this.heartbeatTimer.cancel(),this.heartbeatTimer=null),this.score.stop(),this.mesh.clear(),this.fanout.clear(),this.fanoutLastpub.clear(),this.gossip.clear(),this.control.clear(),this.peerhave.clear(),this.iasked.clear(),this.backoff.clear(),this.outbound.clear(),this.gossipTracer.clear(),this.seenCache.clear(),this.fastMsgIdCache!=null&&this.fastMsgIdCache.clear(),this.directPeerInitial!=null&&clearTimeout(this.directPeerInitial),this.log("stopped")}dumpPeerScoreStats(){return this.score.dumpPeerScoreStats()}onIncomingStream({stream:a,connection:c}){if(!this.isStarted())return;const h=c.remotePeer;this.addPeer(h,c.direction,c.remoteAddr),this.createInboundStream(h,a),this.outboundInflightQueue.push({peerId:h,connection:c})}onPeerConnected(a,c){var h;(h=this.metrics)==null||h.newConnectionCount.inc({status:c.status}),!(!this.isStarted()||c.status!=="open")&&(this.addPeer(a,c.direction,c.remoteAddr),this.outboundInflightQueue.push({peerId:a,connection:c}))}onPeerDisconnected(a){this.log("connection ended %p",a),this.removePeer(a)}async createOutboundStream(a,c){var d;if(!this.isStarted())return;const h=a.toString();if(this.peers.has(h)&&!this.streamsOutbound.has(h))try{const et=new OutboundStream(await c.newStream(this.multicodecs),gt=>{this.log.error("outbound pipe error",gt)},{maxBufferSize:this.opts.maxOutboundBufferSize});this.log("create outbound stream %p",a),this.streamsOutbound.set(h,et);const ft=et.protocol;ft===FloodsubID&&this.floodsubPeers.add(h),(d=this.metrics)==null||d.peersPerProtocol.inc({protocol:ft},1),this.subscriptions.size>0&&(this.log("send subscriptions to",h),this.sendSubscriptions(h,Array.from(this.subscriptions),!0))}catch(et){this.log.error("createOutboundStream error",et)}}createInboundStream(a,c){if(!this.isStarted())return;const h=a.toString();if(!this.peers.has(h))return;const d=this.streamsInbound.get(h);d!==void 0&&(this.log("replacing existing inbound steam %s",h),d.close().catch(ft=>{this.log.error(ft)})),this.log("create inbound stream %s",h);const et=new InboundStream(c,{maxDataLength:this.opts.maxInboundDataLength});this.streamsInbound.set(h,et),this.pipePeerReadStream(a,et.source).catch(ft=>{this.log(ft)})}addPeer(a,c,h){const d=a.toString();if(!this.peers.has(d)){this.log("new peer %p",a),this.peers.add(d),this.score.addPeer(d);const et=multiaddrToIPStr(h);et!==null?this.score.addIP(d,et):this.log("Added peer has no IP in current address %s %s",d,h.toString()),this.outbound.has(d)||this.outbound.set(d,c==="outbound")}}removePeer(a){var et,ft;const c=a.toString();if(!this.peers.has(c))return;this.log("delete peer %p",a),this.peers.delete(c);const h=this.streamsOutbound.get(c),d=this.streamsInbound.get(c);h!=null&&((et=this.metrics)==null||et.peersPerProtocol.inc({protocol:h.protocol},-1)),h==null||h.close().catch(gt=>{this.log.error(gt)}),d==null||d.close().catch(gt=>{this.log.error(gt)}),this.streamsOutbound.delete(c),this.streamsInbound.delete(c);for(const gt of this.topics.values())gt.delete(c);for(const[gt,_t]of this.mesh)_t.delete(c)&&((ft=this.metrics)==null||ft.onRemoveFromMesh(gt,ChurnReason.Dc,1));for(const gt of this.fanout.values())gt.delete(c);this.floodsubPeers.delete(c),this.gossip.delete(c),this.control.delete(c),this.outbound.delete(c),this.score.removePeer(c),this.acceptFromWhitelist.delete(c)}get started(){return this.status.code===GossipStatusCode.started}getMeshPeers(a){const c=this.mesh.get(a);return c!=null?Array.from(c):[]}getSubscribers(a){const c=this.topics.get(a);return(c!=null?Array.from(c):[]).map(h=>peerIdFromString(h))}getTopics(){return Array.from(this.subscriptions)}async pipePeerReadStream(a,c){var h;try{await pipe(c,async d=>{var et,ft,gt;for await(const _t of d)try{const wt=_t.subarray(),$t=decodeRpc(wt,this.decodeRpcLimits);if((et=this.metrics)==null||et.onRpcRecv($t,wt.length),this.opts.awaitRpcHandler)try{await this.handleReceivedRpc(a,$t)}catch(It){(ft=this.metrics)==null||ft.onRpcRecvError(),this.log(It)}else this.handleReceivedRpc(a,$t).catch(It=>{var Rt;(Rt=this.metrics)==null||Rt.onRpcRecvError(),this.log(It)})}catch(wt){(gt=this.metrics)==null||gt.onRpcDataError(),this.log(wt)}})}catch(d){(h=this.metrics)==null||h.onPeerReadStreamError(),this.handlePeerReadStreamError(d,a)}}handlePeerReadStreamError(a,c){this.log.error(a),this.onPeerDisconnected(c)}async handleReceivedRpc(a,c){var wt;if(!this.acceptFrom(a.toString())){this.log("received message from unacceptable peer %p",a),(wt=this.metrics)==null||wt.rpcRecvNotAccepted.inc();return}const h=c.subscriptions!=null?c.subscriptions.length:0,d=c.messages!=null?c.messages.length:0;let et=0,ft=0,gt=0,_t=0;if(c.control!=null&&(c.control.ihave!=null&&(et=c.control.ihave.length),c.control.iwant!=null&&(ft=c.control.iwant.length),c.control.graft!=null&&(gt=c.control.graft.length),c.control.prune!=null&&(_t=c.control.prune.length)),this.log(`rpc.from ${a.toString()} subscriptions ${h} messages ${d} ihave ${et} iwant ${ft} graft ${gt} prune ${_t}`),c.subscriptions!=null&&c.subscriptions.length>0){const $t=[];c.subscriptions.forEach(It=>{const Rt=It.topic,Tt=It.subscribe===!0;if(Rt!=null){if(this.allowedTopics!=null&&!this.allowedTopics.has(Rt))return;this.handleReceivedSubscription(a,Rt,Tt),$t.push({topic:Rt,subscribe:Tt})}}),this.safeDispatchEvent("subscription-change",{detail:{peerId:a,subscriptions:$t}})}if(c.messages!=null)for(const $t of c.messages){if(this.allowedTopics!=null&&!this.allowedTopics.has($t.topic))continue;const It=this.handleReceivedMessage(a,$t).catch(Rt=>{var Tt;(Tt=this.metrics)==null||Tt.onMsgRecvError($t.topic),this.log(Rt)});this.opts.awaitRpcMessageHandler&&await It}c.control!=null&&await this.handleControlMessage(a.toString(),c.control)}handleReceivedSubscription(a,c,h){this.log("subscription update from %p topic %s",a,c);let d=this.topics.get(c);d==null&&(d=new Set,this.topics.set(c,d)),h?d.add(a.toString()):d.delete(a.toString())}async handleReceivedMessage(a,c){var et,ft,gt;(et=this.metrics)==null||et.onMsgRecvPreValidation(c.topic);const h=await this.validateReceivedMessage(a,c);(ft=this.metrics)==null||ft.onPrevalidationResult(c.topic,h.code);const d=h.code;switch(d){case MessageStatus.duplicate:this.score.duplicateMessage(a.toString(),h.msgIdStr,c.topic),this.gossipTracer.deliverMessage(h.msgIdStr,!0),this.mcache.observeDuplicate(h.msgIdStr,a.toString());return;case MessageStatus.invalid:if(h.msgIdStr!=null){const _t=h.msgIdStr;this.score.rejectMessage(a.toString(),_t,c.topic,h.reason),this.gossipTracer.rejectMessage(_t,h.reason)}else this.score.rejectInvalidMessage(a.toString(),c.topic);(gt=this.metrics)==null||gt.onMsgRecvInvalid(c.topic,h);return;case MessageStatus.valid:this.score.validateMessage(h.messageId.msgIdStr),this.gossipTracer.deliverMessage(h.messageId.msgIdStr),this.mcache.put(h.messageId,c,!this.opts.asyncValidation),this.subscriptions.has(c.topic)&&(!this.components.peerId.equals(a)||this.opts.emitSelf)&&(super.dispatchEvent(new CustomEvent("gossipsub:message",{detail:{propagationSource:a,msgId:h.messageId.msgIdStr,msg:h.msg}})),super.dispatchEvent(new CustomEvent("message",{detail:h.msg}))),this.opts.asyncValidation||this.forwardMessage(h.messageId.msgIdStr,c,a.toString());break;default:throw new Error(`Invalid validation result: ${d}`)}}async validateReceivedMessage(a,c){var It,Rt,Tt;const h=(It=this.fastMsgIdFn)==null?void 0:It.call(this,c),d=h!==void 0?(Rt=this.fastMsgIdCache)==null?void 0:Rt.get(h):void 0;if(d!=null)return{code:MessageStatus.duplicate,msgIdStr:d};const et=await validateToRawMessage(this.globalSignaturePolicy,c);if(!et.valid)return{code:MessageStatus.invalid,reason:RejectReason.Error,error:et.error};const ft=et.message;try{this.dataTransform!=null&&(ft.data=this.dataTransform.inboundTransform(c.topic,ft.data))}catch(At){return this.log("Invalid message, transform failed",At),{code:MessageStatus.invalid,reason:RejectReason.Error,error:ValidateError.TransformFailed}}const gt=await this.msgIdFn(ft),_t=this.msgIdToStrFn(gt),wt={msgId:gt,msgIdStr:_t};if(h!==void 0&&this.fastMsgIdCache!=null&&this.fastMsgIdCache.put(h,_t)&&((Tt=this.metrics)==null||Tt.fastMsgIdCacheCollision.inc()),this.seenCache.has(_t))return{code:MessageStatus.duplicate,msgIdStr:_t};this.seenCache.put(_t);const $t=this.topicValidators.get(c.topic);if($t!=null){let At;try{At=await $t(a,ft)}catch(kt){const xt=kt.code;xt===ERR_TOPIC_VALIDATOR_IGNORE&&(At=TopicValidatorResult.Ignore),xt===ERR_TOPIC_VALIDATOR_REJECT?At=TopicValidatorResult.Reject:At=TopicValidatorResult.Ignore}if(At!==TopicValidatorResult.Accept)return{code:MessageStatus.invalid,reason:rejectReasonFromAcceptance(At),msgIdStr:_t}}return{code:MessageStatus.valid,messageId:wt,msg:ft}}getScore(a){return this.score.score(a)}sendSubscriptions(a,c,h){this.sendRpc(a,{subscriptions:c.map(d=>({topic:d,subscribe:h}))})}async handleControlMessage(a,c){var _t,wt;if(c===void 0)return;const h=c.ihave!=null?this.handleIHave(a,c.ihave):[],d=c.iwant!=null?this.handleIWant(a,c.iwant):[],et=c.graft!=null?await this.handleGraft(a,c.graft):[];if(c.prune!=null&&await this.handlePrune(a,c.prune),h.length===0&&d.length===0&&et.length===0)return;const ft=this.sendRpc(a,{messages:d,control:{iwant:h,prune:et}}),gt=(_t=h[0])==null?void 0:_t.messageIDs;gt!=null&&(ft?this.gossipTracer.addPromise(a,gt):(wt=this.metrics)==null||wt.iwantPromiseUntracked.inc(1))}acceptFrom(a){if(this.direct.has(a))return!0;const c=Date.now(),h=this.acceptFromWhitelist.get(a);if(h!=null&&h.messagesAccepted<ACCEPT_FROM_WHITELIST_MAX_MESSAGES&&h.acceptUntil>=c)return h.messagesAccepted+=1,!0;const d=this.score.score(a);return d>=ACCEPT_FROM_WHITELIST_THRESHOLD_SCORE?this.acceptFromWhitelist.set(a,{messagesAccepted:0,acceptUntil:c+ACCEPT_FROM_WHITELIST_DURATION_MS}):this.acceptFromWhitelist.delete(a),d>=this.opts.scoreThresholds.graylistThreshold}handleIHave(a,c){var wt,$t,It;if(c.length===0)return[];const h=this.score.score(a);if(h<this.opts.scoreThresholds.gossipThreshold)return this.log("IHAVE: ignoring peer %s with score below threshold [ score = %d ]",a,h),(wt=this.metrics)==null||wt.ihaveRcvIgnored.inc({reason:IHaveIgnoreReason.LowScore}),[];const d=(this.peerhave.get(a)??0)+1;if(this.peerhave.set(a,d),d>GossipsubMaxIHaveMessages)return this.log("IHAVE: peer %s has advertised too many times (%d) within this heartbeat interval; ignoring",a,d),($t=this.metrics)==null||$t.ihaveRcvIgnored.inc({reason:IHaveIgnoreReason.MaxIhave}),[];const et=this.iasked.get(a)??0;if(et>=GossipsubMaxIHaveLength)return this.log("IHAVE: peer %s has already advertised too many messages (%d); ignoring",a,et),(It=this.metrics)==null||It.ihaveRcvIgnored.inc({reason:IHaveIgnoreReason.MaxIasked}),[];const ft=new Map;if(c.forEach(({topicID:Rt,messageIDs:Tt})=>{var kt;if(Rt==null||Tt==null||!this.mesh.has(Rt))return;let At=0;Tt.forEach(xt=>{const Nt=this.msgIdToStrFn(xt);this.seenCache.has(Nt)||(ft.set(Nt,xt),At++)}),(kt=this.metrics)==null||kt.onIhaveRcv(Rt,Tt.length,At)}),ft.size===0)return[];let gt=ft.size;gt+et>GossipsubMaxIHaveLength&&(gt=GossipsubMaxIHaveLength-et),this.log("IHAVE: Asking for %d out of %d messages from %s",gt,ft.size,a);let _t=Array.from(ft.values());return shuffle(_t),_t=_t.slice(0,gt),this.iasked.set(a,et+gt),[{messageIDs:_t}]}handleIWant(a,c){var gt;if(c.length===0)return[];const h=this.score.score(a);if(h<this.opts.scoreThresholds.gossipThreshold)return this.log("IWANT: ignoring peer %s with score below threshold [score = %d]",a,h),[];const d=new Map,et=new Map;let ft=0;return c.forEach(({messageIDs:_t})=>{_t==null||_t.forEach(wt=>{const $t=this.msgIdToStrFn(wt),It=this.mcache.getWithIWantCount($t,a);if(It==null){ft++;return}if(et.set(It.msg.topic,1+(et.get(It.msg.topic)??0)),It.count>GossipsubGossipRetransmission){this.log("IWANT: Peer %s has asked for message %s too many times: ignoring request",a,wt);return}d.set($t,It.msg)})}),(gt=this.metrics)==null||gt.onIwantRcv(et,ft),d.size===0?(this.log("IWANT: Could not provide any wanted messages to %s",a),[]):(this.log("IWANT: Sending %d messages to %s",d.size,a),Array.from(d.values()))}async handleGraft(a,c){const h=[],d=this.score.score(a),et=Date.now();let ft=this.opts.doPX;if(c.forEach(({topicID:_t})=>{var It,Rt;if(_t==null)return;const wt=this.mesh.get(_t);if(wt==null){ft=!1;return}if(wt.has(a))return;if(this.direct.has(a)){this.log("GRAFT: ignoring request from direct peer %s",a),h.push(_t),ft=!1;return}const $t=(It=this.backoff.get(_t))==null?void 0:It.get(a);if(typeof $t=="number"&&et<$t){this.log("GRAFT: ignoring backed off peer %s",a),this.score.addPenalty(a,1,ScorePenalty.GraftBackoff),ft=!1;const Tt=$t+this.opts.graftFloodThreshold-this.opts.pruneBackoff;et<Tt&&this.score.addPenalty(a,1,ScorePenalty.GraftBackoff),this.addBackoff(a,_t),h.push(_t);return}if(d<0){this.log("GRAFT: ignoring peer %s with negative score: score=%d, topic=%s",a,d,_t),h.push(_t),ft=!1,this.addBackoff(a,_t);return}if(wt.size>=this.opts.Dhi&&!(this.outbound.get(a)??!1)){h.push(_t),this.addBackoff(a,_t);return}this.log("GRAFT: Add mesh link from %s in %s",a,_t),this.score.graft(a,_t),wt.add(a),(Rt=this.metrics)==null||Rt.onAddToMesh(_t,InclusionReason.Subscribed,1)}),h.length===0)return[];const gt=!1;return Promise.all(h.map(async _t=>this.makePrune(a,_t,ft,gt)))}async handlePrune(a,c){var d;const h=this.score.score(a);for(const{topicID:et,backoff:ft,peers:gt}of c){if(et==null)continue;const _t=this.mesh.get(et);if(_t==null)return;if(this.log("PRUNE: Remove mesh link to %s in %s",a,et),this.score.prune(a,et),_t.has(a)&&(_t.delete(a),(d=this.metrics)==null||d.onRemoveFromMesh(et,ChurnReason.Prune,1)),typeof ft=="number"&&ft>0?this.doAddBackoff(a,et,ft*1e3):this.addBackoff(a,et),gt!=null&&gt.length>0){if(h<this.opts.scoreThresholds.acceptPXThreshold){this.log("PRUNE: ignoring PX from peer %s with insufficient score [score = %d, topic = %s]",a,h,et);continue}await this.pxConnect(gt)}}}addBackoff(a,c){this.doAddBackoff(a,c,this.opts.pruneBackoff)}doAddBackoff(a,c,h){let d=this.backoff.get(c);d==null&&(d=new Map,this.backoff.set(c,d));const et=Date.now()+h;(d.get(a)??0)<et&&d.set(a,et)}applyIwantPenalties(){this.gossipTracer.getBrokenPromises().forEach((a,c)=>{this.log("peer %s didn't follow up in %d IWANT requests; adding penalty",c,a),this.score.addPenalty(c,a,ScorePenalty.BrokenPromise)})}clearBackoff(){if(this.heartbeatTicks%GossipsubPruneBackoffTicks!==0)return;const a=Date.now();this.backoff.forEach((c,h)=>{c.forEach((d,et)=>{d+BACKOFF_SLACK*this.opts.heartbeatInterval<a&&c.delete(et)}),c.size===0&&this.backoff.delete(h)})}async directConnect(){const a=[];this.direct.forEach(c=>{this.streamsOutbound.has(c)||a.push(c)}),await Promise.all(a.map(async c=>this.connect(c)))}async pxConnect(a){a.length>this.opts.prunePeers&&(shuffle(a),a=a.slice(0,this.opts.prunePeers));const c=[];await Promise.all(a.map(async h=>{if(h.peerID==null)return;const d=peerIdFromBytes(h.peerID),et=d.toString();if(!this.peers.has(et)){if(h.signedPeerRecord==null){c.push(et);return}try{if(!await this.components.peerStore.consumePeerRecord(h.signedPeerRecord,d)){this.log("bogus peer record obtained through px: could not add peer record to address book");return}c.push(et)}catch{this.log("bogus peer record obtained through px: invalid signature or not a peer record")}}})),c.length!==0&&await Promise.all(c.map(async h=>this.connect(h)))}async connect(a){var d;this.log("Initiating connection with %s",a);const c=peerIdFromString(a),h=await this.components.connectionManager.openConnection(c);for(const et of this.multicodecs)for(const ft of this.components.registrar.getTopologies(et))(d=ft.onConnect)==null||d.call(ft,c,h)}subscribe(a){if(this.status.code!==GossipStatusCode.started)throw new Error("Pubsub has not started");if(!this.subscriptions.has(a)){this.subscriptions.add(a);for(const c of this.peers.keys())this.sendSubscriptions(c,[a],!0)}this.join(a)}unsubscribe(a){if(this.status.code!==GossipStatusCode.started)throw new Error("Pubsub is not started");const c=this.subscriptions.delete(a);if(this.log("unsubscribe from %s - am subscribed %s",a,c),c)for(const h of this.peers.keys())this.sendSubscriptions(h,[a],!1);this.leave(a)}join(a){var et,ft,gt;if(this.status.code!==GossipStatusCode.started)throw new Error("Gossipsub has not started");if(this.mesh.has(a))return;this.log("JOIN %s",a),(et=this.metrics)==null||et.onJoin(a);const c=new Set,h=this.backoff.get(a),d=this.fanout.get(a);if(d!=null&&(this.fanout.delete(a),this.fanoutLastpub.delete(a),d.forEach(_t=>{!this.direct.has(_t)&&this.score.score(_t)>=0&&(h==null||!h.has(_t))&&c.add(_t)}),(ft=this.metrics)==null||ft.onAddToMesh(a,InclusionReason.Fanout,c.size)),c.size<this.opts.D){const _t=c.size;this.getRandomGossipPeers(a,this.opts.D,$t=>!c.has($t)&&!this.direct.has($t)&&this.score.score($t)>=0&&(h==null||!h.has($t))).forEach($t=>{c.add($t)}),(gt=this.metrics)==null||gt.onAddToMesh(a,InclusionReason.Random,c.size-_t)}this.mesh.set(a,c),c.forEach(_t=>{this.log("JOIN: Add mesh link to %s in %s",_t,a),this.sendGraft(_t,a)})}leave(a){var h;if(this.status.code!==GossipStatusCode.started)throw new Error("Gossipsub has not started");this.log("LEAVE %s",a),(h=this.metrics)==null||h.onLeave(a);const c=this.mesh.get(a);c!=null&&(Promise.all(Array.from(c).map(async d=>{this.log("LEAVE: Remove mesh link to %s in %s",d,a),await this.sendPrune(d,a)})).catch(d=>{this.log("Error sending prunes to mesh peers",d)}),this.mesh.delete(a))}selectPeersToForward(a,c,h){const d=new Set,et=this.topics.get(a);et!=null&&(this.direct.forEach(gt=>{et.has(gt)&&c!==gt&&!((h==null?void 0:h.has(gt))??!1)&&d.add(gt)}),this.floodsubPeers.forEach(gt=>{et.has(gt)&&c!==gt&&!((h==null?void 0:h.has(gt))??!1)&&this.score.score(gt)>=this.opts.scoreThresholds.publishThreshold&&d.add(gt)}));const ft=this.mesh.get(a);return ft!=null&&ft.size>0&&ft.forEach(gt=>{c!==gt&&!((h==null?void 0:h.has(gt))??!1)&&d.add(gt)}),d}selectPeersToPublish(a){const c=new Set,h={direct:0,floodsub:0,mesh:0,fanout:0},d=this.topics.get(a);if(d!=null)if(this.opts.floodPublish)d.forEach(et=>{this.direct.has(et)?(c.add(et),h.direct++):this.score.score(et)>=this.opts.scoreThresholds.publishThreshold&&(c.add(et),h.floodsub++)});else{this.direct.forEach(ft=>{d.has(ft)&&(c.add(ft),h.direct++)}),this.floodsubPeers.forEach(ft=>{d.has(ft)&&this.score.score(ft)>=this.opts.scoreThresholds.publishThreshold&&(c.add(ft),h.floodsub++)});const et=this.mesh.get(a);if(et!=null&&et.size>0)et.forEach(ft=>{c.add(ft),h.mesh++});else{const ft=this.fanout.get(a);if(ft!=null&&ft.size>0)ft.forEach(gt=>{c.add(gt),h.fanout++});else{const gt=this.getRandomGossipPeers(a,this.opts.D,_t=>this.score.score(_t)>=this.opts.scoreThresholds.publishThreshold);gt.size>0&&(this.fanout.set(a,gt),gt.forEach(_t=>{c.add(_t),h.fanout++}))}this.fanoutLastpub.set(a,Date.now())}}return{tosend:c,tosendCount:h}}forwardMessage(a,c,h,d){var ft;h!=null&&this.score.deliverMessage(h,a,c.topic);const et=this.selectPeersToForward(c.topic,h,d);et.forEach(gt=>{this.sendRpc(gt,{messages:[c]})}),(ft=this.metrics)==null||ft.onForwardMsg(c.topic,et.size)}async publish(a,c,h){var xt,Nt;const d=Date.now(),et=this.dataTransform!=null?this.dataTransform.outboundTransform(a,c):c;if(this.publishConfig==null)throw Error("PublishError.Uninitialized");const{raw:ft,msg:gt}=await buildRawMessage(this.publishConfig,a,c,et),_t=await this.msgIdFn(gt),wt=this.msgIdToStrFn(_t),$t=(h==null?void 0:h.ignoreDuplicatePublishError)??this.opts.ignoreDuplicatePublishError;if(this.seenCache.has(wt)){if($t)return(xt=this.metrics)==null||xt.onPublishDuplicateMsg(a),{recipients:[]};throw Error("PublishError.Duplicate")}const{tosend:It,tosendCount:Rt}=this.selectPeersToPublish(a),Tt=this.opts.emitSelf&&this.subscriptions.has(a),At=(h==null?void 0:h.allowPublishToZeroPeers)??this.opts.allowPublishToZeroPeers;if(It.size===0&&!At&&!Tt)throw Error("PublishError.InsufficientPeers");this.seenCache.put(wt),this.mcache.put({msgId:_t,msgIdStr:wt},ft,!0),this.publishedMessageIds.put(wt);for(const Ft of It)this.sendRpc(Ft,{messages:[ft]})||It.delete(Ft);const kt=Date.now()-d;return(Nt=this.metrics)==null||Nt.onPublishMsg(a,Rt,It.size,ft.data!=null?ft.data.length:0,kt),Tt&&(It.add(this.components.peerId.toString()),super.dispatchEvent(new CustomEvent("gossipsub:message",{detail:{propagationSource:this.components.peerId,msgId:wt,msg:gt}})),super.dispatchEvent(new CustomEvent("message",{detail:gt}))),{recipients:Array.from(It.values()).map(Ft=>peerIdFromString(Ft))}}reportMessageValidationResult(a,c,h){var ft;let d;if(h===TopicValidatorResult.Accept){if(d=this.mcache.validate(a),d!=null){const{message:gt,originatingPeers:_t}=d;this.score.deliverMessage(c,a,gt.topic),this.forwardMessage(a,d.message,c,_t)}}else if(d=this.mcache.remove(a),d!=null){const gt=rejectReasonFromAcceptance(h),{message:_t,originatingPeers:wt}=d;this.score.rejectMessage(c,a,_t.topic,gt);for(const $t of wt)this.score.rejectMessage($t,a,_t.topic,gt)}const et=this.score.messageFirstSeenTimestampMs(a);(ft=this.metrics)==null||ft.onReportValidation(d,h,et)}sendGraft(a,c){const h=[{topicID:c}];this.sendRpc(a,{control:{graft:h}})}async sendPrune(a,c){const d=[await this.makePrune(a,c,this.opts.doPX,!0)];this.sendRpc(a,{control:{prune:d}})}sendRpc(a,c){var gt;const h=this.streamsOutbound.get(a);if(h==null)return this.log(`Cannot send RPC to ${a} as there is no open stream to it available`),!1;const d=this.control.get(a);d!=null&&(this.piggybackControl(a,c,d),this.control.delete(a));const et=this.gossip.get(a);et!=null&&(this.piggybackGossip(a,c,et),this.gossip.delete(a));const ft=RPC.encode(c).finish();try{h.push(ft)}catch(_t){return this.log.error(`Cannot send rpc to ${a}`,_t),d!=null&&this.control.set(a,d),et!=null&&this.gossip.set(a,et),!1}return(gt=this.metrics)==null||gt.onRpcSent(c,ft.length),!0}piggybackControl(a,c,h){var d,et;if(h.graft!=null){c.control==null&&(c.control={}),c.control.graft==null&&(c.control.graft=[]);for(const ft of h.graft)ft.topicID!=null&&(((d=this.mesh.get(ft.topicID))==null?void 0:d.has(a))??!1)&&c.control.graft.push(ft)}if(h.prune!=null){c.control==null&&(c.control={}),c.control.prune==null&&(c.control.prune=[]);for(const ft of h.prune)ft.topicID!=null&&!(((et=this.mesh.get(ft.topicID))==null?void 0:et.has(a))??!1)&&c.control.prune.push(ft)}}piggybackGossip(a,c,h){c.control==null&&(c.control={}),c.control.ihave=h}async sendGraftPrune(a,c,h){const d=this.opts.doPX,et=!1;for(const[ft,gt]of a){const _t=gt.map(It=>({topicID:It}));let wt=[];const $t=c.get(ft);$t!=null&&(wt=await Promise.all($t.map(async It=>this.makePrune(ft,It,d&&!(h.get(ft)??!1),et))),c.delete(ft)),this.sendRpc(ft,{control:{graft:_t,prune:wt}})}for(const[ft,gt]of c){const _t=await Promise.all(gt.map(async wt=>this.makePrune(ft,wt,d&&!(h.get(ft)??!1),et)));this.sendRpc(ft,{control:{prune:_t}})}}emitGossip(a){const c=this.mcache.getGossipIDs(new Set(a.keys()));for(const[h,d]of a)this.doEmitGossip(h,d,c.get(h)??[])}doEmitGossip(a,c,h){if(h.length===0||(shuffle(h),h.length>GossipsubMaxIHaveLength&&this.log("too many messages for gossip; will truncate IHAVE list (%d messages)",h.length),c.size===0))return;let d=this.opts.Dlazy;const et=GossipsubGossipFactor*c.size;let ft=c;et>d&&(d=et),d>ft.size?d=ft.size:ft=shuffle(Array.from(ft)).slice(0,d),ft.forEach(gt=>{let _t=h;h.length>GossipsubMaxIHaveLength&&(_t=shuffle(_t.slice()).slice(0,GossipsubMaxIHaveLength)),this.pushGossip(gt,{topicID:a,messageIDs:_t})})}flush(){for(const[a,c]of this.gossip.entries())this.gossip.delete(a),this.sendRpc(a,{control:{ihave:c}});for(const[a,c]of this.control.entries())this.control.delete(a),this.sendRpc(a,{control:{graft:c.graft,prune:c.prune}})}pushGossip(a,c){this.log("Add gossip to %s",a);const h=this.gossip.get(a)??[];this.gossip.set(a,h.concat(c))}async makePrune(a,c,h,d){var wt;if(this.score.prune(a,c),((wt=this.streamsOutbound.get(a))==null?void 0:wt.protocol)===GossipsubIDv10)return{topicID:c,peers:[]};const et=d?this.opts.unsubcribeBackoff:this.opts.pruneBackoff,ft=et/1e3;if(this.doAddBackoff(a,c,et),!h)return{topicID:c,peers:[],backoff:ft};const gt=this.getRandomGossipPeers(c,this.opts.prunePeers,$t=>$t!==a&&this.score.score($t)>=0),_t=await Promise.all(Array.from(gt).map(async $t=>{const It=peerIdFromString($t);let Rt;try{Rt=await this.components.peerStore.get(It)}catch(Tt){if(Tt.code!=="ERR_NOT_FOUND")throw Tt}return{peerID:It.toBytes(),signedPeerRecord:Rt==null?void 0:Rt.peerRecordEnvelope}}));return{topicID:c,peers:_t,backoff:ft}}async heartbeat(){var At,kt;const{D:a,Dlo:c,Dhi:h,Dscore:d,Dout:et,fanoutTTL:ft}=this.opts;this.heartbeatTicks++;const gt=new Map,_t=xt=>{let Nt=gt.get(xt);return Nt===void 0&&(Nt=this.score.score(xt),gt.set(xt,Nt)),Nt},wt=new Map,$t=new Map,It=new Map;this.clearBackoff(),this.peerhave.clear(),(At=this.metrics)==null||At.cacheSize.set({cache:"iasked"},this.iasked.size),this.iasked.clear(),this.applyIwantPenalties(),this.heartbeatTicks%this.opts.directConnectTicks===0&&await this.directConnect(),(kt=this.fastMsgIdCache)==null||kt.prune(),this.seenCache.prune(),this.gossipTracer.prune(),this.publishedMessageIds.prune();const Rt=new Map;this.mesh.forEach((xt,Nt)=>{const Ft=this.topics.get(Nt),jt=new Set,Gt=new Set;if(Rt.set(Nt,Gt),Ft!=null){const Zt=shuffle(Array.from(Ft)),cr=this.backoff.get(Nt);for(const hr of Zt){const gr=this.streamsOutbound.get(hr);if(gr!=null&&this.multicodecs.includes(gr.protocol)&&!xt.has(hr)&&!this.direct.has(hr)){const er=_t(hr);(cr==null||!cr.has(hr))&&er>=0&&jt.add(hr),er>=this.opts.scoreThresholds.gossipThreshold&&Gt.add(hr)}}}const Kt=(Zt,cr)=>{var gr;this.log("HEARTBEAT: Remove mesh link to %s in %s",Zt,Nt),this.addBackoff(Zt,Nt),xt.delete(Zt),_t(Zt)>=this.opts.scoreThresholds.gossipThreshold&&Gt.add(Zt),(gr=this.metrics)==null||gr.onRemoveFromMesh(Nt,cr,1);const hr=$t.get(Zt);hr==null?$t.set(Zt,[Nt]):hr.push(Nt)},Wt=(Zt,cr)=>{var gr;this.log("HEARTBEAT: Add mesh link to %s in %s",Zt,Nt),this.score.graft(Zt,Nt),xt.add(Zt),Gt.delete(Zt),(gr=this.metrics)==null||gr.onAddToMesh(Nt,cr,1);const hr=wt.get(Zt);hr==null?wt.set(Zt,[Nt]):hr.push(Nt)};if(xt.forEach(Zt=>{const cr=_t(Zt);cr<0&&(this.log("HEARTBEAT: Prune peer %s with negative score: score=%d, topic=%s",Zt,cr,Nt),Kt(Zt,ChurnReason.BadScore),It.set(Zt,!0))}),xt.size<c){const Zt=a-xt.size;removeFirstNItemsFromSet(jt,Zt).forEach(hr=>{Wt(hr,InclusionReason.NotEnough)})}if(xt.size>h){let Zt=Array.from(xt);Zt.sort((hr,gr)=>_t(gr)-_t(hr)),Zt=Zt.slice(0,d).concat(shuffle(Zt.slice(d)));let cr=0;if(Zt.slice(0,a).forEach(hr=>{(this.outbound.get(hr)??!1)&&cr++}),cr<et){const hr=er=>{const mr=Zt[er];for(let Mr=er;Mr>0;Mr--)Zt[Mr]=Zt[Mr-1];Zt[0]=mr};if(cr>0){let er=cr;for(let mr=1;mr<a&&er>0;mr++)(this.outbound.get(Zt[mr])??!1)&&(hr(mr),er--)}let gr=a-cr;for(let er=a;er<Zt.length&&gr>0;er++)(this.outbound.get(Zt[er])??!1)&&(hr(er),gr--)}Zt.slice(a).forEach(hr=>{Kt(hr,ChurnReason.Excess)})}if(xt.size>=c){let Zt=0;if(xt.forEach(cr=>{(this.outbound.get(cr)??!1)&&Zt++}),Zt<et){const cr=et-Zt;removeItemsFromSet(jt,cr,gr=>this.outbound.get(gr)===!0).forEach(gr=>{Wt(gr,InclusionReason.Outbound)})}}if(this.heartbeatTicks%this.opts.opportunisticGraftTicks===0&&xt.size>1){const Zt=Array.from(xt).sort((gr,er)=>_t(gr)-_t(er)),cr=Math.floor(xt.size/2),hr=_t(Zt[cr]);if(hr<this.opts.scoreThresholds.opportunisticGraftThreshold){const gr=this.opts.opportunisticGraftPeers,er=removeItemsFromSet(jt,gr,mr=>_t(mr)>hr);for(const mr of er)this.log("HEARTBEAT: Opportunistically graft peer %s on topic %s",mr,Nt),Wt(mr,InclusionReason.Opportunistic)}}});const Tt=Date.now();this.fanoutLastpub.forEach((xt,Nt)=>{xt+ft<Tt&&(this.fanout.delete(Nt),this.fanoutLastpub.delete(Nt))}),this.fanout.forEach((xt,Nt)=>{const Ft=this.topics.get(Nt);xt.forEach(Wt=>{(!((Ft==null?void 0:Ft.has(Wt))??!1)||_t(Wt)<this.opts.scoreThresholds.publishThreshold)&&xt.delete(Wt)});const jt=this.topics.get(Nt),Gt=[],Kt=new Set;if(Rt.set(Nt,Kt),jt!=null){const Wt=shuffle(Array.from(jt));for(const Zt of Wt){const cr=this.streamsOutbound.get(Zt);if(cr!=null&&this.multicodecs.includes(cr.protocol)&&!xt.has(Zt)&&!this.direct.has(Zt)){const hr=_t(Zt);hr>=this.opts.scoreThresholds.publishThreshold&&Gt.push(Zt),hr>=this.opts.scoreThresholds.gossipThreshold&&Kt.add(Zt)}}}if(xt.size<a){const Wt=a-xt.size;Gt.slice(0,Wt).forEach(Zt=>{xt.add(Zt),Kt==null||Kt.delete(Zt)})}}),this.emitGossip(Rt),await this.sendGraftPrune(wt,$t,It),this.flush(),this.mcache.shift(),this.dispatchEvent(new CustomEvent("gossipsub:heartbeat"))}getRandomGossipPeers(a,c,h=()=>!0){const d=this.topics.get(a);if(d==null)return new Set;let et=[];return d.forEach(ft=>{const gt=this.streamsOutbound.get(ft);gt!=null&&this.multicodecs.includes(gt.protocol)&&h(ft)&&et.push(ft)}),et=shuffle(et),c>0&&et.length>c&&(et=et.slice(0,c)),new Set(et)}onScrapeMetrics(a){var gt,_t;a.mcacheSize.set(this.mcache.size),a.mcacheNotValidatedCount.set(this.mcache.notValidatedCount),a.cacheSize.set({cache:"direct"},this.direct.size),a.cacheSize.set({cache:"seenCache"},this.seenCache.size),a.cacheSize.set({cache:"fastMsgIdCache"},((gt=this.fastMsgIdCache)==null?void 0:gt.size)??0),a.cacheSize.set({cache:"publishedMessageIds"},this.publishedMessageIds.size),a.cacheSize.set({cache:"mcache"},this.mcache.size),a.cacheSize.set({cache:"score"},this.score.size),a.cacheSize.set({cache:"gossipTracer.promises"},this.gossipTracer.size),a.cacheSize.set({cache:"gossipTracer.requests"},this.gossipTracer.requestMsByMsgSize),a.cacheSize.set({cache:"topics"},this.topics.size),a.cacheSize.set({cache:"subscriptions"},this.subscriptions.size),a.cacheSize.set({cache:"mesh"},this.mesh.size),a.cacheSize.set({cache:"fanout"},this.fanout.size),a.cacheSize.set({cache:"peers"},this.peers.size),a.cacheSize.set({cache:"streamsOutbound"},this.streamsOutbound.size),a.cacheSize.set({cache:"streamsInbound"},this.streamsInbound.size),a.cacheSize.set({cache:"acceptFromWhitelist"},this.acceptFromWhitelist.size),a.cacheSize.set({cache:"gossip"},this.gossip.size),a.cacheSize.set({cache:"control"},this.control.size),a.cacheSize.set({cache:"peerhave"},this.peerhave.size),a.cacheSize.set({cache:"outbound"},this.outbound.size);let c=0;const h=Date.now();a.connectedPeersBackoffSec.reset();for(const wt of this.backoff.values()){c+=wt.size;for(const[$t,It]of wt.entries())this.peers.has($t)&&a.connectedPeersBackoffSec.observe(Math.max(0,It-h)/1e3)}a.cacheSize.set({cache:"backoff"},c);for(const[wt,$t]of this.topics)a.topicPeersCount.set({topicStr:wt},$t.size);for(const[wt,$t]of this.mesh)a.meshPeerCounts.set({topicStr:wt},$t.size);const d=[],et=new Map;a.behaviourPenalty.reset();for(const wt of this.peers.keys()){const $t=this.score.score(wt);d.push($t),et.set(wt,$t),a.behaviourPenalty.observe(((_t=this.score.peerStats.get(wt))==null?void 0:_t.behaviourPenalty)??0)}a.registerScores(d,this.opts.scoreThresholds),a.registerScorePerMesh(this.mesh,et);const ft=computeAllPeersScoreWeights(this.peers.keys(),this.score.peerStats,this.score.params,this.score.peerIPs,a.topicStrToLabel);a.registerScoreWeights(ft)}}qt(GossipSub,"multicodec",GossipsubIDv11);const RelayCodecs=["/vac/waku/relay/2.0.0"],log$d=new Logger$2("relay");function messageValidator(i,e){const a=performance.now();log$d.info(`validating message from ${i} received on ${e.topic}`);let c=TopicValidatorResult.Accept;try{const et=WakuMessage$4.decode(e.data);(!et.contentTopic||!et.contentTopic.length||!et.payload||!et.payload.length)&&(c=TopicValidatorResult.Reject)}catch{c=TopicValidatorResult.Reject}const d=performance.now()-a;return d>100?log$d.warn(`message validation took ${d}ms for peer ${i} on topic ${e.topic}. This should be less than 100ms.`):log$d.info(`message validation took ${d}ms for peer ${i} on topic ${e.topic}`),c}class TopicOnlyMessage{constructor(e,a){qt(this,"pubsubTopic");qt(this,"proto");qt(this,"payload",new Uint8Array);qt(this,"rateLimitProof");qt(this,"timestamp");qt(this,"meta");qt(this,"ephemeral");this.pubsubTopic=e,this.proto=a}get contentTopic(){return this.proto.contentTopic}}class TopicOnlyDecoder{constructor(){qt(this,"pubsubTopic",DefaultPubsubTopic);qt(this,"contentTopic","")}fromWireToProtoObj(e){const a=TopicOnlyMessage$1.decode(e);return Promise.resolve({contentTopic:a.contentTopic,payload:new Uint8Array,rateLimitProof:void 0,timestamp:void 0,meta:void 0,version:void 0,ephemeral:void 0})}async fromProtoObj(e,a){return new TopicOnlyMessage(e,a)}}const log$c=new Logger$2("relay"),lo=class lo{constructor(e,a){qt(this,"pubsubTopics");qt(this,"defaultDecoder");qt(this,"gossipSub");qt(this,"observers");if(!this.isRelayPubsub(e.services.pubsub))throw Error(`Failed to initialize Relay. libp2p.pubsub does not support ${lo.multicodec}`);this.gossipSub=e.services.pubsub,this.pubsubTopics=new Set(a!=null&&a.shardInfo?shardInfoToPubsubTopics(a.shardInfo):(a==null?void 0:a.pubsubTopics)??[DefaultPubsubTopic]),this.gossipSub.isStarted()&&this.subscribeToAllTopics(),this.observers=new Map,this.defaultDecoder=new TopicOnlyDecoder}async start(){if(this.gossipSub.isStarted())throw Error("GossipSub already started.");await this.gossipSub.start(),this.subscribeToAllTopics()}async send(e,a){const c=[],{pubsubTopic:h}=e;if(!this.pubsubTopics.has(h))return log$c.error("Failed to send waku relay: topic not configured"),{recipients:c,errors:[SendError.TOPIC_NOT_CONFIGURED]};const d=await e.toWire(a);return d?isWireSizeUnderCap(d)?this.gossipSub.publish(h,d):(log$c.error("Failed to send waku relay: message is bigger that 1MB"),{recipients:c,errors:[SendError.SIZE_TOO_BIG]}):(log$c.error("Failed to encode message, aborting publish"),{recipients:c,errors:[SendError.ENCODE_FAILED]})}subscribe(e,a){const c=[];for(const h of Array.isArray(e)?e:[e]){const{pubsubTopic:d}=h,et=this.observers.get(d)??new Map,ft={pubsubTopic:d,decoder:h,callback:a};pushOrInitMapSet(et,h.contentTopic,ft),this.observers.set(d,et),c.push([d,ft])}return()=>{this.removeObservers(c)}}removeObservers(e){for(const[a,c]of e){const h=this.observers.get(a);if(!h)continue;const d=c.decoder.contentTopic,et=h.get(d);et&&(et.delete(c),h.set(d,et),this.observers.set(a,h))}}toSubscriptionIterator(e){return toAsyncIterator(this,e)}getActiveSubscriptions(){const e=new Map;for(const a of this.pubsubTopics)e.set(a,Array.from(this.observers.keys()));return e}getMeshPeers(e=DefaultPubsubTopic){return this.gossipSub.getMeshPeers(e)}subscribeToAllTopics(){for(const e of this.pubsubTopics)this.gossipSubSubscribe(e)}async processIncomingMessage(e,a){const c=await this.defaultDecoder.fromWireToProtoObj(a);if(!c||!c.contentTopic){log$c.warn("Message does not have a content topic, skipping");return}const h=this.observers.get(e);if(!h)return;const d=h.get(c.contentTopic);d&&await Promise.all(Array.from(d).map(({decoder:et,callback:ft})=>(async()=>{try{const gt=await et.fromWireToProtoObj(a);if(!gt){log$c.error("Internal error: message previously decoded failed on 2nd pass.");return}const _t=await et.fromProtoObj(e,gt);_t?await ft(_t):log$c.error("Failed to decode messages on",c.contentTopic)}catch(gt){log$c.error("Error while decoding message:",gt)}})()))}gossipSubSubscribe(e){this.gossipSub.addEventListener("gossipsub:message",a=>{a.detail.msg.topic===e&&this.processIncomingMessage(a.detail.msg.topic,a.detail.msg.data).catch(c=>log$c.error("Failed to process incoming message",c))}),this.gossipSub.topicValidators.set(e,messageValidator),this.gossipSub.subscribe(e)}isRelayPubsub(e){var a;return((a=e==null?void 0:e.multicodecs)==null?void 0:a.includes(lo.multicodec))??!1}};qt(lo,"multicodec",RelayCodecs[0]);let Relay=lo;function wakuGossipSub(i={}){return e=>{i={...i,msgIdFn:({data:c})=>sha256$3(c),globalSignaturePolicy:SignaturePolicy.StrictNoSign,fallbackToFloodsub:!1};const a=new GossipSub(e,i);return a.multicodecs=RelayCodecs,a}}const contentRouting=Symbol.for("@libp2p/content-routing"),peerRouting=Symbol.for("@libp2p/peer-routing");function coerce$2(i){if(i instanceof Uint8Array&&i.constructor.name==="Uint8Array")return i;if(i instanceof ArrayBuffer)return new Uint8Array(i);if(ArrayBuffer.isView(i))return new Uint8Array(i.buffer,i.byteOffset,i.byteLength);throw new Error("Unknown type, must be binary type")}function fromString$2(i){return new TextEncoder().encode(i)}function toString$3(i){return new TextDecoder().decode(i)}function base$2(i,e){if(i.length>=255)throw new TypeError("Alphabet too long");for(var a=new Uint8Array(256),c=0;c<a.length;c++)a[c]=255;for(var h=0;h<i.length;h++){var d=i.charAt(h),et=d.charCodeAt(0);if(a[et]!==255)throw new TypeError(d+" is ambiguous");a[et]=h}var ft=i.length,gt=i.charAt(0),_t=Math.log(ft)/Math.log(256),wt=Math.log(256)/Math.log(ft);function $t(Tt){if(Tt instanceof Uint8Array||(ArrayBuffer.isView(Tt)?Tt=new Uint8Array(Tt.buffer,Tt.byteOffset,Tt.byteLength):Array.isArray(Tt)&&(Tt=Uint8Array.from(Tt))),!(Tt instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(Tt.length===0)return"";for(var At=0,kt=0,xt=0,Nt=Tt.length;xt!==Nt&&Tt[xt]===0;)xt++,At++;for(var Ft=(Nt-xt)*wt+1>>>0,jt=new Uint8Array(Ft);xt!==Nt;){for(var Gt=Tt[xt],Kt=0,Wt=Ft-1;(Gt!==0||Kt<kt)&&Wt!==-1;Wt--,Kt++)Gt+=256*jt[Wt]>>>0,jt[Wt]=Gt%ft>>>0,Gt=Gt/ft>>>0;if(Gt!==0)throw new Error("Non-zero carry");kt=Kt,xt++}for(var Zt=Ft-kt;Zt!==Ft&&jt[Zt]===0;)Zt++;for(var cr=gt.repeat(At);Zt<Ft;++Zt)cr+=i.charAt(jt[Zt]);return cr}function It(Tt){if(typeof Tt!="string")throw new TypeError("Expected String");if(Tt.length===0)return new Uint8Array;var At=0;if(Tt[At]!==" "){for(var kt=0,xt=0;Tt[At]===gt;)kt++,At++;for(var Nt=(Tt.length-At)*_t+1>>>0,Ft=new Uint8Array(Nt);Tt[At];){var jt=a[Tt.charCodeAt(At)];if(jt===255)return;for(var Gt=0,Kt=Nt-1;(jt!==0||Gt<xt)&&Kt!==-1;Kt--,Gt++)jt+=ft*Ft[Kt]>>>0,Ft[Kt]=jt%256>>>0,jt=jt/256>>>0;if(jt!==0)throw new Error("Non-zero carry");xt=Gt,At++}if(Tt[At]!==" "){for(var Wt=Nt-xt;Wt!==Nt&&Ft[Wt]===0;)Wt++;for(var Zt=new Uint8Array(kt+(Nt-Wt)),cr=kt;Wt!==Nt;)Zt[cr++]=Ft[Wt++];return Zt}}}function Rt(Tt){var At=It(Tt);if(At)return At;throw new Error(`Non-${e} character`)}return{encode:$t,decodeUnsafe:It,decode:Rt}}var src$2=base$2,_brrp__multiformats_scope_baseX$2=src$2;let Encoder$2=class{constructor(e,a,c){qt(this,"name");qt(this,"prefix");qt(this,"baseEncode");this.name=e,this.prefix=a,this.baseEncode=c}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Decoder$2=class{constructor(e,a,c){qt(this,"name");qt(this,"prefix");qt(this,"baseDecode");qt(this,"prefixCodePoint");if(this.name=e,this.prefix=a,a.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=a.codePointAt(0),this.baseDecode=c}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return or$3(this,e)}},ComposedDecoder$2=class{constructor(e){qt(this,"decoders");this.decoders=e}or(e){return or$3(this,e)}decode(e){const a=e[0],c=this.decoders[a];if(c!=null)return c.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function or$3(i,e){return new ComposedDecoder$2({...i.decoders??{[i.prefix]:i},...e.decoders??{[e.prefix]:e}})}let Codec$2=class{constructor(e,a,c,h){qt(this,"name");qt(this,"prefix");qt(this,"baseEncode");qt(this,"baseDecode");qt(this,"encoder");qt(this,"decoder");this.name=e,this.prefix=a,this.baseEncode=c,this.baseDecode=h,this.encoder=new Encoder$2(e,a,c),this.decoder=new Decoder$2(e,a,h)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function from$2({name:i,prefix:e,encode:a,decode:c}){return new Codec$2(i,e,a,c)}function baseX$2({name:i,prefix:e,alphabet:a}){const{encode:c,decode:h}=_brrp__multiformats_scope_baseX$2(a,i);return from$2({prefix:e,name:i,encode:c,decode:d=>coerce$2(h(d))})}function decode$5(i,e,a,c){const h={};for(let wt=0;wt<e.length;++wt)h[e[wt]]=wt;let d=i.length;for(;i[d-1]==="=";)--d;const et=new Uint8Array(d*a/8|0);let ft=0,gt=0,_t=0;for(let wt=0;wt<d;++wt){const $t=h[i[wt]];if($t===void 0)throw new SyntaxError(`Non-${c} character`);gt=gt<<a|$t,ft+=a,ft>=8&&(ft-=8,et[_t++]=255&gt>>ft)}if(ft>=a||255&gt<<8-ft)throw new SyntaxError("Unexpected end of data");return et}function encode$5(i,e,a){const c=e[e.length-1]==="=",h=(1<<a)-1;let d="",et=0,ft=0;for(let gt=0;gt<i.length;++gt)for(ft=ft<<8|i[gt],et+=8;et>a;)et-=a,d+=e[h&ft>>et];if(et!==0&&(d+=e[h&ft<<a-et]),c)for(;d.length*a&7;)d+="=";return d}function rfc4648$2({name:i,prefix:e,bitsPerChar:a,alphabet:c}){return from$2({prefix:e,name:i,encode(h){return encode$5(h,c,a)},decode(h){return decode$5(h,c,a,i)}})}const base10$2=baseX$2({prefix:"9",name:"base10",alphabet:"0123456789"}),base10$3=Object.freeze(Object.defineProperty({__proto__:null,base10:base10$2},Symbol.toStringTag,{value:"Module"})),base16$2=rfc4648$2({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),base16upper$1=rfc4648$2({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),base16$3=Object.freeze(Object.defineProperty({__proto__:null,base16:base16$2,base16upper:base16upper$1},Symbol.toStringTag,{value:"Module"})),base2$2=rfc4648$2({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),base2$3=Object.freeze(Object.defineProperty({__proto__:null,base2:base2$2},Symbol.toStringTag,{value:"Module"})),alphabet$1=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),alphabetBytesToChars$1=alphabet$1.reduce((i,e,a)=>(i[a]=e,i),[]),alphabetCharsToBytes$1=alphabet$1.reduce((i,e,a)=>(i[e.codePointAt(0)]=a,i),[]);function encode$4(i){return i.reduce((e,a)=>(e+=alphabetBytesToChars$1[a],e),"")}function decode$4(i){const e=[];for(const a of i){const c=alphabetCharsToBytes$1[a.codePointAt(0)];if(c===void 0)throw new Error(`Non-base256emoji character: ${a}`);e.push(c)}return new Uint8Array(e)}const base256emoji$2=from$2({prefix:"🚀",name:"base256emoji",encode:encode$4,decode:decode$4}),base256emoji$3=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:base256emoji$2},Symbol.toStringTag,{value:"Module"})),base32$2=rfc4648$2({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),base32upper$1=rfc4648$2({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),base32pad$1=rfc4648$2({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),base32padupper$1=rfc4648$2({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),base32hex$1=rfc4648$2({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),base32hexupper$1=rfc4648$2({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),base32hexpad$1=rfc4648$2({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),base32hexpadupper$1=rfc4648$2({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),base32z$1=rfc4648$2({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),base32$3=Object.freeze(Object.defineProperty({__proto__:null,base32:base32$2,base32hex:base32hex$1,base32hexpad:base32hexpad$1,base32hexpadupper:base32hexpadupper$1,base32hexupper:base32hexupper$1,base32pad:base32pad$1,base32padupper:base32padupper$1,base32upper:base32upper$1,base32z:base32z$1},Symbol.toStringTag,{value:"Module"})),base36$2=baseX$2({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),base36upper$1=baseX$2({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),base36$3=Object.freeze(Object.defineProperty({__proto__:null,base36:base36$2,base36upper:base36upper$1},Symbol.toStringTag,{value:"Module"})),base58btc$2=baseX$2({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),base58flickr$1=baseX$2({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),base58$1=Object.freeze(Object.defineProperty({__proto__:null,base58btc:base58btc$2,base58flickr:base58flickr$1},Symbol.toStringTag,{value:"Module"})),base64$3=rfc4648$2({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),base64pad$1=rfc4648$2({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),base64url$2=rfc4648$2({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),base64urlpad$1=rfc4648$2({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),base64$4=Object.freeze(Object.defineProperty({__proto__:null,base64:base64$3,base64pad:base64pad$1,base64url:base64url$2,base64urlpad:base64urlpad$1},Symbol.toStringTag,{value:"Module"})),base8$2=rfc4648$2({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),base8$3=Object.freeze(Object.defineProperty({__proto__:null,base8:base8$2},Symbol.toStringTag,{value:"Module"})),identity$1=from$2({prefix:"\0",name:"identity",encode:i=>toString$3(i),decode:i=>fromString$2(i)}),identityBase$1=Object.freeze(Object.defineProperty({__proto__:null,identity:identity$1},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const bases$1={...identityBase$1,...base2$3,...base8$3,...base10$3,...base16$3,...base32$3,...base36$3,...base58$1,...base64$4,...base256emoji$3};function allocUnsafe$1(i=0){return new Uint8Array(i)}function createCodec$1(i,e,a,c){return{name:i,prefix:e,encoder:{name:i,prefix:e,encode:a},decoder:{decode:c}}}const string$2=createCodec$1("utf8","u",i=>"u"+new TextDecoder("utf8").decode(i),i=>new TextEncoder().encode(i.substring(1))),ascii$1=createCodec$1("ascii","a",i=>{let e="a";for(let a=0;a<i.length;a++)e+=String.fromCharCode(i[a]);return e},i=>{i=i.substring(1);const e=allocUnsafe$1(i.length);for(let a=0;a<i.length;a++)e[a]=i.charCodeAt(a);return e}),BASES$1={utf8:string$2,"utf-8":string$2,hex:bases$1.base16,latin1:ascii$1,ascii:ascii$1,binary:ascii$1,...bases$1};function fromString$1(i,e="utf8"){const a=BASES$1[e];if(a==null)throw new Error(`Unsupported encoding "${e}"`);return a.decoder.decode(`${a.prefix}${i}`)}function toString$2(i,e="utf8"){const a=BASES$1[e];if(a==null)throw new Error(`Unsupported encoding "${e}"`);return a.encoder.encode(i).substring(1)}const pathSepS="/",pathSepB=new TextEncoder().encode(pathSepS),pathSep=pathSepB[0];class Key{constructor(e,a){qt(this,"_buf");if(typeof e=="string")this._buf=fromString$1(e);else if(e instanceof Uint8Array)this._buf=e;else throw new Error("Invalid key, should be String of Uint8Array");if(a==null&&(a=!0),a&&this.clean(),this._buf.byteLength===0||this._buf[0]!==pathSep)throw new Error("Invalid key")}toString(e="utf8"){return toString$2(this._buf,e)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(e){return new Key(e.join(pathSepS))}static random(){return new Key(Math.random().toString().substring(2))}static asKey(e){return e instanceof Uint8Array||typeof e=="string"?new Key(e):typeof e.uint8Array=="function"?new Key(e.uint8Array()):null}clean(){if((this._buf==null||this._buf.byteLength===0)&&(this._buf=pathSepB),this._buf[0]!==pathSep){const e=new Uint8Array(this._buf.byteLength+1);e.fill(pathSep,0,1),e.set(this._buf,1),this._buf=e}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===pathSep;)this._buf=this._buf.subarray(0,-1)}less(e){const a=this.list(),c=e.list();for(let h=0;h<a.length;h++){if(c.length<h+1)return!1;const d=a[h],et=c[h];if(d<et)return!0;if(d>et)return!1}return a.length<c.length}reverse(){return Key.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){const e=this.namespaces();return e[e.length-1]}list(){return this.toString().split(pathSepS).slice(1)}type(){return namespaceType(this.baseNamespace())}name(){return namespaceValue(this.baseNamespace())}instance(e){return new Key(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith(pathSepS)||(e+=pathSepS),e+=this.type(),new Key(e)}parent(){const e=this.list();return e.length===1?new Key(pathSepS):new Key(e.slice(0,-1).join(pathSepS))}child(e){return this.toString()===pathSepS?e:e.toString()===pathSepS?this:new Key(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()===this.toString()?!1:e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()===this.toString()?!1:this.toString().startsWith(e.toString())}isTopLevel(){return this.list().length===1}concat(...e){return Key.withNamespaces([...this.namespaces(),...flatten(e.map(a=>a.namespaces()))])}}function namespaceType(i){const e=i.split(":");return e.length<2?"":e.slice(0,-1).join(":")}function namespaceValue(i){const e=i.split(":");return e[e.length-1]}function flatten(i){return[].concat(...i)}var isPlainObj=i=>{if(Object.prototype.toString.call(i)!=="[object Object]")return!1;const e=Object.getPrototypeOf(i);return e===null||e===Object.prototype};const isOptionObject=isPlainObj,{hasOwnProperty}=Object.prototype,{propertyIsEnumerable}=Object,defineProperty=(i,e,a)=>Object.defineProperty(i,e,{value:a,writable:!0,enumerable:!0,configurable:!0}),globalThis$1=commonjsGlobal,defaultMergeOptions={concatArrays:!1,ignoreUndefined:!1},getEnumerableOwnPropertyKeys=i=>{const e=[];for(const a in i)hasOwnProperty.call(i,a)&&e.push(a);if(Object.getOwnPropertySymbols){const a=Object.getOwnPropertySymbols(i);for(const c of a)propertyIsEnumerable.call(i,c)&&e.push(c)}return e};function clone(i){return Array.isArray(i)?cloneArray(i):isOptionObject(i)?cloneOptionObject(i):i}function cloneArray(i){const e=i.slice(0,0);return getEnumerableOwnPropertyKeys(i).forEach(a=>{defineProperty(e,a,clone(i[a]))}),e}function cloneOptionObject(i){const e=Object.getPrototypeOf(i)===null?Object.create(null):{};return getEnumerableOwnPropertyKeys(i).forEach(a=>{defineProperty(e,a,clone(i[a]))}),e}const mergeKeys=(i,e,a,c)=>(a.forEach(h=>{typeof e[h]>"u"&&c.ignoreUndefined||(h in i&&i[h]!==Object.getPrototypeOf(i)?defineProperty(i,h,merge(i[h],e[h],c)):defineProperty(i,h,clone(e[h])))}),i),concatArrays=(i,e,a)=>{let c=i.slice(0,0),h=0;return[i,e].forEach(d=>{const et=[];for(let ft=0;ft<d.length;ft++)hasOwnProperty.call(d,ft)&&(et.push(String(ft)),d===i?defineProperty(c,h++,d[ft]):defineProperty(c,h++,clone(d[ft])));c=mergeKeys(c,d,getEnumerableOwnPropertyKeys(d).filter(ft=>!et.includes(ft)),a)}),c};function merge(i,e,a){return a.concatArrays&&Array.isArray(i)&&Array.isArray(e)?concatArrays(i,e,a):!isOptionObject(e)||!isOptionObject(i)?clone(e):mergeKeys(i,e,getEnumerableOwnPropertyKeys(e),a)}var mergeOptions=function(...i){const e=merge(clone(defaultMergeOptions),this!==globalThis$1&&this||{},defaultMergeOptions);let a={_:{}};for(const c of i)if(c!==void 0){if(!isOptionObject(c))throw new TypeError("`"+c+"` is not an Option Object");a=merge(a,{_:c},e)}return a._};const mergeOptions$1=getDefaultExportFromCjs(mergeOptions);function isHighSurrogate$1(i){return i>=55296&&i<=56319}function isLowSurrogate$1(i){return i>=56320&&i<=57343}var truncate$2=function i(e,a,c){if(typeof a!="string")throw new Error("Input must be string");for(var h=a.length,d=0,et,ft,gt=0;gt<h;gt+=1){if(et=a.charCodeAt(gt),ft=a[gt],isHighSurrogate$1(et)&&isLowSurrogate$1(a.charCodeAt(gt+1))&&(gt+=1,ft+=a[gt]),d+=e(ft),d===c)return a.slice(0,gt+1);if(d>c)return a.slice(0,gt-ft.length+1)}return a};function isHighSurrogate(i){return i>=55296&&i<=56319}function isLowSurrogate(i){return i>=56320&&i<=57343}var browser$1=function i(e){if(typeof e!="string")throw new Error("Input must be string");for(var a=e.length,c=0,h=null,d=null,et=0;et<a;et++)h=e.charCodeAt(et),isLowSurrogate(h)?d!=null&&isHighSurrogate(d)?c+=1:c+=3:h<=127?c+=1:h>=128&&h<=2047?c+=2:h>=2048&&h<=65535&&(c+=3),d=h;return c},truncate$1=truncate$2,getLength=browser$1,browser=truncate$1.bind(null,getLength),truncate=browser,illegalRe=/[\/\?<>\\:\*\|"]/g,controlRe=/[\x00-\x1f\x80-\x9f]/g,reservedRe=/^\.+$/,windowsReservedRe=/^(con|prn|aux|nul|com[0-9]|lpt[0-9])(\..*)?$/i,windowsTrailingRe=/[\. ]+$/;function sanitize(i,e){if(typeof i!="string")throw new Error("Input must be string");var a=i.replace(illegalRe,e).replace(controlRe,e).replace(reservedRe,e).replace(windowsReservedRe,e).replace(windowsTrailingRe,e);return truncate(a,255)}var sanitizeFilename=function(i,e){var a=e&&e.replacement||"",c=sanitize(i,a);return a===""?c:sanitize(c,"")};const sanitize$1=getDefaultExportFromCjs(sanitizeFilename);var codes$3;(function(i){i.ERR_INVALID_PARAMETERS="ERR_INVALID_PARAMETERS",i.ERR_INVALID_KEY_NAME="ERR_INVALID_KEY_NAME",i.ERR_INVALID_KEY_TYPE="ERR_INVALID_KEY_TYPE",i.ERR_KEY_ALREADY_EXISTS="ERR_KEY_ALREADY_EXISTS",i.ERR_INVALID_KEY_SIZE="ERR_INVALID_KEY_SIZE",i.ERR_KEY_NOT_FOUND="ERR_KEY_NOT_FOUND",i.ERR_OLD_KEY_NAME_INVALID="ERR_OLD_KEY_NAME_INVALID",i.ERR_NEW_KEY_NAME_INVALID="ERR_NEW_KEY_NAME_INVALID",i.ERR_PASSWORD_REQUIRED="ERR_PASSWORD_REQUIRED",i.ERR_PEM_REQUIRED="ERR_PEM_REQUIRED",i.ERR_CANNOT_READ_KEY="ERR_CANNOT_READ_KEY",i.ERR_MISSING_PRIVATE_KEY="ERR_MISSING_PRIVATE_KEY",i.ERR_INVALID_OLD_PASS_TYPE="ERR_INVALID_OLD_PASS_TYPE",i.ERR_INVALID_NEW_PASS_TYPE="ERR_INVALID_NEW_PASS_TYPE",i.ERR_INVALID_PASS_LENGTH="ERR_INVALID_PASS_LENGTH"})(codes$3||(codes$3={}));const log$b=logger$2("libp2p:keychain"),keyPrefix="/pkcs8/",infoPrefix="/info/",privates=new WeakMap,NIST={minKeyLength:112/8,minSaltLength:128/8,minIterationCount:1e3},defaultOptions$6={dek:{keyLength:512/8,iterationCount:1e4,salt:"you should override this value with a crypto secure random number",hash:"sha2-512"}};function validateKeyName(i){return i==null||typeof i!="string"?!1:i===sanitize$1(i.trim())&&i.length>0}async function randomDelay(){const a=Math.random()*800+200;await new Promise(c=>setTimeout(c,a))}function DsName(i){return new Key(keyPrefix+i)}function DsInfoName(i){return new Key(infoPrefix+i)}class DefaultKeyChain{constructor(e,a){qt(this,"components");qt(this,"init");var h,d,et,ft,gt,_t,wt,$t,It,Rt;if(this.components=e,this.init=mergeOptions$1(defaultOptions$6,a),this.init.pass!=null&&((h=this.init.pass)==null?void 0:h.length)<20)throw new Error("pass must be least 20 characters");if(((d=this.init.dek)==null?void 0:d.keyLength)!=null&&this.init.dek.keyLength<NIST.minKeyLength)throw new Error(`dek.keyLength must be least ${NIST.minKeyLength} bytes`);if(((ft=(et=this.init.dek)==null?void 0:et.salt)==null?void 0:ft.length)!=null&&this.init.dek.salt.length<NIST.minSaltLength)throw new Error(`dek.saltLength must be least ${NIST.minSaltLength} bytes`);if(((gt=this.init.dek)==null?void 0:gt.iterationCount)!=null&&this.init.dek.iterationCount<NIST.minIterationCount)throw new Error(`dek.iterationCount must be least ${NIST.minIterationCount}`);const c=this.init.pass!=null&&((_t=this.init.dek)==null?void 0:_t.salt)!=null?pbkdf2(this.init.pass,(wt=this.init.dek)==null?void 0:wt.salt,($t=this.init.dek)==null?void 0:$t.iterationCount,(It=this.init.dek)==null?void 0:It.keyLength,(Rt=this.init.dek)==null?void 0:Rt.hash):"";privates.set(this,{dek:c})}static generateOptions(){const e=Object.assign({},defaultOptions$6),a=Math.ceil(NIST.minSaltLength/3)*3;return e.dek.salt=toString$d(randomBytes(a),"base64"),e}static get options(){return defaultOptions$6}async createKey(e,a,c=2048){if(!validateKeyName(e)||e==="self")throw await randomDelay(),new CodeError$2("Invalid key name",codes$3.ERR_INVALID_KEY_NAME);if(typeof a!="string")throw await randomDelay(),new CodeError$2("Invalid key type",codes$3.ERR_INVALID_KEY_TYPE);const h=DsName(e);if(await this.components.datastore.has(h))throw await randomDelay(),new CodeError$2("Key name already exists",codes$3.ERR_KEY_ALREADY_EXISTS);switch(a.toLowerCase()){case"rsa":if(!Number.isSafeInteger(c)||c<2048)throw await randomDelay(),new CodeError$2("Invalid RSA key size",codes$3.ERR_INVALID_KEY_SIZE);break}let et;try{const ft=await generateKeyPair(a,c),gt=await ft.id(),_t=privates.get(this);if(_t==null)throw new CodeError$2("dek missing",codes$3.ERR_INVALID_PARAMETERS);const wt=_t.dek,$t=await ft.export(wt);et={name:e,id:gt};const It=this.components.datastore.batch();It.put(h,fromString$9($t)),It.put(DsInfoName(e),fromString$9(JSON.stringify(et))),await It.commit()}catch(ft){throw await randomDelay(),ft}return et}async listKeys(){const e={prefix:infoPrefix},a=[];for await(const c of this.components.datastore.query(e))a.push(JSON.parse(toString$d(c.value)));return a}async findKeyById(e){try{const c=(await this.listKeys()).find(h=>h.id===e);if(c==null)throw new CodeError$2(`Key with id '${e}' does not exist.`,codes$3.ERR_KEY_NOT_FOUND);return c}catch(a){throw await randomDelay(),a}}async findKeyByName(e){if(!validateKeyName(e))throw await randomDelay(),new CodeError$2(`Invalid key name '${e}'`,codes$3.ERR_INVALID_KEY_NAME);const a=DsInfoName(e);try{const c=await this.components.datastore.get(a);return JSON.parse(toString$d(c))}catch(c){throw await randomDelay(),log$b.error(c),new CodeError$2(`Key '${e}' does not exist.`,codes$3.ERR_KEY_NOT_FOUND)}}async removeKey(e){if(!validateKeyName(e)||e==="self")throw await randomDelay(),new CodeError$2(`Invalid key name '${e}'`,codes$3.ERR_INVALID_KEY_NAME);const a=DsName(e),c=await this.findKeyByName(e),h=this.components.datastore.batch();return h.delete(a),h.delete(DsInfoName(e)),await h.commit(),c}async renameKey(e,a){if(!validateKeyName(e)||e==="self")throw await randomDelay(),new CodeError$2(`Invalid old key name '${e}'`,codes$3.ERR_OLD_KEY_NAME_INVALID);if(!validateKeyName(a)||a==="self")throw await randomDelay(),new CodeError$2(`Invalid new key name '${a}'`,codes$3.ERR_NEW_KEY_NAME_INVALID);const c=DsName(e),h=DsName(a),d=DsInfoName(e),et=DsInfoName(a);if(await this.components.datastore.has(h))throw await randomDelay(),new CodeError$2(`Key '${a}' already exists`,codes$3.ERR_KEY_ALREADY_EXISTS);try{const gt=await this.components.datastore.get(c),_t=await this.components.datastore.get(d),wt=JSON.parse(toString$d(_t));wt.name=a;const $t=this.components.datastore.batch();return $t.put(h,gt),$t.put(et,fromString$9(JSON.stringify(wt))),$t.delete(c),$t.delete(d),await $t.commit(),wt}catch(gt){throw await randomDelay(),gt}}async exportKey(e,a){if(!validateKeyName(e))throw await randomDelay(),new CodeError$2(`Invalid key name '${e}'`,codes$3.ERR_INVALID_KEY_NAME);if(a==null)throw await randomDelay(),new CodeError$2("Password is required",codes$3.ERR_PASSWORD_REQUIRED);const c=DsName(e);try{const h=await this.components.datastore.get(c),d=toString$d(h),et=privates.get(this);if(et==null)throw new CodeError$2("dek missing",codes$3.ERR_INVALID_PARAMETERS);const ft=et.dek;return await(await importKey(d,ft)).export(a)}catch(h){throw await randomDelay(),h}}async exportPeerId(e){const a="temporary-password",c=await this.exportKey(e,a),h=await importKey(c,a);return peerIdFromKeys(h.public.bytes,h.bytes)}async importKey(e,a,c){if(!validateKeyName(e)||e==="self")throw await randomDelay(),new CodeError$2(`Invalid key name '${e}'`,codes$3.ERR_INVALID_KEY_NAME);if(a==null)throw await randomDelay(),new CodeError$2("PEM encoded key is required",codes$3.ERR_PEM_REQUIRED);const h=DsName(e);if(await this.components.datastore.has(h))throw await randomDelay(),new CodeError$2(`Key '${e}' already exists`,codes$3.ERR_KEY_ALREADY_EXISTS);let et;try{et=await importKey(a,c)}catch{throw await randomDelay(),new CodeError$2("Cannot read the key, most likely the password is wrong",codes$3.ERR_CANNOT_READ_KEY)}let ft;try{ft=await et.id();const wt=privates.get(this);if(wt==null)throw new CodeError$2("dek missing",codes$3.ERR_INVALID_PARAMETERS);const $t=wt.dek;a=await et.export($t)}catch(wt){throw await randomDelay(),wt}const gt={name:e,id:ft},_t=this.components.datastore.batch();return _t.put(h,fromString$9(a)),_t.put(DsInfoName(e),fromString$9(JSON.stringify(gt))),await _t.commit(),gt}async importPeer(e,a){try{if(!validateKeyName(e))throw new CodeError$2(`Invalid key name '${e}'`,codes$3.ERR_INVALID_KEY_NAME);if(a==null)throw new CodeError$2("PeerId is required",codes$3.ERR_MISSING_PRIVATE_KEY);if(a.privateKey==null)throw new CodeError$2("PeerId.privKey is required",codes$3.ERR_MISSING_PRIVATE_KEY);const c=await unmarshalPrivateKey(a.privateKey),h=DsName(e);if(await this.components.datastore.has(h))throw await randomDelay(),new CodeError$2(`Key '${e}' already exists`,codes$3.ERR_KEY_ALREADY_EXISTS);const et=privates.get(this);if(et==null)throw new CodeError$2("dek missing",codes$3.ERR_INVALID_PARAMETERS);const ft=et.dek,gt=await c.export(ft),_t={name:e,id:a.toString()},wt=this.components.datastore.batch();return wt.put(h,fromString$9(gt)),wt.put(DsInfoName(e),fromString$9(JSON.stringify(_t))),await wt.commit(),_t}catch(c){throw await randomDelay(),c}}async getPrivateKey(e){if(!validateKeyName(e))throw await randomDelay(),new CodeError$2(`Invalid key name '${e}'`,codes$3.ERR_INVALID_KEY_NAME);try{const a=DsName(e),c=await this.components.datastore.get(a);return toString$d(c)}catch(a){throw await randomDelay(),log$b.error(a),new CodeError$2(`Key '${e}' does not exist.`,codes$3.ERR_KEY_NOT_FOUND)}}async rotateKeychainPass(e,a){var ft,gt,_t,wt;if(typeof e!="string")throw await randomDelay(),new CodeError$2(`Invalid old pass type '${typeof e}'`,codes$3.ERR_INVALID_OLD_PASS_TYPE);if(typeof a!="string")throw await randomDelay(),new CodeError$2(`Invalid new pass type '${typeof a}'`,codes$3.ERR_INVALID_NEW_PASS_TYPE);if(a.length<20)throw await randomDelay(),new CodeError$2(`Invalid pass length ${a.length}`,codes$3.ERR_INVALID_PASS_LENGTH);log$b("recreating keychain");const c=privates.get(this);if(c==null)throw new CodeError$2("dek missing",codes$3.ERR_INVALID_PARAMETERS);const h=c.dek;this.init.pass=a;const d=a!=null&&((ft=this.init.dek)==null?void 0:ft.salt)!=null?pbkdf2(a,this.init.dek.salt,(gt=this.init.dek)==null?void 0:gt.iterationCount,(_t=this.init.dek)==null?void 0:_t.keyLength,(wt=this.init.dek)==null?void 0:wt.hash):"";privates.set(this,{dek:d});const et=await this.listKeys();for(const $t of et){const It=await this.components.datastore.get(DsName($t.name)),Rt=toString$d(It),Tt=await importKey(Rt,h),At=d.toString(),kt=await Tt.export(At),xt=this.components.datastore.batch(),Nt={name:$t.name,id:$t.id};xt.put(DsName($t.name),fromString$9(kt)),xt.put(DsInfoName($t.name),fromString$9(JSON.stringify(Nt))),await xt.commit()}log$b("keychain reconstructed")}}function mapIterable(i,e){const a={[Symbol.iterator]:()=>a,next:()=>{const c=i.next(),h=c.value;return c.done===!0||h==null?{done:!0,value:void 0}:{done:!1,value:e(h)}}};return a}class PeerMap{constructor(e){qt(this,"map");if(this.map=new Map,e!=null)for(const[a,c]of e.entries())this.map.set(a.toString(),c)}[Symbol.iterator](){return this.entries()}clear(){this.map.clear()}delete(e){this.map.delete(e.toString())}entries(){return mapIterable(this.map.entries(),e=>[peerIdFromString(e[0]),e[1]])}forEach(e){this.map.forEach((a,c)=>{e(a,peerIdFromString(c),this)})}get(e){return this.map.get(e.toString())}has(e){return this.map.has(e.toString())}set(e,a){this.map.set(e.toString(),a)}keys(){return mapIterable(this.map.keys(),e=>peerIdFromString(e))}values(){return this.map.values()}get size(){return this.map.size}}class PeerSet{constructor(e){qt(this,"set");if(this.set=new Set,e!=null)for(const a of e)this.set.add(a.toString())}get size(){return this.set.size}[Symbol.iterator](){return this.values()}add(e){this.set.add(e.toString())}clear(){this.set.clear()}delete(e){this.set.delete(e.toString())}entries(){return mapIterable(this.set.entries(),e=>{const a=peerIdFromString(e[0]);return[a,a]})}forEach(e){this.set.forEach(a=>{const c=peerIdFromString(a);e(c,c,this)})}has(e){return this.set.has(e.toString())}values(){return mapIterable(this.set.values(),e=>peerIdFromString(e))}intersection(e){const a=new PeerSet;for(const c of e)this.has(c)&&a.add(c);return a}difference(e){const a=new PeerSet;for(const c of this)e.has(c)||a.add(c);return a}union(e){const a=new PeerSet;for(const c of e)a.add(c);for(const c of this)a.add(c);return a}}var PeerIdProto;(function(i){let e;i.codec=()=>(e==null&&(e=message((a,c,h={})=>{h.lengthDelimited!==!1&&c.fork(),a.id!=null&&(c.uint32(10),c.bytes(a.id)),a.pubKey!=null&&(c.uint32(18),c.bytes(a.pubKey)),a.privKey!=null&&(c.uint32(26),c.bytes(a.privKey)),h.lengthDelimited!==!1&&c.ldelim()},(a,c)=>{const h={},d=c==null?a.len:a.pos+c;for(;a.pos<d;){const et=a.uint32();switch(et>>>3){case 1:h.id=a.bytes();break;case 2:h.pubKey=a.bytes();break;case 3:h.privKey=a.bytes();break;default:a.skipType(et&7);break}}return h})),e),i.encode=a=>encodeMessage(a,i.codec()),i.decode=a=>decodeMessage$1(a,i.codec())})(PeerIdProto||(PeerIdProto={}));const createEd25519PeerId=async()=>{const i=await generateKeyPair("Ed25519"),e=await createFromPrivKey(i);if(e.type==="Ed25519")return e;throw new Error(`Generated unexpected PeerId type "${e.type}"`)};async function createFromPrivKey(i){return peerIdFromKeys(marshalPublicKey(i.public),marshalPrivateKey(i))}const codes$2={ERR_SIGNATURE_NOT_VALID:"ERR_SIGNATURE_NOT_VALID"};var Envelope;(function(i){let e;i.codec=()=>(e==null&&(e=message((a,c,h={})=>{h.lengthDelimited!==!1&&c.fork(),a.publicKey!=null&&a.publicKey.byteLength>0&&(c.uint32(10),c.bytes(a.publicKey)),a.payloadType!=null&&a.payloadType.byteLength>0&&(c.uint32(18),c.bytes(a.payloadType)),a.payload!=null&&a.payload.byteLength>0&&(c.uint32(26),c.bytes(a.payload)),a.signature!=null&&a.signature.byteLength>0&&(c.uint32(42),c.bytes(a.signature)),h.lengthDelimited!==!1&&c.ldelim()},(a,c)=>{const h={publicKey:new Uint8Array(0),payloadType:new Uint8Array(0),payload:new Uint8Array(0),signature:new Uint8Array(0)},d=c==null?a.len:a.pos+c;for(;a.pos<d;){const et=a.uint32();switch(et>>>3){case 1:h.publicKey=a.bytes();break;case 2:h.payloadType=a.bytes();break;case 3:h.payload=a.bytes();break;case 5:h.signature=a.bytes();break;default:a.skipType(et&7);break}}return h})),e),i.encode=a=>encodeMessage(a,i.codec()),i.decode=a=>decodeMessage$1(a,i.codec())})(Envelope||(Envelope={}));const xs=class xs{constructor(e){qt(this,"peerId");qt(this,"payloadType");qt(this,"payload");qt(this,"signature");qt(this,"marshaled");const{peerId:a,payloadType:c,payload:h,signature:d}=e;this.peerId=a,this.payloadType=c,this.payload=h,this.signature=d}marshal(){if(this.peerId.publicKey==null)throw new Error("Missing public key");return this.marshaled==null&&(this.marshaled=Envelope.encode({publicKey:this.peerId.publicKey,payloadType:this.payloadType,payload:this.payload.subarray(),signature:this.signature})),this.marshaled}equals(e){return equals$1(this.marshal(),e.marshal())}async validate(e){const a=formatSignaturePayload(e,this.payloadType,this.payload);if(this.peerId.publicKey==null)throw new Error("Missing public key");return unmarshalPublicKey(this.peerId.publicKey).verify(a.subarray(),this.signature)}};qt(xs,"createFromProtobuf",async e=>{const a=Envelope.decode(e),c=await peerIdFromKeys(a.publicKey);return new xs({peerId:c,payloadType:a.payloadType,payload:a.payload,signature:a.signature})}),qt(xs,"seal",async(e,a)=>{if(a.privateKey==null)throw new Error("Missing private key");const c=e.domain,h=e.codec,d=e.marshal(),et=formatSignaturePayload(c,h,d),gt=await(await unmarshalPrivateKey(a.privateKey)).sign(et.subarray());return new xs({peerId:a,payloadType:h,payload:d,signature:gt})}),qt(xs,"openAndCertify",async(e,a)=>{const c=await xs.createFromProtobuf(e);if(!await c.validate(a))throw new CodeError$2("envelope signature is not valid for the given domain",codes$2.ERR_SIGNATURE_NOT_VALID);return c});let RecordEnvelope=xs;const formatSignaturePayload=(i,e,a)=>{const c=fromString$9(i),h=encode$o(c.byteLength),d=encode$o(e.length),et=encode$o(a.length);return new Uint8ArrayList(h,c,d,e,et,a)};function arrayEquals(i,e){const a=(c,h)=>c.toString().localeCompare(h.toString());return i.length!==e.length?!1:(e.sort(a),i.sort(a).every((c,h)=>e[h].equals(c)))}const ENVELOPE_DOMAIN_PEER_RECORD="libp2p-peer-record",ENVELOPE_PAYLOAD_TYPE_PEER_RECORD=Uint8Array.from([3,1]);var PeerRecord$1;(function(i){(function(a){let c;a.codec=()=>(c==null&&(c=message((h,d,et={})=>{et.lengthDelimited!==!1&&d.fork(),h.multiaddr!=null&&h.multiaddr.byteLength>0&&(d.uint32(10),d.bytes(h.multiaddr)),et.lengthDelimited!==!1&&d.ldelim()},(h,d)=>{const et={multiaddr:new Uint8Array(0)},ft=d==null?h.len:h.pos+d;for(;h.pos<ft;){const gt=h.uint32();switch(gt>>>3){case 1:et.multiaddr=h.bytes();break;default:h.skipType(gt&7);break}}return et})),c),a.encode=h=>encodeMessage(h,a.codec()),a.decode=h=>decodeMessage$1(h,a.codec())})(i.AddressInfo||(i.AddressInfo={}));let e;i.codec=()=>(e==null&&(e=message((a,c,h={})=>{if(h.lengthDelimited!==!1&&c.fork(),a.peerId!=null&&a.peerId.byteLength>0&&(c.uint32(10),c.bytes(a.peerId)),a.seq!=null&&a.seq!==0n&&(c.uint32(16),c.uint64(a.seq)),a.addresses!=null)for(const d of a.addresses)c.uint32(26),i.AddressInfo.codec().encode(d,c);h.lengthDelimited!==!1&&c.ldelim()},(a,c)=>{const h={peerId:new Uint8Array(0),seq:0n,addresses:[]},d=c==null?a.len:a.pos+c;for(;a.pos<d;){const et=a.uint32();switch(et>>>3){case 1:h.peerId=a.bytes();break;case 2:h.seq=a.uint64();break;case 3:h.addresses.push(i.AddressInfo.codec().decode(a,a.uint32()));break;default:a.skipType(et&7);break}}return h})),e),i.encode=a=>encodeMessage(a,i.codec()),i.decode=a=>decodeMessage$1(a,i.codec())})(PeerRecord$1||(PeerRecord$1={}));const Es=class Es{constructor(e){qt(this,"peerId");qt(this,"multiaddrs");qt(this,"seqNumber");qt(this,"domain",Es.DOMAIN);qt(this,"codec",Es.CODEC);qt(this,"marshaled");const{peerId:a,multiaddrs:c,seqNumber:h}=e;this.peerId=a,this.multiaddrs=c??[],this.seqNumber=h??BigInt(Date.now())}marshal(){return this.marshaled==null&&(this.marshaled=PeerRecord$1.encode({peerId:this.peerId.toBytes(),seq:BigInt(this.seqNumber),addresses:this.multiaddrs.map(e=>({multiaddr:e.bytes}))})),this.marshaled}equals(e){return!(!(e instanceof Es)||!this.peerId.equals(e.peerId)||this.seqNumber!==e.seqNumber||!arrayEquals(this.multiaddrs,e.multiaddrs))}};qt(Es,"createFromProtobuf",e=>{const a=PeerRecord$1.decode(e),c=peerIdFromBytes(a.peerId),h=(a.addresses??[]).map(et=>multiaddr(et.multiaddr)),d=a.seq;return new Es({peerId:c,multiaddrs:h,seqNumber:d})}),qt(Es,"DOMAIN",ENVELOPE_DOMAIN_PEER_RECORD),qt(Es,"CODEC",ENVELOPE_PAYLOAD_TYPE_PEER_RECORD);let PeerRecord=Es;var eventemitter3={exports:{}};(function(i){var e=Object.prototype.hasOwnProperty,a="~";function c(){}Object.create&&(c.prototype=Object.create(null),new c().__proto__||(a=!1));function h(gt,_t,wt){this.fn=gt,this.context=_t,this.once=wt||!1}function d(gt,_t,wt,$t,It){if(typeof wt!="function")throw new TypeError("The listener must be a function");var Rt=new h(wt,$t||gt,It),Tt=a?a+_t:_t;return gt._events[Tt]?gt._events[Tt].fn?gt._events[Tt]=[gt._events[Tt],Rt]:gt._events[Tt].push(Rt):(gt._events[Tt]=Rt,gt._eventsCount++),gt}function et(gt,_t){--gt._eventsCount===0?gt._events=new c:delete gt._events[_t]}function ft(){this._events=new c,this._eventsCount=0}ft.prototype.eventNames=function(){var _t=[],wt,$t;if(this._eventsCount===0)return _t;for($t in wt=this._events)e.call(wt,$t)&&_t.push(a?$t.slice(1):$t);return Object.getOwnPropertySymbols?_t.concat(Object.getOwnPropertySymbols(wt)):_t},ft.prototype.listeners=function(_t){var wt=a?a+_t:_t,$t=this._events[wt];if(!$t)return[];if($t.fn)return[$t.fn];for(var It=0,Rt=$t.length,Tt=new Array(Rt);It<Rt;It++)Tt[It]=$t[It].fn;return Tt},ft.prototype.listenerCount=function(_t){var wt=a?a+_t:_t,$t=this._events[wt];return $t?$t.fn?1:$t.length:0},ft.prototype.emit=function(_t,wt,$t,It,Rt,Tt){var At=a?a+_t:_t;if(!this._events[At])return!1;var kt=this._events[At],xt=arguments.length,Nt,Ft;if(kt.fn){switch(kt.once&&this.removeListener(_t,kt.fn,void 0,!0),xt){case 1:return kt.fn.call(kt.context),!0;case 2:return kt.fn.call(kt.context,wt),!0;case 3:return kt.fn.call(kt.context,wt,$t),!0;case 4:return kt.fn.call(kt.context,wt,$t,It),!0;case 5:return kt.fn.call(kt.context,wt,$t,It,Rt),!0;case 6:return kt.fn.call(kt.context,wt,$t,It,Rt,Tt),!0}for(Ft=1,Nt=new Array(xt-1);Ft<xt;Ft++)Nt[Ft-1]=arguments[Ft];kt.fn.apply(kt.context,Nt)}else{var jt=kt.length,Gt;for(Ft=0;Ft<jt;Ft++)switch(kt[Ft].once&&this.removeListener(_t,kt[Ft].fn,void 0,!0),xt){case 1:kt[Ft].fn.call(kt[Ft].context);break;case 2:kt[Ft].fn.call(kt[Ft].context,wt);break;case 3:kt[Ft].fn.call(kt[Ft].context,wt,$t);break;case 4:kt[Ft].fn.call(kt[Ft].context,wt,$t,It);break;default:if(!Nt)for(Gt=1,Nt=new Array(xt-1);Gt<xt;Gt++)Nt[Gt-1]=arguments[Gt];kt[Ft].fn.apply(kt[Ft].context,Nt)}}return!0},ft.prototype.on=function(_t,wt,$t){return d(this,_t,wt,$t,!1)},ft.prototype.once=function(_t,wt,$t){return d(this,_t,wt,$t,!0)},ft.prototype.removeListener=function(_t,wt,$t,It){var Rt=a?a+_t:_t;if(!this._events[Rt])return this;if(!wt)return et(this,Rt),this;var Tt=this._events[Rt];if(Tt.fn)Tt.fn===wt&&(!It||Tt.once)&&(!$t||Tt.context===$t)&&et(this,Rt);else{for(var At=0,kt=[],xt=Tt.length;At<xt;At++)(Tt[At].fn!==wt||It&&!Tt[At].once||$t&&Tt[At].context!==$t)&&kt.push(Tt[At]);kt.length?this._events[Rt]=kt.length===1?kt[0]:kt:et(this,Rt)}return this},ft.prototype.removeAllListeners=function(_t){var wt;return _t?(wt=a?a+_t:_t,this._events[wt]&&et(this,wt)):(this._events=new c,this._eventsCount=0),this},ft.prototype.off=ft.prototype.removeListener,ft.prototype.addListener=ft.prototype.on,ft.prefixed=a,ft.EventEmitter=ft,i.exports=ft})(eventemitter3);var eventemitter3Exports=eventemitter3.exports;const EventEmitter$1=getDefaultExportFromCjs(eventemitter3Exports);function lowerBound$2(i,e,a){let c=0,h=i.length;for(;h>0;){const d=Math.trunc(h/2);let et=c+d;a(i[et],e)<=0?(c=++et,h-=d+1):h=d}return c}var fs,Il;let PriorityQueue$1=(Il=class{constructor(){gn(this,fs,[])}enqueue(e,a){a={priority:0,...a};const c={priority:a.priority,run:e};if(this.size&&ur(this,fs)[this.size-1].priority>=a.priority){ur(this,fs).push(c);return}const h=lowerBound$2(ur(this,fs),c,(d,et)=>et.priority-d.priority);ur(this,fs).splice(h,0,c)}dequeue(){const e=ur(this,fs).shift();return e==null?void 0:e.run}filter(e){return ur(this,fs).filter(a=>a.priority===e.priority).map(a=>a.run)}get size(){return ur(this,fs).length}},fs=new WeakMap,Il);var js,Xs,ks,fo,Js,po,_i,Zs,Xn,go,es,eo,ws,mo,Lo,sp,Uo,op,Ko,ap,Vo,cp,jo,up,to,To,yo,ga,vo,_a,ro,Co,Ho,hp,no,Ro,Tl;let PQueue$1=(Tl=class extends EventEmitter$1{constructor(a){var c,h;super();gn(this,Lo);gn(this,Uo);gn(this,Ko);gn(this,Vo);gn(this,jo);gn(this,to);gn(this,yo);gn(this,vo);gn(this,ro);gn(this,Ho);gn(this,no);gn(this,js,void 0);gn(this,Xs,void 0);gn(this,ks,0);gn(this,fo,void 0);gn(this,Js,void 0);gn(this,po,0);gn(this,_i,void 0);gn(this,Zs,void 0);gn(this,Xn,void 0);gn(this,go,void 0);gn(this,es,0);gn(this,eo,void 0);gn(this,ws,void 0);gn(this,mo,void 0);qt(this,"timeout");if(a={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:PriorityQueue$1,...a},!(typeof a.intervalCap=="number"&&a.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${((c=a.intervalCap)==null?void 0:c.toString())??""}\` (${typeof a.intervalCap})`);if(a.interval===void 0||!(Number.isFinite(a.interval)&&a.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${((h=a.interval)==null?void 0:h.toString())??""}\` (${typeof a.interval})`);yn(this,js,a.carryoverConcurrencyCount),yn(this,Xs,a.intervalCap===Number.POSITIVE_INFINITY||a.interval===0),yn(this,fo,a.intervalCap),yn(this,Js,a.interval),yn(this,Xn,new a.queueClass),yn(this,go,a.queueClass),this.concurrency=a.concurrency,this.timeout=a.timeout,yn(this,mo,a.throwOnTimeout===!0),yn(this,ws,a.autoStart===!1)}get concurrency(){return ur(this,eo)}set concurrency(a){if(!(typeof a=="number"&&a>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${a}\` (${typeof a})`);yn(this,eo,a),_n(this,ro,Co).call(this)}async add(a,c={}){return c={timeout:this.timeout,throwOnTimeout:ur(this,mo),...c},new Promise((h,d)=>{ur(this,Xn).enqueue(async()=>{var et;Ds(this,es)._++,Ds(this,ks)._++;try{(et=c.signal)==null||et.throwIfAborted();let ft=a({signal:c.signal});c.timeout&&(ft=pTimeout$1(Promise.resolve(ft),{milliseconds:c.timeout})),c.signal&&(ft=Promise.race([ft,_n(this,Ho,hp).call(this,c.signal)]));const gt=await ft;h(gt),this.emit("completed",gt)}catch(ft){if(ft instanceof TimeoutError$2&&!c.throwOnTimeout){h();return}d(ft),this.emit("error",ft)}finally{_n(this,Ko,ap).call(this)}},c),this.emit("add"),_n(this,to,To).call(this)})}async addAll(a,c){return Promise.all(a.map(async h=>this.add(h,c)))}start(){return ur(this,ws)?(yn(this,ws,!1),_n(this,ro,Co).call(this),this):this}pause(){yn(this,ws,!0)}clear(){yn(this,Xn,new(ur(this,go)))}async onEmpty(){ur(this,Xn).size!==0&&await _n(this,no,Ro).call(this,"empty")}async onSizeLessThan(a){ur(this,Xn).size<a||await _n(this,no,Ro).call(this,"next",()=>ur(this,Xn).size<a)}async onIdle(){ur(this,es)===0&&ur(this,Xn).size===0||await _n(this,no,Ro).call(this,"idle")}get size(){return ur(this,Xn).size}sizeBy(a){return ur(this,Xn).filter(a).length}get pending(){return ur(this,es)}get isPaused(){return ur(this,ws)}},js=new WeakMap,Xs=new WeakMap,ks=new WeakMap,fo=new WeakMap,Js=new WeakMap,po=new WeakMap,_i=new WeakMap,Zs=new WeakMap,Xn=new WeakMap,go=new WeakMap,es=new WeakMap,eo=new WeakMap,ws=new WeakMap,mo=new WeakMap,Lo=new WeakSet,sp=function(){return ur(this,Xs)||ur(this,ks)<ur(this,fo)},Uo=new WeakSet,op=function(){return ur(this,es)<ur(this,eo)},Ko=new WeakSet,ap=function(){Ds(this,es)._--,_n(this,to,To).call(this),this.emit("next")},Vo=new WeakSet,cp=function(){_n(this,vo,_a).call(this),_n(this,yo,ga).call(this),yn(this,Zs,void 0)},jo=new WeakSet,up=function(){const a=Date.now();if(ur(this,_i)===void 0){const c=ur(this,po)-a;if(c<0)yn(this,ks,ur(this,js)?ur(this,es):0);else return ur(this,Zs)===void 0&&yn(this,Zs,setTimeout(()=>{_n(this,Vo,cp).call(this)},c)),!0}return!1},to=new WeakSet,To=function(){if(ur(this,Xn).size===0)return ur(this,_i)&&clearInterval(ur(this,_i)),yn(this,_i,void 0),this.emit("empty"),ur(this,es)===0&&this.emit("idle"),!1;if(!ur(this,ws)){const a=!ur(this,jo,up);if(ur(this,Lo,sp)&&ur(this,Uo,op)){const c=ur(this,Xn).dequeue();return c?(this.emit("active"),c(),a&&_n(this,yo,ga).call(this),!0):!1}}return!1},yo=new WeakSet,ga=function(){ur(this,Xs)||ur(this,_i)!==void 0||(yn(this,_i,setInterval(()=>{_n(this,vo,_a).call(this)},ur(this,Js))),yn(this,po,Date.now()+ur(this,Js)))},vo=new WeakSet,_a=function(){ur(this,ks)===0&&ur(this,es)===0&&ur(this,_i)&&(clearInterval(ur(this,_i)),yn(this,_i,void 0)),yn(this,ks,ur(this,js)?ur(this,es):0),_n(this,ro,Co).call(this)},ro=new WeakSet,Co=function(){for(;_n(this,to,To).call(this););},Ho=new WeakSet,hp=async function(a){return new Promise((c,h)=>{a.addEventListener("abort",()=>{h(a.reason)},{once:!0})})},no=new WeakSet,Ro=async function(a,c){return new Promise(h=>{const d=()=>{c&&!c()||(this.off(a,d),h())};this.on(a,d)})},Tl);const events={},observable=i=>{i.addEventListener("message",e=>{observable.dispatchEvent("message",i,e)}),i.port!=null&&i.port.addEventListener("message",e=>{observable.dispatchEvent("message",i,e)})};observable.addEventListener=(i,e)=>{events[i]==null&&(events[i]=[]),events[i].push(e)};observable.removeEventListener=(i,e)=>{events[i]!=null&&(events[i]=events[i].filter(a=>a===e))};observable.dispatchEvent=function(i,e,a){events[i]!=null&&events[i].forEach(c=>c(e,a))};const WORKER_REQUEST_READ_LOCK="lock:worker:request-read",WORKER_RELEASE_READ_LOCK="lock:worker:release-read",MASTER_GRANT_READ_LOCK="lock:master:grant-read",WORKER_REQUEST_WRITE_LOCK="lock:worker:request-write",WORKER_RELEASE_WRITE_LOCK="lock:worker:release-write",MASTER_GRANT_WRITE_LOCK="lock:master:grant-write",nanoid=(i=21)=>Math.random().toString().substring(2),handleWorkerLockRequest=(i,e,a,c,h)=>(d,et)=>{if(et.data.type!==a)return;const ft={type:et.data.type,name:et.data.name,identifier:et.data.identifier};i.dispatchEvent(new MessageEvent(e,{data:{name:ft.name,handler:async()=>{d.postMessage({type:h,name:ft.name,identifier:ft.identifier}),await new Promise(gt=>{const _t=wt=>{if(wt==null||wt.data==null)return;const $t={type:wt.data.type,name:wt.data.name,identifier:wt.data.identifier};$t.type===c&&$t.identifier===ft.identifier&&(d.removeEventListener("message",_t),gt())};d.addEventListener("message",_t)})}}}))},makeWorkerLockRequest=(i,e,a,c)=>async()=>{const h=nanoid();return globalThis.postMessage({type:e,identifier:h,name:i}),new Promise(d=>{const et=ft=>{if(ft==null||ft.data==null)return;const gt={type:ft.data.type,identifier:ft.data.identifier};gt.type===a&&gt.identifier===h&&(globalThis.removeEventListener("message",et),d(()=>{globalThis.postMessage({type:c,identifier:h,name:i})}))};globalThis.addEventListener("message",et)})},defaultOptions$5={singleProcess:!1},impl=i=>{if(i=Object.assign({},defaultOptions$5,i),!!globalThis.document||i.singleProcess){const a=new EventTarget;return observable.addEventListener("message",handleWorkerLockRequest(a,"requestReadLock",WORKER_REQUEST_READ_LOCK,WORKER_RELEASE_READ_LOCK,MASTER_GRANT_READ_LOCK)),observable.addEventListener("message",handleWorkerLockRequest(a,"requestWriteLock",WORKER_REQUEST_WRITE_LOCK,WORKER_RELEASE_WRITE_LOCK,MASTER_GRANT_WRITE_LOCK)),a}return{isWorker:!0,readLock:a=>makeWorkerLockRequest(a,WORKER_REQUEST_READ_LOCK,MASTER_GRANT_READ_LOCK,WORKER_RELEASE_READ_LOCK),writeLock:a=>makeWorkerLockRequest(a,WORKER_REQUEST_WRITE_LOCK,MASTER_GRANT_WRITE_LOCK,WORKER_RELEASE_WRITE_LOCK)}},mutexes={};let implementation;async function createReleaseable(i,e){let a;const c=new Promise(h=>{a=h});return i.add(async()=>pTimeout$1((async()=>{await new Promise(h=>{a(()=>{h()})})})(),{milliseconds:e.timeout})),c}const createMutex=(i,e)=>{if(implementation.isWorker===!0)return{readLock:implementation.readLock(i,e),writeLock:implementation.writeLock(i,e)};const a=new PQueue$1({concurrency:1});let c;return{async readLock(){if(c!=null)return createReleaseable(c,e);c=new PQueue$1({concurrency:e.concurrency,autoStart:!1});const h=c,d=createReleaseable(c,e);return a.add(async()=>{h.start(),await h.onIdle().then(()=>{c===h&&(c=null)})}),d},async writeLock(){return c=null,createReleaseable(a,e)}}},defaultOptions$4={name:"lock",concurrency:1/0,timeout:846e5,singleProcess:!1};function createMortice(i){const e=Object.assign({},defaultOptions$4,i);return implementation==null&&(implementation=impl(e),implementation.isWorker!==!0&&(implementation.addEventListener("requestReadLock",a=>{mutexes[a.data.name]!=null&&mutexes[a.data.name].readLock().then(async c=>a.data.handler().finally(()=>{c()}))}),implementation.addEventListener("requestWriteLock",async a=>{mutexes[a.data.name]!=null&&mutexes[a.data.name].writeLock().then(async c=>a.data.handler().finally(()=>{c()}))}))),mutexes[e.name]==null&&(mutexes[e.name]=createMutex(e.name,e)),mutexes[e.name]}const codes$1={ERR_INVALID_PARAMETERS:"ERR_INVALID_PARAMETERS"};var Peer;(function(i){(function(a){let c;a.codec=()=>(c==null&&(c=message((h,d,et={})=>{et.lengthDelimited!==!1&&d.fork(),h.key!=null&&h.key!==""&&(d.uint32(10),d.string(h.key)),h.value!=null&&h.value.byteLength>0&&(d.uint32(18),d.bytes(h.value)),et.lengthDelimited!==!1&&d.ldelim()},(h,d)=>{const et={key:"",value:new Uint8Array(0)},ft=d==null?h.len:h.pos+d;for(;h.pos<ft;){const gt=h.uint32();switch(gt>>>3){case 1:et.key=h.string();break;case 2:et.value=h.bytes();break;default:h.skipType(gt&7);break}}return et})),c),a.encode=h=>encodeMessage(h,a.codec()),a.decode=h=>decodeMessage$1(h,a.codec())})(i.Peer$metadataEntry||(i.Peer$metadataEntry={})),function(a){let c;a.codec=()=>(c==null&&(c=message((h,d,et={})=>{et.lengthDelimited!==!1&&d.fork(),h.key!=null&&h.key!==""&&(d.uint32(10),d.string(h.key)),h.value!=null&&(d.uint32(18),Tag.codec().encode(h.value,d)),et.lengthDelimited!==!1&&d.ldelim()},(h,d)=>{const et={key:""},ft=d==null?h.len:h.pos+d;for(;h.pos<ft;){const gt=h.uint32();switch(gt>>>3){case 1:et.key=h.string();break;case 2:et.value=Tag.codec().decode(h,h.uint32());break;default:h.skipType(gt&7);break}}return et})),c),a.encode=h=>encodeMessage(h,a.codec()),a.decode=h=>decodeMessage$1(h,a.codec())}(i.Peer$tagsEntry||(i.Peer$tagsEntry={}));let e;i.codec=()=>(e==null&&(e=message((a,c,h={})=>{if(h.lengthDelimited!==!1&&c.fork(),a.addresses!=null)for(const d of a.addresses)c.uint32(10),Address.codec().encode(d,c);if(a.protocols!=null)for(const d of a.protocols)c.uint32(18),c.string(d);if(a.publicKey!=null&&(c.uint32(34),c.bytes(a.publicKey)),a.peerRecordEnvelope!=null&&(c.uint32(42),c.bytes(a.peerRecordEnvelope)),a.metadata!=null&&a.metadata.size!==0)for(const[d,et]of a.metadata.entries())c.uint32(50),i.Peer$metadataEntry.codec().encode({key:d,value:et},c);if(a.tags!=null&&a.tags.size!==0)for(const[d,et]of a.tags.entries())c.uint32(58),i.Peer$tagsEntry.codec().encode({key:d,value:et},c);h.lengthDelimited!==!1&&c.ldelim()},(a,c)=>{const h={addresses:[],protocols:[],metadata:new Map,tags:new Map},d=c==null?a.len:a.pos+c;for(;a.pos<d;){const et=a.uint32();switch(et>>>3){case 1:h.addresses.push(Address.codec().decode(a,a.uint32()));break;case 2:h.protocols.push(a.string());break;case 4:h.publicKey=a.bytes();break;case 5:h.peerRecordEnvelope=a.bytes();break;case 6:{const ft=i.Peer$metadataEntry.codec().decode(a,a.uint32());h.metadata.set(ft.key,ft.value);break}case 7:{const ft=i.Peer$tagsEntry.codec().decode(a,a.uint32());h.tags.set(ft.key,ft.value);break}default:a.skipType(et&7);break}}return h})),e),i.encode=a=>encodeMessage(a,i.codec()),i.decode=a=>decodeMessage$1(a,i.codec())})(Peer||(Peer={}));var Address;(function(i){let e;i.codec=()=>(e==null&&(e=message((a,c,h={})=>{h.lengthDelimited!==!1&&c.fork(),a.multiaddr!=null&&a.multiaddr.byteLength>0&&(c.uint32(10),c.bytes(a.multiaddr)),a.isCertified!=null&&(c.uint32(16),c.bool(a.isCertified)),h.lengthDelimited!==!1&&c.ldelim()},(a,c)=>{const h={multiaddr:new Uint8Array(0)},d=c==null?a.len:a.pos+c;for(;a.pos<d;){const et=a.uint32();switch(et>>>3){case 1:h.multiaddr=a.bytes();break;case 2:h.isCertified=a.bool();break;default:a.skipType(et&7);break}}return h})),e),i.encode=a=>encodeMessage(a,i.codec()),i.decode=a=>decodeMessage$1(a,i.codec())})(Address||(Address={}));var Tag;(function(i){let e;i.codec=()=>(e==null&&(e=message((a,c,h={})=>{h.lengthDelimited!==!1&&c.fork(),a.value!=null&&a.value!==0&&(c.uint32(8),c.uint32(a.value)),a.expiry!=null&&(c.uint32(16),c.uint64(a.expiry)),h.lengthDelimited!==!1&&c.ldelim()},(a,c)=>{const h={value:0},d=c==null?a.len:a.pos+c;for(;a.pos<d;){const et=a.uint32();switch(et>>>3){case 1:h.value=a.uint32();break;case 2:h.expiry=a.uint64();break;default:a.skipType(et&7);break}}return h})),e),i.encode=a=>encodeMessage(a,i.codec()),i.decode=a=>decodeMessage$1(a,i.codec())})(Tag||(Tag={}));function bytesToPeer(i,e){const a=Peer.decode(e);a.publicKey!=null&&i.publicKey==null&&(i=peerIdFromPeerId({...i,publicKey:i.publicKey}));const c=new Map,h=BigInt(Date.now());for(const[d,et]of a.tags.entries())et.expiry!=null&&et.expiry<h||c.set(d,et);return{...a,id:i,addresses:a.addresses.map(({multiaddr:d,isCertified:et})=>({multiaddr:multiaddr(d),isCertified:et??!1})),metadata:a.metadata,peerRecordEnvelope:a.peerRecordEnvelope??void 0,tags:c}}const NAMESPACE_COMMON="/peers/";function peerIdToDatastoreKey(i){if(!isPeerId(i)||i.type==null)throw new CodeError$2("Invalid PeerId",codes$1.ERR_INVALID_PARAMETERS);const e=i.toCID().toString();return new Key(`${NAMESPACE_COMMON}${e}`)}async function dedupeFilterAndSortAddresses(i,e,a){const c=new Map;for(const h of a){if(h==null)continue;if(h.multiaddr instanceof Uint8Array&&(h.multiaddr=multiaddr(h.multiaddr)),!isMultiaddr(h.multiaddr))throw new CodeError$2("Multiaddr was invalid",codes$1.ERR_INVALID_PARAMETERS);if(!await e(i,h.multiaddr))continue;const d=h.isCertified??!1,et=h.multiaddr.toString(),ft=c.get(et);ft!=null?h.isCertified=ft.isCertified||d:c.set(et,{multiaddr:h.multiaddr,isCertified:d})}return[...c.values()].sort((h,d)=>h.multiaddr.toString().localeCompare(d.multiaddr.toString())).map(({isCertified:h,multiaddr:d})=>({isCertified:h,multiaddr:d.bytes}))}async function toPeerPB(i,e,a,c){if(e==null)throw new CodeError$2("Invalid PeerData",codes$1.ERR_INVALID_PARAMETERS);if(e.publicKey!=null&&i.publicKey!=null&&!equals$1(e.publicKey,i.publicKey))throw new CodeError$2("publicKey bytes do not match peer id publicKey bytes",codes$1.ERR_INVALID_PARAMETERS);const h=c.existingPeer;if(h!=null&&!i.equals(h.id))throw new CodeError$2("peer id did not match existing peer id",codes$1.ERR_INVALID_PARAMETERS);let d=(h==null?void 0:h.addresses)??[],et=new Set((h==null?void 0:h.protocols)??[]),ft=(h==null?void 0:h.metadata)??new Map,gt=(h==null?void 0:h.tags)??new Map,_t=h==null?void 0:h.peerRecordEnvelope;if(a==="patch"){if((e.multiaddrs!=null||e.addresses!=null)&&(d=[],e.multiaddrs!=null&&d.push(...e.multiaddrs.map($t=>({isCertified:!1,multiaddr:$t}))),e.addresses!=null&&d.push(...e.addresses)),e.protocols!=null&&(et=new Set(e.protocols)),e.metadata!=null){const $t=e.metadata instanceof Map?[...e.metadata.entries()]:Object.entries(e.metadata);ft=createSortedMap($t,{validate:validateMetadata})}if(e.tags!=null){const $t=e.tags instanceof Map?[...e.tags.entries()]:Object.entries(e.tags);gt=createSortedMap($t,{validate:validateTag,map:mapTag})}e.peerRecordEnvelope!=null&&(_t=e.peerRecordEnvelope)}if(a==="merge"){if(e.multiaddrs!=null&&d.push(...e.multiaddrs.map($t=>({isCertified:!1,multiaddr:$t}))),e.addresses!=null&&d.push(...e.addresses),e.protocols!=null&&(et=new Set([...et,...e.protocols])),e.metadata!=null){const $t=e.metadata instanceof Map?[...e.metadata.entries()]:Object.entries(e.metadata);for(const[It,Rt]of $t)Rt==null?ft.delete(It):ft.set(It,Rt);ft=createSortedMap([...ft.entries()],{validate:validateMetadata})}if(e.tags!=null){const $t=e.tags instanceof Map?[...e.tags.entries()]:Object.entries(e.tags),It=new Map(gt);for(const[Rt,Tt]of $t)Tt==null?It.delete(Rt):It.set(Rt,Tt);gt=createSortedMap([...It.entries()],{validate:validateTag,map:mapTag})}e.peerRecordEnvelope!=null&&(_t=e.peerRecordEnvelope)}const wt={addresses:await dedupeFilterAndSortAddresses(i,c.addressFilter??(async()=>!0),d),protocols:[...et.values()].sort(($t,It)=>$t.localeCompare(It)),metadata:ft,tags:gt,publicKey:(h==null?void 0:h.id.publicKey)??e.publicKey??i.publicKey,peerRecordEnvelope:_t};return i.type!=="RSA"&&delete wt.publicKey,wt}function createSortedMap(i,e){var c;const a=new Map;for(const[h,d]of i)d!=null&&e.validate(h,d);for(const[h,d]of i.sort(([et],[ft])=>et.localeCompare(ft)))d!=null&&a.set(h,((c=e.map)==null?void 0:c.call(e,h,d))??d);return a}function validateMetadata(i,e){if(typeof i!="string")throw new CodeError$2("Metadata key must be a string",codes$1.ERR_INVALID_PARAMETERS);if(!(e instanceof Uint8Array))throw new CodeError$2("Metadata value must be a Uint8Array",codes$1.ERR_INVALID_PARAMETERS)}function validateTag(i,e){if(typeof i!="string")throw new CodeError$2("Tag name must be a string",codes$1.ERR_INVALID_PARAMETERS);if(e.value!=null){if(parseInt(`${e.value}`,10)!==e.value)throw new CodeError$2("Tag value must be an integer",codes$1.ERR_INVALID_PARAMETERS);if(e.value<0||e.value>100)throw new CodeError$2("Tag value must be between 0-100",codes$1.ERR_INVALID_PARAMETERS)}if(e.ttl!=null){if(parseInt(`${e.ttl}`,10)!==e.ttl)throw new CodeError$2("Tag ttl must be an integer",codes$1.ERR_INVALID_PARAMETERS);if(e.ttl<0)throw new CodeError$2("Tag ttl must be between greater than 0",codes$1.ERR_INVALID_PARAMETERS)}}function mapTag(i,e){let a;return e.expiry!=null&&(a=e.expiry),e.ttl!=null&&(a=BigInt(Date.now()+Number(e.ttl))),{value:e.value??0,expiry:a}}function decodePeer(i,e,a){const c=i.toString().split("/")[2],h=base32$c.decode(c),d=peerIdFromBytes(h),et=a.get(d);if(et!=null)return et;const ft=bytesToPeer(d,e);return a.set(d,ft),ft}function mapQuery(i,e){return i==null?{}:{prefix:NAMESPACE_COMMON,filters:(i.filters??[]).map(a=>({key:c,value:h})=>a(decodePeer(c,h,e))),orders:(i.orders??[]).map(a=>(c,h)=>a(decodePeer(c.key,c.value,e),decodePeer(h.key,h.value,e)))}}var io,Ao,so,Po;class PersistentStore{constructor(e,a={}){gn(this,io);gn(this,so);qt(this,"peerId");qt(this,"datastore");qt(this,"lock");qt(this,"addressFilter");this.peerId=e.peerId,this.datastore=e.datastore,this.addressFilter=a.addressFilter,this.lock=createMortice({name:"peer-store",singleProcess:!0})}async has(e){return this.datastore.has(peerIdToDatastoreKey(e))}async delete(e){if(this.peerId.equals(e))throw new CodeError$2("Cannot delete self peer",codes$1.ERR_INVALID_PARAMETERS);await this.datastore.delete(peerIdToDatastoreKey(e))}async load(e){const a=await this.datastore.get(peerIdToDatastoreKey(e));return bytesToPeer(e,a)}async save(e,a){const{existingBuf:c,existingPeer:h}=await _n(this,io,Ao).call(this,e),d=await toPeerPB(e,a,"patch",{addressFilter:this.addressFilter});return _n(this,so,Po).call(this,e,d,c,h)}async patch(e,a){const{existingBuf:c,existingPeer:h}=await _n(this,io,Ao).call(this,e),d=await toPeerPB(e,a,"patch",{addressFilter:this.addressFilter,existingPeer:h});return _n(this,so,Po).call(this,e,d,c,h)}async merge(e,a){const{existingBuf:c,existingPeer:h}=await _n(this,io,Ao).call(this,e),d=await toPeerPB(e,a,"merge",{addressFilter:this.addressFilter,existingPeer:h});return _n(this,so,Po).call(this,e,d,c,h)}async*all(e){const a=new PeerMap;for await(const{key:c,value:h}of this.datastore.query(mapQuery(e??{},a))){const d=decodePeer(c,h,a);d.id.equals(this.peerId)||(yield d)}}}io=new WeakSet,Ao=async function(e){try{const a=await this.datastore.get(peerIdToDatastoreKey(e)),c=bytesToPeer(e,a);return{existingBuf:a,existingPeer:c}}catch(a){if(a.code!=="ERR_NOT_FOUND")throw a}return{}},so=new WeakSet,Po=async function(e,a,c,h){const d=Peer.encode(a);return c!=null&&equals$1(d,c)?{peer:bytesToPeer(e,d),previous:h,updated:!1}:(await this.datastore.put(peerIdToDatastoreKey(e),d),{peer:bytesToPeer(e,d),previous:h,updated:!0})};const log$a=logger$2("libp2p:peer-store");var oo,ko;class PersistentPeerStore{constructor(e,a={}){gn(this,oo);qt(this,"store");qt(this,"events");qt(this,"peerId");this.events=e.events,this.peerId=e.peerId,this.store=new PersistentStore(e,a)}async forEach(e,a){log$a.trace("forEach await read lock");const c=await this.store.lock.readLock();log$a.trace("forEach got read lock");try{for await(const h of this.store.all(a))e(h)}finally{log$a.trace("forEach release read lock"),c()}}async all(e){log$a.trace("all await read lock");const a=await this.store.lock.readLock();log$a.trace("all got read lock");try{return await all$1(this.store.all(e))}finally{log$a.trace("all release read lock"),a()}}async delete(e){log$a.trace("delete await write lock");const a=await this.store.lock.writeLock();log$a.trace("delete got write lock");try{await this.store.delete(e)}finally{log$a.trace("delete release write lock"),a()}}async has(e){log$a.trace("has await read lock");const a=await this.store.lock.readLock();log$a.trace("has got read lock");try{return await this.store.has(e)}finally{log$a.trace("has release read lock"),a()}}async get(e){log$a.trace("get await read lock");const a=await this.store.lock.readLock();log$a.trace("get got read lock");try{return await this.store.load(e)}finally{log$a.trace("get release read lock"),a()}}async save(e,a){log$a.trace("save await write lock");const c=await this.store.lock.writeLock();log$a.trace("save got write lock");try{const h=await this.store.save(e,a);return _n(this,oo,ko).call(this,e,h),h.peer}finally{log$a.trace("save release write lock"),c()}}async patch(e,a){log$a.trace("patch await write lock");const c=await this.store.lock.writeLock();log$a.trace("patch got write lock");try{const h=await this.store.patch(e,a);return _n(this,oo,ko).call(this,e,h),h.peer}finally{log$a.trace("patch release write lock"),c()}}async merge(e,a){log$a.trace("merge await write lock");const c=await this.store.lock.writeLock();log$a.trace("merge got write lock");try{const h=await this.store.merge(e,a);return _n(this,oo,ko).call(this,e,h),h.peer}finally{log$a.trace("merge release write lock"),c()}}async consumePeerRecord(e,a){const c=await RecordEnvelope.openAndCertify(e,PeerRecord.DOMAIN);if((a==null?void 0:a.equals(c.peerId))===!1)return log$a("envelope peer id was not the expected peer id - expected: %p received: %p",a,c.peerId),!1;const h=PeerRecord.createFromProtobuf(c.payload);let d;try{d=await this.get(c.peerId)}catch(et){if(et.code!=="ERR_NOT_FOUND")throw et}if((d==null?void 0:d.peerRecordEnvelope)!=null){const et=await RecordEnvelope.createFromProtobuf(d.peerRecordEnvelope),ft=PeerRecord.createFromProtobuf(et.payload);if(ft.seqNumber>=h.seqNumber)return log$a("sequence number was lower or equal to existing sequence number - stored: %d received: %d",ft.seqNumber,h.seqNumber),!1}return await this.patch(h.peerId,{peerRecordEnvelope:e,addresses:h.multiaddrs.map(et=>({isCertified:!0,multiaddr:et}))}),!0}}oo=new WeakSet,ko=function(e,a){a.updated&&(this.peerId.equals(e)?this.events.safeDispatchEvent("self:peer:update",{detail:a}):this.events.safeDispatchEvent("peer:update",{detail:a}))};function isAsyncIterable$5(i){return i[Symbol.asyncIterator]!=null}function drain(i){if(isAsyncIterable$5(i))return(async()=>{for await(const e of i);})();for(const e of i);}function peekable(i){const[e,a]=i[Symbol.asyncIterator]!=null?[i[Symbol.asyncIterator](),Symbol.asyncIterator]:[i[Symbol.iterator](),Symbol.iterator],c=[];return{peek:()=>e.next(),push:h=>{c.push(h)},next:()=>c.length>0?{done:!1,value:c.shift()}:e.next(),[a](){return this}}}function isAsyncIterable$4(i){return i[Symbol.asyncIterator]!=null}function filter(i,e){if(isAsyncIterable$4(i))return async function*(){for await(const ft of i)await e(ft)&&(yield ft)}();const a=peekable(i),{value:c,done:h}=a.next();if(h===!0)return function*(){}();const d=e(c);if(typeof d.then=="function")return async function*(){await d&&(yield c);for await(const ft of a)await e(ft)&&(yield ft)}();const et=e;return function*(){d===!0&&(yield c);for(const ft of a)et(ft)&&(yield ft)}()}function isAsyncIterable$3(i){return i[Symbol.asyncIterator]!=null}function sort(i,e){return isAsyncIterable$3(i)?async function*(){yield*(await all$1(i)).sort(e)}():function*(){yield*all$1(i).sort(e)}()}function isAsyncIterable$2(i){return i[Symbol.asyncIterator]!=null}function take(i,e){return isAsyncIterable$2(i)?async function*(){let a=0;if(!(e<1)){for await(const c of i)if(yield c,a++,a===e)return}}():function*(){let a=0;if(!(e<1)){for(const c of i)if(yield c,a++,a===e)return}}()}class BaseDatastore{put(e,a,c){return Promise.reject(new Error(".put is not implemented"))}get(e,a){return Promise.reject(new Error(".get is not implemented"))}has(e,a){return Promise.reject(new Error(".has is not implemented"))}delete(e,a){return Promise.reject(new Error(".delete is not implemented"))}async*putMany(e,a={}){for await(const{key:c,value:h}of e)await this.put(c,h,a),yield c}async*getMany(e,a={}){for await(const c of e)yield{key:c,value:await this.get(c,a)}}async*deleteMany(e,a={}){for await(const c of e)await this.delete(c,a),yield c}batch(){let e=[],a=[];return{put(c,h){e.push({key:c,value:h})},delete(c){a.push(c)},commit:async c=>{await drain(this.putMany(e,c)),e=[],await drain(this.deleteMany(a,c)),a=[]}}}async*_all(e,a){throw new Error("._all is not implemented")}async*_allKeys(e,a){throw new Error("._allKeys is not implemented")}query(e,a){let c=this._all(e,a);if(e.prefix!=null){const h=e.prefix;c=filter(c,d=>d.key.toString().startsWith(h))}if(Array.isArray(e.filters)&&(c=e.filters.reduce((h,d)=>filter(h,d),c)),Array.isArray(e.orders)&&(c=e.orders.reduce((h,d)=>sort(h,d),c)),e.offset!=null){let h=0;const d=e.offset;c=filter(c,()=>h++>=d)}return e.limit!=null&&(c=take(c,e.limit)),c}queryKeys(e,a){let c=this._allKeys(e,a);if(e.prefix!=null){const h=e.prefix;c=filter(c,d=>d.toString().startsWith(h))}if(Array.isArray(e.filters)&&(c=e.filters.reduce((h,d)=>filter(h,d),c)),Array.isArray(e.orders)&&(c=e.orders.reduce((h,d)=>sort(h,d),c)),e.offset!=null){const h=e.offset;let d=0;c=filter(c,()=>d++>=h)}return e.limit!=null&&(c=take(c,e.limit)),c}}function notFoundError(i){return i=i??new Error("Not Found"),errCode$1(i,"ERR_NOT_FOUND")}class MemoryDatastore extends BaseDatastore{constructor(){super();qt(this,"data");this.data=new Map}put(a,c){return this.data.set(a.toString(),c),a}get(a){const c=this.data.get(a.toString());if(c==null)throw notFoundError();return c}has(a){return this.data.has(a.toString())}delete(a){this.data.delete(a.toString())}*_all(){for(const[a,c]of this.data.entries())yield{key:new Key(a),value:c}}*_allKeys(){for(const a of this.data.keys())yield new Key(a)}}function debounce(i,e){let a;return function(){const c=function(){a=void 0,i()};clearTimeout(a),a=setTimeout(c,e)}}const log$9=logger$2("libp2p:address-manager"),defaultAddressFilter=i=>i;function stripPeerId(i,e){const a=i.getPeerId();return a!=null&&peerIdFromString(a).equals(e)&&(i=i.decapsulate(multiaddr(`/p2p/${e.toString()}`))),i}class DefaultAddressManager{constructor(e,a={}){qt(this,"components");qt(this,"listen");qt(this,"announce");qt(this,"observed");qt(this,"announceFilter");const{listen:c=[],announce:h=[]}=a;this.components=e,this.listen=c.map(d=>d.toString()),this.announce=new Set(h.map(d=>d.toString())),this.observed=new Map,this.announceFilter=a.announceFilter??defaultAddressFilter,this._updatePeerStoreAddresses=debounce(this._updatePeerStoreAddresses.bind(this),1e3),e.events.addEventListener("transport:listening",()=>{this._updatePeerStoreAddresses()}),e.events.addEventListener("transport:close",()=>{this._updatePeerStoreAddresses()})}_updatePeerStoreAddresses(){const e=this.getAnnounceAddrs().concat(this.components.transportManager.getAddrs()).concat([...this.observed.entries()].filter(([a,c])=>c.confident).map(([a])=>multiaddr(a))).map(a=>a.getPeerId()===this.components.peerId.toString()?a.decapsulate(`/p2p/${this.components.peerId.toString()}`):a);this.components.peerStore.patch(this.components.peerId,{multiaddrs:e}).catch(a=>{log$9.error("error updating addresses",a)})}getListenAddrs(){return Array.from(this.listen).map(e=>multiaddr(e))}getAnnounceAddrs(){return Array.from(this.announce).map(e=>multiaddr(e))}getObservedAddrs(){return Array.from(this.observed).map(([e])=>multiaddr(e))}addObservedAddr(e){e=stripPeerId(e,this.components.peerId);const a=e.toString();this.observed.has(a)||this.observed.set(a,{confident:!1})}confirmObservedAddr(e){e=stripPeerId(e,this.components.peerId);const a=e.toString(),h=(this.observed.get(a)??{confident:!1}).confident;this.observed.set(a,{confident:!0}),h||this._updatePeerStoreAddresses()}removeObservedAddr(e){e=stripPeerId(e,this.components.peerId);const a=e.toString();this.observed.delete(a)}getAddresses(){let e=this.getAnnounceAddrs().map(c=>c.toString());e.length===0&&(e=this.components.transportManager.getAddrs().map(c=>c.toString())),e=e.concat(Array.from(this.observed).filter(([c,h])=>h.confident).map(([c])=>c));const a=new Set(e);return this.announceFilter(Array.from(a).map(c=>multiaddr(c))).map(c=>{var h;return((h=c.protos().pop())==null?void 0:h.path)===!0||c.getPeerId()===this.components.peerId.toString()?c:c.encapsulate(`/p2p/${this.components.peerId.toString()}`)})}}function isStartable(i){return i!=null&&typeof i.start=="function"&&typeof i.stop=="function"}class DefaultComponents{constructor(e={}){qt(this,"components",{});qt(this,"_started",!1);this.components={};for(const[a,c]of Object.entries(e))this.components[a]=c;this.components.logger==null&&(this.components.logger=defaultLogger())}isStarted(){return this._started}async _invokeStartableMethod(e){await Promise.all(Object.values(this.components).filter(a=>isStartable(a)).map(async a=>{var c;await((c=a[e])==null?void 0:c.call(a))}))}async beforeStart(){await this._invokeStartableMethod("beforeStart")}async start(){await this._invokeStartableMethod("start"),this._started=!0}async afterStart(){await this._invokeStartableMethod("afterStart")}async beforeStop(){await this._invokeStartableMethod("beforeStop")}async stop(){await this._invokeStartableMethod("stop"),this._started=!1}async afterStop(){await this._invokeStartableMethod("afterStop")}}const OPTIONAL_SERVICES=["metrics","connectionProtector"],NON_SERVICE_PROPERTIES=["components","isStarted","beforeStart","start","afterStart","beforeStop","stop","afterStop","then","_invokeStartableMethod"];function defaultComponents(i={}){const e=new DefaultComponents(i);return new Proxy(e,{get(c,h,d){if(typeof h=="string"&&!NON_SERVICE_PROPERTIES.includes(h)){const et=e.components[h];if(et==null&&!OPTIONAL_SERVICES.includes(h))throw new CodeError$2(`${h} not set`,"ERR_SERVICE_MISSING");return et}return Reflect.get(c,h,d)},set(c,h,d){return typeof h=="string"?e.components[h]=d:Reflect.set(c,h,d),!0}})}var Netmask_1;(function(){var i,e,a,c,h,d,et,ft;ft=function(gt){var _t,wt,$t,It;return _t=(gt&255<<24)>>>24,wt=(gt&255<<16)>>>16,$t=(gt&65280)>>>8,It=gt&255,[_t,wt,$t,It].join(".")},et=function(gt){var _t,wt,$t,It,Rt,Tt;for(_t=[],$t=It=0;It<=3&&gt.length!==0;$t=++It){if($t>0){if(gt[0]!==".")throw new Error("Invalid IP");gt=gt.substring(1)}Tt=e(gt),Rt=Tt[0],wt=Tt[1],gt=gt.substring(wt),_t.push(Rt)}if(gt.length!==0)throw new Error("Invalid IP");switch(_t.length){case 1:if(_t[0]>4294967295)throw new Error("Invalid IP");return _t[0]>>>0;case 2:if(_t[0]>255||_t[1]>16777215)throw new Error("Invalid IP");return(_t[0]<<24|_t[1])>>>0;case 3:if(_t[0]>255||_t[1]>255||_t[2]>65535)throw new Error("Invalid IP");return(_t[0]<<24|_t[1]<<16|_t[2])>>>0;case 4:if(_t[0]>255||_t[1]>255||_t[2]>255||_t[3]>255)throw new Error("Invalid IP");return(_t[0]<<24|_t[1]<<16|_t[2]<<8|_t[3])>>>0;default:throw new Error("Invalid IP")}},a=function(gt){return gt.charCodeAt(0)},c=a("0"),d=a("a"),h=a("A"),e=function(gt){var _t,wt,$t,It,Rt;for(It=0,_t=10,wt="9",$t=0,gt.length>1&&gt[$t]==="0"&&(gt[$t+1]==="x"||gt[$t+1]==="X"?($t+=2,_t=16):"0"<=gt[$t+1]&&gt[$t+1]<="9"&&($t++,_t=8,wt="7")),Rt=$t;$t<gt.length;){if("0"<=gt[$t]&&gt[$t]<=wt)It=It*_t+(a(gt[$t])-c)>>>0;else if(_t===16)if("a"<=gt[$t]&&gt[$t]<="f")It=It*_t+(10+a(gt[$t])-d)>>>0;else if("A"<=gt[$t]&&gt[$t]<="F")It=It*_t+(10+a(gt[$t])-h)>>>0;else break;else break;if(It>4294967295)throw new Error("too large");$t++}if($t===Rt)throw new Error("empty octet");return[It,$t]},i=function(){function gt(_t,wt){var $t,It,Rt;if(typeof _t!="string")throw new Error("Missing `net' parameter");if(wt||(Rt=_t.split("/",2),_t=Rt[0],wt=Rt[1]),wt||(wt=32),typeof wt=="string"&&wt.indexOf(".")>-1){try{this.maskLong=et(wt)}catch{throw new Error("Invalid mask: "+wt)}for($t=It=32;It>=0;$t=--It)if(this.maskLong===4294967295<<32-$t>>>0){this.bitmask=$t;break}}else if(wt||wt===0)this.bitmask=parseInt(wt,10),this.maskLong=0,this.bitmask>0&&(this.maskLong=4294967295<<32-this.bitmask>>>0);else throw new Error("Invalid mask: empty");try{this.netLong=(et(_t)&this.maskLong)>>>0}catch{throw new Error("Invalid net address: "+_t)}if(!(this.bitmask<=32))throw new Error("Invalid mask for ip4: "+wt);this.size=Math.pow(2,32-this.bitmask),this.base=ft(this.netLong),this.mask=ft(this.maskLong),this.hostmask=ft(~this.maskLong),this.first=this.bitmask<=30?ft(this.netLong+1):this.base,this.last=this.bitmask<=30?ft(this.netLong+this.size-2):ft(this.netLong+this.size-1),this.broadcast=this.bitmask<=30?ft(this.netLong+this.size-1):void 0}return gt.prototype.contains=function(_t){return typeof _t=="string"&&(_t.indexOf("/")>0||_t.split(".").length!==4)&&(_t=new gt(_t)),_t instanceof gt?this.contains(_t.base)&&this.contains(_t.broadcast||_t.last):(et(_t)&this.maskLong)>>>0===(this.netLong&this.maskLong)>>>0},gt.prototype.next=function(_t){return _t==null&&(_t=1),new gt(ft(this.netLong+this.size*_t),this.mask)},gt.prototype.forEach=function(_t){var wt,$t,It;for(It=et(this.first),$t=et(this.last),wt=0;It<=$t;)_t(ft(It),It,wt),wt++,It++},gt.prototype.toString=function(){return this.base+"/"+this.bitmask},gt}(),Netmask_1=i}).call(commonjsGlobal);const word="[a-fA-F\\d:]",boundry=i=>i&&i.includeBoundaries?`(?:(?<=\\s|^)(?=${word})|(?<=${word})(?=\\s|$))`:"",v4="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",v6segment="[a-fA-F\\d]{1,4}",v6=`
(?:
(?:${v6segment}:){7}(?:${v6segment}|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8
(?:${v6segment}:){6}(?:${v4}|:${v6segment}|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4
(?:${v6segment}:){5}(?::${v4}|(?::${v6segment}){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4
(?:${v6segment}:){4}(?:(?::${v6segment}){0,1}:${v4}|(?::${v6segment}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4
(?:${v6segment}:){3}(?:(?::${v6segment}){0,2}:${v4}|(?::${v6segment}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4
(?:${v6segment}:){2}(?:(?::${v6segment}){0,3}:${v4}|(?::${v6segment}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4
(?:${v6segment}:){1}(?:(?::${v6segment}){0,4}:${v4}|(?::${v6segment}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4
(?::(?:(?::${v6segment}){0,5}:${v4}|(?::${v6segment}){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4
)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1
`.replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),v46Exact=new RegExp(`(?:^${v4}$)|(?:^${v6}$)`),v4exact=new RegExp(`^${v4}$`),v6exact=new RegExp(`^${v6}$`),ipRegex=i=>i&&i.exact?v46Exact:new RegExp(`(?:${boundry(i)}${v4}${boundry(i)})|(?:${boundry(i)}${v6}${boundry(i)})`,"g");ipRegex.v4=i=>i&&i.exact?v4exact:new RegExp(`${boundry(i)}${v4}${boundry(i)}`,"g");ipRegex.v6=i=>i&&i.exact?v6exact:new RegExp(`${boundry(i)}${v6}${boundry(i)}`,"g");var ipaddr$1={exports:{}};(function(i){(function(e){const a="(0?\\d+|0x[a-f0-9]+)",c={fourOctet:new RegExp(`^${a}\\.${a}\\.${a}\\.${a}$`,"i"),threeOctet:new RegExp(`^${a}\\.${a}\\.${a}$`,"i"),twoOctet:new RegExp(`^${a}\\.${a}$`,"i"),longValue:new RegExp(`^${a}$`,"i")},h=new RegExp("^0[0-7]+$","i"),d=new RegExp("^0x[a-f0-9]+$","i"),et="%[0-9a-z]{1,}",ft="(?:[0-9a-f]+::?)+",gt={zoneIndex:new RegExp(et,"i"),native:new RegExp(`^(::)?(${ft})?([0-9a-f]+)?(::)?(${et})?$`,"i"),deprecatedTransitional:new RegExp(`^(?:::)(${a}\\.${a}\\.${a}\\.${a}(${et})?)$`,"i"),transitional:new RegExp(`^((?:${ft})|(?:::)(?:${ft})?)${a}\\.${a}\\.${a}\\.${a}(${et})?$`,"i")};function _t(Tt,At){if(Tt.indexOf("::")!==Tt.lastIndexOf("::"))return null;let kt=0,xt=-1,Nt=(Tt.match(gt.zoneIndex)||[])[0],Ft,jt;for(Nt&&(Nt=Nt.substring(1),Tt=Tt.replace(/%.+$/,""));(xt=Tt.indexOf(":",xt+1))>=0;)kt++;if(Tt.substr(0,2)==="::"&&kt--,Tt.substr(-2,2)==="::"&&kt--,kt>At)return null;for(jt=At-kt,Ft=":";jt--;)Ft+="0:";return Tt=Tt.replace("::",Ft),Tt[0]===":"&&(Tt=Tt.slice(1)),Tt[Tt.length-1]===":"&&(Tt=Tt.slice(0,-1)),At=function(){const Gt=Tt.split(":"),Kt=[];for(let Wt=0;Wt<Gt.length;Wt++)Kt.push(parseInt(Gt[Wt],16));return Kt}(),{parts:At,zoneId:Nt}}function wt(Tt,At,kt,xt){if(Tt.length!==At.length)throw new Error("ipaddr: cannot match CIDR for objects with different lengths");let Nt=0,Ft;for(;xt>0;){if(Ft=kt-xt,Ft<0&&(Ft=0),Tt[Nt]>>Ft!==At[Nt]>>Ft)return!1;xt-=kt,Nt+=1}return!0}function $t(Tt){if(d.test(Tt))return parseInt(Tt,16);if(Tt[0]==="0"&&!isNaN(parseInt(Tt[1],10))){if(h.test(Tt))return parseInt(Tt,8);throw new Error(`ipaddr: cannot parse ${Tt} as octal`)}return parseInt(Tt,10)}function It(Tt,At){for(;Tt.length<At;)Tt=`0${Tt}`;return Tt}const Rt={};Rt.IPv4=function(){function Tt(At){if(At.length!==4)throw new Error("ipaddr: ipv4 octet count should be 4");let kt,xt;for(kt=0;kt<At.length;kt++)if(xt=At[kt],!(0<=xt&&xt<=255))throw new Error("ipaddr: ipv4 octet should fit in 8 bits");this.octets=At}return Tt.prototype.SpecialRanges={unspecified:[[new Tt([0,0,0,0]),8]],broadcast:[[new Tt([255,255,255,255]),32]],multicast:[[new Tt([224,0,0,0]),4]],linkLocal:[[new Tt([169,254,0,0]),16]],loopback:[[new Tt([127,0,0,0]),8]],carrierGradeNat:[[new Tt([100,64,0,0]),10]],private:[[new Tt([10,0,0,0]),8],[new Tt([172,16,0,0]),12],[new Tt([192,168,0,0]),16]],reserved:[[new Tt([192,0,0,0]),24],[new Tt([192,0,2,0]),24],[new Tt([192,88,99,0]),24],[new Tt([198,18,0,0]),15],[new Tt([198,51,100,0]),24],[new Tt([203,0,113,0]),24],[new Tt([240,0,0,0]),4]]},Tt.prototype.kind=function(){return"ipv4"},Tt.prototype.match=function(At,kt){let xt;if(kt===void 0&&(xt=At,At=xt[0],kt=xt[1]),At.kind()!=="ipv4")throw new Error("ipaddr: cannot match ipv4 address with non-ipv4 one");return wt(this.octets,At.octets,8,kt)},Tt.prototype.prefixLengthFromSubnetMask=function(){let At=0,kt=!1;const xt={0:8,128:7,192:6,224:5,240:4,248:3,252:2,254:1,255:0};let Nt,Ft,jt;for(Nt=3;Nt>=0;Nt-=1)if(Ft=this.octets[Nt],Ft in xt){if(jt=xt[Ft],kt&&jt!==0)return null;jt!==8&&(kt=!0),At+=jt}else return null;return 32-At},Tt.prototype.range=function(){return Rt.subnetMatch(this,this.SpecialRanges)},Tt.prototype.toByteArray=function(){return this.octets.slice(0)},Tt.prototype.toIPv4MappedAddress=function(){return Rt.IPv6.parse(`::ffff:${this.toString()}`)},Tt.prototype.toNormalizedString=function(){return this.toString()},Tt.prototype.toString=function(){return this.octets.join(".")},Tt}(),Rt.IPv4.broadcastAddressFromCIDR=function(Tt){try{const At=this.parseCIDR(Tt),kt=At[0].toByteArray(),xt=this.subnetMaskFromPrefixLength(At[1]).toByteArray(),Nt=[];let Ft=0;for(;Ft<4;)Nt.push(parseInt(kt[Ft],10)|parseInt(xt[Ft],10)^255),Ft++;return new this(Nt)}catch{throw new Error("ipaddr: the address does not have IPv4 CIDR format")}},Rt.IPv4.isIPv4=function(Tt){return this.parser(Tt)!==null},Rt.IPv4.isValid=function(Tt){try{return new this(this.parser(Tt)),!0}catch{return!1}},Rt.IPv4.isValidFourPartDecimal=function(Tt){return!!(Rt.IPv4.isValid(Tt)&&Tt.match(/^(0|[1-9]\d*)(\.(0|[1-9]\d*)){3}$/))},Rt.IPv4.networkAddressFromCIDR=function(Tt){let At,kt,xt,Nt,Ft;try{for(At=this.parseCIDR(Tt),xt=At[0].toByteArray(),Ft=this.subnetMaskFromPrefixLength(At[1]).toByteArray(),Nt=[],kt=0;kt<4;)Nt.push(parseInt(xt[kt],10)&parseInt(Ft[kt],10)),kt++;return new this(Nt)}catch{throw new Error("ipaddr: the address does not have IPv4 CIDR format")}},Rt.IPv4.parse=function(Tt){const At=this.parser(Tt);if(At===null)throw new Error("ipaddr: string is not formatted like an IPv4 Address");return new this(At)},Rt.IPv4.parseCIDR=function(Tt){let At;if(At=Tt.match(/^(.+)\/(\d+)$/)){const kt=parseInt(At[2]);if(kt>=0&&kt<=32){const xt=[this.parse(At[1]),kt];return Object.defineProperty(xt,"toString",{value:function(){return this.join("/")}}),xt}}throw new Error("ipaddr: string is not formatted like an IPv4 CIDR range")},Rt.IPv4.parser=function(Tt){let At,kt,xt;if(At=Tt.match(c.fourOctet))return function(){const Nt=At.slice(1,6),Ft=[];for(let jt=0;jt<Nt.length;jt++)kt=Nt[jt],Ft.push($t(kt));return Ft}();if(At=Tt.match(c.longValue)){if(xt=$t(At[1]),xt>4294967295||xt<0)throw new Error("ipaddr: address outside defined range");return function(){const Nt=[];let Ft;for(Ft=0;Ft<=24;Ft+=8)Nt.push(xt>>Ft&255);return Nt}().reverse()}else return(At=Tt.match(c.twoOctet))?function(){const Nt=At.slice(1,4),Ft=[];if(xt=$t(Nt[1]),xt>16777215||xt<0)throw new Error("ipaddr: address outside defined range");return Ft.push($t(Nt[0])),Ft.push(xt>>16&255),Ft.push(xt>>8&255),Ft.push(xt&255),Ft}():(At=Tt.match(c.threeOctet))?function(){const Nt=At.slice(1,5),Ft=[];if(xt=$t(Nt[2]),xt>65535||xt<0)throw new Error("ipaddr: address outside defined range");return Ft.push($t(Nt[0])),Ft.push($t(Nt[1])),Ft.push(xt>>8&255),Ft.push(xt&255),Ft}():null},Rt.IPv4.subnetMaskFromPrefixLength=function(Tt){if(Tt=parseInt(Tt),Tt<0||Tt>32)throw new Error("ipaddr: invalid IPv4 prefix length");const At=[0,0,0,0];let kt=0;const xt=Math.floor(Tt/8);for(;kt<xt;)At[kt]=255,kt++;return xt<4&&(At[xt]=Math.pow(2,Tt%8)-1<<8-Tt%8),new this(At)},Rt.IPv6=function(){function Tt(At,kt){let xt,Nt;if(At.length===16)for(this.parts=[],xt=0;xt<=14;xt+=2)this.parts.push(At[xt]<<8|At[xt+1]);else if(At.length===8)this.parts=At;else throw new Error("ipaddr: ipv6 part count should be 8 or 16");for(xt=0;xt<this.parts.length;xt++)if(Nt=this.parts[xt],!(0<=Nt&&Nt<=65535))throw new Error("ipaddr: ipv6 part should fit in 16 bits");kt&&(this.zoneId=kt)}return Tt.prototype.SpecialRanges={unspecified:[new Tt([0,0,0,0,0,0,0,0]),128],linkLocal:[new Tt([65152,0,0,0,0,0,0,0]),10],multicast:[new Tt([65280,0,0,0,0,0,0,0]),8],loopback:[new Tt([0,0,0,0,0,0,0,1]),128],uniqueLocal:[new Tt([64512,0,0,0,0,0,0,0]),7],ipv4Mapped:[new Tt([0,0,0,0,0,65535,0,0]),96],rfc6145:[new Tt([0,0,0,0,65535,0,0,0]),96],rfc6052:[new Tt([100,65435,0,0,0,0,0,0]),96],"6to4":[new Tt([8194,0,0,0,0,0,0,0]),16],teredo:[new Tt([8193,0,0,0,0,0,0,0]),32],reserved:[[new Tt([8193,3512,0,0,0,0,0,0]),32]],benchmarking:[new Tt([8193,2,0,0,0,0,0,0]),48],amt:[new Tt([8193,3,0,0,0,0,0,0]),32],as112v6:[new Tt([8193,4,274,0,0,0,0,0]),48],deprecated:[new Tt([8193,16,0,0,0,0,0,0]),28],orchid2:[new Tt([8193,32,0,0,0,0,0,0]),28]},Tt.prototype.isIPv4MappedAddress=function(){return this.range()==="ipv4Mapped"},Tt.prototype.kind=function(){return"ipv6"},Tt.prototype.match=function(At,kt){let xt;if(kt===void 0&&(xt=At,At=xt[0],kt=xt[1]),At.kind()!=="ipv6")throw new Error("ipaddr: cannot match ipv6 address with non-ipv6 one");return wt(this.parts,At.parts,16,kt)},Tt.prototype.prefixLengthFromSubnetMask=function(){let At=0,kt=!1;const xt={0:16,32768:15,49152:14,57344:13,61440:12,63488:11,64512:10,65024:9,65280:8,65408:7,65472:6,65504:5,65520:4,65528:3,65532:2,65534:1,65535:0};let Nt,Ft;for(let jt=7;jt>=0;jt-=1)if(Nt=this.parts[jt],Nt in xt){if(Ft=xt[Nt],kt&&Ft!==0)return null;Ft!==16&&(kt=!0),At+=Ft}else return null;return 128-At},Tt.prototype.range=function(){return Rt.subnetMatch(this,this.SpecialRanges)},Tt.prototype.toByteArray=function(){let At;const kt=[],xt=this.parts;for(let Nt=0;Nt<xt.length;Nt++)At=xt[Nt],kt.push(At>>8),kt.push(At&255);return kt},Tt.prototype.toFixedLengthString=function(){const At=(function(){const xt=[];for(let Nt=0;Nt<this.parts.length;Nt++)xt.push(It(this.parts[Nt].toString(16),4));return xt}).call(this).join(":");let kt="";return this.zoneId&&(kt=`%${this.zoneId}`),At+kt},Tt.prototype.toIPv4Address=function(){if(!this.isIPv4MappedAddress())throw new Error("ipaddr: trying to convert a generic ipv6 address to ipv4");const At=this.parts.slice(-2),kt=At[0],xt=At[1];return new Rt.IPv4([kt>>8,kt&255,xt>>8,xt&255])},Tt.prototype.toNormalizedString=function(){const At=(function(){const xt=[];for(let Nt=0;Nt<this.parts.length;Nt++)xt.push(this.parts[Nt].toString(16));return xt}).call(this).join(":");let kt="";return this.zoneId&&(kt=`%${this.zoneId}`),At+kt},Tt.prototype.toRFC5952String=function(){const At=/((^|:)(0(:|$)){2,})/g,kt=this.toNormalizedString();let xt=0,Nt=-1,Ft;for(;Ft=At.exec(kt);)Ft[0].length>Nt&&(xt=Ft.index,Nt=Ft[0].length);return Nt<0?kt:`${kt.substring(0,xt)}::${kt.substring(xt+Nt)}`},Tt.prototype.toString=function(){return this.toRFC5952String()},Tt}(),Rt.IPv6.broadcastAddressFromCIDR=function(Tt){try{const At=this.parseCIDR(Tt),kt=At[0].toByteArray(),xt=this.subnetMaskFromPrefixLength(At[1]).toByteArray(),Nt=[];let Ft=0;for(;Ft<16;)Nt.push(parseInt(kt[Ft],10)|parseInt(xt[Ft],10)^255),Ft++;return new this(Nt)}catch(At){throw new Error(`ipaddr: the address does not have IPv6 CIDR format (${At})`)}},Rt.IPv6.isIPv6=function(Tt){return this.parser(Tt)!==null},Rt.IPv6.isValid=function(Tt){if(typeof Tt=="string"&&Tt.indexOf(":")===-1)return!1;try{const At=this.parser(Tt);return new this(At.parts,At.zoneId),!0}catch{return!1}},Rt.IPv6.networkAddressFromCIDR=function(Tt){let At,kt,xt,Nt,Ft;try{for(At=this.parseCIDR(Tt),xt=At[0].toByteArray(),Ft=this.subnetMaskFromPrefixLength(At[1]).toByteArray(),Nt=[],kt=0;kt<16;)Nt.push(parseInt(xt[kt],10)&parseInt(Ft[kt],10)),kt++;return new this(Nt)}catch(jt){throw new Error(`ipaddr: the address does not have IPv6 CIDR format (${jt})`)}},Rt.IPv6.parse=function(Tt){const At=this.parser(Tt);if(At.parts===null)throw new Error("ipaddr: string is not formatted like an IPv6 Address");return new this(At.parts,At.zoneId)},Rt.IPv6.parseCIDR=function(Tt){let At,kt,xt;if((kt=Tt.match(/^(.+)\/(\d+)$/))&&(At=parseInt(kt[2]),At>=0&&At<=128))return xt=[this.parse(kt[1]),At],Object.defineProperty(xt,"toString",{value:function(){return this.join("/")}}),xt;throw new Error("ipaddr: string is not formatted like an IPv6 CIDR range")},Rt.IPv6.parser=function(Tt){let At,kt,xt,Nt,Ft,jt;if(xt=Tt.match(gt.deprecatedTransitional))return this.parser(`::ffff:${xt[1]}`);if(gt.native.test(Tt))return _t(Tt,8);if((xt=Tt.match(gt.transitional))&&(jt=xt[6]||"",At=_t(xt[1].slice(0,-1)+jt,6),At.parts)){for(Ft=[parseInt(xt[2]),parseInt(xt[3]),parseInt(xt[4]),parseInt(xt[5])],kt=0;kt<Ft.length;kt++)if(Nt=Ft[kt],!(0<=Nt&&Nt<=255))return null;return At.parts.push(Ft[0]<<8|Ft[1]),At.parts.push(Ft[2]<<8|Ft[3]),{parts:At.parts,zoneId:At.zoneId}}return null},Rt.IPv6.subnetMaskFromPrefixLength=function(Tt){if(Tt=parseInt(Tt),Tt<0||Tt>128)throw new Error("ipaddr: invalid IPv6 prefix length");const At=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];let kt=0;const xt=Math.floor(Tt/8);for(;kt<xt;)At[kt]=255,kt++;return xt<16&&(At[xt]=Math.pow(2,Tt%8)-1<<8-Tt%8),new this(At)},Rt.fromByteArray=function(Tt){const At=Tt.length;if(At===4)return new Rt.IPv4(Tt);if(At===16)return new Rt.IPv6(Tt);throw new Error("ipaddr: the binary input is neither an IPv6 nor IPv4 address")},Rt.isValid=function(Tt){return Rt.IPv6.isValid(Tt)||Rt.IPv4.isValid(Tt)},Rt.parse=function(Tt){if(Rt.IPv6.isValid(Tt))return Rt.IPv6.parse(Tt);if(Rt.IPv4.isValid(Tt))return Rt.IPv4.parse(Tt);throw new Error("ipaddr: the address has neither IPv6 nor IPv4 format")},Rt.parseCIDR=function(Tt){try{return Rt.IPv6.parseCIDR(Tt)}catch{try{return Rt.IPv4.parseCIDR(Tt)}catch{throw new Error("ipaddr: the address has neither IPv6 nor IPv4 CIDR format")}}},Rt.process=function(Tt){const At=this.parse(Tt);return At.kind()==="ipv6"&&At.isIPv4MappedAddress()?At.toIPv4Address():At},Rt.subnetMatch=function(Tt,At,kt){let xt,Nt,Ft,jt;kt==null&&(kt="unicast");for(Nt in At)if(Object.prototype.hasOwnProperty.call(At,Nt)){for(Ft=At[Nt],Ft[0]&&!(Ft[0]instanceof Array)&&(Ft=[Ft]),xt=0;xt<Ft.length;xt++)if(jt=Ft[xt],Tt.kind()===jt[0].kind()&&Tt.match.apply(Tt,jt))return Nt}return kt},i.exports?i.exports=Rt:e.ipaddr=Rt})(commonjsGlobal)})(ipaddr$1);var ipaddrExports=ipaddr$1.exports;const ipaddr=getDefaultExportFromCjs(ipaddrExports),{isValid:is_valid,parse:parse$1}=ipaddr,PRIVATE_IP_RANGES=["0.0.0.0/8","10.0.0.0/8","100.64.0.0/10","127.0.0.0/8","169.254.0.0/16","172.16.0.0/12","192.0.0.0/24","192.0.0.0/29","192.0.0.8/32","192.0.0.9/32","192.0.0.10/32","192.0.0.170/32","192.0.0.171/32","192.0.2.0/24","192.31.196.0/24","192.52.193.0/24","192.88.99.0/24","192.168.0.0/16","192.175.48.0/24","198.18.0.0/15","198.51.100.0/24","203.0.113.0/24","240.0.0.0/4","255.255.255.255/32"],NETMASK_RANGES=PRIVATE_IP_RANGES.map(i=>new Netmask_1(i));function ipv4_check(i){for(let e of NETMASK_RANGES)if(e.contains(i))return!0;return!1}function ipv6_check(i){return/^::$/.test(i)||/^::1$/.test(i)||/^::f{4}:([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(i)||/^::f{4}:0.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(i)||/^64:ff9b::([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(i)||/^100::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(i)||/^2001::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(i)||/^2001:2[0-9a-fA-F]:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(i)||/^2001:db8:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(i)||/^2002:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(i)||/^f[c-d]([0-9a-fA-F]{2,2}):/i.test(i)||/^fe[8-9a-bA-B][0-9a-fA-F]:/i.test(i)||/^ff([0-9a-fA-F]{2,2}):/i.test(i)}const is_ip_private=i=>{if(is_valid(i)){const e=parse$1(i);if(e.kind()==="ipv4")return ipv4_check(e.toNormalizedString());if(e.kind()==="ipv6")return ipv6_check(i)}else if(isIP(i)&&ipRegex.v6().test(i))return ipv6_check(i)};function connectionGater(i={}){return{denyDialPeer:async()=>!1,denyDialMultiaddr:async e=>{const a=e.stringTuples();return a[0][0]===4||a[0][0]===41?!!is_ip_private(`${a[0][1]}`):!1},denyInboundConnection:async()=>!1,denyOutboundConnection:async()=>!1,denyInboundEncryptedConnection:async()=>!1,denyOutboundEncryptedConnection:async()=>!1,denyInboundUpgradedConnection:async()=>!1,denyOutboundUpgradedConnection:async()=>!1,filterMultiaddrForPeer:async()=>!0,...i}}function coerce$1(i){if(i instanceof Uint8Array&&i.constructor.name==="Uint8Array")return i;if(i instanceof ArrayBuffer)return new Uint8Array(i);if(ArrayBuffer.isView(i))return new Uint8Array(i.buffer,i.byteOffset,i.byteLength);throw new Error("Unknown type, must be binary type")}function base$1(i,e){if(i.length>=255)throw new TypeError("Alphabet too long");for(var a=new Uint8Array(256),c=0;c<a.length;c++)a[c]=255;for(var h=0;h<i.length;h++){var d=i.charAt(h),et=d.charCodeAt(0);if(a[et]!==255)throw new TypeError(d+" is ambiguous");a[et]=h}var ft=i.length,gt=i.charAt(0),_t=Math.log(ft)/Math.log(256),wt=Math.log(256)/Math.log(ft);function $t(Tt){if(Tt instanceof Uint8Array||(ArrayBuffer.isView(Tt)?Tt=new Uint8Array(Tt.buffer,Tt.byteOffset,Tt.byteLength):Array.isArray(Tt)&&(Tt=Uint8Array.from(Tt))),!(Tt instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(Tt.length===0)return"";for(var At=0,kt=0,xt=0,Nt=Tt.length;xt!==Nt&&Tt[xt]===0;)xt++,At++;for(var Ft=(Nt-xt)*wt+1>>>0,jt=new Uint8Array(Ft);xt!==Nt;){for(var Gt=Tt[xt],Kt=0,Wt=Ft-1;(Gt!==0||Kt<kt)&&Wt!==-1;Wt--,Kt++)Gt+=256*jt[Wt]>>>0,jt[Wt]=Gt%ft>>>0,Gt=Gt/ft>>>0;if(Gt!==0)throw new Error("Non-zero carry");kt=Kt,xt++}for(var Zt=Ft-kt;Zt!==Ft&&jt[Zt]===0;)Zt++;for(var cr=gt.repeat(At);Zt<Ft;++Zt)cr+=i.charAt(jt[Zt]);return cr}function It(Tt){if(typeof Tt!="string")throw new TypeError("Expected String");if(Tt.length===0)return new Uint8Array;var At=0;if(Tt[At]!==" "){for(var kt=0,xt=0;Tt[At]===gt;)kt++,At++;for(var Nt=(Tt.length-At)*_t+1>>>0,Ft=new Uint8Array(Nt);Tt[At];){var jt=a[Tt.charCodeAt(At)];if(jt===255)return;for(var Gt=0,Kt=Nt-1;(jt!==0||Gt<xt)&&Kt!==-1;Kt--,Gt++)jt+=ft*Ft[Kt]>>>0,Ft[Kt]=jt%256>>>0,jt=jt/256>>>0;if(jt!==0)throw new Error("Non-zero carry");xt=Gt,At++}if(Tt[At]!==" "){for(var Wt=Nt-xt;Wt!==Nt&&Ft[Wt]===0;)Wt++;for(var Zt=new Uint8Array(kt+(Nt-Wt)),cr=kt;Wt!==Nt;)Zt[cr++]=Ft[Wt++];return Zt}}}function Rt(Tt){var At=It(Tt);if(At)return At;throw new Error(`Non-${e} character`)}return{encode:$t,decodeUnsafe:It,decode:Rt}}var src$1=base$1,_brrp__multiformats_scope_baseX$1=src$1;let Encoder$1=class{constructor(e,a,c){qt(this,"name");qt(this,"prefix");qt(this,"baseEncode");this.name=e,this.prefix=a,this.baseEncode=c}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Decoder$1=class{constructor(e,a,c){qt(this,"name");qt(this,"prefix");qt(this,"baseDecode");qt(this,"prefixCodePoint");if(this.name=e,this.prefix=a,a.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=a.codePointAt(0),this.baseDecode=c}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return or$2(this,e)}},ComposedDecoder$1=class{constructor(e){qt(this,"decoders");this.decoders=e}or(e){return or$2(this,e)}decode(e){const a=e[0],c=this.decoders[a];if(c!=null)return c.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function or$2(i,e){return new ComposedDecoder$1({...i.decoders??{[i.prefix]:i},...e.decoders??{[e.prefix]:e}})}let Codec$1=class{constructor(e,a,c,h){qt(this,"name");qt(this,"prefix");qt(this,"baseEncode");qt(this,"baseDecode");qt(this,"encoder");qt(this,"decoder");this.name=e,this.prefix=a,this.baseEncode=c,this.baseDecode=h,this.encoder=new Encoder$1(e,a,c),this.decoder=new Decoder$1(e,a,h)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function from$1({name:i,prefix:e,encode:a,decode:c}){return new Codec$1(i,e,a,c)}function baseX$1({name:i,prefix:e,alphabet:a}){const{encode:c,decode:h}=_brrp__multiformats_scope_baseX$1(a,i);return from$1({prefix:e,name:i,encode:c,decode:d=>coerce$1(h(d))})}function decode$3(i,e,a,c){const h={};for(let wt=0;wt<e.length;++wt)h[e[wt]]=wt;let d=i.length;for(;i[d-1]==="=";)--d;const et=new Uint8Array(d*a/8|0);let ft=0,gt=0,_t=0;for(let wt=0;wt<d;++wt){const $t=h[i[wt]];if($t===void 0)throw new SyntaxError(`Non-${c} character`);gt=gt<<a|$t,ft+=a,ft>=8&&(ft-=8,et[_t++]=255&gt>>ft)}if(ft>=a||255&gt<<8-ft)throw new SyntaxError("Unexpected end of data");return et}function encode$3(i,e,a){const c=e[e.length-1]==="=",h=(1<<a)-1;let d="",et=0,ft=0;for(let gt=0;gt<i.length;++gt)for(ft=ft<<8|i[gt],et+=8;et>a;)et-=a,d+=e[h&ft>>et];if(et!==0&&(d+=e[h&ft<<a-et]),c)for(;d.length*a&7;)d+="=";return d}function rfc4648$1({name:i,prefix:e,bitsPerChar:a,alphabet:c}){return from$1({prefix:e,name:i,encode(h){return encode$3(h,c,a)},decode(h){return decode$3(h,c,a,i)}})}const base58btc$1=baseX$1({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});baseX$1({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});rfc4648$1({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6});rfc4648$1({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6});const base64url$1=rfc4648$1({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6});rfc4648$1({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});const toParts=i=>i.toString().split("/").slice(1),func=i=>({match:e=>e.length<1?!1:i(e[0])?e.slice(1):!1,pattern:"fn"}),literal=i=>({match:e=>func(a=>a===i).match(e),pattern:i}),string$1=()=>({match:i=>func(e=>typeof e=="string").match(i),pattern:"{string}"}),number=()=>({match:i=>func(e=>!isNaN(parseInt(e))).match(i),pattern:"{number}"}),peerId=()=>({match:i=>{if(i.length<2||i[0]!=="p2p"&&i[0]!=="ipfs")return!1;if(i[1].startsWith("Q")||i[1].startsWith("1"))try{base58btc$1.decode(`z${i[1]}`)}catch{return!1}else return!1;return i.slice(2)},pattern:"/p2p/{peerid}"}),certhash=()=>({match:i=>{if(i.length<2||i[0]!=="certhash")return!1;try{base64url$1.decode(i[1])}catch{return!1}return i.slice(2)},pattern:"/certhash/{certhash}"}),optional=i=>({match:e=>{const a=i.match(e);return a===!1?e:a},pattern:`optional(${i.pattern})`}),or$1=(...i)=>({match:e=>{let a;for(const c of i){const h=c.match(e);h!==!1&&(a==null||h.length<a.length)&&(a=h)}return a??!1},pattern:`or(${i.map(e=>e.pattern).join(", ")})`}),and=(...i)=>({match:e=>{for(const a of i){const c=a.match(e);if(c===!1)return!1;e=c}return e},pattern:`and(${i.map(e=>e.pattern).join(", ")})`});function fmt(...i){function e(h){let d=toParts(h);for(const et of i){const ft=et.match(d);if(ft===!1)return!1;d=ft}return d}function a(h){return e(h)!==!1}function c(h){const d=e(h);return d===!1?!1:d.length===0}return{matches:a,exactMatch:c}}const _DNS4=and(literal("dns4"),string$1()),_DNS6=and(literal("dns6"),string$1()),_DNSADDR=and(literal("dnsaddr"),string$1()),_DNS=and(literal("dns"),string$1());fmt(or$1(_DNS,_DNSADDR,_DNS4,_DNS6));const _IP4=and(literal("ip4"),func(isIPv4)),_IP6=and(literal("ip6"),func(isIPv6)),_IP=or$1(_IP4,_IP6),_IP_OR_DOMAIN=or$1(_IP,_DNS,_DNS4,_DNS6,_DNSADDR),IP_OR_DOMAIN=fmt(_IP_OR_DOMAIN),_TCP=and(_IP_OR_DOMAIN,literal("tcp"),number()),_UDP=and(_IP_OR_DOMAIN,literal("udp"),number()),TCP_OR_UDP=or$1(_TCP,_UDP),_QUIC=and(_UDP,literal("quic")),_QUICV1=and(_UDP,literal("quic-v1")),QUIC_V0_OR_V1=or$1(_QUIC,_QUICV1),_WEB=or$1(_IP_OR_DOMAIN,_TCP,_UDP,_QUIC,_QUICV1),_WebSockets=or$1(and(_WEB,literal("ws"),optional(peerId()))),_WebSocketsSecure=or$1(and(_WEB,literal("wss"),optional(peerId())),and(_WEB,literal("tls"),literal("ws"),optional(peerId()))),_WebRTCDirect=and(TCP_OR_UDP,literal("webrtc-direct"),certhash(),optional(certhash()),optional(peerId())),_WebTransport=and(_QUICV1,literal("webtransport"),certhash(),certhash(),optional(peerId())),_P2P=or$1(_WebSockets,_WebSocketsSecure,and(_TCP,optional(peerId())),and(QUIC_V0_OR_V1,optional(peerId())),and(_IP_OR_DOMAIN,optional(peerId())),_WebRTCDirect,_WebTransport,peerId()),_Circuit=and(_P2P,literal("p2p-circuit"),peerId()),Circuit=fmt(_Circuit);or$1(and(_P2P,literal("p2p-circuit"),literal("webrtc"),peerId()),and(_P2P,literal("webrtc"),optional(peerId())),literal("webrtc"));or$1(and(_IP_OR_DOMAIN,literal("tcp"),number(),literal("http"),optional(peerId())),and(_IP_OR_DOMAIN,literal("http"),optional(peerId())));or$1(and(_IP_OR_DOMAIN,literal("tcp"),or$1(and(literal("443"),literal("http")),and(number(),literal("https"))),optional(peerId())),and(_IP_OR_DOMAIN,literal("tls"),literal("http"),optional(peerId())),and(_IP_OR_DOMAIN,literal("https"),optional(peerId())));function isPrivate(i){try{const{address:e}=i.nodeAddress();return!!is_ip_private(e)}catch{return!0}}function publicAddressesFirst(i,e){const a=isPrivate(i.multiaddr),c=isPrivate(e.multiaddr);return a&&!c?1:!a&&c?-1:0}function certifiedAddressesFirst(i,e){return i.isCertified&&!e.isCertified?-1:!i.isCertified&&e.isCertified?1:0}function circuitRelayAddressesLast(i,e){const a=Circuit.exactMatch(i.multiaddr),c=Circuit.exactMatch(e.multiaddr);return a&&!c?1:!a&&c?-1:0}function defaultAddressSort(i,e){const a=publicAddressesFirst(i,e);if(a!==0)return a;const c=circuitRelayAddressesLast(i,e);return c!==0?c:certifiedAddressesFirst(i,e)}class CustomProgressEvent extends Event{constructor(e,a){super(e),this.detail=a}}function getTypes(i){const e=[RecordType.A];return i==null?e:Array.isArray(i)?i.length===0?e:i:[i]}function coerce(i){if(i instanceof Uint8Array&&i.constructor.name==="Uint8Array")return i;if(i instanceof ArrayBuffer)return new Uint8Array(i);if(ArrayBuffer.isView(i))return new Uint8Array(i.buffer,i.byteOffset,i.byteLength);throw new Error("Unknown type, must be binary type")}function fromString(i){return new TextEncoder().encode(i)}function toString$1(i){return new TextDecoder().decode(i)}function base(i,e){if(i.length>=255)throw new TypeError("Alphabet too long");for(var a=new Uint8Array(256),c=0;c<a.length;c++)a[c]=255;for(var h=0;h<i.length;h++){var d=i.charAt(h),et=d.charCodeAt(0);if(a[et]!==255)throw new TypeError(d+" is ambiguous");a[et]=h}var ft=i.length,gt=i.charAt(0),_t=Math.log(ft)/Math.log(256),wt=Math.log(256)/Math.log(ft);function $t(Tt){if(Tt instanceof Uint8Array||(ArrayBuffer.isView(Tt)?Tt=new Uint8Array(Tt.buffer,Tt.byteOffset,Tt.byteLength):Array.isArray(Tt)&&(Tt=Uint8Array.from(Tt))),!(Tt instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(Tt.length===0)return"";for(var At=0,kt=0,xt=0,Nt=Tt.length;xt!==Nt&&Tt[xt]===0;)xt++,At++;for(var Ft=(Nt-xt)*wt+1>>>0,jt=new Uint8Array(Ft);xt!==Nt;){for(var Gt=Tt[xt],Kt=0,Wt=Ft-1;(Gt!==0||Kt<kt)&&Wt!==-1;Wt--,Kt++)Gt+=256*jt[Wt]>>>0,jt[Wt]=Gt%ft>>>0,Gt=Gt/ft>>>0;if(Gt!==0)throw new Error("Non-zero carry");kt=Kt,xt++}for(var Zt=Ft-kt;Zt!==Ft&&jt[Zt]===0;)Zt++;for(var cr=gt.repeat(At);Zt<Ft;++Zt)cr+=i.charAt(jt[Zt]);return cr}function It(Tt){if(typeof Tt!="string")throw new TypeError("Expected String");if(Tt.length===0)return new Uint8Array;var At=0;if(Tt[At]!==" "){for(var kt=0,xt=0;Tt[At]===gt;)kt++,At++;for(var Nt=(Tt.length-At)*_t+1>>>0,Ft=new Uint8Array(Nt);Tt[At];){var jt=a[Tt.charCodeAt(At)];if(jt===255)return;for(var Gt=0,Kt=Nt-1;(jt!==0||Gt<xt)&&Kt!==-1;Kt--,Gt++)jt+=ft*Ft[Kt]>>>0,Ft[Kt]=jt%256>>>0,jt=jt/256>>>0;if(jt!==0)throw new Error("Non-zero carry");xt=Gt,At++}if(Tt[At]!==" "){for(var Wt=Nt-xt;Wt!==Nt&&Ft[Wt]===0;)Wt++;for(var Zt=new Uint8Array(kt+(Nt-Wt)),cr=kt;Wt!==Nt;)Zt[cr++]=Ft[Wt++];return Zt}}}function Rt(Tt){var At=It(Tt);if(At)return At;throw new Error(`Non-${e} character`)}return{encode:$t,decodeUnsafe:It,decode:Rt}}var src=base,_brrp__multiformats_scope_baseX=src;class Encoder{constructor(e,a,c){qt(this,"name");qt(this,"prefix");qt(this,"baseEncode");this.name=e,this.prefix=a,this.baseEncode=c}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Decoder{constructor(e,a,c){qt(this,"name");qt(this,"prefix");qt(this,"baseDecode");qt(this,"prefixCodePoint");if(this.name=e,this.prefix=a,a.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=a.codePointAt(0),this.baseDecode=c}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return or(this,e)}}class ComposedDecoder{constructor(e){qt(this,"decoders");this.decoders=e}or(e){return or(this,e)}decode(e){const a=e[0],c=this.decoders[a];if(c!=null)return c.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}function or(i,e){return new ComposedDecoder({...i.decoders??{[i.prefix]:i},...e.decoders??{[e.prefix]:e}})}class Codec{constructor(e,a,c,h){qt(this,"name");qt(this,"prefix");qt(this,"baseEncode");qt(this,"baseDecode");qt(this,"encoder");qt(this,"decoder");this.name=e,this.prefix=a,this.baseEncode=c,this.baseDecode=h,this.encoder=new Encoder(e,a,c),this.decoder=new Decoder(e,a,h)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}function from({name:i,prefix:e,encode:a,decode:c}){return new Codec(i,e,a,c)}function baseX({name:i,prefix:e,alphabet:a}){const{encode:c,decode:h}=_brrp__multiformats_scope_baseX(a,i);return from({prefix:e,name:i,encode:c,decode:d=>coerce(h(d))})}function decode$2(i,e,a,c){const h={};for(let wt=0;wt<e.length;++wt)h[e[wt]]=wt;let d=i.length;for(;i[d-1]==="=";)--d;const et=new Uint8Array(d*a/8|0);let ft=0,gt=0,_t=0;for(let wt=0;wt<d;++wt){const $t=h[i[wt]];if($t===void 0)throw new SyntaxError(`Non-${c} character`);gt=gt<<a|$t,ft+=a,ft>=8&&(ft-=8,et[_t++]=255&gt>>ft)}if(ft>=a||255&gt<<8-ft)throw new SyntaxError("Unexpected end of data");return et}function encode$2(i,e,a){const c=e[e.length-1]==="=",h=(1<<a)-1;let d="",et=0,ft=0;for(let gt=0;gt<i.length;++gt)for(ft=ft<<8|i[gt],et+=8;et>a;)et-=a,d+=e[h&ft>>et];if(et!==0&&(d+=e[h&ft<<a-et]),c)for(;d.length*a&7;)d+="=";return d}function rfc4648({name:i,prefix:e,bitsPerChar:a,alphabet:c}){return from({prefix:e,name:i,encode(h){return encode$2(h,c,a)},decode(h){return decode$2(h,c,a,i)}})}const base10=baseX({prefix:"9",name:"base10",alphabet:"0123456789"}),base10$1=Object.freeze(Object.defineProperty({__proto__:null,base10},Symbol.toStringTag,{value:"Module"})),base16=rfc4648({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),base16upper=rfc4648({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),base16$1=Object.freeze(Object.defineProperty({__proto__:null,base16,base16upper},Symbol.toStringTag,{value:"Module"})),base2=rfc4648({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),base2$1=Object.freeze(Object.defineProperty({__proto__:null,base2},Symbol.toStringTag,{value:"Module"})),alphabet=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),alphabetBytesToChars=alphabet.reduce((i,e,a)=>(i[a]=e,i),[]),alphabetCharsToBytes=alphabet.reduce((i,e,a)=>(i[e.codePointAt(0)]=a,i),[]);function encode$1(i){return i.reduce((e,a)=>(e+=alphabetBytesToChars[a],e),"")}function decode$1(i){const e=[];for(const a of i){const c=alphabetCharsToBytes[a.codePointAt(0)];if(c===void 0)throw new Error(`Non-base256emoji character: ${a}`);e.push(c)}return new Uint8Array(e)}const base256emoji=from({prefix:"🚀",name:"base256emoji",encode:encode$1,decode:decode$1}),base256emoji$1=Object.freeze(Object.defineProperty({__proto__:null,base256emoji},Symbol.toStringTag,{value:"Module"})),base32=rfc4648({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),base32upper=rfc4648({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),base32pad=rfc4648({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),base32padupper=rfc4648({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),base32hex=rfc4648({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),base32hexupper=rfc4648({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),base32hexpad=rfc4648({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),base32hexpadupper=rfc4648({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),base32z=rfc4648({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),base32$1=Object.freeze(Object.defineProperty({__proto__:null,base32,base32hex,base32hexpad,base32hexpadupper,base32hexupper,base32pad,base32padupper,base32upper,base32z},Symbol.toStringTag,{value:"Module"})),base36=baseX({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),base36upper=baseX({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),base36$1=Object.freeze(Object.defineProperty({__proto__:null,base36,base36upper},Symbol.toStringTag,{value:"Module"})),base58btc=baseX({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),base58flickr=baseX({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),base58=Object.freeze(Object.defineProperty({__proto__:null,base58btc,base58flickr},Symbol.toStringTag,{value:"Module"})),base64$1=rfc4648({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),base64pad=rfc4648({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),base64url=rfc4648({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),base64urlpad=rfc4648({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),base64$2=Object.freeze(Object.defineProperty({__proto__:null,base64:base64$1,base64pad,base64url,base64urlpad},Symbol.toStringTag,{value:"Module"})),base8=rfc4648({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),base8$1=Object.freeze(Object.defineProperty({__proto__:null,base8},Symbol.toStringTag,{value:"Module"})),identity=from({prefix:"\0",name:"identity",encode:i=>toString$1(i),decode:i=>fromString(i)}),identityBase=Object.freeze(Object.defineProperty({__proto__:null,identity},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const bases={...identityBase,...base2$1,...base8$1,...base10$1,...base16$1,...base32$1,...base36$1,...base58,...base64$2,...base256emoji$1};function allocUnsafe(i=0){return new Uint8Array(i)}function createCodec(i,e,a,c){return{name:i,prefix:e,encoder:{name:i,prefix:e,encode:a},decoder:{decode:c}}}const string=createCodec("utf8","u",i=>"u"+new TextDecoder("utf8").decode(i),i=>new TextEncoder().encode(i.substring(1))),ascii=createCodec("ascii","a",i=>{let e="a";for(let a=0;a<i.length;a++)e+=String.fromCharCode(i[a]);return e},i=>{i=i.substring(1);const e=allocUnsafe(i.length);for(let a=0;a<i.length;a++)e[a]=i.charCodeAt(a);return e}),BASES={utf8:string,"utf-8":string,hex:bases.base16,latin1:ascii,ascii,binary:ascii,...bases};function toString(i,e="utf8"){const a=BASES[e];if(a==null)throw new Error(`Unsupported encoding "${e}"`);return a.encoder.encode(i).substring(1)}const DEFAULT_TTL=60;function toDNSResponse(i){return{Status:i.Status??0,TC:i.TC??i.flag_tc??!1,RD:i.RD??i.flag_rd??!1,RA:i.RA??i.flag_ra??!1,AD:i.AD??i.flag_ad??!1,CD:i.CD??i.flag_cd??!1,Question:(i.Question??i.questions??[]).map(e=>({name:e.name,type:RecordType[e.type]})),Answer:(i.Answer??i.answers??[]).map(e=>({name:e.name,type:RecordType[e.type],TTL:e.TTL??e.ttl??DEFAULT_TTL,data:e.data instanceof Uint8Array?toString(e.data):e.data}))}}const DEFAULT_QUERY_CONCURRENCY=4;function dnsJsonOverHttps(i,e={}){const a=new PQueue$1({concurrency:e.queryConcurrency??DEFAULT_QUERY_CONCURRENCY});return async(c,h={})=>{var ft;const d=new URLSearchParams;d.set("name",c),getTypes(h.types).forEach(gt=>{d.append("type",RecordType[gt])}),(ft=h.onProgress)==null||ft.call(h,new CustomProgressEvent("dns:query",{detail:c}));const et=await a.add(async()=>{var wt;const gt=await fetch(`${i}?${d}`,{headers:{accept:"application/dns-json"},signal:h==null?void 0:h.signal});if(gt.status!==200)throw new Error(`Unexpected HTTP status: ${gt.status} - ${gt.statusText}`);const _t=toDNSResponse(await gt.json());return(wt=h.onProgress)==null||wt.call(h,new CustomProgressEvent("dns:response",{detail:_t})),_t},{signal:h.signal});if(et==null)throw new Error("No DNS response received");return et}}function defaultResolver(){return[dnsJsonOverHttps("https://cloudflare-dns.com/dns-query"),dnsJsonOverHttps("https://dns.google/resolve")]}var hashlru=function(i){if(!i)throw Error("hashlru must have a max value, of type number, greater than 0");var e=0,a=Object.create(null),c=Object.create(null);function h(d,et){a[d]=et,e++,e>=i&&(e=0,c=a,a=Object.create(null))}return{has:function(d){return a[d]!==void 0||c[d]!==void 0},remove:function(d){a[d]!==void 0&&(a[d]=void 0),c[d]!==void 0&&(c[d]=void 0)},get:function(d){var et=a[d];if(et!==void 0)return et;if((et=c[d])!==void 0)return h(d,et),et},set:function(d,et){a[d]!==void 0?a[d]=et:h(d,et)},clear:function(){a=Object.create(null),c=Object.create(null)}}};const hashlru$1=getDefaultExportFromCjs(hashlru);class CachedAnswers{constructor(e){qt(this,"lru");this.lru=hashlru$1(e)}get(e,a){let c=!0;const h=[];for(const d of a){const et=this.getAnswers(e,d);if(et.length===0){c=!1;break}h.push(...et)}if(c)return toDNSResponse({answers:h})}getAnswers(e,a){const c=`${e.toLowerCase()}-${a}`,h=this.lru.get(c);if(h!=null){const d=h.filter(et=>et.expires>Date.now()).map(({expires:et,value:ft})=>({...ft,TTL:Math.round((et-Date.now())/1e3),type:RecordType[ft.type]}));return d.length===0&&this.lru.remove(c),d}return[]}add(e,a){const c=`${e.toLowerCase()}-${a.type}`,h=this.lru.get(c)??[];h.push({expires:Date.now()+(a.TTL??DEFAULT_TTL)*1e3,value:a}),this.lru.set(c,h)}remove(e,a){const c=`${e.toLowerCase()}-${a}`;this.lru.remove(c)}clear(){this.lru.clear()}}function cache(i){return new CachedAnswers(i)}const DEFAULT_ANSWER_CACHE_SIZE=1e3;class DNS{constructor(e){qt(this,"resolvers");qt(this,"cache");this.resolvers={},this.cache=cache(e.cacheSize??DEFAULT_ANSWER_CACHE_SIZE),Object.entries(e.resolvers??{}).forEach(([a,c])=>{Array.isArray(c)||(c=[c]),a.endsWith(".")||(a=`${a}.`),this.resolvers[a]=c}),this.resolvers["."]==null&&(this.resolvers["."]=defaultResolver())}async query(e,a={}){var gt,_t,wt;const c=getTypes(a.types),h=a.cached!==!1?this.cache.get(e,c):void 0;if(h!=null)return(gt=a.onProgress)==null||gt.call(a,new CustomProgressEvent("dns:cache",{detail:h})),h;const d=`${e.split(".").pop()}.`,et=(this.resolvers[d]??this.resolvers["."]).sort(()=>Math.random()>.5?-1:1),ft=[];for(const $t of et){if(((_t=a.signal)==null?void 0:_t.aborted)===!0)break;try{const It=await $t(e,{...a,types:c});for(const Rt of It.Answer)this.cache.add(e,Rt);return It}catch(It){ft.push(It),(wt=a.onProgress)==null||wt.call(a,new CustomProgressEvent("dns:error",{detail:It}))}}throw ft.length===1?ft[0]:new AggregateError(ft,`DNS lookup of ${e} ${c} failed`)}}var RecordType;(function(i){i[i.A=1]="A",i[i.CNAME=5]="CNAME",i[i.TXT=16]="TXT",i[i.AAAA=28]="AAAA"})(RecordType||(RecordType={}));function dns(i={}){return new DNS(i)}const MAX_RECURSIVE_DEPTH=32,{code:dnsaddrCode}=getProtocol("dnsaddr"),dnsaddrResolver=async function i(e,a={}){const c=a.maxRecursiveDepth??MAX_RECURSIVE_DEPTH;if(c===0)throw new CodeError$4("Max recursive depth reached","ERR_MAX_RECURSIVE_DEPTH_REACHED");const[,h]=e.stringTuples().find(([_t])=>_t===dnsaddrCode)??[],et=await((a==null?void 0:a.dns)??dns()).query(`_dnsaddr.${h}`,{signal:a==null?void 0:a.signal,types:[RecordType.TXT]}),ft=e.getPeerId(),gt=[];for(const _t of et.Answer){const wt=_t.data.split("=")[1];if(wt==null||ft!=null&&!wt.includes(ft))continue;const $t=multiaddr(wt);if(wt.startsWith("/dnsaddr")){const It=await $t.resolve({...a,maxRecursiveDepth:c-1});gt.push(...It.map(Rt=>Rt.toString()))}else gt.push($t.toString())}return gt};var messages;(function(i){i.NOT_STARTED_YET="The libp2p node is not started yet",i.DHT_DISABLED="DHT is not available",i.PUBSUB_DISABLED="PubSub is not available",i.CONN_ENCRYPTION_REQUIRED="At least one connection encryption module is required",i.ERR_TRANSPORTS_REQUIRED="At least one transport module is required",i.ERR_PROTECTOR_REQUIRED="Private network is enforced, but no protector was provided",i.NOT_FOUND="Not found"})(messages||(messages={}));var codes;(function(i){i.DHT_DISABLED="ERR_DHT_DISABLED",i.ERR_PUBSUB_DISABLED="ERR_PUBSUB_DISABLED",i.PUBSUB_NOT_STARTED="ERR_PUBSUB_NOT_STARTED",i.DHT_NOT_STARTED="ERR_DHT_NOT_STARTED",i.CONN_ENCRYPTION_REQUIRED="ERR_CONN_ENCRYPTION_REQUIRED",i.ERR_TRANSPORTS_REQUIRED="ERR_TRANSPORTS_REQUIRED",i.ERR_PROTECTOR_REQUIRED="ERR_PROTECTOR_REQUIRED",i.ERR_PEER_DIAL_INTERCEPTED="ERR_PEER_DIAL_INTERCEPTED",i.ERR_CONNECTION_INTERCEPTED="ERR_CONNECTION_INTERCEPTED",i.ERR_INVALID_PROTOCOLS_FOR_STREAM="ERR_INVALID_PROTOCOLS_FOR_STREAM",i.ERR_CONNECTION_ENDED="ERR_CONNECTION_ENDED",i.ERR_CONNECTION_FAILED="ERR_CONNECTION_FAILED",i.ERR_NODE_NOT_STARTED="ERR_NODE_NOT_STARTED",i.ERR_ALREADY_ABORTED="ERR_ALREADY_ABORTED",i.ERR_TOO_MANY_ADDRESSES="ERR_TOO_MANY_ADDRESSES",i.ERR_NO_VALID_ADDRESSES="ERR_NO_VALID_ADDRESSES",i.ERR_RELAYED_DIAL="ERR_RELAYED_DIAL",i.ERR_DIALED_SELF="ERR_DIALED_SELF",i.ERR_DISCOVERED_SELF="ERR_DISCOVERED_SELF",i.ERR_DUPLICATE_TRANSPORT="ERR_DUPLICATE_TRANSPORT",i.ERR_ENCRYPTION_FAILED="ERR_ENCRYPTION_FAILED",i.ERR_HOP_REQUEST_FAILED="ERR_HOP_REQUEST_FAILED",i.ERR_INVALID_KEY="ERR_INVALID_KEY",i.ERR_INVALID_MESSAGE="ERR_INVALID_MESSAGE",i.ERR_INVALID_PARAMETERS="ERR_INVALID_PARAMETERS",i.ERR_INVALID_PEER="ERR_INVALID_PEER",i.ERR_MUXER_UNAVAILABLE="ERR_MUXER_UNAVAILABLE",i.ERR_NOT_FOUND="ERR_NOT_FOUND",i.ERR_TIMEOUT="ERR_TIMEOUT",i.ERR_TRANSPORT_UNAVAILABLE="ERR_TRANSPORT_UNAVAILABLE",i.ERR_TRANSPORT_DIAL_FAILED="ERR_TRANSPORT_DIAL_FAILED",i.ERR_UNSUPPORTED_PROTOCOL="ERR_UNSUPPORTED_PROTOCOL",i.ERR_PROTOCOL_HANDLER_ALREADY_REGISTERED="ERR_PROTOCOL_HANDLER_ALREADY_REGISTERED",i.ERR_INVALID_MULTIADDR="ERR_INVALID_MULTIADDR",i.ERR_SIGNATURE_NOT_VALID="ERR_SIGNATURE_NOT_VALID",i.ERR_FIND_SELF="ERR_FIND_SELF",i.ERR_NO_ROUTERS_AVAILABLE="ERR_NO_ROUTERS_AVAILABLE",i.ERR_CONNECTION_NOT_MULTIPLEXED="ERR_CONNECTION_NOT_MULTIPLEXED",i.ERR_NO_DIAL_TOKENS="ERR_NO_DIAL_TOKENS",i.ERR_KEYCHAIN_REQUIRED="ERR_KEYCHAIN_REQUIRED",i.ERR_INVALID_CMS="ERR_INVALID_CMS",i.ERR_MISSING_KEYS="ERR_MISSING_KEYS",i.ERR_NO_KEY="ERR_NO_KEY",i.ERR_INVALID_KEY_NAME="ERR_INVALID_KEY_NAME",i.ERR_INVALID_KEY_TYPE="ERR_INVALID_KEY_TYPE",i.ERR_KEY_ALREADY_EXISTS="ERR_KEY_ALREADY_EXISTS",i.ERR_INVALID_KEY_SIZE="ERR_INVALID_KEY_SIZE",i.ERR_KEY_NOT_FOUND="ERR_KEY_NOT_FOUND",i.ERR_OLD_KEY_NAME_INVALID="ERR_OLD_KEY_NAME_INVALID",i.ERR_NEW_KEY_NAME_INVALID="ERR_NEW_KEY_NAME_INVALID",i.ERR_PASSWORD_REQUIRED="ERR_PASSWORD_REQUIRED",i.ERR_PEM_REQUIRED="ERR_PEM_REQUIRED",i.ERR_CANNOT_READ_KEY="ERR_CANNOT_READ_KEY",i.ERR_MISSING_PRIVATE_KEY="ERR_MISSING_PRIVATE_KEY",i.ERR_MISSING_PUBLIC_KEY="ERR_MISSING_PUBLIC_KEY",i.ERR_INVALID_OLD_PASS_TYPE="ERR_INVALID_OLD_PASS_TYPE",i.ERR_INVALID_NEW_PASS_TYPE="ERR_INVALID_NEW_PASS_TYPE",i.ERR_INVALID_PASS_LENGTH="ERR_INVALID_PASS_LENGTH",i.ERR_NOT_IMPLEMENTED="ERR_NOT_IMPLEMENTED",i.ERR_WRONG_PING_ACK="ERR_WRONG_PING_ACK",i.ERR_INVALID_RECORD="ERR_INVALID_RECORD",i.ERR_ALREADY_SUCCEEDED="ERR_ALREADY_SUCCEEDED",i.ERR_NO_HANDLER_FOR_PROTOCOL="ERR_NO_HANDLER_FOR_PROTOCOL",i.ERR_TOO_MANY_OUTBOUND_PROTOCOL_STREAMS="ERR_TOO_MANY_OUTBOUND_PROTOCOL_STREAMS",i.ERR_TOO_MANY_INBOUND_PROTOCOL_STREAMS="ERR_TOO_MANY_INBOUND_PROTOCOL_STREAMS",i.ERR_CONNECTION_DENIED="ERR_CONNECTION_DENIED",i.ERR_TRANSFER_LIMIT_EXCEEDED="ERR_TRANSFER_LIMIT_EXCEEDED"})(codes||(codes={}));const DefaultConfig={addresses:{listen:[],announce:[],noAnnounce:[],announceFilter:i=>i},connectionManager:{resolvers:{dnsaddr:dnsaddrResolver},addressSorter:defaultAddressSort},transportManager:{faultTolerance:FaultTolerance.FATAL_ALL}};function validateConfig(i){var a,c;const e=mergeOptions$1(DefaultConfig,i);if(e.transports==null||e.transports.length<1)throw new CodeError$2(messages.ERR_TRANSPORTS_REQUIRED,codes.ERR_TRANSPORTS_REQUIRED);if(e.connectionProtector===null&&((c=(a=globalThis.process)==null?void 0:a.env)==null?void 0:c.LIBP2P_FORCE_PNET)!=null)throw new CodeError$2(messages.ERR_PROTECTOR_REQUIRED,codes.ERR_PROTECTOR_REQUIRED);return e}const KEEP_ALIVE="keep-alive",log$8=logger$2("libp2p:get-peer");function getPeerAddress(i){if(isPeerId(i))return{peerId:i,multiaddrs:[]};Array.isArray(i)||(i=[i]);let e;if(i.length>0){const a=i[0].getPeerId();e=a==null?void 0:peerIdFromString(a),i.forEach(c=>{if(!isMultiaddr(c))throw log$8.error("multiaddr %s was invalid",c),new CodeError$2("Invalid Multiaddr",codes.ERR_INVALID_MULTIADDR);const h=c.getPeerId();if(h==null){if(e!=null)throw new CodeError$2("Multiaddrs must all have the same peer id or have no peer id",codes.ERR_INVALID_PARAMETERS)}else{const d=peerIdFromString(h);if(e==null||!e.equals(d))throw new CodeError$2("Multiaddrs must all have the same peer id or have no peer id",codes.ERR_INVALID_PARAMETERS)}})}return{peerId:e,multiaddrs:i}}class TimeoutError extends Error{constructor(e){super(e),this.name="TimeoutError"}}let AbortError$1=class extends Error{constructor(e){super(),this.name="AbortError",this.message=e}};const getDOMException=i=>globalThis.DOMException===void 0?new AbortError$1(i):new DOMException(i),getAbortedReason=i=>{const e=i.reason===void 0?getDOMException("This operation was aborted."):i.reason;return e instanceof Error?e:getDOMException(e)};function pTimeout(i,e,a,c){let h;const d=new Promise((et,ft)=>{if(typeof e!="number"||Math.sign(e)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${e}\``);if(e===Number.POSITIVE_INFINITY){et(i);return}if(c={customTimers:{setTimeout,clearTimeout},...c},c.signal){const{signal:gt}=c;gt.aborted&&ft(getAbortedReason(gt)),gt.addEventListener("abort",()=>{ft(getAbortedReason(gt))})}h=c.customTimers.setTimeout.call(void 0,()=>{if(typeof a=="function"){try{et(a())}catch(wt){ft(wt)}return}const gt=typeof a=="string"?a:`Promise timed out after ${e} milliseconds`,_t=a instanceof Error?a:new TimeoutError(gt);typeof i.cancel=="function"&&i.cancel(),ft(_t)},e),(async()=>{try{et(await i)}catch(gt){ft(gt)}finally{c.customTimers.clearTimeout.call(void 0,h)}})()});return d.clear=()=>{clearTimeout(h),h=void 0},d}function lowerBound$1(i,e,a){let c=0,h=i.length;for(;h>0;){const d=Math.trunc(h/2);let et=c+d;a(i[et],e)<=0?(c=++et,h-=d+1):h=d}return c}var __classPrivateFieldGet$1=function(i,e,a,c){if(a==="a"&&!c)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?i!==e||!c:!e.has(i))throw new TypeError("Cannot read private member from an object whose class did not declare it");return a==="m"?c:a==="a"?c.call(i):c?c.value:e.get(i)},_PriorityQueue_queue;class PriorityQueue{constructor(){_PriorityQueue_queue.set(this,[])}enqueue(e,a){a={priority:0,...a};const c={priority:a.priority,run:e};if(this.size&&__classPrivateFieldGet$1(this,_PriorityQueue_queue,"f")[this.size-1].priority>=a.priority){__classPrivateFieldGet$1(this,_PriorityQueue_queue,"f").push(c);return}const h=lowerBound$1(__classPrivateFieldGet$1(this,_PriorityQueue_queue,"f"),c,(d,et)=>et.priority-d.priority);__classPrivateFieldGet$1(this,_PriorityQueue_queue,"f").splice(h,0,c)}dequeue(){const e=__classPrivateFieldGet$1(this,_PriorityQueue_queue,"f").shift();return e==null?void 0:e.run}filter(e){return __classPrivateFieldGet$1(this,_PriorityQueue_queue,"f").filter(a=>a.priority===e.priority).map(a=>a.run)}get size(){return __classPrivateFieldGet$1(this,_PriorityQueue_queue,"f").length}}_PriorityQueue_queue=new WeakMap;var __classPrivateFieldSet=function(i,e,a,c,h){if(c==="m")throw new TypeError("Private method is not writable");if(c==="a"&&!h)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?i!==e||!h:!e.has(i))throw new TypeError("Cannot write private member to an object whose class did not declare it");return c==="a"?h.call(i,a):h?h.value=a:e.set(i,a),a},__classPrivateFieldGet=function(i,e,a,c){if(a==="a"&&!c)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?i!==e||!c:!e.has(i))throw new TypeError("Cannot read private member from an object whose class did not declare it");return a==="m"?c:a==="a"?c.call(i):c?c.value:e.get(i)},_PQueue_instances,_PQueue_carryoverConcurrencyCount,_PQueue_isIntervalIgnored,_PQueue_intervalCount,_PQueue_intervalCap,_PQueue_interval,_PQueue_intervalEnd,_PQueue_intervalId,_PQueue_timeoutId,_PQueue_queue,_PQueue_queueClass,_PQueue_pending,_PQueue_concurrency,_PQueue_isPaused,_PQueue_throwOnTimeout,_PQueue_doesIntervalAllowAnother_get,_PQueue_doesConcurrentAllowAnother_get,_PQueue_next,_PQueue_onResumeInterval,_PQueue_isIntervalPaused_get,_PQueue_tryToStartAnother,_PQueue_initializeIntervalIfNeeded,_PQueue_onInterval,_PQueue_processQueue,_PQueue_throwOnAbort,_PQueue_onEvent;class AbortError extends Error{}class PQueue extends EventEmitter$1{constructor(e){var a,c,h,d;if(super(),_PQueue_instances.add(this),_PQueue_carryoverConcurrencyCount.set(this,void 0),_PQueue_isIntervalIgnored.set(this,void 0),_PQueue_intervalCount.set(this,0),_PQueue_intervalCap.set(this,void 0),_PQueue_interval.set(this,void 0),_PQueue_intervalEnd.set(this,0),_PQueue_intervalId.set(this,void 0),_PQueue_timeoutId.set(this,void 0),_PQueue_queue.set(this,void 0),_PQueue_queueClass.set(this,void 0),_PQueue_pending.set(this,0),_PQueue_concurrency.set(this,void 0),_PQueue_isPaused.set(this,void 0),_PQueue_throwOnTimeout.set(this,void 0),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:PriorityQueue,...e},!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(c=(a=e.intervalCap)===null||a===void 0?void 0:a.toString())!==null&&c!==void 0?c:""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(d=(h=e.interval)===null||h===void 0?void 0:h.toString())!==null&&d!==void 0?d:""}\` (${typeof e.interval})`);__classPrivateFieldSet(this,_PQueue_carryoverConcurrencyCount,e.carryoverConcurrencyCount,"f"),__classPrivateFieldSet(this,_PQueue_isIntervalIgnored,e.intervalCap===Number.POSITIVE_INFINITY||e.interval===0,"f"),__classPrivateFieldSet(this,_PQueue_intervalCap,e.intervalCap,"f"),__classPrivateFieldSet(this,_PQueue_interval,e.interval,"f"),__classPrivateFieldSet(this,_PQueue_queue,new e.queueClass,"f"),__classPrivateFieldSet(this,_PQueue_queueClass,e.queueClass,"f"),this.concurrency=e.concurrency,this.timeout=e.timeout,__classPrivateFieldSet(this,_PQueue_throwOnTimeout,e.throwOnTimeout===!0,"f"),__classPrivateFieldSet(this,_PQueue_isPaused,e.autoStart===!1,"f")}get concurrency(){return __classPrivateFieldGet(this,_PQueue_concurrency,"f")}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);__classPrivateFieldSet(this,_PQueue_concurrency,e,"f"),__classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_processQueue).call(this)}async add(e,a={}){return a={timeout:this.timeout,throwOnTimeout:__classPrivateFieldGet(this,_PQueue_throwOnTimeout,"f"),...a},new Promise((c,h)=>{__classPrivateFieldGet(this,_PQueue_queue,"f").enqueue(async()=>{var d,et,ft;__classPrivateFieldSet(this,_PQueue_pending,(et=__classPrivateFieldGet(this,_PQueue_pending,"f"),et++,et),"f"),__classPrivateFieldSet(this,_PQueue_intervalCount,(ft=__classPrivateFieldGet(this,_PQueue_intervalCount,"f"),ft++,ft),"f");try{if(!((d=a.signal)===null||d===void 0)&&d.aborted)throw new AbortError("The task was aborted.");let gt=e({signal:a.signal});a.timeout&&(gt=pTimeout(Promise.resolve(gt),a.timeout)),a.signal&&(gt=Promise.race([gt,__classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_throwOnAbort).call(this,a.signal)]));const _t=await gt;c(_t),this.emit("completed",_t)}catch(gt){if(gt instanceof TimeoutError&&!a.throwOnTimeout){c();return}h(gt),this.emit("error",gt)}finally{__classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_next).call(this)}},a),this.emit("add"),__classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_tryToStartAnother).call(this)})}async addAll(e,a){return Promise.all(e.map(async c=>this.add(c,a)))}start(){return __classPrivateFieldGet(this,_PQueue_isPaused,"f")?(__classPrivateFieldSet(this,_PQueue_isPaused,!1,"f"),__classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_processQueue).call(this),this):this}pause(){__classPrivateFieldSet(this,_PQueue_isPaused,!0,"f")}clear(){__classPrivateFieldSet(this,_PQueue_queue,new(__classPrivateFieldGet(this,_PQueue_queueClass,"f")),"f")}async onEmpty(){__classPrivateFieldGet(this,_PQueue_queue,"f").size!==0&&await __classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_onEvent).call(this,"empty")}async onSizeLessThan(e){__classPrivateFieldGet(this,_PQueue_queue,"f").size<e||await __classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_onEvent).call(this,"next",()=>__classPrivateFieldGet(this,_PQueue_queue,"f").size<e)}async onIdle(){__classPrivateFieldGet(this,_PQueue_pending,"f")===0&&__classPrivateFieldGet(this,_PQueue_queue,"f").size===0||await __classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_onEvent).call(this,"idle")}get size(){return __classPrivateFieldGet(this,_PQueue_queue,"f").size}sizeBy(e){return __classPrivateFieldGet(this,_PQueue_queue,"f").filter(e).length}get pending(){return __classPrivateFieldGet(this,_PQueue_pending,"f")}get isPaused(){return __classPrivateFieldGet(this,_PQueue_isPaused,"f")}}_PQueue_carryoverConcurrencyCount=new WeakMap,_PQueue_isIntervalIgnored=new WeakMap,_PQueue_intervalCount=new WeakMap,_PQueue_intervalCap=new WeakMap,_PQueue_interval=new WeakMap,_PQueue_intervalEnd=new WeakMap,_PQueue_intervalId=new WeakMap,_PQueue_timeoutId=new WeakMap,_PQueue_queue=new WeakMap,_PQueue_queueClass=new WeakMap,_PQueue_pending=new WeakMap,_PQueue_concurrency=new WeakMap,_PQueue_isPaused=new WeakMap,_PQueue_throwOnTimeout=new WeakMap,_PQueue_instances=new WeakSet,_PQueue_doesIntervalAllowAnother_get=function i(){return __classPrivateFieldGet(this,_PQueue_isIntervalIgnored,"f")||__classPrivateFieldGet(this,_PQueue_intervalCount,"f")<__classPrivateFieldGet(this,_PQueue_intervalCap,"f")},_PQueue_doesConcurrentAllowAnother_get=function i(){return __classPrivateFieldGet(this,_PQueue_pending,"f")<__classPrivateFieldGet(this,_PQueue_concurrency,"f")},_PQueue_next=function i(){var e;__classPrivateFieldSet(this,_PQueue_pending,(e=__classPrivateFieldGet(this,_PQueue_pending,"f"),e--,e),"f"),__classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_tryToStartAnother).call(this),this.emit("next")},_PQueue_onResumeInterval=function i(){__classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_onInterval).call(this),__classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_initializeIntervalIfNeeded).call(this),__classPrivateFieldSet(this,_PQueue_timeoutId,void 0,"f")},_PQueue_isIntervalPaused_get=function i(){const e=Date.now();if(__classPrivateFieldGet(this,_PQueue_intervalId,"f")===void 0){const a=__classPrivateFieldGet(this,_PQueue_intervalEnd,"f")-e;if(a<0)__classPrivateFieldSet(this,_PQueue_intervalCount,__classPrivateFieldGet(this,_PQueue_carryoverConcurrencyCount,"f")?__classPrivateFieldGet(this,_PQueue_pending,"f"):0,"f");else return __classPrivateFieldGet(this,_PQueue_timeoutId,"f")===void 0&&__classPrivateFieldSet(this,_PQueue_timeoutId,setTimeout(()=>{__classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_onResumeInterval).call(this)},a),"f"),!0}return!1},_PQueue_tryToStartAnother=function i(){if(__classPrivateFieldGet(this,_PQueue_queue,"f").size===0)return __classPrivateFieldGet(this,_PQueue_intervalId,"f")&&clearInterval(__classPrivateFieldGet(this,_PQueue_intervalId,"f")),__classPrivateFieldSet(this,_PQueue_intervalId,void 0,"f"),this.emit("empty"),__classPrivateFieldGet(this,_PQueue_pending,"f")===0&&this.emit("idle"),!1;if(!__classPrivateFieldGet(this,_PQueue_isPaused,"f")){const e=!__classPrivateFieldGet(this,_PQueue_instances,"a",_PQueue_isIntervalPaused_get);if(__classPrivateFieldGet(this,_PQueue_instances,"a",_PQueue_doesIntervalAllowAnother_get)&&__classPrivateFieldGet(this,_PQueue_instances,"a",_PQueue_doesConcurrentAllowAnother_get)){const a=__classPrivateFieldGet(this,_PQueue_queue,"f").dequeue();return a?(this.emit("active"),a(),e&&__classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_initializeIntervalIfNeeded).call(this),!0):!1}}return!1},_PQueue_initializeIntervalIfNeeded=function i(){__classPrivateFieldGet(this,_PQueue_isIntervalIgnored,"f")||__classPrivateFieldGet(this,_PQueue_intervalId,"f")!==void 0||(__classPrivateFieldSet(this,_PQueue_intervalId,setInterval(()=>{__classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_onInterval).call(this)},__classPrivateFieldGet(this,_PQueue_interval,"f")),"f"),__classPrivateFieldSet(this,_PQueue_intervalEnd,Date.now()+__classPrivateFieldGet(this,_PQueue_interval,"f"),"f"))},_PQueue_onInterval=function i(){__classPrivateFieldGet(this,_PQueue_intervalCount,"f")===0&&__classPrivateFieldGet(this,_PQueue_pending,"f")===0&&__classPrivateFieldGet(this,_PQueue_intervalId,"f")&&(clearInterval(__classPrivateFieldGet(this,_PQueue_intervalId,"f")),__classPrivateFieldSet(this,_PQueue_intervalId,void 0,"f")),__classPrivateFieldSet(this,_PQueue_intervalCount,__classPrivateFieldGet(this,_PQueue_carryoverConcurrencyCount,"f")?__classPrivateFieldGet(this,_PQueue_pending,"f"):0,"f"),__classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_processQueue).call(this)},_PQueue_processQueue=function i(){for(;__classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_tryToStartAnother).call(this););},_PQueue_throwOnAbort=async function i(e){return new Promise((a,c)=>{e.addEventListener("abort",()=>{c(new AbortError("The task was aborted."))},{once:!0})})},_PQueue_onEvent=async function i(e,a){return new Promise(c=>{const h=()=>{a&&!a()||(this.off(e,h),c())};this.on(e,h)})};function lowerBound(i,e,a){let c=0,h=i.length;for(;h>0;){const d=Math.trunc(h/2);let et=c+d;a(i[et],e)<=0?(c=++et,h-=d+1):h=d}return c}var as;class PeerPriorityQueue{constructor(){gn(this,as,[])}enqueue(e,a){const c=a==null?void 0:a.peerId,h=(a==null?void 0:a.priority)??0;if(c==null)throw new CodeError$2("missing peer id",codes.ERR_INVALID_PARAMETERS);const d={priority:h,peerId:c,run:e};if(this.size>0&&ur(this,as)[this.size-1].priority>=h){ur(this,as).push(d);return}const et=lowerBound(ur(this,as),d,(ft,gt)=>gt.priority-ft.priority);ur(this,as).splice(et,0,d)}dequeue(){const e=ur(this,as).shift();return e==null?void 0:e.run}filter(e){if(e.peerId!=null){const a=e.peerId;return ur(this,as).filter(c=>a.equals(c.peerId)).map(c=>c.run)}return ur(this,as).filter(a=>a.priority===e.priority).map(a=>a.run)}get size(){return ur(this,as).length}}as=new WeakMap;class PeerJobQueue extends PQueue{constructor(e={}){super({...e,queueClass:PeerPriorityQueue})}hasJob(e){return this.sizeBy({peerId:e})>0}}const DIAL_TIMEOUT=3e4,INBOUND_UPGRADE_TIMEOUT=3e4,MAX_PEER_ADDRS_TO_DIAL=25,MAX_PARALLEL_DIALS_PER_PEER=1,AUTO_DIAL_INTERVAL=5e3,AUTO_DIAL_CONCURRENCY=25,AUTO_DIAL_PRIORITY=0,AUTO_DIAL_MAX_QUEUE_LENGTH=100,AUTO_DIAL_DISCOVERED_PEERS_DEBOUNCE=10,INBOUND_CONNECTION_THRESHOLD=5,MAX_INCOMING_PENDING_CONNECTIONS=10,LAST_DIAL_FAILURE_KEY="last-dial-failure",MIN_CONNECTIONS=5,MAX_CONNECTIONS=100,MAX_PARALLEL_DIALS=50,AUTO_DIAL_PEER_RETRY_THRESHOLD=1e3*60*7,defaultOptions$3={minConnections:MIN_CONNECTIONS,maxQueueLength:AUTO_DIAL_MAX_QUEUE_LENGTH,autoDialConcurrency:AUTO_DIAL_CONCURRENCY,autoDialPriority:AUTO_DIAL_PRIORITY,autoDialInterval:AUTO_DIAL_INTERVAL,autoDialPeerRetryThreshold:AUTO_DIAL_PEER_RETRY_THRESHOLD,autoDialDiscoveredPeersDebounce:AUTO_DIAL_DISCOVERED_PEERS_DEBOUNCE};var Fn;class AutoDial{constructor(e,a){qt(this,"connectionManager");qt(this,"peerStore");qt(this,"queue");qt(this,"minConnections");qt(this,"autoDialPriority");qt(this,"autoDialIntervalMs");qt(this,"autoDialMaxQueueLength");qt(this,"autoDialPeerRetryThresholdMs");qt(this,"autoDialDiscoveredPeersDebounce");qt(this,"autoDialInterval");qt(this,"started");qt(this,"running");gn(this,Fn,void 0);this.connectionManager=e.connectionManager,this.peerStore=e.peerStore,this.minConnections=a.minConnections??defaultOptions$3.minConnections,this.autoDialPriority=a.autoDialPriority??defaultOptions$3.autoDialPriority,this.autoDialIntervalMs=a.autoDialInterval??defaultOptions$3.autoDialInterval,this.autoDialMaxQueueLength=a.maxQueueLength??defaultOptions$3.maxQueueLength,this.autoDialPeerRetryThresholdMs=a.autoDialPeerRetryThreshold??defaultOptions$3.autoDialPeerRetryThreshold,this.autoDialDiscoveredPeersDebounce=a.autoDialDiscoveredPeersDebounce??defaultOptions$3.autoDialDiscoveredPeersDebounce,yn(this,Fn,e.logger.forComponent("libp2p:connection-manager:auto-dial")),this.started=!1,this.running=!1,this.queue=new PeerJobQueue({concurrency:a.autoDialConcurrency??defaultOptions$3.autoDialConcurrency}),this.queue.addListener("error",h=>{ur(this,Fn).error("error during auto-dial",h)}),e.events.addEventListener("connection:close",()=>{this.autoDial().catch(h=>{ur(this,Fn).error(h)})});let c;e.events.addEventListener("peer:discovery",()=>{clearTimeout(c),c=setTimeout(()=>{this.autoDial().catch(h=>{ur(this,Fn).error(h)})},this.autoDialDiscoveredPeersDebounce)})}isStarted(){return this.started}start(){this.autoDialInterval=setTimeout(()=>{this.autoDial().catch(e=>{ur(this,Fn).error("error while autodialing",e)})},this.autoDialIntervalMs),this.started=!0}afterStart(){this.autoDial().catch(e=>{ur(this,Fn).error("error while autodialing",e)})}stop(){this.queue.clear(),clearTimeout(this.autoDialInterval),this.started=!1,this.running=!1}async autoDial(){if(!this.started)return;const e=this.connectionManager.getConnectionsMap(),a=e.size;if(a>=this.minConnections){this.minConnections>0&&ur(this,Fn).trace("have enough connections %d/%d",a,this.minConnections);return}if(this.queue.size>this.autoDialMaxQueueLength){ur(this,Fn).call(this,"not enough connections %d/%d but auto dial queue is full",a,this.minConnections);return}if(this.running){ur(this,Fn).call(this,"not enough connections %d/%d - but skipping autodial as it is already running",a,this.minConnections);return}this.running=!0,ur(this,Fn).call(this,"not enough connections %d/%d - will dial peers to increase the number of connections",a,this.minConnections);const c=new PeerSet(this.connectionManager.getDialQueue().map(_t=>_t.peerId).filter(Boolean)),h=await this.peerStore.all({filters:[_t=>_t.addresses.length===0?(ur(this,Fn).trace("not autodialing %p because they have no addresses",_t.id),!1):e.has(_t.id)?(ur(this,Fn).trace("not autodialing %p because they are already connected",_t.id),!1):c.has(_t.id)?(ur(this,Fn).trace("not autodialing %p because they are already being dialed",_t.id),!1):this.queue.hasJob(_t.id)?(ur(this,Fn).trace("not autodialing %p because they are already being autodialed",_t.id),!1):!0]}),d=h.sort(()=>Math.random()>.5?1:-1),et=new PeerMap;for(const _t of d)et.has(_t.id)||et.set(_t.id,[..._t.tags.values()].reduce((wt,$t)=>wt+$t.value,0));const gt=d.sort((_t,wt)=>{const $t=et.get(_t.id)??0,It=et.get(wt.id)??0;return $t>It?-1:$t<It?1:0}).filter(_t=>{const wt=_t.metadata.get(LAST_DIAL_FAILURE_KEY);if(wt==null)return!0;const $t=parseInt(toString$d(wt));return isNaN($t)?!0:Date.now()-$t>this.autoDialPeerRetryThresholdMs});ur(this,Fn).call(this,"selected %d/%d peers to dial",gt.length,h.length);for(const _t of gt)this.queue.add(async()=>{const wt=this.connectionManager.getConnectionsMap().size;if(wt>=this.minConnections){ur(this,Fn).call(this,"got enough connections now %d/%d",wt,this.minConnections),this.queue.clear();return}ur(this,Fn).call(this,"connecting to a peerStore stored peer %p",_t.id),await this.connectionManager.openConnection(_t.id,{priority:this.autoDialPriority})},{peerId:_t.id}).catch(wt=>{ur(this,Fn).error("could not connect to peerStore stored peer",wt)});this.running=!1,this.started&&(this.autoDialInterval=setTimeout(()=>{this.autoDial().catch(_t=>{ur(this,Fn).error("error while autodialing",_t)})},this.autoDialIntervalMs))}}Fn=new WeakMap;const defaultOptions$2={maxConnections:MAX_CONNECTIONS,allow:[]};var _s;class ConnectionPruner{constructor(e,a={}){qt(this,"maxConnections");qt(this,"connectionManager");qt(this,"peerStore");qt(this,"allow");qt(this,"events");gn(this,_s,void 0);this.maxConnections=a.maxConnections??defaultOptions$2.maxConnections,this.allow=a.allow??defaultOptions$2.allow,this.connectionManager=e.connectionManager,this.peerStore=e.peerStore,this.events=e.events,yn(this,_s,e.logger.forComponent("libp2p:connection-manager:connection-pruner")),e.events.addEventListener("connection:open",()=>{this.maybePruneConnections().catch(c=>{ur(this,_s).error(c)})})}async maybePruneConnections(){const e=this.connectionManager.getConnections(),a=e.length,c=Math.max(a-this.maxConnections,0);if(ur(this,_s).call(this,"checking max connections limit %d/%d",a,this.maxConnections),a<=this.maxConnections)return;ur(this,_s).call(this,"max connections limit exceeded %d/%d, pruning %d connection(s)",a,this.maxConnections,c);const h=new PeerMap;for(const ft of e){const gt=ft.remotePeer;if(!h.has(gt)){h.set(gt,0);try{const _t=await this.peerStore.get(gt);h.set(gt,[..._t.tags.values()].reduce((wt,$t)=>wt+$t.value,0))}catch(_t){_t.code!=="ERR_NOT_FOUND"&&ur(this,_s).error("error loading peer tags",_t)}}}const d=e.sort((ft,gt)=>{const _t=h.get(ft.remotePeer)??0,wt=h.get(gt.remotePeer)??0;if(_t>wt)return 1;if(_t<wt)return-1;const $t=ft.timeline.open,It=gt.timeline.open;return $t<It?1:$t>It?-1:0}),et=[];for(const ft of d)if(ur(this,_s).call(this,"too many connections open - closing a connection to %p",ft.remotePeer),this.allow.some(_t=>ft.remoteAddr.toString().startsWith(_t.toString()))||et.push(ft),et.length===c)break;await Promise.all(et.map(async ft=>{try{await ft.close()}catch(gt){ur(this,_s).error(gt)}})),this.events.safeDispatchEvent("connection:prune",{detail:et})}}_s=new WeakMap;function anySignal(i){const e=new globalThis.AbortController;function a(){e.abort();for(const d of i)(d==null?void 0:d.removeEventListener)!=null&&d.removeEventListener("abort",a)}for(const d of i){if((d==null?void 0:d.aborted)===!0){a();break}(d==null?void 0:d.addEventListener)!=null&&d.addEventListener("abort",a)}function c(){for(const d of i)(d==null?void 0:d.removeEventListener)!=null&&d.removeEventListener("abort",a)}const h=e.signal;return h.clear=c,h}async function resolveMultiaddrs(i,e){if(!i.protoNames().includes("dnsaddr"))return[i];const c=await resolveRecord(i,e),et=(await Promise.all(c.map(async ft=>resolveMultiaddrs(ft,e)))).flat().reduce((ft,gt)=>(ft.find(_t=>_t.equals(gt))==null&&ft.push(gt),ft),[]);return e.log("resolved %s to",i,et.map(ft=>ft.toString())),et}async function resolveRecord(i,e){try{return i=multiaddr(i.toString()),await i.resolve(e)}catch(a){return e.log.error(`multiaddr ${i.toString()} could not be resolved`,a),[]}}function combineSignals(...i){const e=[];for(const c of i)c!=null&&(setMaxListeners(1/0,c),e.push(c));const a=anySignal(e);return setMaxListeners(1/0,a),a}const defaultOptions$1={addressSorter:defaultAddressSort,maxParallelDials:MAX_PARALLEL_DIALS,maxPeerAddrsToDial:MAX_PEER_ADDRS_TO_DIAL,maxParallelDialsPerPeer:MAX_PARALLEL_DIALS_PER_PEER,dialTimeout:DIAL_TIMEOUT,resolvers:{dnsaddr:dnsaddrResolver}};var Ln;class DialQueue{constructor(e,a={}){qt(this,"pendingDials");qt(this,"queue");qt(this,"peerId");qt(this,"peerStore");qt(this,"connectionGater");qt(this,"transportManager");qt(this,"addressSorter");qt(this,"maxPeerAddrsToDial");qt(this,"maxParallelDialsPerPeer");qt(this,"dialTimeout");qt(this,"inProgressDialCount");qt(this,"pendingDialCount");qt(this,"shutDownController");qt(this,"connections");gn(this,Ln,void 0);var c,h;this.addressSorter=a.addressSorter??defaultOptions$1.addressSorter,this.maxPeerAddrsToDial=a.maxPeerAddrsToDial??defaultOptions$1.maxPeerAddrsToDial,this.maxParallelDialsPerPeer=a.maxParallelDialsPerPeer??defaultOptions$1.maxParallelDialsPerPeer,this.dialTimeout=a.dialTimeout??defaultOptions$1.dialTimeout,this.connections=a.connections??new PeerMap,yn(this,Ln,e.logger.forComponent("libp2p:connection-manager:dial-queue")),this.peerId=e.peerId,this.peerStore=e.peerStore,this.connectionGater=e.connectionGater,this.transportManager=e.transportManager,this.shutDownController=new AbortController,setMaxListeners(1/0,this.shutDownController.signal),this.pendingDialCount=(c=e.metrics)==null?void 0:c.registerMetric("libp2p_dialler_pending_dials"),this.inProgressDialCount=(h=e.metrics)==null?void 0:h.registerMetric("libp2p_dialler_in_progress_dials"),this.pendingDials=[];for(const[d,et]of Object.entries(a.resolvers??{}))resolvers$1.set(d,et);this.queue=new PQueue({concurrency:a.maxParallelDials??defaultOptions$1.maxParallelDials}),this.queue.on("add",()=>{var d,et;(d=this.pendingDialCount)==null||d.update(this.queue.size),(et=this.inProgressDialCount)==null||et.update(this.queue.pending)}),this.queue.on("active",()=>{var d,et;(d=this.pendingDialCount)==null||d.update(this.queue.size),(et=this.inProgressDialCount)==null||et.update(this.queue.pending)}),this.queue.on("completed",()=>{var d,et;(d=this.pendingDialCount)==null||d.update(this.queue.size),(et=this.inProgressDialCount)==null||et.update(this.queue.pending)}),this.queue.on("error",d=>{var et,ft;ur(this,Ln).error("error in dial queue",d),(et=this.pendingDialCount)==null||et.update(this.queue.size),(ft=this.inProgressDialCount)==null||ft.update(this.queue.pending)}),this.queue.on("empty",()=>{var d,et;(d=this.pendingDialCount)==null||d.update(this.queue.size),(et=this.inProgressDialCount)==null||et.update(this.queue.pending)}),this.queue.on("idle",()=>{var d,et;(d=this.pendingDialCount)==null||d.update(this.queue.size),(et=this.inProgressDialCount)==null||et.update(this.queue.pending)})}stop(){this.shutDownController.abort()}async dial(e,a={}){const{peerId:c,multiaddrs:h}=getPeerAddress(e),d=h.map(It=>({multiaddr:It,isCertified:!1})),et=this.createDialAbortControllers(a.signal);let ft;try{ft=await this.calculateMultiaddrs(c,d,{...a,signal:et})}catch(It){throw et.clear(),It}let gt=Array.from(this.connections.values()).flat().find(It=>a.force===!0?!1:ft.find(Rt=>Rt.multiaddr.equals(It.remoteAddr)));if(gt!=null)return ur(this,Ln).call(this,"already connected to %a",gt.remoteAddr),gt;const _t=this.pendingDials.find(It=>!!(It.peerId!=null&&c!=null&&It.peerId.equals(c)||ft.map(({multiaddr:Rt})=>Rt.toString()).join()===It.multiaddrs.map(Rt=>Rt.toString()).join()));if(_t!=null)return ur(this,Ln).call(this,"joining existing dial target for %p",c),et.clear(),_t.promise;ur(this,Ln).call(this,"creating dial target for",ft.map(({multiaddr:It})=>It.toString()));const wt={id:randomId(),status:"queued",peerId:c,multiaddrs:ft.map(({multiaddr:It})=>It)};wt.promise=this.performDial(wt,{...a,signal:et}).finally(()=>{this.pendingDials=this.pendingDials.filter(It=>It.id!==wt.id),et.clear()}).catch(async It=>{if(ur(this,Ln).error("dial failed to %s",wt.multiaddrs.map(Rt=>Rt.toString()).join(", "),It),c!=null)try{await this.peerStore.patch(c,{metadata:{[LAST_DIAL_FAILURE_KEY]:fromString$9(Date.now().toString())}})}catch(Rt){ur(this,Ln).error("could not update last dial failure key for %p",c,Rt)}throw et.aborted?new CodeError$2(It.message,codes.ERR_TIMEOUT):It}),this.pendingDials.push(wt);const $t=await wt.promise;return gt=Array.from(this.connections.values()).flat().find(It=>a.force===!0?!1:It.id!==$t.id&&It.remoteAddr.equals($t.remoteAddr)),gt!=null?(ur(this,Ln).call(this,"already connected to %a",gt.remoteAddr),await $t.close(),gt):(ur(this,Ln).call(this,"connection opened to %a",$t.remoteAddr),$t)}createDialAbortControllers(e){const a=anySignal([AbortSignal.timeout(this.dialTimeout),this.shutDownController.signal,e]);try{setMaxListeners==null||setMaxListeners(1/0,a)}catch{}return a}async calculateMultiaddrs(e,a=[],c={}){var wt,$t;if(e!=null){if(this.peerId.equals(e))throw new CodeError$2("Tried to dial self",codes.ERR_DIALED_SELF);if(await(($t=(wt=this.connectionGater).denyDialPeer)==null?void 0:$t.call(wt,e))===!0)throw new CodeError$2("The dial request is blocked by gater.allowDialPeer",codes.ERR_PEER_DIAL_INTERCEPTED);if(a.length===0){ur(this,Ln).call(this,"loading multiaddrs for %p",e);try{const It=await this.peerStore.get(e);a.push(...It.addresses),ur(this,Ln).call(this,"loaded multiaddrs for %p",e,a.map(({multiaddr:Rt})=>Rt.toString()))}catch(It){if(It.code!==codes.ERR_NOT_FOUND)throw It}}}let h=(await Promise.all(a.map(async It=>{const Rt=await resolveMultiaddrs(It.multiaddr,{...c,log:ur(this,Ln)});return Rt.length===1&&Rt[0].equals(It.multiaddr)?It:Rt.map(Tt=>({multiaddr:Tt,isCertified:!1}))}))).flat();if(e!=null){const It=`/p2p/${e.toString()}`;h=h.map(Rt=>{const Tt=Rt.multiaddr.protos().pop();return(Tt==null?void 0:Tt.path)===!0?Rt:Rt.multiaddr.getPeerId()==null?{multiaddr:Rt.multiaddr.encapsulate(It),isCertified:Rt.isCertified}:Rt})}const d=h.filter(It=>{if(this.transportManager.transportForMultiaddr(It.multiaddr)==null)return!1;const Rt=It.multiaddr.getPeerId();return e!=null&&Rt!=null?e.equals(Rt):!0}),et=new Map;for(const It of d){const Rt=It.multiaddr.toString(),Tt=et.get(Rt);if(Tt!=null){Tt.isCertified=Tt.isCertified||It.isCertified||!1;continue}et.set(Rt,It)}const ft=[...et.values()];if((ft.length===0||ft.length>this.maxPeerAddrsToDial)&&(ur(this,Ln).call(this,"addresses for %p before filtering",e??"unknown peer",h.map(({multiaddr:It})=>It.toString())),ur(this,Ln).call(this,"addresses for %p after filtering",e??"unknown peer",ft.map(({multiaddr:It})=>It.toString()))),ft.length===0)throw new CodeError$2("The dial request has no valid addresses",codes.ERR_NO_VALID_ADDRESSES);if(ft.length>this.maxPeerAddrsToDial)throw new CodeError$2("dial with more addresses than allowed",codes.ERR_TOO_MANY_ADDRESSES);const gt=[];for(const It of ft)this.connectionGater.denyDialMultiaddr!=null&&await this.connectionGater.denyDialMultiaddr(It.multiaddr)||gt.push(It);const _t=gt.sort(this.addressSorter);if(_t.length===0)throw new CodeError$2("The connection gater denied all addresses in the dial request",codes.ERR_NO_VALID_ADDRESSES);return _t}async performDial(e,a={}){const c=e.multiaddrs.map(()=>new AbortController);try{const h=new PQueue({concurrency:this.maxParallelDialsPerPeer});h.on("error",et=>{ur(this,Ln).error("error dialling",et)});const d=await Promise.any(e.multiaddrs.map(async(et,ft)=>{const gt=c[ft];if(gt==null)throw new CodeError$2("dialAction did not come with an AbortController",codes.ERR_INVALID_PARAMETERS);const _t=combineSignals(gt.signal,a.signal);_t.addEventListener("abort",()=>{ur(this,Ln).call(this,"dial to %a aborted",et)});const wt=pDefer();return await h.add(async()=>{if(_t.aborted){ur(this,Ln).call(this,"dial to %a was aborted before reaching the head of the peer dial queue",et),wt.reject(new AbortError$8);return}await this.queue.add(async()=>{try{if(_t.aborted){ur(this,Ln).call(this,"dial to %a was aborted before reaching the head of the dial queue",et),wt.reject(new AbortError$8);return}e.status="active";const $t=await this.transportManager.dial(et,{...a,signal:_t});if(gt.signal.aborted){ur(this,Ln).call(this,"multiple dials succeeded, closing superfluous connection"),$t.close().catch(It=>{ur(this,Ln).error("error closing superfluous connection",It)}),wt.reject(new AbortError$8);return}c[ft]=void 0,c.forEach(It=>{It!==void 0&&It.abort()}),ur(this,Ln).call(this,"dial to %a succeeded",et),wt.resolve($t)}catch($t){ur(this,Ln).error("error during dial of %a",et,$t),wt.reject($t)}},{...a,signal:_t}).catch($t=>{wt.reject($t)})},{signal:_t}).catch($t=>{wt.reject($t)}).finally(()=>{_t.clear()}),wt.promise}));if(d==null)throw new CodeError$2("successful dial led to empty object returned from peer dial queue",codes.ERR_TRANSPORT_DIAL_FAILED);return e.status="success",d}catch(h){throw e.status="error",e.multiaddrs.length===1&&h.name==="AggregateError"?h.errors[0]:h}}}Ln=new WeakMap;function randomId(){return`${parseInt(String(Math.random()*1e9),10).toString()}${Date.now()}`}const DEFAULT_DIAL_PRIORITY=50,defaultOptions={minConnections:MIN_CONNECTIONS,maxConnections:MAX_CONNECTIONS,inboundConnectionThreshold:INBOUND_CONNECTION_THRESHOLD,maxIncomingPendingConnections:MAX_INCOMING_PENDING_CONNECTIONS,autoDialConcurrency:AUTO_DIAL_CONCURRENCY,autoDialPriority:AUTO_DIAL_PRIORITY,autoDialMaxQueueLength:AUTO_DIAL_MAX_QUEUE_LENGTH};var Yn;class DefaultConnectionManager{constructor(e,a={}){qt(this,"started");qt(this,"connections");qt(this,"allow");qt(this,"deny");qt(this,"maxIncomingPendingConnections");qt(this,"incomingPendingConnections");qt(this,"maxConnections");qt(this,"dialQueue");qt(this,"autoDial");qt(this,"connectionPruner");qt(this,"inboundConnectionRateLimiter");qt(this,"peerStore");qt(this,"metrics");qt(this,"events");gn(this,Yn,void 0);this.maxConnections=a.maxConnections??defaultOptions.maxConnections;const c=a.minConnections??defaultOptions.minConnections;if(this.maxConnections<c)throw new CodeError$2("Connection Manager maxConnections must be greater than minConnections",codes.ERR_INVALID_PARAMETERS);this.connections=new PeerMap,this.started=!1,this.peerStore=e.peerStore,this.metrics=e.metrics,this.events=e.events,yn(this,Yn,e.logger.forComponent("libp2p:connection-manager")),this.onConnect=this.onConnect.bind(this),this.onDisconnect=this.onDisconnect.bind(this),this.events.addEventListener("connection:open",this.onConnect),this.events.addEventListener("connection:close",this.onDisconnect),this.allow=(a.allow??[]).map(h=>multiaddr(h)),this.deny=(a.deny??[]).map(h=>multiaddr(h)),this.incomingPendingConnections=0,this.maxIncomingPendingConnections=a.maxIncomingPendingConnections??defaultOptions.maxIncomingPendingConnections,this.inboundConnectionRateLimiter=new rateLimiterFlexible.RateLimiterMemory({points:a.inboundConnectionThreshold??defaultOptions.inboundConnectionThreshold,duration:1}),this.autoDial=new AutoDial({connectionManager:this,peerStore:e.peerStore,events:e.events,logger:e.logger},{minConnections:c,autoDialConcurrency:a.autoDialConcurrency??defaultOptions.autoDialConcurrency,autoDialPriority:a.autoDialPriority??defaultOptions.autoDialPriority,maxQueueLength:a.autoDialMaxQueueLength??defaultOptions.autoDialMaxQueueLength}),this.connectionPruner=new ConnectionPruner({connectionManager:this,peerStore:e.peerStore,events:e.events,logger:e.logger},{maxConnections:this.maxConnections,allow:this.allow}),this.dialQueue=new DialQueue({peerId:e.peerId,metrics:e.metrics,peerStore:e.peerStore,transportManager:e.transportManager,connectionGater:e.connectionGater,logger:e.logger},{addressSorter:a.addressSorter??defaultAddressSort,maxParallelDials:a.maxParallelDials??MAX_PARALLEL_DIALS,maxPeerAddrsToDial:a.maxPeerAddrsToDial??MAX_PEER_ADDRS_TO_DIAL,maxParallelDialsPerPeer:a.maxParallelDialsPerPeer??MAX_PARALLEL_DIALS_PER_PEER,dialTimeout:a.dialTimeout??DIAL_TIMEOUT,resolvers:a.resolvers??{dnsaddr:dnsaddrResolver},connections:this.connections})}isStarted(){return this.started}async start(){var e,a,c;(e=this.metrics)==null||e.registerMetricGroup("libp2p_connection_manager_connections",{calculate:()=>{const h={inbound:0,outbound:0};for(const d of this.connections.values())for(const et of d)et.direction==="inbound"?h.inbound++:h.outbound++;return h}}),(a=this.metrics)==null||a.registerMetricGroup("libp2p_protocol_streams_total",{label:"protocol",calculate:()=>{const h={};for(const d of this.connections.values())for(const et of d)for(const ft of et.streams){const gt=`${ft.direction} ${ft.protocol??"unnegotiated"}`;h[gt]=(h[gt]??0)+1}return h}}),(c=this.metrics)==null||c.registerMetricGroup("libp2p_connection_manager_protocol_streams_per_connection_90th_percentile",{label:"protocol",calculate:()=>{const h={};for(const et of this.connections.values())for(const ft of et){const gt={};for(const _t of ft.streams){const wt=`${_t.direction} ${_t.protocol??"unnegotiated"}`;gt[wt]=(gt[wt]??0)+1}for(const[_t,wt]of Object.entries(gt))h[_t]=h[_t]??[],h[_t].push(wt)}const d={};for(let[et,ft]of Object.entries(h)){ft=ft.sort((_t,wt)=>_t-wt);const gt=Math.floor(ft.length*.9);d[et]=ft[gt]}return d}}),this.autoDial.start(),this.started=!0,ur(this,Yn).call(this,"started")}async afterStart(){Promise.resolve().then(async()=>{const e=await this.peerStore.all({filters:[a=>a.tags.has(KEEP_ALIVE)]});await Promise.all(e.map(async a=>{await this.openConnection(a.id).catch(c=>{ur(this,Yn).error(c)})}))}).catch(e=>{ur(this,Yn).error(e)}),this.autoDial.afterStart()}async stop(){this.dialQueue.stop(),this.autoDial.stop();const e=[];for(const a of this.connections.values())for(const c of a)e.push((async()=>{try{await c.close()}catch(h){ur(this,Yn).error(h)}})());ur(this,Yn).call(this,"closing %d connections",e.length),await Promise.all(e),this.connections.clear(),ur(this,Yn).call(this,"stopped")}onConnect(e){this._onConnect(e).catch(a=>{ur(this,Yn).error(a)})}async _onConnect(e){const{detail:a}=e;if(!this.started){await a.close();return}const c=a.remotePeer,h=this.connections.get(c);let d=!1;h!=null?h.push(a):(d=!0,this.connections.set(c,[a])),c.publicKey!=null&&c.type==="RSA"&&await this.peerStore.patch(c,{publicKey:c.publicKey}),d&&this.events.safeDispatchEvent("peer:connect",{detail:a.remotePeer})}onDisconnect(e){const{detail:a}=e;if(!this.started)return;const c=a.remotePeer;let h=this.connections.get(c);h!=null&&h.length>1?(h=h.filter(d=>d.id!==a.id),this.connections.set(c,h)):h!=null&&(this.connections.delete(c),this.events.safeDispatchEvent("peer:disconnect",{detail:a.remotePeer}))}getConnections(e){if(e!=null)return this.connections.get(e)??[];let a=[];for(const c of this.connections.values())a=a.concat(c);return a}getConnectionsMap(){return this.connections}async openConnection(e,a={}){var ft;if(!this.isStarted())throw new CodeError$2("Not started",codes.ERR_NODE_NOT_STARTED);(ft=a.signal)==null||ft.throwIfAborted();const{peerId:c}=getPeerAddress(e);if(c!=null&&a.force!==!0){ur(this,Yn).call(this,"dial %p",c);const gt=this.getConnections(c).find(_t=>!_t.transient);if(gt!=null)return ur(this,Yn).call(this,"had an existing non-transient connection to %p",c),gt}const h=await this.dialQueue.dial(e,{...a,priority:a.priority??DEFAULT_DIAL_PRIORITY});let d=this.connections.get(h.remotePeer);d==null&&(d=[],this.connections.set(h.remotePeer,d));let et=!1;for(const gt of d)gt.id===h.id&&(et=!0);return et||d.push(h),h}async closeConnections(e,a={}){const c=this.connections.get(e)??[];await Promise.all(c.map(async h=>{try{await h.close(a)}catch(d){h.abort(d)}}))}async acceptIncomingConnection(e){if(this.deny.some(h=>e.remoteAddr.toString().startsWith(h.toString())))return ur(this,Yn).call(this,"connection from %a refused - connection remote address was in deny list",e.remoteAddr),!1;if(this.allow.some(h=>e.remoteAddr.toString().startsWith(h.toString())))return this.incomingPendingConnections++,!0;if(this.incomingPendingConnections===this.maxIncomingPendingConnections)return ur(this,Yn).call(this,"connection from %a refused - incomingPendingConnections exceeded by host",e.remoteAddr),!1;if(e.remoteAddr.isThinWaistAddress()){const h=e.remoteAddr.nodeAddress().address;try{await this.inboundConnectionRateLimiter.consume(h,1)}catch{return ur(this,Yn).call(this,"connection from %a refused - inboundConnectionThreshold exceeded by host %s",e.remoteAddr,h),!1}}return this.getConnections().length<this.maxConnections?(this.incomingPendingConnections++,!0):(ur(this,Yn).call(this,"connection from %a refused - maxConnections exceeded",e.remoteAddr),!1)}afterUpgradeInbound(){this.incomingPendingConnections--}getDialQueue(){return this.dialQueue.pendingDials}}Yn=new WeakMap;function isAsyncIterable$1(i){return i[Symbol.asyncIterator]!=null}function map$1(i,e){if(isAsyncIterable$1(i))return async function*(){for await(const ft of i)yield e(ft)}();const a=peekable(i),{value:c,done:h}=a.next();if(h===!0)return function*(){}();const d=e(c);if(typeof d.then=="function")return async function*(){yield await d;for await(const ft of a)yield e(ft)}();const et=e;return function*(){yield d;for(const ft of a)yield et(ft)}()}async function*storeAddresses(i,e){yield*map$1(i,async a=>(await e.merge(a.id,{multiaddrs:a.multiaddrs}),a))}function uniquePeers(i){const e=new Set;return filter(i,a=>e.has(a.id.toString())?!1:(e.add(a.id.toString()),!0))}async function*requirePeers(i,e=1){let a=0;for await(const c of i)a++,yield c;if(a<e)throw new CodeError$2(`more peers required, seen: ${a}  min: ${e}`,"NOT_FOUND")}class CompoundContentRouting{constructor(e,a){qt(this,"routers");qt(this,"started");qt(this,"components");this.routers=a.routers??[],this.started=!1,this.components=e}isStarted(){return this.started}async start(){this.started=!0}async stop(){this.started=!1}async*findProviders(e,a={}){if(this.routers.length===0)throw new CodeError$2("No content routers available",codes.ERR_NO_ROUTERS_AVAILABLE);yield*pipe(merge$1(...this.routers.map(c=>c.findProviders(e,a))),c=>storeAddresses(c,this.components.peerStore),c=>uniquePeers(c),c=>requirePeers(c))}async provide(e,a={}){if(this.routers.length===0)throw new CodeError$2("No content routers available",codes.ERR_NO_ROUTERS_AVAILABLE);await Promise.all(this.routers.map(async c=>{await c.provide(e,a)}))}async put(e,a,c){if(!this.isStarted())throw new CodeError$2(messages.NOT_STARTED_YET,codes.DHT_NOT_STARTED);await Promise.all(this.routers.map(async h=>{await h.put(e,a,c)}))}async get(e,a){if(!this.isStarted())throw new CodeError$2(messages.NOT_STARTED_YET,codes.DHT_NOT_STARTED);return Promise.any(this.routers.map(async c=>c.get(e,a)))}}function isAsyncIterable(i){return i[Symbol.asyncIterator]!=null}function first(i){if(isAsyncIterable(i))return(async()=>{for await(const e of i)return e})();for(const e of i)return e}const log$7=logger$2("libp2p:peer-routing");class DefaultPeerRouting{constructor(e,a){qt(this,"components");qt(this,"routers");this.components=e,this.routers=a.routers??[]}async findPeer(e,a){if(this.routers.length===0)throw new CodeError$2("No peer routers available",codes.ERR_NO_ROUTERS_AVAILABLE);if(e.toString()===this.components.peerId.toString())throw new CodeError$2("Should not try to find self",codes.ERR_FIND_SELF);const c=await pipe(merge$1(...this.routers.map(h=>async function*(){try{yield await h.findPeer(e,a)}catch(d){log$7.error(d)}}())),h=>filter(h,Boolean),h=>storeAddresses(h,this.components.peerStore),async h=>first(h));if(c!=null)return c;throw new CodeError$2(messages.NOT_FOUND,codes.ERR_NOT_FOUND)}async*getClosestPeers(e,a){if(this.routers.length===0)throw new CodeError$2("No peer routers available",codes.ERR_NO_ROUTERS_AVAILABLE);yield*pipe(merge$1(...this.routers.map(c=>c.getClosestPeers(e,a))),c=>storeAddresses(c,this.components.peerStore),c=>uniquePeers(c),c=>requirePeers(c))}}const log$6=logger$2("libp2p:registrar"),DEFAULT_MAX_INBOUND_STREAMS=32,DEFAULT_MAX_OUTBOUND_STREAMS=64;class DefaultRegistrar{constructor(e){qt(this,"topologies");qt(this,"handlers");qt(this,"components");this.topologies=new Map,this.handlers=new Map,this.components=e,this._onDisconnect=this._onDisconnect.bind(this),this._onPeerUpdate=this._onPeerUpdate.bind(this),this._onPeerIdentify=this._onPeerIdentify.bind(this),this.components.events.addEventListener("peer:disconnect",this._onDisconnect),this.components.events.addEventListener("peer:update",this._onPeerUpdate),this.components.events.addEventListener("peer:identify",this._onPeerIdentify)}getProtocols(){return Array.from(new Set([...this.handlers.keys()])).sort()}getHandler(e){const a=this.handlers.get(e);if(a==null)throw new CodeError$2(`No handler registered for protocol ${e}`,codes.ERR_NO_HANDLER_FOR_PROTOCOL);return a}getTopologies(e){const a=this.topologies.get(e);return a==null?[]:[...a.values()]}async handle(e,a,c){if(this.handlers.has(e))throw new CodeError$2(`Handler already registered for protocol ${e}`,codes.ERR_PROTOCOL_HANDLER_ALREADY_REGISTERED);const h=mergeOptions$1.bind({ignoreUndefined:!0})({maxInboundStreams:DEFAULT_MAX_INBOUND_STREAMS,maxOutboundStreams:DEFAULT_MAX_OUTBOUND_STREAMS},c);this.handlers.set(e,{handler:a,options:h}),await this.components.peerStore.merge(this.components.peerId,{protocols:[e]})}async unhandle(e){(Array.isArray(e)?e:[e]).forEach(c=>{this.handlers.delete(c)}),await this.components.peerStore.patch(this.components.peerId,{protocols:this.getProtocols()})}async register(e,a){if(a==null)throw new CodeError$2("invalid topology",codes.ERR_INVALID_PARAMETERS);const c=`${(Math.random()*1e9).toString(36)}${Date.now()}`;let h=this.topologies.get(e);return h==null&&(h=new Map,this.topologies.set(e,h)),h.set(c,a),c}unregister(e){for(const[a,c]of this.topologies.entries())c.has(e)&&(c.delete(e),c.size===0&&this.topologies.delete(a))}_onDisconnect(e){const a=e.detail;this.components.peerStore.get(a).then(c=>{var h;for(const d of c.protocols){const et=this.topologies.get(d);if(et!=null)for(const ft of et.values())(h=ft.onDisconnect)==null||h.call(ft,a)}}).catch(c=>{c.code!==codes.ERR_NOT_FOUND&&log$6.error("could not inform topologies of disconnecting peer %p",a,c)})}_onPeerUpdate(e){var d;const{peer:a,previous:c}=e.detail,h=((c==null?void 0:c.protocols)??[]).filter(et=>!a.protocols.includes(et));for(const et of h){const ft=this.topologies.get(et);if(ft!=null)for(const gt of ft.values())(d=gt.onDisconnect)==null||d.call(gt,a.id)}}_onPeerIdentify(e){var d;const a=e.detail.protocols,c=e.detail.connection,h=e.detail.peerId;for(const et of a){const ft=this.topologies.get(et);if(ft!=null)for(const gt of ft.values())c.transient&&gt.notifyOnTransient!==!0||(d=gt.onConnect)==null||d.call(gt,h,c)}}}class TrackedMap extends Map{constructor(a){super();qt(this,"metric");const{name:c,metrics:h}=a;this.metric=h.registerMetric(c),this.updateComponentMetric()}set(a,c){return super.set(a,c),this.updateComponentMetric(),this}delete(a){const c=super.delete(a);return this.updateComponentMetric(),c}clear(){super.clear(),this.updateComponentMetric()}updateComponentMetric(){this.metric.update(this.size)}}function trackedMap(i){const{name:e,metrics:a}=i;let c;return a!=null?c=new TrackedMap({name:e,metrics:a}):c=new Map,c}const log$5=logger$2("libp2p:transports");class DefaultTransportManager{constructor(e,a={}){qt(this,"components");qt(this,"transports");qt(this,"listeners");qt(this,"faultTolerance");qt(this,"started");this.components=e,this.started=!1,this.transports=new Map,this.listeners=trackedMap({name:"libp2p_transport_manager_listeners",metrics:this.components.metrics}),this.faultTolerance=a.faultTolerance??FaultTolerance.FATAL_ALL}add(e){const a=e[Symbol.toStringTag];if(a==null)throw new CodeError$2("Transport must have a valid tag",codes.ERR_INVALID_KEY);if(this.transports.has(a))throw new CodeError$2(`There is already a transport with the tag ${a}`,codes.ERR_DUPLICATE_TRANSPORT);log$5("adding transport %s",a),this.transports.set(a,e),this.listeners.has(a)||this.listeners.set(a,[])}isStarted(){return this.started}start(){this.started=!0}async afterStart(){const e=this.components.addressManager.getListenAddrs();await this.listen(e)}async stop(){const e=[];for(const[a,c]of this.listeners)for(log$5("closing listeners for %s",a);c.length>0;){const h=c.pop();h!=null&&e.push(h.close())}await Promise.all(e),log$5("all listeners closed");for(const a of this.listeners.keys())this.listeners.set(a,[]);this.started=!1}async dial(e,a){const c=this.transportForMultiaddr(e);if(c==null)throw new CodeError$2(`No transport available for address ${String(e)}`,codes.ERR_TRANSPORT_UNAVAILABLE);try{return await c.dial(e,{...a,upgrader:this.components.upgrader})}catch(h){throw h.code==null&&(h.code=codes.ERR_TRANSPORT_DIAL_FAILED),h}}getAddrs(){let e=[];for(const a of this.listeners.values())for(const c of a)e=[...e,...c.getAddrs()];return e}getTransports(){return Array.of(...this.transports.values())}getListeners(){return Array.of(...this.listeners.values()).flat()}transportForMultiaddr(e){for(const a of this.transports.values())if(a.filter([e]).length>0)return a}async listen(e){if(!this.isStarted())throw new CodeError$2("Not started",codes.ERR_NODE_NOT_STARTED);if(e==null||e.length===0){log$5("no addresses were provided for listening, this node is dial only");return}const a=[];for(const[c,h]of this.transports.entries()){const d=h.filter(e),et=[];for(const _t of d){log$5("creating listener for %s on %a",c,_t);const wt=h.createListener({upgrader:this.components.upgrader});let $t=this.listeners.get(c)??[];$t==null&&($t=[],this.listeners.set(c,$t)),$t.push(wt),wt.addEventListener("listening",()=>{this.components.events.safeDispatchEvent("transport:listening",{detail:wt})}),wt.addEventListener("close",()=>{const It=$t.findIndex(Rt=>Rt===wt);$t.splice(It,1),this.components.events.safeDispatchEvent("transport:close",{detail:wt})}),et.push(wt.listen(_t))}if(et.length===0){a.push(c);continue}if((await Promise.allSettled(et)).find(_t=>_t.status==="fulfilled")==null&&this.faultTolerance!==FaultTolerance.NO_FATAL)throw new CodeError$2(`Transport (${c}) could not listen on any available address`,codes.ERR_NO_VALID_ADDRESSES)}if(a.length===this.transports.size){const c=`no valid addresses were provided for transports [${a.join(", ")}]`;if(this.faultTolerance===FaultTolerance.FATAL_ALL)throw new CodeError$2(c,codes.ERR_NO_VALID_ADDRESSES);log$5(`libp2p in dial mode only: ${c}`)}}async remove(e){const a=this.listeners.get(e)??[];log$5.trace("removing transport %s",e);const c=[];for(log$5.trace("closing listeners for %s",e);a.length>0;){const h=a.pop();h!=null&&c.push(h.close())}await Promise.all(c),this.transports.delete(e),this.listeners.delete(e)}async removeAll(){const e=[];for(const a of this.transports.keys())e.push(this.remove(a));await Promise.all(e)}}const PROTOCOL_ID="/multistream/1.0.0",MAX_PROTOCOL_LENGTH=1024;function reader(i){const e=async function*(){let a=yield,c=new Uint8ArrayList;for await(const h of i){if(a==null){c.append(h),a=yield c,c=new Uint8ArrayList;continue}for(c.append(h);c.length>=a;){const d=c.sublist(0,a);if(c.consume(a),a=yield d,a==null){c.length>0&&(a=yield c,c=new Uint8ArrayList);break}}}if(a!=null)throw Object.assign(new Error(`stream ended before ${a} bytes became available`),{code:"ERR_UNDER_READ",buffer:c})}();return e.next(),e}function handshake(i){const e=pushable$1(),a=reader(i.source),c=pDefer();let h;const d=i.sink(async function*(){yield*e,yield*await c.promise}());return d.catch(ft=>{h=ft}),{reader:a,writer:e,stream:{sink:async ft=>{if(h!=null){await Promise.reject(h);return}c.resolve(ft),await d},source:a},rest:()=>e.end(),write:e.push,read:async()=>{const ft=await a.next();if(ft.value!=null)return ft.value}}}const log$4=logger$2("libp2p:mss"),NewLine=fromString$9(`
`);function encode(i){const e=new Uint8ArrayList(i,NewLine);return encode$c.single(e)}function write(i,e,a={}){const c=encode(e);a.writeBytes===!0?i.push(c.subarray()):i.push(c)}function writeAll(i,e,a={}){const c=new Uint8ArrayList;for(const h of e)c.append(encode(h));a.writeBytes===!0?i.push(c.subarray()):i.push(c)}async function read(i,e){let a=1;const c={[Symbol.asyncIterator]:()=>c,next:async()=>i.next(a)};let h=c;(e==null?void 0:e.signal)!=null&&(h=abortableSource(c,e.signal));const d=ft=>{a=ft},et=await pipe(h,ft=>decode$b(ft,{onLength:d,maxDataLength:MAX_PROTOCOL_LENGTH}),async ft=>first(ft));if(et==null||et.length===0)throw new CodeError$2("no buffer returned","ERR_INVALID_MULTISTREAM_SELECT_MESSAGE");if(et.get(et.byteLength-1)!==NewLine[0])throw log$4.error("Invalid mss message - missing newline - %s",et.subarray()),new CodeError$2("missing newline","ERR_INVALID_MULTISTREAM_SELECT_MESSAGE");return et.sublist(0,-1)}async function readString(i,e){const a=await read(i,e);return toString$d(a.subarray())}const log$3=logger$2("libp2p:mss:select");async function select(i,e,a={}){e=Array.isArray(e)?[...e]:[e];const{reader:c,writer:h,rest:d,stream:et}=handshake(i),ft=e.shift();if(ft==null)throw new Error("At least one protocol must be specified");log$3.trace('select: write ["%s", "%s"]',PROTOCOL_ID,ft);const gt=fromString$9(PROTOCOL_ID),_t=fromString$9(ft);writeAll(h,[gt,_t],a);let wt=await readString(c,a);if(log$3.trace('select: read "%s"',wt),wt===PROTOCOL_ID&&(wt=await readString(c,a),log$3.trace('select: read "%s"',wt)),wt===ft)return d(),{stream:et,protocol:ft};for(const $t of e){log$3.trace('select: write "%s"',$t),write(h,fromString$9($t),a);const It=await readString(c,a);if(log$3.trace('select: read "%s" for "%s"',It,$t),It===$t)return d(),{stream:et,protocol:$t}}throw d(),new CodeError$2("protocol selection failed","ERR_UNSUPPORTED_PROTOCOL")}const log$2=logger$2("libp2p:mss:handle");async function handle(i,e,a){e=Array.isArray(e)?e:[e];const{writer:c,reader:h,rest:d,stream:et}=handshake(i);for(;;){const ft=await readString(h,a);if(log$2.trace('read "%s"',ft),ft===PROTOCOL_ID){log$2.trace('respond with "%s" for "%s"',PROTOCOL_ID,ft),write(c,fromString$9(PROTOCOL_ID),a);continue}if(e.includes(ft))return write(c,fromString$9(ft),a),log$2.trace('respond with "%s" for "%s"',ft,ft),d(),{stream:et,protocol:ft};if(ft==="ls"){write(c,new Uint8ArrayList(...e.map(gt=>encode(fromString$9(gt)))),a),log$2.trace('respond with "%s" for %s',e,ft);continue}write(c,fromString$9("na"),a),log$2('respond with "na" for "%s"',ft)}}const symbol=Symbol.for("@libp2p/connection"),CLOSE_TIMEOUT=500;var ls,kp,Np;class ConnectionImpl{constructor(e){qt(this,"id");qt(this,"remoteAddr");qt(this,"remotePeer");qt(this,"direction");qt(this,"timeline");qt(this,"multiplexer");qt(this,"encryption");qt(this,"status");qt(this,"transient");qt(this,"tags");qt(this,"_newStream");qt(this,"_close");qt(this,"_abort");qt(this,"_getStreams");gn(this,ls,void 0);qt(this,kp,"Connection");qt(this,Np,!0);const{remoteAddr:a,remotePeer:c,newStream:h,close:d,abort:et,getStreams:ft}=e;this.id=`${parseInt(String(Math.random()*1e9)).toString(36)}${Date.now()}`,this.remoteAddr=a,this.remotePeer=c,this.direction=e.direction,this.status="open",this.timeline=e.timeline,this.multiplexer=e.multiplexer,this.encryption=e.encryption,this.transient=e.transient??!1,yn(this,ls,e.logger.forComponent("libp2p:connection")),this.remoteAddr.getPeerId()==null&&(this.remoteAddr=this.remoteAddr.encapsulate(`/p2p/${this.remotePeer}`)),this._newStream=h,this._close=d,this._abort=et,this._getStreams=ft,this.tags=[]}get streams(){return this._getStreams()}async newStream(e,a){if(this.status==="closing")throw new CodeError$2("the connection is being closed","ERR_CONNECTION_BEING_CLOSED");if(this.status==="closed")throw new CodeError$2("the connection is closed","ERR_CONNECTION_CLOSED");if(Array.isArray(e)||(e=[e]),this.transient&&(a==null?void 0:a.runOnTransientConnection)!==!0)throw new CodeError$2("Cannot open protocol stream on transient connection","ERR_TRANSIENT_CONNECTION");const c=await this._newStream(e,a);return c.direction="outbound",c}async close(e={}){if(!(this.status==="closed"||this.status==="closing")){if(ur(this,ls).call(this,"closing connection to %a",this.remoteAddr),this.status="closing",e.signal==null){const a=AbortSignal.timeout(CLOSE_TIMEOUT);setMaxListeners(1/0,a),e={...e,signal:a}}try{ur(this,ls).trace("closing all streams"),await Promise.all(this.streams.map(async a=>a.close(e))),ur(this,ls).trace("closing underlying transport"),await this._close(e),ur(this,ls).trace("updating timeline with close time"),this.status="closed",this.timeline.close=Date.now()}catch(a){ur(this,ls).error("error encountered during graceful close of connection to %a",this.remoteAddr,a),this.abort(a)}}}abort(e){ur(this,ls).error("aborting connection to %a due to error",this.remoteAddr,e),this.status="closing",this.streams.forEach(a=>{a.abort(e)}),ur(this,ls).error("all streams aborted",this.streams.length),this._abort(e),this.timeline.close=Date.now(),this.status="closed"}}kp=Symbol.toStringTag,Np=symbol,ls=new WeakMap;function createConnection(i){return new ConnectionImpl(i)}const DEFAULT_PROTOCOL_SELECT_TIMEOUT=3e4;function findIncomingStreamLimit(i,e){try{const{options:a}=e.getHandler(i);return a.maxInboundStreams}catch(a){if(a.code!==codes.ERR_NO_HANDLER_FOR_PROTOCOL)throw a}return DEFAULT_MAX_INBOUND_STREAMS}function findOutgoingStreamLimit(i,e,a={}){try{const{options:c}=e.getHandler(i);if(c.maxOutboundStreams!=null)return c.maxOutboundStreams}catch(c){if(c.code!==codes.ERR_NO_HANDLER_FOR_PROTOCOL)throw c}return a.maxOutboundStreams??DEFAULT_MAX_OUTBOUND_STREAMS}function countStreams(i,e,a){let c=0;return a.streams.forEach(h=>{h.direction===e&&h.protocol===i&&c++}),c}var Dn;class DefaultUpgrader{constructor(e,a){qt(this,"components");qt(this,"connectionEncryption");qt(this,"muxers");qt(this,"inboundUpgradeTimeout");qt(this,"events");gn(this,Dn,void 0);this.components=e,this.connectionEncryption=new Map,yn(this,Dn,e.logger.forComponent("libp2p:upgrader")),a.connectionEncryption.forEach(c=>{this.connectionEncryption.set(c.protocol,c)}),this.muxers=new Map,a.muxers.forEach(c=>{this.muxers.set(c.protocol,c)}),this.inboundUpgradeTimeout=a.inboundUpgradeTimeout??INBOUND_UPGRADE_TIMEOUT,this.events=e.events}async shouldBlockConnection(e,a,c){const h=this.components.connectionGater[c];if(h!==void 0&&await h(e,a))throw new CodeError$2(`The multiaddr connection is blocked by gater.${c}`,codes.ERR_CONNECTION_INTERCEPTED)}async upgradeInbound(e,a){var $t,It,Rt;if(!await this.components.connectionManager.acceptIncomingConnection(e))throw new CodeError$2("connection denied",codes.ERR_CONNECTION_DENIED);let h,d,et,ft,gt;const _t=AbortSignal.timeout(this.inboundUpgradeTimeout),wt=()=>{e.abort(new CodeError$2("inbound upgrade timeout",codes.ERR_TIMEOUT))};_t.addEventListener("abort",wt,{once:!0}),setMaxListeners(1/0,_t);try{if(await((It=($t=this.components.connectionGater).denyInboundConnection)==null?void 0:It.call($t,e))===!0)throw new CodeError$2("The multiaddr connection is blocked by gater.acceptConnection",codes.ERR_CONNECTION_INTERCEPTED);(Rt=this.components.metrics)==null||Rt.trackMultiaddrConnection(e),ur(this,Dn).call(this,"starting the inbound connection upgrade");let Tt=e;if((a==null?void 0:a.skipProtection)!==!0){const At=this.components.connectionProtector;At!=null&&(ur(this,Dn).call(this,"protecting the inbound connection"),Tt=await At.protect(e))}try{if(h=Tt,(a==null?void 0:a.skipEncryption)!==!0){({conn:h,remotePeer:d,protocol:gt}=await this._encryptInbound(Tt));const At={...Tt,...h};await this.shouldBlockConnection(d,At,"denyInboundEncryptedConnection")}else{const At=e.remoteAddr.getPeerId();if(At==null)throw new CodeError$2("inbound connection that skipped encryption must have a peer id",codes.ERR_INVALID_MULTIADDR);const kt=peerIdFromString(At);gt="native",d=kt}if(et=h,(a==null?void 0:a.muxerFactory)!=null)ft=a.muxerFactory;else if(this.muxers.size>0){const At=await this._multiplexInbound({...Tt,...h},this.muxers);ft=At.muxerFactory,et=At.stream}}catch(At){throw ur(this,Dn).error("Failed to upgrade inbound connection",At),At}return await this.shouldBlockConnection(d,e,"denyInboundUpgradedConnection"),ur(this,Dn).call(this,"Successfully upgraded inbound connection"),this._createConnection({cryptoProtocol:gt,direction:"inbound",maConn:e,upgradedConn:et,muxerFactory:ft,remotePeer:d,transient:a==null?void 0:a.transient})}finally{_t.removeEventListener("abort",wt),this.components.connectionManager.afterUpgradeInbound()}}async upgradeOutbound(e,a){var $t;const c=e.remoteAddr.getPeerId();let h;c!=null&&(h=peerIdFromString(c),await this.shouldBlockConnection(h,e,"denyOutboundConnection"));let d,et,ft,gt,_t;($t=this.components.metrics)==null||$t.trackMultiaddrConnection(e),ur(this,Dn).call(this,"Starting the outbound connection upgrade");let wt=e;if((a==null?void 0:a.skipProtection)!==!0){const It=this.components.connectionProtector;It!=null&&(wt=await It.protect(e))}try{if(d=wt,(a==null?void 0:a.skipEncryption)!==!0){({conn:d,remotePeer:et,protocol:gt}=await this._encryptOutbound(wt,h));const It={...wt,...d};await this.shouldBlockConnection(et,It,"denyOutboundEncryptedConnection")}else{if(h==null)throw new CodeError$2("Encryption was skipped but no peer id was passed",codes.ERR_INVALID_PEER);gt="native",et=h}if(ft=d,(a==null?void 0:a.muxerFactory)!=null)_t=a.muxerFactory;else if(this.muxers.size>0){const It=await this._multiplexOutbound({...wt,...d},this.muxers);_t=It.muxerFactory,ft=It.stream}}catch(It){throw ur(this,Dn).error("Failed to upgrade outbound connection",It),await e.close(It),It}return await this.shouldBlockConnection(et,e,"denyOutboundUpgradedConnection"),ur(this,Dn).call(this,"Successfully upgraded outbound connection"),this._createConnection({cryptoProtocol:gt,direction:"outbound",maConn:e,upgradedConn:ft,muxerFactory:_t,remotePeer:et,transient:a==null?void 0:a.transient})}_createConnection(e){const{cryptoProtocol:a,direction:c,maConn:h,upgradedConn:d,remotePeer:et,muxerFactory:ft,transient:gt}=e;let _t,wt,$t;ft!=null&&(_t=ft.createStreamMuxer({direction:c,onIncomingStream:Tt=>{$t!=null&&Promise.resolve().then(async()=>{var jt;const At=this.components.registrar.getProtocols(),{stream:kt,protocol:xt}=await handle(Tt,At);if(ur(this,Dn).call(this,"%s: incoming stream opened on %s",c,xt),$t==null)return;const Nt=findIncomingStreamLimit(xt,this.components.registrar);if(countStreams(xt,"inbound",$t)===Nt){const Gt=new CodeError$2(`Too many inbound protocol streams for protocol "${xt}" - limit ${Nt}`,codes.ERR_TOO_MANY_INBOUND_PROTOCOL_STREAMS);throw Tt.abort(Gt),Gt}Tt.source=kt.source,Tt.sink=kt.sink,Tt.protocol=xt,await this.components.peerStore.merge(et,{protocols:[xt]}),(jt=this.components.metrics)==null||jt.trackProtocolStream(Tt,$t),this._onStream({connection:$t,stream:Tt,protocol:xt})}).catch(async At=>{ur(this,Dn).error(At),Tt.timeline.close==null&&await Tt.close()})}}),wt=async(Tt,At={})=>{var xt;if(_t==null)throw new CodeError$2("Stream is not multiplexed",codes.ERR_MUXER_UNAVAILABLE);ur(this,Dn).call(this,"%s-%s: starting new stream on %s",$t.id,c,Tt);const kt=await _t.newStream();try{if(At.signal==null){ur(this,Dn).call(this,"No abort signal was passed while trying to negotiate protocols %s falling back to default timeout",Tt);const Kt=AbortSignal.timeout(DEFAULT_PROTOCOL_SELECT_TIMEOUT);setMaxListeners(1/0,Kt),At={...At,signal:Kt}}const{stream:Nt,protocol:Ft}=await select(kt,Tt,At),jt=findOutgoingStreamLimit(Ft,this.components.registrar,At);if(countStreams(Ft,"outbound",$t)>=jt){const Kt=new CodeError$2(`Too many outbound protocol streams for protocol "${Ft}" - limit ${jt}`,codes.ERR_TOO_MANY_OUTBOUND_PROTOCOL_STREAMS);throw kt.abort(Kt),Kt}return await this.components.peerStore.merge(et,{protocols:[Ft]}),kt.source=Nt.source,kt.sink=Nt.sink,kt.protocol=Ft,(xt=this.components.metrics)==null||xt.trackProtocolStream(kt,$t),kt}catch(Nt){throw ur(this,Dn).error("could not create new stream for protocols %s on connection with address %a",Tt,$t.remoteAddr,Nt),kt.timeline.close==null&&kt.abort(Nt),Nt.code!=null?Nt:new CodeError$2(String(Nt),codes.ERR_UNSUPPORTED_PROTOCOL)}},Promise.all([_t.sink(d.source),d.sink(_t.source)]).catch(Tt=>{ur(this,Dn).error(Tt)}));const It=h.timeline;h.timeline=new Proxy(It,{set:(...Tt)=>($t!=null&&Tt[1]==="close"&&Tt[2]!=null&&It.close==null&&(async()=>{try{$t.status==="open"&&await $t.close()}catch(At){ur(this,Dn).error(At)}finally{this.events.safeDispatchEvent("connection:close",{detail:$t})}})().catch(At=>{ur(this,Dn).error(At)}),Reflect.set(...Tt))}),h.timeline.upgraded=Date.now();const Rt=()=>{throw new CodeError$2("connection is not multiplexed",codes.ERR_CONNECTION_NOT_MULTIPLEXED)};return $t=createConnection({remoteAddr:h.remoteAddr,remotePeer:et,status:"open",direction:c,timeline:h.timeline,multiplexer:_t==null?void 0:_t.protocol,encryption:a,transient:gt,logger:this.components.logger,newStream:wt??Rt,getStreams:()=>_t!=null?_t.streams:[],close:async Tt=>{_t!=null&&(ur(this,Dn).trace("close muxer"),await _t.close(Tt)),ur(this,Dn).trace("close maconn"),await h.close(Tt),ur(this,Dn).trace("closed maconn")},abort:Tt=>{h.abort(Tt),_t!=null&&_t.abort(Tt)}}),this.events.safeDispatchEvent("connection:open",{detail:$t}),$t}_onStream(e){const{connection:a,stream:c,protocol:h}=e,{handler:d,options:et}=this.components.registrar.getHandler(h);if(a.transient&&et.runOnTransientConnection!==!0)throw new CodeError$2("Cannot open protocol stream on transient connection","ERR_TRANSIENT_CONNECTION");d({connection:a,stream:c})}async _encryptInbound(e){const a=Array.from(this.connectionEncryption.keys());ur(this,Dn).call(this,"handling inbound crypto protocol selection",a);try{const{stream:c,protocol:h}=await handle(e,a,{writeBytes:!0}),d=this.connectionEncryption.get(h);if(d==null)throw new Error(`no crypto module found for ${h}`);return ur(this,Dn).call(this,"encrypting inbound connection..."),{...await d.secureInbound(this.components.peerId,c),protocol:h}}catch(c){throw new CodeError$2(String(c),codes.ERR_ENCRYPTION_FAILED)}}async _encryptOutbound(e,a){const c=Array.from(this.connectionEncryption.keys());ur(this,Dn).call(this,"selecting outbound crypto protocol",c);try{const{stream:h,protocol:d}=await select(e,c,{writeBytes:!0}),et=this.connectionEncryption.get(d);if(et==null)throw new Error(`no crypto module found for ${d}`);return ur(this,Dn).call(this,"encrypting outbound connection to %p",a),{...await et.secureOutbound(this.components.peerId,h,a),protocol:d}}catch(h){throw new CodeError$2(String(h),codes.ERR_ENCRYPTION_FAILED)}}async _multiplexOutbound(e,a){const c=Array.from(a.keys());ur(this,Dn).call(this,"outbound selecting muxer %s",c);try{const{stream:h,protocol:d}=await select(e,c,{writeBytes:!0});ur(this,Dn).call(this,"%s selected as muxer protocol",d);const et=a.get(d);return{stream:h,muxerFactory:et}}catch(h){throw ur(this,Dn).error("error multiplexing outbound stream",h),new CodeError$2(String(h),codes.ERR_MUXER_UNAVAILABLE)}}async _multiplexInbound(e,a){const c=Array.from(a.keys());ur(this,Dn).call(this,"inbound handling muxers %s",c);try{const{stream:h,protocol:d}=await handle(e,c,{writeBytes:!0}),et=a.get(d);return{stream:h,muxerFactory:et}}catch(h){throw ur(this,Dn).error("error multiplexing inbound stream",h),new CodeError$2(String(h),codes.ERR_MUXER_UNAVAILABLE)}}}Dn=new WeakMap;var Ss,Gn,Eo,ba;class Libp2pNode extends TypedEventEmitter{constructor(a){super();gn(this,Eo);qt(this,"peerId");qt(this,"peerStore");qt(this,"contentRouting");qt(this,"peerRouting");qt(this,"keychain");qt(this,"metrics");qt(this,"services");qt(this,"logger");qt(this,"components");gn(this,Ss,void 0);gn(this,Gn,void 0);const c=new TypedEventEmitter,h=c.dispatchEvent.bind(c);c.dispatchEvent=_t=>{const wt=h(_t),$t=this.dispatchEvent(new CustomEvent(_t.type,{detail:_t.detail}));return wt||$t},setMaxListeners(1/0,c),yn(this,Ss,!1),this.peerId=a.peerId,this.logger=a.logger??defaultLogger(),yn(this,Gn,this.logger.forComponent("libp2p")),this.services={};const d=this.components=defaultComponents({peerId:a.peerId,logger:this.logger,events:c,datastore:a.datastore??new MemoryDatastore,connectionGater:connectionGater(a.connectionGater)});this.peerStore=this.configureComponent("peerStore",new PersistentPeerStore(d,{addressFilter:this.components.connectionGater.filterMultiaddrForPeer,...a.peerStore})),a.metrics!=null&&(this.metrics=this.configureComponent("metrics",a.metrics(this.components))),d.events.addEventListener("peer:update",_t=>{if(_t.detail.previous==null){const wt={id:_t.detail.peer.id,multiaddrs:_t.detail.peer.addresses.map($t=>$t.multiaddr),protocols:_t.detail.peer.protocols};d.events.safeDispatchEvent("peer:discovery",{detail:wt})}}),a.connectionProtector!=null&&this.configureComponent("connectionProtector",a.connectionProtector(d)),this.components.upgrader=new DefaultUpgrader(this.components,{connectionEncryption:(a.connectionEncryption??[]).map((_t,wt)=>this.configureComponent(`connection-encryption-${wt}`,_t(this.components))),muxers:(a.streamMuxers??[]).map((_t,wt)=>this.configureComponent(`stream-muxers-${wt}`,_t(this.components))),inboundUpgradeTimeout:a.connectionManager.inboundUpgradeTimeout}),this.configureComponent("transportManager",new DefaultTransportManager(this.components,a.transportManager)),this.configureComponent("connectionManager",new DefaultConnectionManager(this.components,a.connectionManager)),this.configureComponent("registrar",new DefaultRegistrar(this.components)),this.configureComponent("addressManager",new DefaultAddressManager(this.components,a.addresses));const et=DefaultKeyChain.generateOptions();this.keychain=this.configureComponent("keyChain",new DefaultKeyChain(this.components,{...et,...a.keychain}));const ft=(a.peerRouters??[]).map((_t,wt)=>this.configureComponent(`peer-router-${wt}`,_t(this.components)));this.peerRouting=this.components.peerRouting=this.configureComponent("peerRouting",new DefaultPeerRouting(this.components,{routers:ft}));const gt=(a.contentRouters??[]).map((_t,wt)=>this.configureComponent(`content-router-${wt}`,_t(this.components)));if(this.contentRouting=this.components.contentRouting=this.configureComponent("contentRouting",new CompoundContentRouting(this.components,{routers:gt})),(a.peerDiscovery??[]).forEach((_t,wt)=>{this.configureComponent(`peer-discovery-${wt}`,_t(this.components)).addEventListener("peer",It=>{_n(this,Eo,ba).call(this,It)})}),a.transports.forEach((_t,wt)=>{this.components.transportManager.add(this.configureComponent(`transport-${wt}`,_t(this.components)))}),a.services!=null)for(const _t of Object.keys(a.services)){const wt=a.services[_t],$t=wt(this.components);if($t==null){ur(this,Gn).error("service factory %s returned null or undefined instance",_t);continue}this.services[_t]=$t,this.configureComponent(_t,$t),$t[contentRouting]!=null&&(ur(this,Gn).call(this,"registering service %s for content routing",_t),gt.push($t[contentRouting])),$t[peerRouting]!=null&&(ur(this,Gn).call(this,"registering service %s for peer routing",_t),ft.push($t[peerRouting])),$t[peerDiscovery]!=null&&(ur(this,Gn).call(this,"registering service %s for peer discovery",_t),$t[peerDiscovery].addEventListener("peer",It=>{_n(this,Eo,ba).call(this,It)}))}}configureComponent(a,c){return c==null&&ur(this,Gn).error("component %s was null or undefined",a),this.components[a]=c,c}async start(){var c,h,d,et;if(ur(this,Ss))return;yn(this,Ss,!0),ur(this,Gn).call(this,"libp2p is starting"),(await this.keychain.listKeys()).find(ft=>ft.name==="self")==null&&(ur(this,Gn).call(this,"importing self key into keychain"),await this.keychain.importPeer("self",this.components.peerId));try{await((h=(c=this.components).beforeStart)==null?void 0:h.call(c)),await this.components.start(),await((et=(d=this.components).afterStart)==null?void 0:et.call(d)),this.safeDispatchEvent("start",{detail:this}),ur(this,Gn).call(this,"libp2p has started")}catch(ft){throw ur(this,Gn).error("An error occurred starting libp2p",ft),await this.stop(),ft}}async stop(){var a,c,h,d;ur(this,Ss)&&(ur(this,Gn).call(this,"libp2p is stopping"),yn(this,Ss,!1),await((c=(a=this.components).beforeStop)==null?void 0:c.call(a)),await this.components.stop(),await((d=(h=this.components).afterStop)==null?void 0:d.call(h)),this.safeDispatchEvent("stop",{detail:this}),ur(this,Gn).call(this,"libp2p has stopped"))}isStarted(){return ur(this,Ss)}getConnections(a){return this.components.connectionManager.getConnections(a)}getDialQueue(){return this.components.connectionManager.getDialQueue()}getPeers(){const a=new PeerSet;for(const c of this.components.connectionManager.getConnections())a.add(c.remotePeer);return Array.from(a)}async dial(a,c={}){return this.components.connectionManager.openConnection(a,c)}async dialProtocol(a,c,h={}){if(c==null)throw new CodeError$2("no protocols were provided to open a stream",codes.ERR_INVALID_PROTOCOLS_FOR_STREAM);if(c=Array.isArray(c)?c:[c],c.length===0)throw new CodeError$2("no protocols were provided to open a stream",codes.ERR_INVALID_PROTOCOLS_FOR_STREAM);return(await this.dial(a,h)).newStream(c,h)}getMultiaddrs(){return this.components.addressManager.getAddresses()}getProtocols(){return this.components.registrar.getProtocols()}async hangUp(a,c={}){isMultiaddr(a)&&(a=peerIdFromString(a.getPeerId()??"")),await this.components.connectionManager.closeConnections(a,c)}async getPublicKey(a,c={}){if(ur(this,Gn).call(this,"getPublicKey %p",a),a.publicKey!=null)return a.publicKey;const h=await this.peerStore.get(a);if(h.id.publicKey!=null)return h.id.publicKey;const d=concat([fromString$9("/pk/"),a.multihash.digest]),et=await this.contentRouting.get(d,c);return unmarshalPublicKey(et),await this.peerStore.patch(a,{publicKey:et}),et}async handle(a,c,h){Array.isArray(a)||(a=[a]),await Promise.all(a.map(async d=>{await this.components.registrar.handle(d,c,h)}))}async unhandle(a){Array.isArray(a)||(a=[a]),await Promise.all(a.map(async c=>{await this.components.registrar.unhandle(c)}))}async register(a,c){return this.components.registrar.register(a,c)}unregister(a){this.components.registrar.unregister(a)}}Ss=new WeakMap,Gn=new WeakMap,Eo=new WeakSet,ba=function(a){const{detail:c}=a;if(c.id.toString()===this.peerId.toString()){ur(this,Gn).error(new Error(codes.ERR_DISCOVERED_SELF));return}this.components.peerStore.merge(c.id,{multiaddrs:c.multiaddrs,protocols:c.protocols}).catch(h=>{ur(this,Gn).error(h)})};async function createLibp2pNode(i){if(i.peerId==null){const e=i.datastore;if(e!=null)try{const a=new DefaultKeyChain({datastore:e},mergeOptions$1(DefaultKeyChain.generateOptions(),i.keychain));i.peerId=await a.exportPeerId("self")}catch(a){if(a.code!=="ERR_NOT_FOUND")throw a}}return i.peerId==null&&(i.peerId=await createEd25519PeerId()),new Libp2pNode(validateConfig(i))}async function createLibp2p(i){const e=await createLibp2pNode(i);return i.start!==!1&&await e.start(),e}const version$3="0.46.21",AGENT_VERSION=`js-libp2p/${version$3}`,IDENTIFY_PROTOCOL_VERSION="0.1.0",MULTICODEC_IDENTIFY_PROTOCOL_NAME="id",MULTICODEC_IDENTIFY_PUSH_PROTOCOL_NAME="id/push",MULTICODEC_IDENTIFY_PROTOCOL_VERSION="1.0.0",MULTICODEC_IDENTIFY_PUSH_PROTOCOL_VERSION="1.0.0";function pbStream(i,e){const a=lpStream(i,e),c={read:async(h,d)=>{const et=await a.read(d);return h.decode(et)},write:async(h,d,et)=>{await a.write(d.encode(h),et)},writeV:async(h,d,et)=>{await a.writeV(h.map(ft=>d.encode(ft)),et)},pb:h=>({read:async d=>c.read(h,d),write:async(d,et)=>c.write(d,h,et),writeV:async(d,et)=>c.writeV(d,h,et),unwrap:()=>c}),unwrap:()=>a.unwrap()};return c}var Identify;(function(i){let e;i.codec=()=>(e==null&&(e=message((a,c,h={})=>{if(h.lengthDelimited!==!1&&c.fork(),a.protocolVersion!=null&&(c.uint32(42),c.string(a.protocolVersion)),a.agentVersion!=null&&(c.uint32(50),c.string(a.agentVersion)),a.publicKey!=null&&(c.uint32(10),c.bytes(a.publicKey)),a.listenAddrs!=null)for(const d of a.listenAddrs)c.uint32(18),c.bytes(d);if(a.observedAddr!=null&&(c.uint32(34),c.bytes(a.observedAddr)),a.protocols!=null)for(const d of a.protocols)c.uint32(26),c.string(d);a.signedPeerRecord!=null&&(c.uint32(66),c.bytes(a.signedPeerRecord)),h.lengthDelimited!==!1&&c.ldelim()},(a,c)=>{const h={listenAddrs:[],protocols:[]},d=c==null?a.len:a.pos+c;for(;a.pos<d;){const et=a.uint32();switch(et>>>3){case 5:h.protocolVersion=a.string();break;case 6:h.agentVersion=a.string();break;case 1:h.publicKey=a.bytes();break;case 2:h.listenAddrs.push(a.bytes());break;case 4:h.observedAddr=a.bytes();break;case 3:h.protocols.push(a.string());break;case 8:h.signedPeerRecord=a.bytes();break;default:a.skipType(et&7);break}}return h})),e),i.encode=a=>encodeMessage(a,i.codec()),i.decode=a=>decodeMessage$1(a,i.codec())})(Identify||(Identify={}));const MAX_IDENTIFY_MESSAGE_SIZE=1024*8,defaultValues={protocolPrefix:"ipfs",agentVersion:AGENT_VERSION,timeout:6e4,maxInboundStreams:1,maxOutboundStreams:1,maxPushIncomingStreams:1,maxPushOutgoingStreams:1,maxObservedAddresses:10,maxIdentifyMessageSize:8192,runOnConnectionOpen:!0,runOnTransientConnection:!0};var Kn,wo,$a;class DefaultIdentifyService{constructor(e,a){gn(this,wo);qt(this,"identifyProtocolStr");qt(this,"identifyPushProtocolStr");qt(this,"host");qt(this,"started");qt(this,"timeout");qt(this,"peerId");qt(this,"peerStore");qt(this,"registrar");qt(this,"connectionManager");qt(this,"addressManager");qt(this,"maxInboundStreams");qt(this,"maxOutboundStreams");qt(this,"maxPushIncomingStreams");qt(this,"maxPushOutgoingStreams");qt(this,"maxIdentifyMessageSize");qt(this,"maxObservedAddresses");qt(this,"events");qt(this,"runOnTransientConnection");gn(this,Kn,void 0);this.started=!1,this.peerId=e.peerId,this.peerStore=e.peerStore,this.registrar=e.registrar,this.addressManager=e.addressManager,this.connectionManager=e.connectionManager,this.events=e.events,yn(this,Kn,e.logger.forComponent("libp2p:identify")),this.identifyProtocolStr=`/${a.protocolPrefix??defaultValues.protocolPrefix}/${MULTICODEC_IDENTIFY_PROTOCOL_NAME}/${MULTICODEC_IDENTIFY_PROTOCOL_VERSION}`,this.identifyPushProtocolStr=`/${a.protocolPrefix??defaultValues.protocolPrefix}/${MULTICODEC_IDENTIFY_PUSH_PROTOCOL_NAME}/${MULTICODEC_IDENTIFY_PUSH_PROTOCOL_VERSION}`,this.timeout=a.timeout??defaultValues.timeout,this.maxInboundStreams=a.maxInboundStreams??defaultValues.maxInboundStreams,this.maxOutboundStreams=a.maxOutboundStreams??defaultValues.maxOutboundStreams,this.maxPushIncomingStreams=a.maxPushIncomingStreams??defaultValues.maxPushIncomingStreams,this.maxPushOutgoingStreams=a.maxPushOutgoingStreams??defaultValues.maxPushOutgoingStreams,this.maxIdentifyMessageSize=a.maxIdentifyMessageSize??defaultValues.maxIdentifyMessageSize,this.maxObservedAddresses=a.maxObservedAddresses??defaultValues.maxObservedAddresses,this.runOnTransientConnection=a.runOnTransientConnection??defaultValues.runOnTransientConnection,this.host={protocolVersion:`${a.protocolPrefix??defaultValues.protocolPrefix}/${IDENTIFY_PROTOCOL_VERSION}`,agentVersion:a.agentVersion??defaultValues.agentVersion},(a.runOnConnectionOpen??defaultValues.runOnConnectionOpen)&&e.events.addEventListener("connection:open",c=>{const h=c.detail;this.identify(h).catch(d=>{ur(this,Kn).error("error during identify trigged by connection:open",d)})}),e.events.addEventListener("self:peer:update",c=>{this.push().catch(h=>{ur(this,Kn).error(h)})}),this.host.agentVersion===AGENT_VERSION&&(isNode||isElectronMain?this.host.agentVersion+=` UserAgent=${globalThis.process.version}`:(isBrowser||isWebWorker||isElectronRenderer||isReactNative$1)&&(this.host.agentVersion+=` UserAgent=${globalThis.navigator.userAgent}`))}isStarted(){return this.started}async start(){this.started||(await this.peerStore.merge(this.peerId,{metadata:{AgentVersion:fromString$9(this.host.agentVersion),ProtocolVersion:fromString$9(this.host.protocolVersion)}}),await this.registrar.handle(this.identifyProtocolStr,e=>{this._handleIdentify(e).catch(a=>{ur(this,Kn).error(a)})},{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnTransientConnection:this.runOnTransientConnection}),await this.registrar.handle(this.identifyPushProtocolStr,e=>{this._handlePush(e).catch(a=>{ur(this,Kn).error(a)})},{maxInboundStreams:this.maxPushIncomingStreams,maxOutboundStreams:this.maxPushOutgoingStreams,runOnTransientConnection:this.runOnTransientConnection}),this.started=!0)}async stop(){await this.registrar.unhandle(this.identifyProtocolStr),await this.registrar.unhandle(this.identifyPushProtocolStr),this.started=!1}async pushToConnections(e){const a=this.addressManager.getAddresses().map(wt=>wt.decapsulateCode(getProtocol("p2p").code)),c=new PeerRecord({peerId:this.peerId,multiaddrs:a}),h=await RecordEnvelope.seal(c,this.peerId),d=this.registrar.getProtocols(),et=await this.peerStore.get(this.peerId),ft=toString$d(et.metadata.get("AgentVersion")??fromString$9(this.host.agentVersion)),gt=toString$d(et.metadata.get("ProtocolVersion")??fromString$9(this.host.protocolVersion)),_t=e.map(async wt=>{let $t;const It=AbortSignal.timeout(this.timeout);setMaxListeners(1/0,It);try{$t=await wt.newStream([this.identifyPushProtocolStr],{signal:It,runOnTransientConnection:this.runOnTransientConnection}),await pbStream($t,{maxDataLength:this.maxIdentifyMessageSize??MAX_IDENTIFY_MESSAGE_SIZE}).pb(Identify).write({listenAddrs:a.map(Tt=>Tt.bytes),signedPeerRecord:h.marshal(),protocols:d,agentVersion:ft,protocolVersion:gt},{signal:It}),await $t.close({signal:It})}catch(Rt){ur(this,Kn).error("could not push identify update to peer",Rt),$t==null||$t.abort(Rt)}});await Promise.all(_t)}async push(){if(!this.isStarted())return;const e=[];await Promise.all(this.connectionManager.getConnections().map(async a=>{try{if(!(await this.peerStore.get(a.remotePeer)).protocols.includes(this.identifyPushProtocolStr))return;e.push(a)}catch(c){if(c.code!==codes.ERR_NOT_FOUND)throw c}})),await this.pushToConnections(e)}async _identify(e,a={}){let c;if(a.signal==null){const h=AbortSignal.timeout(this.timeout);setMaxListeners(1/0,h),a={...a,signal:h}}try{c=await e.newStream([this.identifyProtocolStr],{...a,runOnTransientConnection:this.runOnTransientConnection});const d=await pbStream(c,{maxDataLength:this.maxIdentifyMessageSize??MAX_IDENTIFY_MESSAGE_SIZE}).pb(Identify).read(a);return await c.close(a),d}catch(h){throw ur(this,Kn).error("error while reading identify message",h),c==null||c.abort(h),h}}async identify(e,a={}){const c=await this._identify(e,a),{publicKey:h,protocols:d,observedAddr:et}=c;if(h==null)throw new CodeError$2("public key was missing from identify message",codes.ERR_MISSING_PUBLIC_KEY);const ft=await peerIdFromKeys(h);if(!e.remotePeer.equals(ft))throw new CodeError$2("identified peer does not match the expected peer",codes.ERR_INVALID_PEER);if(this.peerId.equals(ft))throw new CodeError$2("identified peer is our own peer id?",codes.ERR_INVALID_PEER);const gt=getCleanMultiaddr(et);return ur(this,Kn).call(this,"identify completed for peer %p and protocols %o",ft,d),ur(this,Kn).call(this,"our observed address is %a",gt),gt!=null&&this.addressManager.getObservedAddrs().length<(this.maxObservedAddresses??1/0)&&(ur(this,Kn).call(this,"storing our observed address %a",gt),this.addressManager.addObservedAddr(gt)),_n(this,wo,$a).call(this,e,c)}async _handleIdentify(e){const{connection:a,stream:c}=e,h=AbortSignal.timeout(this.timeout);setMaxListeners(1/0,h);try{const d=this.peerId.publicKey??new Uint8Array(0),et=await this.peerStore.get(this.peerId),ft=this.addressManager.getAddresses().map($t=>$t.decapsulateCode(getProtocol("p2p").code));let gt=et.peerRecordEnvelope;if(ft.length>0&&gt==null){const $t=new PeerRecord({peerId:this.peerId,multiaddrs:ft});gt=(await RecordEnvelope.seal($t,this.peerId)).marshal().subarray()}let _t=a.remoteAddr.bytes;IP_OR_DOMAIN.matches(a.remoteAddr)||(_t=void 0),await pbStream(c).pb(Identify).write({protocolVersion:this.host.protocolVersion,agentVersion:this.host.agentVersion,publicKey:d,listenAddrs:ft.map($t=>$t.bytes),signedPeerRecord:gt,observedAddr:_t,protocols:et.protocols},{signal:h}),await c.close({signal:h})}catch(d){ur(this,Kn).error("could not respond to identify request",d),c.abort(d)}}async _handlePush(e){const{connection:a,stream:c}=e;try{if(this.peerId.equals(a.remotePeer))throw new Error("received push from ourselves?");const h={signal:AbortSignal.timeout(this.timeout)},et=await pbStream(c,{maxDataLength:this.maxIdentifyMessageSize??MAX_IDENTIFY_MESSAGE_SIZE}).pb(Identify).read(h);await c.close(h),await _n(this,wo,$a).call(this,a,et)}catch(h){ur(this,Kn).error("received invalid message",h),c.abort(h);return}ur(this,Kn).call(this,"handled push from %p",a.remotePeer)}}Kn=new WeakMap,wo=new WeakSet,$a=async function(e,a){if(ur(this,Kn).call(this,"received identify from %p",e.remotePeer),a==null)throw new CodeError$2("message was null or undefined","ERR_INVALID_MESSAGE");const c={};if(a.listenAddrs.length>0&&(c.addresses=a.listenAddrs.map(et=>({isCertified:!1,multiaddr:multiaddr(et)}))),a.protocols.length>0&&(c.protocols=a.protocols),a.publicKey!=null&&(c.publicKey=a.publicKey,!(await peerIdFromKeys(a.publicKey)).equals(e.remotePeer)))throw new CodeError$2("public key did not match remote PeerId","ERR_INVALID_PUBLIC_KEY");let h;if(a.signedPeerRecord!=null){ur(this,Kn).call(this,"received signedPeerRecord in push from %p",e.remotePeer);let et=a.signedPeerRecord;const ft=await RecordEnvelope.openAndCertify(et,PeerRecord.DOMAIN);let gt=PeerRecord.createFromProtobuf(ft.payload);if(!gt.peerId.equals(ft.peerId))throw new CodeError$2("signing key does not match PeerId in the PeerRecord","ERR_INVALID_SIGNING_KEY");if(!e.remotePeer.equals(gt.peerId))throw new CodeError$2("signing key does not match remote PeerId","ERR_INVALID_PEER_RECORD_KEY");let _t;try{_t=await this.peerStore.get(gt.peerId)}catch(wt){if(wt.code!=="ERR_NOT_FOUND")throw wt}if(_t!=null&&(c.metadata=_t.metadata,_t.peerRecordEnvelope!=null)){const wt=await RecordEnvelope.createFromProtobuf(_t.peerRecordEnvelope),$t=PeerRecord.createFromProtobuf(wt.payload);$t.seqNumber>=gt.seqNumber&&(ur(this,Kn).call(this,"sequence number was lower or equal to existing sequence number - stored: %d received: %d",$t.seqNumber,gt.seqNumber),gt=$t,et=_t.peerRecordEnvelope)}c.peerRecordEnvelope=et,c.addresses=gt.multiaddrs.map(wt=>({isCertified:!0,multiaddr:wt})),h={seq:gt.seqNumber,addresses:gt.multiaddrs}}else ur(this,Kn).call(this,"%p did not send a signed peer record",e.remotePeer);if(ur(this,Kn).call(this,"patching %p with",e.remotePeer,c),await this.peerStore.patch(e.remotePeer,c),a.agentVersion!=null||a.protocolVersion!=null){const et={};a.agentVersion!=null&&(et.AgentVersion=fromString$9(a.agentVersion)),a.protocolVersion!=null&&(et.ProtocolVersion=fromString$9(a.protocolVersion)),ur(this,Kn).call(this,"merging %p metadata",e.remotePeer,et),await this.peerStore.merge(e.remotePeer,{metadata:et})}const d={peerId:e.remotePeer,protocolVersion:a.protocolVersion,agentVersion:a.agentVersion,publicKey:a.publicKey,listenAddrs:a.listenAddrs.map(et=>multiaddr(et)),observedAddr:a.observedAddr==null?void 0:multiaddr(a.observedAddr),protocols:a.protocols,signedPeerRecord:h,connection:e};return this.events.safeDispatchEvent("peer:identify",{detail:d}),d};function getCleanMultiaddr(i){if(i!=null&&i.length>0)try{return multiaddr(i)}catch{}}function identifyService(i={}){return e=>new DefaultIdentifyService(e,i)}const PING_LENGTH=32,PROTOCOL_VERSION$1="1.0.0",PROTOCOL_NAME="ping",PROTOCOL_PREFIX="ipfs",TIMEOUT=1e4,MAX_INBOUND_STREAMS=2,MAX_OUTBOUND_STREAMS=1,log$1=logger$2("libp2p:ping");class DefaultPingService{constructor(e,a){qt(this,"protocol");qt(this,"components");qt(this,"started");qt(this,"timeout");qt(this,"maxInboundStreams");qt(this,"maxOutboundStreams");qt(this,"runOnTransientConnection");this.components=e,this.started=!1,this.protocol=`/${a.protocolPrefix??PROTOCOL_PREFIX}/${PROTOCOL_NAME}/${PROTOCOL_VERSION$1}`,this.timeout=a.timeout??TIMEOUT,this.maxInboundStreams=a.maxInboundStreams??MAX_INBOUND_STREAMS,this.maxOutboundStreams=a.maxOutboundStreams??MAX_OUTBOUND_STREAMS,this.runOnTransientConnection=a.runOnTransientConnection??!0}async start(){await this.components.registrar.handle(this.protocol,this.handleMessage,{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnTransientConnection:this.runOnTransientConnection}),this.started=!0}async stop(){await this.components.registrar.unhandle(this.protocol),this.started=!1}isStarted(){return this.started}handleMessage(e){log$1("incoming ping from %p",e.connection.remotePeer);const{stream:a}=e,c=Date.now();pipe(a,a).catch(h=>{log$1.error("incoming ping from %p failed with error",e.connection.remotePeer,h)}).finally(()=>{const h=Date.now()-c;log$1("incoming ping from %p complete in %dms",e.connection.remotePeer,h)})}async ping(e,a={}){var gt,_t;log$1("pinging %p",e);const c=Date.now(),h=randomBytes(PING_LENGTH),d=await this.components.connectionManager.openConnection(e,a);let et,ft=()=>{};if(a.signal==null){const wt=AbortSignal.timeout(this.timeout);a={...a,signal:wt}}try{et=await d.newStream(this.protocol,{...a,runOnTransientConnection:this.runOnTransientConnection}),ft=()=>{et==null||et.abort(new CodeError$2("ping timeout",codes.ERR_TIMEOUT))},(gt=a.signal)==null||gt.addEventListener("abort",ft,{once:!0});const wt=await pipe([h],et,async It=>first(It)),$t=Date.now()-c;if(wt==null)throw new CodeError$2(`Did not receive a ping ack after ${$t}ms`,codes.ERR_WRONG_PING_ACK);if(!equals$1(h,wt.subarray()))throw new CodeError$2(`Received wrong ping ack after ${$t}ms`,codes.ERR_WRONG_PING_ACK);return log$1("ping %p complete in %dms",d.remotePeer,$t),$t}catch(wt){throw log$1.error("error while pinging %p",d.remotePeer,wt),et==null||et.abort(wt),wt}finally{(_t=a.signal)==null||_t.removeEventListener("abort",ft),et!=null&&await et.close()}}}function pingService(i={}){return e=>new DefaultPingService(e,i)}const DEFAULT_NODE_REQUIREMENTS={lightPush:1,filter:1,store:1},ensureShardingConfigured=i=>{if("shards"in i&&i.shards.length<1||"contentTopics"in i&&i.contentTopics.length<1)throw new Error("Missing required configuration options for static sharding or autosharding.")};async function createLightNode(i){i=i??{},i.shardInfo&&ensureShardingConfigured(i.shardInfo);const e=(i==null?void 0:i.libp2p)??{},a=e.peerDiscovery??[];i!=null&&i.defaultBootstrap&&(a.push(...defaultPeerDiscoveries()),Object.assign(e,{peerDiscovery:a}));const c=await defaultLibp2p(i.shardInfo,wakuGossipSub(i),e,i==null?void 0:i.userAgent),h=wakuStore(i),d=wakuLightPush(i),et=wakuFilter(i);return new WakuNode(i??{},i.pubsubTopics,c,i.shardInfo,h,d,et)}function defaultPeerDiscoveries(){return[wakuDnsDiscovery([enrTree.PROD],DEFAULT_NODE_REQUIREMENTS),wakuPeerExchangeDiscovery()]}async function defaultLibp2p(i,e,a,c){a!=null&&a.hideWebSocketInfo,console.info("%cIgnore WebSocket connection failures","background: gray; color: white; font-size: x-large"),console.info("%cWaku tries to discover peers and some of them are expected to fail","background: gray; color: white; font-size: x-large");const h=e?{pubsub:e}:{},d=i?{metadata:wakuMetadata(i)}:{};return createLibp2p({connectionManager:{minConnections:1},transports:[webSockets({filter:all})],streamMuxers:[mplex()],connectionEncryption:[noise()],...a,services:{identify:identifyService({agentVersion:c??DefaultUserAgent}),ping:pingService(),...d,...h,...a==null?void 0:a.services}})}const occupiedRooms$1={},announceMs=3333,init$1=i=>nodeP||(nodeP=createLightNode({defaultBootstrap:!0,...i.libp2pConfig?{libp2p:i.libp2pConfig}:{libp2p:{hideWebSocketInfo:!0}}}).then(async e=>(await e.start(),await waitForRemotePeer(e,[Protocols$1.LightPush,Protocols$1.Filter]),e)));let nodeP;const joinRoom$2=initGuard(occupiedRooms$1,(i,e)=>{const a=`${libName.toLowerCase()}/${i.appId}/${e}`,c=`${a}/${selfId}`,h={},d={},et={},ft=i.password&&genKey(i.password,e),gt=createEncoder({contentTopic:a,ephemeral:!0}),_t=createDecoder(a),wt=createDecoder(c),$t=(Nt,Ft)=>{Tt(Nt,Ft),et[Ft]=Nt},It=Nt=>{delete h[Nt],delete d[Nt],delete et[Nt]},Rt=Nt=>createEncoder({contentTopic:`${a}/${Nt}`,ephemeral:!0});let Tt=noOp,At,kt,xt;return init$1(i).then(async Nt=>{[At,kt]=await Promise.all([Nt.filter.createSubscription(),Nt.filter.createSubscription()]),await Promise.all([At.subscribe([_t],jt=>{if(!jt.payload)return;const Gt=decodeBytes(jt.payload);if(Gt===selfId||et[Gt]||d[Gt])return;d[Gt]=!0;const Kt=h[Gt]=initPeer(!0,!1,i.rtcConfig);Kt.once(events$1.signal,async Wt=>{Nt.lightPush.send(Rt(Gt),{payload:encodeBytes(JSON.stringify({peerId:selfId,offer:ft?{...Wt,sdp:await encrypt$2(ft,Wt.sdp)}:Wt}))}),setTimeout(()=>{et[Gt]||(delete d[Gt],Kt.destroy())},announceMs*2)}),Kt.once(events$1.connect,()=>$t(Kt,Gt)),Kt.once(events$1.close,()=>It(Gt))}),kt.subscribe([wt],async jt=>{let Gt;try{Gt=JSON.parse(decodeBytes(jt.payload))}catch{console.error(`${libName}: received malformed JSON`);return}const{peerId:Kt,offer:Wt,answer:Zt}=Gt;if(h[Kt]&&Zt){h[Kt].signal(ft?{...Zt,sdp:await decrypt$2(ft,Zt.sdp)}:Zt);return}const cr=initPeer(!1,!1,i.rtcConfig);cr.once(events$1.signal,async hr=>Nt.lightPush.send(Rt(Kt),{payload:encodeBytes(JSON.stringify({peerId:selfId,answer:ft?{...hr,sdp:await encrypt$2(ft,hr.sdp)}:hr}))})),cr.once(events$1.connect,()=>$t(cr,Kt)),cr.once(events$1.close,()=>It(Kt)),cr.signal(ft?{...Wt,sdp:await decrypt$2(ft,Wt.sdp)}:Wt)})]);const Ft=()=>Nt.lightPush.send(gt,{payload:encodeBytes(selfId)});xt=setInterval(Ft,announceMs),Ft()}),room(Nt=>Tt=Nt,()=>{clearInterval(xt),At.unsubscribe(),kt.unsubscribe(),delete occupiedRooms$1[e]})});var define_process_env_default$1={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CONSTANTS={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const assert=function(i,e){if(!i)throw assertionError(e)},assertionError=function(i){return new Error("Firebase Database ("+CONSTANTS.SDK_VERSION+") INTERNAL ASSERT FAILED: "+i)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const stringToByteArray$1=function(i){const e=[];let a=0;for(let c=0;c<i.length;c++){let h=i.charCodeAt(c);h<128?e[a++]=h:h<2048?(e[a++]=h>>6|192,e[a++]=h&63|128):(h&64512)===55296&&c+1<i.length&&(i.charCodeAt(c+1)&64512)===56320?(h=65536+((h&1023)<<10)+(i.charCodeAt(++c)&1023),e[a++]=h>>18|240,e[a++]=h>>12&63|128,e[a++]=h>>6&63|128,e[a++]=h&63|128):(e[a++]=h>>12|224,e[a++]=h>>6&63|128,e[a++]=h&63|128)}return e},byteArrayToString=function(i){const e=[];let a=0,c=0;for(;a<i.length;){const h=i[a++];if(h<128)e[c++]=String.fromCharCode(h);else if(h>191&&h<224){const d=i[a++];e[c++]=String.fromCharCode((h&31)<<6|d&63)}else if(h>239&&h<365){const d=i[a++],et=i[a++],ft=i[a++],gt=((h&7)<<18|(d&63)<<12|(et&63)<<6|ft&63)-65536;e[c++]=String.fromCharCode(55296+(gt>>10)),e[c++]=String.fromCharCode(56320+(gt&1023))}else{const d=i[a++],et=i[a++];e[c++]=String.fromCharCode((h&15)<<12|(d&63)<<6|et&63)}}return e.join("")},base64={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(i,e){if(!Array.isArray(i))throw Error("encodeByteArray takes an array as a parameter");this.init_();const a=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,c=[];for(let h=0;h<i.length;h+=3){const d=i[h],et=h+1<i.length,ft=et?i[h+1]:0,gt=h+2<i.length,_t=gt?i[h+2]:0,wt=d>>2,$t=(d&3)<<4|ft>>4;let It=(ft&15)<<2|_t>>6,Rt=_t&63;gt||(Rt=64,et||(It=64)),c.push(a[wt],a[$t],a[It],a[Rt])}return c.join("")},encodeString(i,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(i):this.encodeByteArray(stringToByteArray$1(i),e)},decodeString(i,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(i):byteArrayToString(this.decodeStringToByteArray(i,e))},decodeStringToByteArray(i,e){this.init_();const a=e?this.charToByteMapWebSafe_:this.charToByteMap_,c=[];for(let h=0;h<i.length;){const d=a[i.charAt(h++)],ft=h<i.length?a[i.charAt(h)]:0;++h;const _t=h<i.length?a[i.charAt(h)]:64;++h;const $t=h<i.length?a[i.charAt(h)]:64;if(++h,d==null||ft==null||_t==null||$t==null)throw new DecodeBase64StringError;const It=d<<2|ft>>4;if(c.push(It),_t!==64){const Rt=ft<<4&240|_t>>2;if(c.push(Rt),$t!==64){const Tt=_t<<6&192|$t;c.push(Tt)}}}return c},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let i=0;i<this.ENCODED_VALS.length;i++)this.byteToCharMap_[i]=this.ENCODED_VALS.charAt(i),this.charToByteMap_[this.byteToCharMap_[i]]=i,this.byteToCharMapWebSafe_[i]=this.ENCODED_VALS_WEBSAFE.charAt(i),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[i]]=i,i>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(i)]=i,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(i)]=i)}}};class DecodeBase64StringError extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const base64Encode=function(i){const e=stringToByteArray$1(i);return base64.encodeByteArray(e,!0)},base64urlEncodeWithoutPadding=function(i){return base64Encode(i).replace(/\./g,"")},base64Decode=function(i){try{return base64.decodeString(i,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function deepCopy(i){return deepExtend(void 0,i)}function deepExtend(i,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const a=e;return new Date(a.getTime());case Object:i===void 0&&(i={});break;case Array:i=[];break;default:return e}for(const a in e)!e.hasOwnProperty(a)||!isValidKey$1(a)||(i[a]=deepExtend(i[a],e[a]));return i}function isValidKey$1(i){return i!=="__proto__"}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function getGlobal(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const getDefaultsFromGlobal=()=>getGlobal().__FIREBASE_DEFAULTS__,getDefaultsFromEnvVariable=()=>{if(typeof process>"u"||typeof define_process_env_default$1>"u")return;const i=define_process_env_default$1.__FIREBASE_DEFAULTS__;if(i)return JSON.parse(i)},getDefaultsFromCookie=()=>{if(typeof document>"u")return;let i;try{i=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=i&&base64Decode(i[1]);return e&&JSON.parse(e)},getDefaults=()=>{try{return getDefaultsFromGlobal()||getDefaultsFromEnvVariable()||getDefaultsFromCookie()}catch(i){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${i}`);return}},getDefaultEmulatorHost=i=>{var e,a;return(a=(e=getDefaults())===null||e===void 0?void 0:e.emulatorHosts)===null||a===void 0?void 0:a[i]},getDefaultEmulatorHostnameAndPort=i=>{const e=getDefaultEmulatorHost(i);if(!e)return;const a=e.lastIndexOf(":");if(a<=0||a+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const c=parseInt(e.substring(a+1),10);return e[0]==="["?[e.substring(1,a-1),c]:[e.substring(0,a),c]},getDefaultAppConfig=()=>{var i;return(i=getDefaults())===null||i===void 0?void 0:i.config};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Deferred{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,a)=>{this.resolve=e,this.reject=a})}wrapCallback(e){return(a,c)=>{a?this.reject(a):this.resolve(c),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(a):e(a,c))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function createMockUserToken(i,e){if(i.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const a={alg:"none",type:"JWT"},c=e||"demo-project",h=i.iat||0,d=i.sub||i.user_id;if(!d)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const et=Object.assign({iss:`https://securetoken.google.com/${c}`,aud:c,iat:h,exp:h+3600,auth_time:h,sub:d,user_id:d,firebase:{sign_in_provider:"custom",identities:{}}},i);return[base64urlEncodeWithoutPadding(JSON.stringify(a)),base64urlEncodeWithoutPadding(JSON.stringify(et)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function getUA(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function isMobileCordova(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(getUA())}function isReactNative(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function isNodeSdk(){return CONSTANTS.NODE_ADMIN===!0}function isIndexedDBAvailable(){try{return typeof indexedDB=="object"}catch{return!1}}function validateIndexedDBOpenable(){return new Promise((i,e)=>{try{let a=!0;const c="validate-browser-context-for-indexeddb-analytics-module",h=self.indexedDB.open(c);h.onsuccess=()=>{h.result.close(),a||self.indexedDB.deleteDatabase(c),i(!0)},h.onupgradeneeded=()=>{a=!1},h.onerror=()=>{var d;e(((d=h.error)===null||d===void 0?void 0:d.message)||"")}}catch(a){e(a)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ERROR_NAME="FirebaseError";class FirebaseError extends Error{constructor(e,a,c){super(a),this.code=e,this.customData=c,this.name=ERROR_NAME,Object.setPrototypeOf(this,FirebaseError.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ErrorFactory.prototype.create)}}class ErrorFactory{constructor(e,a,c){this.service=e,this.serviceName=a,this.errors=c}create(e,...a){const c=a[0]||{},h=`${this.service}/${e}`,d=this.errors[e],et=d?replaceTemplate(d,c):"Error",ft=`${this.serviceName}: ${et} (${h}).`;return new FirebaseError(h,ft,c)}}function replaceTemplate(i,e){return i.replace(PATTERN,(a,c)=>{const h=e[c];return h!=null?String(h):`<${c}?>`})}const PATTERN=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jsonEval(i){return JSON.parse(i)}function stringify(i){return JSON.stringify(i)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const decode=function(i){let e={},a={},c={},h="";try{const d=i.split(".");e=jsonEval(base64Decode(d[0])||""),a=jsonEval(base64Decode(d[1])||""),h=d[2],c=a.d||{},delete a.d}catch{}return{header:e,claims:a,data:c,signature:h}},isValidFormat=function(i){const e=decode(i),a=e.claims;return!!a&&typeof a=="object"&&a.hasOwnProperty("iat")},isAdmin=function(i){const e=decode(i).claims;return typeof e=="object"&&e.admin===!0};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function contains(i,e){return Object.prototype.hasOwnProperty.call(i,e)}function safeGet(i,e){if(Object.prototype.hasOwnProperty.call(i,e))return i[e]}function isEmpty(i){for(const e in i)if(Object.prototype.hasOwnProperty.call(i,e))return!1;return!0}function map(i,e,a){const c={};for(const h in i)Object.prototype.hasOwnProperty.call(i,h)&&(c[h]=e.call(a,i[h],h,i));return c}function deepEqual(i,e){if(i===e)return!0;const a=Object.keys(i),c=Object.keys(e);for(const h of a){if(!c.includes(h))return!1;const d=i[h],et=e[h];if(isObject(d)&&isObject(et)){if(!deepEqual(d,et))return!1}else if(d!==et)return!1}for(const h of c)if(!a.includes(h))return!1;return!0}function isObject(i){return i!==null&&typeof i=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function querystring(i){const e=[];for(const[a,c]of Object.entries(i))Array.isArray(c)?c.forEach(h=>{e.push(encodeURIComponent(a)+"="+encodeURIComponent(h))}):e.push(encodeURIComponent(a)+"="+encodeURIComponent(c));return e.length?"&"+e.join("&"):""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sha1{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,a){a||(a=0);const c=this.W_;if(typeof e=="string")for(let $t=0;$t<16;$t++)c[$t]=e.charCodeAt(a)<<24|e.charCodeAt(a+1)<<16|e.charCodeAt(a+2)<<8|e.charCodeAt(a+3),a+=4;else for(let $t=0;$t<16;$t++)c[$t]=e[a]<<24|e[a+1]<<16|e[a+2]<<8|e[a+3],a+=4;for(let $t=16;$t<80;$t++){const It=c[$t-3]^c[$t-8]^c[$t-14]^c[$t-16];c[$t]=(It<<1|It>>>31)&4294967295}let h=this.chain_[0],d=this.chain_[1],et=this.chain_[2],ft=this.chain_[3],gt=this.chain_[4],_t,wt;for(let $t=0;$t<80;$t++){$t<40?$t<20?(_t=ft^d&(et^ft),wt=1518500249):(_t=d^et^ft,wt=1859775393):$t<60?(_t=d&et|ft&(d|et),wt=2400959708):(_t=d^et^ft,wt=3395469782);const It=(h<<5|h>>>27)+_t+gt+wt+c[$t]&4294967295;gt=ft,ft=et,et=(d<<30|d>>>2)&4294967295,d=h,h=It}this.chain_[0]=this.chain_[0]+h&4294967295,this.chain_[1]=this.chain_[1]+d&4294967295,this.chain_[2]=this.chain_[2]+et&4294967295,this.chain_[3]=this.chain_[3]+ft&4294967295,this.chain_[4]=this.chain_[4]+gt&4294967295}update(e,a){if(e==null)return;a===void 0&&(a=e.length);const c=a-this.blockSize;let h=0;const d=this.buf_;let et=this.inbuf_;for(;h<a;){if(et===0)for(;h<=c;)this.compress_(e,h),h+=this.blockSize;if(typeof e=="string"){for(;h<a;)if(d[et]=e.charCodeAt(h),++et,++h,et===this.blockSize){this.compress_(d),et=0;break}}else for(;h<a;)if(d[et]=e[h],++et,++h,et===this.blockSize){this.compress_(d),et=0;break}}this.inbuf_=et,this.total_+=a}digest(){const e=[];let a=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let h=this.blockSize-1;h>=56;h--)this.buf_[h]=a&255,a/=256;this.compress_(this.buf_);let c=0;for(let h=0;h<5;h++)for(let d=24;d>=0;d-=8)e[c]=this.chain_[h]>>d&255,++c;return e}}function errorPrefix(i,e){return`${i} failed: ${e} argument `}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const stringToByteArray=function(i){const e=[];let a=0;for(let c=0;c<i.length;c++){let h=i.charCodeAt(c);if(h>=55296&&h<=56319){const d=h-55296;c++,assert(c<i.length,"Surrogate pair missing trail surrogate.");const et=i.charCodeAt(c)-56320;h=65536+(d<<10)+et}h<128?e[a++]=h:h<2048?(e[a++]=h>>6|192,e[a++]=h&63|128):h<65536?(e[a++]=h>>12|224,e[a++]=h>>6&63|128,e[a++]=h&63|128):(e[a++]=h>>18|240,e[a++]=h>>12&63|128,e[a++]=h>>6&63|128,e[a++]=h&63|128)}return e},stringLength=function(i){let e=0;for(let a=0;a<i.length;a++){const c=i.charCodeAt(a);c<128?e++:c<2048?e+=2:c>=55296&&c<=56319?(e+=4,a++):e+=3}return e};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function getModularInstance(i){return i&&i._delegate?i._delegate:i}class Component{constructor(e,a,c){this.name=e,this.instanceFactory=a,this.type=c,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DEFAULT_ENTRY_NAME$1="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Provider{constructor(e,a){this.name=e,this.container=a,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const a=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(a)){const c=new Deferred;if(this.instancesDeferred.set(a,c),this.isInitialized(a)||this.shouldAutoInitialize())try{const h=this.getOrInitializeService({instanceIdentifier:a});h&&c.resolve(h)}catch{}}return this.instancesDeferred.get(a).promise}getImmediate(e){var a;const c=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),h=(a=e==null?void 0:e.optional)!==null&&a!==void 0?a:!1;if(this.isInitialized(c)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:c})}catch(d){if(h)return null;throw d}else{if(h)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(isComponentEager(e))try{this.getOrInitializeService({instanceIdentifier:DEFAULT_ENTRY_NAME$1})}catch{}for(const[a,c]of this.instancesDeferred.entries()){const h=this.normalizeInstanceIdentifier(a);try{const d=this.getOrInitializeService({instanceIdentifier:h});c.resolve(d)}catch{}}}}clearInstance(e=DEFAULT_ENTRY_NAME$1){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(a=>"INTERNAL"in a).map(a=>a.INTERNAL.delete()),...e.filter(a=>"_delete"in a).map(a=>a._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=DEFAULT_ENTRY_NAME$1){return this.instances.has(e)}getOptions(e=DEFAULT_ENTRY_NAME$1){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:a={}}=e,c=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(c))throw Error(`${this.name}(${c}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const h=this.getOrInitializeService({instanceIdentifier:c,options:a});for(const[d,et]of this.instancesDeferred.entries()){const ft=this.normalizeInstanceIdentifier(d);c===ft&&et.resolve(h)}return h}onInit(e,a){var c;const h=this.normalizeInstanceIdentifier(a),d=(c=this.onInitCallbacks.get(h))!==null&&c!==void 0?c:new Set;d.add(e),this.onInitCallbacks.set(h,d);const et=this.instances.get(h);return et&&e(et,h),()=>{d.delete(e)}}invokeOnInitCallbacks(e,a){const c=this.onInitCallbacks.get(a);if(c)for(const h of c)try{h(e,a)}catch{}}getOrInitializeService({instanceIdentifier:e,options:a={}}){let c=this.instances.get(e);if(!c&&this.component&&(c=this.component.instanceFactory(this.container,{instanceIdentifier:normalizeIdentifierForFactory(e),options:a}),this.instances.set(e,c),this.instancesOptions.set(e,a),this.invokeOnInitCallbacks(c,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,c)}catch{}return c||null}normalizeInstanceIdentifier(e=DEFAULT_ENTRY_NAME$1){return this.component?this.component.multipleInstances?e:DEFAULT_ENTRY_NAME$1:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function normalizeIdentifierForFactory(i){return i===DEFAULT_ENTRY_NAME$1?void 0:i}function isComponentEager(i){return i.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ComponentContainer{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const a=this.getProvider(e.name);if(a.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);a.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const a=new Provider(e,this);return this.providers.set(e,a),a}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var LogLevel;(function(i){i[i.DEBUG=0]="DEBUG",i[i.VERBOSE=1]="VERBOSE",i[i.INFO=2]="INFO",i[i.WARN=3]="WARN",i[i.ERROR=4]="ERROR",i[i.SILENT=5]="SILENT"})(LogLevel||(LogLevel={}));const levelStringToEnum={debug:LogLevel.DEBUG,verbose:LogLevel.VERBOSE,info:LogLevel.INFO,warn:LogLevel.WARN,error:LogLevel.ERROR,silent:LogLevel.SILENT},defaultLogLevel=LogLevel.INFO,ConsoleMethod={[LogLevel.DEBUG]:"log",[LogLevel.VERBOSE]:"log",[LogLevel.INFO]:"info",[LogLevel.WARN]:"warn",[LogLevel.ERROR]:"error"},defaultLogHandler=(i,e,...a)=>{if(e<i.logLevel)return;const c=new Date().toISOString(),h=ConsoleMethod[e];if(h)console[h](`[${c}]  ${i.name}:`,...a);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Logger{constructor(e){this.name=e,this._logLevel=defaultLogLevel,this._logHandler=defaultLogHandler,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in LogLevel))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?levelStringToEnum[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,LogLevel.DEBUG,...e),this._logHandler(this,LogLevel.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,LogLevel.VERBOSE,...e),this._logHandler(this,LogLevel.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,LogLevel.INFO,...e),this._logHandler(this,LogLevel.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,LogLevel.WARN,...e),this._logHandler(this,LogLevel.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,LogLevel.ERROR,...e),this._logHandler(this,LogLevel.ERROR,...e)}}const instanceOfAny=(i,e)=>e.some(a=>i instanceof a);let idbProxyableTypes,cursorAdvanceMethods;function getIdbProxyableTypes(){return idbProxyableTypes||(idbProxyableTypes=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function getCursorAdvanceMethods(){return cursorAdvanceMethods||(cursorAdvanceMethods=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const cursorRequestMap=new WeakMap,transactionDoneMap=new WeakMap,transactionStoreNamesMap=new WeakMap,transformCache=new WeakMap,reverseTransformCache=new WeakMap;function promisifyRequest(i){const e=new Promise((a,c)=>{const h=()=>{i.removeEventListener("success",d),i.removeEventListener("error",et)},d=()=>{a(wrap(i.result)),h()},et=()=>{c(i.error),h()};i.addEventListener("success",d),i.addEventListener("error",et)});return e.then(a=>{a instanceof IDBCursor&&cursorRequestMap.set(a,i)}).catch(()=>{}),reverseTransformCache.set(e,i),e}function cacheDonePromiseForTransaction(i){if(transactionDoneMap.has(i))return;const e=new Promise((a,c)=>{const h=()=>{i.removeEventListener("complete",d),i.removeEventListener("error",et),i.removeEventListener("abort",et)},d=()=>{a(),h()},et=()=>{c(i.error||new DOMException("AbortError","AbortError")),h()};i.addEventListener("complete",d),i.addEventListener("error",et),i.addEventListener("abort",et)});transactionDoneMap.set(i,e)}let idbProxyTraps={get(i,e,a){if(i instanceof IDBTransaction){if(e==="done")return transactionDoneMap.get(i);if(e==="objectStoreNames")return i.objectStoreNames||transactionStoreNamesMap.get(i);if(e==="store")return a.objectStoreNames[1]?void 0:a.objectStore(a.objectStoreNames[0])}return wrap(i[e])},set(i,e,a){return i[e]=a,!0},has(i,e){return i instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in i}};function replaceTraps(i){idbProxyTraps=i(idbProxyTraps)}function wrapFunction(i){return i===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...a){const c=i.call(unwrap(this),e,...a);return transactionStoreNamesMap.set(c,e.sort?e.sort():[e]),wrap(c)}:getCursorAdvanceMethods().includes(i)?function(...e){return i.apply(unwrap(this),e),wrap(cursorRequestMap.get(this))}:function(...e){return wrap(i.apply(unwrap(this),e))}}function transformCachableValue(i){return typeof i=="function"?wrapFunction(i):(i instanceof IDBTransaction&&cacheDonePromiseForTransaction(i),instanceOfAny(i,getIdbProxyableTypes())?new Proxy(i,idbProxyTraps):i)}function wrap(i){if(i instanceof IDBRequest)return promisifyRequest(i);if(transformCache.has(i))return transformCache.get(i);const e=transformCachableValue(i);return e!==i&&(transformCache.set(i,e),reverseTransformCache.set(e,i)),e}const unwrap=i=>reverseTransformCache.get(i);function openDB(i,e,{blocked:a,upgrade:c,blocking:h,terminated:d}={}){const et=indexedDB.open(i,e),ft=wrap(et);return c&&et.addEventListener("upgradeneeded",gt=>{c(wrap(et.result),gt.oldVersion,gt.newVersion,wrap(et.transaction),gt)}),a&&et.addEventListener("blocked",gt=>a(gt.oldVersion,gt.newVersion,gt)),ft.then(gt=>{d&&gt.addEventListener("close",()=>d()),h&&gt.addEventListener("versionchange",_t=>h(_t.oldVersion,_t.newVersion,_t))}).catch(()=>{}),ft}const readMethods=["get","getKey","getAll","getAllKeys","count"],writeMethods=["put","add","delete","clear"],cachedMethods=new Map;function getMethod(i,e){if(!(i instanceof IDBDatabase&&!(e in i)&&typeof e=="string"))return;if(cachedMethods.get(e))return cachedMethods.get(e);const a=e.replace(/FromIndex$/,""),c=e!==a,h=writeMethods.includes(a);if(!(a in(c?IDBIndex:IDBObjectStore).prototype)||!(h||readMethods.includes(a)))return;const d=async function(et,...ft){const gt=this.transaction(et,h?"readwrite":"readonly");let _t=gt.store;return c&&(_t=_t.index(ft.shift())),(await Promise.all([_t[a](...ft),h&&gt.done]))[0]};return cachedMethods.set(e,d),d}replaceTraps(i=>({...i,get:(e,a,c)=>getMethod(e,a)||i.get(e,a,c),has:(e,a)=>!!getMethod(e,a)||i.has(e,a)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PlatformLoggerServiceImpl{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(a=>{if(isVersionServiceProvider(a)){const c=a.getImmediate();return`${c.library}/${c.version}`}else return null}).filter(a=>a).join(" ")}}function isVersionServiceProvider(i){const e=i.getComponent();return(e==null?void 0:e.type)==="VERSION"}const name$o="@firebase/app",version$1$1="0.10.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const logger$1=new Logger("@firebase/app"),name$n="@firebase/app-compat",name$m="@firebase/analytics-compat",name$l="@firebase/analytics",name$k="@firebase/app-check-compat",name$j="@firebase/app-check",name$i="@firebase/auth",name$h="@firebase/auth-compat",name$g="@firebase/database",name$f="@firebase/database-compat",name$e="@firebase/functions",name$d="@firebase/functions-compat",name$c="@firebase/installations",name$b="@firebase/installations-compat",name$a="@firebase/messaging",name$9="@firebase/messaging-compat",name$8="@firebase/performance",name$7="@firebase/performance-compat",name$6="@firebase/remote-config",name$5="@firebase/remote-config-compat",name$4="@firebase/storage",name$3="@firebase/storage-compat",name$2$1="@firebase/firestore",name$1$1="@firebase/firestore-compat",name$p="firebase",version$2="10.10.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DEFAULT_ENTRY_NAME="[DEFAULT]",PLATFORM_LOG_STRING={[name$o]:"fire-core",[name$n]:"fire-core-compat",[name$l]:"fire-analytics",[name$m]:"fire-analytics-compat",[name$j]:"fire-app-check",[name$k]:"fire-app-check-compat",[name$i]:"fire-auth",[name$h]:"fire-auth-compat",[name$g]:"fire-rtdb",[name$f]:"fire-rtdb-compat",[name$e]:"fire-fn",[name$d]:"fire-fn-compat",[name$c]:"fire-iid",[name$b]:"fire-iid-compat",[name$a]:"fire-fcm",[name$9]:"fire-fcm-compat",[name$8]:"fire-perf",[name$7]:"fire-perf-compat",[name$6]:"fire-rc",[name$5]:"fire-rc-compat",[name$4]:"fire-gcs",[name$3]:"fire-gcs-compat",[name$2$1]:"fire-fst",[name$1$1]:"fire-fst-compat","fire-js":"fire-js",[name$p]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _apps=new Map,_serverApps=new Map,_components=new Map;function _addComponent(i,e){try{i.container.addComponent(e)}catch(a){logger$1.debug(`Component ${e.name} failed to register with FirebaseApp ${i.name}`,a)}}function _registerComponent(i){const e=i.name;if(_components.has(e))return logger$1.debug(`There were multiple attempts to register component ${e}.`),!1;_components.set(e,i);for(const a of _apps.values())_addComponent(a,i);for(const a of _serverApps.values())_addComponent(a,i);return!0}function _getProvider(i,e){const a=i.container.getProvider("heartbeat").getImmediate({optional:!0});return a&&a.triggerHeartbeat(),i.container.getProvider(e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ERRORS={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},ERROR_FACTORY=new ErrorFactory("app","Firebase",ERRORS);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FirebaseAppImpl{constructor(e,a,c){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},a),this._name=a.name,this._automaticDataCollectionEnabled=a.automaticDataCollectionEnabled,this._container=c,this.container.addComponent(new Component("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw ERROR_FACTORY.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SDK_VERSION$1=version$2;function initializeApp(i,e={}){let a=i;typeof e!="object"&&(e={name:e});const c=Object.assign({name:DEFAULT_ENTRY_NAME,automaticDataCollectionEnabled:!1},e),h=c.name;if(typeof h!="string"||!h)throw ERROR_FACTORY.create("bad-app-name",{appName:String(h)});if(a||(a=getDefaultAppConfig()),!a)throw ERROR_FACTORY.create("no-options");const d=_apps.get(h);if(d){if(deepEqual(a,d.options)&&deepEqual(c,d.config))return d;throw ERROR_FACTORY.create("duplicate-app",{appName:h})}const et=new ComponentContainer(h);for(const gt of _components.values())et.addComponent(gt);const ft=new FirebaseAppImpl(a,c,et);return _apps.set(h,ft),ft}function getApp(i=DEFAULT_ENTRY_NAME){const e=_apps.get(i);if(!e&&i===DEFAULT_ENTRY_NAME&&getDefaultAppConfig())return initializeApp();if(!e)throw ERROR_FACTORY.create("no-app",{appName:i});return e}function registerVersion(i,e,a){var c;let h=(c=PLATFORM_LOG_STRING[i])!==null&&c!==void 0?c:i;a&&(h+=`-${a}`);const d=h.match(/\s|\//),et=e.match(/\s|\//);if(d||et){const ft=[`Unable to register library "${h}" with version "${e}":`];d&&ft.push(`library name "${h}" contains illegal characters (whitespace or "/")`),d&&et&&ft.push("and"),et&&ft.push(`version name "${e}" contains illegal characters (whitespace or "/")`),logger$1.warn(ft.join(" "));return}_registerComponent(new Component(`${h}-version`,()=>({library:h,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DB_NAME="firebase-heartbeat-database",DB_VERSION=1,STORE_NAME="firebase-heartbeat-store";let dbPromise=null;function getDbPromise(){return dbPromise||(dbPromise=openDB(DB_NAME,DB_VERSION,{upgrade:(i,e)=>{switch(e){case 0:try{i.createObjectStore(STORE_NAME)}catch(a){console.warn(a)}}}}).catch(i=>{throw ERROR_FACTORY.create("idb-open",{originalErrorMessage:i.message})})),dbPromise}async function readHeartbeatsFromIndexedDB(i){try{const a=(await getDbPromise()).transaction(STORE_NAME),c=await a.objectStore(STORE_NAME).get(computeKey(i));return await a.done,c}catch(e){if(e instanceof FirebaseError)logger$1.warn(e.message);else{const a=ERROR_FACTORY.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});logger$1.warn(a.message)}}}async function writeHeartbeatsToIndexedDB(i,e){try{const c=(await getDbPromise()).transaction(STORE_NAME,"readwrite");await c.objectStore(STORE_NAME).put(e,computeKey(i)),await c.done}catch(a){if(a instanceof FirebaseError)logger$1.warn(a.message);else{const c=ERROR_FACTORY.create("idb-set",{originalErrorMessage:a==null?void 0:a.message});logger$1.warn(c.message)}}}function computeKey(i){return`${i.name}!${i.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MAX_HEADER_BYTES=1024,STORED_HEARTBEAT_RETENTION_MAX_MILLIS=30*24*60*60*1e3;class HeartbeatServiceImpl{constructor(e){this.container=e,this._heartbeatsCache=null;const a=this.container.getProvider("app").getImmediate();this._storage=new HeartbeatStorageImpl(a),this._heartbeatsCachePromise=this._storage.read().then(c=>(this._heartbeatsCache=c,c))}async triggerHeartbeat(){var e,a;const h=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),d=getUTCDateString();if(!(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((a=this._heartbeatsCache)===null||a===void 0?void 0:a.heartbeats)==null))&&!(this._heartbeatsCache.lastSentHeartbeatDate===d||this._heartbeatsCache.heartbeats.some(et=>et.date===d)))return this._heartbeatsCache.heartbeats.push({date:d,agent:h}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(et=>{const ft=new Date(et.date).valueOf();return Date.now()-ft<=STORED_HEARTBEAT_RETENTION_MAX_MILLIS}),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){var e;if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const a=getUTCDateString(),{heartbeatsToSend:c,unsentEntries:h}=extractHeartbeatsForHeader(this._heartbeatsCache.heartbeats),d=base64urlEncodeWithoutPadding(JSON.stringify({version:2,heartbeats:c}));return this._heartbeatsCache.lastSentHeartbeatDate=a,h.length>0?(this._heartbeatsCache.heartbeats=h,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),d}}function getUTCDateString(){return new Date().toISOString().substring(0,10)}function extractHeartbeatsForHeader(i,e=MAX_HEADER_BYTES){const a=[];let c=i.slice();for(const h of i){const d=a.find(et=>et.agent===h.agent);if(d){if(d.dates.push(h.date),countBytes(a)>e){d.dates.pop();break}}else if(a.push({agent:h.agent,dates:[h.date]}),countBytes(a)>e){a.pop();break}c=c.slice(1)}return{heartbeatsToSend:a,unsentEntries:c}}class HeartbeatStorageImpl{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return isIndexedDBAvailable()?validateIndexedDBOpenable().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const a=await readHeartbeatsFromIndexedDB(this.app);return a!=null&&a.heartbeats?a:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var a;if(await this._canUseIndexedDBPromise){const h=await this.read();return writeHeartbeatsToIndexedDB(this.app,{lastSentHeartbeatDate:(a=e.lastSentHeartbeatDate)!==null&&a!==void 0?a:h.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var a;if(await this._canUseIndexedDBPromise){const h=await this.read();return writeHeartbeatsToIndexedDB(this.app,{lastSentHeartbeatDate:(a=e.lastSentHeartbeatDate)!==null&&a!==void 0?a:h.lastSentHeartbeatDate,heartbeats:[...h.heartbeats,...e.heartbeats]})}else return}}function countBytes(i){return base64urlEncodeWithoutPadding(JSON.stringify({version:2,heartbeats:i})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function registerCoreComponents(i){_registerComponent(new Component("platform-logger",e=>new PlatformLoggerServiceImpl(e),"PRIVATE")),_registerComponent(new Component("heartbeat",e=>new HeartbeatServiceImpl(e),"PRIVATE")),registerVersion(name$o,version$1$1,i),registerVersion(name$o,version$1$1,"esm2017"),registerVersion("fire-js","")}registerCoreComponents("");var name$2="firebase",version$1="10.10.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */registerVersion(name$2,version$1,"app");var define_process_env_default={};const name$1="@firebase/database",version="1.0.4";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let SDK_VERSION="";function setSDKVersion(i){SDK_VERSION=i}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DOMStorageWrapper{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,a){a==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),stringify(a))}get(e){const a=this.domStorage_.getItem(this.prefixedName_(e));return a==null?null:jsonEval(a)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MemoryStorage{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,a){a==null?delete this.cache_[e]:this.cache_[e]=a}get(e){return contains(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const createStoragefor=function(i){try{if(typeof window<"u"&&typeof window[i]<"u"){const e=window[i];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new DOMStorageWrapper(e)}}catch{}return new MemoryStorage},PersistentStorage=createStoragefor("localStorage"),SessionStorage=createStoragefor("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const logClient=new Logger("@firebase/database"),LUIDGenerator=function(){let i=1;return function(){return i++}}(),sha1=function(i){const e=stringToByteArray(i),a=new Sha1;a.update(e);const c=a.digest();return base64.encodeByteArray(c)},buildLogMessage_=function(...i){let e="";for(let a=0;a<i.length;a++){const c=i[a];Array.isArray(c)||c&&typeof c=="object"&&typeof c.length=="number"?e+=buildLogMessage_.apply(null,c):typeof c=="object"?e+=stringify(c):e+=c,e+=" "}return e};let logger=null,firstLog_=!0;const enableLogging$1=function(i,e){assert(!e||i===!0||i===!1,"Can't turn on custom loggers persistently."),i===!0?(logClient.logLevel=LogLevel.VERBOSE,logger=logClient.log.bind(logClient),e&&SessionStorage.set("logging_enabled",!0)):typeof i=="function"?logger=i:(logger=null,SessionStorage.remove("logging_enabled"))},log=function(...i){if(firstLog_===!0&&(firstLog_=!1,logger===null&&SessionStorage.get("logging_enabled")===!0&&enableLogging$1(!0)),logger){const e=buildLogMessage_.apply(null,i);logger(e)}},logWrapper=function(i){return function(...e){log(i,...e)}},error=function(...i){const e="FIREBASE INTERNAL ERROR: "+buildLogMessage_(...i);logClient.error(e)},fatal=function(...i){const e=`FIREBASE FATAL ERROR: ${buildLogMessage_(...i)}`;throw logClient.error(e),new Error(e)},warn=function(...i){const e="FIREBASE WARNING: "+buildLogMessage_(...i);logClient.warn(e)},warnIfPageIsSecure=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&warn("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},isInvalidJSONNumber=function(i){return typeof i=="number"&&(i!==i||i===Number.POSITIVE_INFINITY||i===Number.NEGATIVE_INFINITY)},executeWhenDOMReady=function(i){if(document.readyState==="complete")i();else{let e=!1;const a=function(){if(!document.body){setTimeout(a,Math.floor(10));return}e||(e=!0,i())};document.addEventListener?(document.addEventListener("DOMContentLoaded",a,!1),window.addEventListener("load",a,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&a()}),window.attachEvent("onload",a))}},MIN_NAME="[MIN_NAME]",MAX_NAME="[MAX_NAME]",nameCompare=function(i,e){if(i===e)return 0;if(i===MIN_NAME||e===MAX_NAME)return-1;if(e===MIN_NAME||i===MAX_NAME)return 1;{const a=tryParseInt(i),c=tryParseInt(e);return a!==null?c!==null?a-c===0?i.length-e.length:a-c:-1:c!==null?1:i<e?-1:1}},stringCompare=function(i,e){return i===e?0:i<e?-1:1},requireKey=function(i,e){if(e&&i in e)return e[i];throw new Error("Missing required key ("+i+") in object: "+stringify(e))},ObjectToUniqueKey=function(i){if(typeof i!="object"||i===null)return stringify(i);const e=[];for(const c in i)e.push(c);e.sort();let a="{";for(let c=0;c<e.length;c++)c!==0&&(a+=","),a+=stringify(e[c]),a+=":",a+=ObjectToUniqueKey(i[e[c]]);return a+="}",a},splitStringBySize=function(i,e){const a=i.length;if(a<=e)return[i];const c=[];for(let h=0;h<a;h+=e)h+e>a?c.push(i.substring(h,a)):c.push(i.substring(h,h+e));return c};function each(i,e){for(const a in i)i.hasOwnProperty(a)&&e(a,i[a])}const doubleToIEEE754String=function(i){assert(!isInvalidJSONNumber(i),"Invalid JSON number");const e=11,a=52,c=(1<<e-1)-1;let h,d,et,ft,gt;i===0?(d=0,et=0,h=1/i===-1/0?1:0):(h=i<0,i=Math.abs(i),i>=Math.pow(2,1-c)?(ft=Math.min(Math.floor(Math.log(i)/Math.LN2),c),d=ft+c,et=Math.round(i*Math.pow(2,a-ft)-Math.pow(2,a))):(d=0,et=Math.round(i/Math.pow(2,1-c-a))));const _t=[];for(gt=a;gt;gt-=1)_t.push(et%2?1:0),et=Math.floor(et/2);for(gt=e;gt;gt-=1)_t.push(d%2?1:0),d=Math.floor(d/2);_t.push(h?1:0),_t.reverse();const wt=_t.join("");let $t="";for(gt=0;gt<64;gt+=8){let It=parseInt(wt.substr(gt,8),2).toString(16);It.length===1&&(It="0"+It),$t=$t+It}return $t.toLowerCase()},isChromeExtensionContentScript=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},isWindowsStoreApp=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function errorForServerCode(i,e){let a="Unknown Error";i==="too_big"?a="The data requested exceeds the maximum size that can be accessed with a single request.":i==="permission_denied"?a="Client doesn't have permission to access the desired data.":i==="unavailable"&&(a="The service is unavailable");const c=new Error(i+" at "+e._path.toString()+": "+a);return c.code=i.toUpperCase(),c}const INTEGER_REGEXP_=new RegExp("^-?(0*)\\d{1,10}$"),INTEGER_32_MIN=-2147483648,INTEGER_32_MAX=2147483647,tryParseInt=function(i){if(INTEGER_REGEXP_.test(i)){const e=Number(i);if(e>=INTEGER_32_MIN&&e<=INTEGER_32_MAX)return e}return null},exceptionGuard=function(i){try{i()}catch(e){setTimeout(()=>{const a=e.stack||"";throw warn("Exception was thrown by user callback.",a),e},Math.floor(0))}},beingCrawled=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},setTimeoutNonBlocking=function(i,e){const a=setTimeout(i,e);return typeof a=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(a):typeof a=="object"&&a.unref&&a.unref(),a};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AppCheckTokenProvider{constructor(e,a){this.appName_=e,this.appCheckProvider=a,this.appCheck=a==null?void 0:a.getImmediate({optional:!0}),this.appCheck||a==null||a.get().then(c=>this.appCheck=c)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((a,c)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(a,c):a(null)},0)})}addTokenChangeListener(e){var a;(a=this.appCheckProvider)===null||a===void 0||a.get().then(c=>c.addTokenListener(e))}notifyForInvalidToken(){warn(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FirebaseAuthTokenProvider{constructor(e,a,c){this.appName_=e,this.firebaseOptions_=a,this.authProvider_=c,this.auth_=null,this.auth_=c.getImmediate({optional:!0}),this.auth_||c.onInit(h=>this.auth_=h)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(a=>a&&a.code==="auth/token-not-initialized"?(log("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(a)):new Promise((a,c)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(a,c):a(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(a=>a.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(a=>a.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',warn(e)}}class EmulatorTokenProvider{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}EmulatorTokenProvider.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PROTOCOL_VERSION="5",VERSION_PARAM="v",TRANSPORT_SESSION_PARAM="s",REFERER_PARAM="r",FORGE_REF="f",FORGE_DOMAIN_RE=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,LAST_SESSION_PARAM="ls",APPLICATION_ID_PARAM="p",APP_CHECK_TOKEN_PARAM="ac",WEBSOCKET="websocket",LONG_POLLING="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RepoInfo{constructor(e,a,c,h,d=!1,et="",ft=!1,gt=!1){this.secure=a,this.namespace=c,this.webSocketOnly=h,this.nodeAdmin=d,this.persistenceKey=et,this.includeNamespaceInQueryParams=ft,this.isUsingEmulator=gt,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=PersistentStorage.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&PersistentStorage.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",a=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${a}`}}function repoInfoNeedsQueryParam(i){return i.host!==i.internalHost||i.isCustomHost()||i.includeNamespaceInQueryParams}function repoInfoConnectionURL(i,e,a){assert(typeof e=="string","typeof type must == string"),assert(typeof a=="object","typeof params must == object");let c;if(e===WEBSOCKET)c=(i.secure?"wss://":"ws://")+i.internalHost+"/.ws?";else if(e===LONG_POLLING)c=(i.secure?"https://":"http://")+i.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);repoInfoNeedsQueryParam(i)&&(a.ns=i.namespace);const h=[];return each(a,(d,et)=>{h.push(d+"="+et)}),c+h.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class StatsCollection{constructor(){this.counters_={}}incrementCounter(e,a=1){contains(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=a}get(){return deepCopy(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const collections={},reporters={};function statsManagerGetCollection(i){const e=i.toString();return collections[e]||(collections[e]=new StatsCollection),collections[e]}function statsManagerGetOrCreateReporter(i,e){const a=i.toString();return reporters[a]||(reporters[a]=e()),reporters[a]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PacketReceiver{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,a){this.closeAfterResponse=e,this.onClose=a,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,a){for(this.pendingResponses[e]=a;this.pendingResponses[this.currentResponseNum];){const c=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let h=0;h<c.length;++h)c[h]&&exceptionGuard(()=>{this.onMessage_(c[h])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FIREBASE_LONGPOLL_START_PARAM="start",FIREBASE_LONGPOLL_CLOSE_COMMAND="close",FIREBASE_LONGPOLL_COMMAND_CB_NAME="pLPCommand",FIREBASE_LONGPOLL_DATA_CB_NAME="pRTLPCB",FIREBASE_LONGPOLL_ID_PARAM="id",FIREBASE_LONGPOLL_PW_PARAM="pw",FIREBASE_LONGPOLL_SERIAL_PARAM="ser",FIREBASE_LONGPOLL_CALLBACK_ID_PARAM="cb",FIREBASE_LONGPOLL_SEGMENT_NUM_PARAM="seg",FIREBASE_LONGPOLL_SEGMENTS_IN_PACKET="ts",FIREBASE_LONGPOLL_DATA_PARAM="d",FIREBASE_LONGPOLL_DISCONN_FRAME_REQUEST_PARAM="dframe",MAX_URL_DATA_SIZE=1870,SEG_HEADER_SIZE=30,MAX_PAYLOAD_SIZE=MAX_URL_DATA_SIZE-SEG_HEADER_SIZE,KEEPALIVE_REQUEST_INTERVAL=25e3,LP_CONNECT_TIMEOUT=3e4;class BrowserPollConnection{constructor(e,a,c,h,d,et,ft){this.connId=e,this.repoInfo=a,this.applicationId=c,this.appCheckToken=h,this.authToken=d,this.transportSessionId=et,this.lastSessionId=ft,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=logWrapper(e),this.stats_=statsManagerGetCollection(a),this.urlFn=gt=>(this.appCheckToken&&(gt[APP_CHECK_TOKEN_PARAM]=this.appCheckToken),repoInfoConnectionURL(a,LONG_POLLING,gt))}open(e,a){this.curSegmentNum=0,this.onDisconnect_=a,this.myPacketOrderer=new PacketReceiver(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(LP_CONNECT_TIMEOUT)),executeWhenDOMReady(()=>{if(this.isClosed_)return;this.scriptTagHolder=new FirebaseIFrameScriptHolder((...d)=>{const[et,ft,gt,_t,wt]=d;if(this.incrementIncomingBytes_(d),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,et===FIREBASE_LONGPOLL_START_PARAM)this.id=ft,this.password=gt;else if(et===FIREBASE_LONGPOLL_CLOSE_COMMAND)ft?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(ft,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+et)},(...d)=>{const[et,ft]=d;this.incrementIncomingBytes_(d),this.myPacketOrderer.handleResponse(et,ft)},()=>{this.onClosed_()},this.urlFn);const c={};c[FIREBASE_LONGPOLL_START_PARAM]="t",c[FIREBASE_LONGPOLL_SERIAL_PARAM]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(c[FIREBASE_LONGPOLL_CALLBACK_ID_PARAM]=this.scriptTagHolder.uniqueCallbackIdentifier),c[VERSION_PARAM]=PROTOCOL_VERSION,this.transportSessionId&&(c[TRANSPORT_SESSION_PARAM]=this.transportSessionId),this.lastSessionId&&(c[LAST_SESSION_PARAM]=this.lastSessionId),this.applicationId&&(c[APPLICATION_ID_PARAM]=this.applicationId),this.appCheckToken&&(c[APP_CHECK_TOKEN_PARAM]=this.appCheckToken),typeof location<"u"&&location.hostname&&FORGE_DOMAIN_RE.test(location.hostname)&&(c[REFERER_PARAM]=FORGE_REF);const h=this.urlFn(c);this.log_("Connecting via long-poll to "+h),this.scriptTagHolder.addTag(h,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){BrowserPollConnection.forceAllow_=!0}static forceDisallow(){BrowserPollConnection.forceDisallow_=!0}static isAvailable(){return BrowserPollConnection.forceAllow_?!0:!BrowserPollConnection.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!isChromeExtensionContentScript()&&!isWindowsStoreApp()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const a=stringify(e);this.bytesSent+=a.length,this.stats_.incrementCounter("bytes_sent",a.length);const c=base64Encode(a),h=splitStringBySize(c,MAX_PAYLOAD_SIZE);for(let d=0;d<h.length;d++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,h.length,h[d]),this.curSegmentNum++}addDisconnectPingFrame(e,a){this.myDisconnFrame=document.createElement("iframe");const c={};c[FIREBASE_LONGPOLL_DISCONN_FRAME_REQUEST_PARAM]="t",c[FIREBASE_LONGPOLL_ID_PARAM]=e,c[FIREBASE_LONGPOLL_PW_PARAM]=a,this.myDisconnFrame.src=this.urlFn(c),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const a=stringify(e).length;this.bytesReceived+=a,this.stats_.incrementCounter("bytes_received",a)}}class FirebaseIFrameScriptHolder{constructor(e,a,c,h){this.onDisconnect=c,this.urlFn=h,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=LUIDGenerator(),window[FIREBASE_LONGPOLL_COMMAND_CB_NAME+this.uniqueCallbackIdentifier]=e,window[FIREBASE_LONGPOLL_DATA_CB_NAME+this.uniqueCallbackIdentifier]=a,this.myIFrame=FirebaseIFrameScriptHolder.createIFrame_();let d="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(d='<script>document.domain="'+document.domain+'";<\/script>');const et="<html><body>"+d+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(et),this.myIFrame.doc.close()}catch(ft){log("frame writing exception"),ft.stack&&log(ft.stack),log(ft)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||log("No IE domain setting required")}catch{const c=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+c+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,a){for(this.myID=e,this.myPW=a,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[FIREBASE_LONGPOLL_ID_PARAM]=this.myID,e[FIREBASE_LONGPOLL_PW_PARAM]=this.myPW,e[FIREBASE_LONGPOLL_SERIAL_PARAM]=this.currentSerial;let a=this.urlFn(e),c="",h=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+SEG_HEADER_SIZE+c.length<=MAX_URL_DATA_SIZE;){const et=this.pendingSegs.shift();c=c+"&"+FIREBASE_LONGPOLL_SEGMENT_NUM_PARAM+h+"="+et.seg+"&"+FIREBASE_LONGPOLL_SEGMENTS_IN_PACKET+h+"="+et.ts+"&"+FIREBASE_LONGPOLL_DATA_PARAM+h+"="+et.d,h++}return a=a+c,this.addLongPollTag_(a,this.currentSerial),!0}else return!1}enqueueSegment(e,a,c){this.pendingSegs.push({seg:e,ts:a,d:c}),this.alive&&this.newRequest_()}addLongPollTag_(e,a){this.outstandingRequests.add(a);const c=()=>{this.outstandingRequests.delete(a),this.newRequest_()},h=setTimeout(c,Math.floor(KEEPALIVE_REQUEST_INTERVAL)),d=()=>{clearTimeout(h),c()};this.addTag(e,d)}addTag(e,a){setTimeout(()=>{try{if(!this.sendNewPolls)return;const c=this.myIFrame.doc.createElement("script");c.type="text/javascript",c.async=!0,c.src=e,c.onload=c.onreadystatechange=function(){const h=c.readyState;(!h||h==="loaded"||h==="complete")&&(c.onload=c.onreadystatechange=null,c.parentNode&&c.parentNode.removeChild(c),a())},c.onerror=()=>{log("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(c)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WEBSOCKET_MAX_FRAME_SIZE=16384,WEBSOCKET_KEEPALIVE_INTERVAL=45e3;let WebSocketImpl=null;typeof MozWebSocket<"u"?WebSocketImpl=MozWebSocket:typeof WebSocket<"u"&&(WebSocketImpl=WebSocket);class WebSocketConnection{constructor(e,a,c,h,d,et,ft){this.connId=e,this.applicationId=c,this.appCheckToken=h,this.authToken=d,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=logWrapper(this.connId),this.stats_=statsManagerGetCollection(a),this.connURL=WebSocketConnection.connectionURL_(a,et,ft,h,c),this.nodeAdmin=a.nodeAdmin}static connectionURL_(e,a,c,h,d){const et={};return et[VERSION_PARAM]=PROTOCOL_VERSION,typeof location<"u"&&location.hostname&&FORGE_DOMAIN_RE.test(location.hostname)&&(et[REFERER_PARAM]=FORGE_REF),a&&(et[TRANSPORT_SESSION_PARAM]=a),c&&(et[LAST_SESSION_PARAM]=c),h&&(et[APP_CHECK_TOKEN_PARAM]=h),d&&(et[APPLICATION_ID_PARAM]=d),repoInfoConnectionURL(e,WEBSOCKET,et)}open(e,a){this.onDisconnect=a,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,PersistentStorage.set("previous_websocket_failure",!0);try{let c;isNodeSdk(),this.mySock=new WebSocketImpl(this.connURL,[],c)}catch(c){this.log_("Error instantiating WebSocket.");const h=c.message||c.data;h&&this.log_(h),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=c=>{this.handleIncomingFrame(c)},this.mySock.onerror=c=>{this.log_("WebSocket error.  Closing connection.");const h=c.message||c.data;h&&this.log_(h),this.onClosed_()}}start(){}static forceDisallow(){WebSocketConnection.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const a=/Android ([0-9]{0,}\.[0-9]{0,})/,c=navigator.userAgent.match(a);c&&c.length>1&&parseFloat(c[1])<4.4&&(e=!0)}return!e&&WebSocketImpl!==null&&!WebSocketConnection.forceDisallow_}static previouslyFailed(){return PersistentStorage.isInMemoryStorage||PersistentStorage.get("previous_websocket_failure")===!0}markConnectionHealthy(){PersistentStorage.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const a=this.frames.join("");this.frames=null;const c=jsonEval(a);this.onMessage(c)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(assert(this.frames===null,"We already have a frame buffer"),e.length<=6){const a=Number(e);if(!isNaN(a))return this.handleNewFrameCount_(a),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const a=e.data;if(this.bytesReceived+=a.length,this.stats_.incrementCounter("bytes_received",a.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(a);else{const c=this.extractFrameCount_(a);c!==null&&this.appendFrame_(c)}}send(e){this.resetKeepAlive();const a=stringify(e);this.bytesSent+=a.length,this.stats_.incrementCounter("bytes_sent",a.length);const c=splitStringBySize(a,WEBSOCKET_MAX_FRAME_SIZE);c.length>1&&this.sendString_(String(c.length));for(let h=0;h<c.length;h++)this.sendString_(c[h])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(WEBSOCKET_KEEPALIVE_INTERVAL))}sendString_(e){try{this.mySock.send(e)}catch(a){this.log_("Exception thrown from WebSocket.send():",a.message||a.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}WebSocketConnection.responsesRequiredToBeHealthy=2;WebSocketConnection.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TransportManager{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[BrowserPollConnection,WebSocketConnection]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(e){const a=WebSocketConnection&&WebSocketConnection.isAvailable();let c=a&&!WebSocketConnection.previouslyFailed();if(e.webSocketOnly&&(a||warn("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),c=!0),c)this.transports_=[WebSocketConnection];else{const h=this.transports_=[];for(const d of TransportManager.ALL_TRANSPORTS)d&&d.isAvailable()&&h.push(d);TransportManager.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}TransportManager.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UPGRADE_TIMEOUT=6e4,DELAY_BEFORE_SENDING_EXTRA_REQUESTS=5e3,BYTES_SENT_HEALTHY_OVERRIDE=10*1024,BYTES_RECEIVED_HEALTHY_OVERRIDE=100*1024,MESSAGE_TYPE="t",MESSAGE_DATA="d",CONTROL_SHUTDOWN="s",CONTROL_RESET="r",CONTROL_ERROR="e",CONTROL_PONG="o",SWITCH_ACK="a",END_TRANSMISSION="n",PING="p",SERVER_HELLO="h";class Connection{constructor(e,a,c,h,d,et,ft,gt,_t,wt){this.id=e,this.repoInfo_=a,this.applicationId_=c,this.appCheckToken_=h,this.authToken_=d,this.onMessage_=et,this.onReady_=ft,this.onDisconnect_=gt,this.onKill_=_t,this.lastSessionId=wt,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=logWrapper("c:"+this.id+":"),this.transportManager_=new TransportManager(a),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const a=this.connReceiver_(this.conn_),c=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(a,c)},Math.floor(0));const h=e.healthyTimeout||0;h>0&&(this.healthyTimeout_=setTimeoutNonBlocking(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>BYTES_RECEIVED_HEALTHY_OVERRIDE?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>BYTES_SENT_HEALTHY_OVERRIDE?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(h)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return a=>{e===this.conn_?this.onConnectionLost_(a):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return a=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(a):e===this.secondaryConn_?this.onSecondaryMessageReceived_(a):this.log_("message on old connection"))}}sendRequest(e){const a={t:"d",d:e};this.sendData_(a)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(MESSAGE_TYPE in e){const a=e[MESSAGE_TYPE];a===SWITCH_ACK?this.upgradeIfSecondaryHealthy_():a===CONTROL_RESET?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):a===CONTROL_PONG&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const a=requireKey("t",e),c=requireKey("d",e);if(a==="c")this.onSecondaryControl_(c);else if(a==="d")this.pendingDataMessages.push(c);else throw new Error("Unknown protocol layer: "+a)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:PING,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:SWITCH_ACK,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:END_TRANSMISSION,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const a=requireKey("t",e),c=requireKey("d",e);a==="c"?this.onControl_(c):a==="d"&&this.onDataMessage_(c)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const a=requireKey(MESSAGE_TYPE,e);if(MESSAGE_DATA in e){const c=e[MESSAGE_DATA];if(a===SERVER_HELLO){const h=Object.assign({},c);this.repoInfo_.isUsingEmulator&&(h.h=this.repoInfo_.host),this.onHandshake_(h)}else if(a===END_TRANSMISSION){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let h=0;h<this.pendingDataMessages.length;++h)this.onDataMessage_(this.pendingDataMessages[h]);this.pendingDataMessages=[],this.tryCleanupConnection()}else a===CONTROL_SHUTDOWN?this.onConnectionShutdown_(c):a===CONTROL_RESET?this.onReset_(c):a===CONTROL_ERROR?error("Server Error: "+c):a===CONTROL_PONG?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):error("Unknown control packet command: "+a)}}onHandshake_(e){const a=e.ts,c=e.v,h=e.h;this.sessionId=e.s,this.repoInfo_.host=h,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,a),PROTOCOL_VERSION!==c&&warn("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const a=this.connReceiver_(this.secondaryConn_),c=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(a,c),setTimeoutNonBlocking(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(UPGRADE_TIMEOUT))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,a){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(a,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):setTimeoutNonBlocking(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(DELAY_BEFORE_SENDING_EXTRA_REQUESTS))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:PING,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(PersistentStorage.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ServerActions{put(e,a,c,h){}merge(e,a,c,h){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,a,c){}onDisconnectMerge(e,a,c){}onDisconnectCancel(e,a){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EventEmitter{constructor(e){this.allowedEvents_=e,this.listeners_={},assert(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...a){if(Array.isArray(this.listeners_[e])){const c=[...this.listeners_[e]];for(let h=0;h<c.length;h++)c[h].callback.apply(c[h].context,a)}}on(e,a,c){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:a,context:c});const h=this.getInitialEvent(e);h&&a.apply(c,h)}off(e,a,c){this.validateEventType_(e);const h=this.listeners_[e]||[];for(let d=0;d<h.length;d++)if(h[d].callback===a&&(!c||c===h[d].context)){h.splice(d,1);return}}validateEventType_(e){assert(this.allowedEvents_.find(a=>a===e),"Unknown event: "+e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OnlineMonitor extends EventEmitter{constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!isMobileCordova()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new OnlineMonitor}getInitialEvent(e){return assert(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MAX_PATH_DEPTH=32,MAX_PATH_LENGTH_BYTES=768;class Path{constructor(e,a){if(a===void 0){this.pieces_=e.split("/");let c=0;for(let h=0;h<this.pieces_.length;h++)this.pieces_[h].length>0&&(this.pieces_[c]=this.pieces_[h],c++);this.pieces_.length=c,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=a}toString(){let e="";for(let a=this.pieceNum_;a<this.pieces_.length;a++)this.pieces_[a]!==""&&(e+="/"+this.pieces_[a]);return e||"/"}}function newEmptyPath(){return new Path("")}function pathGetFront(i){return i.pieceNum_>=i.pieces_.length?null:i.pieces_[i.pieceNum_]}function pathGetLength(i){return i.pieces_.length-i.pieceNum_}function pathPopFront(i){let e=i.pieceNum_;return e<i.pieces_.length&&e++,new Path(i.pieces_,e)}function pathGetBack(i){return i.pieceNum_<i.pieces_.length?i.pieces_[i.pieces_.length-1]:null}function pathToUrlEncodedString(i){let e="";for(let a=i.pieceNum_;a<i.pieces_.length;a++)i.pieces_[a]!==""&&(e+="/"+encodeURIComponent(String(i.pieces_[a])));return e||"/"}function pathSlice(i,e=0){return i.pieces_.slice(i.pieceNum_+e)}function pathParent(i){if(i.pieceNum_>=i.pieces_.length)return null;const e=[];for(let a=i.pieceNum_;a<i.pieces_.length-1;a++)e.push(i.pieces_[a]);return new Path(e,0)}function pathChild(i,e){const a=[];for(let c=i.pieceNum_;c<i.pieces_.length;c++)a.push(i.pieces_[c]);if(e instanceof Path)for(let c=e.pieceNum_;c<e.pieces_.length;c++)a.push(e.pieces_[c]);else{const c=e.split("/");for(let h=0;h<c.length;h++)c[h].length>0&&a.push(c[h])}return new Path(a,0)}function pathIsEmpty(i){return i.pieceNum_>=i.pieces_.length}function newRelativePath(i,e){const a=pathGetFront(i),c=pathGetFront(e);if(a===null)return e;if(a===c)return newRelativePath(pathPopFront(i),pathPopFront(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+i+")")}function pathCompare(i,e){const a=pathSlice(i,0),c=pathSlice(e,0);for(let h=0;h<a.length&&h<c.length;h++){const d=nameCompare(a[h],c[h]);if(d!==0)return d}return a.length===c.length?0:a.length<c.length?-1:1}function pathEquals(i,e){if(pathGetLength(i)!==pathGetLength(e))return!1;for(let a=i.pieceNum_,c=e.pieceNum_;a<=i.pieces_.length;a++,c++)if(i.pieces_[a]!==e.pieces_[c])return!1;return!0}function pathContains(i,e){let a=i.pieceNum_,c=e.pieceNum_;if(pathGetLength(i)>pathGetLength(e))return!1;for(;a<i.pieces_.length;){if(i.pieces_[a]!==e.pieces_[c])return!1;++a,++c}return!0}class ValidationPath{constructor(e,a){this.errorPrefix_=a,this.parts_=pathSlice(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let c=0;c<this.parts_.length;c++)this.byteLength_+=stringLength(this.parts_[c]);validationPathCheckValid(this)}}function validationPathPush(i,e){i.parts_.length>0&&(i.byteLength_+=1),i.parts_.push(e),i.byteLength_+=stringLength(e),validationPathCheckValid(i)}function validationPathPop(i){const e=i.parts_.pop();i.byteLength_-=stringLength(e),i.parts_.length>0&&(i.byteLength_-=1)}function validationPathCheckValid(i){if(i.byteLength_>MAX_PATH_LENGTH_BYTES)throw new Error(i.errorPrefix_+"has a key path longer than "+MAX_PATH_LENGTH_BYTES+" bytes ("+i.byteLength_+").");if(i.parts_.length>MAX_PATH_DEPTH)throw new Error(i.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+MAX_PATH_DEPTH+") or object contains a cycle "+validationPathToErrorString(i))}function validationPathToErrorString(i){return i.parts_.length===0?"":"in property '"+i.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VisibilityMonitor extends EventEmitter{constructor(){super(["visible"]);let e,a;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(a="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(a="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(a="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(a="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,a&&document.addEventListener(a,()=>{const c=!document[e];c!==this.visible_&&(this.visible_=c,this.trigger("visible",c))},!1)}static getInstance(){return new VisibilityMonitor}getInitialEvent(e){return assert(e==="visible","Unknown event type: "+e),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RECONNECT_MIN_DELAY=1e3,RECONNECT_MAX_DELAY_DEFAULT=60*5*1e3,RECONNECT_MAX_DELAY_FOR_ADMINS=30*1e3,RECONNECT_DELAY_MULTIPLIER=1.3,RECONNECT_DELAY_RESET_TIMEOUT=3e4,SERVER_KILL_INTERRUPT_REASON="server_kill",INVALID_TOKEN_THRESHOLD=3;class PersistentConnection extends ServerActions{constructor(e,a,c,h,d,et,ft,gt){if(super(),this.repoInfo_=e,this.applicationId_=a,this.onDataUpdate_=c,this.onConnectStatus_=h,this.onServerInfoUpdate_=d,this.authTokenProvider_=et,this.appCheckTokenProvider_=ft,this.authOverride_=gt,this.id=PersistentConnection.nextPersistentConnectionId_++,this.log_=logWrapper("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=RECONNECT_MIN_DELAY,this.maxReconnectDelay_=RECONNECT_MAX_DELAY_DEFAULT,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,gt&&!isNodeSdk())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");VisibilityMonitor.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&OnlineMonitor.getInstance().on("online",this.onOnline_,this)}sendRequest(e,a,c){const h=++this.requestNumber_,d={r:h,a:e,b:a};this.log_(stringify(d)),assert(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(d),c&&(this.requestCBHash_[h]=c)}get(e){this.initConnection_();const a=new Deferred,h={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:et=>{const ft=et.d;et.s==="ok"?a.resolve(ft):a.reject(ft)}};this.outstandingGets_.push(h),this.outstandingGetCount_++;const d=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(d),a.promise}listen(e,a,c,h){this.initConnection_();const d=e._queryIdentifier,et=e._path.toString();this.log_("Listen called for "+et+" "+d),this.listens.has(et)||this.listens.set(et,new Map),assert(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),assert(!this.listens.get(et).has(d),"listen() called twice for same path/queryId.");const ft={onComplete:h,hashFn:a,query:e,tag:c};this.listens.get(et).set(d,ft),this.connected_&&this.sendListen_(ft)}sendGet_(e){const a=this.outstandingGets_[e];this.sendRequest("g",a.request,c=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),a.onComplete&&a.onComplete(c)})}sendListen_(e){const a=e.query,c=a._path.toString(),h=a._queryIdentifier;this.log_("Listen on "+c+" for "+h);const d={p:c},et="q";e.tag&&(d.q=a._queryObject,d.t=e.tag),d.h=e.hashFn(),this.sendRequest(et,d,ft=>{const gt=ft.d,_t=ft.s;PersistentConnection.warnOnListenWarnings_(gt,a),(this.listens.get(c)&&this.listens.get(c).get(h))===e&&(this.log_("listen response",ft),_t!=="ok"&&this.removeListen_(c,h),e.onComplete&&e.onComplete(_t,gt))})}static warnOnListenWarnings_(e,a){if(e&&typeof e=="object"&&contains(e,"w")){const c=safeGet(e,"w");if(Array.isArray(c)&&~c.indexOf("no_index")){const h='".indexOn": "'+a._queryParams.getIndex().toString()+'"',d=a._path.toString();warn(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${h} at ${d} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||isAdmin(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=RECONNECT_MAX_DELAY_FOR_ADMINS)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,a=isValidFormat(e)?"auth":"gauth",c={cred:e};this.authOverride_===null?c.noauth=!0:typeof this.authOverride_=="object"&&(c.authvar=this.authOverride_),this.sendRequest(a,c,h=>{const d=h.s,et=h.d||"error";this.authToken_===e&&(d==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(d,et))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const a=e.s,c=e.d||"error";a==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(a,c)})}unlisten(e,a){const c=e._path.toString(),h=e._queryIdentifier;this.log_("Unlisten called for "+c+" "+h),assert(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(c,h)&&this.connected_&&this.sendUnlisten_(c,h,e._queryObject,a)}sendUnlisten_(e,a,c,h){this.log_("Unlisten on "+e+" for "+a);const d={p:e},et="n";h&&(d.q=c,d.t=h),this.sendRequest(et,d)}onDisconnectPut(e,a,c){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,a,c):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:a,onComplete:c})}onDisconnectMerge(e,a,c){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,a,c):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:a,onComplete:c})}onDisconnectCancel(e,a){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,a):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:a})}sendOnDisconnect_(e,a,c,h){const d={p:a,d:c};this.log_("onDisconnect "+e,d),this.sendRequest(e,d,et=>{h&&setTimeout(()=>{h(et.s,et.d)},Math.floor(0))})}put(e,a,c,h){this.putInternal("p",e,a,c,h)}merge(e,a,c,h){this.putInternal("m",e,a,c,h)}putInternal(e,a,c,h,d){this.initConnection_();const et={p:a,d:c};d!==void 0&&(et.h=d),this.outstandingPuts_.push({action:e,request:et,onComplete:h}),this.outstandingPutCount_++;const ft=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(ft):this.log_("Buffering put: "+a)}sendPut_(e){const a=this.outstandingPuts_[e].action,c=this.outstandingPuts_[e].request,h=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(a,c,d=>{this.log_(a+" response",d),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),h&&h(d.s,d.d)})}reportStats(e){if(this.connected_){const a={c:e};this.log_("reportStats",a),this.sendRequest("s",a,c=>{if(c.s!=="ok"){const d=c.d;this.log_("reportStats","Error sending stats: "+d)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+stringify(e));const a=e.r,c=this.requestCBHash_[a];c&&(delete this.requestCBHash_[a],c(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,a){this.log_("handleServerMessage",e,a),e==="d"?this.onDataUpdate_(a.p,a.d,!1,a.t):e==="m"?this.onDataUpdate_(a.p,a.d,!0,a.t):e==="c"?this.onListenRevoked_(a.p,a.q):e==="ac"?this.onAuthRevoked_(a.s,a.d):e==="apc"?this.onAppCheckRevoked_(a.s,a.d):e==="sd"?this.onSecurityDebugPacket_(a):error("Unrecognized action received from server: "+stringify(e)+`
Are you using the latest client?`)}onReady_(e,a){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=a,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){assert(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=RECONNECT_MIN_DELAY,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=RECONNECT_MIN_DELAY,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>RECONNECT_DELAY_RESET_TIMEOUT&&(this.reconnectDelay_=RECONNECT_MIN_DELAY),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=new Date().getTime()-this.lastConnectionAttemptTime_;let a=Math.max(0,this.reconnectDelay_-e);a=Math.random()*a,this.log_("Trying to reconnect in "+a+"ms"),this.scheduleConnect_(a),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*RECONNECT_DELAY_MULTIPLIER)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),a=this.onReady_.bind(this),c=this.onRealtimeDisconnect_.bind(this),h=this.id+":"+PersistentConnection.nextConnectionId_++,d=this.lastSessionId;let et=!1,ft=null;const gt=function(){ft?ft.close():(et=!0,c())},_t=function($t){assert(ft,"sendRequest call when we're not connected not allowed."),ft.sendRequest($t)};this.realtime_={close:gt,sendRequest:_t};const wt=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[$t,It]=await Promise.all([this.authTokenProvider_.getToken(wt),this.appCheckTokenProvider_.getToken(wt)]);et?log("getToken() completed but was canceled"):(log("getToken() completed. Creating connection."),this.authToken_=$t&&$t.accessToken,this.appCheckToken_=It&&It.token,ft=new Connection(h,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,a,c,Rt=>{warn(Rt+" ("+this.repoInfo_.toString()+")"),this.interrupt(SERVER_KILL_INTERRUPT_REASON)},d))}catch($t){this.log_("Failed to get token: "+$t),et||(this.repoInfo_.nodeAdmin&&warn($t),gt())}}}interrupt(e){log("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){log("Resuming connection for reason: "+e),delete this.interruptReasons_[e],isEmpty(this.interruptReasons_)&&(this.reconnectDelay_=RECONNECT_MIN_DELAY,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const a=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:a})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const a=this.outstandingPuts_[e];a&&"h"in a.request&&a.queued&&(a.onComplete&&a.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,a){let c;a?c=a.map(d=>ObjectToUniqueKey(d)).join("$"):c="default";const h=this.removeListen_(e,c);h&&h.onComplete&&h.onComplete("permission_denied")}removeListen_(e,a){const c=new Path(e).toString();let h;if(this.listens.has(c)){const d=this.listens.get(c);h=d.get(a),d.delete(a),d.size===0&&this.listens.delete(c)}else h=void 0;return h}onAuthRevoked_(e,a){log("Auth token revoked: "+e+"/"+a),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=INVALID_TOKEN_THRESHOLD&&(this.reconnectDelay_=RECONNECT_MAX_DELAY_FOR_ADMINS,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,a){log("App check token revoked: "+e+"/"+a),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=INVALID_TOKEN_THRESHOLD&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const a of e.values())this.sendListen_(a);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let a="js";e["sdk."+a+"."+SDK_VERSION.replace(/\./g,"-")]=1,isMobileCordova()?e["framework.cordova"]=1:isReactNative()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=OnlineMonitor.getInstance().currentlyOnline();return isEmpty(this.interruptReasons_)&&e}}PersistentConnection.nextPersistentConnectionId_=0;PersistentConnection.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NamedNode{constructor(e,a){this.name=e,this.node=a}static Wrap(e,a){return new NamedNode(e,a)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Index{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,a){const c=new NamedNode(MIN_NAME,e),h=new NamedNode(MIN_NAME,a);return this.compare(c,h)!==0}minPost(){return NamedNode.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let __EMPTY_NODE;class KeyIndex extends Index{static get __EMPTY_NODE(){return __EMPTY_NODE}static set __EMPTY_NODE(e){__EMPTY_NODE=e}compare(e,a){return nameCompare(e.name,a.name)}isDefinedOn(e){throw assertionError("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,a){return!1}minPost(){return NamedNode.MIN}maxPost(){return new NamedNode(MAX_NAME,__EMPTY_NODE)}makePost(e,a){return assert(typeof e=="string","KeyIndex indexValue must always be a string."),new NamedNode(e,__EMPTY_NODE)}toString(){return".key"}}const KEY_INDEX=new KeyIndex;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SortedMapIterator{constructor(e,a,c,h,d=null){this.isReverse_=h,this.resultGenerator_=d,this.nodeStack_=[];let et=1;for(;!e.isEmpty();)if(e=e,et=a?c(e.key,a):1,h&&(et*=-1),et<0)this.isReverse_?e=e.left:e=e.right;else if(et===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),a;if(this.resultGenerator_?a=this.resultGenerator_(e.key,e.value):a={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return a}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class LLRBNode{constructor(e,a,c,h,d){this.key=e,this.value=a,this.color=c??LLRBNode.RED,this.left=h??SortedMap.EMPTY_NODE,this.right=d??SortedMap.EMPTY_NODE}copy(e,a,c,h,d){return new LLRBNode(e??this.key,a??this.value,c??this.color,h??this.left,d??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,a,c){let h=this;const d=c(e,h.key);return d<0?h=h.copy(null,null,null,h.left.insert(e,a,c),null):d===0?h=h.copy(null,a,null,null,null):h=h.copy(null,null,null,null,h.right.insert(e,a,c)),h.fixUp_()}removeMin_(){if(this.left.isEmpty())return SortedMap.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,a){let c,h;if(c=this,a(e,c.key)<0)!c.left.isEmpty()&&!c.left.isRed_()&&!c.left.left.isRed_()&&(c=c.moveRedLeft_()),c=c.copy(null,null,null,c.left.remove(e,a),null);else{if(c.left.isRed_()&&(c=c.rotateRight_()),!c.right.isEmpty()&&!c.right.isRed_()&&!c.right.left.isRed_()&&(c=c.moveRedRight_()),a(e,c.key)===0){if(c.right.isEmpty())return SortedMap.EMPTY_NODE;h=c.right.min_(),c=c.copy(h.key,h.value,null,null,c.right.removeMin_())}c=c.copy(null,null,null,null,c.right.remove(e,a))}return c.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,LLRBNode.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,LLRBNode.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),a=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,a)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}LLRBNode.RED=!0;LLRBNode.BLACK=!1;class LLRBEmptyNode{copy(e,a,c,h,d){return this}insert(e,a,c){return new LLRBNode(e,a,null)}remove(e,a){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class SortedMap{constructor(e,a=SortedMap.EMPTY_NODE){this.comparator_=e,this.root_=a}insert(e,a){return new SortedMap(this.comparator_,this.root_.insert(e,a,this.comparator_).copy(null,null,LLRBNode.BLACK,null,null))}remove(e){return new SortedMap(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,LLRBNode.BLACK,null,null))}get(e){let a,c=this.root_;for(;!c.isEmpty();){if(a=this.comparator_(e,c.key),a===0)return c.value;a<0?c=c.left:a>0&&(c=c.right)}return null}getPredecessorKey(e){let a,c=this.root_,h=null;for(;!c.isEmpty();)if(a=this.comparator_(e,c.key),a===0){if(c.left.isEmpty())return h?h.key:null;for(c=c.left;!c.right.isEmpty();)c=c.right;return c.key}else a<0?c=c.left:a>0&&(h=c,c=c.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new SortedMapIterator(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,a){return new SortedMapIterator(this.root_,e,this.comparator_,!1,a)}getReverseIteratorFrom(e,a){return new SortedMapIterator(this.root_,e,this.comparator_,!0,a)}getReverseIterator(e){return new SortedMapIterator(this.root_,null,this.comparator_,!0,e)}}SortedMap.EMPTY_NODE=new LLRBEmptyNode;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NAME_ONLY_COMPARATOR(i,e){return nameCompare(i.name,e.name)}function NAME_COMPARATOR(i,e){return nameCompare(i,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let MAX_NODE$2;function setMaxNode$1(i){MAX_NODE$2=i}const priorityHashText=function(i){return typeof i=="number"?"number:"+doubleToIEEE754String(i):"string:"+i},validatePriorityNode=function(i){if(i.isLeafNode()){const e=i.val();assert(typeof e=="string"||typeof e=="number"||typeof e=="object"&&contains(e,".sv"),"Priority must be a string or number.")}else assert(i===MAX_NODE$2||i.isEmpty(),"priority of unexpected type.");assert(i===MAX_NODE$2||i.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let __childrenNodeConstructor;class LeafNode{constructor(e,a=LeafNode.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=a,this.lazyHash_=null,assert(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),validatePriorityNode(this.priorityNode_)}static set __childrenNodeConstructor(e){__childrenNodeConstructor=e}static get __childrenNodeConstructor(){return __childrenNodeConstructor}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new LeafNode(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:LeafNode.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return pathIsEmpty(e)?this:pathGetFront(e)===".priority"?this.priorityNode_:LeafNode.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,a){return null}updateImmediateChild(e,a){return e===".priority"?this.updatePriority(a):a.isEmpty()&&e!==".priority"?this:LeafNode.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,a).updatePriority(this.priorityNode_)}updateChild(e,a){const c=pathGetFront(e);return c===null?a:a.isEmpty()&&c!==".priority"?this:(assert(c!==".priority"||pathGetLength(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(c,LeafNode.__childrenNodeConstructor.EMPTY_NODE.updateChild(pathPopFront(e),a)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,a){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+priorityHashText(this.priorityNode_.val())+":");const a=typeof this.value_;e+=a+":",a==="number"?e+=doubleToIEEE754String(this.value_):e+=this.value_,this.lazyHash_=sha1(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===LeafNode.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof LeafNode.__childrenNodeConstructor?-1:(assert(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const a=typeof e.value_,c=typeof this.value_,h=LeafNode.VALUE_TYPE_ORDER.indexOf(a),d=LeafNode.VALUE_TYPE_ORDER.indexOf(c);return assert(h>=0,"Unknown leaf type: "+a),assert(d>=0,"Unknown leaf type: "+c),h===d?c==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:d-h}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const a=e;return this.value_===a.value_&&this.priorityNode_.equals(a.priorityNode_)}else return!1}}LeafNode.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let nodeFromJSON$1,MAX_NODE$1;function setNodeFromJSON(i){nodeFromJSON$1=i}function setMaxNode(i){MAX_NODE$1=i}class PriorityIndex extends Index{compare(e,a){const c=e.node.getPriority(),h=a.node.getPriority(),d=c.compareTo(h);return d===0?nameCompare(e.name,a.name):d}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,a){return!e.getPriority().equals(a.getPriority())}minPost(){return NamedNode.MIN}maxPost(){return new NamedNode(MAX_NAME,new LeafNode("[PRIORITY-POST]",MAX_NODE$1))}makePost(e,a){const c=nodeFromJSON$1(e);return new NamedNode(a,new LeafNode("[PRIORITY-POST]",c))}toString(){return".priority"}}const PRIORITY_INDEX=new PriorityIndex;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LOG_2=Math.log(2);class Base12Num{constructor(e){const a=d=>parseInt(Math.log(d)/LOG_2,10),c=d=>parseInt(Array(d+1).join("1"),2);this.count=a(e+1),this.current_=this.count-1;const h=c(this.count);this.bits_=e+1&h}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const buildChildSet=function(i,e,a,c){i.sort(e);const h=function(gt,_t){const wt=_t-gt;let $t,It;if(wt===0)return null;if(wt===1)return $t=i[gt],It=a?a($t):$t,new LLRBNode(It,$t.node,LLRBNode.BLACK,null,null);{const Rt=parseInt(wt/2,10)+gt,Tt=h(gt,Rt),At=h(Rt+1,_t);return $t=i[Rt],It=a?a($t):$t,new LLRBNode(It,$t.node,LLRBNode.BLACK,Tt,At)}},d=function(gt){let _t=null,wt=null,$t=i.length;const It=function(Tt,At){const kt=$t-Tt,xt=$t;$t-=Tt;const Nt=h(kt+1,xt),Ft=i[kt],jt=a?a(Ft):Ft;Rt(new LLRBNode(jt,Ft.node,At,null,Nt))},Rt=function(Tt){_t?(_t.left=Tt,_t=Tt):(wt=Tt,_t=Tt)};for(let Tt=0;Tt<gt.count;++Tt){const At=gt.nextBitIsOne(),kt=Math.pow(2,gt.count-(Tt+1));At?It(kt,LLRBNode.BLACK):(It(kt,LLRBNode.BLACK),It(kt,LLRBNode.RED))}return wt},et=new Base12Num(i.length),ft=d(et);return new SortedMap(c||e,ft)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let _defaultIndexMap;const fallbackObject={};class IndexMap{constructor(e,a){this.indexes_=e,this.indexSet_=a}static get Default(){return assert(fallbackObject&&PRIORITY_INDEX,"ChildrenNode.ts has not been loaded"),_defaultIndexMap=_defaultIndexMap||new IndexMap({".priority":fallbackObject},{".priority":PRIORITY_INDEX}),_defaultIndexMap}get(e){const a=safeGet(this.indexes_,e);if(!a)throw new Error("No index defined for "+e);return a instanceof SortedMap?a:null}hasIndex(e){return contains(this.indexSet_,e.toString())}addIndex(e,a){assert(e!==KEY_INDEX,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const c=[];let h=!1;const d=a.getIterator(NamedNode.Wrap);let et=d.getNext();for(;et;)h=h||e.isDefinedOn(et.node),c.push(et),et=d.getNext();let ft;h?ft=buildChildSet(c,e.getCompare()):ft=fallbackObject;const gt=e.toString(),_t=Object.assign({},this.indexSet_);_t[gt]=e;const wt=Object.assign({},this.indexes_);return wt[gt]=ft,new IndexMap(wt,_t)}addToIndexes(e,a){const c=map(this.indexes_,(h,d)=>{const et=safeGet(this.indexSet_,d);if(assert(et,"Missing index implementation for "+d),h===fallbackObject)if(et.isDefinedOn(e.node)){const ft=[],gt=a.getIterator(NamedNode.Wrap);let _t=gt.getNext();for(;_t;)_t.name!==e.name&&ft.push(_t),_t=gt.getNext();return ft.push(e),buildChildSet(ft,et.getCompare())}else return fallbackObject;else{const ft=a.get(e.name);let gt=h;return ft&&(gt=gt.remove(new NamedNode(e.name,ft))),gt.insert(e,e.node)}});return new IndexMap(c,this.indexSet_)}removeFromIndexes(e,a){const c=map(this.indexes_,h=>{if(h===fallbackObject)return h;{const d=a.get(e.name);return d?h.remove(new NamedNode(e.name,d)):h}});return new IndexMap(c,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let EMPTY_NODE;class ChildrenNode{constructor(e,a,c){this.children_=e,this.priorityNode_=a,this.indexMap_=c,this.lazyHash_=null,this.priorityNode_&&validatePriorityNode(this.priorityNode_),this.children_.isEmpty()&&assert(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return EMPTY_NODE||(EMPTY_NODE=new ChildrenNode(new SortedMap(NAME_COMPARATOR),null,IndexMap.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||EMPTY_NODE}updatePriority(e){return this.children_.isEmpty()?this:new ChildrenNode(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const a=this.children_.get(e);return a===null?EMPTY_NODE:a}}getChild(e){const a=pathGetFront(e);return a===null?this:this.getImmediateChild(a).getChild(pathPopFront(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,a){if(assert(a,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(a);{const c=new NamedNode(e,a);let h,d;a.isEmpty()?(h=this.children_.remove(e),d=this.indexMap_.removeFromIndexes(c,this.children_)):(h=this.children_.insert(e,a),d=this.indexMap_.addToIndexes(c,this.children_));const et=h.isEmpty()?EMPTY_NODE:this.priorityNode_;return new ChildrenNode(h,et,d)}}updateChild(e,a){const c=pathGetFront(e);if(c===null)return a;{assert(pathGetFront(e)!==".priority"||pathGetLength(e)===1,".priority must be the last token in a path");const h=this.getImmediateChild(c).updateChild(pathPopFront(e),a);return this.updateImmediateChild(c,h)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const a={};let c=0,h=0,d=!0;if(this.forEachChild(PRIORITY_INDEX,(et,ft)=>{a[et]=ft.val(e),c++,d&&ChildrenNode.INTEGER_REGEXP_.test(et)?h=Math.max(h,Number(et)):d=!1}),!e&&d&&h<2*c){const et=[];for(const ft in a)et[ft]=a[ft];return et}else return e&&!this.getPriority().isEmpty()&&(a[".priority"]=this.getPriority().val()),a}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+priorityHashText(this.getPriority().val())+":"),this.forEachChild(PRIORITY_INDEX,(a,c)=>{const h=c.hash();h!==""&&(e+=":"+a+":"+h)}),this.lazyHash_=e===""?"":sha1(e)}return this.lazyHash_}getPredecessorChildName(e,a,c){const h=this.resolveIndex_(c);if(h){const d=h.getPredecessorKey(new NamedNode(e,a));return d?d.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const a=this.resolveIndex_(e);if(a){const c=a.minKey();return c&&c.name}else return this.children_.minKey()}getFirstChild(e){const a=this.getFirstChildName(e);return a?new NamedNode(a,this.children_.get(a)):null}getLastChildName(e){const a=this.resolveIndex_(e);if(a){const c=a.maxKey();return c&&c.name}else return this.children_.maxKey()}getLastChild(e){const a=this.getLastChildName(e);return a?new NamedNode(a,this.children_.get(a)):null}forEachChild(e,a){const c=this.resolveIndex_(e);return c?c.inorderTraversal(h=>a(h.name,h.node)):this.children_.inorderTraversal(a)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,a){const c=this.resolveIndex_(a);if(c)return c.getIteratorFrom(e,h=>h);{const h=this.children_.getIteratorFrom(e.name,NamedNode.Wrap);let d=h.peek();for(;d!=null&&a.compare(d,e)<0;)h.getNext(),d=h.peek();return h}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,a){const c=this.resolveIndex_(a);if(c)return c.getReverseIteratorFrom(e,h=>h);{const h=this.children_.getReverseIteratorFrom(e.name,NamedNode.Wrap);let d=h.peek();for(;d!=null&&a.compare(d,e)>0;)h.getNext(),d=h.peek();return h}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===MAX_NODE?-1:0}withIndex(e){if(e===KEY_INDEX||this.indexMap_.hasIndex(e))return this;{const a=this.indexMap_.addIndex(e,this.children_);return new ChildrenNode(this.children_,this.priorityNode_,a)}}isIndexed(e){return e===KEY_INDEX||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const a=e;if(this.getPriority().equals(a.getPriority()))if(this.children_.count()===a.children_.count()){const c=this.getIterator(PRIORITY_INDEX),h=a.getIterator(PRIORITY_INDEX);let d=c.getNext(),et=h.getNext();for(;d&&et;){if(d.name!==et.name||!d.node.equals(et.node))return!1;d=c.getNext(),et=h.getNext()}return d===null&&et===null}else return!1;else return!1}}resolveIndex_(e){return e===KEY_INDEX?null:this.indexMap_.get(e.toString())}}ChildrenNode.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class MaxNode extends ChildrenNode{constructor(){super(new SortedMap(NAME_COMPARATOR),ChildrenNode.EMPTY_NODE,IndexMap.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return ChildrenNode.EMPTY_NODE}isEmpty(){return!1}}const MAX_NODE=new MaxNode;Object.defineProperties(NamedNode,{MIN:{value:new NamedNode(MIN_NAME,ChildrenNode.EMPTY_NODE)},MAX:{value:new NamedNode(MAX_NAME,MAX_NODE)}});KeyIndex.__EMPTY_NODE=ChildrenNode.EMPTY_NODE;LeafNode.__childrenNodeConstructor=ChildrenNode;setMaxNode$1(MAX_NODE);setMaxNode(MAX_NODE);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const USE_HINZE=!0;function nodeFromJSON(i,e=null){if(i===null)return ChildrenNode.EMPTY_NODE;if(typeof i=="object"&&".priority"in i&&(e=i[".priority"]),assert(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof i=="object"&&".value"in i&&i[".value"]!==null&&(i=i[".value"]),typeof i!="object"||".sv"in i){const a=i;return new LeafNode(a,nodeFromJSON(e))}if(!(i instanceof Array)&&USE_HINZE){const a=[];let c=!1;if(each(i,(et,ft)=>{if(et.substring(0,1)!=="."){const gt=nodeFromJSON(ft);gt.isEmpty()||(c=c||!gt.getPriority().isEmpty(),a.push(new NamedNode(et,gt)))}}),a.length===0)return ChildrenNode.EMPTY_NODE;const d=buildChildSet(a,NAME_ONLY_COMPARATOR,et=>et.name,NAME_COMPARATOR);if(c){const et=buildChildSet(a,PRIORITY_INDEX.getCompare());return new ChildrenNode(d,nodeFromJSON(e),new IndexMap({".priority":et},{".priority":PRIORITY_INDEX}))}else return new ChildrenNode(d,nodeFromJSON(e),IndexMap.Default)}else{let a=ChildrenNode.EMPTY_NODE;return each(i,(c,h)=>{if(contains(i,c)&&c.substring(0,1)!=="."){const d=nodeFromJSON(h);(d.isLeafNode()||!d.isEmpty())&&(a=a.updateImmediateChild(c,d))}}),a.updatePriority(nodeFromJSON(e))}}setNodeFromJSON(nodeFromJSON);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PathIndex extends Index{constructor(e){super(),this.indexPath_=e,assert(!pathIsEmpty(e)&&pathGetFront(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,a){const c=this.extractChild(e.node),h=this.extractChild(a.node),d=c.compareTo(h);return d===0?nameCompare(e.name,a.name):d}makePost(e,a){const c=nodeFromJSON(e),h=ChildrenNode.EMPTY_NODE.updateChild(this.indexPath_,c);return new NamedNode(a,h)}maxPost(){const e=ChildrenNode.EMPTY_NODE.updateChild(this.indexPath_,MAX_NODE);return new NamedNode(MAX_NAME,e)}toString(){return pathSlice(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ValueIndex extends Index{compare(e,a){const c=e.node.compareTo(a.node);return c===0?nameCompare(e.name,a.name):c}isDefinedOn(e){return!0}indexedValueChanged(e,a){return!e.equals(a)}minPost(){return NamedNode.MIN}maxPost(){return NamedNode.MAX}makePost(e,a){const c=nodeFromJSON(e);return new NamedNode(a,c)}toString(){return".value"}}const VALUE_INDEX=new ValueIndex;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function changeValue(i){return{type:"value",snapshotNode:i}}function changeChildAdded(i,e){return{type:"child_added",snapshotNode:e,childName:i}}function changeChildRemoved(i,e){return{type:"child_removed",snapshotNode:e,childName:i}}function changeChildChanged(i,e,a){return{type:"child_changed",snapshotNode:e,childName:i,oldSnap:a}}function changeChildMoved(i,e){return{type:"child_moved",snapshotNode:e,childName:i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IndexedFilter{constructor(e){this.index_=e}updateChild(e,a,c,h,d,et){assert(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const ft=e.getImmediateChild(a);return ft.getChild(h).equals(c.getChild(h))&&ft.isEmpty()===c.isEmpty()||(et!=null&&(c.isEmpty()?e.hasChild(a)?et.trackChildChange(changeChildRemoved(a,ft)):assert(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):ft.isEmpty()?et.trackChildChange(changeChildAdded(a,c)):et.trackChildChange(changeChildChanged(a,c,ft))),e.isLeafNode()&&c.isEmpty())?e:e.updateImmediateChild(a,c).withIndex(this.index_)}updateFullNode(e,a,c){return c!=null&&(e.isLeafNode()||e.forEachChild(PRIORITY_INDEX,(h,d)=>{a.hasChild(h)||c.trackChildChange(changeChildRemoved(h,d))}),a.isLeafNode()||a.forEachChild(PRIORITY_INDEX,(h,d)=>{if(e.hasChild(h)){const et=e.getImmediateChild(h);et.equals(d)||c.trackChildChange(changeChildChanged(h,d,et))}else c.trackChildChange(changeChildAdded(h,d))})),a.withIndex(this.index_)}updatePriority(e,a){return e.isEmpty()?ChildrenNode.EMPTY_NODE:e.updatePriority(a)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RangedFilter{constructor(e){this.indexedFilter_=new IndexedFilter(e.getIndex()),this.index_=e.getIndex(),this.startPost_=RangedFilter.getStartPost_(e),this.endPost_=RangedFilter.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const a=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,c=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return a&&c}updateChild(e,a,c,h,d,et){return this.matches(new NamedNode(a,c))||(c=ChildrenNode.EMPTY_NODE),this.indexedFilter_.updateChild(e,a,c,h,d,et)}updateFullNode(e,a,c){a.isLeafNode()&&(a=ChildrenNode.EMPTY_NODE);let h=a.withIndex(this.index_);h=h.updatePriority(ChildrenNode.EMPTY_NODE);const d=this;return a.forEachChild(PRIORITY_INDEX,(et,ft)=>{d.matches(new NamedNode(et,ft))||(h=h.updateImmediateChild(et,ChildrenNode.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,h,c)}updatePriority(e,a){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const a=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),a)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const a=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),a)}else return e.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LimitedFilter{constructor(e){this.withinDirectionalStart=a=>this.reverse_?this.withinEndPost(a):this.withinStartPost(a),this.withinDirectionalEnd=a=>this.reverse_?this.withinStartPost(a):this.withinEndPost(a),this.withinStartPost=a=>{const c=this.index_.compare(this.rangedFilter_.getStartPost(),a);return this.startIsInclusive_?c<=0:c<0},this.withinEndPost=a=>{const c=this.index_.compare(a,this.rangedFilter_.getEndPost());return this.endIsInclusive_?c<=0:c<0},this.rangedFilter_=new RangedFilter(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,a,c,h,d,et){return this.rangedFilter_.matches(new NamedNode(a,c))||(c=ChildrenNode.EMPTY_NODE),e.getImmediateChild(a).equals(c)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,a,c,h,d,et):this.fullLimitUpdateChild_(e,a,c,d,et)}updateFullNode(e,a,c){let h;if(a.isLeafNode()||a.isEmpty())h=ChildrenNode.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<a.numChildren()&&a.isIndexed(this.index_)){h=ChildrenNode.EMPTY_NODE.withIndex(this.index_);let d;this.reverse_?d=a.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):d=a.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let et=0;for(;d.hasNext()&&et<this.limit_;){const ft=d.getNext();if(this.withinDirectionalStart(ft))if(this.withinDirectionalEnd(ft))h=h.updateImmediateChild(ft.name,ft.node),et++;else break;else continue}}else{h=a.withIndex(this.index_),h=h.updatePriority(ChildrenNode.EMPTY_NODE);let d;this.reverse_?d=h.getReverseIterator(this.index_):d=h.getIterator(this.index_);let et=0;for(;d.hasNext();){const ft=d.getNext();et<this.limit_&&this.withinDirectionalStart(ft)&&this.withinDirectionalEnd(ft)?et++:h=h.updateImmediateChild(ft.name,ChildrenNode.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,h,c)}updatePriority(e,a){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,a,c,h,d){let et;if(this.reverse_){const $t=this.index_.getCompare();et=(It,Rt)=>$t(Rt,It)}else et=this.index_.getCompare();const ft=e;assert(ft.numChildren()===this.limit_,"");const gt=new NamedNode(a,c),_t=this.reverse_?ft.getFirstChild(this.index_):ft.getLastChild(this.index_),wt=this.rangedFilter_.matches(gt);if(ft.hasChild(a)){const $t=ft.getImmediateChild(a);let It=h.getChildAfterChild(this.index_,_t,this.reverse_);for(;It!=null&&(It.name===a||ft.hasChild(It.name));)It=h.getChildAfterChild(this.index_,It,this.reverse_);const Rt=It==null?1:et(It,gt);if(wt&&!c.isEmpty()&&Rt>=0)return d!=null&&d.trackChildChange(changeChildChanged(a,c,$t)),ft.updateImmediateChild(a,c);{d!=null&&d.trackChildChange(changeChildRemoved(a,$t));const At=ft.updateImmediateChild(a,ChildrenNode.EMPTY_NODE);return It!=null&&this.rangedFilter_.matches(It)?(d!=null&&d.trackChildChange(changeChildAdded(It.name,It.node)),At.updateImmediateChild(It.name,It.node)):At}}else return c.isEmpty()?e:wt&&et(_t,gt)>=0?(d!=null&&(d.trackChildChange(changeChildRemoved(_t.name,_t.node)),d.trackChildChange(changeChildAdded(a,c))),ft.updateImmediateChild(a,c).updateImmediateChild(_t.name,ChildrenNode.EMPTY_NODE)):e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QueryParams{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=PRIORITY_INDEX}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return assert(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return assert(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:MIN_NAME}hasEnd(){return this.endSet_}getIndexEndValue(){return assert(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return assert(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:MAX_NAME}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return assert(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===PRIORITY_INDEX}copy(){const e=new QueryParams;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function queryParamsGetNodeFilter(i){return i.loadsAllData()?new IndexedFilter(i.getIndex()):i.hasLimit()?new LimitedFilter(i):new RangedFilter(i)}function queryParamsToRestQueryStringParameters(i){const e={};if(i.isDefault())return e;let a;if(i.index_===PRIORITY_INDEX?a="$priority":i.index_===VALUE_INDEX?a="$value":i.index_===KEY_INDEX?a="$key":(assert(i.index_ instanceof PathIndex,"Unrecognized index type!"),a=i.index_.toString()),e.orderBy=stringify(a),i.startSet_){const c=i.startAfterSet_?"startAfter":"startAt";e[c]=stringify(i.indexStartValue_),i.startNameSet_&&(e[c]+=","+stringify(i.indexStartName_))}if(i.endSet_){const c=i.endBeforeSet_?"endBefore":"endAt";e[c]=stringify(i.indexEndValue_),i.endNameSet_&&(e[c]+=","+stringify(i.indexEndName_))}return i.limitSet_&&(i.isViewFromLeft()?e.limitToFirst=i.limit_:e.limitToLast=i.limit_),e}function queryParamsGetQueryObject(i){const e={};if(i.startSet_&&(e.sp=i.indexStartValue_,i.startNameSet_&&(e.sn=i.indexStartName_),e.sin=!i.startAfterSet_),i.endSet_&&(e.ep=i.indexEndValue_,i.endNameSet_&&(e.en=i.indexEndName_),e.ein=!i.endBeforeSet_),i.limitSet_){e.l=i.limit_;let a=i.viewFrom_;a===""&&(i.isViewFromLeft()?a="l":a="r"),e.vf=a}return i.index_!==PRIORITY_INDEX&&(e.i=i.index_.toString()),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ReadonlyRestClient extends ServerActions{constructor(e,a,c,h){super(),this.repoInfo_=e,this.onDataUpdate_=a,this.authTokenProvider_=c,this.appCheckTokenProvider_=h,this.log_=logWrapper("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,a){return a!==void 0?"tag$"+a:(assert(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,a,c,h){const d=e._path.toString();this.log_("Listen called for "+d+" "+e._queryIdentifier);const et=ReadonlyRestClient.getListenId_(e,c),ft={};this.listens_[et]=ft;const gt=queryParamsToRestQueryStringParameters(e._queryParams);this.restRequest_(d+".json",gt,(_t,wt)=>{let $t=wt;if(_t===404&&($t=null,_t=null),_t===null&&this.onDataUpdate_(d,$t,!1,c),safeGet(this.listens_,et)===ft){let It;_t?_t===401?It="permission_denied":It="rest_error:"+_t:It="ok",h(It,null)}})}unlisten(e,a){const c=ReadonlyRestClient.getListenId_(e,a);delete this.listens_[c]}get(e){const a=queryParamsToRestQueryStringParameters(e._queryParams),c=e._path.toString(),h=new Deferred;return this.restRequest_(c+".json",a,(d,et)=>{let ft=et;d===404&&(ft=null,d=null),d===null?(this.onDataUpdate_(c,ft,!1,null),h.resolve(ft)):h.reject(new Error(ft))}),h.promise}refreshAuthToken(e){}restRequest_(e,a={},c){return a.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([h,d])=>{h&&h.accessToken&&(a.auth=h.accessToken),d&&d.token&&(a.ac=d.token);const et=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+querystring(a);this.log_("Sending REST request for "+et);const ft=new XMLHttpRequest;ft.onreadystatechange=()=>{if(c&&ft.readyState===4){this.log_("REST Response for "+et+" received. status:",ft.status,"response:",ft.responseText);let gt=null;if(ft.status>=200&&ft.status<300){try{gt=jsonEval(ft.responseText)}catch{warn("Failed to parse JSON response for "+et+": "+ft.responseText)}c(null,gt)}else ft.status!==401&&ft.status!==404&&warn("Got unsuccessful REST response for "+et+" Status: "+ft.status),c(ft.status);c=null}},ft.open("GET",et,!0),ft.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SnapshotHolder{constructor(){this.rootNode_=ChildrenNode.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,a){this.rootNode_=this.rootNode_.updateChild(e,a)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function newSparseSnapshotTree(){return{value:null,children:new Map}}function sparseSnapshotTreeRemember(i,e,a){if(pathIsEmpty(e))i.value=a,i.children.clear();else if(i.value!==null)i.value=i.value.updateChild(e,a);else{const c=pathGetFront(e);i.children.has(c)||i.children.set(c,newSparseSnapshotTree());const h=i.children.get(c);e=pathPopFront(e),sparseSnapshotTreeRemember(h,e,a)}}function sparseSnapshotTreeForget(i,e){if(pathIsEmpty(e))return i.value=null,i.children.clear(),!0;if(i.value!==null){if(i.value.isLeafNode())return!1;{const a=i.value;return i.value=null,a.forEachChild(PRIORITY_INDEX,(c,h)=>{sparseSnapshotTreeRemember(i,new Path(c),h)}),sparseSnapshotTreeForget(i,e)}}else if(i.children.size>0){const a=pathGetFront(e);return e=pathPopFront(e),i.children.has(a)&&sparseSnapshotTreeForget(i.children.get(a),e)&&i.children.delete(a),i.children.size===0}else return!0}function sparseSnapshotTreeForEachTree(i,e,a){i.value!==null?a(e,i.value):sparseSnapshotTreeForEachChild(i,(c,h)=>{const d=new Path(e.toString()+"/"+c);sparseSnapshotTreeForEachTree(h,d,a)})}function sparseSnapshotTreeForEachChild(i,e){i.children.forEach((a,c)=>{e(c,a)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class StatsListener{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),a=Object.assign({},e);return this.last_&&each(this.last_,(c,h)=>{a[c]=a[c]-h}),this.last_=e,a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FIRST_STATS_MIN_TIME=10*1e3,FIRST_STATS_MAX_TIME=30*1e3,REPORT_STATS_INTERVAL=5*60*1e3;class StatsReporter{constructor(e,a){this.server_=a,this.statsToReport_={},this.statsListener_=new StatsListener(e);const c=FIRST_STATS_MIN_TIME+(FIRST_STATS_MAX_TIME-FIRST_STATS_MIN_TIME)*Math.random();setTimeoutNonBlocking(this.reportStats_.bind(this),Math.floor(c))}reportStats_(){const e=this.statsListener_.get(),a={};let c=!1;each(e,(h,d)=>{d>0&&contains(this.statsToReport_,h)&&(a[h]=d,c=!0)}),c&&this.server_.reportStats(a),setTimeoutNonBlocking(this.reportStats_.bind(this),Math.floor(Math.random()*2*REPORT_STATS_INTERVAL))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var OperationType;(function(i){i[i.OVERWRITE=0]="OVERWRITE",i[i.MERGE=1]="MERGE",i[i.ACK_USER_WRITE=2]="ACK_USER_WRITE",i[i.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(OperationType||(OperationType={}));function newOperationSourceUser(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function newOperationSourceServer(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function newOperationSourceServerTaggedQuery(i){return{fromUser:!1,fromServer:!0,queryId:i,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AckUserWrite{constructor(e,a,c){this.path=e,this.affectedTree=a,this.revert=c,this.type=OperationType.ACK_USER_WRITE,this.source=newOperationSourceUser()}operationForChild(e){if(pathIsEmpty(this.path)){if(this.affectedTree.value!=null)return assert(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const a=this.affectedTree.subtree(new Path(e));return new AckUserWrite(newEmptyPath(),a,this.revert)}}else return assert(pathGetFront(this.path)===e,"operationForChild called for unrelated child."),new AckUserWrite(pathPopFront(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ListenComplete{constructor(e,a){this.source=e,this.path=a,this.type=OperationType.LISTEN_COMPLETE}operationForChild(e){return pathIsEmpty(this.path)?new ListenComplete(this.source,newEmptyPath()):new ListenComplete(this.source,pathPopFront(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Overwrite{constructor(e,a,c){this.source=e,this.path=a,this.snap=c,this.type=OperationType.OVERWRITE}operationForChild(e){return pathIsEmpty(this.path)?new Overwrite(this.source,newEmptyPath(),this.snap.getImmediateChild(e)):new Overwrite(this.source,pathPopFront(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Merge{constructor(e,a,c){this.source=e,this.path=a,this.children=c,this.type=OperationType.MERGE}operationForChild(e){if(pathIsEmpty(this.path)){const a=this.children.subtree(new Path(e));return a.isEmpty()?null:a.value?new Overwrite(this.source,newEmptyPath(),a.value):new Merge(this.source,newEmptyPath(),a)}else return assert(pathGetFront(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new Merge(this.source,pathPopFront(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CacheNode{constructor(e,a,c){this.node_=e,this.fullyInitialized_=a,this.filtered_=c}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(pathIsEmpty(e))return this.isFullyInitialized()&&!this.filtered_;const a=pathGetFront(e);return this.isCompleteForChild(a)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EventGenerator{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function eventGeneratorGenerateEventsForChanges(i,e,a,c){const h=[],d=[];return e.forEach(et=>{et.type==="child_changed"&&i.index_.indexedValueChanged(et.oldSnap,et.snapshotNode)&&d.push(changeChildMoved(et.childName,et.snapshotNode))}),eventGeneratorGenerateEventsForType(i,h,"child_removed",e,c,a),eventGeneratorGenerateEventsForType(i,h,"child_added",e,c,a),eventGeneratorGenerateEventsForType(i,h,"child_moved",d,c,a),eventGeneratorGenerateEventsForType(i,h,"child_changed",e,c,a),eventGeneratorGenerateEventsForType(i,h,"value",e,c,a),h}function eventGeneratorGenerateEventsForType(i,e,a,c,h,d){const et=c.filter(ft=>ft.type===a);et.sort((ft,gt)=>eventGeneratorCompareChanges(i,ft,gt)),et.forEach(ft=>{const gt=eventGeneratorMaterializeSingleChange(i,ft,d);h.forEach(_t=>{_t.respondsTo(ft.type)&&e.push(_t.createEvent(gt,i.query_))})})}function eventGeneratorMaterializeSingleChange(i,e,a){return e.type==="value"||e.type==="child_removed"||(e.prevName=a.getPredecessorChildName(e.childName,e.snapshotNode,i.index_)),e}function eventGeneratorCompareChanges(i,e,a){if(e.childName==null||a.childName==null)throw assertionError("Should only compare child_ events.");const c=new NamedNode(e.childName,e.snapshotNode),h=new NamedNode(a.childName,a.snapshotNode);return i.index_.compare(c,h)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function newViewCache(i,e){return{eventCache:i,serverCache:e}}function viewCacheUpdateEventSnap(i,e,a,c){return newViewCache(new CacheNode(e,a,c),i.serverCache)}function viewCacheUpdateServerSnap(i,e,a,c){return newViewCache(i.eventCache,new CacheNode(e,a,c))}function viewCacheGetCompleteEventSnap(i){return i.eventCache.isFullyInitialized()?i.eventCache.getNode():null}function viewCacheGetCompleteServerSnap(i){return i.serverCache.isFullyInitialized()?i.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let emptyChildrenSingleton;const EmptyChildren=()=>(emptyChildrenSingleton||(emptyChildrenSingleton=new SortedMap(stringCompare)),emptyChildrenSingleton);class ImmutableTree{constructor(e,a=EmptyChildren()){this.value=e,this.children=a}static fromObject(e){let a=new ImmutableTree(null);return each(e,(c,h)=>{a=a.set(new Path(c),h)}),a}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,a){if(this.value!=null&&a(this.value))return{path:newEmptyPath(),value:this.value};if(pathIsEmpty(e))return null;{const c=pathGetFront(e),h=this.children.get(c);if(h!==null){const d=h.findRootMostMatchingPathAndValue(pathPopFront(e),a);return d!=null?{path:pathChild(new Path(c),d.path),value:d.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(pathIsEmpty(e))return this;{const a=pathGetFront(e),c=this.children.get(a);return c!==null?c.subtree(pathPopFront(e)):new ImmutableTree(null)}}set(e,a){if(pathIsEmpty(e))return new ImmutableTree(a,this.children);{const c=pathGetFront(e),d=(this.children.get(c)||new ImmutableTree(null)).set(pathPopFront(e),a),et=this.children.insert(c,d);return new ImmutableTree(this.value,et)}}remove(e){if(pathIsEmpty(e))return this.children.isEmpty()?new ImmutableTree(null):new ImmutableTree(null,this.children);{const a=pathGetFront(e),c=this.children.get(a);if(c){const h=c.remove(pathPopFront(e));let d;return h.isEmpty()?d=this.children.remove(a):d=this.children.insert(a,h),this.value===null&&d.isEmpty()?new ImmutableTree(null):new ImmutableTree(this.value,d)}else return this}}get(e){if(pathIsEmpty(e))return this.value;{const a=pathGetFront(e),c=this.children.get(a);return c?c.get(pathPopFront(e)):null}}setTree(e,a){if(pathIsEmpty(e))return a;{const c=pathGetFront(e),d=(this.children.get(c)||new ImmutableTree(null)).setTree(pathPopFront(e),a);let et;return d.isEmpty()?et=this.children.remove(c):et=this.children.insert(c,d),new ImmutableTree(this.value,et)}}fold(e){return this.fold_(newEmptyPath(),e)}fold_(e,a){const c={};return this.children.inorderTraversal((h,d)=>{c[h]=d.fold_(pathChild(e,h),a)}),a(e,this.value,c)}findOnPath(e,a){return this.findOnPath_(e,newEmptyPath(),a)}findOnPath_(e,a,c){const h=this.value?c(a,this.value):!1;if(h)return h;if(pathIsEmpty(e))return null;{const d=pathGetFront(e),et=this.children.get(d);return et?et.findOnPath_(pathPopFront(e),pathChild(a,d),c):null}}foreachOnPath(e,a){return this.foreachOnPath_(e,newEmptyPath(),a)}foreachOnPath_(e,a,c){if(pathIsEmpty(e))return this;{this.value&&c(a,this.value);const h=pathGetFront(e),d=this.children.get(h);return d?d.foreachOnPath_(pathPopFront(e),pathChild(a,h),c):new ImmutableTree(null)}}foreach(e){this.foreach_(newEmptyPath(),e)}foreach_(e,a){this.children.inorderTraversal((c,h)=>{h.foreach_(pathChild(e,c),a)}),this.value&&a(e,this.value)}foreachChild(e){this.children.inorderTraversal((a,c)=>{c.value&&e(a,c.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CompoundWrite{constructor(e){this.writeTree_=e}static empty(){return new CompoundWrite(new ImmutableTree(null))}}function compoundWriteAddWrite(i,e,a){if(pathIsEmpty(e))return new CompoundWrite(new ImmutableTree(a));{const c=i.writeTree_.findRootMostValueAndPath(e);if(c!=null){const h=c.path;let d=c.value;const et=newRelativePath(h,e);return d=d.updateChild(et,a),new CompoundWrite(i.writeTree_.set(h,d))}else{const h=new ImmutableTree(a),d=i.writeTree_.setTree(e,h);return new CompoundWrite(d)}}}function compoundWriteAddWrites(i,e,a){let c=i;return each(a,(h,d)=>{c=compoundWriteAddWrite(c,pathChild(e,h),d)}),c}function compoundWriteRemoveWrite(i,e){if(pathIsEmpty(e))return CompoundWrite.empty();{const a=i.writeTree_.setTree(e,new ImmutableTree(null));return new CompoundWrite(a)}}function compoundWriteHasCompleteWrite(i,e){return compoundWriteGetCompleteNode(i,e)!=null}function compoundWriteGetCompleteNode(i,e){const a=i.writeTree_.findRootMostValueAndPath(e);return a!=null?i.writeTree_.get(a.path).getChild(newRelativePath(a.path,e)):null}function compoundWriteGetCompleteChildren(i){const e=[],a=i.writeTree_.value;return a!=null?a.isLeafNode()||a.forEachChild(PRIORITY_INDEX,(c,h)=>{e.push(new NamedNode(c,h))}):i.writeTree_.children.inorderTraversal((c,h)=>{h.value!=null&&e.push(new NamedNode(c,h.value))}),e}function compoundWriteChildCompoundWrite(i,e){if(pathIsEmpty(e))return i;{const a=compoundWriteGetCompleteNode(i,e);return a!=null?new CompoundWrite(new ImmutableTree(a)):new CompoundWrite(i.writeTree_.subtree(e))}}function compoundWriteIsEmpty(i){return i.writeTree_.isEmpty()}function compoundWriteApply(i,e){return applySubtreeWrite(newEmptyPath(),i.writeTree_,e)}function applySubtreeWrite(i,e,a){if(e.value!=null)return a.updateChild(i,e.value);{let c=null;return e.children.inorderTraversal((h,d)=>{h===".priority"?(assert(d.value!==null,"Priority writes must always be leaf nodes"),c=d.value):a=applySubtreeWrite(pathChild(i,h),d,a)}),!a.getChild(i).isEmpty()&&c!==null&&(a=a.updateChild(pathChild(i,".priority"),c)),a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function writeTreeChildWrites(i,e){return newWriteTreeRef(e,i)}function writeTreeAddOverwrite(i,e,a,c,h){assert(c>i.lastWriteId,"Stacking an older write on top of newer ones"),h===void 0&&(h=!0),i.allWrites.push({path:e,snap:a,writeId:c,visible:h}),h&&(i.visibleWrites=compoundWriteAddWrite(i.visibleWrites,e,a)),i.lastWriteId=c}function writeTreeGetWrite(i,e){for(let a=0;a<i.allWrites.length;a++){const c=i.allWrites[a];if(c.writeId===e)return c}return null}function writeTreeRemoveWrite(i,e){const a=i.allWrites.findIndex(ft=>ft.writeId===e);assert(a>=0,"removeWrite called with nonexistent writeId.");const c=i.allWrites[a];i.allWrites.splice(a,1);let h=c.visible,d=!1,et=i.allWrites.length-1;for(;h&&et>=0;){const ft=i.allWrites[et];ft.visible&&(et>=a&&writeTreeRecordContainsPath_(ft,c.path)?h=!1:pathContains(c.path,ft.path)&&(d=!0)),et--}if(h){if(d)return writeTreeResetTree_(i),!0;if(c.snap)i.visibleWrites=compoundWriteRemoveWrite(i.visibleWrites,c.path);else{const ft=c.children;each(ft,gt=>{i.visibleWrites=compoundWriteRemoveWrite(i.visibleWrites,pathChild(c.path,gt))})}return!0}else return!1}function writeTreeRecordContainsPath_(i,e){if(i.snap)return pathContains(i.path,e);for(const a in i.children)if(i.children.hasOwnProperty(a)&&pathContains(pathChild(i.path,a),e))return!0;return!1}function writeTreeResetTree_(i){i.visibleWrites=writeTreeLayerTree_(i.allWrites,writeTreeDefaultFilter_,newEmptyPath()),i.allWrites.length>0?i.lastWriteId=i.allWrites[i.allWrites.length-1].writeId:i.lastWriteId=-1}function writeTreeDefaultFilter_(i){return i.visible}function writeTreeLayerTree_(i,e,a){let c=CompoundWrite.empty();for(let h=0;h<i.length;++h){const d=i[h];if(e(d)){const et=d.path;let ft;if(d.snap)pathContains(a,et)?(ft=newRelativePath(a,et),c=compoundWriteAddWrite(c,ft,d.snap)):pathContains(et,a)&&(ft=newRelativePath(et,a),c=compoundWriteAddWrite(c,newEmptyPath(),d.snap.getChild(ft)));else if(d.children){if(pathContains(a,et))ft=newRelativePath(a,et),c=compoundWriteAddWrites(c,ft,d.children);else if(pathContains(et,a))if(ft=newRelativePath(et,a),pathIsEmpty(ft))c=compoundWriteAddWrites(c,newEmptyPath(),d.children);else{const gt=safeGet(d.children,pathGetFront(ft));if(gt){const _t=gt.getChild(pathPopFront(ft));c=compoundWriteAddWrite(c,newEmptyPath(),_t)}}}else throw assertionError("WriteRecord should have .snap or .children")}}return c}function writeTreeCalcCompleteEventCache(i,e,a,c,h){if(!c&&!h){const d=compoundWriteGetCompleteNode(i.visibleWrites,e);if(d!=null)return d;{const et=compoundWriteChildCompoundWrite(i.visibleWrites,e);if(compoundWriteIsEmpty(et))return a;if(a==null&&!compoundWriteHasCompleteWrite(et,newEmptyPath()))return null;{const ft=a||ChildrenNode.EMPTY_NODE;return compoundWriteApply(et,ft)}}}else{const d=compoundWriteChildCompoundWrite(i.visibleWrites,e);if(!h&&compoundWriteIsEmpty(d))return a;if(!h&&a==null&&!compoundWriteHasCompleteWrite(d,newEmptyPath()))return null;{const et=function(_t){return(_t.visible||h)&&(!c||!~c.indexOf(_t.writeId))&&(pathContains(_t.path,e)||pathContains(e,_t.path))},ft=writeTreeLayerTree_(i.allWrites,et,e),gt=a||ChildrenNode.EMPTY_NODE;return compoundWriteApply(ft,gt)}}}function writeTreeCalcCompleteEventChildren(i,e,a){let c=ChildrenNode.EMPTY_NODE;const h=compoundWriteGetCompleteNode(i.visibleWrites,e);if(h)return h.isLeafNode()||h.forEachChild(PRIORITY_INDEX,(d,et)=>{c=c.updateImmediateChild(d,et)}),c;if(a){const d=compoundWriteChildCompoundWrite(i.visibleWrites,e);return a.forEachChild(PRIORITY_INDEX,(et,ft)=>{const gt=compoundWriteApply(compoundWriteChildCompoundWrite(d,new Path(et)),ft);c=c.updateImmediateChild(et,gt)}),compoundWriteGetCompleteChildren(d).forEach(et=>{c=c.updateImmediateChild(et.name,et.node)}),c}else{const d=compoundWriteChildCompoundWrite(i.visibleWrites,e);return compoundWriteGetCompleteChildren(d).forEach(et=>{c=c.updateImmediateChild(et.name,et.node)}),c}}function writeTreeCalcEventCacheAfterServerOverwrite(i,e,a,c,h){assert(c||h,"Either existingEventSnap or existingServerSnap must exist");const d=pathChild(e,a);if(compoundWriteHasCompleteWrite(i.visibleWrites,d))return null;{const et=compoundWriteChildCompoundWrite(i.visibleWrites,d);return compoundWriteIsEmpty(et)?h.getChild(a):compoundWriteApply(et,h.getChild(a))}}function writeTreeCalcCompleteChild(i,e,a,c){const h=pathChild(e,a),d=compoundWriteGetCompleteNode(i.visibleWrites,h);if(d!=null)return d;if(c.isCompleteForChild(a)){const et=compoundWriteChildCompoundWrite(i.visibleWrites,h);return compoundWriteApply(et,c.getNode().getImmediateChild(a))}else return null}function writeTreeShadowingWrite(i,e){return compoundWriteGetCompleteNode(i.visibleWrites,e)}function writeTreeCalcIndexedSlice(i,e,a,c,h,d,et){let ft;const gt=compoundWriteChildCompoundWrite(i.visibleWrites,e),_t=compoundWriteGetCompleteNode(gt,newEmptyPath());if(_t!=null)ft=_t;else if(a!=null)ft=compoundWriteApply(gt,a);else return[];if(ft=ft.withIndex(et),!ft.isEmpty()&&!ft.isLeafNode()){const wt=[],$t=et.getCompare(),It=d?ft.getReverseIteratorFrom(c,et):ft.getIteratorFrom(c,et);let Rt=It.getNext();for(;Rt&&wt.length<h;)$t(Rt,c)!==0&&wt.push(Rt),Rt=It.getNext();return wt}else return[]}function newWriteTree(){return{visibleWrites:CompoundWrite.empty(),allWrites:[],lastWriteId:-1}}function writeTreeRefCalcCompleteEventCache(i,e,a,c){return writeTreeCalcCompleteEventCache(i.writeTree,i.treePath,e,a,c)}function writeTreeRefCalcCompleteEventChildren(i,e){return writeTreeCalcCompleteEventChildren(i.writeTree,i.treePath,e)}function writeTreeRefCalcEventCacheAfterServerOverwrite(i,e,a,c){return writeTreeCalcEventCacheAfterServerOverwrite(i.writeTree,i.treePath,e,a,c)}function writeTreeRefShadowingWrite(i,e){return writeTreeShadowingWrite(i.writeTree,pathChild(i.treePath,e))}function writeTreeRefCalcIndexedSlice(i,e,a,c,h,d){return writeTreeCalcIndexedSlice(i.writeTree,i.treePath,e,a,c,h,d)}function writeTreeRefCalcCompleteChild(i,e,a){return writeTreeCalcCompleteChild(i.writeTree,i.treePath,e,a)}function writeTreeRefChild(i,e){return newWriteTreeRef(pathChild(i.treePath,e),i.writeTree)}function newWriteTreeRef(i,e){return{treePath:i,writeTree:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ChildChangeAccumulator{constructor(){this.changeMap=new Map}trackChildChange(e){const a=e.type,c=e.childName;assert(a==="child_added"||a==="child_changed"||a==="child_removed","Only child changes supported for tracking"),assert(c!==".priority","Only non-priority child changes can be tracked.");const h=this.changeMap.get(c);if(h){const d=h.type;if(a==="child_added"&&d==="child_removed")this.changeMap.set(c,changeChildChanged(c,e.snapshotNode,h.snapshotNode));else if(a==="child_removed"&&d==="child_added")this.changeMap.delete(c);else if(a==="child_removed"&&d==="child_changed")this.changeMap.set(c,changeChildRemoved(c,h.oldSnap));else if(a==="child_changed"&&d==="child_added")this.changeMap.set(c,changeChildAdded(c,e.snapshotNode));else if(a==="child_changed"&&d==="child_changed")this.changeMap.set(c,changeChildChanged(c,e.snapshotNode,h.oldSnap));else throw assertionError("Illegal combination of changes: "+e+" occurred after "+h)}else this.changeMap.set(c,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NoCompleteChildSource_{getCompleteChild(e){return null}getChildAfterChild(e,a,c){return null}}const NO_COMPLETE_CHILD_SOURCE=new NoCompleteChildSource_;class WriteTreeCompleteChildSource{constructor(e,a,c=null){this.writes_=e,this.viewCache_=a,this.optCompleteServerCache_=c}getCompleteChild(e){const a=this.viewCache_.eventCache;if(a.isCompleteForChild(e))return a.getNode().getImmediateChild(e);{const c=this.optCompleteServerCache_!=null?new CacheNode(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return writeTreeRefCalcCompleteChild(this.writes_,e,c)}}getChildAfterChild(e,a,c){const h=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:viewCacheGetCompleteServerSnap(this.viewCache_),d=writeTreeRefCalcIndexedSlice(this.writes_,h,a,1,c,e);return d.length===0?null:d[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function newViewProcessor(i){return{filter:i}}function viewProcessorAssertIndexed(i,e){assert(e.eventCache.getNode().isIndexed(i.filter.getIndex()),"Event snap not indexed"),assert(e.serverCache.getNode().isIndexed(i.filter.getIndex()),"Server snap not indexed")}function viewProcessorApplyOperation(i,e,a,c,h){const d=new ChildChangeAccumulator;let et,ft;if(a.type===OperationType.OVERWRITE){const _t=a;_t.source.fromUser?et=viewProcessorApplyUserOverwrite(i,e,_t.path,_t.snap,c,h,d):(assert(_t.source.fromServer,"Unknown source."),ft=_t.source.tagged||e.serverCache.isFiltered()&&!pathIsEmpty(_t.path),et=viewProcessorApplyServerOverwrite(i,e,_t.path,_t.snap,c,h,ft,d))}else if(a.type===OperationType.MERGE){const _t=a;_t.source.fromUser?et=viewProcessorApplyUserMerge(i,e,_t.path,_t.children,c,h,d):(assert(_t.source.fromServer,"Unknown source."),ft=_t.source.tagged||e.serverCache.isFiltered(),et=viewProcessorApplyServerMerge(i,e,_t.path,_t.children,c,h,ft,d))}else if(a.type===OperationType.ACK_USER_WRITE){const _t=a;_t.revert?et=viewProcessorRevertUserWrite(i,e,_t.path,c,h,d):et=viewProcessorAckUserWrite(i,e,_t.path,_t.affectedTree,c,h,d)}else if(a.type===OperationType.LISTEN_COMPLETE)et=viewProcessorListenComplete(i,e,a.path,c,d);else throw assertionError("Unknown operation type: "+a.type);const gt=d.getChanges();return viewProcessorMaybeAddValueEvent(e,et,gt),{viewCache:et,changes:gt}}function viewProcessorMaybeAddValueEvent(i,e,a){const c=e.eventCache;if(c.isFullyInitialized()){const h=c.getNode().isLeafNode()||c.getNode().isEmpty(),d=viewCacheGetCompleteEventSnap(i);(a.length>0||!i.eventCache.isFullyInitialized()||h&&!c.getNode().equals(d)||!c.getNode().getPriority().equals(d.getPriority()))&&a.push(changeValue(viewCacheGetCompleteEventSnap(e)))}}function viewProcessorGenerateEventCacheAfterServerEvent(i,e,a,c,h,d){const et=e.eventCache;if(writeTreeRefShadowingWrite(c,a)!=null)return e;{let ft,gt;if(pathIsEmpty(a))if(assert(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const _t=viewCacheGetCompleteServerSnap(e),wt=_t instanceof ChildrenNode?_t:ChildrenNode.EMPTY_NODE,$t=writeTreeRefCalcCompleteEventChildren(c,wt);ft=i.filter.updateFullNode(e.eventCache.getNode(),$t,d)}else{const _t=writeTreeRefCalcCompleteEventCache(c,viewCacheGetCompleteServerSnap(e));ft=i.filter.updateFullNode(e.eventCache.getNode(),_t,d)}else{const _t=pathGetFront(a);if(_t===".priority"){assert(pathGetLength(a)===1,"Can't have a priority with additional path components");const wt=et.getNode();gt=e.serverCache.getNode();const $t=writeTreeRefCalcEventCacheAfterServerOverwrite(c,a,wt,gt);$t!=null?ft=i.filter.updatePriority(wt,$t):ft=et.getNode()}else{const wt=pathPopFront(a);let $t;if(et.isCompleteForChild(_t)){gt=e.serverCache.getNode();const It=writeTreeRefCalcEventCacheAfterServerOverwrite(c,a,et.getNode(),gt);It!=null?$t=et.getNode().getImmediateChild(_t).updateChild(wt,It):$t=et.getNode().getImmediateChild(_t)}else $t=writeTreeRefCalcCompleteChild(c,_t,e.serverCache);$t!=null?ft=i.filter.updateChild(et.getNode(),_t,$t,wt,h,d):ft=et.getNode()}}return viewCacheUpdateEventSnap(e,ft,et.isFullyInitialized()||pathIsEmpty(a),i.filter.filtersNodes())}}function viewProcessorApplyServerOverwrite(i,e,a,c,h,d,et,ft){const gt=e.serverCache;let _t;const wt=et?i.filter:i.filter.getIndexedFilter();if(pathIsEmpty(a))_t=wt.updateFullNode(gt.getNode(),c,null);else if(wt.filtersNodes()&&!gt.isFiltered()){const Rt=gt.getNode().updateChild(a,c);_t=wt.updateFullNode(gt.getNode(),Rt,null)}else{const Rt=pathGetFront(a);if(!gt.isCompleteForPath(a)&&pathGetLength(a)>1)return e;const Tt=pathPopFront(a),kt=gt.getNode().getImmediateChild(Rt).updateChild(Tt,c);Rt===".priority"?_t=wt.updatePriority(gt.getNode(),kt):_t=wt.updateChild(gt.getNode(),Rt,kt,Tt,NO_COMPLETE_CHILD_SOURCE,null)}const $t=viewCacheUpdateServerSnap(e,_t,gt.isFullyInitialized()||pathIsEmpty(a),wt.filtersNodes()),It=new WriteTreeCompleteChildSource(h,$t,d);return viewProcessorGenerateEventCacheAfterServerEvent(i,$t,a,h,It,ft)}function viewProcessorApplyUserOverwrite(i,e,a,c,h,d,et){const ft=e.eventCache;let gt,_t;const wt=new WriteTreeCompleteChildSource(h,e,d);if(pathIsEmpty(a))_t=i.filter.updateFullNode(e.eventCache.getNode(),c,et),gt=viewCacheUpdateEventSnap(e,_t,!0,i.filter.filtersNodes());else{const $t=pathGetFront(a);if($t===".priority")_t=i.filter.updatePriority(e.eventCache.getNode(),c),gt=viewCacheUpdateEventSnap(e,_t,ft.isFullyInitialized(),ft.isFiltered());else{const It=pathPopFront(a),Rt=ft.getNode().getImmediateChild($t);let Tt;if(pathIsEmpty(It))Tt=c;else{const At=wt.getCompleteChild($t);At!=null?pathGetBack(It)===".priority"&&At.getChild(pathParent(It)).isEmpty()?Tt=At:Tt=At.updateChild(It,c):Tt=ChildrenNode.EMPTY_NODE}if(Rt.equals(Tt))gt=e;else{const At=i.filter.updateChild(ft.getNode(),$t,Tt,It,wt,et);gt=viewCacheUpdateEventSnap(e,At,ft.isFullyInitialized(),i.filter.filtersNodes())}}}return gt}function viewProcessorCacheHasChild(i,e){return i.eventCache.isCompleteForChild(e)}function viewProcessorApplyUserMerge(i,e,a,c,h,d,et){let ft=e;return c.foreach((gt,_t)=>{const wt=pathChild(a,gt);viewProcessorCacheHasChild(e,pathGetFront(wt))&&(ft=viewProcessorApplyUserOverwrite(i,ft,wt,_t,h,d,et))}),c.foreach((gt,_t)=>{const wt=pathChild(a,gt);viewProcessorCacheHasChild(e,pathGetFront(wt))||(ft=viewProcessorApplyUserOverwrite(i,ft,wt,_t,h,d,et))}),ft}function viewProcessorApplyMerge(i,e,a){return a.foreach((c,h)=>{e=e.updateChild(c,h)}),e}function viewProcessorApplyServerMerge(i,e,a,c,h,d,et,ft){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let gt=e,_t;pathIsEmpty(a)?_t=c:_t=new ImmutableTree(null).setTree(a,c);const wt=e.serverCache.getNode();return _t.children.inorderTraversal(($t,It)=>{if(wt.hasChild($t)){const Rt=e.serverCache.getNode().getImmediateChild($t),Tt=viewProcessorApplyMerge(i,Rt,It);gt=viewProcessorApplyServerOverwrite(i,gt,new Path($t),Tt,h,d,et,ft)}}),_t.children.inorderTraversal(($t,It)=>{const Rt=!e.serverCache.isCompleteForChild($t)&&It.value===null;if(!wt.hasChild($t)&&!Rt){const Tt=e.serverCache.getNode().getImmediateChild($t),At=viewProcessorApplyMerge(i,Tt,It);gt=viewProcessorApplyServerOverwrite(i,gt,new Path($t),At,h,d,et,ft)}}),gt}function viewProcessorAckUserWrite(i,e,a,c,h,d,et){if(writeTreeRefShadowingWrite(h,a)!=null)return e;const ft=e.serverCache.isFiltered(),gt=e.serverCache;if(c.value!=null){if(pathIsEmpty(a)&&gt.isFullyInitialized()||gt.isCompleteForPath(a))return viewProcessorApplyServerOverwrite(i,e,a,gt.getNode().getChild(a),h,d,ft,et);if(pathIsEmpty(a)){let _t=new ImmutableTree(null);return gt.getNode().forEachChild(KEY_INDEX,(wt,$t)=>{_t=_t.set(new Path(wt),$t)}),viewProcessorApplyServerMerge(i,e,a,_t,h,d,ft,et)}else return e}else{let _t=new ImmutableTree(null);return c.foreach((wt,$t)=>{const It=pathChild(a,wt);gt.isCompleteForPath(It)&&(_t=_t.set(wt,gt.getNode().getChild(It)))}),viewProcessorApplyServerMerge(i,e,a,_t,h,d,ft,et)}}function viewProcessorListenComplete(i,e,a,c,h){const d=e.serverCache,et=viewCacheUpdateServerSnap(e,d.getNode(),d.isFullyInitialized()||pathIsEmpty(a),d.isFiltered());return viewProcessorGenerateEventCacheAfterServerEvent(i,et,a,c,NO_COMPLETE_CHILD_SOURCE,h)}function viewProcessorRevertUserWrite(i,e,a,c,h,d){let et;if(writeTreeRefShadowingWrite(c,a)!=null)return e;{const ft=new WriteTreeCompleteChildSource(c,e,h),gt=e.eventCache.getNode();let _t;if(pathIsEmpty(a)||pathGetFront(a)===".priority"){let wt;if(e.serverCache.isFullyInitialized())wt=writeTreeRefCalcCompleteEventCache(c,viewCacheGetCompleteServerSnap(e));else{const $t=e.serverCache.getNode();assert($t instanceof ChildrenNode,"serverChildren would be complete if leaf node"),wt=writeTreeRefCalcCompleteEventChildren(c,$t)}wt=wt,_t=i.filter.updateFullNode(gt,wt,d)}else{const wt=pathGetFront(a);let $t=writeTreeRefCalcCompleteChild(c,wt,e.serverCache);$t==null&&e.serverCache.isCompleteForChild(wt)&&($t=gt.getImmediateChild(wt)),$t!=null?_t=i.filter.updateChild(gt,wt,$t,pathPopFront(a),ft,d):e.eventCache.getNode().hasChild(wt)?_t=i.filter.updateChild(gt,wt,ChildrenNode.EMPTY_NODE,pathPopFront(a),ft,d):_t=gt,_t.isEmpty()&&e.serverCache.isFullyInitialized()&&(et=writeTreeRefCalcCompleteEventCache(c,viewCacheGetCompleteServerSnap(e)),et.isLeafNode()&&(_t=i.filter.updateFullNode(_t,et,d)))}return et=e.serverCache.isFullyInitialized()||writeTreeRefShadowingWrite(c,newEmptyPath())!=null,viewCacheUpdateEventSnap(e,_t,et,i.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class View{constructor(e,a){this.query_=e,this.eventRegistrations_=[];const c=this.query_._queryParams,h=new IndexedFilter(c.getIndex()),d=queryParamsGetNodeFilter(c);this.processor_=newViewProcessor(d);const et=a.serverCache,ft=a.eventCache,gt=h.updateFullNode(ChildrenNode.EMPTY_NODE,et.getNode(),null),_t=d.updateFullNode(ChildrenNode.EMPTY_NODE,ft.getNode(),null),wt=new CacheNode(gt,et.isFullyInitialized(),h.filtersNodes()),$t=new CacheNode(_t,ft.isFullyInitialized(),d.filtersNodes());this.viewCache_=newViewCache($t,wt),this.eventGenerator_=new EventGenerator(this.query_)}get query(){return this.query_}}function viewGetServerCache(i){return i.viewCache_.serverCache.getNode()}function viewGetCompleteServerCache(i,e){const a=viewCacheGetCompleteServerSnap(i.viewCache_);return a&&(i.query._queryParams.loadsAllData()||!pathIsEmpty(e)&&!a.getImmediateChild(pathGetFront(e)).isEmpty())?a.getChild(e):null}function viewIsEmpty(i){return i.eventRegistrations_.length===0}function viewAddEventRegistration(i,e){i.eventRegistrations_.push(e)}function viewRemoveEventRegistration(i,e,a){const c=[];if(a){assert(e==null,"A cancel should cancel all event registrations.");const h=i.query._path;i.eventRegistrations_.forEach(d=>{const et=d.createCancelEvent(a,h);et&&c.push(et)})}if(e){let h=[];for(let d=0;d<i.eventRegistrations_.length;++d){const et=i.eventRegistrations_[d];if(!et.matches(e))h.push(et);else if(e.hasAnyCallback()){h=h.concat(i.eventRegistrations_.slice(d+1));break}}i.eventRegistrations_=h}else i.eventRegistrations_=[];return c}function viewApplyOperation(i,e,a,c){e.type===OperationType.MERGE&&e.source.queryId!==null&&(assert(viewCacheGetCompleteServerSnap(i.viewCache_),"We should always have a full cache before handling merges"),assert(viewCacheGetCompleteEventSnap(i.viewCache_),"Missing event cache, even though we have a server cache"));const h=i.viewCache_,d=viewProcessorApplyOperation(i.processor_,h,e,a,c);return viewProcessorAssertIndexed(i.processor_,d.viewCache),assert(d.viewCache.serverCache.isFullyInitialized()||!h.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),i.viewCache_=d.viewCache,viewGenerateEventsForChanges_(i,d.changes,d.viewCache.eventCache.getNode(),null)}function viewGetInitialEvents(i,e){const a=i.viewCache_.eventCache,c=[];return a.getNode().isLeafNode()||a.getNode().forEachChild(PRIORITY_INDEX,(d,et)=>{c.push(changeChildAdded(d,et))}),a.isFullyInitialized()&&c.push(changeValue(a.getNode())),viewGenerateEventsForChanges_(i,c,a.getNode(),e)}function viewGenerateEventsForChanges_(i,e,a,c){const h=c?[c]:i.eventRegistrations_;return eventGeneratorGenerateEventsForChanges(i.eventGenerator_,e,a,h)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let referenceConstructor$1;class SyncPoint{constructor(){this.views=new Map}}function syncPointSetReferenceConstructor(i){assert(!referenceConstructor$1,"__referenceConstructor has already been defined"),referenceConstructor$1=i}function syncPointGetReferenceConstructor(){return assert(referenceConstructor$1,"Reference.ts has not been loaded"),referenceConstructor$1}function syncPointIsEmpty(i){return i.views.size===0}function syncPointApplyOperation(i,e,a,c){const h=e.source.queryId;if(h!==null){const d=i.views.get(h);return assert(d!=null,"SyncTree gave us an op for an invalid query."),viewApplyOperation(d,e,a,c)}else{let d=[];for(const et of i.views.values())d=d.concat(viewApplyOperation(et,e,a,c));return d}}function syncPointGetView(i,e,a,c,h){const d=e._queryIdentifier,et=i.views.get(d);if(!et){let ft=writeTreeRefCalcCompleteEventCache(a,h?c:null),gt=!1;ft?gt=!0:c instanceof ChildrenNode?(ft=writeTreeRefCalcCompleteEventChildren(a,c),gt=!1):(ft=ChildrenNode.EMPTY_NODE,gt=!1);const _t=newViewCache(new CacheNode(ft,gt,!1),new CacheNode(c,h,!1));return new View(e,_t)}return et}function syncPointAddEventRegistration(i,e,a,c,h,d){const et=syncPointGetView(i,e,c,h,d);return i.views.has(e._queryIdentifier)||i.views.set(e._queryIdentifier,et),viewAddEventRegistration(et,a),viewGetInitialEvents(et,a)}function syncPointRemoveEventRegistration(i,e,a,c){const h=e._queryIdentifier,d=[];let et=[];const ft=syncPointHasCompleteView(i);if(h==="default")for(const[gt,_t]of i.views.entries())et=et.concat(viewRemoveEventRegistration(_t,a,c)),viewIsEmpty(_t)&&(i.views.delete(gt),_t.query._queryParams.loadsAllData()||d.push(_t.query));else{const gt=i.views.get(h);gt&&(et=et.concat(viewRemoveEventRegistration(gt,a,c)),viewIsEmpty(gt)&&(i.views.delete(h),gt.query._queryParams.loadsAllData()||d.push(gt.query)))}return ft&&!syncPointHasCompleteView(i)&&d.push(new(syncPointGetReferenceConstructor())(e._repo,e._path)),{removed:d,events:et}}function syncPointGetQueryViews(i){const e=[];for(const a of i.views.values())a.query._queryParams.loadsAllData()||e.push(a);return e}function syncPointGetCompleteServerCache(i,e){let a=null;for(const c of i.views.values())a=a||viewGetCompleteServerCache(c,e);return a}function syncPointViewForQuery(i,e){if(e._queryParams.loadsAllData())return syncPointGetCompleteView(i);{const c=e._queryIdentifier;return i.views.get(c)}}function syncPointViewExistsForQuery(i,e){return syncPointViewForQuery(i,e)!=null}function syncPointHasCompleteView(i){return syncPointGetCompleteView(i)!=null}function syncPointGetCompleteView(i){for(const e of i.views.values())if(e.query._queryParams.loadsAllData())return e;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let referenceConstructor;function syncTreeSetReferenceConstructor(i){assert(!referenceConstructor,"__referenceConstructor has already been defined"),referenceConstructor=i}function syncTreeGetReferenceConstructor(){return assert(referenceConstructor,"Reference.ts has not been loaded"),referenceConstructor}let syncTreeNextQueryTag_=1;class SyncTree{constructor(e){this.listenProvider_=e,this.syncPointTree_=new ImmutableTree(null),this.pendingWriteTree_=newWriteTree(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function syncTreeApplyUserOverwrite(i,e,a,c,h){return writeTreeAddOverwrite(i.pendingWriteTree_,e,a,c,h),h?syncTreeApplyOperationToSyncPoints_(i,new Overwrite(newOperationSourceUser(),e,a)):[]}function syncTreeAckUserWrite(i,e,a=!1){const c=writeTreeGetWrite(i.pendingWriteTree_,e);if(writeTreeRemoveWrite(i.pendingWriteTree_,e)){let d=new ImmutableTree(null);return c.snap!=null?d=d.set(newEmptyPath(),!0):each(c.children,et=>{d=d.set(new Path(et),!0)}),syncTreeApplyOperationToSyncPoints_(i,new AckUserWrite(c.path,d,a))}else return[]}function syncTreeApplyServerOverwrite(i,e,a){return syncTreeApplyOperationToSyncPoints_(i,new Overwrite(newOperationSourceServer(),e,a))}function syncTreeApplyServerMerge(i,e,a){const c=ImmutableTree.fromObject(a);return syncTreeApplyOperationToSyncPoints_(i,new Merge(newOperationSourceServer(),e,c))}function syncTreeApplyListenComplete(i,e){return syncTreeApplyOperationToSyncPoints_(i,new ListenComplete(newOperationSourceServer(),e))}function syncTreeApplyTaggedListenComplete(i,e,a){const c=syncTreeQueryKeyForTag_(i,a);if(c){const h=syncTreeParseQueryKey_(c),d=h.path,et=h.queryId,ft=newRelativePath(d,e),gt=new ListenComplete(newOperationSourceServerTaggedQuery(et),ft);return syncTreeApplyTaggedOperation_(i,d,gt)}else return[]}function syncTreeRemoveEventRegistration(i,e,a,c,h=!1){const d=e._path,et=i.syncPointTree_.get(d);let ft=[];if(et&&(e._queryIdentifier==="default"||syncPointViewExistsForQuery(et,e))){const gt=syncPointRemoveEventRegistration(et,e,a,c);syncPointIsEmpty(et)&&(i.syncPointTree_=i.syncPointTree_.remove(d));const _t=gt.removed;if(ft=gt.events,!h){const wt=_t.findIndex(It=>It._queryParams.loadsAllData())!==-1,$t=i.syncPointTree_.findOnPath(d,(It,Rt)=>syncPointHasCompleteView(Rt));if(wt&&!$t){const It=i.syncPointTree_.subtree(d);if(!It.isEmpty()){const Rt=syncTreeCollectDistinctViewsForSubTree_(It);for(let Tt=0;Tt<Rt.length;++Tt){const At=Rt[Tt],kt=At.query,xt=syncTreeCreateListenerForView_(i,At);i.listenProvider_.startListening(syncTreeQueryForListening_(kt),syncTreeTagForQuery(i,kt),xt.hashFn,xt.onComplete)}}}!$t&&_t.length>0&&!c&&(wt?i.listenProvider_.stopListening(syncTreeQueryForListening_(e),null):_t.forEach(It=>{const Rt=i.queryToTagMap.get(syncTreeMakeQueryKey_(It));i.listenProvider_.stopListening(syncTreeQueryForListening_(It),Rt)}))}syncTreeRemoveTags_(i,_t)}return ft}function syncTreeApplyTaggedQueryOverwrite(i,e,a,c){const h=syncTreeQueryKeyForTag_(i,c);if(h!=null){const d=syncTreeParseQueryKey_(h),et=d.path,ft=d.queryId,gt=newRelativePath(et,e),_t=new Overwrite(newOperationSourceServerTaggedQuery(ft),gt,a);return syncTreeApplyTaggedOperation_(i,et,_t)}else return[]}function syncTreeApplyTaggedQueryMerge(i,e,a,c){const h=syncTreeQueryKeyForTag_(i,c);if(h){const d=syncTreeParseQueryKey_(h),et=d.path,ft=d.queryId,gt=newRelativePath(et,e),_t=ImmutableTree.fromObject(a),wt=new Merge(newOperationSourceServerTaggedQuery(ft),gt,_t);return syncTreeApplyTaggedOperation_(i,et,wt)}else return[]}function syncTreeAddEventRegistration(i,e,a,c=!1){const h=e._path;let d=null,et=!1;i.syncPointTree_.foreachOnPath(h,(It,Rt)=>{const Tt=newRelativePath(It,h);d=d||syncPointGetCompleteServerCache(Rt,Tt),et=et||syncPointHasCompleteView(Rt)});let ft=i.syncPointTree_.get(h);ft?(et=et||syncPointHasCompleteView(ft),d=d||syncPointGetCompleteServerCache(ft,newEmptyPath())):(ft=new SyncPoint,i.syncPointTree_=i.syncPointTree_.set(h,ft));let gt;d!=null?gt=!0:(gt=!1,d=ChildrenNode.EMPTY_NODE,i.syncPointTree_.subtree(h).foreachChild((Rt,Tt)=>{const At=syncPointGetCompleteServerCache(Tt,newEmptyPath());At&&(d=d.updateImmediateChild(Rt,At))}));const _t=syncPointViewExistsForQuery(ft,e);if(!_t&&!e._queryParams.loadsAllData()){const It=syncTreeMakeQueryKey_(e);assert(!i.queryToTagMap.has(It),"View does not exist, but we have a tag");const Rt=syncTreeGetNextQueryTag_();i.queryToTagMap.set(It,Rt),i.tagToQueryMap.set(Rt,It)}const wt=writeTreeChildWrites(i.pendingWriteTree_,h);let $t=syncPointAddEventRegistration(ft,e,a,wt,d,gt);if(!_t&&!et&&!c){const It=syncPointViewForQuery(ft,e);$t=$t.concat(syncTreeSetupListener_(i,e,It))}return $t}function syncTreeCalcCompleteEventCache(i,e,a){const h=i.pendingWriteTree_,d=i.syncPointTree_.findOnPath(e,(et,ft)=>{const gt=newRelativePath(et,e),_t=syncPointGetCompleteServerCache(ft,gt);if(_t)return _t});return writeTreeCalcCompleteEventCache(h,e,d,a,!0)}function syncTreeApplyOperationToSyncPoints_(i,e){return syncTreeApplyOperationHelper_(e,i.syncPointTree_,null,writeTreeChildWrites(i.pendingWriteTree_,newEmptyPath()))}function syncTreeApplyOperationHelper_(i,e,a,c){if(pathIsEmpty(i.path))return syncTreeApplyOperationDescendantsHelper_(i,e,a,c);{const h=e.get(newEmptyPath());a==null&&h!=null&&(a=syncPointGetCompleteServerCache(h,newEmptyPath()));let d=[];const et=pathGetFront(i.path),ft=i.operationForChild(et),gt=e.children.get(et);if(gt&&ft){const _t=a?a.getImmediateChild(et):null,wt=writeTreeRefChild(c,et);d=d.concat(syncTreeApplyOperationHelper_(ft,gt,_t,wt))}return h&&(d=d.concat(syncPointApplyOperation(h,i,c,a))),d}}function syncTreeApplyOperationDescendantsHelper_(i,e,a,c){const h=e.get(newEmptyPath());a==null&&h!=null&&(a=syncPointGetCompleteServerCache(h,newEmptyPath()));let d=[];return e.children.inorderTraversal((et,ft)=>{const gt=a?a.getImmediateChild(et):null,_t=writeTreeRefChild(c,et),wt=i.operationForChild(et);wt&&(d=d.concat(syncTreeApplyOperationDescendantsHelper_(wt,ft,gt,_t)))}),h&&(d=d.concat(syncPointApplyOperation(h,i,c,a))),d}function syncTreeCreateListenerForView_(i,e){const a=e.query,c=syncTreeTagForQuery(i,a);return{hashFn:()=>(viewGetServerCache(e)||ChildrenNode.EMPTY_NODE).hash(),onComplete:h=>{if(h==="ok")return c?syncTreeApplyTaggedListenComplete(i,a._path,c):syncTreeApplyListenComplete(i,a._path);{const d=errorForServerCode(h,a);return syncTreeRemoveEventRegistration(i,a,null,d)}}}}function syncTreeTagForQuery(i,e){const a=syncTreeMakeQueryKey_(e);return i.queryToTagMap.get(a)}function syncTreeMakeQueryKey_(i){return i._path.toString()+"$"+i._queryIdentifier}function syncTreeQueryKeyForTag_(i,e){return i.tagToQueryMap.get(e)}function syncTreeParseQueryKey_(i){const e=i.indexOf("$");return assert(e!==-1&&e<i.length-1,"Bad queryKey."),{queryId:i.substr(e+1),path:new Path(i.substr(0,e))}}function syncTreeApplyTaggedOperation_(i,e,a){const c=i.syncPointTree_.get(e);assert(c,"Missing sync point for query tag that we're tracking");const h=writeTreeChildWrites(i.pendingWriteTree_,e);return syncPointApplyOperation(c,a,h,null)}function syncTreeCollectDistinctViewsForSubTree_(i){return i.fold((e,a,c)=>{if(a&&syncPointHasCompleteView(a))return[syncPointGetCompleteView(a)];{let h=[];return a&&(h=syncPointGetQueryViews(a)),each(c,(d,et)=>{h=h.concat(et)}),h}})}function syncTreeQueryForListening_(i){return i._queryParams.loadsAllData()&&!i._queryParams.isDefault()?new(syncTreeGetReferenceConstructor())(i._repo,i._path):i}function syncTreeRemoveTags_(i,e){for(let a=0;a<e.length;++a){const c=e[a];if(!c._queryParams.loadsAllData()){const h=syncTreeMakeQueryKey_(c),d=i.queryToTagMap.get(h);i.queryToTagMap.delete(h),i.tagToQueryMap.delete(d)}}}function syncTreeGetNextQueryTag_(){return syncTreeNextQueryTag_++}function syncTreeSetupListener_(i,e,a){const c=e._path,h=syncTreeTagForQuery(i,e),d=syncTreeCreateListenerForView_(i,a),et=i.listenProvider_.startListening(syncTreeQueryForListening_(e),h,d.hashFn,d.onComplete),ft=i.syncPointTree_.subtree(c);if(h)assert(!syncPointHasCompleteView(ft.value),"If we're adding a query, it shouldn't be shadowed");else{const gt=ft.fold((_t,wt,$t)=>{if(!pathIsEmpty(_t)&&wt&&syncPointHasCompleteView(wt))return[syncPointGetCompleteView(wt).query];{let It=[];return wt&&(It=It.concat(syncPointGetQueryViews(wt).map(Rt=>Rt.query))),each($t,(Rt,Tt)=>{It=It.concat(Tt)}),It}});for(let _t=0;_t<gt.length;++_t){const wt=gt[_t];i.listenProvider_.stopListening(syncTreeQueryForListening_(wt),syncTreeTagForQuery(i,wt))}}return et}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ExistingValueProvider{constructor(e){this.node_=e}getImmediateChild(e){const a=this.node_.getImmediateChild(e);return new ExistingValueProvider(a)}node(){return this.node_}}class DeferredValueProvider{constructor(e,a){this.syncTree_=e,this.path_=a}getImmediateChild(e){const a=pathChild(this.path_,e);return new DeferredValueProvider(this.syncTree_,a)}node(){return syncTreeCalcCompleteEventCache(this.syncTree_,this.path_)}}const generateWithValues=function(i){return i=i||{},i.timestamp=i.timestamp||new Date().getTime(),i},resolveDeferredLeafValue=function(i,e,a){if(!i||typeof i!="object")return i;if(assert(".sv"in i,"Unexpected leaf node or priority contents"),typeof i[".sv"]=="string")return resolveScalarDeferredValue(i[".sv"],e,a);if(typeof i[".sv"]=="object")return resolveComplexDeferredValue(i[".sv"],e);assert(!1,"Unexpected server value: "+JSON.stringify(i,null,2))},resolveScalarDeferredValue=function(i,e,a){switch(i){case"timestamp":return a.timestamp;default:assert(!1,"Unexpected server value: "+i)}},resolveComplexDeferredValue=function(i,e,a){i.hasOwnProperty("increment")||assert(!1,"Unexpected server value: "+JSON.stringify(i,null,2));const c=i.increment;typeof c!="number"&&assert(!1,"Unexpected increment value: "+c);const h=e.node();if(assert(h!==null&&typeof h<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!h.isLeafNode())return c;const et=h.getValue();return typeof et!="number"?c:et+c},resolveDeferredValueTree=function(i,e,a,c){return resolveDeferredValue(e,new DeferredValueProvider(a,i),c)},resolveDeferredValueSnapshot=function(i,e,a){return resolveDeferredValue(i,new ExistingValueProvider(e),a)};function resolveDeferredValue(i,e,a){const c=i.getPriority().val(),h=resolveDeferredLeafValue(c,e.getImmediateChild(".priority"),a);let d;if(i.isLeafNode()){const et=i,ft=resolveDeferredLeafValue(et.getValue(),e,a);return ft!==et.getValue()||h!==et.getPriority().val()?new LeafNode(ft,nodeFromJSON(h)):i}else{const et=i;return d=et,h!==et.getPriority().val()&&(d=d.updatePriority(new LeafNode(h))),et.forEachChild(PRIORITY_INDEX,(ft,gt)=>{const _t=resolveDeferredValue(gt,e.getImmediateChild(ft),a);_t!==gt&&(d=d.updateImmediateChild(ft,_t))}),d}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tree{constructor(e="",a=null,c={children:{},childCount:0}){this.name=e,this.parent=a,this.node=c}}function treeSubTree(i,e){let a=e instanceof Path?e:new Path(e),c=i,h=pathGetFront(a);for(;h!==null;){const d=safeGet(c.node.children,h)||{children:{},childCount:0};c=new Tree(h,c,d),a=pathPopFront(a),h=pathGetFront(a)}return c}function treeGetValue(i){return i.node.value}function treeSetValue(i,e){i.node.value=e,treeUpdateParents(i)}function treeHasChildren(i){return i.node.childCount>0}function treeIsEmpty(i){return treeGetValue(i)===void 0&&!treeHasChildren(i)}function treeForEachChild(i,e){each(i.node.children,(a,c)=>{e(new Tree(a,i,c))})}function treeForEachDescendant(i,e,a,c){a&&!c&&e(i),treeForEachChild(i,h=>{treeForEachDescendant(h,e,!0,c)}),a&&c&&e(i)}function treeForEachAncestor(i,e,a){let c=a?i:i.parent;for(;c!==null;){if(e(c))return!0;c=c.parent}return!1}function treeGetPath(i){return new Path(i.parent===null?i.name:treeGetPath(i.parent)+"/"+i.name)}function treeUpdateParents(i){i.parent!==null&&treeUpdateChild(i.parent,i.name,i)}function treeUpdateChild(i,e,a){const c=treeIsEmpty(a),h=contains(i.node.children,e);c&&h?(delete i.node.children[e],i.node.childCount--,treeUpdateParents(i)):!c&&!h&&(i.node.children[e]=a.node,i.node.childCount++,treeUpdateParents(i))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const INVALID_KEY_REGEX_=/[\[\].#$\/\u0000-\u001F\u007F]/,INVALID_PATH_REGEX_=/[\[\].#$\u0000-\u001F\u007F]/,MAX_LEAF_SIZE_=10*1024*1024,isValidKey=function(i){return typeof i=="string"&&i.length!==0&&!INVALID_KEY_REGEX_.test(i)},isValidPathString=function(i){return typeof i=="string"&&i.length!==0&&!INVALID_PATH_REGEX_.test(i)},isValidRootPathString=function(i){return i&&(i=i.replace(/^\/*\.info(\/|$)/,"/")),isValidPathString(i)},isValidPriority=function(i){return i===null||typeof i=="string"||typeof i=="number"&&!isInvalidJSONNumber(i)||i&&typeof i=="object"&&contains(i,".sv")},validateFirebaseDataArg=function(i,e,a,c){c&&e===void 0||validateFirebaseData(errorPrefix(i,"value"),e,a)},validateFirebaseData=function(i,e,a){const c=a instanceof Path?new ValidationPath(a,i):a;if(e===void 0)throw new Error(i+"contains undefined "+validationPathToErrorString(c));if(typeof e=="function")throw new Error(i+"contains a function "+validationPathToErrorString(c)+" with contents = "+e.toString());if(isInvalidJSONNumber(e))throw new Error(i+"contains "+e.toString()+" "+validationPathToErrorString(c));if(typeof e=="string"&&e.length>MAX_LEAF_SIZE_/3&&stringLength(e)>MAX_LEAF_SIZE_)throw new Error(i+"contains a string greater than "+MAX_LEAF_SIZE_+" utf8 bytes "+validationPathToErrorString(c)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let h=!1,d=!1;if(each(e,(et,ft)=>{if(et===".value")h=!0;else if(et!==".priority"&&et!==".sv"&&(d=!0,!isValidKey(et)))throw new Error(i+" contains an invalid key ("+et+") "+validationPathToErrorString(c)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);validationPathPush(c,et),validateFirebaseData(i,ft,c),validationPathPop(c)}),h&&d)throw new Error(i+' contains ".value" child '+validationPathToErrorString(c)+" in addition to actual children.")}},validateFirebaseMergePaths=function(i,e){let a,c;for(a=0;a<e.length;a++){c=e[a];const d=pathSlice(c);for(let et=0;et<d.length;et++)if(!(d[et]===".priority"&&et===d.length-1)){if(!isValidKey(d[et]))throw new Error(i+"contains an invalid key ("+d[et]+") in path "+c.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(pathCompare);let h=null;for(a=0;a<e.length;a++){if(c=e[a],h!==null&&pathContains(h,c))throw new Error(i+"contains a path "+h.toString()+" that is ancestor of another path "+c.toString());h=c}},validateFirebaseMergeDataArg=function(i,e,a,c){if(c&&e===void 0)return;const h=errorPrefix(i,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(h+" must be an object containing the children to replace.");const d=[];each(e,(et,ft)=>{const gt=new Path(et);if(validateFirebaseData(h,ft,pathChild(a,gt)),pathGetBack(gt)===".priority"&&!isValidPriority(ft))throw new Error(h+"contains an invalid value for '"+gt.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");d.push(gt)}),validateFirebaseMergePaths(h,d)},validatePriority=function(i,e,a){if(!(a&&e===void 0)){if(isInvalidJSONNumber(e))throw new Error(errorPrefix(i,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!isValidPriority(e))throw new Error(errorPrefix(i,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},validatePathString=function(i,e,a,c){if(!(c&&a===void 0)&&!isValidPathString(a))throw new Error(errorPrefix(i,e)+'was an invalid path = "'+a+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},validateRootPathString=function(i,e,a,c){a&&(a=a.replace(/^\/*\.info(\/|$)/,"/")),validatePathString(i,e,a,c)},validateWritablePath=function(i,e){if(pathGetFront(e)===".info")throw new Error(i+" failed = Can't modify data under /.info/")},validateUrl=function(i,e){const a=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!isValidKey(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||a.length!==0&&!isValidRootPathString(a))throw new Error(errorPrefix(i,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EventQueue{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function eventQueueQueueEvents(i,e){let a=null;for(let c=0;c<e.length;c++){const h=e[c],d=h.getPath();a!==null&&!pathEquals(d,a.path)&&(i.eventLists_.push(a),a=null),a===null&&(a={events:[],path:d}),a.events.push(h)}a&&i.eventLists_.push(a)}function eventQueueRaiseEventsAtPath(i,e,a){eventQueueQueueEvents(i,a),eventQueueRaiseQueuedEventsMatchingPredicate(i,c=>pathEquals(c,e))}function eventQueueRaiseEventsForChangedPath(i,e,a){eventQueueQueueEvents(i,a),eventQueueRaiseQueuedEventsMatchingPredicate(i,c=>pathContains(c,e)||pathContains(e,c))}function eventQueueRaiseQueuedEventsMatchingPredicate(i,e){i.recursionDepth_++;let a=!0;for(let c=0;c<i.eventLists_.length;c++){const h=i.eventLists_[c];if(h){const d=h.path;e(d)?(eventListRaise(i.eventLists_[c]),i.eventLists_[c]=null):a=!1}}a&&(i.eventLists_=[]),i.recursionDepth_--}function eventListRaise(i){for(let e=0;e<i.events.length;e++){const a=i.events[e];if(a!==null){i.events[e]=null;const c=a.getEventRunner();logger&&log("event: "+a.toString()),exceptionGuard(c)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const INTERRUPT_REASON="repo_interrupt",MAX_TRANSACTION_RETRIES=25;class Repo{constructor(e,a,c,h){this.repoInfo_=e,this.forceRestClient_=a,this.authTokenProvider_=c,this.appCheckProvider_=h,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new EventQueue,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=newSparseSnapshotTree(),this.transactionQueueTree_=new Tree,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function repoStart(i,e,a){if(i.stats_=statsManagerGetCollection(i.repoInfo_),i.forceRestClient_||beingCrawled())i.server_=new ReadonlyRestClient(i.repoInfo_,(c,h,d,et)=>{repoOnDataUpdate(i,c,h,d,et)},i.authTokenProvider_,i.appCheckProvider_),setTimeout(()=>repoOnConnectStatus(i,!0),0);else{if(typeof a<"u"&&a!==null){if(typeof a!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{stringify(a)}catch(c){throw new Error("Invalid authOverride provided: "+c)}}i.persistentConnection_=new PersistentConnection(i.repoInfo_,e,(c,h,d,et)=>{repoOnDataUpdate(i,c,h,d,et)},c=>{repoOnConnectStatus(i,c)},c=>{repoOnServerInfoUpdate(i,c)},i.authTokenProvider_,i.appCheckProvider_,a),i.server_=i.persistentConnection_}i.authTokenProvider_.addTokenChangeListener(c=>{i.server_.refreshAuthToken(c)}),i.appCheckProvider_.addTokenChangeListener(c=>{i.server_.refreshAppCheckToken(c.token)}),i.statsReporter_=statsManagerGetOrCreateReporter(i.repoInfo_,()=>new StatsReporter(i.stats_,i.server_)),i.infoData_=new SnapshotHolder,i.infoSyncTree_=new SyncTree({startListening:(c,h,d,et)=>{let ft=[];const gt=i.infoData_.getNode(c._path);return gt.isEmpty()||(ft=syncTreeApplyServerOverwrite(i.infoSyncTree_,c._path,gt),setTimeout(()=>{et("ok")},0)),ft},stopListening:()=>{}}),repoUpdateInfo(i,"connected",!1),i.serverSyncTree_=new SyncTree({startListening:(c,h,d,et)=>(i.server_.listen(c,d,h,(ft,gt)=>{const _t=et(ft,gt);eventQueueRaiseEventsForChangedPath(i.eventQueue_,c._path,_t)}),[]),stopListening:(c,h)=>{i.server_.unlisten(c,h)}})}function repoServerTime(i){const a=i.infoData_.getNode(new Path(".info/serverTimeOffset")).val()||0;return new Date().getTime()+a}function repoGenerateServerValues(i){return generateWithValues({timestamp:repoServerTime(i)})}function repoOnDataUpdate(i,e,a,c,h){i.dataUpdateCount++;const d=new Path(e);a=i.interceptServerDataCallback_?i.interceptServerDataCallback_(e,a):a;let et=[];if(h)if(c){const gt=map(a,_t=>nodeFromJSON(_t));et=syncTreeApplyTaggedQueryMerge(i.serverSyncTree_,d,gt,h)}else{const gt=nodeFromJSON(a);et=syncTreeApplyTaggedQueryOverwrite(i.serverSyncTree_,d,gt,h)}else if(c){const gt=map(a,_t=>nodeFromJSON(_t));et=syncTreeApplyServerMerge(i.serverSyncTree_,d,gt)}else{const gt=nodeFromJSON(a);et=syncTreeApplyServerOverwrite(i.serverSyncTree_,d,gt)}let ft=d;et.length>0&&(ft=repoRerunTransactions(i,d)),eventQueueRaiseEventsForChangedPath(i.eventQueue_,ft,et)}function repoOnConnectStatus(i,e){repoUpdateInfo(i,"connected",e),e===!1&&repoRunOnDisconnectEvents(i)}function repoOnServerInfoUpdate(i,e){each(e,(a,c)=>{repoUpdateInfo(i,a,c)})}function repoUpdateInfo(i,e,a){const c=new Path("/.info/"+e),h=nodeFromJSON(a);i.infoData_.updateSnapshot(c,h);const d=syncTreeApplyServerOverwrite(i.infoSyncTree_,c,h);eventQueueRaiseEventsForChangedPath(i.eventQueue_,c,d)}function repoGetNextWriteId(i){return i.nextWriteId_++}function repoSetWithPriority(i,e,a,c,h){repoLog(i,"set",{path:e.toString(),value:a,priority:c});const d=repoGenerateServerValues(i),et=nodeFromJSON(a,c),ft=syncTreeCalcCompleteEventCache(i.serverSyncTree_,e),gt=resolveDeferredValueSnapshot(et,ft,d),_t=repoGetNextWriteId(i),wt=syncTreeApplyUserOverwrite(i.serverSyncTree_,e,gt,_t,!0);eventQueueQueueEvents(i.eventQueue_,wt),i.server_.put(e.toString(),et.val(!0),(It,Rt)=>{const Tt=It==="ok";Tt||warn("set at "+e+" failed: "+It);const At=syncTreeAckUserWrite(i.serverSyncTree_,_t,!Tt);eventQueueRaiseEventsForChangedPath(i.eventQueue_,e,At),repoCallOnCompleteCallback(i,h,It,Rt)});const $t=repoAbortTransactions(i,e);repoRerunTransactions(i,$t),eventQueueRaiseEventsForChangedPath(i.eventQueue_,$t,[])}function repoRunOnDisconnectEvents(i){repoLog(i,"onDisconnectEvents");const e=repoGenerateServerValues(i),a=newSparseSnapshotTree();sparseSnapshotTreeForEachTree(i.onDisconnect_,newEmptyPath(),(h,d)=>{const et=resolveDeferredValueTree(h,d,i.serverSyncTree_,e);sparseSnapshotTreeRemember(a,h,et)});let c=[];sparseSnapshotTreeForEachTree(a,newEmptyPath(),(h,d)=>{c=c.concat(syncTreeApplyServerOverwrite(i.serverSyncTree_,h,d));const et=repoAbortTransactions(i,h);repoRerunTransactions(i,et)}),i.onDisconnect_=newSparseSnapshotTree(),eventQueueRaiseEventsForChangedPath(i.eventQueue_,newEmptyPath(),c)}function repoOnDisconnectCancel(i,e,a){i.server_.onDisconnectCancel(e.toString(),(c,h)=>{c==="ok"&&sparseSnapshotTreeForget(i.onDisconnect_,e),repoCallOnCompleteCallback(i,a,c,h)})}function repoOnDisconnectSet(i,e,a,c){const h=nodeFromJSON(a);i.server_.onDisconnectPut(e.toString(),h.val(!0),(d,et)=>{d==="ok"&&sparseSnapshotTreeRemember(i.onDisconnect_,e,h),repoCallOnCompleteCallback(i,c,d,et)})}function repoOnDisconnectSetWithPriority(i,e,a,c,h){const d=nodeFromJSON(a,c);i.server_.onDisconnectPut(e.toString(),d.val(!0),(et,ft)=>{et==="ok"&&sparseSnapshotTreeRemember(i.onDisconnect_,e,d),repoCallOnCompleteCallback(i,h,et,ft)})}function repoOnDisconnectUpdate(i,e,a,c){if(isEmpty(a)){log("onDisconnect().update() called with empty data.  Don't do anything."),repoCallOnCompleteCallback(i,c,"ok",void 0);return}i.server_.onDisconnectMerge(e.toString(),a,(h,d)=>{h==="ok"&&each(a,(et,ft)=>{const gt=nodeFromJSON(ft);sparseSnapshotTreeRemember(i.onDisconnect_,pathChild(e,et),gt)}),repoCallOnCompleteCallback(i,c,h,d)})}function repoAddEventCallbackForQuery(i,e,a){let c;pathGetFront(e._path)===".info"?c=syncTreeAddEventRegistration(i.infoSyncTree_,e,a):c=syncTreeAddEventRegistration(i.serverSyncTree_,e,a),eventQueueRaiseEventsAtPath(i.eventQueue_,e._path,c)}function repoRemoveEventCallbackForQuery(i,e,a){let c;pathGetFront(e._path)===".info"?c=syncTreeRemoveEventRegistration(i.infoSyncTree_,e,a):c=syncTreeRemoveEventRegistration(i.serverSyncTree_,e,a),eventQueueRaiseEventsAtPath(i.eventQueue_,e._path,c)}function repoInterrupt(i){i.persistentConnection_&&i.persistentConnection_.interrupt(INTERRUPT_REASON)}function repoLog(i,...e){let a="";i.persistentConnection_&&(a=i.persistentConnection_.id+":"),log(a,...e)}function repoCallOnCompleteCallback(i,e,a,c){e&&exceptionGuard(()=>{if(a==="ok")e(null);else{const h=(a||"error").toUpperCase();let d=h;c&&(d+=": "+c);const et=new Error(d);et.code=h,e(et)}})}function repoGetLatestState(i,e,a){return syncTreeCalcCompleteEventCache(i.serverSyncTree_,e,a)||ChildrenNode.EMPTY_NODE}function repoSendReadyTransactions(i,e=i.transactionQueueTree_){if(e||repoPruneCompletedTransactionsBelowNode(i,e),treeGetValue(e)){const a=repoBuildTransactionQueue(i,e);assert(a.length>0,"Sending zero length transaction queue"),a.every(h=>h.status===0)&&repoSendTransactionQueue(i,treeGetPath(e),a)}else treeHasChildren(e)&&treeForEachChild(e,a=>{repoSendReadyTransactions(i,a)})}function repoSendTransactionQueue(i,e,a){const c=a.map(_t=>_t.currentWriteId),h=repoGetLatestState(i,e,c);let d=h;const et=h.hash();for(let _t=0;_t<a.length;_t++){const wt=a[_t];assert(wt.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),wt.status=1,wt.retryCount++;const $t=newRelativePath(e,wt.path);d=d.updateChild($t,wt.currentOutputSnapshotRaw)}const ft=d.val(!0),gt=e;i.server_.put(gt.toString(),ft,_t=>{repoLog(i,"transaction put response",{path:gt.toString(),status:_t});let wt=[];if(_t==="ok"){const $t=[];for(let It=0;It<a.length;It++)a[It].status=2,wt=wt.concat(syncTreeAckUserWrite(i.serverSyncTree_,a[It].currentWriteId)),a[It].onComplete&&$t.push(()=>a[It].onComplete(null,!0,a[It].currentOutputSnapshotResolved)),a[It].unwatcher();repoPruneCompletedTransactionsBelowNode(i,treeSubTree(i.transactionQueueTree_,e)),repoSendReadyTransactions(i,i.transactionQueueTree_),eventQueueRaiseEventsForChangedPath(i.eventQueue_,e,wt);for(let It=0;It<$t.length;It++)exceptionGuard($t[It])}else{if(_t==="datastale")for(let $t=0;$t<a.length;$t++)a[$t].status===3?a[$t].status=4:a[$t].status=0;else{warn("transaction at "+gt.toString()+" failed: "+_t);for(let $t=0;$t<a.length;$t++)a[$t].status=4,a[$t].abortReason=_t}repoRerunTransactions(i,e)}},et)}function repoRerunTransactions(i,e){const a=repoGetAncestorTransactionNode(i,e),c=treeGetPath(a),h=repoBuildTransactionQueue(i,a);return repoRerunTransactionQueue(i,h,c),c}function repoRerunTransactionQueue(i,e,a){if(e.length===0)return;const c=[];let h=[];const et=e.filter(ft=>ft.status===0).map(ft=>ft.currentWriteId);for(let ft=0;ft<e.length;ft++){const gt=e[ft],_t=newRelativePath(a,gt.path);let wt=!1,$t;if(assert(_t!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),gt.status===4)wt=!0,$t=gt.abortReason,h=h.concat(syncTreeAckUserWrite(i.serverSyncTree_,gt.currentWriteId,!0));else if(gt.status===0)if(gt.retryCount>=MAX_TRANSACTION_RETRIES)wt=!0,$t="maxretry",h=h.concat(syncTreeAckUserWrite(i.serverSyncTree_,gt.currentWriteId,!0));else{const It=repoGetLatestState(i,gt.path,et);gt.currentInputSnapshot=It;const Rt=e[ft].update(It.val());if(Rt!==void 0){validateFirebaseData("transaction failed: Data returned ",Rt,gt.path);let Tt=nodeFromJSON(Rt);typeof Rt=="object"&&Rt!=null&&contains(Rt,".priority")||(Tt=Tt.updatePriority(It.getPriority()));const kt=gt.currentWriteId,xt=repoGenerateServerValues(i),Nt=resolveDeferredValueSnapshot(Tt,It,xt);gt.currentOutputSnapshotRaw=Tt,gt.currentOutputSnapshotResolved=Nt,gt.currentWriteId=repoGetNextWriteId(i),et.splice(et.indexOf(kt),1),h=h.concat(syncTreeApplyUserOverwrite(i.serverSyncTree_,gt.path,Nt,gt.currentWriteId,gt.applyLocally)),h=h.concat(syncTreeAckUserWrite(i.serverSyncTree_,kt,!0))}else wt=!0,$t="nodata",h=h.concat(syncTreeAckUserWrite(i.serverSyncTree_,gt.currentWriteId,!0))}eventQueueRaiseEventsForChangedPath(i.eventQueue_,a,h),h=[],wt&&(e[ft].status=2,function(It){setTimeout(It,Math.floor(0))}(e[ft].unwatcher),e[ft].onComplete&&($t==="nodata"?c.push(()=>e[ft].onComplete(null,!1,e[ft].currentInputSnapshot)):c.push(()=>e[ft].onComplete(new Error($t),!1,null))))}repoPruneCompletedTransactionsBelowNode(i,i.transactionQueueTree_);for(let ft=0;ft<c.length;ft++)exceptionGuard(c[ft]);repoSendReadyTransactions(i,i.transactionQueueTree_)}function repoGetAncestorTransactionNode(i,e){let a,c=i.transactionQueueTree_;for(a=pathGetFront(e);a!==null&&treeGetValue(c)===void 0;)c=treeSubTree(c,a),e=pathPopFront(e),a=pathGetFront(e);return c}function repoBuildTransactionQueue(i,e){const a=[];return repoAggregateTransactionQueuesForNode(i,e,a),a.sort((c,h)=>c.order-h.order),a}function repoAggregateTransactionQueuesForNode(i,e,a){const c=treeGetValue(e);if(c)for(let h=0;h<c.length;h++)a.push(c[h]);treeForEachChild(e,h=>{repoAggregateTransactionQueuesForNode(i,h,a)})}function repoPruneCompletedTransactionsBelowNode(i,e){const a=treeGetValue(e);if(a){let c=0;for(let h=0;h<a.length;h++)a[h].status!==2&&(a[c]=a[h],c++);a.length=c,treeSetValue(e,a.length>0?a:void 0)}treeForEachChild(e,c=>{repoPruneCompletedTransactionsBelowNode(i,c)})}function repoAbortTransactions(i,e){const a=treeGetPath(repoGetAncestorTransactionNode(i,e)),c=treeSubTree(i.transactionQueueTree_,e);return treeForEachAncestor(c,h=>{repoAbortTransactionsOnNode(i,h)}),repoAbortTransactionsOnNode(i,c),treeForEachDescendant(c,h=>{repoAbortTransactionsOnNode(i,h)}),a}function repoAbortTransactionsOnNode(i,e){const a=treeGetValue(e);if(a){const c=[];let h=[],d=-1;for(let et=0;et<a.length;et++)a[et].status===3||(a[et].status===1?(assert(d===et-1,"All SENT items should be at beginning of queue."),d=et,a[et].status=3,a[et].abortReason="set"):(assert(a[et].status===0,"Unexpected transaction status in abort"),a[et].unwatcher(),h=h.concat(syncTreeAckUserWrite(i.serverSyncTree_,a[et].currentWriteId,!0)),a[et].onComplete&&c.push(a[et].onComplete.bind(null,new Error("set"),!1,null))));d===-1?treeSetValue(e,void 0):a.length=d+1,eventQueueRaiseEventsForChangedPath(i.eventQueue_,treeGetPath(e),h);for(let et=0;et<c.length;et++)exceptionGuard(c[et])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function decodePath(i){let e="";const a=i.split("/");for(let c=0;c<a.length;c++)if(a[c].length>0){let h=a[c];try{h=decodeURIComponent(h.replace(/\+/g," "))}catch{}e+="/"+h}return e}function decodeQuery(i){const e={};i.charAt(0)==="?"&&(i=i.substring(1));for(const a of i.split("&")){if(a.length===0)continue;const c=a.split("=");c.length===2?e[decodeURIComponent(c[0])]=decodeURIComponent(c[1]):warn(`Invalid query segment '${a}' in query '${i}'`)}return e}const parseRepoInfo=function(i,e){const a=parseDatabaseURL(i),c=a.namespace;a.domain==="firebase.com"&&fatal(a.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!c||c==="undefined")&&a.domain!=="localhost"&&fatal("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),a.secure||warnIfPageIsSecure();const h=a.scheme==="ws"||a.scheme==="wss";return{repoInfo:new RepoInfo(a.host,a.secure,c,h,e,"",c!==a.subdomain),path:new Path(a.pathString)}},parseDatabaseURL=function(i){let e="",a="",c="",h="",d="",et=!0,ft="https",gt=443;if(typeof i=="string"){let _t=i.indexOf("//");_t>=0&&(ft=i.substring(0,_t-1),i=i.substring(_t+2));let wt=i.indexOf("/");wt===-1&&(wt=i.length);let $t=i.indexOf("?");$t===-1&&($t=i.length),e=i.substring(0,Math.min(wt,$t)),wt<$t&&(h=decodePath(i.substring(wt,$t)));const It=decodeQuery(i.substring(Math.min(i.length,$t)));_t=e.indexOf(":"),_t>=0?(et=ft==="https"||ft==="wss",gt=parseInt(e.substring(_t+1),10)):_t=e.length;const Rt=e.slice(0,_t);if(Rt.toLowerCase()==="localhost")a="localhost";else if(Rt.split(".").length<=2)a=Rt;else{const Tt=e.indexOf(".");c=e.substring(0,Tt).toLowerCase(),a=e.substring(Tt+1),d=c}"ns"in It&&(d=It.ns)}return{host:e,port:gt,domain:a,subdomain:c,secure:et,scheme:ft,pathString:h,namespace:d}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PUSH_CHARS="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",nextPushId=function(){let i=0;const e=[];return function(a){const c=a===i;i=a;let h;const d=new Array(8);for(h=7;h>=0;h--)d[h]=PUSH_CHARS.charAt(a%64),a=Math.floor(a/64);assert(a===0,"Cannot push at time == 0");let et=d.join("");if(c){for(h=11;h>=0&&e[h]===63;h--)e[h]=0;e[h]++}else for(h=0;h<12;h++)e[h]=Math.floor(Math.random()*64);for(h=0;h<12;h++)et+=PUSH_CHARS.charAt(e[h]);return assert(et.length===20,"nextPushId: Length should be 20."),et}}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DataEvent{constructor(e,a,c,h){this.eventType=e,this.eventRegistration=a,this.snapshot=c,this.prevName=h}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+stringify(this.snapshot.exportVal())}}class CancelEvent{constructor(e,a,c){this.eventRegistration=e,this.error=a,this.path=c}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CallbackContext{constructor(e,a){this.snapshotCallback=e,this.cancelCallback=a}onValue(e,a){this.snapshotCallback.call(null,e,a)}onCancel(e){return assert(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OnDisconnect{constructor(e,a){this._repo=e,this._path=a}cancel(){const e=new Deferred;return repoOnDisconnectCancel(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){validateWritablePath("OnDisconnect.remove",this._path);const e=new Deferred;return repoOnDisconnectSet(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){validateWritablePath("OnDisconnect.set",this._path),validateFirebaseDataArg("OnDisconnect.set",e,this._path,!1);const a=new Deferred;return repoOnDisconnectSet(this._repo,this._path,e,a.wrapCallback(()=>{})),a.promise}setWithPriority(e,a){validateWritablePath("OnDisconnect.setWithPriority",this._path),validateFirebaseDataArg("OnDisconnect.setWithPriority",e,this._path,!1),validatePriority("OnDisconnect.setWithPriority",a,!1);const c=new Deferred;return repoOnDisconnectSetWithPriority(this._repo,this._path,e,a,c.wrapCallback(()=>{})),c.promise}update(e){validateWritablePath("OnDisconnect.update",this._path),validateFirebaseMergeDataArg("OnDisconnect.update",e,this._path,!1);const a=new Deferred;return repoOnDisconnectUpdate(this._repo,this._path,e,a.wrapCallback(()=>{})),a.promise}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QueryImpl{constructor(e,a,c,h){this._repo=e,this._path=a,this._queryParams=c,this._orderByCalled=h}get key(){return pathIsEmpty(this._path)?null:pathGetBack(this._path)}get ref(){return new ReferenceImpl(this._repo,this._path)}get _queryIdentifier(){const e=queryParamsGetQueryObject(this._queryParams),a=ObjectToUniqueKey(e);return a==="{}"?"default":a}get _queryObject(){return queryParamsGetQueryObject(this._queryParams)}isEqual(e){if(e=getModularInstance(e),!(e instanceof QueryImpl))return!1;const a=this._repo===e._repo,c=pathEquals(this._path,e._path),h=this._queryIdentifier===e._queryIdentifier;return a&&c&&h}toJSON(){return this.toString()}toString(){return this._repo.toString()+pathToUrlEncodedString(this._path)}}class ReferenceImpl extends QueryImpl{constructor(e,a){super(e,a,new QueryParams,!1)}get parent(){const e=pathParent(this._path);return e===null?null:new ReferenceImpl(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class DataSnapshot{constructor(e,a,c){this._node=e,this.ref=a,this._index=c}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const a=new Path(e),c=child(this.ref,e);return new DataSnapshot(this._node.getChild(a),c,PRIORITY_INDEX)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(c,h)=>e(new DataSnapshot(h,child(this.ref,c),PRIORITY_INDEX)))}hasChild(e){const a=new Path(e);return!this._node.getChild(a).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function ref(i,e){return i=getModularInstance(i),i._checkNotDeleted("ref"),e!==void 0?child(i._root,e):i._root}function child(i,e){return i=getModularInstance(i),pathGetFront(i._path)===null?validateRootPathString("child","path",e,!1):validatePathString("child","path",e,!1),new ReferenceImpl(i._repo,pathChild(i._path,e))}function onDisconnect(i){return i=getModularInstance(i),new OnDisconnect(i._repo,i._path)}function push(i,e){i=getModularInstance(i),validateWritablePath("push",i._path),validateFirebaseDataArg("push",e,i._path,!0);const a=repoServerTime(i._repo),c=nextPushId(a),h=child(i,c),d=child(i,c);let et;return e!=null?et=set(d,e).then(()=>d):et=Promise.resolve(d),h.then=et.then.bind(et),h.catch=et.then.bind(et,void 0),h}function remove(i){return validateWritablePath("remove",i._path),set(i,null)}function set(i,e){i=getModularInstance(i),validateWritablePath("set",i._path),validateFirebaseDataArg("set",e,i._path,!1);const a=new Deferred;return repoSetWithPriority(i._repo,i._path,e,null,a.wrapCallback(()=>{})),a.promise}class ValueEventRegistration{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,a){const c=a._queryParams.getIndex();return new DataEvent("value",this,new DataSnapshot(e.snapshotNode,new ReferenceImpl(a._repo,a._path),c))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,a){return this.callbackContext.hasCancelCallback?new CancelEvent(this,e,a):null}matches(e){return e instanceof ValueEventRegistration?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}class ChildEventRegistration{constructor(e,a){this.eventType=e,this.callbackContext=a}respondsTo(e){let a=e==="children_added"?"child_added":e;return a=a==="children_removed"?"child_removed":a,this.eventType===a}createCancelEvent(e,a){return this.callbackContext.hasCancelCallback?new CancelEvent(this,e,a):null}createEvent(e,a){assert(e.childName!=null,"Child events should have a childName.");const c=child(new ReferenceImpl(a._repo,a._path),e.childName),h=a._queryParams.getIndex();return new DataEvent(e.type,this,new DataSnapshot(e.snapshotNode,c,h),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof ChildEventRegistration?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}}function addEventListener(i,e,a,c,h){let d;if(typeof c=="object"&&(d=void 0,h=c),typeof c=="function"&&(d=c),h&&h.onlyOnce){const gt=a,_t=(wt,$t)=>{repoRemoveEventCallbackForQuery(i._repo,i,ft),gt(wt,$t)};_t.userCallback=a.userCallback,_t.context=a.context,a=_t}const et=new CallbackContext(a,d||void 0),ft=e==="value"?new ValueEventRegistration(et):new ChildEventRegistration(e,et);return repoAddEventCallbackForQuery(i._repo,i,ft),()=>repoRemoveEventCallbackForQuery(i._repo,i,ft)}function onValue(i,e,a,c){return addEventListener(i,"value",e,a,c)}function onChildAdded(i,e,a,c){return addEventListener(i,"child_added",e,a,c)}function off(i,e,a){let c=null;const h=a?new CallbackContext(a):null;e==="value"?c=new ValueEventRegistration(h):e&&(c=new ChildEventRegistration(e,h)),repoRemoveEventCallbackForQuery(i._repo,i,c)}syncPointSetReferenceConstructor(ReferenceImpl);syncTreeSetReferenceConstructor(ReferenceImpl);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FIREBASE_DATABASE_EMULATOR_HOST_VAR="FIREBASE_DATABASE_EMULATOR_HOST",repos={};let useRestClient=!1;function repoManagerApplyEmulatorSettings(i,e,a,c){i.repoInfo_=new RepoInfo(`${e}:${a}`,!1,i.repoInfo_.namespace,i.repoInfo_.webSocketOnly,i.repoInfo_.nodeAdmin,i.repoInfo_.persistenceKey,i.repoInfo_.includeNamespaceInQueryParams,!0),c&&(i.authTokenProvider_=c)}function repoManagerDatabaseFromApp(i,e,a,c,h){let d=c||i.options.databaseURL;d===void 0&&(i.options.projectId||fatal("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),log("Using default host for project ",i.options.projectId),d=`${i.options.projectId}-default-rtdb.firebaseio.com`);let et=parseRepoInfo(d,h),ft=et.repoInfo,gt,_t;typeof process<"u"&&define_process_env_default&&(_t=define_process_env_default[FIREBASE_DATABASE_EMULATOR_HOST_VAR]),_t?(gt=!0,d=`http://${_t}?ns=${ft.namespace}`,et=parseRepoInfo(d,h),ft=et.repoInfo):gt=!et.repoInfo.secure;const wt=h&&gt?new EmulatorTokenProvider(EmulatorTokenProvider.OWNER):new FirebaseAuthTokenProvider(i.name,i.options,e);validateUrl("Invalid Firebase Database URL",et),pathIsEmpty(et.path)||fatal("Database URL must point to the root of a Firebase Database (not including a child path).");const $t=repoManagerCreateRepo(ft,i,wt,new AppCheckTokenProvider(i.name,a));return new Database($t,i)}function repoManagerDeleteRepo(i,e){const a=repos[e];(!a||a[i.key]!==i)&&fatal(`Database ${e}(${i.repoInfo_}) has already been deleted.`),repoInterrupt(i),delete a[i.key]}function repoManagerCreateRepo(i,e,a,c){let h=repos[e.name];h||(h={},repos[e.name]=h);let d=h[i.toURLString()];return d&&fatal("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),d=new Repo(i,useRestClient,a,c),h[i.toURLString()]=d,d}class Database{constructor(e,a){this._repoInternal=e,this.app=a,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(repoStart(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new ReferenceImpl(this._repo,newEmptyPath())),this._rootInternal}_delete(){return this._rootInternal!==null&&(repoManagerDeleteRepo(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&fatal("Cannot call "+e+" on a deleted database.")}}function getDatabase(i=getApp(),e){const a=_getProvider(i,"database").getImmediate({identifier:e});if(!a._instanceStarted){const c=getDefaultEmulatorHostnameAndPort("database");c&&connectDatabaseEmulator(a,...c)}return a}function connectDatabaseEmulator(i,e,a,c={}){i=getModularInstance(i),i._checkNotDeleted("useEmulator"),i._instanceStarted&&fatal("Cannot call useEmulator() after instance has already been initialized.");const h=i._repoInternal;let d;if(h.repoInfo_.nodeAdmin)c.mockUserToken&&fatal('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),d=new EmulatorTokenProvider(EmulatorTokenProvider.OWNER);else if(c.mockUserToken){const et=typeof c.mockUserToken=="string"?c.mockUserToken:createMockUserToken(c.mockUserToken,i.app.options.projectId);d=new EmulatorTokenProvider(et)}repoManagerApplyEmulatorSettings(h,e,a,d)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function registerDatabase(i){setSDKVersion(SDK_VERSION$1),_registerComponent(new Component("database",(e,{instanceIdentifier:a})=>{const c=e.getProvider("app").getImmediate(),h=e.getProvider("auth-internal"),d=e.getProvider("app-check-internal");return repoManagerDatabaseFromApp(c,h,d,a)},"PUBLIC").setMultipleInstances(!0)),registerVersion(name$1,version,i),registerVersion(name$1,version,"esm2017")}PersistentConnection.prototype.simpleListen=function(i,e){this.sendRequest("q",{p:i},e)};PersistentConnection.prototype.echo=function(i,e){this.sendRequest("echo",{d:i},e)};registerDatabase();const presencePath="_",defaultRootPath=`__${libName.toLowerCase()}__`,occupiedRooms={},dbs={},getPath=(...i)=>i.join("/"),init=i=>{if(i.firebaseApp){const e=i.firebaseApp.options.databaseURL;return dbs[e]||(dbs[e]=getDatabase(i.firebaseApp))}return dbs[i.appId]||(dbs[i.appId]=getDatabase(initializeApp({databaseURL:i.appId})))},joinRoom$1=initGuard(occupiedRooms,(i,e)=>{const a=init(i),c={},h={},d={},et=i.rootPath||defaultRootPath,ft=ref(a,getPath(et,e)),gt=child(ft,selfId),_t=i.password&&genKey(i.password,e),wt=[],$t=(Tt,At)=>{if(c[Tt]&&!c[Tt].destroyed)return c[Tt];const kt=initPeer(At,!0,i.rtcConfig);return kt.once(events$1.connect,()=>{Rt(kt,Tt),d[Tt]=!0}),kt.on(events$1.signal,async xt=>{if(d[Tt])return;const Nt=JSON.stringify(xt),Ft=push(ref(a,getPath(et,e,Tt,selfId)));onDisconnect(Ft).remove(),set(Ft,_t?await encrypt$2(_t,Nt):Nt)}),kt.once(events$1.close,()=>{delete c[Tt],delete h[Tt],delete d[Tt]}),c[Tt]=kt,kt};let It=!1,Rt=noOp;return set(gt,{[presencePath]:!0}),onDisconnect(gt).remove(),onChildAdded(gt,Tt=>{const At=Tt.key;At===presencePath||d[At]||wt.push(onChildAdded(Tt.ref,async kt=>{if(At in h||(h[At]={}),kt.key in h[At])return;h[At][kt.key]=!0;let xt;try{xt=JSON.parse(_t?await decrypt$2(_t,kt.val()):kt.val())}catch{console.error(`${libName}: received malformed SDP JSON`);return}$t(At,!1).signal(xt),remove(kt.ref)}))}),onValue(ft,()=>It=!0,{onlyOnce:!0}),onChildAdded(ft,({key:Tt})=>{!It||Tt===selfId||$t(Tt,!0)}),room(Tt=>Rt=Tt,()=>{off(gt),remove(gt),off(ft),wt.forEach(Tt=>Tt()),delete occupiedRooms[e]})});function joinRoom(i,e){switch(e){case"torrent":return joinRoom$5({appId:"ewklqkge"},i);case"nostr":return joinRoom$4({appId:"ewklqkge"},i);case"mqtt":return joinRoom$3({appId:"ewklqkge"},i);case"ipfs":return joinRoom$2({appId:"ewklqkge"},i);case"firebase":return joinRoom$1({appId:"https://kun-chat-4387b-default-rtdb.europe-west1.firebasedatabase.app/"},i)}}const useRoom=(i,e)=>{const a=reactExports.useRef(joinRoom(i,e));return reactExports.useEffect(()=>(console.log("connected"),a.current=joinRoom(i,e),()=>a.current.leave()),[i,e]),{room:a.current,selfId}},send="/testTrysteroChat/send.svg";function toHSL(i){const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(i);if(e){let a=parseInt(e[1],16),c=parseInt(e[2],16),h=parseInt(e[3],16);a/=255,c/=255,h/=255;const d=Math.max(a,c,h),et=Math.min(a,c,h);let ft,gt,_t=(d+et)/2;if(ft=0,d==et)ft=gt=0;else{const wt=d-et;switch(gt=_t>.5?wt/(2-d-et):wt/(d+et),d){case a:ft=(c-h)/wt+(c<h?6:0);break;case c:ft=(h-a)/wt+2;break;case h:ft=(a-c)/wt+4;break}ft/=6}return gt=gt*100,gt=Math.round(gt),_t=_t*100,_t=Math.round(_t),_t=38,ft=Math.round(360*ft),"hsl("+ft+", "+gt+"%, "+_t+"%)"}return"hsl(10%, 100%, 50%)"}function stringToColour(i){let e=1;i.split("").forEach(c=>{e=c.charCodeAt(0)+((e<<5)-e)});let a="#";for(let c=0;c<3;c++){const h=e>>c*8&255;a+=h.toString(16).padStart(2,"0")}return toHSL(a)}var lib$3={},htmlToDom={},domparser$1={};Object.defineProperty(domparser$1,"__esModule",{value:!0});var HTML="html",HEAD="head",BODY="body",FIRST_TAG_REGEX=/<([a-zA-Z]+[0-9]?)/,HEAD_TAG_REGEX=/<head[^]*>/i,BODY_TAG_REGEX=/<body[^]*>/i,parseFromDocument=function(i,e){throw new Error("This browser does not support `document.implementation.createHTMLDocument`")},parseFromString=function(i,e){throw new Error("This browser does not support `DOMParser.prototype.parseFromString`")},DOMParser=typeof window=="object"&&window.DOMParser;if(typeof DOMParser=="function"){var domParser_1=new DOMParser,mimeType_1="text/html";parseFromString=function(i,e){return e&&(i="<".concat(e,">").concat(i,"</").concat(e,">")),domParser_1.parseFromString(i,mimeType_1)},parseFromDocument=parseFromString}if(typeof document=="object"&&document.implementation){var htmlDocument_1=document.implementation.createHTMLDocument();parseFromDocument=function(i,e){if(e){var a=htmlDocument_1.documentElement.querySelector(e);return a&&(a.innerHTML=i),htmlDocument_1}return htmlDocument_1.documentElement.innerHTML=i,htmlDocument_1}}var template=typeof document=="object"&&document.createElement("template"),parseFromTemplate;template&&template.content&&(parseFromTemplate=function(i){return template.innerHTML=i,template.content.childNodes});function domparser(i){var e,a,c=i.match(FIRST_TAG_REGEX),h=c&&c[1]?c[1].toLowerCase():"";switch(h){case HTML:{var d=parseFromString(i);if(!HEAD_TAG_REGEX.test(i)){var et=d.querySelector(HEAD);(e=et==null?void 0:et.parentNode)===null||e===void 0||e.removeChild(et)}if(!BODY_TAG_REGEX.test(i)){var et=d.querySelector(BODY);(a=et==null?void 0:et.parentNode)===null||a===void 0||a.removeChild(et)}return d.querySelectorAll(HTML)}case HEAD:case BODY:{var ft=parseFromDocument(i).querySelectorAll(h);return BODY_TAG_REGEX.test(i)&&HEAD_TAG_REGEX.test(i)?ft[0].parentNode.childNodes:ft}default:{if(parseFromTemplate)return parseFromTemplate(i);var et=parseFromDocument(i,BODY).querySelector(BODY);return et.childNodes}}}domparser$1.default=domparser;var utilities$2={},lib$2={},lib$1={};(function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.Doctype=i.CDATA=i.Tag=i.Style=i.Script=i.Comment=i.Directive=i.Text=i.Root=i.isTag=i.ElementType=void 0;var e;(function(c){c.Root="root",c.Text="text",c.Directive="directive",c.Comment="comment",c.Script="script",c.Style="style",c.Tag="tag",c.CDATA="cdata",c.Doctype="doctype"})(e=i.ElementType||(i.ElementType={}));function a(c){return c.type===e.Tag||c.type===e.Script||c.type===e.Style}i.isTag=a,i.Root=e.Root,i.Text=e.Text,i.Directive=e.Directive,i.Comment=e.Comment,i.Script=e.Script,i.Style=e.Style,i.Tag=e.Tag,i.CDATA=e.CDATA,i.Doctype=e.Doctype})(lib$1);var node={},__extends=commonjsGlobal&&commonjsGlobal.__extends||function(){var i=function(e,a){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,h){c.__proto__=h}||function(c,h){for(var d in h)Object.prototype.hasOwnProperty.call(h,d)&&(c[d]=h[d])},i(e,a)};return function(e,a){if(typeof a!="function"&&a!==null)throw new TypeError("Class extends value "+String(a)+" is not a constructor or null");i(e,a);function c(){this.constructor=e}e.prototype=a===null?Object.create(a):(c.prototype=a.prototype,new c)}}(),__assign=commonjsGlobal&&commonjsGlobal.__assign||function(){return __assign=Object.assign||function(i){for(var e,a=1,c=arguments.length;a<c;a++){e=arguments[a];for(var h in e)Object.prototype.hasOwnProperty.call(e,h)&&(i[h]=e[h])}return i},__assign.apply(this,arguments)};Object.defineProperty(node,"__esModule",{value:!0});node.cloneNode=node.hasChildren=node.isDocument=node.isDirective=node.isComment=node.isText=node.isCDATA=node.isTag=node.Element=node.Document=node.CDATA=node.NodeWithChildren=node.ProcessingInstruction=node.Comment=node.Text=node.DataNode=node.Node=void 0;var domelementtype_1=lib$1,Node=function(){function i(){this.parent=null,this.prev=null,this.next=null,this.startIndex=null,this.endIndex=null}return Object.defineProperty(i.prototype,"parentNode",{get:function(){return this.parent},set:function(e){this.parent=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"previousSibling",{get:function(){return this.prev},set:function(e){this.prev=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"nextSibling",{get:function(){return this.next},set:function(e){this.next=e},enumerable:!1,configurable:!0}),i.prototype.cloneNode=function(e){return e===void 0&&(e=!1),cloneNode(this,e)},i}();node.Node=Node;var DataNode=function(i){__extends(e,i);function e(a){var c=i.call(this)||this;return c.data=a,c}return Object.defineProperty(e.prototype,"nodeValue",{get:function(){return this.data},set:function(a){this.data=a},enumerable:!1,configurable:!0}),e}(Node);node.DataNode=DataNode;var Text=function(i){__extends(e,i);function e(){var a=i!==null&&i.apply(this,arguments)||this;return a.type=domelementtype_1.ElementType.Text,a}return Object.defineProperty(e.prototype,"nodeType",{get:function(){return 3},enumerable:!1,configurable:!0}),e}(DataNode);node.Text=Text;var Comment=function(i){__extends(e,i);function e(){var a=i!==null&&i.apply(this,arguments)||this;return a.type=domelementtype_1.ElementType.Comment,a}return Object.defineProperty(e.prototype,"nodeType",{get:function(){return 8},enumerable:!1,configurable:!0}),e}(DataNode);node.Comment=Comment;var ProcessingInstruction=function(i){__extends(e,i);function e(a,c){var h=i.call(this,c)||this;return h.name=a,h.type=domelementtype_1.ElementType.Directive,h}return Object.defineProperty(e.prototype,"nodeType",{get:function(){return 1},enumerable:!1,configurable:!0}),e}(DataNode);node.ProcessingInstruction=ProcessingInstruction;var NodeWithChildren=function(i){__extends(e,i);function e(a){var c=i.call(this)||this;return c.children=a,c}return Object.defineProperty(e.prototype,"firstChild",{get:function(){var a;return(a=this.children[0])!==null&&a!==void 0?a:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastChild",{get:function(){return this.children.length>0?this.children[this.children.length-1]:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"childNodes",{get:function(){return this.children},set:function(a){this.children=a},enumerable:!1,configurable:!0}),e}(Node);node.NodeWithChildren=NodeWithChildren;var CDATA=function(i){__extends(e,i);function e(){var a=i!==null&&i.apply(this,arguments)||this;return a.type=domelementtype_1.ElementType.CDATA,a}return Object.defineProperty(e.prototype,"nodeType",{get:function(){return 4},enumerable:!1,configurable:!0}),e}(NodeWithChildren);node.CDATA=CDATA;var Document=function(i){__extends(e,i);function e(){var a=i!==null&&i.apply(this,arguments)||this;return a.type=domelementtype_1.ElementType.Root,a}return Object.defineProperty(e.prototype,"nodeType",{get:function(){return 9},enumerable:!1,configurable:!0}),e}(NodeWithChildren);node.Document=Document;var Element=function(i){__extends(e,i);function e(a,c,h,d){h===void 0&&(h=[]),d===void 0&&(d=a==="script"?domelementtype_1.ElementType.Script:a==="style"?domelementtype_1.ElementType.Style:domelementtype_1.ElementType.Tag);var et=i.call(this,h)||this;return et.name=a,et.attribs=c,et.type=d,et}return Object.defineProperty(e.prototype,"nodeType",{get:function(){return 1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tagName",{get:function(){return this.name},set:function(a){this.name=a},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"attributes",{get:function(){var a=this;return Object.keys(this.attribs).map(function(c){var h,d;return{name:c,value:a.attribs[c],namespace:(h=a["x-attribsNamespace"])===null||h===void 0?void 0:h[c],prefix:(d=a["x-attribsPrefix"])===null||d===void 0?void 0:d[c]}})},enumerable:!1,configurable:!0}),e}(NodeWithChildren);node.Element=Element;function isTag(i){return(0,domelementtype_1.isTag)(i)}node.isTag=isTag;function isCDATA(i){return i.type===domelementtype_1.ElementType.CDATA}node.isCDATA=isCDATA;function isText(i){return i.type===domelementtype_1.ElementType.Text}node.isText=isText;function isComment(i){return i.type===domelementtype_1.ElementType.Comment}node.isComment=isComment;function isDirective(i){return i.type===domelementtype_1.ElementType.Directive}node.isDirective=isDirective;function isDocument(i){return i.type===domelementtype_1.ElementType.Root}node.isDocument=isDocument;function hasChildren(i){return Object.prototype.hasOwnProperty.call(i,"children")}node.hasChildren=hasChildren;function cloneNode(i,e){e===void 0&&(e=!1);var a;if(isText(i))a=new Text(i.data);else if(isComment(i))a=new Comment(i.data);else if(isTag(i)){var c=e?cloneChildren(i.children):[],h=new Element(i.name,__assign({},i.attribs),c);c.forEach(function(gt){return gt.parent=h}),i.namespace!=null&&(h.namespace=i.namespace),i["x-attribsNamespace"]&&(h["x-attribsNamespace"]=__assign({},i["x-attribsNamespace"])),i["x-attribsPrefix"]&&(h["x-attribsPrefix"]=__assign({},i["x-attribsPrefix"])),a=h}else if(isCDATA(i)){var c=e?cloneChildren(i.children):[],d=new CDATA(c);c.forEach(function(_t){return _t.parent=d}),a=d}else if(isDocument(i)){var c=e?cloneChildren(i.children):[],et=new Document(c);c.forEach(function(_t){return _t.parent=et}),i["x-mode"]&&(et["x-mode"]=i["x-mode"]),a=et}else if(isDirective(i)){var ft=new ProcessingInstruction(i.name,i.data);i["x-name"]!=null&&(ft["x-name"]=i["x-name"],ft["x-publicId"]=i["x-publicId"],ft["x-systemId"]=i["x-systemId"]),a=ft}else throw new Error("Not implemented yet: ".concat(i.type));return a.startIndex=i.startIndex,a.endIndex=i.endIndex,i.sourceCodeLocation!=null&&(a.sourceCodeLocation=i.sourceCodeLocation),a}node.cloneNode=cloneNode;function cloneChildren(i){for(var e=i.map(function(c){return cloneNode(c,!0)}),a=1;a<e.length;a++)e[a].prev=e[a-1],e[a-1].next=e[a];return e}(function(i){var e=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(ft,gt,_t,wt){wt===void 0&&(wt=_t);var $t=Object.getOwnPropertyDescriptor(gt,_t);(!$t||("get"in $t?!gt.__esModule:$t.writable||$t.configurable))&&($t={enumerable:!0,get:function(){return gt[_t]}}),Object.defineProperty(ft,wt,$t)}:function(ft,gt,_t,wt){wt===void 0&&(wt=_t),ft[wt]=gt[_t]}),a=commonjsGlobal&&commonjsGlobal.__exportStar||function(ft,gt){for(var _t in ft)_t!=="default"&&!Object.prototype.hasOwnProperty.call(gt,_t)&&e(gt,ft,_t)};Object.defineProperty(i,"__esModule",{value:!0}),i.DomHandler=void 0;var c=lib$1,h=node;a(node,i);var d={withStartIndices:!1,withEndIndices:!1,xmlMode:!1},et=function(){function ft(gt,_t,wt){this.dom=[],this.root=new h.Document(this.dom),this.done=!1,this.tagStack=[this.root],this.lastNode=null,this.parser=null,typeof _t=="function"&&(wt=_t,_t=d),typeof gt=="object"&&(_t=gt,gt=void 0),this.callback=gt??null,this.options=_t??d,this.elementCB=wt??null}return ft.prototype.onparserinit=function(gt){this.parser=gt},ft.prototype.onreset=function(){this.dom=[],this.root=new h.Document(this.dom),this.done=!1,this.tagStack=[this.root],this.lastNode=null,this.parser=null},ft.prototype.onend=function(){this.done||(this.done=!0,this.parser=null,this.handleCallback(null))},ft.prototype.onerror=function(gt){this.handleCallback(gt)},ft.prototype.onclosetag=function(){this.lastNode=null;var gt=this.tagStack.pop();this.options.withEndIndices&&(gt.endIndex=this.parser.endIndex),this.elementCB&&this.elementCB(gt)},ft.prototype.onopentag=function(gt,_t){var wt=this.options.xmlMode?c.ElementType.Tag:void 0,$t=new h.Element(gt,_t,void 0,wt);this.addNode($t),this.tagStack.push($t)},ft.prototype.ontext=function(gt){var _t=this.lastNode;if(_t&&_t.type===c.ElementType.Text)_t.data+=gt,this.options.withEndIndices&&(_t.endIndex=this.parser.endIndex);else{var wt=new h.Text(gt);this.addNode(wt),this.lastNode=wt}},ft.prototype.oncomment=function(gt){if(this.lastNode&&this.lastNode.type===c.ElementType.Comment){this.lastNode.data+=gt;return}var _t=new h.Comment(gt);this.addNode(_t),this.lastNode=_t},ft.prototype.oncommentend=function(){this.lastNode=null},ft.prototype.oncdatastart=function(){var gt=new h.Text(""),_t=new h.CDATA([gt]);this.addNode(_t),gt.parent=_t,this.lastNode=gt},ft.prototype.oncdataend=function(){this.lastNode=null},ft.prototype.onprocessinginstruction=function(gt,_t){var wt=new h.ProcessingInstruction(gt,_t);this.addNode(wt)},ft.prototype.handleCallback=function(gt){if(typeof this.callback=="function")this.callback(gt,this.dom);else if(gt)throw gt},ft.prototype.addNode=function(gt){var _t=this.tagStack[this.tagStack.length-1],wt=_t.children[_t.children.length-1];this.options.withStartIndices&&(gt.startIndex=this.parser.startIndex),this.options.withEndIndices&&(gt.endIndex=this.parser.endIndex),_t.children.push(gt),wt&&(gt.prev=wt,wt.next=gt),gt.parent=_t,this.lastNode=null},ft}();i.DomHandler=et,i.default=et})(lib$2);var constants={};(function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.CASE_SENSITIVE_TAG_NAMES_MAP=i.CASE_SENSITIVE_TAG_NAMES=void 0,i.CASE_SENSITIVE_TAG_NAMES=["animateMotion","animateTransform","clipPath","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","foreignObject","linearGradient","radialGradient","textPath"],i.CASE_SENSITIVE_TAG_NAMES_MAP=i.CASE_SENSITIVE_TAG_NAMES.reduce(function(e,a){return e[a.toLowerCase()]=a,e},{})})(constants);Object.defineProperty(utilities$2,"__esModule",{value:!0});utilities$2.formatDOM=utilities$2.formatAttributes=void 0;var domhandler_1=lib$2,constants_1=constants;function getCaseSensitiveTagName(i){return constants_1.CASE_SENSITIVE_TAG_NAMES_MAP[i]}function formatAttributes(i){for(var e={},a=0,c=i.length;a<c;a++){var h=i[a];e[h.name]=h.value}return e}utilities$2.formatAttributes=formatAttributes;function formatTagName(i){i=i.toLowerCase();var e=getCaseSensitiveTagName(i);return e||i}function formatDOM(i,e,a){e===void 0&&(e=null);for(var c=[],h,d=0,et=i.length;d<et;d++){var ft=i[d];switch(ft.nodeType){case 1:{var gt=formatTagName(ft.nodeName);h=new domhandler_1.Element(gt,formatAttributes(ft.attributes)),h.children=formatDOM(gt==="template"?ft.content.childNodes:ft.childNodes,h);break}case 3:h=new domhandler_1.Text(ft.nodeValue);break;case 8:h=new domhandler_1.Comment(ft.nodeValue);break;default:continue}var _t=c[d-1]||null;_t&&(_t.next=h),h.parent=e,h.prev=_t,h.next=null,c.push(h)}return a&&(h=new domhandler_1.ProcessingInstruction(a.substring(0,a.indexOf(" ")).toLowerCase(),a),h.next=c[0]||null,h.parent=e,c.unshift(h),c[1]&&(c[1].prev=c[0])),c}utilities$2.formatDOM=formatDOM;var __importDefault$3=commonjsGlobal&&commonjsGlobal.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(htmlToDom,"__esModule",{value:!0});var domparser_1=__importDefault$3(domparser$1),utilities_1$3=utilities$2,DIRECTIVE_REGEX=/<(![a-zA-Z\s]+)>/;function HTMLDOMParser(i){if(typeof i!="string")throw new TypeError("First argument must be a string");if(!i)return[];var e=i.match(DIRECTIVE_REGEX),a=e?e[1]:void 0;return(0,utilities_1$3.formatDOM)((0,domparser_1.default)(i),null,a)}htmlToDom.default=HTMLDOMParser;var attributesToProps$1={},lib={},possibleStandardNamesOptimized$1={},SAME$1=0;possibleStandardNamesOptimized$1.SAME=SAME$1;var CAMELCASE$1=1;possibleStandardNamesOptimized$1.CAMELCASE=CAMELCASE$1;possibleStandardNamesOptimized$1.possibleStandardNames={accept:0,acceptCharset:1,"accept-charset":"acceptCharset",accessKey:1,action:0,allowFullScreen:1,alt:0,as:0,async:0,autoCapitalize:1,autoComplete:1,autoCorrect:1,autoFocus:1,autoPlay:1,autoSave:1,capture:0,cellPadding:1,cellSpacing:1,challenge:0,charSet:1,checked:0,children:0,cite:0,class:"className",classID:1,className:1,cols:0,colSpan:1,content:0,contentEditable:1,contextMenu:1,controls:0,controlsList:1,coords:0,crossOrigin:1,dangerouslySetInnerHTML:1,data:0,dateTime:1,default:0,defaultChecked:1,defaultValue:1,defer:0,dir:0,disabled:0,disablePictureInPicture:1,disableRemotePlayback:1,download:0,draggable:0,encType:1,enterKeyHint:1,for:"htmlFor",form:0,formMethod:1,formAction:1,formEncType:1,formNoValidate:1,formTarget:1,frameBorder:1,headers:0,height:0,hidden:0,high:0,href:0,hrefLang:1,htmlFor:1,httpEquiv:1,"http-equiv":"httpEquiv",icon:0,id:0,innerHTML:1,inputMode:1,integrity:0,is:0,itemID:1,itemProp:1,itemRef:1,itemScope:1,itemType:1,keyParams:1,keyType:1,kind:0,label:0,lang:0,list:0,loop:0,low:0,manifest:0,marginWidth:1,marginHeight:1,max:0,maxLength:1,media:0,mediaGroup:1,method:0,min:0,minLength:1,multiple:0,muted:0,name:0,noModule:1,nonce:0,noValidate:1,open:0,optimum:0,pattern:0,placeholder:0,playsInline:1,poster:0,preload:0,profile:0,radioGroup:1,readOnly:1,referrerPolicy:1,rel:0,required:0,reversed:0,role:0,rows:0,rowSpan:1,sandbox:0,scope:0,scoped:0,scrolling:0,seamless:0,selected:0,shape:0,size:0,sizes:0,span:0,spellCheck:1,src:0,srcDoc:1,srcLang:1,srcSet:1,start:0,step:0,style:0,summary:0,tabIndex:1,target:0,title:0,type:0,useMap:1,value:0,width:0,wmode:0,wrap:0,about:0,accentHeight:1,"accent-height":"accentHeight",accumulate:0,additive:0,alignmentBaseline:1,"alignment-baseline":"alignmentBaseline",allowReorder:1,alphabetic:0,amplitude:0,arabicForm:1,"arabic-form":"arabicForm",ascent:0,attributeName:1,attributeType:1,autoReverse:1,azimuth:0,baseFrequency:1,baselineShift:1,"baseline-shift":"baselineShift",baseProfile:1,bbox:0,begin:0,bias:0,by:0,calcMode:1,capHeight:1,"cap-height":"capHeight",clip:0,clipPath:1,"clip-path":"clipPath",clipPathUnits:1,clipRule:1,"clip-rule":"clipRule",color:0,colorInterpolation:1,"color-interpolation":"colorInterpolation",colorInterpolationFilters:1,"color-interpolation-filters":"colorInterpolationFilters",colorProfile:1,"color-profile":"colorProfile",colorRendering:1,"color-rendering":"colorRendering",contentScriptType:1,contentStyleType:1,cursor:0,cx:0,cy:0,d:0,datatype:0,decelerate:0,descent:0,diffuseConstant:1,direction:0,display:0,divisor:0,dominantBaseline:1,"dominant-baseline":"dominantBaseline",dur:0,dx:0,dy:0,edgeMode:1,elevation:0,enableBackground:1,"enable-background":"enableBackground",end:0,exponent:0,externalResourcesRequired:1,fill:0,fillOpacity:1,"fill-opacity":"fillOpacity",fillRule:1,"fill-rule":"fillRule",filter:0,filterRes:1,filterUnits:1,floodOpacity:1,"flood-opacity":"floodOpacity",floodColor:1,"flood-color":"floodColor",focusable:0,fontFamily:1,"font-family":"fontFamily",fontSize:1,"font-size":"fontSize",fontSizeAdjust:1,"font-size-adjust":"fontSizeAdjust",fontStretch:1,"font-stretch":"fontStretch",fontStyle:1,"font-style":"fontStyle",fontVariant:1,"font-variant":"fontVariant",fontWeight:1,"font-weight":"fontWeight",format:0,from:0,fx:0,fy:0,g1:0,g2:0,glyphName:1,"glyph-name":"glyphName",glyphOrientationHorizontal:1,"glyph-orientation-horizontal":"glyphOrientationHorizontal",glyphOrientationVertical:1,"glyph-orientation-vertical":"glyphOrientationVertical",glyphRef:1,gradientTransform:1,gradientUnits:1,hanging:0,horizAdvX:1,"horiz-adv-x":"horizAdvX",horizOriginX:1,"horiz-origin-x":"horizOriginX",ideographic:0,imageRendering:1,"image-rendering":"imageRendering",in2:0,in:0,inlist:0,intercept:0,k1:0,k2:0,k3:0,k4:0,k:0,kernelMatrix:1,kernelUnitLength:1,kerning:0,keyPoints:1,keySplines:1,keyTimes:1,lengthAdjust:1,letterSpacing:1,"letter-spacing":"letterSpacing",lightingColor:1,"lighting-color":"lightingColor",limitingConeAngle:1,local:0,markerEnd:1,"marker-end":"markerEnd",markerHeight:1,markerMid:1,"marker-mid":"markerMid",markerStart:1,"marker-start":"markerStart",markerUnits:1,markerWidth:1,mask:0,maskContentUnits:1,maskUnits:1,mathematical:0,mode:0,numOctaves:1,offset:0,opacity:0,operator:0,order:0,orient:0,orientation:0,origin:0,overflow:0,overlinePosition:1,"overline-position":"overlinePosition",overlineThickness:1,"overline-thickness":"overlineThickness",paintOrder:1,"paint-order":"paintOrder",panose1:0,"panose-1":"panose1",pathLength:1,patternContentUnits:1,patternTransform:1,patternUnits:1,pointerEvents:1,"pointer-events":"pointerEvents",points:0,pointsAtX:1,pointsAtY:1,pointsAtZ:1,prefix:0,preserveAlpha:1,preserveAspectRatio:1,primitiveUnits:1,property:0,r:0,radius:0,refX:1,refY:1,renderingIntent:1,"rendering-intent":"renderingIntent",repeatCount:1,repeatDur:1,requiredExtensions:1,requiredFeatures:1,resource:0,restart:0,result:0,results:0,rotate:0,rx:0,ry:0,scale:0,security:0,seed:0,shapeRendering:1,"shape-rendering":"shapeRendering",slope:0,spacing:0,specularConstant:1,specularExponent:1,speed:0,spreadMethod:1,startOffset:1,stdDeviation:1,stemh:0,stemv:0,stitchTiles:1,stopColor:1,"stop-color":"stopColor",stopOpacity:1,"stop-opacity":"stopOpacity",strikethroughPosition:1,"strikethrough-position":"strikethroughPosition",strikethroughThickness:1,"strikethrough-thickness":"strikethroughThickness",string:0,stroke:0,strokeDasharray:1,"stroke-dasharray":"strokeDasharray",strokeDashoffset:1,"stroke-dashoffset":"strokeDashoffset",strokeLinecap:1,"stroke-linecap":"strokeLinecap",strokeLinejoin:1,"stroke-linejoin":"strokeLinejoin",strokeMiterlimit:1,"stroke-miterlimit":"strokeMiterlimit",strokeWidth:1,"stroke-width":"strokeWidth",strokeOpacity:1,"stroke-opacity":"strokeOpacity",suppressContentEditableWarning:1,suppressHydrationWarning:1,surfaceScale:1,systemLanguage:1,tableValues:1,targetX:1,targetY:1,textAnchor:1,"text-anchor":"textAnchor",textDecoration:1,"text-decoration":"textDecoration",textLength:1,textRendering:1,"text-rendering":"textRendering",to:0,transform:0,typeof:0,u1:0,u2:0,underlinePosition:1,"underline-position":"underlinePosition",underlineThickness:1,"underline-thickness":"underlineThickness",unicode:0,unicodeBidi:1,"unicode-bidi":"unicodeBidi",unicodeRange:1,"unicode-range":"unicodeRange",unitsPerEm:1,"units-per-em":"unitsPerEm",unselectable:0,vAlphabetic:1,"v-alphabetic":"vAlphabetic",values:0,vectorEffect:1,"vector-effect":"vectorEffect",version:0,vertAdvY:1,"vert-adv-y":"vertAdvY",vertOriginX:1,"vert-origin-x":"vertOriginX",vertOriginY:1,"vert-origin-y":"vertOriginY",vHanging:1,"v-hanging":"vHanging",vIdeographic:1,"v-ideographic":"vIdeographic",viewBox:1,viewTarget:1,visibility:0,vMathematical:1,"v-mathematical":"vMathematical",vocab:0,widths:0,wordSpacing:1,"word-spacing":"wordSpacing",writingMode:1,"writing-mode":"writingMode",x1:0,x2:0,x:0,xChannelSelector:1,xHeight:1,"x-height":"xHeight",xlinkActuate:1,"xlink:actuate":"xlinkActuate",xlinkArcrole:1,"xlink:arcrole":"xlinkArcrole",xlinkHref:1,"xlink:href":"xlinkHref",xlinkRole:1,"xlink:role":"xlinkRole",xlinkShow:1,"xlink:show":"xlinkShow",xlinkTitle:1,"xlink:title":"xlinkTitle",xlinkType:1,"xlink:type":"xlinkType",xmlBase:1,"xml:base":"xmlBase",xmlLang:1,"xml:lang":"xmlLang",xmlns:0,"xml:space":"xmlSpace",xmlnsXlink:1,"xmlns:xlink":"xmlnsXlink",xmlSpace:1,y1:0,y2:0,y:0,yChannelSelector:1,z:0,zoomAndPan:1};const RESERVED=0,STRING=1,BOOLEANISH_STRING=2,BOOLEAN=3,OVERLOADED_BOOLEAN=4,NUMERIC=5,POSITIVE_NUMERIC=6;function getPropertyInfo(i){return properties.hasOwnProperty(i)?properties[i]:null}function PropertyInfoRecord(i,e,a,c,h,d,et){this.acceptsBooleans=e===BOOLEANISH_STRING||e===BOOLEAN||e===OVERLOADED_BOOLEAN,this.attributeName=c,this.attributeNamespace=h,this.mustUseProperty=a,this.propertyName=i,this.type=e,this.sanitizeURL=d,this.removeEmptyString=et}const properties={},reservedProps=["children","dangerouslySetInnerHTML","defaultValue","defaultChecked","innerHTML","suppressContentEditableWarning","suppressHydrationWarning","style"];reservedProps.forEach(i=>{properties[i]=new PropertyInfoRecord(i,RESERVED,!1,i,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(([i,e])=>{properties[i]=new PropertyInfoRecord(i,STRING,!1,e,null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(i=>{properties[i]=new PropertyInfoRecord(i,BOOLEANISH_STRING,!1,i.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(i=>{properties[i]=new PropertyInfoRecord(i,BOOLEANISH_STRING,!1,i,null,!1,!1)});["allowFullScreen","async","autoFocus","autoPlay","controls","default","defer","disabled","disablePictureInPicture","disableRemotePlayback","formNoValidate","hidden","loop","noModule","noValidate","open","playsInline","readOnly","required","reversed","scoped","seamless","itemScope"].forEach(i=>{properties[i]=new PropertyInfoRecord(i,BOOLEAN,!1,i.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(i=>{properties[i]=new PropertyInfoRecord(i,BOOLEAN,!0,i,null,!1,!1)});["capture","download"].forEach(i=>{properties[i]=new PropertyInfoRecord(i,OVERLOADED_BOOLEAN,!1,i,null,!1,!1)});["cols","rows","size","span"].forEach(i=>{properties[i]=new PropertyInfoRecord(i,POSITIVE_NUMERIC,!1,i,null,!1,!1)});["rowSpan","start"].forEach(i=>{properties[i]=new PropertyInfoRecord(i,NUMERIC,!1,i.toLowerCase(),null,!1,!1)});const CAMELIZE=/[\-\:]([a-z])/g,capitalize$1=i=>i[1].toUpperCase();["accent-height","alignment-baseline","arabic-form","baseline-shift","cap-height","clip-path","clip-rule","color-interpolation","color-interpolation-filters","color-profile","color-rendering","dominant-baseline","enable-background","fill-opacity","fill-rule","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","glyph-name","glyph-orientation-horizontal","glyph-orientation-vertical","horiz-adv-x","horiz-origin-x","image-rendering","letter-spacing","lighting-color","marker-end","marker-mid","marker-start","overline-position","overline-thickness","paint-order","panose-1","pointer-events","rendering-intent","shape-rendering","stop-color","stop-opacity","strikethrough-position","strikethrough-thickness","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","text-anchor","text-decoration","text-rendering","underline-position","underline-thickness","unicode-bidi","unicode-range","units-per-em","v-alphabetic","v-hanging","v-ideographic","v-mathematical","vector-effect","vert-adv-y","vert-origin-x","vert-origin-y","word-spacing","writing-mode","xmlns:xlink","x-height"].forEach(i=>{const e=i.replace(CAMELIZE,capitalize$1);properties[e]=new PropertyInfoRecord(e,STRING,!1,i,null,!1,!1)});["xlink:actuate","xlink:arcrole","xlink:role","xlink:show","xlink:title","xlink:type"].forEach(i=>{const e=i.replace(CAMELIZE,capitalize$1);properties[e]=new PropertyInfoRecord(e,STRING,!1,i,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(i=>{const e=i.replace(CAMELIZE,capitalize$1);properties[e]=new PropertyInfoRecord(e,STRING,!1,i,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(i=>{properties[i]=new PropertyInfoRecord(i,STRING,!1,i.toLowerCase(),null,!1,!1)});const xlinkHref="xlinkHref";properties[xlinkHref]=new PropertyInfoRecord("xlinkHref",STRING,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(i=>{properties[i]=new PropertyInfoRecord(i,STRING,!1,i.toLowerCase(),null,!0,!0)});const{CAMELCASE,SAME,possibleStandardNames:possibleStandardNamesOptimized}=possibleStandardNamesOptimized$1,ATTRIBUTE_NAME_START_CHAR=":A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",ATTRIBUTE_NAME_CHAR=ATTRIBUTE_NAME_START_CHAR+"\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040",isCustomAttribute=RegExp.prototype.test.bind(new RegExp("^(data|aria)-["+ATTRIBUTE_NAME_CHAR+"]*$")),possibleStandardNames=Object.keys(possibleStandardNamesOptimized).reduce((i,e)=>{const a=possibleStandardNamesOptimized[e];return a===SAME?i[e]=e:a===CAMELCASE?i[e.toLowerCase()]=e:i[e]=a,i},{});lib.BOOLEAN=BOOLEAN;lib.BOOLEANISH_STRING=BOOLEANISH_STRING;lib.NUMERIC=NUMERIC;lib.OVERLOADED_BOOLEAN=OVERLOADED_BOOLEAN;lib.POSITIVE_NUMERIC=POSITIVE_NUMERIC;lib.RESERVED=RESERVED;lib.STRING=STRING;lib.getPropertyInfo=getPropertyInfo;lib.isCustomAttribute=isCustomAttribute;lib.possibleStandardNames=possibleStandardNames;var utilities$1={},cjs$1={},COMMENT_REGEX=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,NEWLINE_REGEX=/\n/g,WHITESPACE_REGEX=/^\s*/,PROPERTY_REGEX=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,COLON_REGEX=/^:\s*/,VALUE_REGEX=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,SEMICOLON_REGEX=/^[;\s]*/,TRIM_REGEX=/^\s+|\s+$/g,NEWLINE=`
`,FORWARD_SLASH="/",ASTERISK="*",EMPTY_STRING="",TYPE_COMMENT="comment",TYPE_DECLARATION="declaration",inlineStyleParser=function(i,e){if(typeof i!="string")throw new TypeError("First argument must be a string");if(!i)return[];e=e||{};var a=1,c=1;function h(Tt){var At=Tt.match(NEWLINE_REGEX);At&&(a+=At.length);var kt=Tt.lastIndexOf(NEWLINE);c=~kt?Tt.length-kt:c+Tt.length}function d(){var Tt={line:a,column:c};return function(At){return At.position=new et(Tt),_t(),At}}function et(Tt){this.start=Tt,this.end={line:a,column:c},this.source=e.source}et.prototype.content=i;function ft(Tt){var At=new Error(e.source+":"+a+":"+c+": "+Tt);if(At.reason=Tt,At.filename=e.source,At.line=a,At.column=c,At.source=i,!e.silent)throw At}function gt(Tt){var At=Tt.exec(i);if(At){var kt=At[0];return h(kt),i=i.slice(kt.length),At}}function _t(){gt(WHITESPACE_REGEX)}function wt(Tt){var At;for(Tt=Tt||[];At=$t();)At!==!1&&Tt.push(At);return Tt}function $t(){var Tt=d();if(!(FORWARD_SLASH!=i.charAt(0)||ASTERISK!=i.charAt(1))){for(var At=2;EMPTY_STRING!=i.charAt(At)&&(ASTERISK!=i.charAt(At)||FORWARD_SLASH!=i.charAt(At+1));)++At;if(At+=2,EMPTY_STRING===i.charAt(At-1))return ft("End of comment missing");var kt=i.slice(2,At-2);return c+=2,h(kt),i=i.slice(At),c+=2,Tt({type:TYPE_COMMENT,comment:kt})}}function It(){var Tt=d(),At=gt(PROPERTY_REGEX);if(At){if($t(),!gt(COLON_REGEX))return ft("property missing ':'");var kt=gt(VALUE_REGEX),xt=Tt({type:TYPE_DECLARATION,property:trim(At[0].replace(COMMENT_REGEX,EMPTY_STRING)),value:kt?trim(kt[0].replace(COMMENT_REGEX,EMPTY_STRING)):EMPTY_STRING});return gt(SEMICOLON_REGEX),xt}}function Rt(){var Tt=[];wt(Tt);for(var At;At=It();)At!==!1&&(Tt.push(At),wt(Tt));return Tt}return _t(),Rt()};function trim(i){return i?i.replace(TRIM_REGEX,EMPTY_STRING):EMPTY_STRING}var __importDefault$2=commonjsGlobal&&commonjsGlobal.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(cjs$1,"__esModule",{value:!0});var inline_style_parser_1=__importDefault$2(inlineStyleParser);function StyleToObject(i,e){var a=null;if(!i||typeof i!="string")return a;var c=(0,inline_style_parser_1.default)(i),h=typeof e=="function";return c.forEach(function(d){if(d.type==="declaration"){var et=d.property,ft=d.value;h?e(et,ft,d):ft&&(a=a||{},a[et]=ft)}}),a}cjs$1.default=StyleToObject;var utilities={};Object.defineProperty(utilities,"__esModule",{value:!0});utilities.camelCase=void 0;var CUSTOM_PROPERTY_REGEX=/^--[a-zA-Z0-9-]+$/,HYPHEN_REGEX=/-([a-z])/g,NO_HYPHEN_REGEX=/^[^-]+$/,VENDOR_PREFIX_REGEX=/^-(webkit|moz|ms|o|khtml)-/,MS_VENDOR_PREFIX_REGEX=/^-(ms)-/,skipCamelCase=function(i){return!i||NO_HYPHEN_REGEX.test(i)||CUSTOM_PROPERTY_REGEX.test(i)},capitalize=function(i,e){return e.toUpperCase()},trimHyphen=function(i,e){return"".concat(e,"-")},camelCase=function(i,e){return e===void 0&&(e={}),skipCamelCase(i)?i:(i=i.toLowerCase(),e.reactCompat?i=i.replace(MS_VENDOR_PREFIX_REGEX,trimHyphen):i=i.replace(VENDOR_PREFIX_REGEX,trimHyphen),i.replace(HYPHEN_REGEX,capitalize))};utilities.camelCase=camelCase;var __importDefault$1=commonjsGlobal&&commonjsGlobal.__importDefault||function(i){return i&&i.__esModule?i:{default:i}},style_to_object_1=__importDefault$1(cjs$1),utilities_1$2=utilities;function StyleToJS(i,e){var a={};return!i||typeof i!="string"||(0,style_to_object_1.default)(i,function(c,h){c&&h&&(a[(0,utilities_1$2.camelCase)(c,e)]=h)}),a}StyleToJS.default=StyleToJS;var cjs=StyleToJS;(function(i){var e=commonjsGlobal&&commonjsGlobal.__importDefault||function(wt){return wt&&wt.__esModule?wt:{default:wt}};Object.defineProperty(i,"__esModule",{value:!0}),i.returnFirstArg=i.canTextBeChildOfNode=i.ELEMENTS_WITH_NO_TEXT_CHILDREN=i.PRESERVE_CUSTOM_ATTRIBUTES=i.setStyleProp=i.isCustomComponent=void 0;var a=reactExports,c=e(cjs),h=new Set(["annotation-xml","color-profile","font-face","font-face-src","font-face-uri","font-face-format","font-face-name","missing-glyph"]);function d(wt,$t){return wt.includes("-")?!h.has(wt):!!($t&&typeof $t.is=="string")}i.isCustomComponent=d;var et={reactCompat:!0};function ft(wt,$t){if(typeof wt=="string"){if(!wt.trim()){$t.style={};return}try{$t.style=(0,c.default)(wt,et)}catch{$t.style={}}}}i.setStyleProp=ft,i.PRESERVE_CUSTOM_ATTRIBUTES=Number(a.version.split(".")[0])>=16,i.ELEMENTS_WITH_NO_TEXT_CHILDREN=new Set(["tr","tbody","thead","tfoot","colgroup","table","head","html","frameset"]);var gt=function(wt){return!i.ELEMENTS_WITH_NO_TEXT_CHILDREN.has(wt.name)};i.canTextBeChildOfNode=gt;var _t=function(wt){return wt};i.returnFirstArg=_t})(utilities$1);Object.defineProperty(attributesToProps$1,"__esModule",{value:!0});var react_property_1=lib,utilities_1$1=utilities$1,UNCONTROLLED_COMPONENT_ATTRIBUTES=["checked","value"],UNCONTROLLED_COMPONENT_NAMES=["input","select","textarea"],valueOnlyInputs={reset:!0,submit:!0};function attributesToProps(i,e){i===void 0&&(i={});var a={},c=!!(i.type&&valueOnlyInputs[i.type]);for(var h in i){var d=i[h];if((0,react_property_1.isCustomAttribute)(h)){a[h]=d;continue}var et=h.toLowerCase(),ft=getPropName(et);if(ft){var gt=(0,react_property_1.getPropertyInfo)(ft);switch(UNCONTROLLED_COMPONENT_ATTRIBUTES.includes(ft)&&UNCONTROLLED_COMPONENT_NAMES.includes(e)&&!c&&(ft=getPropName("default"+et)),a[ft]=d,gt&&gt.type){case react_property_1.BOOLEAN:a[ft]=!0;break;case react_property_1.OVERLOADED_BOOLEAN:d===""&&(a[ft]=!0);break}continue}utilities_1$1.PRESERVE_CUSTOM_ATTRIBUTES&&(a[h]=d)}return(0,utilities_1$1.setStyleProp)(i.style,a),a}attributesToProps$1.default=attributesToProps;function getPropName(i){return react_property_1.possibleStandardNames[i]}var domToReact$1={},__importDefault=commonjsGlobal&&commonjsGlobal.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(domToReact$1,"__esModule",{value:!0});var react_1=reactExports,attributes_to_props_1=__importDefault(attributesToProps$1),utilities_1=utilities$1,React={cloneElement:react_1.cloneElement,createElement:react_1.createElement,isValidElement:react_1.isValidElement};function domToReact(i,e){e===void 0&&(e={});for(var a=[],c=typeof e.replace=="function",h=e.transform||utilities_1.returnFirstArg,d=e.library||React,et=d.cloneElement,ft=d.createElement,gt=d.isValidElement,_t=i.length,wt=0;wt<_t;wt++){var $t=i[wt];if(c){var It=e.replace($t,wt);if(gt(It)){_t>1&&(It=et(It,{key:It.key||wt})),a.push(h(It,$t,wt));continue}}if($t.type==="text"){var Rt=!$t.data.trim().length;if(Rt&&$t.parent&&!(0,utilities_1.canTextBeChildOfNode)($t.parent)||e.trim&&Rt)continue;a.push(h($t.data,$t,wt));continue}var Tt=$t,At={};skipAttributesToProps(Tt)?((0,utilities_1.setStyleProp)(Tt.attribs.style,Tt.attribs),At=Tt.attribs):Tt.attribs&&(At=(0,attributes_to_props_1.default)(Tt.attribs,Tt.name));var kt=void 0;switch($t.type){case"script":case"style":$t.children[0]&&(At.dangerouslySetInnerHTML={__html:$t.children[0].data});break;case"tag":$t.name==="textarea"&&$t.children[0]?At.defaultValue=$t.children[0].data:$t.children&&$t.children.length&&(kt=domToReact($t.children,e));break;default:continue}_t>1&&(At.key=wt),a.push(h(ft($t.name,At,kt),$t,wt))}return a.length===1?a[0]:a}domToReact$1.default=domToReact;function skipAttributesToProps(i){return utilities_1.PRESERVE_CUSTOM_ATTRIBUTES&&i.type==="tag"&&(0,utilities_1.isCustomComponent)(i.name,i.attribs)}(function(i){var e=commonjsGlobal&&commonjsGlobal.__importDefault||function(gt){return gt&&gt.__esModule?gt:{default:gt}};Object.defineProperty(i,"__esModule",{value:!0}),i.htmlToDOM=i.domToReact=i.attributesToProps=i.Text=i.ProcessingInstruction=i.Element=i.Comment=void 0;var a=e(htmlToDom);i.htmlToDOM=a.default;var c=e(attributesToProps$1);i.attributesToProps=c.default;var h=e(domToReact$1);i.domToReact=h.default;var d=lib$2;Object.defineProperty(i,"Comment",{enumerable:!0,get:function(){return d.Comment}}),Object.defineProperty(i,"Element",{enumerable:!0,get:function(){return d.Element}}),Object.defineProperty(i,"ProcessingInstruction",{enumerable:!0,get:function(){return d.ProcessingInstruction}}),Object.defineProperty(i,"Text",{enumerable:!0,get:function(){return d.Text}});var et={lowerCaseAttributeNames:!1};function ft(gt,_t){if(typeof gt!="string")throw new TypeError("First argument must be a string");return gt?(0,h.default)((0,a.default)(gt,(_t==null?void 0:_t.htmlparser2)||et),_t):[]}i.default=ft})(lib$3);const HTMLReactParser=getDefaultExportFromCjs(lib$3),parse=HTMLReactParser.default||HTMLReactParser,StyledMessage=ut$1.div`
    position: relative;
    margin: 4px;
    padding: 5px 10px 18px 10px;
    //padding: 10px 45px 10px 10px;
    display: inline-block;
    border-radius: 10px 10px 10px 10px;
    color: black;
    font-size: 14pt;
    min-width: 30%;
    word-wrap: break-word;
    -webkit-box-shadow: 0 5px 10px 2px rgba(34, 60, 80, 0.2) inset;
    -moz-box-shadow: 0 5px 10px 2px rgba(34, 60, 80, 0.2) inset;
    box-shadow: 0 5px 10px 2px rgba(34, 60, 80, 0.2) inset;
`,StyledTimeSpan=ut$1.span`
    color: rgba(104, 108, 114, 0.75);
    padding: 4px;
    padding-right: 6px;
    padding-top: 6px;
    font-size: 9pt;
    position: absolute;
    bottom: 0;
    right: 0;
`,StyledUsernameSpan=ut$1.span`
    padding: 3px;
    display: block;
    width: 100%;
    font-size: 10pt;
`,StyledDivLeft=ut$1.div`
    text-align: left;

    ${StyledMessage} {
        background-color: rgba(170, 169, 169, 0.5);
        border-bottom-left-radius: 0;
    }
`,StyledDivRight=ut$1.div`
    text-align: right;

    ${StyledMessage} {
        background-color: rgba(169, 225, 225, 0.5);
        border-bottom-right-radius: 0;
    }
`,Message=({message:i})=>{const{user:e}=useUser(),a=i.sender_id==e.id,c=a?StyledDivRight:StyledDivLeft,{username_part:h,id_part:d}=getUsernameWithID(i.sender,i.sender_id),et=new Date(i.time).toLocaleTimeString();return jsxRuntimeExports.jsx(c,{children:jsxRuntimeExports.jsxs(StyledMessage,{children:[a?jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{}):jsxRuntimeExports.jsxs(StyledUsernameSpan,{children:[jsxRuntimeExports.jsx("b",{style:{color:stringToColour(i.sender+i.sender_id)},children:h}),d]}),i.html_parse?parse(i.text):i.text,jsxRuntimeExports.jsx(StyledTimeSpan,{children:et})]})})},StyledDivMessages=ut$1.div`
    padding: 8px;
    margin-top: 1rem;
    -webkit-box-shadow: 0 5px 10px 2px rgba(34, 60, 80, 0.2) inset;
    -moz-box-shadow: 0 5px 10px 2px rgba(34, 60, 80, 0.2) inset;
    box-shadow: 0 5px 10px 2px rgba(34, 60, 80, 0.2) inset;
    border-radius: 5px;
    height: 74vh;
    overflow-x: auto;
    position: relative;
`,MessagesBox=({messages:i})=>{const e=reactExports.useRef(null);return reactExports.useEffect(()=>{e.current.scrollTop=e.current.scrollHeight},[i==null?void 0:i.length]),jsxRuntimeExports.jsx(StyledDivMessages,{ref:e,children:i.map((a,c)=>jsxRuntimeExports.jsx(Message,{message:a},c))})};function hashCode(i){let e=0;for(let a=0;a<i.length;a++){const c=i.charCodeAt(a);e=(e<<5)-e+c,e=e&e}return e}const UserDataContext=reactExports.createContext({userData:{firefly:!1,html_parse:!1,protocol:"torrent"},setUserData:()=>{}}),roomId="kfwlakflwekflmvlfkleflaepqe",StyledDiv$4=ut$1.div`
    margin: 0 auto;
    max-width: 700px;
    padding: 1rem;
    background-color: whitesmoke;

    h1 {
        font-size: 15pt;
    }
`,StyledTextarea=ut$1.textarea`
    font-size: 15pt;
    padding: 10px;
    margin: 10px;
`,StyledButton=ut$1.div`
    img {
        width: 40px;
        height: 40px;
    }
`,StyledDivSend=ut$1.div`
    display: flex;
    flex-direction: row;
    vertical-align: center;
    justify-content: space-evenly;
    align-items: center;
`,StyledDivSyncMessages=ut$1.div`
    display: flex;
    justify-content: space-evenly;
`,Main=()=>{const{user:i}=useUser(),{userData:e}=reactExports.useContext(UserDataContext),{room:a}=useRoom(roomId,e.protocol),c=reactExports.useRef(null),[h,d]=reactExports.useState([]),[et,ft]=reactExports.useState(0),[gt,_t]=reactExports.useState([]),[wt,$t]=reactExports.useState(!1),[It,Rt]=a.makeAction("message"),[Tt,At]=a.makeAction("peermessage"),[kt,xt]=a.makeAction("messagereq"),[Nt,Ft]=a.makeAction("activereq"),[jt,Gt]=a.makeAction("username");a.onPeerJoin(er=>{ft(et+1)}),a.onPeerLeave(er=>{ft(et-1)}),Rt((er,mr)=>{d([...h,er])}),xt((er,mr)=>{Tt(h)}),Ft((er,mr)=>{jt({username:i.username,sender_id:i.id})});function Kt(er){const mr=[];return er.filter(Mr=>mr.includes(Mr.hash)?!1:(mr.push(Mr.hash),!0))}function Wt(){$t(!0),At((er,mr)=>{d(Mr=>{const wr=[...er,...Mr],Dr=Kt(wr);return Dr.sort((Tr,fr)=>Tr.time<fr.time?-1:1),Dr})}),setTimeout(()=>{At((er,mr)=>{}),$t(!1)},5e3),kt("")}function Zt(){$t(!0),_t([]),ft(0),Gt((er,mr)=>{_t(Mr=>{const wr=[...Mr,er].filter((Dr,Tr,fr)=>fr.indexOf(Dr)===Tr);return ft(wr.length),wr})}),setTimeout(()=>{Gt((er,mr)=>{}),$t(!1)},5e3),Nt("")}function cr(er,mr,Mr,wr){const Dr={sender:er,text:Mr,sender_id:mr,html_parse:wr,time:new Date().getTime()};return{...Dr,hash:hashCode(JSON.stringify(Dr))}}function hr(er){}function gr(){var er;if((er=c.current)!=null&&er.value){const mr=cr(i.username,i.id,c.current.value,e.html_parse);d([...h,mr]),It(mr),c.current.value=""}}return jsxRuntimeExports.jsx("div",{style:{textAlign:"center"},children:jsxRuntimeExports.jsxs(StyledDiv$4,{children:[jsxRuntimeExports.jsxs(StyledDivSyncMessages,{children:[jsxRuntimeExports.jsxs("h1",{children:["Online: ",et]}),jsxRuntimeExports.jsx("button",{disabled:wt,onClick:Wt,style:{padding:"5px"},children:"Sync messages"}),jsxRuntimeExports.jsx("button",{disabled:wt,onClick:Zt,style:{padding:"5px"},children:"Sync peers"})]}),jsxRuntimeExports.jsx(MessagesBox,{messages:h}),jsxRuntimeExports.jsxs(StyledDivSend,{children:[jsxRuntimeExports.jsx(StyledTextarea,{onKeyDown:hr,rows:2,cols:30,ref:c,style:{}}),jsxRuntimeExports.jsx(StyledButton,{onClick:gr,children:jsxRuntimeExports.jsx("img",{src:send,alt:"send"})})]})]})})},StyledDiv$3=ut$1.div`
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    padding-top: 1rem;

    p {
        font-size: 15pt;
    }
    
    input {
        width: 20px;
        height: 20px;
    }
`,CheckboxWithLabel=({label:i,checked:e,onChange:a})=>jsxRuntimeExports.jsxs(StyledDiv$3,{children:[jsxRuntimeExports.jsx("p",{children:i}),jsxRuntimeExports.jsx("input",{defaultChecked:e,onChange:c=>a(c.target.checked),type:"checkbox"})]}),StyledDiv$2=ut$1.div`
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    padding-top: 0.5rem;

    p {
        font-size: 15pt;
    }
    
    select {
        font-size: 12pt;
        padding: 0.3rem;
    }
`,SelectWithLabel=({label:i,default_val:e,selection:a,onChange:c})=>jsxRuntimeExports.jsxs(StyledDiv$2,{children:[jsxRuntimeExports.jsx("p",{children:i}),jsxRuntimeExports.jsx("select",{onChange:h=>c(h.target.value),defaultValue:e,children:a.map((h,d)=>jsxRuntimeExports.jsx("option",{children:h},d))})]}),Protocols=["torrent","nostr","mqtt","ipfs","firebase"],StyledDiv$1=ut$1.div`
    opacity: ${i=>i.$isOpen?"1":"0"};
    visibility: ${i=>i.$isOpen?"visible":"hidden"};
    transition: all .4s;
    padding: 10px;
    margin: 2rem;
    display: flex;
    flex-direction: column;
    border: black solid 2px;
    border-radius: 5px;
    box-shadow: rgba(0, 0, 0, 0.16) 0px 10px 36px 0px, rgba(0, 0, 0, 0.06) 0px 0px 0px 1px;
`,HiddenParams=({visible:i})=>{const{userData:e,setUserData:a}=reactExports.useContext(UserDataContext);function c(d){a({...e,html_parse:d})}function h(d){a({...e,protocol:d})}return jsxRuntimeExports.jsxs(StyledDiv$1,{$isOpen:i,children:[jsxRuntimeExports.jsx("h3",{children:"Panel only for firefly enjoyers :)"}),jsxRuntimeExports.jsx(CheckboxWithLabel,{checked:e.html_parse,label:"Parse html",onChange:c}),jsxRuntimeExports.jsx(SelectWithLabel,{label:"Protocol",selection:Protocols,default_val:e.protocol,onChange:h})]})},StyledDiv=ut$1.div`
    padding: 1rem;
`,StyledP=ut$1.p`
    color: ${i=>i.$color?"red":"#a1a1a1"};
    position: absolute;
    bottom: 1%;
    right: 3%;
`,About=()=>{const{userData:i,setUserData:e}=reactExports.useContext(UserDataContext);function a(){e({...i,firefly:!i.firefly})}return jsxRuntimeExports.jsxs(StyledDiv,{children:[jsxRuntimeExports.jsx("h1",{children:"Council of 3 men, cheese and fucked came up with the idea for this site"}),jsxRuntimeExports.jsx(HiddenParams,{visible:i.firefly}),jsxRuntimeExports.jsx(StyledP,{$color:i.firefly,onClick:a,children:"Firefly is the best btw"})]})},router=createHashRouter(createRoutesFromChildren(jsxRuntimeExports.jsxs(Route,{element:jsxRuntimeExports.jsx(RootLayout,{}),children:[jsxRuntimeExports.jsx(Route,{index:!0,element:jsxRuntimeExports.jsx(Home,{})}),jsxRuntimeExports.jsx(Route,{path:"/global_chat",element:jsxRuntimeExports.jsx(Main,{})}),jsxRuntimeExports.jsx(Route,{path:"/about",element:jsxRuntimeExports.jsx(About,{})})]})));function App(){const[i,e]=reactExports.useState(()=>{const h=localStorage.getItem("user");return h?JSON.parse(h):getNewUser()}),[a,c]=reactExports.useState({firefly:!1,html_parse:!1,protocol:"torrent"});return jsxRuntimeExports.jsx(UserDataContext.Provider,{value:{userData:a,setUserData:c},children:jsxRuntimeExports.jsx(UserContext.Provider,{value:{user:i,setUser:e},children:jsxRuntimeExports.jsx(RouterProvider,{router})})})}const GlobalStyles=dt$1`
    * {
        font-family: Nunito, sans-serif;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }
`;client.createRoot(document.getElementById("root")).render(jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(GlobalStyles,{}),jsxRuntimeExports.jsx(App,{})]}));
